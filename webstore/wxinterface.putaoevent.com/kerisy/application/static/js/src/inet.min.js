var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};var _p=window;_p.gl;_p.WebGLRenderingContext;_p.DeviceOrientationEvent;_p.DeviceMotionEvent;_p.AudioContext;if(!_p.AudioContext){_p.webkitAudioContext}_p.mozAudioContext;_p=Object.prototype;_p._super;_p.ctor;_p=null;cc.ORIENTATION_PORTRAIT=0;cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;cc.ORIENTATION_LANDSCAPE_LEFT=2;cc.ORIENTATION_LANDSCAPE_RIGHT=3;cc._drawingUtil=null;cc._renderContext=null;cc._supportRender=false;cc._canvas=null;cc.container=null;cc._gameDiv=null;cc.newElement=function(t){return document.createElement(t)};cc.each=function(t,e,i){if(!t)return;if(t instanceof Array){for(var n=0,r=t.length;n<r;n++){if(e.call(i,t[n],n)===false)return}}else{for(var s in t){if(e.call(i,t[s],s)===false)return}}};cc.extend=function(t){var e=arguments.length>=2?Array.prototype.slice.call(arguments,1):[];cc.each(e,function(e){for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}});return t};cc.isFunction=function(t){return typeof t==="function"};cc.isNumber=function(t){return typeof t==="number"||Object.prototype.toString.call(t)==="[object Number]"};cc.isString=function(t){return typeof t==="string"||Object.prototype.toString.call(t)==="[object String]"};cc.isArray=function(t){return Array.isArray(t)||typeof t==="object"&&Object.prototype.toString.call(t)==="[object Array]"};cc.isUndefined=function(t){return typeof t==="undefined"};cc.isObject=function(t){return typeof t==="object"&&Object.prototype.toString.call(t)==="[object Object]"};cc.isCrossOrigin=function(t){if(!t){cc.log("invalid URL");return false}var e=t.indexOf("://");if(e===-1)return false;var i=t.indexOf("/",e+3);var n=i===-1?t:t.substring(0,i);return n!==location.origin};cc.AsyncPool=function(t,e,i,n,r){var s=this;s._srcObj=t;s._limit=e;s._pool=[];s._iterator=i;s._iteratorTarget=r;s._onEnd=n;s._onEndTarget=r;s._results=t instanceof Array?[]:{};cc.each(t,function(t,e){s._pool.push({index:e,value:t})});s.size=s._pool.length;s.finishedSize=0;s._workingSize=0;s._limit=s._limit||s.size;s.onIterator=function(t,e){s._iterator=t;s._iteratorTarget=e};s.onEnd=function(t,e){s._onEnd=t;s._onEndTarget=e};s._handleItem=function(){var t=this;if(t._pool.length===0||t._workingSize>=t._limit)return;var e=t._pool.shift();var i=e.value,n=e.index;t._workingSize++;t._iterator.call(t._iteratorTarget,i,n,function(e){t.finishedSize++;t._workingSize--;var i=Array.prototype.slice.call(arguments,1);t._results[this.index]=i[0];if(t.finishedSize===t.size){if(t._onEnd)t._onEnd.call(t._onEndTarget,null,t._results);return}t._handleItem()}.bind(e),t)};s.flow=function(){var t=this;if(t._pool.length===0){if(t._onEnd)t._onEnd.call(t._onEndTarget,null,[]);return}for(var e=0;e<t._limit;e++)t._handleItem()}};cc.async={series:function(t,e,i){var n=new cc.AsyncPool(t,1,function(t,e,n){t.call(i,n)},e,i);n.flow();return n},parallel:function(t,e,i){var n=new cc.AsyncPool(t,0,function(t,e,n){t.call(i,n)},e,i);n.flow();return n},waterfall:function(t,e,i){var n=[];var r=[null];var s=new cc.AsyncPool(t,1,function(e,s,a){n.push(function(e){n=Array.prototype.slice.call(arguments,1);if(t.length-1===s)r=r.concat(n);a.apply(null,arguments)});e.apply(i,n)},function(t){if(!e)return;if(t)return e.call(i,t);e.apply(i,r)});s.flow();return s},map:function(t,e,i,n){var r=e;if(typeof e==="object"){i=e.cb;n=e.iteratorTarget;r=e.iterator}var s=new cc.AsyncPool(t,0,r,i,n);s.flow();return s},mapLimit:function(t,e,i,n,r){var s=new cc.AsyncPool(t,e,i,n,r);s.flow();return s}};cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){var t=arguments.length;var e="";for(var i=0;i<t;i++){e=(e+(e===""?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"")}return e},extname:function(t){var e=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t);return e?e[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");if(i>0)t=t.substring(0,i);var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g;var r=n.exec(t.replace(/(\/|\\\\)$/,""));if(!r)return null;var s=r[2];if(e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase())return s.substring(0,s.length-e.length);return s},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?");var n="";if(i>0){n=t.substring(i);t=t.substring(0,i)}i=t.lastIndexOf(".");if(i<0)return t+e+n;return t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(e.indexOf(".")===0)return this.changeExtname(t,e);var n=t.indexOf("?");var r="";var s=i?this.extname(t):"";if(n>0){r=t.substring(n);t=t.substring(0,n)}n=t.lastIndexOf("/");n=n<=0?0:n+1;return t.substring(0,n)+e+s+r},_normalize:function(t){var e=t=String(t);do{e=t;t=t.replace(this.normalizeRE,"")}while(e.length!==t.length);return t}};cc.loader=function(){var t={},e={},i={},n={},r=new RegExp("^"+"(?:(?:https?|ftp)://)"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))"+"|"+"(?:localhost)"+")"+"(?::\\d{2,5})?"+"(?:/\\S*)?"+"$","i");return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(t.length===1){r[1]=e instanceof Array?e:[e]}else if(t.length===2){if(typeof i==="function"){r[1]=e instanceof Array?e:[e];r[2]=i}else{r[0]=e||"";r[1]=i instanceof Array?i:[i]}}else if(t.length===3){r[0]=e||"";r[1]=i instanceof Array?i:[i];r[2]=n}else throw new Error("arguments error to load js!");return r},loadJs:function(e,i,n){var r=this,s=r._getArgs4Js(arguments);var a=s[0],o=s[1],c=s[2];if(navigator.userAgent.indexOf("Trident/5")>-1){r._loadJs4Dependency(a,o,0,c)}else{cc.async.map(o,function(e,i,n){var s=cc.path.join(a,e);if(t[s])return n(null);r._createScript(s,false,n)},c)}},loadJsWithImg:function(t,e,i){var n=this,r=n._loadJsImg(),s=n._getArgs4Js(arguments);this.loadJs(s[0],s[1],function(t){if(t)throw new Error(t);r.parentNode.removeChild(r);if(s[2])s[2]()})},_createScript:function(e,i,n){var r=document,s=this,a=document.createElement("script");a.async=i;t[e]=true;if(cc.game.config["noCache"]&&typeof e==="string"){if(s._noCacheRex.test(e))a.src=e+"&_t="+(new Date-0);else a.src=e+"?_t="+(new Date-0)}else{a.src=e}a.addEventListener("load",function(){a.parentNode.removeChild(a);this.removeEventListener("load",arguments.callee,false);n()},false);a.addEventListener("error",function(){a.parentNode.removeChild(a);n("Load "+e+" failed!")},false);r.body.appendChild(a)},_loadJs4Dependency:function(t,e,i,n){if(i>=e.length){if(n)n();return}var r=this;r._createScript(cc.path.join(t,e[i]),false,function(s){if(s)return n(s);r._loadJs4Dependency(t,e,i+1,n)})},_loadJsImg:function(){var t=document,e=t.getElementById("cocos2d_loadJsImg");if(!e){e=document.createElement("img");if(cc._loadingImage)e.src=cc._loadingImage;var i=t.getElementById(cc.game.config["id"]);i.style.backgroundColor="transparent";i.parentNode.appendChild(e);var n=getComputedStyle?getComputedStyle(i):i.currentStyle;if(!n)n={width:i.width,height:i.height};e.style.left=i.offsetLeft+(parseFloat(n.width)-e.width)/2+"px";e.style.top=i.offsetTop+(parseFloat(n.height)-e.height)/2+"px";e.style.position="absolute"}return e},loadTxt:function(t,e){if(!cc._isNodeJs){var i=this.getXMLHttpRequest(),n="load "+t+" failed!";i.open("GET",t,true);if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){i.setRequestHeader("Accept-Charset","utf-8");i.onreadystatechange=function(){if(i.readyState===4)i.status===200?e(null,i.responseText):e({status:i.status,errorMessage:n},null)}}else{if(i.overrideMimeType)i.overrideMimeType("text/plain; charset=utf-8");i.onload=function(){if(i.readyState===4)i.status===200?e(null,i.responseText):e({status:i.status,errorMessage:n},null)};i.onerror=function(){e({status:i.status,errorMessage:n},null)}}i.send(null)}else{var r=require("fs");r.readFile(t,function(t,i){t?e(t):e(null,i.toString())})}},_loadTxtSync:function(t){if(!cc._isNodeJs){var e=this.getXMLHttpRequest();e.open("GET",t,false);if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){e.setRequestHeader("Accept-Charset","utf-8")}else{if(e.overrideMimeType)e.overrideMimeType("text/plain; charset=utf-8")}e.send(null);if(!e.readyState===4||e.status!==200){return null}return e.responseText}else{var i=require("fs");return i.readFileSync(t).toString()}},loadCsb:function(t,e){var i=new XMLHttpRequest,n="load "+t+" failed!";i.open("GET",t,true);i.responseType="arraybuffer";i.onload=function(){var t=i.response;if(t){window.msg=t}if(i.readyState===4)i.status===200?e(null,i.response):e({status:i.status,errorMessage:n},null)};i.onerror=function(){e({status:i.status,errorMessage:n},null)};i.send(null)},loadJson:function(t,e){this.loadTxt(t,function(i,n){if(i){e(i)}else{try{var r=JSON.parse(n)}catch(s){throw new Error("parse json ["+t+"] failed : "+s);return}e(null,r)}})},_checkIsImageURL:function(t){var e=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t);return e!=null},loadImg:function(t,e,i){var n={isCrossOrigin:true};if(i!==undefined)n.isCrossOrigin=e.isCrossOrigin===null?n.isCrossOrigin:e.isCrossOrigin;else if(e!==undefined)i=e;var r=this.getRes(t);if(r){i&&i(null,r);return r}r=new Image;if(n.isCrossOrigin&&location.origin!=="file://")r.crossOrigin="Anonymous";var s=function(){this.removeEventListener("load",s,false);this.removeEventListener("error",o,false);cc.loader.cache[t]=r;if(i)i(null,r)};var a=this;var o=function(){this.removeEventListener("error",o,false);if(r.crossOrigin&&r.crossOrigin.toLowerCase()==="anonymous"){n.isCrossOrigin=false;a.release(t);cc.loader.loadImg(t,n,i)}else{typeof i==="function"&&i("load image failed")}};r.addEventListener("load",s);r.addEventListener("error",o);r.src=t;return r},_loadResIterator:function(t,i,n){var s=this,a=null;var o=t.type;if(o){o="."+o.toLowerCase();a=t.src?t.src:t.name+o}else{a=t;o=cc.path.extname(a)}var c=s.getRes(a);if(c)return n(null,c);var l=null;if(o){l=e[o.toLowerCase()]}if(!l){cc.error("loader for ["+o+"] not exists!");return n()}var h=a;if(!r.test(a)){var u=l.getBasePath?l.getBasePath():s.resPath;h=s.getUrl(u,a)}if(cc.game.config["noCache"]&&typeof h==="string"){if(s._noCacheRex.test(h))h+="&_t="+(new Date-0);else h+="?_t="+(new Date-0)}l.load(h,a,t,function(t,e){if(t){cc.log(t);s.cache[a]=null;delete s.cache[a];n({status:520,errorMessage:t},null)}else{s.cache[a]=e;n(null,e)}})},_noCacheRex:/\?/,getUrl:function(t,n){var r=this,s=cc.path;if(t!==undefined&&n===undefined){n=t;var a=s.extname(n);a=a?a.toLowerCase():"";var o=e[a];if(!o)t=r.resPath;else t=o.getBasePath?o.getBasePath():r.resPath}n=cc.path.join(t||"",n);if(n.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(i[n])return i[n];var c=s.extname(n)||"";n=i[n]=n.substring(0,n.length-c.length)+"_"+cc.sys.language+c}return n},load:function(t,e,i){var n=this;var r=arguments.length;if(r===0)throw new Error("arguments error!");if(r===3){if(typeof e==="function"){if(typeof i==="function")e={trigger:e,cb:i};else e={cb:e,cbTarget:i}}}else if(r===2){if(typeof e==="function")e={cb:e}}else if(r===1){e={}}if(!(t instanceof Array))t=[t];var s=new cc.AsyncPool(t,0,function(t,i,r,s){n._loadResIterator(t,i,function(t){var i=Array.prototype.slice.call(arguments,1);if(e.trigger)e.trigger.call(e.triggerTarget,i[0],s.size,s.finishedSize);r(t,i[0])})},e.cb,e.cbTarget);s.flow();return s},_handleAliases:function(t,e){var i=this;var r=[];for(var s in t){var a=t[s];n[s]=a;r.push(a)}this.load(r,e)},loadAliases:function(t,e){var i=this,n=i.getRes(t);if(!n){i.load(t,function(t,n){i._handleAliases(n[0]["filenames"],e)})}else i._handleAliases(n["filenames"],e)},register:function(t,i){if(!t||!i)return;var n=this;if(typeof t==="string")return e[t.trim().toLowerCase()]=i;for(var r=0,s=t.length;r<s;r++){e["."+t[r].trim().toLowerCase()]=i}},getRes:function(t){return this.cache[t]||this.cache[n[t]]},_getAliase:function(t){return n[t]},release:function(t){var e=this.cache;delete e[t];delete e[n[t]];delete n[t]},releaseAll:function(){var t=this.cache;for(var e in t)delete t[e];for(var e in n)delete n[e]}}}();cc.formatStr=function(){var t=arguments;var e=t.length;if(e<1)return"";var i=t[0];var n=true;if(typeof i==="object"){n=false}for(var r=1;r<e;++r){var s=t[r];if(n){while(true){var a=null;if(typeof s==="number"){a=i.match(/(%d)|(%s)/);if(a){i=i.replace(/(%d)|(%s)/,s);break}}a=i.match(/%s/);if(a)i=i.replace(/%s/,s);else i+="    "+s;break}}else i+="    "+s}return i};(function(){var t=document.createElement("canvas"),e=document.createElement("canvas");cc.create3DContext=function(t,e){var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"];var n=null;for(var r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(s){}if(n){break}}return n};var i=function(){cc.sys={};var i=cc.sys;i.LANGUAGE_ENGLISH="en";i.LANGUAGE_CHINESE="zh";i.LANGUAGE_FRENCH="fr";i.LANGUAGE_ITALIAN="it";i.LANGUAGE_GERMAN="de";i.LANGUAGE_SPANISH="es";i.LANGUAGE_DUTCH="du";i.LANGUAGE_RUSSIAN="ru";i.LANGUAGE_KOREAN="ko";i.LANGUAGE_JAPANESE="ja";i.LANGUAGE_HUNGARIAN="hu";i.LANGUAGE_PORTUGUESE="pt";i.LANGUAGE_ARABIC="ar";i.LANGUAGE_NORWEGIAN="no";i.LANGUAGE_POLISH="pl";i.LANGUAGE_UNKNOWN="unkonwn";i.OS_IOS="iOS";i.OS_ANDROID="Android";i.OS_WINDOWS="Windows";i.OS_MARMALADE="Marmalade";i.OS_LINUX="Linux";i.OS_BADA="Bada";i.OS_BLACKBERRY="Blackberry";i.OS_OSX="OS X";i.OS_WP8="WP8";i.OS_WINRT="WINRT";i.OS_UNKNOWN="Unknown";i.UNKNOWN=-1;i.WIN32=0;i.LINUX=1;i.MACOS=2;i.ANDROID=3;i.IPHONE=4;i.IPAD=5;i.BLACKBERRY=6;i.NACL=7;i.EMSCRIPTEN=8;i.TIZEN=9;i.WINRT=10;i.WP8=11;i.MOBILE_BROWSER=100;i.DESKTOP_BROWSER=101;i.BROWSER_TYPE_WECHAT="wechat";i.BROWSER_TYPE_ANDROID="androidbrowser";i.BROWSER_TYPE_IE="ie";i.BROWSER_TYPE_QQ="qqbrowser";i.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";i.BROWSER_TYPE_UC="ucbrowser";i.BROWSER_TYPE_360="360browser";i.BROWSER_TYPE_BAIDU_APP="baiduboxapp";i.BROWSER_TYPE_BAIDU="baidubrowser";i.BROWSER_TYPE_MAXTHON="maxthon";i.BROWSER_TYPE_OPERA="opera";i.BROWSER_TYPE_OUPENG="oupeng";i.BROWSER_TYPE_MIUI="miuibrowser";i.BROWSER_TYPE_FIREFOX="firefox";i.BROWSER_TYPE_SAFARI="safari";i.BROWSER_TYPE_CHROME="chrome";i.BROWSER_TYPE_LIEBAO="liebao";i.BROWSER_TYPE_QZONE="qzone";i.BROWSER_TYPE_SOUGOU="sogou";i.BROWSER_TYPE_UNKNOWN="unknown";i.isNative=false;var n=window,r=n.navigator,s=document,a=s.documentElement;var o=r.userAgent.toLowerCase();i.isMobile=o.indexOf("mobile")!==-1||o.indexOf("android")!==-1;i.platform=i.isMobile?i.MOBILE_BROWSER:i.DESKTOP_BROWSER;var c=r.language;c=c?c:r.browserLanguage;c=c?c.split("-")[0]:i.LANGUAGE_ENGLISH;i.language=c;var l=false,h=false,u="",d=0;var _=/android (\d+(?:\.\d+)+)/i.exec(o)||/android (\d+(?:\.\d+)+)/i.exec(r.platform);if(_){l=true;u=_[1]||"";d=parseInt(u)||0}_=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(o);if(_){h=true;u=_[2]||"";d=parseInt(u)||0}var f=i.OS_UNKNOWN;if(r.appVersion.indexOf("Win")!==-1)f=i.OS_WINDOWS;else if(h)f=i.OS_IOS;else if(r.appVersion.indexOf("Mac")!==-1)f=i.OS_OSX;else if(r.appVersion.indexOf("X11")!==-1&&r.appVersion.indexOf("Linux")===-1)f=i.OS_UNIX;else if(l)f=i.OS_ANDROID;else if(r.appVersion.indexOf("Linux")!==-1)f=i.OS_LINUX;i.os=f;i.osVersion=u;i.osMainVersion=d;i.browserType=i.BROWSER_TYPE_UNKNOWN;(function(){var t=/sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i;var e=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i;var n=t.exec(o);if(!n)n=e.exec(o);var r=n?n[0]:i.BROWSER_TYPE_UNKNOWN;if(r==="micromessenger")r=i.BROWSER_TYPE_WECHAT;else if(r==="safari"&&o.match(/android.*applewebkit/))r=i.BROWSER_TYPE_ANDROID;else if(r==="trident")r=i.BROWSER_TYPE_IE;else if(r==="360 aphone")r=i.BROWSER_TYPE_360;else if(r==="mxbrowser")r=i.BROWSER_TYPE_MAXTHON;else if(r==="opr")r=i.BROWSER_TYPE_OPERA;i.browserType=r})();i.browserVersion="";(function(){var t=/(micromessenger|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i;var e=/(msie |rv:|firefox|chrome|ucbrowser|qq|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i;var n=o.match(t);if(!n)n=o.match(e);i.browserVersion=n?n[4]:""})();var p=window.innerWidth||document.documentElement.clientWidth;var m=window.innerHeight||document.documentElement.clientHeight;var g=window.devicePixelRatio||1;i.windowPixelResolution={width:g*p,height:g*m};i._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};i._supportCanvasNewBlendModes=function(){var i=t;i.width=1;i.height=1;var n=i.getContext("2d");n.fillStyle="#000";n.fillRect(0,0,1,1);n.globalCompositeOperation="multiply";var r=e;r.width=1;r.height=1;var s=r.getContext("2d");s.fillStyle="#fff";s.fillRect(0,0,1,1);n.drawImage(r,0,0,1,1);return n.getImageData(0,0,1,1).data[0]===0}();if(cc.sys.isMobile){var v=document.createElement("style");v.type="text/css";document.body.appendChild(v);v.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;"+"-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var y=i.localStorage=n.localStorage;y.setItem("storage","");y.removeItem("storage");y=null}catch(T){var C=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};i.localStorage={getItem:C,setItem:C,removeItem:C,clear:C}}var S=!!t.getContext("2d");var x=false;var E=document.createElement("CANVAS");if(n.WebGLRenderingContext){try{var b=cc.create3DContext(E,{stencil:true,preserveDrawingBuffer:true});if(b){x=true}}catch(T){}}var A=i.capabilities={canvas:S,opengl:x};if(a["ontouchstart"]!==undefined||s["ontouchstart"]!==undefined||r.msPointerEnabled)A["touches"]=true;if(a["onmouseup"]!==undefined)A["mouse"]=true;if(a["onkeyup"]!==undefined)A["keyboard"]=true;if(n.DeviceMotionEvent||n.DeviceOrientationEvent)A["accelerometer"]=true;i.garbageCollect=function(){};i.dumpRoot=function(){};i.restartVM=function(){};i.cleanScript=function(t){};i.isObjectValid=function(t){if(t)return true;else return false};i.dump=function(){var t=this;var e="";e+="isMobile : "+t.isMobile+"\r\n";e+="language : "+t.language+"\r\n";e+="browserType : "+t.browserType+"\r\n";e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n";e+="os : "+t.os+"\r\n";e+="platform : "+t.platform+"\r\n";cc.log(e)};i.openURL=function(t){window.open(t)}};i();delete t;delete e;cc.log=cc.warn=cc.error=cc.assert=function(){};var n=null,r={},s=false,a=null;cc._engineLoaded=false;function o(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0,n=[cc.sys.OS_ANDROID],r=[];if(isNaN(i)||i>2||i<0)t[e.renderMode]=0;cc._renderType=cc.game.RENDER_TYPE_CANVAS;cc._supportRender=true;if(i===2||i===0&&n.indexOf(cc.sys.os)===-1&&r.indexOf(cc.sys.browserType)===-1){if(cc.sys.capabilities["opengl"]){cc._renderType=cc.game.RENDER_TYPE_WEBGL;cc._supportRender=true}else{cc._supportRender=false}}if(i===1||i===0&&!cc._supportRender){if(cc.sys.capabilities["canvas"]){cc._renderType=cc.game.RENDER_TYPE_CANVAS;cc._supportRender=true}else{cc._supportRender=false}}}function c(t,e,i){if(r[e])return null;i=i||"";var n=[];var s=t[e];if(!s)throw new Error("can not find module ["+e+"]");var a=cc.path;for(var o=0,l=s.length;o<l;o++){var h=s[o];if(r[h])continue;var u=a.extname(h);if(!u){var d=c(t,h,i);if(d)n=n.concat(d)}else if(u.toLowerCase()===".js")n.push(a.join(i,h));r[h]=1}return n}function l(t){if(cc._initDebugSetting)cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]);cc._engineLoaded=true;cc.log(cc.ENGINE_VERSION);if(a)a()}function h(t){var e=this;var i=cc.game.CONFIG_KEY,n=t[i.engineDir],r=cc.loader;if(cc.Class){l(t)}else{var s=cc.path.join(n,"moduleConfig.json");r.loadJson(s,function(e,i){if(e)throw new Error(e);var r=t["modules"]||[];var s=i["module"];var a=[];if(cc.sys.capabilities["opengl"]&&r.indexOf("base4webgl")<0)r.splice(0,0,"base4webgl");else if(r.indexOf("core")<0)r.splice(0,0,"core");for(var o=0,h=r.length;o<h;o++){var u=c(s,r[o],n);if(u)a=a.concat(u)}cc.loader.loadJsWithImg(a,function(e){if(e)throw e;l(t)})})}}function u(){this.removeEventListener("load",u,false);h(cc.game.config)}cc.initEngine=function(t,e){if(s){var i=a;a=function(){i&&i();e&&e()};return}a=e;if(!cc.game.config&&t){cc.game.config=t}else if(!cc.game.config){cc.game._loadConfig()}t=cc.game.config;o(t);document.body?h(t):cc._addEventListener(window,"load",u,false);s=true}})();cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:true,_prepareCalled:false,_prepared:false,_rendererInitialized:false,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;i[n.frameRate]=t;if(e._intervalId)window.cancelAnimationFrame(e._intervalId);e._paused=true;e._setAnimFrame();e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){if(this._paused)return;this._paused=true;cc.audioEngine&&cc.audioEngine._pausePlaying();if(this._intervalId)window.cancelAnimationFrame(this._intervalId);this._intervalId=0},resume:function(){if(!this._paused)return;this._paused=false;cc.audioEngine&&cc.audioEngine._resumePlaying();this._runMainLoop()},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0);cc.audioEngine&&cc.audioEngine.end();cc.game.onStart()},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;this._loadConfig();if(this._prepared){if(t)t();return}if(this._prepareCalled){return}if(cc._engineLoaded){this._prepareCalled=true;this._initRenderer(i[n.width],i[n.height]);cc.view=cc.EGLView._getInstance();cc.director=cc.Director._getInstance();if(cc.director.setOpenGLView)cc.director.setOpenGLView(cc.view);cc.winSize=cc.director.getWinSize();this._initEvents();this._setAnimFrame();this._runMainLoop();var r=i[n.jsList];if(r){cc.loader.loadJsWithImg(r,function(i){if(i)throw new Error(i);e._prepared=true;if(t)t()})}else{if(t)t()}return}cc.initEngine(this.config,function(){e.prepare(t)})},run:function(t,e){if(typeof t==="function"){cc.game.onStart=t}else{if(t){if(typeof t==="string"){if(!cc.game.config)this._loadConfig();cc.game.config[cc.game.CONFIG_KEY.id]=t}else{cc.game.config=t}}if(typeof e==="function"){cc.game.onStart=e}}this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date;this._frameTime=1e3/cc.game.config[cc.game.CONFIG_KEY.frameRate];if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||cc.game.config[cc.game.CONFIG_KEY.frameRate]!==60){window.requestAnimFrame=this._stTime;window.cancelAnimationFrame=this._ctTime}else{window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime;window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime}},_stTime:function(t){var e=(new Date).getTime();var i=Math.max(0,cc.game._frameTime-(e-cc.game._lastTime));var n=window.setTimeout(function(){t()},i);cc.game._lastTime=e+i;return n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t=this,e,i=t.config,n=t.CONFIG_KEY,r=cc.director;r.setDisplayStats(i[n.showFPS]);e=function(){if(!t._paused){r.mainLoop();if(t._intervalId)window.cancelAnimationFrame(t._intervalId);t._intervalId=window.requestAnimFrame(e)}};window.requestAnimFrame(e);t._paused=false},_loadConfig:function(){if(this.config){this._initConfig(this.config);return}if(document["ccConfig"]){this._initConfig(document["ccConfig"])}else{try{var t=document.getElementsByTagName("script");for(var e=0;e<t.length;e++){var i=t[e].getAttribute("cocos");if(i===""||i){break}}var n,r,s;if(e<t.length){n=t[e].src;if(n){s=/(.*)\//.exec(n)[0];cc.loader.resPath=s;n=cc.path.join(s,"/js/project.json")}r=cc.loader._loadTxtSync(n)}if(!r){r=cc.loader._loadTxtSync("/js/project.json")}var a=JSON.parse(r);this._initConfig(a||{})}catch(o){cc.log("Failed to read or parse /js/project.json");this._initConfig({})}}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];t[e.showFPS]=typeof t[e.showFPS]==="undefined"?true:t[e.showFPS];t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5";if(t[e.debugMode]==null)t[e.debugMode]=0;t[e.frameRate]=t[e.frameRate]||60;if(t[e.renderMode]==null)t[e.renderMode]=0;if(t[e.registerSystemEvent]==null)t[e.registerSystemEvent]=true;if(i&&i.indexOf("core")<0)i.splice(0,0,"core");i&&(t[e.modules]=i);this.config=t},_initRenderer:function(t,e){if(this._rendererInitialized)return;if(!cc._supportRender){throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode])}var i=this.config[cc.game.CONFIG_KEY.id],n=window,r=cc.$(i)||cc.$("#"+i),s,a,o;if(r.tagName==="CANVAS"){t=t||r.width;e=e||r.height;this.canvas=cc._canvas=s=r;this.container=cc.container=a=document.createElement("DIV");if(s.parentNode)s.parentNode.insertBefore(a,s)}else{if(r.tagName!=="DIV"){cc.log("Warning: target element is not a DIV or CANVAS")}t=t||r.clientWidth;e=e||r.clientHeight;this.canvas=cc._canvas=s=document.createElement("CANVAS");this.container=cc.container=a=document.createElement("DIV");r.appendChild(a)}a.setAttribute("id","Cocos2dGameContainer");a.appendChild(s);this.frame=a.parentNode===document.body?document.documentElement:a.parentNode;s.addClass("gameCanvas");s.setAttribute("width",t||480);s.setAttribute("height",e||320);s.setAttribute("tabindex",99);s.style.outline="none";o=a.style;o.width=(t||480)+"px";o.height=(e||320)+"px";o.margin="0 auto";o.position="relative";o.overflow="hidden";a.top="100%";if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(s,{stencil:true,preserveDrawingBuffer:true,antialias:!cc.sys.isMobile,alpha:true})}if(this._renderContext){cc.renderer=cc.rendererWebGL;n.gl=this._renderContext;cc.shaderCache._init();cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext);cc.textureCache._initializingRenderer()}else{cc.renderer=cc.rendererCanvas;this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(s.getContext("2d"));cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null}cc._gameDiv=a;cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return false};this.dispatchEvent(this.EVENT_RENDERER_INITED,true);this._rendererInitialized=true},_initEvents:function(){var t=window,e=this,i,n,r="undefined";this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE);this._eventHide.setUserData(this);this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW);this._eventShow.setUserData(this);if(this.config[this.CONFIG_KEY.registerSystemEvent])cc.inputManager.registerSystemEvent(this.canvas);if(!cc.isUndefined(document.hidden)){i="hidden";n="visibilitychange"}else if(!cc.isUndefined(document.mozHidden)){i="mozHidden";n="mozvisibilitychange"}else if(!cc.isUndefined(document.msHidden)){i="msHidden";n="msvisibilitychange"}else if(!cc.isUndefined(document.webkitHidden)){i="webkitHidden";n="webkitvisibilitychange"}var s=function(){if(cc.eventManager&&cc.game._eventHide)cc.eventManager.dispatchEvent(cc.game._eventHide)};var a=function(){if(cc.eventManager&&cc.game._eventShow)cc.eventManager.dispatchEvent(cc.game._eventShow)};if(i){document.addEventListener(n,function(){if(document[i])s();else a()},false)}else{t.addEventListener("blur",s,false);t.addEventListener("focus",a,false)}if(navigator.userAgent.indexOf("MicroMessenger")>-1){t.onfocus=function(){a()}}if("onpageshow"in window&&"onpagehide"in window){t.addEventListener("pagehide",s,false);t.addEventListener("pageshow",a,false)}cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.game.pause()});cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.game.resume()})}};Function.prototype.bind=Function.prototype.bind||function(t){if(!cc.isFunction(this)){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};n.prototype=this.prototype;r.prototype=new n;return r};cc._urlRegExp=new RegExp("^"+"(?:(?:https?|ftp)://)"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))"+"|"+"(?:localhost)"+")"+"(?::\\d{2,5})?"+"(?:/\\S*)?"+"$","i");cc.EventHelper=function(){};cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(t){t.addEventListener=cc.EventHelper.prototype.addEventListener;t.hasEventListener=cc.EventHelper.prototype.hasEventListener;t.removeEventListener=cc.EventHelper.prototype.removeEventListener;t.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,i){if(t==="load"&&this._textureLoaded){setTimeout(function(){e.call(i)},0);return}if(this._listeners===undefined)this._listeners={};var n=this._listeners;if(n[t]===undefined)n[t]=[];if(!this.hasEventListener(t,e,i))n[t].push({callback:e,eventTarget:i})},hasEventListener:function(t,e,i){if(this._listeners===undefined)return false;var n=this._listeners;if(n[t]!==undefined){for(var r=0,s=n.length;r<s;r++){var a=n[r];if(a.callback===e&&a.eventTarget===i)return true}}return false},removeEventListener:function(t,e){if(this._listeners===undefined)return;var i=this._listeners;var n=i[t];if(n!==undefined){for(var r=0;r<n.length;){var s=n[r];if(s.eventTarget===e)n.splice(r,1);else r++}}},dispatchEvent:function(t,e){if(this._listeners===undefined)return;if(e==null)e=true;var i=this._listeners;var n=i[t];if(n!==undefined){var r=[];var s=n.length;for(var a=0;a<s;a++){r[a]=n[a]}for(a=0;a<s;a++){r[a].callback.call(r[a].eventTarget,this)}if(e)n.length=0}}};cc.EventHelper.prototype.apply(cc.game);var cc=cc||{};cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7";
cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=";cc._loaderImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAE1CAMAAAAMOm73AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAMAUExURUxpcbv47Lv47Lv47AQAALv47Lz467z46Lz46rz46br367v47Lfz57r36wMBAAYDAAUBAQYDAAMBAAMBAQUBAAUCAI69tAQBALjz5vT3+ffbEgYDAHSbk+3XErTu4d3CFe7UEVl4cVd4b+no5fDWE+vVH2R/eJHBtyUiA8+7D+/XGUI8BHdsCLimDerVIbPCv6SUDO7YIO3ZJY6ACu3WHV9WCZ6tqvDXFtbe3IicmXOJhPDWFsXS0e/WFOXo59vhYxcaGc3roqGVE7anEdbDGWNdFXSGhDI1NIqyr////+lxLfLnD/jzgPHWEvfibulvLD7hwOtzLWiK5PHaEfv93ehtan00Iu9zLbLZ2+lsLulrJ/HeEPTuDelpL/fhbe+vavfxDe7u7vv4g/R2LvPrDvjmcfv8/P39h+dmIfnqdNSWRPDNFOt8KuyTJJ5KLulmL/fte/HiD+uHJ++3G/PUBPDCF4U8IvzgEmrQ5KlJL/v2DO2gIMHu8DK8joOBgu6rHppBLr5ZI5lJIrJWKP/pE5BALHYqH8phJ/zwcvLmBtVkJqRcL9prKuNtK45CH6hPIPjyh7JpLfPUZz03SOTMFVHkyOp6NC6lnbl+I3c3Gtnp7v398fXrWuiCP+2PP86aVjYwP8ugHDTeu9SxGMyLO/PDXbZ4QvLk0kM+UdymZ+lmYe6eSMKQHt+9XsGKUPGxUjnDmOfLZ8Pi5eeMW9irVWCM763n5Oe0giiakNzY1pnQ1m7p0fDhd6rW18+kkNvx/Pjp6be9to4UE+jKqnxtCZ3b8vXtPfHPxut4dN/RvsfLxfPoJ6J1GtG7q+L68uiafc12RIIHB55yUamRfrCnnMiRbeDBkjrPrDawoY7Dz/HdTe2xolIyHZOrtobY6WhOLdyyM5Ht2IdePJiXmlHKpujVefrznXmJz8vs1GDCwTSkdeBod5FXHiokNPvzv3XVwH2Jr060qXV0arywSn94NMZHRUJXPGFZZzqFW52TOY6r63a1r9bhj7V5ohgSIIe8iF2tye0AAABJdFJOUwAIDhFeCgUCAQMbFCAXWQMVClROLyIsRSb+/js6+zD67UY3/NoRVzpr3cV+oc4jpsGpk69JkZRhz31sd70033OPSH2rwW7HxtLHPYflAAAgAElEQVR42uzdzW4ayRYH8GAE5nOLaIlBFxw30iyC7mhEgBDumoVXFhISd+MNG+SFBay8YM0rWArbkfDOLXmXiKywRkr8ADyCX2Kq+rM+TlU3dsZ04zqZmUTZjNT+6X9OV3dXvXunKsSVoktdEFW/TpOg1HVS9ctRKVyq/i1TCpeqf1GVwqXqOaiO2VK2VL1E1bFvKVuqdnV1HLCULFUBVXF20mz5+VLXVNU7Gaq0TylaqnZ3RRFKeiW2pWipglyBqJLCAnUpW6rErgKoYnAJYktdYOWKY5UMWnJbCpdy9RxVAltqAUK5ouLqWaxgXGrpVLmiXQFoYmwFHLjUU583DUvKKiYtAa4AzxXV9X8zgQW5ivnW82kpW2/WFSUo4ZUfLr9leWXr7TRCnhVIii5fW+xTRYXrzQ1YrCt/VSyuZDBb6nbxLedVUFWsLvFjHz9c6kdysLB4Vw6bI/wvWxythEsrFiS4FK1DdgWxYlUhQ0fOf3heBLGYpC+mBc+sWWDqR3MQsABXtqqYm1VHPpXA/xC55QQXh8v6n/g8tVa0DiewIFduWJEVJ4vXBd4tqqfWbzqwQFdk94uLSjh3+Tz+kT9YVD+hA4DFB5bTBf1Z0bgSRzvklpJ1uLAEgcW0QQ9Qlq4dg0uIC7KlfkQHFVgSVllBAbbEweX3XFFl1mHBErvyUcXxImgFxqVoHWQnZFzRsGhWeb6A5CJzS2QrJpal+uFhwCIaoeeKV5WHVDm4bF5xFlcCWqMPYEvROgxYokZIunIqk89kzH9xQdHFD/MJZo1rJ1nqRxVBWEECi2CFJBUK6J9Chi6hrbhw+TQB0FKZdWiwuMACWJmoCoVSoVqwKpMDeWUluMBVCH9a6ocVcVhMXh3ZrqywQpSqZFm2cnB0iXAx07yAluqGhwVLkFc2K4yporfbLVRtXa9UqyVEK4eLyq4AXZHExdkiQkvJiiosWWCRrlAHxKpa9Wb3YtTraRfdTr2lm7RybvG4BLYS1PqpkvUWOiE9uLuuMKt2vdsjS2vW2zStDJlc+Yy9DpG3bWW52GJSS94O1U8syoEldtWun5ia1uu15trq1nVLVlGWW9wi11GcvVMMlFrqZxaxwGIaIdkHzZtBNF1VGiittM12+4hruxk5tJotLKuIi9AlXomIZzlcVEukaKnQOhRYbmB5rlBeIVd1lFKbR+N6MpuNZ5Nr43HjyDppVBxZpq6cTBczc8lp8esO0V+OfgNfJglhsYGFXOkdFFfbL5PpYnE+Hp8NF9O54crS6pVSregVGVzieZ59pijILKYbHoqmQ1YGrTUwrvL2fIVdjbZfpovxrWH0+33jdryYebJGjCzTFjh0QbkloxVlWW/2+AVhYCWcwd1avipVK8hVb23MFrd9tyaLyePazaxGtVYrl8tCW0RyUbb8ZKUjKSv1K+qgAitGBVbeHtwrDTypb5aLSf/JkzWbLt3I6l20ShgWolWmbJETF2yLXpV3afGyonLFUzsc7HGQp3v4dUJnwCpV2xfYzuZycUu46t8u5lv31rDX1E1ZRZNWmW2Lop7IpRYvKxmtyNqJ1GHuleIzursPcqxGaMEiXPWN85nXC9EAb0eWLUtki6HFyhJ0w4jISr3gXI+DOTmGuyeEAiuDA6tlLYduvixmJKz+eGp4sHpd3ZXl2SpLbYlpyWVFRpUYEHimx2HsOSDrhNTSqB1YvfXjbGiQvXA2Nf7yYI3qBCxLV61cKNcKNfMFG3qJC6Ylm7NCLsuHVDq909EegK7IBZZodHcCq1Btn9hytpeLOZlYk+nthnhw2CRh1awqmVUroT86vBhbLi120CJDixvgw81Kikp49oLfFnVRWmPxCayM2QkbzoPBtTGlIouB5d4YOqIqRFWrFjETF3Of6Njy+mG0ZAU5KybwAQwR383CvQgCV3G7ERKd0IqsCZFY88WShIV7Ya1sokKSdOu1rYZZ9utbFq9CwXtmzacWk1nsrWEIr7HQVXBVki3EoiUrFSiwLFi696bM+mFC3hje0rB6nQpueSVsqtWod5rdE81ejtC0k26zU28gXiYunFtUR2RluXMWu+gQumvsp+qZu+RHkxbsKuatubuBlfNGLPPGcDk8M0SJ1WvquOnprXqnq/XAMl8ObNu2iuysxc/wwAAfpkuckh1AJKbjt0u+34YWYV9sAZYaWFcYVuuCeLHvcU7M7/MhDavbrujtRuekJy2t22kgW2RsObTs20PmLS1BNwwXrGPfoxfAHaiDJ1foZaVoV/JGmEOwGgQs83nh8gke3nvdVkuYVYwt56Vma5CnQsvJrMQRM2exmRVGVoKwsvafk+2RDxmL1H4WqZQgsGJUYGWtj1FzhYJ3U2jWdjkcw+tY+EXlk17Qumg2bFpsaMWz3L1hKGXt5CpQ7UAr5K6ORYFlN0I+scxmOPFgrXvPLg3TKjGpxY/wsXA2Q2C6SssPXkgIt552tgMGfUVjP4uArtwJCydWi4KFmuH46hZ6pPMsWhWvH+YAWQyt8MDa1dUOG5mzbTESslhXaeHTZ8tVrohgMf1tu5ye2bDGjy+ChWm1Kt5HPvTNIdwMwwdL5ComZHXk7uwa6ASGKGxnAQdWkn7T3YGVM2GVdPqLr97ocX5lNkPjbPZSWGjWquv2C/OgLG7RIRSPDIPEFaTK2YyO+kBJsJ1FTBBaYZSV8g8swpWdWKVKk7GA7gyH+MUs/NqM9lJYvVG3VUGTFtEO3ZtDQBb9MDokFxJYYoBVHSWgXfJ33CklhLL4QyhEa1iuq2KhVq2PGAub5fmZ8dQ3hpNfAAs/CjJDC4YVxmYYlBVlSnTwwg47pYQ1tASuJBMWglWslZjpHY9Z18NZ/8mg3iB9STXbjqyMUBZ4YxievJKwSsBBRYdWwmc3Czi0ouCKW2uwXCFYXC/srR9mV/On28X8YbP+JbJOWkxmMQO86MYwLHnFsUowaSXZ0Jw+NYY4NwaiFcLMEh3GFINeSPYCq1iulRpcw/vLGJ9PJldns0tjIwut0WikadpPTUN/kIabZn3zSmVWHJKV3rcsKK/Eroioih+Jt8ePk9ElSq2QbpQiOo0pJhjdbVcYFhRZkyH+cHVIflzIodJu7nANBgP8283NT02Cq052Q64Zhiay5HnFnWrFx5R4j3x+3IrEbhaCRshNWHlydMcvrSNZLY1dcbgejudLo29M/j+HB3jt5w0S9dUs5/evA5kt/M1rQTrAA891QpD7rCuGlRNUWclm5vF4Ft5wQLIHT1hkSQKL/oIiT43uSFYZyaozt4Vfhui2EFf/bAytvqOsGpii6MJ/c3dzoUkyi1rOki457OOySl0Rm7cy/Y9Alfc7f4HdKSWWCLWsXRuhG1jmq8YlnW6G2/mV9YXhE/hYZ4RZDeDC3O5uNLksb4KH7gz3F1my6Qo8LI3bHz8L7JDP7thq06KHraT4M8swPDM9Bg43AT75Ihph0ZLVppbftxP73fcnY8ivvo/ErJzcgmmNGlV7pZSABWQWKSskrsznNwkalt0Es3F2h/wM+wdPFtUSE+GXJRywkvy2RRlqdLe/uSm1umBi3S6uubWsGykryxaiNYLuDQlZ9MtZzAB/vAdZqVSQs9Kgwzw8UmBRO9NB21nEQitLdEn8JqyyJ6vdJGes87MlHrGW58wrWVjHIEghWhq0nmXLko9Z+4mslCT2A7Byds/kXcEbPElohefT8JT4NCZoDYsNLPxFV0mvexK2l4vz+XI5P19csoE1uhsMAtK6Adbg9ap4gCcXs14fljiwYuBZHiSrjLzy7E7T/EYpId10QOBK8FqDd0tYJL9ALbXc0Fo/Xk4XV1eL6SU3Yd0MBsFl8e2wgwZ4an6nm2Fyb5Eld8XHFX2Wh1M5oMDjF+LMR5Y+n4an9h9YaWFg8bCoD+bx94KNpk1hvTUu59eXxpZ1pd19HQSvu5F0zMoAy6QxYsraByxwwOJcAWGVgysDbR7m92V4WD7glU9YwCcUXCt0abXqzRPcEkfrzXa7WY+4lYbBTsUPWidtajXLXXIQRtaeXQmPtKJYEZKsXcPMX/B+rcBOKZLM2qsscWDF2J1shYHlfDpf0Z2lB+jpnySw7r8/fr/nVh74zOKaoUDW60aWrysmrkhWpKoCW4Atuh+KZYVizIKP+UqwX9Vn4BGr5lZJ1xuSl7DEgXU/eFg9DO65QYubs6zVrBy95iC4MXy1Kyq5+yHGCRkri1TJrgr6ZVWhUACO9siD3+9KZe0DVTpt/W9T4DFf8gnL9mTtG6OjanclbzNIJqxvq9XqB4Z1/+PhG/H33L1hVycXs7jI2ossZqXBx1WWY+Wgqpo7pOh2mbullNztLGR7DoRMVur09PTDnx8/ffr4+fPpadpCJjgsgHuvoehsG1PR3UuBqtN7Dqz7H6tVf/XN/FN/1f+buDfUoEc71AK8F1kxaC0rbK5YVhaqqr1RSqNe73SaqDqdurmbhV6xvwv3CS3RZ5av3gyTp58//vH7+/+c4Zr+9v6/n/78cIouUlK8HxYxuhfsbWPci9FsWldD9jayZMR6WPX7q4e/73Fy9QlYA37MumgLnuwAz6Jf54r6HMoOu8plPFZYVbtRb3Ifio+6TaTLtVWkd3fiYTGy9hBZp58//f7bGV3T93/870PKphUTflZvDgSWKmSq07wI/Cboz4E4sPoI1ur7vemq/106ZnUqTDOEI+vVYMmXl6nbn2yeeO/IvJCmqja6m76QbTnQaFcq3hl9/zB3fiFtZXkcjxY1tg7sU6mlLalNXciDEhG1ahXZfZlsk2u8SntviNAB04bkYvOPQbIYl2WhsDtQhCrUtQ+C+xBZZMo2dKZUUCiIwzA4W6gr9KHIik8u8xAW2pf9nXPPvTnn3HOjVk33By1qbaI3n3x/39/v/O45DfxGKcIteD7L0OPNNpdfEOm0p78FxEyUCam7VPHVQG+xvqMNtdt590LhJ4QT5ELMFZ0KAaxV/s78RoFkfU6TJQZLeAIfwxXBqvlGa9+Bl66vF3QLy5Y9WdV2klXnNL1P3enKVafbbxMIresO0x4IMqF5MGHfkWfXnwjmGgoFcOw/Gvs96HytM9/xr1U+QbQ2/ZoqDMtJViXerIdoA1azaZBWq+6O3sPdyxTpwrvwnLeiZbFZnH/XMxTy0m3eNjDU2PKcilx5TY7kkBmyiZa3xWHXdSdYdZs99iPdyGUZbEBUbWysrOtA2YD1auc7vktKFYa4/86uGFoky1kpsOrLHEV7jhm/bTCw6jrCBexr1dFi9+Apb+DRT1h/s9PruZw2XnSXx9tz8xQuhClXQJU/lknlIFKZmJxIELbSngFHfU0VZTvPmXvZis67PDRYjHfHUrW6sg5U5UfWIcyNtfI/sfjtvOHf0x3oaJ4Gu4Wd2spKlrPM0dnVNfQFpNwVupJXmzuOeiH7qJNFz9ptwUORBb/59fYer8ef5jKTu639hC9DfQ9xV3LCn8pq8aBPUhTJF09quYxM0Eq7Oh11iCz+FIrzx8CKKQoRVT+uIKnKY6zyxWIxb4K1wjZK303yktWF7fsB/r1SkiW+eZwXfAYsJFfgJrrs7jOZM8KaF/o6mpt4p2XnsyAJQo3mslBF0DpR1aptu2xglUsGlXAYqIKAD8JKXEvBl3Wy+oEsviZEcnX0N5kArEJhA6Qqj6EaGVkfKRbX1jbX8oZm4bYDA9Yqd4Ebb+DTxCy9LH5IuRJgOQ864djq2rFcdfcK6kCE1DATFrrITin8FjxnrANEqEZzp/224e48Sa70xwyFUkklDEpFhRQO+5IZ4rUu9zjqq2tqKK6wXN3o+vLTo1H37oDVCuotEIVaz09toiiBxZP1bnKHfw1a9WPqmIWdz+SyhLuoWHw7bduBq6tXBW9QnimaLsZitrKi9YVFsxBZTkcLg5UcSiArnUgkQqbZ8p6YaPUQrmKaL6z4LKGEg1l/SO+Y9juqaMHCXLVeOwZXpI1V0MXKgGg9v4aoWtucGqFcFrNsuDO5wz9vn00urLxkiTfWFBzsWGoyoDRoKQXtqbKyFenqbmJvLLHeDUd5aQyVHEvlspqmZbOpmGxWau4TcVq17aR7FYolFQFWGC1Fi+lkuQYc9DsOuOruOt5eDHd1rkZKVAFXRUiCKDYn1qk94hmbtTNpMVkkF7JTyoJe1qn3nctsz2OdvNXzIKTBG7xcHUAVYYsSrQ7rpgNMMnS0eM3+N9RomWwy7gPHgwL8dC5moHUC6bAF2Tj9iTLxsOSzCSkcJ2R5WpwlsBBXfV8eL5BiFZ7R/IBI6XkQggVrpJQMX01OTm5YtqAxTJZAsth5v0qBVca5U3qF0yC/Wd2hsGLRQsch8/NDph2ornK0m3IV8qe0uISdtP4CI77iJDFBOjwmWS1tLoNg4ErxlQkgC+Oc9p5xGpcGcXX3mFyhxnthtTiRZ9ACwZqampiYWisyX86vUBbLqlj4ZB6aLHuw6ioMVlWVzUT3WdNeNX4aVgxakd7mS9bJNJ2sqrp+Y2ElJKeSkiIJ5CMl89nQWX8dR0vLTRT6J3Vlr10tnW9j5bmCdJgkZPU7asi1aWpqPq5eoRu/ChtTjEuHKBZHUK+hmGeOpAPJMsf+hGChU+pYsERL0RUCq87uXEd+QBJx1cxuKHYkrBi0epGFF9msqnqDKxlKfxvTo0hZv46W+6azrhaNufR43Xq4LkO48Icebxtu1V+vrRdcwut0q13W2GeSSNCapckkGTrgAsFPSx+Zw2wWcwTTFYk8KRR+Bq7ApjPZELv3TU6xKJe1IwKrZLIE0zM1FZOs8nviWxMh4optLwwfOcz2g5isM1W1/aSlBGoFlb6t59EIWZ720piLOFweDx5+qeWWcDwGVTLUBhrbY1BUKTgzE5RUWi+VnG6zepAYQnH4q6Zu3hXs7+8+gNjd3d0fnivPV6TxyZ1nzz58ePX7f+L6b5NmCHG1VixOsF8tFYaFVeDKUhXiE1svXLArDEWS5TxVwarndmwV3oFi4eoTsKJFC7IhtwUPPGNNfX+MyFVWCpf1PAZZhwyXh4XL8HGyjGycQj+XpPqeLi1OT08vLi7N+1QTLSmYwWRddru9bf0DnGDNDe9uozVFEn7/9qP9Ofvu1ZPXH4ZwvL7zp01rATiBcuP6epFLkaZ9R4K1aiE30qubLFayqoWSVVGwLKv3pWkjVA92HMTVtT0jrl07mCxSG1KjDtWOdlealP7jUnnPA5npSGTh1lcPWcOub3eRHOhPJZVxhcFKeroYiEajY2Pw1+jiU1U1JUsLmWvS6bT7t7/5977x2wzvj/oxTtRERNq/vTts020nVCGw3qDWAuTCNUawMFDr4OJ5+14wakJLUVhy7wdMklYQrNoDTofBBqsjUo6rvb33//lla/YFjtmtXz5+v2eHFjVNy/p3x4Db5Mp3UISzIYosSGjglNA8gj6bIKOPZCt77rb2Fqejk+TbUEYLswRL6szyWHRsdHQ0EIA/Yw8Dy0GDLMmXCZUe6eLXX6fTPwT24dcBsWKpMuH64dGwYJ6hhBWAhTMhXr2hwDL0ywYsZN0t4w26e79izYUcWKe984zodJiaKvGOrYgrer/WCE9V4eXjwYW3L5iY/fhqr5xo4VtLSms752ocFzwGV3walFQ9KDstKbkEYQrz5I/FYhkz4JMY+acQh5enp5O0ROVckBNGSZ2ffjgGUBkxOvZwccZIhyBZMo9OevsRwoohXC6HVuTO0JAFrE16WRAp1gQBjE2FRsMBZcI3gk7Hte5LV3jJsjZJT5ks0fl7vMMyOw2XrtKdQI6rvfePFyAGObAgtj6K0YqUtrPQyTpXA0/f4LXhCrAKzszPz8/M+NSS51F8qQSacpHxmEtWSybj8SCOOEQymdS0LJ59wQNW1rwZimmW8gBxFaC40skyNEuJx36nkyozbKWpQS4MFkUzoLXLcPWa4Wro+58xV2tsBThRxBjxgkXc+6pNJiQnAQsXDCtXF9rVhCLBQus4dlztvRwEqFAsbL2Y1YNiS4zWnLmdRcPZM6CTZy4M9LcRvfLzXKnq/DIy02Cnl5fm1ftSqWmZ8GcQUnEpHA6Ph9E0AoowmksYh4DPg/Ek8JWK+Xm4UL7luxnqzOKDABdA1rLZn9VSKaSGePGSE0I0yIUAR4FwDpmTXP4Hc3Z6NTT0CoHFKZa5sgPGSwTWO2FNiMDq+D8Ci2uO8lydJQbLhqsSVhBvZ6kwEuLgyz1bsnqbzn/RcGWgH6BykTe+LGvs0kpQlZamo0aMBRbn76tGMkzmNMyUothYfTz7Mg54JTWAS06U2BLVB5K6HB0btZIVfaqaHTQf6KGBKvVwMll6QkjDz+OLJ7MpP1kyT6f/aqbDZxxXQo+Fl3UQRkUeNjzigK37akS4kTIFVsNnyoUlsEQ3j5vDMiQRUgmd5uM9hRWSrNlZnq23CwuP39tlw8Ybzf1ej8tFpZNQju2K3lb/shyNIieNIjB2697YklmoKWh2yndwILwQXJgt0s8Q1AfqzHTUwhU8NSRDyXggnRyshNkUyFLImLjR4sq4MXODR7mCyZxfVy0wYoSsxg88WB8EVWEJL17EMFhIsCa/E5abrQgs+45DJSTLKQBLcIiH3mmgEyEtV49prHjJwmhtwTcsLIhEC5WW+9+602mmoEpkgkwivP3NH/4BMlV6kaO37n21KJUKtUMHerF9cWALsYB00aJtqroUDYgCSZZkVUIFPxxkQDkR04Jhbg0bvkNK5mQiWjpZEYtgDT1/Z/SxRg4RCCwsWDt3Dwarwbb7fppbGpUHi21h0Z2GOUauBrmwkPUWK9nCYytZc/sPtv0XLzI2RU5wL/ht38TfAvSrDWDd+ureonQEopj5l7AvmQUWEjk2eSr3VSno++bvD0dFYI1Gl0VPKOkPl0kkUnGhcAJaWoyI1vacULCGnj//r7XzXhYsLFgbETuwSC68UA6s2gqAxR07RGVCSrD6hFwtWLgCsphsuPXWSJKDBR6rR0zvR9bLO38qSL9CweAf//ztwwAH1q1b9xbVTyMLsaXEtVgmSP9/6X7wf8SdbWhTWRrHxw66zuh8LTqolHVU8MOWlWXWEWddYVhIqElurNTcYW4xcNukU93LWqHFGB2KWBzFeiFZiEkKF2NpS5tGm3S00W5XZKcVuwtV+wIKRdvsTkEL+2FhbHHPuee+33NubrXtPGIhpqYRf/yf//NyTpLpFAiexSqWK8hTbuLLUadPOxVM3XQABu2T0ao/iYxYgwsPFkAr/HfTrNACrLsvSNYd7Y3s2qXPhRsM+36rApZJsDDDHCBY6ugZy5Ug/UYPNGj1quQJHq3RulY5G49PHW5Qq/RD356E1V29/j+w6sL5Hr2dRmBV+NO0810Dbt7Ua38MrA5cLAwXIVgmQd7V8rk1WNHRrnQ63ZWMyj7wG+dZyeLPOhwxLw6sbOF/mJoQD9Y/j06K1n0zCSxIlrw8Yz5UoQdrRciylQnRB9FqBEtBo33AJFcKZ+O9EzB6x/XPTmvkio2DmJI2CxBTTp9xn8BJXW463xZkzYoFIvnuZEGLpO8xkJGSyUraUUiaTqbQ++NA8SqJqs93VmpMvMKDBdEKd3Z22gTr58I8SbAcju37P98H0SoldN9XwWQZwEI1YYk+E24kC9a04MHplfKHgilPasiajU/FEVmAqrNwP9SHNU1VF0+QwPIzlNu5LEEn+aCrWAS7bPw0QGiFX3p7FX4uLZUYkCwxGT68hk2FIlqFxbkjNtjqvHcn6/XOD5HPCdccK4dolRY5VLHiYJktlj4T6gSrxsiVYNArjOnSfofk4Fvjcmw9eZwi9qBgJgRg6dWE4STF8qcDxuUpNeT5j5t2F7P5dMIGVy7g3m0Q6qqt0IQ/5aTlEQFauOFqSGAB0fIWFhfnirHVeQ+9wlGrE+hw93uX5oZucl24AmCp3n0dGSxk3dWlUUWwjprynxVP8jeJtSEoBuNxSAgTj/Npp+VuDAXAuuHSgsW4ZLAquERAZQhOetzA61PRaDSRSCaTXVIko27aii2aStngysWmi1YLdCKo4wqQxUuaJe81f1oZ85JDZGvuSKdFVuz88VlWan8NWi17aT9i5xNsK2vFcqHZYqk1ocG67zVx9e+IVp8ErVwJGq+l8/Til4H2SmCvWBR8dX910hmNUmSwQCr8nm/RzYQ1gkADjBIiQ8Avw5oORD6f57iK1taKICs26lk+laQsoKC7ivorBBblpi0J9UUZA1eiqqK/8We0PdbAEXOhytb84tzcEUJa7PyxkJUbq7FiZOGvUV7pG43sgIUEa992o3Nvf11UpwQB47JATN9ekGOmH0R1AkgMCS131aUT58+1GfqjSnAQI45r9ftrpfDX+mHAJ1m1uRlMJZ0ktGhnKsjYAIth+XRXgqJp0gu56ZSJK+C0kgFpEnTqMGpmxbzeImhBuGBWPNJp0q7OzkVvVvlWS7KkzRFcXbiyNxoZVmYsMqFi3RXBuit4xlHn0yOYa0KZqcjAgMmIeSKvJyfvoBgC8ehpRwKhRWntkpLeLjefO3c1E8RlQtjNqpUoMoeGFsYF0IrigaAC13l7YHG1tRVsqitJEi46iXsbfp5WJAsVhjU/e4sGhAu4+UVJutSYWyxkNd9nlQ3FG/5szgtXESzNmHCnKRPCRDj+wwQJKcETiQxM50KjNTkzdpHGO+jzHRFck3cmH489uQW48vl8mpUryJqY5PpAZPCCZRWcQW44Pokli7pYF7STCRmXiEmtP8inoWszCZfbzeMQ93OSZLmdSLI4x7GC11ZA5QLSBROjHACrrG7MaOXgy39dWko4rbNu1cEyWSxQE5oyYbtYEY6PmzOfAFUKIiX9g6eNuTASiUzHYujDacXPEoVsTT57NvYE+m3Jcot+CbglhgFZrAUEi3NY1mFcUWCCPK7vRfm+a2tx2QFLBhqwxfEpsf+pY4tOcljFqpBr129Oo1xY47hpkyxJuWBiROEjgEcAACAASURBVOHVYwXJsjivAa/LstxQXlmw1G4DyWLJNeG1ylezs7Otra0LEZzDkpHS/FNrBgRj5Qi0LHQsdiwmBaDrLiALxNACL+4usEE1UCecYQiJ0CLM2Y0JMgkzWdSl5j5bYLm0sICk6DIKF53C52S/PHvy/QW1siod14a8We8SIquE+bmb+r47CPXRFziwSla84WBqjxIyITyJAplixZbmFIi3Zq6EgdDoqPkjXgYEXemoSpY2IFui5eJalKGKtCJjykdWXGmfczEYzeGjtDkTNtkCy5iB/SgpQjcfEMGhoywBLF7aPkW5sAHOdbY/LiyJLIvQJsPNoQcgcoM1yt0zBpNFrgtXHaxNpaU79wKmHh6CR07EdvlU90t52gxCyofCNHZwZZY2AFYkt10KBa2cmBGH8kwxA13cWxEEC/U4TTaLumALLGwGhkkRCVcgQAe6CG/Ir+DsE09vNwQdjr919MxnlwktdT958EEjigej0ikoUsNh7S8JlsjVhpLSfV9tRWflDklDmKm3CJEJaaldUizsOqOuo6WANTDcrgSkaxCghcgq4p85HEacQazgQ5bBD5KTAXMD9nqQLVYVMiSiYU3KMal0kgoQMmGFP3+J1pssh+N+XV3dC+/ykDUv7/uFGpV4PigdBSu1M4heDbB0g8KNG9ZsOvBV2afyaosEVjfKhBPKcQnUUsfVJ6OYRhYka+j+/eHhf0hoVVZCx4XIWmDscYWBSROtpP4Ba9q1oS6cu1G83WBZMkC4QFZ0EZ6unflXgNKc0AdgXeu/Dsh6UlgW0ZqXzuoMNmri+WYZLOxSlvnWyBUHa63Gu6/5+MDuMs0eHhruTf33pVgTqoclUDYcxYKlqpWgAev1vadP70O4httvt4vnXGOxu6JkMUvRK6LFIkkQyxv9O3XxhI1cWCwF+4ndNABW5qoCFtr3A5kQglXXtiyiVUCHdWoeaMFqDCmKtaHkQ/0lwtibslZHsUSuStYc1Fwqe/jrrx/G4zyfSaXHepFgKTvt4mMhRATLOE8EZN3rf/oUsjU8MiKC9Wo7lCyYC5l3EQ0DXBzxVVxdAWNV2HTiBlNEshjWZi2Kha67+bJBsSSwgGgtg9MqhMXLk0efN5okC3isjR8fLN9WssHg3s2fU7GSYK3VgbVm056yBu2xprPpVDWIjlthBJZ6WmKC6N5DAm5bK+KJPO6QyBoZQfsOClgkkxPEFn/oAVe010CcJFOXm6FksUsqCZcSbLDvih4sRkqFYoy9N1rSalaoUR9w+QFUhdv253K58k0lepP1i4AlWqySNQc+U7H69uTxeqevWoyOtp/ErdAJ9RzOX8WewgDmIx5DpE2atx39/RCtR0MSWDEE1gLDYLHCSgZJRjjWPliwLGxq7m5ZIcHiWBfbdsVJac07g8y7gham7bk0sMRcaATr2UiN44vSXftDMPZDsvAm633AWv+rj9bBe3fgZWS/+XIHeDXxhSzAWrtxj7qJfup0PbybOiqB1fPTGR1Y6BgOcO814mVPm0dD0yGZsJxgWpxB8aYNkSWDBTzWUZJ5Z8zuirOEzCITmsGqutQsksValIRawYJ3FNnmDLwTlrlxRRqDom0/2MhSciFKiC8K75MJ8WCFXxz7w5bS8lAoB36Fyj/5cFnBWg9vJPvy93t+uxveQgYvIyvbKl5GJt3nQwBr/cHd8i764ZPHneKhJncCcdUxdubMuF6xelGCGx0N5abhBQ5qVswJ2M1lj+flEwUsyNVoDJn3IYxld+n0grNh360cU5ep3wAlq6mpjSFODGV3x+VnMpluFJnMTJ6zw5UrmPm+uUruY6Flv0OvHO0dddoYm58HbGXfUbDEk6uDRrDCI59vKUWClQvt3bZWt0b6fmChW+7KtuIvi9rzux0ffbAeB5Z84wtMgsfd0lk5CFZ/dT8Aq1cES1AVa1y2TmhaKKg+flogLQJCsIDHejRyuxK1G3JwsjPD6JlysUGSPHDktoNFJsT13p3fnQBkXe3j8YcpkF5y+QykaWYmn8+DrwiwTBG44Bth+Z4LVejAjrv+lHIObLhNw1UPPBwRni94s0tOivPyHQ4G8/6fcPhPO4HDkhVrS8lygQWo2lNmeVdUw2cHdnzwgXlUKHMFLySrV8+g3wJYgXj8BoGlnB+UBMujHIgWPHqwPB7jWAdAOAbdO6gKb7e3i3p1E46jFzSbnCyRKa6oryGBxZoFCyZDdzMkq6n5el+GZ/DOnQNEtc7OzkpbX3Bkmp/p7u7r5rli80q2he+S9gyVi5dbHZsf9xi4Cod7noyJwrUEugph5TajnA6sN+HwH3fu+j9pZxvTZJbF8ToTEUf5MibGssugotkJH5yMmd3ZrDsrftjZxW2tDQnVMZTwkNJQBCsCmY2AvAQx8iISYUUGGodHSIPFFhsIUBwbJEamsBPLizXBjCmuMiEqyBfjJO49997nrTwtD8OJkRcpFvvzf84999z/3fFZMYmvP929RW5ZyDeylKZARNWeVV3ICgoSv9ikCgHrw+itiZSrwlze5k7f3HwbsJqeDczPOQlKzhUHvLjxY76lNSQ/vNzU1OSHTtYD6MDDvg5KooirMYZUMGsqY2TAMkp1j36ISD0iP11sOFxegdH6d+VlNvRcIU2EDTBEyNASy4r3oRFczzBajDzy/OAOHgYj5Xs+GSNFyXCs9GGPDUVPj59yVWqx5FpsU/6gYul6jvWKuhmpn0i5+geA9cmfMVf/TErCZIXZ1FEK1uavDiRKXVBSqBEZ57HDX5W288solRSsDRv2F1CnxsO8XMEAMOQubyAwPMyBdRTOeEkPeNHdnVCwVrbemybvIK6g7z4g4qqhQSk7IS+kNfQFpaPP/JgEzN54XN1hhj8NhouXKvKArbLLIW14unBgzAzOhm43SIzbjbMgsAVoeTSM3NPjhdOIRIsjK5eeqUhWe0tL/aU8VKWTk36iX7kWi2115cLDNPSh1BxElAwRV0sYrK2H/nqsb/jrJBTb1g3WvgN7tNKL97AjWQ7nRkY+S++z0h6MUonA2ogSIW5fpWhzBYcffDwhfdo7ODjce613bk6OJjFYan5qRvo1MzOPFmdmYLNwaHJ8HHOF96AVcWXlfsluB4tCw4/cGGEE3uXCvzl6OmvDD75n6qsrK1DkhYBFNgkZhrG63BaWtdhsdhQ2G7wPWkXQcmkYOeEUfZ8LN8jxbp0OF/AFP75szfCWiiKYoBaVXbxyRZpdfk0fOst5OAy8E7hCZCXB0HvMH/7+xyQc22LWB1b0V4liqlKoI9lJLsCNDBx4uHtDCg5ERYsUa/MWbH2WkpIrVFeYq9t3hgErVA29mpubi3AWR7QozGoSQzfz6D/QrV9cnB8aGvKOd9E0iBsNo8O/RuSKoWE2yzJntdKaGi/b3G6cYjoh4E1NXk1eVUtqeaTzrfpMQ93F8spLl11isIzEJ0LjcVhYi316pKvrLlxqdrera2TajthyAVoNLrfDykScNESaRdXyOEmG2sffZXvePFxeXlpaImVSa3JyvyUkyGJRNI7Fzf29Ll1aprHkH+CstzKCpe9QUOCCXjC127H9Y8JV0u/Wp1jRkuscC88Rw6ZTp9L4wG5kYJJCXVDivsTJkCqWinhhnziXJuKqDXE1OTh4jIy4ILCcYeUKPuoTpmbEjg6IqkeLEPPzQ0/H7nNY9eJBv1/NEYPsxSF+rLLbvEAPiry8qqqqoqKi1NTUoqq8ms4emxs461loOV9/qTZTH/nwliEz01AtAQtzZdY0ulnWPtIVYoDc2jVtA7RQQnwmQ5a0mQazYESywIOQmgDmXPfdg1hefvvz4+9M/3sWCtZDvFh8jaSLaBd68/x50O9/eE8IX/zjxybqoDsm1sDJrL/95fcoGe4iXH26fUvY+QYFYO09EMcb4uecA5PpU2kyp0HBgUd/li5R9uxT8XuFmz/AFdaJQt6YQ4+5mvIGBnuvCWDNhE+Fom6DWuIU8ugRoWr+VWC4d4BihbiC6dGpTpvDJW4TkXftJPFgAaIS5FmpWWZrzfnzLShSgaj6igVAyuFqPIJLKxSN7rZvMg0KjkTrq8WpELhiGI+btUx3ydpq3x2xs5ZGEC3HCrJCm2ncQerj+XyFG6uNv34TxfWOK2Qu6WeLuAkhrBZRBp7y+6dwwFdcFbC6jh+q/dH0Ev69veLcSu7F3Lp9G+ZKuiqULgtX34XmrlqAW0Kx0V0ES7K0tPxC8p9n/8ZoCtYH1Fz2hOAkhM9/3pkN4DT4ww/XMq4BWE6Zo/Xfc+mQB2uCL9ePYqrmIV4NHuvt7R3ghkcHBwOzk3d6qqryIMrKyqrKysi7VUR+QH9SU8/jQH9ml0mGZnc5iurq2jYLKqtdjUZCFLQ88bTzhQvGbmXeNGKwgCuz1cGy011hx8rvjlhYB6riGxyukOcU0v03Zt8gTl7H9SLf5VgtXKJBnZwKtDkSvZoq5cEKCR6sm/HaWM74+whCSz0W5Lga4E+Abd+17eNd27dEGJxZFSyOK7jOcYULWPj7rHZ+ouIUS3UI7l4WXSsDgoXS4GgfggoiI2EMwCqZCZsKRd2GCX4VOMdTNXyMHKTgZ5ID4/12e2c94aeIJwm9rYeAkvoSRGVlZTnCrVMjI1mm9vZbt240mqxQxl+Awp0gJRz/UnCOOUSxoG43eyysvSvi/RJddtbtQenQ0Ri+dKe5UEeSxdl/ia1xY8WG4h2+qxZQLZAldhmqr1lvcOltKFg4g/pudsTHxYp6R1pTa3LWgDcYDE56xxJExynIoF/Mb1cs/prQnLN6JfaJOq6tcnDDJgLWBtVBLFhndKJGw3+PjY4WE6zUrRkDXhCsEufRMIcKxd2GYtJaQEGoImKForiXH3X3Tvenp/ffrr2IovZiLQR+F0UdCR3ZeTHoDZnVSM0cZrkWg5UW+Li4Mco58nV/owgsIy26jUesDONiLSOtq9yF0zrNWjyMucFljThgwdsgHc/P0ebQ5fpprgFE6bjiu+e7CtuILAuqtLwUfOBB6ZKVcsWCVnVciYs9QRpIPFqPQbQyEhIysoQTYISsmI/WAdYm6ol/ujDsdY4rrHzw3TAFe3aoCFhRpIl1+qyo09DmHR0dxVhNqFsnXox53zkRWCUz8utCoduAfrhiDBVaA77CVFGxgo4dp1aAFQIrvd0QNvRCGOpQguyRm6kTf0628W40HVHielTdScCCeQpG40BypeCWpQcsi8jyeCJuKwn+WnrOKBycws/QDhC0GhFmHViLfD4u172NQ4oWFy+tvXz3Whau5uIAc2YtzxY+qCFzAuyjSBeBrV6976Oe+GdOpim190GShck6uJmAFR3zOSmxRGD5AxxXra0TFKwSFN+H8TCCbkMWiT5MFYAloQr9Rs7leMf7+8nMxKreU/RwdHlVmbh8l+1qhZlt4IqcVcHiynarm+1XdhfhfQvSLEm3ZOWAhcn4U51gAYgDpwVsSU8d6RFl1+9JooNkyw6xZtXAOqVSx30LPVrga/m2ZEMI9H/avW6wog5QriLbt0htLA4TyUr8UEXA2gtgpQg3rOkNU7MBkgjVwNVEwoD3PVYsQbIkc+1NR4/2Ua7UWX0Eq6dP+yRUFY8+wQcJx8G5gZAVxi1P5Eekb27v7r6Flo6etR5VFZzTVpescgwWtNvNaDU4rVZ4Ndx91iJdFa4AC9VYl+v0Mj8eCUIJiFn1QihXiKwrN30cWp0LwFVRuWBIgB548lwOtyLIDrlaB3Lh+sDam8hdP7sGyzFaZe3EuZAHS5vPgWVoC87ODgJY6mTgauIFqg6dTkkyLPllBk+FclGcnKUm8RRDBTQRqnoBq77RJ99+GwjM3unn5ApFs06GJjC2asY83bjR6LFq+DIq8p50WLBuKQELSQtsDzJWi3KukpNHWLcmMlgXXDW1+tVrE52utrK+qIX0Ejq4Hbmcq0VFNZ0s23l5oQi4aqmXfi/wOaWFWkH2yly4PrC+0NKdmLV42aWdxIvfgkPROBeq9pK+O6dYIFgILMxVchaAlfDCO7noJEFYQmA5m0QxVAzncSfU6IsJVVSneqlY4aGO9367XcAqvZs3UccstbW1k3P2jZgnhpE9rGBVfAiaO6KjUwAWWlDCX2kFvVrDdZbTrIMJuxGOwbJVrA4WGeOpra5Eq2DfzfgU8pKeyTXUXQKZIlCRTKgPdWfOzaGVVoP0Yszd6wQr6nOttLOpLBfqyd7VQdJviCb9UQGsZiRYs8MILHiOE1iyxibfz5FwOudwK4FwNUTrqaEJTKBanaUuFgIL1ugTgtX8+zdvHHaBq/Tb/IUicLMJOWlvys5GBTSjWfPoTASwdArAwsqoQVxlKBcstDa0owJe/BxCnoTJ1FlRp1f2oqBliq4OnJ0LQazO5R9P0xlqK1pEIcOo7lQ+nfbSvpTcPk7AivnNYOHSPSXl7FoSobAu3L8RgxW1mbQb6KpQZ/gJwApcI4e2CVgvvLMUrJKSOZ4mIZ4iptR4/D2rWEwWpQphtfjL/zk715imsjyAKwYdZ3a+ThazGjZoNuGDiRMSJ3FdYzJfuBGuNxi7LaGGbgoFhRRliYSRRxvSptAy1EyNw0LJhoemaaHQQDrDqsQhRDZGE52B8TFmx0e0SceZOgH8Yvb8zzn33nNvT2nxDyKYBkn59f9+vH3zJhodVcEaIn6sGJgwywsbctvUwOtvyNSZnANYYlcE6skWSxi42oTCKi0dr48d2wAsd7ixbxO/Fwm9iVVCwz87zpArUgZkIWWsWvq4uq+K6SNU5a+ZwCJXVqFL/YMNwTpIMlhnNgmWsQ1sswKWnMeiAZTh7mMAa4qANTCAlNbXEBe+xvLs2WsNUSAzM7ThHTnv1zFR+CND1W8rK6m3b8LRf/lVsHBTieQN+O1W7W/EmnsPjcpWBicrBx8LgWXBo4AjV6urazY85MwxhlFLJlNodpvHfF2SsEkRq0S1I07w9CHn63KLr88lGthbGnRNprKOUpt0+EwBCzLvefkIKJmi3LplcHK0osO44YtSTNvqRO7fNh/II2Vo0jRTSZfri9h3ByergJI1MFBdFF+a/+Y1lf/JMoMEc/TyJVJXBQU4QUF01YKWqpWVxO8IrAdRBavZEHAsebvShmXM3MGrbGosgy3MIUUqOoO1iKu5kWBRQcZMQ9ESyW7HtY8YCNbbM2nNOutIq8+zabA091wkg+BxdXW5PIJBUg44omAZr38iO+XlhPcD5j7i3/78ySfYx9qWh5jamZ+ftx/J0aN7So6AlJQcOVhyGP3LvkxgFWdx3dGPAecSJEkfFkKg2lz8EfXe9xezYaEk3cMqa+ELhFZNzcAARevl1MzUzEsFJo3Jm7quCA4BdVStrFxaB7DCp7SWUPK2jtVlWHeWwfRlmNX5kmsLlZrKRuJ1xmqxg3WrIIPCqll6eiX5DiQ5vHY/XqOJDFWVxab/zeVua31rdx8y9ZAbQDgYRfF9DrZIkC02EKyAKmkwBPENHIIdDeGFhVVtpK/ghQ6sj/Lyt+dv+/gPcGTt0wPFxXsLdxeqx6ubC4vhGvvBEi5d0C1Twb13S5CyCYHB6TsPHw7aOGCVFX5Icu9btBlSkdjCx6SmAxkEAlYcjj5P4dPPaWSpWM3Iqur8eRQ8EqwuXboECusNy9UpmHuXurqD6WdslG0cGy9rsGdRWei3XGfOnsaSCFjIwSqo5iusePswQio5jCSJ+LrCbltnVZYdtJRSAvePtHa2uEzKMi1mE+Z7baoHwxMYCo2a5Y5G9BFfKzCSy8Ksl4XA2rY178M9R48gogpVmDRnhskXuxFdh7dnAKsq7QcYnJ6+M/vw5uL4jRvovyu4ZtNmQNR8A5C1fccR2jYjv0ju3sMqC6ElM0P2pZFA7wuS9dTJAlg/CtW3JAlx/Kvjy3jtEeIKgRVjY8IQenoNvY2dHLCyDovasxhD2p88F50I5FDR6XVGay1R5LjzPax4aphAhbBCb+1L8TgbOY4zKQe7PxaL4gbWcHDM2drfX0+3FFIZHR2dmAiFhgYDkiiacj8LhB4rAFN+s2akCMrsIeTSG8+SpMOXNeqN6JJDB5CKKmvm3qzmTm+lg6UzhdOzwJP2Kbrdq3mCjTQsPEJbsuTOZCb3jtD68acFIjOyvZtSTR8ZXVugNDEt/d/KSDHNyZOYqyDLFXbdDa7Gzog7t/H2HAYt6qDsjJdMmv3hWOTnHk9OzQ2e/ue1z0dmEVe8VMM8pYoqrPnSAl3gOKumHGrDMJuBpLW10xnzW6GJh50tkzvy0c8HN2MFmy2X+y0mm2lowg+Rc1qlHRnciMsgGNua6NpArER/sT9QtwUpF6srFWkioj2aXVzCgnWAOO9MmVAUZzkvu/hdjcoSjfiAkALWB9uILewwqpY9cPfeNwsyWlig0PeTTmAThcKUnC3V3QWbnLyw+h1wxYKFl84isBp7ePuEMi0DsXPDQrvcAG+ps4KyiIz1dKNQyuHJSSUgsOyW2MhiAVdhxYeptsLybq2oqEiXklgcidbKRfGIrxuPZzR29kfdGIR0+2zGs0NAnB85SdnYEm02KTRqPwbfjPcKxLl90vpMclknXjxAemoX26ne1IQHIGD4Ad8Y7uighfCyiib1WGzhoR36dMM50chozTucp6coorWFVSTfcGDrTnJNh/QmV5xm7tRIBvH2dQjuFLCg1neeL19lgAqwunDhwvqT399G0hWWIPU2gi3MtjjBvpHqoiMVFvtc9GpwjCB1+aTP4fRIhty8Y9eYZW5ktoCrsGrWWK6G36WK4kXogVAVVdr+gjGqsWrnehxOh8Pn87X0RN3ZFrvVwRCQH7a3ZdarCKvAhBnaODKWrMw9Ton0ETaD+/4LYKVC1VTJXGQHkeQIApfBG9o6oE+CPHr3p/u0FZ1K9jipaJrmPD8F3+vAasANDnu30WY/2kNacZbN4NvuQFrqOvaeiMX78dUrZej2PO62Yqo6nOHnf2OsMFc8hYXE2diJfgebXDuqlbnniCispE5exhkfp8vT6xVoIJULWBFLrH6RD9Z9DVcIrHgck1VapF6knJVr0bUxh0vy9npcLs+EuzzLkiRs7WE1IGJL4KstsIGjVtIdlHGDACT3BaED28IXJ8qZHVRNMP7QcPaMJIhGo9pcwRTAkQgSHAit0JOFM++VGu+dC1bpNY+JFxb+kYC1dcd2vS3E3+kGedVCG9nXL6f+/p/Hj3/99bdXz1SZnHy2fJzqqeXEpG7sC1NFuHob5CgssIWdyGr43eZctzTqtZYl3E+JQkqqr8vl8YoSjs5zTx+JXcE6rLA4llCnsIaTV5YIWaXza3E140B6eizHxhy9uJNMHLJm01fySwfpIivOG6RtkLeZAiG/Ut6yZ9JY5f3dHoOxjcSF/21WT0GePtdwVhIISxsUYaBNoq2Mjtgc2Mc2N2i9d9M076bdrbsmThl69x4yUSE3kWpsoWDyjmtOCIzfmr/fnkolJhW5gN8nl0mvnzpsoUKFufouzXNXkwBORNaY350VLFhYzJvVCV++TIkS5M7AzYbxXbEopLB4uYYlBNNF9Abv+NNkexzIKq1eezfPxIW1ZItfI9ldJIoTue+hrMM+l3l0SIOWaBLgBKIle8nK39PtMhgbKpkMAt1BJRqNOSU2EFxn5ZZ8mSxchNbWCk2DvP5HnfdOD541H5VHdbb8ZW+aLRRtNzVXT8bjS/NP21NrCWifUcEBQXAtL9NrAgpUCcpVuiEMqU3QXgciqydm1W8UsiszhXgKDC99sfO2E4OOMrwPUEp+tD8cu1rNt4RPkwpXFy/iT5PtS0hjxdeSyaeKk1WPnSxLbdDnInnMgDnb2Qv1lUN3PVjLAS0FKynk183D8lWg2R1u9AFYbBM97KASjZtJlhnPkBGbsrJDJKW18xCZB2S+Cx+s6u/TwkKcb5DHVrds/byZVIe0TpbmYOH4raX7QNa6DqtEgvdFYj2BHreKuXpzlWcIydZGB4zqjNG1L1aS+7OaYRoV9rvAIBgeIET4zaXrLIs1sOlso/agq4TAqv+BbwlL2wEoIpgs9Cd5JdW+BhmtdrXHoZ4Md/TTVgYxlPVinRr2KrqtzkqPswJW5ekdaHyN5Y50tqCwUAWrouJ0m2Tc7JNiPHOOWsMSFqxzgpE597nIK0pc6xV5YeHOnRvZwsEbpTpjePv+vdTa6nqCJSuxvp5gv1IIS0wmVh9hrmIZDCG4Wd6+lu7Gzs6eSBAO6ATpPHM/HUXF4ztQ3e/kgnXMPijmDJMol2+hqVB+7iXPWCw4ngGstWEVqYv0r+FkEumxi8mUslOAeO+1YUcXVptiIOtGZibqVQfPyuvME5JJNIkhM8fs89fpuMOt3T7EhQxWBZ6peY/MPm2lKisr3k9GKdIaSE3CTV5ZQpcipYf09uZtkVXWnwp34Rwpa1W9i9or9uOErNSTVY3SWk9kUF/rjwhX4TDfENK8hsvR0tLdLU8UkkEwPIoKw2AOR58TuVAeZ3fPcy5YpiwwKSwhtx5fgMI3DkODIvFpJNdY/dXq6g3AYnQWI8mU7JPV/AApUsuxiM9jIPd1st9/snPvlVnd/iHT4Ci/H40Hqzva03jSaRBkH6uybBOzD7r6sUzWQZzOOrxbHxaahIelOXjvpAqw92MZrB35n+/Cyo8tD9mYb3VCJas99eTRakJnD3WC/DBQV09+Bq6irL46Ba9Kk9L4Dcs5DB6nw8cOFDphEtXT2+tFEd4/sEiZwGLUn6g9TkeqdFIgMERp8vvL7Uri6/+snV9oU1kexzsPqw4s7LMPZWR09sEHQRF8EBl2dl/apr2EDoZGG9ubxptUvV4tZumU1TQl29qkTRNFpsw0qdjGSrfpBgNFCDISmKXODhRX++AKA5W+DDs+zC7Wxz2/c86995x7z/1TZ07VllJjTT/5nd/f70+jK+eC41VyE4qC6Z95mHiwDIuFw0Klkc2TDk/JaxUil0zR+KH8vFvyCQAAIABJREFUyGrRZ1s/snATtYKanEYBA4kKQTKvp/c9XU1Dx+vwJ2xYyCSyptaEbR+89077w1r/oKvOfNDyWSe5C3tETpbhZgFZr4EsjNbfXbECrp4hrl4WOQcr3k6XYJoQhKIhDBtMfkX1Q6bAjEqxCRaXPJ2Lh1mSJDrGjVeK4T5nuHb0nZmMLZCVGE6mSePlwXUnsK67gHWd6XAoIrDq06N+DFbEItpr3YSXcKyTatzeqlhiIlLPppKzyExKEoDV3c1K5rmZcXEtvPcSLvG0njLGVSEslJjUu3DBzQtLWHjNDAuxydr38SFcB+BzYkwITtcWIg8esg6IrFfoQhSxBVS9Q1i9+mFr61kV2SsOrLl23PYB5VhckIW+IgwacGQxOMyJDydV1mIZFZ2SRJcclkrGajr0YsZd86y2iCBVga3d1EYd+rDEYD1HYC3RN/gIv6MX43OuqCNrkMTCT9qqLJyepUuouqzg8IYo4qICboxrA1WJYr2SypyeHY9i0ZEzQIHU6wIU21oBO7RxHZxNcfRSHQBc2qFO1g2zqCOu6bS18d67RHcHfdqib/Dd87s/Yidr5LIok8U48PfX1588/9fWDwStH8FukZyW/sFf3r3FWCFz9axa5twrxFVpMcGtkENPJan7Y9JW6apwcuaMU5qrZCuiqzBQBJCAJNMuudHEkRW5Ew7mBusPgCshWI8oT0DW0i3mbWl+ydyTtI7AgiQWdd1jsrUl1hQYjyW0gLtCTcy1mTFCqYrUyhU1eXp2OheFfxMhcQZdWz1OvRFw2smK0VWyR5s0WtBeQd3xxhFd51GsgHzCHhY+7PfhvVP58WOmtB+6C9GnuoeYUFWa4gIB3WZB2uHZFkHr1du3796ZDvuPKEQEqgCrrWeVKp+/QlwtRxIxdnscJ8GndxrFuog4YyzWSMQajQZ8CraJC+kwQJJ5+Wwf1SBlNRycrBMXSzxF8fP8knkoUxgz08WiFqs8Pa4bLNxoERG1h2keV1zEYxUHIisxMVFcKVeyGRTgoMs3SpIFF66wmnl8Vx5uuSHdgRH+uYacf7uJxWXqeGMn63irLSx8+I0P752GhYc/3LeH2qyW3+O40JQGgcfi/TWOLIwWZgvo0s8rQhXFysrVxkKXoB/PsqYQMDJE12S8SFzBtsivpCTR2HYWyjW+UCkGwxu1heZ+h6Cwre3pLWyq4Bf37tb8E66LFOrPUyEctnfJ5JvoMv9T+P8XSziOrpEvhT8SHh1C8kQXoeqvs8n0qERlmnouXUE3TY8VKugdRkytLsKIN+y2Tlj2QsJretFMMFFNHOJk2auF4gwpeO8cWITOA7/V78LftFAni68P7ReRhdD6vlqhaFG2zANUAVY2c3VuI+tzxbevRj/xy1+LRczT5f5Aslaa1Os5Dl3J11mTRbCC89NOfxvnvCPXHRuP+LLM8G1+H85YMRTS77axLTtpYzbqlWwKUTWdH82FDPUvaajjhuUeRFSR1kCsxeNUx0a4T6zmQkabHsk4nMBh4SFrWBie+4ewb/vFlMQHlzinRr13RNbePX+yO1lzFutnbLR/9BjymMAWhgv4ou+BKiFW5zYyVX8Lc90uBM2j14+1ffBxwnUFT2m8tjJ43wWs/h0LWfjMLz1intnmQiNQmc4RgxXhb2S4cXxczJxo9Mymw6VfqxaGkb+ezI/nglFTq7Dnavc1qcfSxFVaBKZYD0ETOX6RrsDgZMiox2An65ihjtXN5jXFqXer947oxGB9Sp0suAs/w2DxTpbtsXSyNh+QFDlmC/DCb1u6sQI9WAtXd4YzKzF/YPnfj6RZIixbj6UQUk3fCX5nI4CCwn5nsJD/bieLuwghQaptp/O4Tcdx5equzqbIZClaNasmkbEaRVRxPUHoR8kNAEITF2jwWuOXmMhkJZRtfVFZey8B66ipCnJmxKTBIfVu897xjhdE5z5K1r6Wjw90c/pr8GD2bCs1WutE0LFK4DJOBVMlwGo5Oq6qNV9g+ejG0gQLVx2qHi6UyolcXa6TvLvjCPRTm82an3/CUgglnfo0hP3o5VqUfwWwtjdFmquVVGZ2Nj8+Ze80u3SJ/ZHFS4sxYVBslwDAz7RSoetZJFLo6zzJgMWUocNT/xa/9Cze+4hO514ywfjBJ0fsLfSipBhNO6zBjh0iFlpljpAqUJYJjab8gpUQcqR5NZM69UBpTleosji5HRj0AKvt4PV5Ljb8aefpeX7QflCrpHHDTLyk/QpczWw/tpVFlUYhlZzN54Ki/kU21RmWVh01Ciyj2jRWUOp0eF+ixuakuAwthdeEVr2/GhZIzhzeS5g6AUMdrSTbetmrbRCjtUn2N50ztWiJHrqAqnOw/iM45hMs4/JymP5yzkw7NVk6phtKCwHNE6y2/ic78/O36CU4v/Taks75plyvpbHrLoXFO6LlXZqx7cfWu1DWKoirUe+22PCdosu/xkw+mrGCspIiNQPdeT/JdCcPmZUYKS7OkIq99wMnTh47fIhd6sQ5WeG5g0I1DIRW0+SG0mWlam2zicVlYK5SCgbH1JQfH8tvW/Iu1jRp4r+kxHIrsg+w2s73P329gxNYO9ef2Jyx+4MrZeK6I4Mli11zXKH0jdemFSxZrqN7cDzq2XMGXHntUqQRqBGmIrDyQaZLr/M42/Z+kU297/fjvbdf6xYOmXWzUhCSQySA0Lq/ds7lrDXfvPkc07c8h0vNGKxywofF0vwnF9hIz2VhocPfVZY3GiZY7jp+5/cfhNZRkWZIc2Eli113scGSa5VCAdTnaw1N9me77GA1CpnToz64Cvrw8axbi5RyhlzkvWweq+UU1QXp8cqQIu+db8kaEoLVfYadrJakpuMF4QjWZvONHjs2H85J9AYOjaqpgmdrpeFgeS6W83RNvdx3pYhcdwasXenMsMIgg2XiusdLCdGPtTJMz1ilWq9psidd2mMbWCupZNp76igsLTo+9MzMDPy2H1muZNK4GqVPQhwhYGElo06mpzjuAJbFeydFHXakEQv5XrhxlVGlkMJrjq/hx1Mlu6FaM6FC56t1c4gjNKmqqXpiNyksrx2rmr+d0CKwZCWwGMwhH/kXg4V8d9I6KjZYSm1YVdOqqlK4Ct5wbVvBkgPlTBKz6zEwvSoDKtb02IR+vp742n6+XVEz+RCpxuB4jvTNtBw53MkJiCKwxKn3tv1C711HqhsPoF2ySsU7lLRxkSgXBzEBlqvm5yxVX0G+P2z2AA+rKe/Uu+a+8mv30mssWHJA76TXaoPheB36yuvlfk8ny10ja4G47mKDJS+o06BYn8broMiOxEIZloc5srVpB6uaTEueBuvy1ZcACj3f6afjuw7+3ES/jNN3s6Am8fevu1jHPiSDOsc6GdU0ksgS+0UW773n4oUzupVCTI0gpvCuFIt1fegchm+EiU7EsgHXGxOq8zaYYe45VU24Dkb9gtXxMVvRUd8zF9P0MjXdPdio/fd/+Xg4h4Vi9ATp+4LVXChMQ5nQyWCNTY9Cc1lwCsQgMVzoaRguVBFbQndeRgaLpBvM2ypQSY55ciX1Dp29KT7AkvAM9HV8qWaSuEPxMrU0x0n6aR9NZLV7ZkiRk8XLrw0hI0XXhLXDSidRC76Tw4ZbvMK8YNNyqUk0j5j2wBdmhTIo5fHgc8JnpsFp9Nn6SqdmSOMXFepdOdCWEyGLnet1sh4s+5/Ts3kpGset6rJe0nnfu/DBgjrmYrCqahr/2ILQwgjLxihciK1yTVMMB0i/wuQZZLA29U/gewyZoQoxKu4G62L32Q7fZ2Bg4GxfX1/rl6nULH7sXrpJirpYxpg9k29wyJC2PeK9dwnGrumWMMexDlu1UBRm6l1k9kTHeVbnJjSeBrJijtPnfKZBEzfJBJixMHrwpBRYrCLZVUj3zNXpnrlCNqvqC8JgP89sMj8VDUqT2GDJehH6PcG6P0jKhMhgKUIPKzkaYoRGEVwSbLJDcKVSw5WaolCCED/AlwJcvahN0DsNbjKA4G7GB1gjAwN+gOqj52xH60d3s6nMLPawenpHyED0UV3TSG+cYRJZa453F9+LCkR5TApJc85rGixhptQuAOt7VtIuNJqBxTg10IMRVkS9XClYTQmJ2Lp5yvyeMDLdk2Y5QiSdpnMZpJ9+sj0abQ/GiUqMXKRtM+95F24OZvEPJj4XU0S5hmp2Khy2KKnpliuVKqyAQcIEdXSAb/0SJpT+eWWgg7vJzt4mVtFdAHTI02D1ffFFX9+V1tu3P7p3797dvxVUmCIfg1RJD21M7vzzKX3M/tQBS75BijskssjdtVvZwvU2FyeL/+K43SH7P2/X89pGeoZ7Kt1TspCleEGo4ORQ2kuXQg+lp20OK1k7DIYISaMwlieyYlsjycYOkg+WrChaS7K1Y0SQ2SZCSLExlm1MAiYgQqhDg/Eum1MOycUUcvOt/0C/95sfmh/fNzNSQmYPWbJex5EePe+v533eMz2wWLZQKqEMvnWMopXVi8VG1CCf0u0fwj69cs7plvI80D+3HuiOPck40hYzUIaprGYE8dqX4uXRnz2RgTU+NVJN2MUKP1SREfVisYn+E6vvB/wcPsBWPtttAHkg9AhcLpfpSPVi/VWHX1830Uwz67SRG2KXOCdYZRoIT02FweVXag23XUOKm0fg3t+/0IB13W2/4bsXG8NbrfqojSwAKuMUN43gw6teeVgifLZ1F9+AuzNQ+mmBkBYPY+nLf2O8XF5eVqvSjvZIEnqtwJeqIF+aq2AcwYr0YDlDPdGj/iSJ2gcFCeoUeqRYeDor4e5imEhYsogqvbX/KGpZcwA5VaW4mZfaXo8fwIXe9Sb6a1Uv27wVE95qZdpxy8YWWEIu024iRMFHUWFwxN61oIwrxb4h9+2XA0tu3G+IJF0A65faCMB6/51zkkUH1thhwvhRhRsMpRKURa2D49t31LOVkGhrslHqbO8A9JDHx1ugUx50j0H1dOd77Je3//gxwlBYd+qJ6oo1q+yw67L34SkrvtddK9gQFs7BUV54+2ghZJUOB4NMoZ7PFqUmnMZsFhGspMtXbc6aKglcuxg17rLD4VzjjC7A2eKqgSIfYnTAk0zhDBAn7owyqzKu7v/zK/O9woxOOENrZCH6GH4fPXFCf1nPzMB6uGvtcRgNlHxBtlJcQ6GqlBer1R0YdTw7ODiG+wFaRdinOG4DZxn3JQZXo8F1DXvebYFZ3mM2nLB38wvXNLu0Yy3JGp6yXqPUfYNAWGqjACXlShY+uZhkU5ZlUpatFVE8VB9EVz97OVIKzgntioJMBtdbDBhchVJRl8ASEOfll7c3CxUZT8oHD8fQlHo65f4fr1kOFmZ0/YYEbcBnapE6d3LBHteGscxJFkEXGH9hNqRmg+xGubi2KedCJbisaohrO9JBzOb+uM3kXlnNgM2frSOCM5D+h0gMDiz1Z/dUYE19LGGpeJqQc3K5qPPjDErIzK3MWw6Vgt92fRNehayIUulXbQ9PLu04wYuQCU/IN59cXYSzdIGl1XmNB0OsXSjkG4CrAt7cNPrRpnyqQdb967+/csVyRWCJdW5kWejDHlPhR09P3u/a3ISMm6oBJmwF1i+VIMlh2lcrQ9G9qZ6Kkffq0T+3Sq3hFckmdQNe9Nk6eswkqF2UysGAYRTvhhEo61QjrLszGkEZAKXLwgXOH1iEUyZm0sIlIiSP9UItwlM5h/PPgdHj4tJcICNwHDSiOAHuCWqaYDqwBH8T4apMuJE9v7KkTGDu/eHm1atf6oBlKQtpUj+XSRZe7/A9evr+9e7Ln+xf6Rem75ewIvqsHCZfjsH5zwY2wCsUIPPGp3rrmy2dSnuo1rtxpgOWNVugAyNblXcHBxDBMXlspPz9JSKsIkwJQ0cxBVDK0GSd1pSMLCUth3ARhzMbUG742GjSL9j1NLVH+y0uoL7xqVVqH0vgOiJZdhNKzmVUXP3p2ldX9YxlKQtRXkQTcJdZJ9/nMGDq5NQRU8QkK2FF9Hg5bHOXSL2iqqTaQbao4io94cbr3VaQBf6x+0zY8ld8iCoA/QFEmEOPjTIwfDsr4VNvITm9WXfV8PZDRAyRXwqQBvgF/1AP51HehNRChKMTVmm5SJTdMGqC9fXXfzYBC5eFAcMYmtLIsnae9Dv9MJuBcwOvX8bdfm7N1QAB0VNvEq5LUZYptuhZVNopNKZJ4tEtgx2N6pRn+FNiB4P0fRhkvW6phLU6xCwFYSuwOk+9sxxd8HBDIqtTVnR61EaW4KmW8ECT1P9iVuRYeG/y5tUvr1iy98gK49xv0I/u9DYRgKmHgKndn4bKMcZM348gXh1zndcBrg7dKOHStH2uNGE/MXZ3P6wztnhsdsrDjVcdZbkPhi/3FMJi7At9UmSKoGSLPPNgN5pefijSEjKSvISdorKd4BWXqa17JiTrsAL3PDf1uPrNF98o/g2DsvDpLk1DZUyKVEzJwW+ExrPp5AVBC2G+imGDK7Z4aHjX025lpIO4qY+Gyk5hLHakrpGH2ScTRODqKcstsuIns901bDo6HGEp0MosLviI0GKjhbZ/KGhxPRF3vumUxXnzmzZ6LsWSNnDv+jXCcblF1rmRpZuwyINj5qES/EZUT57VWActBKkspOFqZyJG0mENkcOnFWcIbMmiibqfsGFFEE7pjvdnZceZIZAVP+1eNPFxr9BQqgJdkbeU9IWIxF34ucFzw8TCkkJZyQylV9EQS7VpnyOy7n97wwqspXnGSZGlJFmKGME3SvCzqFIZJy3EWdkVsNhgQerPuI2DaWqulZZtRfQr7T/ObAFnhR/epn1/Q2HoDlln3YvOyISlQWuBRFpssFxvZ4RhgCWrtZgopTBEOVZ+I+jCdW3yb/prhn81q5PDiff0pAiaCR8R/GyTNpJvxPOym64sO12oqsM7CkWl3fe20hPGdmXsCLw9iXwlK+l+fKaJZ9xl8K8P2w0Je0OG5iOC3z8itAJEZPmmU9mmh3cNrHZJlM0Eo5RgCFVhLWgrElTEDX+5YVcW0vsN0Ah/9PFERdZbwVLPrpMbCeWZLosHM6M6NpCwoqmc5PZSMpXYNxQGpi961x10SQFZcceCMNIpYUesUQlLxsTkChFZQabtvjjkmqU15Q55dJ78v0G0tB1ih0KrsszvH9aT4/qy8FfacOLskxCVruVqmNgwhBg8degie5+uiM8sQt30EKBKG8Hyww9awxK3v7k5piIPBwmogy/iGt09XZplC614/KzV9USqWOD3EYSF33H/ijXPCqXml3KuccV7RGXNBjeziMjiIlJ22pUF6UA2o17wRWWhc7/hkz/PDSe2TE5trvsNwQ3R1GhwcXA8rf1CBJQqlVNmsMk3/RnT12hflMkIAnfRPZnSI2uK3M2DE8WAq1x7uYg7mosfQVgYWUmzwWM0mgy4LwsFvpcv1acHGxWkNqnAd7K2sVC1/ld3dORHXbP3OZeFn/oxtVwJJiJjLxzLwqAvu5OecQuqtCx8l3UOYP6kn9GZADX4WLd3vle1mueDLRX5P543oCNuQRaBteJj6EvedruNXEPEhBUlEhaX490jK8AaOItJza/63YNVyHXE/LZOrIU4iyelc+1yKmRLWQuBiF7yjstCj/5Aqp2+4ZM/phYpAVjO/QZUEA4Sd7Pp3oyJyBQ8wbZNHy/NYbTkeF4gI0p59zLN5jlvBpT6nL9rCOi9vDBFQxlbygU5+BV74I6fdGc9OaG3XAjSCEvwdCLuocXpL9agMJic49zjikO4Erfr+jCX6jVyRHXEgrzegI+AERWoEd2Sjq4snNP1GzZOPxOwTNk7Yb81fuYErCA9cZ/50IrNGOSYE/3jA2XbBj/NZq/X7nQaGS5n817yjWozw1GXoN4dNFAwBGS9HpsanzKDS/evY2d73YsMz3fWsDVkdCFDVOVlpbbHLbSEht66GCXRnOAeVnxbFG9tGnYO2Y0aqXcv8JGlFbhaCDPJUMqiDVNj4Te/tY6hB6OLxPv4ZwKWkY9ItkfP39j3G9hanjLJSYN5z2Ef3EdlJWbsQ0s5TAgrEtsPNElXtio1294Ita3Ie6tNuiJl/fzdRQM0A95u63TKTFp6WO2eHHZR3OQnJbyZzESXBBJhFUG012vwrqAleGpajIr6FgXXsOJzfm8zK24vm1tU0XKHlPsjIsSnVuHY6uLKQjRq9nkPTJqSrCHG0J8+ezfAhgSscfsxNMtkq5TO6ExawrsX/dhMDKXc7/7332U4dbkGKxJFWWmzBpIuhC8sGJTaNPAgYEkN+tu8fn77AvIswTPb3TsbI7AWhtX421b3wgMI7MmtBnKrm2vnN9fEbLboDlpCpql+OFPzc27pSsjxnraUFUvb1ukyGy33iLWqXngTMZ8bUKwbrt8wq5P129Cfryw0qhfCT61MOW7fb2CtgVBbAN4vwJFlsbrTbbd7l9vbm0U4danT20AhWquVC3UELzj1JHkEGrCqHZs3ef0//7rw+gX0Jl90WycArSkTuBBbIVjNNmDOy3lFbLAeYsiEJZWK5fqmAi3HfEnwN5XVw5TDPoQurOX8nWZVzCPuLhJ270Moz+KcNBZcJGkSzc+Zs/ffWfsNn60sNHYTSBv5U7b9BgiEkKAP7E+UDhPKyffDbKUuH3BafvAAzDflBQkMKVYv52KZSmFtWRTzPRqwJLFnV2thZKFPOSKti+7s3un4/3m7nhfHrTueU3sMCw1lE4wL00tL6aFQeu+tFoMQhgiNn+AtfgzDeiwjm3GQ52DZijBre2wEomhoIQgtLAHvIeQQciwLW7abXNKSQ05L/5K+75PskaynJ9lrKtjZZceMZ0YffX98vp/v5z1+/DgFqicvXn35lMGKfn3S8uLFZH7AIqE9vWvL83UStUh5xLJiG6FGNVwhTPzQM8A5cjW5y3uxafr1oCrToeQGhry2MMU3/PXF/616n5cAq4RviBNhskq+4wPg5x5fQHCCA5yGw9V6rogO5AWR4GxK8yY/ZOFaYFh1UV569vbvLyEdMmg9ff7Flz++eXEGQevs7J+vfvzyi+fP2WeTveRpA7hRLhAgYAHs2NYIhVa9DCwUpwbbpaYdJqkQrAhNgfQRolUB1zlS0/qDivU/ri1TC4E8YMVt4YPsXTllW3h5+eSsuGLLNn28KfSlCFjqzA6ZMYok7VFQeBBbTMPvTq5ydrjSnhm2xx/eImlDy+maiHakyPrqXb3GoNXyKbaePwXzS/oH/vnObxG01aAYK8Yb8fVPCAKWut11c73SaTKt9RmwSsWj4LYg+WGwsAFVq0kjLwmVNaV7Y1ZmK0bhRFNEwIrbwhTfcKK28PLxk2//9Z9///cHQfzLDJm5Vg8CIku5MzyJ8MgnBOeQZQ9DrcDf21HBLxVHC4qsOkHFTdczQtPhu3oToEWf+Jr/jl5P4YNfox0VeQgwsWhOV0QBK2Ho5mFp7CC+BcASKIu3YohanWVAFw47ueMsRmiacntODpgE4NZiVg6s88w29Pu2hQmmfjCm68lcxLc+Sa+k8qbQlwLhjOIY9RF/OtvvaZrGZCnVDs2WNXW+KLyNuOMYjmUFEcUIEQStnyi0aibzYkFsE0aK/06FjU3irMg34cChsZ0Iw61Wz0uBhUJjvVS1EusFJNVpqILN+HtaFrQ5+nUa4G/P0UEDJoIDa5cMs4Z+qdPss3zDe7SF4LcJmFoApi6Y+86ritU7D1gFizqxy58d4IK6sqfB+hxjXK4bmhhdMnz6uhv5hbkODeYWcz3zNlG9VvSqZ9JrgBYNUS3zoTmXJLNJwbYduhnxSar8BVFU81YpY5het4qy2FjLSknAAr8hANVwmj7rZK+26qBD55ajjbsLWRweKwFWxn3tuOqdllMPmLoCTMHbXlx8c1mteufJG/7ybRGRpSiWwa2oCRr3ZIjq7JLOmdWgrPG9ceD/levu4JwUs0ao1ddna4Ys2woErTjkw59eUmzV636tVms26Qffr797u8tbTtwRyvoYFQSsxsNP2xuUVlg4tIy1SissMa482gQO13O53eZWm7KujAmWpMOBNVGyB2H+IQ2shG8YpHy07w6eFm7j1BowddFORVtZlFgz1TsXWIUMKa3c+QEL3/SWN2gbfgBfpNWJQ9eelxdDVf/2pomwqBNCA11rwza74QSRsJx+BtCKsbW9Xr786TXZBiRnGB9u0uvzBMnYd1apxE/7xtx74UxURbjuWNNJW2vcYCHVBT5WcrutFgn1+h18uMyCpkLXEYx0Er6hmRpDH1a95zC191RcfX1WjXvnA6uAIVUals0NWPiz5Wwvq1FwYWRScHUT98GYsGH5stMSowoUBNc98OCYT4K6VKZ0otB6C9iC6yv48Po12nYXyI99IYv2jvHGnqZIkV5+lIh8PwUtjCJa+a2Wqt4XCedpI+reT9qqQJrQPDxcQfHuuevdEHqQF2Tl28LK1TvF1D8opiioJrOrC5UfaYV8azogce27ixhSGrA8wlcYWfURb7hLASSd30Be1JiLAaDKRKWPKlRsDIfdG1xJQEexRd6+TTxiCUk1rdiPO6Re1+QHrGG6U8kTEqjpeVGNfhexVWNr41jOijaZeldAEgBzNlwLbN6PxJU0ioyho2Rq9+T4gOy0sJJJViqJxZiCODV7KKi4VgeixJrBDR9YXL4BAhZvzEJw3Q5GpJjLQVIT8mL/dtCBnq2CtHwMUzFdu21VFw6kDfWy0RTOhuRnLtDcTTMJKjfywRE0EKFvYloQ1uqBZTkumHmX7NZv3JVgy0ZTOsfhilZunybFu6zfMlz9+vcZYMXq5Kwp95lwxBdjauFsMSWUthS7Qewz6xxBFu0bucCiLeGiyWMYTc/2R2KkQNHVrIQqePVA05mqG72f2HNLsNGET3FQFLCU9A3PkQ20v1+BO1iwCTeBR8OVNYwFg2JghfHQu9Ak8hhckZEZGMNVQjdoyQZYZpuCXjGwHtpCRRRkzh4wJasVOG234nOvAAAgAElEQVTYznhcTTnDBRafelcdN+AxjChyPQmXw6Vi9KG4augx7XQKXNEveKtr3GkxDVhuuiUEzpPkHhp3Opm6xtYRazVcM8kwH6mpvUCr+DZpfelw2T0aMSe2+5maCVgZnd9O9t5MtYWi6v3NAjB1sbPeKr+EiTXNU/GAxZ/pqHe0dEdc3b+7wUQ60YXImOFKP3QPvhhYHZnPDYzq2QqLU2JB17hUlxRaIPMx3NV6FosTdCGNRXOhpRfmFPnmMOsIjEejkeSHC2MYO9smrv+8gPXBn/amhVC9/01QblfHlHhpf7965wKLO9Npz+wFVy8e2fbpgIXNLvPfUHphuYKOVFLmkdY1d/cZSYG7TgcsWc+xWLRaXoMeYwmmyaspwEqpYvSIzHDOXNfAIFLPiou1fkVtYAwpTFp+Pdp4Cxqu7ifJ22+5hlzAisfQmSPor75+UlwVXR1oRnohGuqk6QTu2Tvfc6h3RXFcnsaFmEvbDk6UtRCuxxuhijaLSkEzam7qVb6q2R3zA5a1yizD0Zo6V2KFNhCSFFrMEauxe7o1WVwnEcm/7dKrD9e1cq1oOwFoBRtuKYaUVPMjKO3ANRlkuNP5Nr9q8akUeyv2rC2Mp4WZQ8eLq/e9Y3wrAEs81HmISFxg8WY66tJwQ16hMpjZ9kJcvFfueqRwriWNgkhAmtSyvmc5tQoPv3nD6zmwGcQLYemjIsh+vRdME+xthYrFaTMn/pRMerVaLeaU1hl0NXazZaVMxUWYI/MWUQxS98PVerLc4TpZpPj440/2cfXBz+NpYWrhQ757c1nMaV4dBiwh35ouzqsDa1YgRejCKWGnCFmERN8lW4+KMvFKmB4shQ6op6pklRZfPxEvhKWwktMB0mw5LTBV1CurR5mwhxBEbphLZOnGLDYjCikDRo0MUtP1ZMaC5QOu5XHiCfIoB6ykeh9raXu9y0rUUzVgifjW7x8Oj+MCizcshOMLOcAiHeXOsW0jev8qC0ffLZW4GFHuLK+FhQ+1H1irlWFFxwIa17zhJFu3cmr3lmcUee1XO7FkTwGis55Q/I3VPcOGKDVcTUHZ3VBzTZvWjZ3XfpUPWLvqvSGLzolI9WkHGnNXbQsPAhZH5ILGujK3jZMgy5TOYeFJ1jRlaYkiFsFm6NjD9d3M2Bz5roRWT9O9XeO8KSiuLdaF7HlFYXKmx1xqFBUluDLY+Hq25CBqt6oKwPr48z9/yAFWvnoXna/05sAiSxEOdVKZlQusswJgBfmywuxrSsNxKbJC6f07Q4KQ1LwZd68psAprLPoiGq7c4URt31mBedy74o43nOwZXWu5phD7C6cwVfS6B//Eo82MAosIoxqz4VbbIhqskyTCjz7kICup3vu6yHX9QAuYqkOdFHB4+1/cKTTUWHnNDBpojOFyF0HYOg3lwJjUaLEoUrwT1IRwNV22aavmeDVyXD0XutO9NSyOtIGGj0nxDdYGiBwashZzMbBGoeHeLwVjRjk5df7889/88tEjDrB+9tv9trBx8UrkayWfri1MlWxcYPFKOtoVQshCe+Qojbi6dt2FOe3JOFL66/W9BT+30iwYeba7migwilMmln9UkUXvcO5sXQ41NYqmAt/qY5Jh4IhrLBzY9yIDI3k7e865vGeHOudjXWg1ezzhcPVNpbawCFgqh8eipdQG4QxLfqsr+vW4iUf4hLCC++4ZG458gGDCsuA6eabVmRUdM3Zj3Oj+YeAcxRYF1lzQNfUOng6MQnsu6gpBcDUVjIE1vbs1tv3jnhn3/lAnRcleFFOkhxMOxZZbGWqde4Y0d1gIh49TZEmjJP4TjM1bXV0epVgru/GtwMjnQoKRv3Hc4ZSWINvvyQrFGw0F2TSyV7nTuXrd3JRmFE6FRziULVRwdC/uRBVNdEYbV3Dor6wkp3591vzdJ7/46BEXWNuhTjV5cgXXqqzG/ErQCqSodd4qdNGw8H+0Xc9r4+gZzmEP7SWTjTMEEowG2oGZJgNTpsMell62O4fINUJ4idBIAi0Rc4ltrR1sY/uQ2Erijn9lBT4o7PZgfOjF9E8YKIXCbrOX3d5666EnM39D3/eTZH2SPssKO/3YDSyzE9nSo/d93l/PS9ZiYuddS8fEcIWramLPyX5YY+VToMHAUVpRWE3ti/rYGi0piDRsssNCXPtmqOCeK2yGbNetGDtmjLPq83LybhAAo35PYN3ISU3NOpcALFk8c9dSXGYPd/d32J7QZe+F0xB7T+BFyb4QN0xpwjp5UUa+4R7AwqIOSjM4M2wv5+Z3PVPqfaCce/z+DgaDeaAtZOgtD1Y3faoxU4SwkGGVjOxsogA6K5MZK+duBKOEyWksBNaalZFsdaskV9hNbm5oTS1tJbC8vfV73Mvd3f0VnnDjlx57N2lelICF1UsqsPUXN0y1xbRhYZCoYgKLzqDSJkvskN2FZXjoi9t6R8bp1f8LrrDeAhdB66jraHnAPM7tcr0OXDrswSybwVjUiW2hXJJjTZkGK2sxdoGzJIxb85sR4/ma3lYvgqzhJL1KJKFQfGJNB1A/MldJrplVEhHuHe5mdne22J7QZ+9tM1migxoHFJiGypTFKq4tA+dLdTonF3WCfAL7ktGajrfwA0eFu3WyfbcODgkCRWbn34cyWfbAns+y4J+y3NSxykiuhEggLnZY1UJVsd2dgjZThhEnDeOJRxzjieMgDizNFKttOFWeLB8Uzd5MT/t2tSYDCBqS5XVVdXJeFfwxgViGwwfWSoMF7J0MVNBhYVId+ujdSGAaKrK3rKAohUKhKofY+zcp8g2pgAUXNv3x+WEP1+32cbAXSJdzX1yRPpBU7/YMkQX/Og52bhJYjWJ9s1LPYuQbDOXuqotyCVPmxBfXZK19EOJifwis6Ntsiu1TdLM55bQt4l0RNeCZ6UTbVN0pH3ckIblaaKgGSq6RMYGo2ppJ9ug0nhGGtQpY3qQOxbmF0XdHKZPvmiYAps4RU3jy0TnFxDYcqr+BDaxwTUcuntVKsvslRW/LruR2/s3vN8jbaikzTkkFLlXl7hYALWJ5rtAJjiRWqMoEVm6OSlzdG1aSy6jYVzcSO98Zs20xYIEzwrF/t6qcb8smafEZzCtp/CHKj9YhGpDP9TU5YsBtvnZ2XipG1NY04gv3nu6uCglpwUg5UbmRKUsr8CW0UxSoorpIyWFhUHtMAyytpMDXbEc3YEn98n2ABfxbB6LkavkV1LXgMtTs9G6xKHcRVVZ/xKxxILAY5D3XNkdwisx2mekFc7GWHG/sNFTHivxPJWq+g6yqAK8hiv2bxbSy9m0BR1i+tcjSlbU6IN5Md6FWDRktWawhsFYmR1eEhUxVoQAMgS8UZIg7KUh5wDpL3eu3zDewrxiq6RCBL7jaaa0qRHYIXKR1hYiqyXxxe3zsLf8FcGUNXU98FoaR5ZwbnJ0crdpCLvZZHMuolEz4G1q1wCL21rjDSm0zNEMMw44ASwznUHF3E+rsSUKvu3AmiXliA3F1TGYhhHUmK/gAaoVugMEHT0jWqwerDdbGY1eJlA4LE0nWD9QWS61Nw2qv0SgQkIpCSMP9zfrGGTaw6JoOJk/IVQqVs1j1cLC+VIcNtqrCocBft9cnWn4euICaTyqJs6uGDt49Ybc9Lw7ZHKuKLkobxj8dLhPpMn8fE1hOJ8zDSrGLGYU2D0YLoVW/m06MFe+KoRsz7Fl3KYhcTF0MMtQ2nfHQCLAan22sxtXGL9xJHZq9J2ayvqR8oScIgU2EjUaee/7iaSMsl5u0R4VOXoArZBxqslAQ3N0a0QFbNxV/MdWTXzjVqGBMt7i9JmJ2Itku7YGLyJA6U1SyWgEuNRToMoHFqukY2ZFGWHUcdPH2viRgqRFghaUdfBGSU7IVTCRqhoM5lwWS7grfBLdBz3F2uXzsz9igenNqZFVsWm3tnFisRGBtfOqyd2pXmcAs3THiQn+vWPbR0+eHB08y288uI3OKyWHhkkQJf373L+/8BP/gwZ/2ayloKlvaxnB0II6aYLJWtE0RWSGCqUH3+Pp23Bkux9aA//OjntV1wQXwIn4xF3oWvnkpyfw6YM11Risq5stFrRObKsJJwo6UtiUUosIwsLQ8/Ye57GQC/pxACxsUJWnUgW/VBUs8mxQqFWT5+MpUPJ2s23Hwusrp2wT1qRUD1quNpPN7j72nJFn0RmeZd03iiyeb29ubm5vbzy+jD15M6vUL2PmowzrLd8Tr2s/vuavweCHcosVoSja8de2T2dzu1hFUNxDQRfNP0ok0cv3i1RUBl5uyohZzwy+prMMVAiueq/JkjUXBik76gG8LTxLeD1iyqAR/pEzv4NMv7mZK7q1q1MgGVnhnRmCPkUnCN7KdORzHsYlOFo7YUPIjQuqeGyNb7klhjpX9LBFYjz32bqYsxFC+UHCR2zjMfERO5rCxh2GhHGLvf0kzqCOd4IEHjT9OvP8QI01lBe4RXk8J7ZGRRm5ZWvcen69+5hoqxBSEcwgqdnsRgOuE98GF6HJJl6eFpOvZWVFb29AoWM2YN9a5G5mM1lgR0BmtWbNOV6vo8iqrib0174SxV1niiltcX19jqvj63de5twRaAobNInxbHBYbo+j48qBOVlgp8h7IytlNnxUKfI0A65NEYJHceyGUe2eKdLCWDZolN1O26QHrZWGPuNWURZ1f/TVVE/2yWfHpgetra6E9MlIP05A2l0McAK8Aoz/hpnN7UYd7PnYxdZI4uI3g8p7DmKBr4Mxn3ATO7G7Rk9d/QrHTtCK9prg5S/KiiylNpQ2cUKVLvFqxmtiOFQWWzCtL7NavPcxcf3/0/tvcW3CJAC2i2SSSrz3q93od64acDupkRe6DNprlUsaGwfJC2e3yCy2TW9k5E2LvrxN6siAuFMOZsnz2YNsF1sGjRpRdCz97OsNvKrvMHuwTkwjOVos0PGC/O5alJ9xsCkb/CgzVNTFUbEzJ8UoFARd4kO4YsYXwKpe78Nx6KbQEeLHfbDqVUJNYbu7t+pOGTYtaJqLqE/uKkoXkNbl2Fvh2lkRpa2qFskh8wR+yWPi4Or7+Ae7nf//xFqCVOyvxvhyY6Jt/zwnEP7ncnyrpqhDOcnmh6TKTXz9OBhbZAhZh7wn5ctoXepNljReuL8w8wbAwHy3qvElo9Vv/1MzisqlsGy5w6e5pMUOY6HU9LABrPYabjcNKQ/FkpY4dX+VZRTB8DNKQgKtONleMlz1X65qFUKlUWbavqrqyrASCnyzbHOYziARRbmZf0I4Qd0lSo+isbaetmSUzLJahz64DYP2EN/Sbr/9JoFXDZLmc6pOLUt/hUs1yB/K7pptm+m0yrjZ+l4+z96S0Ju0LPZL1DKn75nYm8+ySUdT5WWM/pr8rPXuY2fRYXF45LYaQdTK0xu4Sk3H3BqeVpJOVMna8phXPT8+rWI9a4RbRgUDs0BuenKRbeQ4mqwzImngNWLrBOYCeoA+waU0nGBPksjOnWabnJ2S5XVAoISnWTnnwnaPQe5H34or5ElcesI6OvvgjgZZxiiVkTUiHLHuaa62X/x74wJLTUSxWilQQ/n2UKkdqtkmw9hQwlcns7u+8IOz9TODTpVvZjTFsXL0EXH3kBZ64JN0MeUOM7jo9nFY6SWZUMqnfKkr+rFSU2dgKHEj6MUqxUybwUXIYNcyti6AlRnT/DIMzx242L+jJZ03Gl596E1kyyHrWDvVjeXksQ51SwPrRv6dffIXQUtUCfEHNTGO2JNNyJusK2Dp34QPLZdZhoeSVKdIIe3+dNGlK1Qvd4bLCo+39/f2dnZ2PXyHJyodJFpu9o273335csztO8HG1B7jaxpyG520JsgQGFtYwItnkS7UC/kr4UTsviZqZ0mWsDwxRZAjhg20QV7RVkkZW2VcgKo8BV1KAq3N0KlQCRTDj6rdGzhkyMu/oCgNg/Sd4YO//lCPQyqFdNlNgS5I7dD/jih6uC2/wQysSg5X/zca682mMvSdXdShf6JYj83uvth4+fLi19WDr80ZEIxBA+veYzuT3vn5bcmekbFY9XDUOM9uZ3d3dzPbuQdZDVtW8LyRkUyidFRQv1VpQCLZQnVST7zV9JLP4mdDp+ui5qI9D04KYsuxiUgTIW5eKBjT+3P0wFCtlzQnq8374WnndzbOOA451RaUL37z/FhUFMQd3el6U12ML3KF1hwXsxJaIMQk5sEJM7t+jda5w4xNPPJm6ua/579LtCvdI1h8ebH0MZ2Pj8z2Se9fYkzpvvvwfZWfzm0Z6BvA9cNhexvaMLUtjoaHdRIIaJBqKeqh6SbYXXDQaTWREMBKRrSgS2BYgGNkc8AeGxDF2I/lAlO0BuUduPfWyalVpK62IVEX7F+xhT/wRfZ7nfed7GMh7sGMCA8z85vl+n4e3Lr08Z722wku5ix1mt8u9jCiipl3fAriSPRYnrXbUY/WLsModNvMlZ9IcVWKVunYXqfft4sNR9XVOCwhtFVSw+q8u4Pxj5bL7mxW063OqoMHgh4OrJv80paYNVsBE+dPxwBN/iZ5yI8siq+2SBB9/+YGspr29A73VWUJuFdTzsNoISl3TZA0wk/hWivyjPy1jvZdcwSF1GJLic+pCpm/lb1dW2H7YJ7JP+r3+B2td+uO/ESnWEvCFWljUFLB8XGvq7BsgV+LmOgjFjfWtrc0MI0vHao7jZdtIlI+1w5aJldzrmZlHHSVYFauOGjWNamGxk5RvZoqqFun/1Fqj0221GsdB1fjDwSXggw6pbxZgQRsOb4ZDzRH2LmtNi3JbZBVv7gOs94E3Pk+O3N7OyCbLIwmeK29JAFH+oQpKH9hSQ4UWiNXZJBpUG0ElEe22qrk3FbqnBgRVzsT8jlZYgZ5zpHPZEyvjdYPuDRWffrS7TL5AprSF/dsAq26Vn/deBqwrLNtfW1tdBbSALK7L8k1AS11GWIEn2LJKfHpGKtXrGZbg4gVlOEK02znETlIomcrH5sKuZTmt1qCaRixqLFUPg8MVcEcO1cA7BsfYuXogYKLVzn9a2Qrt5sGXv6uUvFHa4mCCwY3KwbjN0aJAlkMb/tS2dBtWA9ar6KyEwlUooG89fSh52aqcKthvzU4x8qL3fP7JUm6h6y588bf/hk7e1SzVwCw5HtNY8c/ngecMgKnrG0BKm1N8orojlmq5WOtUdVO6ZDCSgVyBVFxDsiQus+ASA1pquApTy7hJulm1sDJ6qW0hkk3HevwoDrroOTikFhDrdjt8dbvNZssqadSZr6MGZXo0TVuu56F92xvsQ5iVltrx2Lf/6+Bg4i16VwezceWU+t3sEln97513/qfPuwDcbHJvbg3HclCdWZTluecLxOr5RXs2Ze2ZWYkq/ON+cnTU/uBsZ2mWtcR+HwoWNU/WdVc4O7TjsbP7/3GH3sKMwq4xI8sdGg9Byiy2AhuTTUovUrlzt2pJl1hSEATJqq4GsrY2xWysZ+KAvWFygSPWSX3hBAoHVcBpLBmhsFs8m4r2DFn2FCrqJmIBy4mhxy1dfq8ly9F1eMWRkVJc1oN2fOM3sirjG3/k7GKqnO7tVCrKFIWWHW8ArH7msPXbKIAqVhIVa+RxmgJ29isHzRkCmXt9ebvbfjca42Sgeil6TzNZP3xw++/8qi9Qhr/io1aLrkxMWMDBqQsbeRe7z2RvDf3i845GbJVpoUNQN03UNiYGqW2gQLKrq0FmrW+KYjxlyHmbLbKQiKQim8yE70/Kq9nKO4gwDCUTF1lqUxCF7WQqEZMNwwvXMkuvdnLl5byGmqeeGqdOss+k99Jihr29KbLUa3/z3oriT1FoufOLUfT0AIv3KLXDdOGrf37/c98RhtidjR6oqmbHQVee6fyadcZU1ZrFh9WCuAvqCvfXvXtHA+n6d54yal7fsMAz/PoPfut9wRhfhy7kYdg/8oM9jfo2Ki68n8mzBCMaQ2L4y+YgmomIEeJq1WyWswIiSwIosgmbB2aAt5qkv7qouUh3VflBrRJXOZE0sTLZisSBLiUKdBmyvgRPssWhXmod5hYHt9Vio1Xt4rQodgGBsUbXLJA00pFNSrDabQ5wWKFPF5YGAe9TGKIjB8xUSpPbfv/q06tX/2I60LkwE4/Kba9iV5pRy/udul7FU9bBHqU1XNZQ4/3acHA3u53BmsKaPIAOVd33Rq1K3+B3Xy9hvTfcuvA/IUMJf7I1Lgs4WO/AdWFzaZFVLHaDL6hsRFFcca6s6momsoCJeEZx6jH070qEZSlAdeV1WY6lsoITK8YWOAYiwJVOgfCKAjd8wfOJcyZYdPPhqJJIJxOyaeK1DrXQsYjAUa0LvihGzDqsx+xhp5U3rb1oEmO+aYPNcTjmunAQ9ReRToZBFt3+9cXsYQeMoUp01O7vfv585aHKgqsNguu+zrf2OIrW+FzFeonuwCpb7AbCvqX1+g6WjFRwL9ihS+zyyx4ecnj8rU5JHSdYanDyGCddfgIXz45sgiHn0rZPCSx9WZGFybJAqgCrrChGvFwhWCCy6D8AraXkDADBhJUkmDS5+UK4SHhlM5lUQkkklFgUYIKD40vhVzQWiymJFNbJRkQpko4aZiAMhVFAeIJTpYITQr4fUs+cQIyd8a+YyMKbiltxJrLMbG3h3C+yKpPgdH2hcH47VcA7BBN72u4HY8XZQriwSPaA1yw734RvJbMX/cWQsjaDNZ0qjYuscF248tTwGVkBs7tevfyGpqfenQ9eOObgsHew0N14FJAmnu8caTz4bFnR7FLmlfS2iDUTXq6YyNoiRERAKxGl6z/XEiIusHQ6LolOjHyiix6XJEmMx4Gw7WwymUmnM/gDfmW3twEpcE7pdaKYVEw9XKrnraGbFl+k8Yqq1uhWTYwssWrL43QcvqBIGVbW84cVmBRuThRvLKkymdMhS9tXLwmtvVOw4tshZBFbYHJNR+MHJVpCVCpEDgPp7VvfHCAQZNQFxUSrUs055tcXWQeHJ6G68Ney38hyV+jxEXLmpEtnw3uVjCzb83wamMwLDjKoDR7MMciIpqWTuolLxI7AAliuboQraxvrm0z4AFrZDBngPSZe+DKsFVVIzkg2VoKEyaFNSRT8bNExRUaYudgfiKL9fCmejprBCr1eR0XXcLoPKngOqPPqpTm8G0YiifJYBH93Y51VG8GdTTKrcPn+3tOUqTKa2yxS2x+ecLROF6HF4ELZBXxNxtRXhfTdzsEPbH333Zs3b/7y119wjUdTeNaDbk+AVK7tKeO8t224X0ibC71GlpWKwRly5kjegJQ/2wtkWe9frfLT1GqUyyFQUSSga8bWE/EsCIcUaJtMMrsN51vkQoRx5RawGMza5CIHrroAr00ngC7QWKj0YMVipLsSKZA1gmRThUek3BBmh+DhYLSWWKKYTchWjFUv1UtoCWPoCxv2d9C1BeBM35awd0DVQ+cUbg2BuNpY/XNMZmRRcKxwc/Qe1ZszQvqeNkMH52UK+zcnFyOF2v3fj253F7Bl4dXfbd9y83z69+cfn3+E5ay7u2JPmj2YGwrA1LNta7XGZvaG1jg8/q1MdpELBCqkemnNunz9Yk4dSZnP2DQv+1dbpJn0erWjBaOFUZRcrdFp5tmpl4EriV1+Lh4sCgK44mbWpmkw4eWBV4ABnsyCAqOFqouUlyRJgstSR6w2VldXWXZIEufJrUULLDww4h0xVrCiWKf+ErN6rbC60ZNT6UTM6JlLVlKZbbISRYrPra2uJnuMz2YNk3qFwdnJ5B6UGzODDiqn45M7FfzKwPQ37trdvz66oJ5hgNZktgRaTr5offJ7/n3zSVbzicr9pR1/Z/UHj0JjpI+fBRhZlIrhsy7DxhJ6wAKynva4ZQtOkyfQi6mSIkHVynNrFkPhcYkbOYILA5995SbLIXDc2stSYl4bnWOFCXPMDmFSm54mfAlegikr49m0Yrjj955+A5iVBCckQkI1RQsNtggzHxlXJIBTjKw6inlVy12enbyfKDqzgmhKwR24CIfNw+Ic+2IfYLydPtQRLdy5syxbFmNtb9XBN1dWPf2uuWtyb2fk3VERHnxfIRQ8RpaW+9875/DwuWk95ng+cZhAz3iauI6pdRrJXOZJNwuqumXV9mQMVgVcP3EeV6Y2/CJVZksrTA1hdoizRXBxvJY4CrPguYWHIVal52HLSVVPSWcF+Jx4fHhFPB5n8pWLY8onwAnbkBLsZqznu7XjcmF4eXF2cvkezKAHrOI/Obm4LOc6+Z18d15yVNvXBke3s3H0lA3pmt72v4it/pXbV3v12RFlndYPrL70tsjiQ3tDszq/Qe2l5xtuzfV6IVTMPXDbWOi1pbn5oTPTgwwPbnu0qpbnzcRVIiuIQVeQYTCnOwBLGi6PlsDqbjYcjgCitUY6EeDCehxuo5P88kDGHhFRLG6S5c8VLDATQbYQIXd6SEbVh/t4BVOxCyKLagi2mud5Kjhh6/GEJeY7tXJ5eH53RpWDsODnUfuGChT1UrVbm1OaCGhdn9zOuEasKxOKPywNV//zywBFyMWZWXFRUc7M+lc1twxYj7FAT9c9WzP/39619LSVnuEsWKSbc3yVVVuWXTULu+DKqmV1MepmaDeMLMs6khFyLFHBjgmRibA1MwsQMSARIELKgq3Flj8wm+4rsWr/Aev8iJ738t3OzcekaCA5XyJFxmAH+/F7ed7nfU4vzoaKCIl/1d/zwkpZzol1GOENjQuf/lxs1QI7f4ZVqOsEBByGlhUrWKlopT0IYQtUijkBLwIYY0wc/ALch0JZrPzF07r3LgH/1cTeVJ5Jtd5s4yJvWI2mykdoc0susoris3iw1xuevT+C9RA2ULoWSjK4txeSD3tb6+fvDyFswbUFNweV2R3UWzGxJWTzlAjvjZ8SuXCzsvuTpDBRhDlH+U65cHTQXfCaJmpYqFGwMHQpLDek5qnTCRrjwrvguFWs5Y0QlsJB2g43B0Clw1xo8ZIHNIJYW9n+h/UW4YoAAAriSURBVLHTEl2ILwCYwJg8JdJe51Aoi+IdFSwtikNEfjWbrVYL24cIVFE8VuEYmLlCrTWZqjB/8Gbv/PT90dElNm43RSXdGjj7e2GlFi9Buz8AKdGtzj7dXH8ex8PWiSaQ+P1/9J846VdUxBKXaOmSYCq6eGfyaWRwq3GBRePIP/1O55ngE91uhNUekACnRfR7gBkLvvOFrBYdCAfptB39aUgztJA48IJTy10lzIHweCF5ldEF8BIIcx8YUZZjOOUZUmn6Rm8epidDiItnNv43voBcMsdU2Iu0X0luzP0Ignrn3Q2cSsccL4BYaCNsSrkOctUjGOGMEFvbELgu4yRFrYD/r/HNJ58dIb6ZHQtgbezR+z5npeJv4Isw2P9xYWC9pYlO+S8mNV5wC4qldn3ixxZEqkmlAaCy6I1QqmMRHLAWigpXKpNxjSQSmJa5KHlBoIlElQEvBhgjzDj4dRTKUuFPzYPlD5DeCo2Jfvkl2UUYYyoIgZlaszjVozyxvQM5lBDEGevQumFi0N7F2cfL8edb8C0E+6+RCFxz2NP7X9mfY2wCS9jYvx5dK2DR5aCjp9BAkRZxDrMosMTKhjGMxGkeRCIsbKnwEOVHsUyRSr74/OnN57XwEAcHKmqlRIVU0sHJyQvjTDruw2kIkyBjPNl6dWaL5iE7r8LDtF4gVgPglckElY82Ub5WZrkxCQvzxWllpTnVdGhveqFKdsDW6ccxjp63AVsIrtu7z+N+FLxO7rE1/NUssE7uxDVm4BotH0mhzDRW+bs5L+af/44U6d5iwNoY9t6xSPWld+aS4Q9wbbndbjWbjQbM3KD0WDI+0ETmpIwgkZ6XBH1hSyYwzF/5vJa7FkRV7KdlmXQ2usQDTTWV+xrojebUnH9a1nKzGqAPK7KSrN1wVLrc8RlnmmJWwFb/8sNtxdnGTVp035ldA7xC8HVy/68//vPf92aBdS1ctLa3bw/HtFKxNqSJzrwSi9pC2JyMXb2DsOjHNxSvOq/MTMshS+lSMqLwyPh0BUQSagHCCA0xI0xg/hKP9uJRji2gFUrfi7YhL/tOEZL95aOaf7oJUUzWhWhrMinXW+0azb+XW1U1SYrKiLKU74+PrmaVAW75v8bgVSZ8XY7VdEcJbI77J7ok4k5OxLc3b3aPecGbuYC5+xQv06vYFr5bixOyugSqg32h9PTSr1hlZa049BKRObZKQQ9+n1X6stV58YiHoaXT95anGeWkJ2AvGwA7eJZA3QCUEDD9rFTLcCoN5Oozkv/S1bNuiwgavChs9c7dWr6PWdH5YVsJYujC9LPb2+u7O7fzBLsKPH3+9xIm1bNP4oJY24Crw/5HoqBYmzw3E3Jb6HTm5UKUg6zh5F7RUxOfA5etjYnnceGp9OO+/48LLU/3oPFeBb23NSu2EMZXUhhA52bcIoImnl6Nj2W5QUtiiyRh3Qi94frW1sUZqY2vbmeVT+URWR2+hqn1z9Q6/jAol8G3qYLuTXDKgxH74bNWazTbPRxfdtc1m6G5PSFw768m0SGLJEYgB4HJvUZ6FqerdsjIJbz6wMQYya0/I2hRojPIrxJ3oyaMomIod4aWqW0NEY4tt+pVI2yB1f9GVODaYpe//vj4wxVLZgYjVpFubgqM6YcsTlhi+unm6vCwPz43tuyL38V4hZAiddwqayMQUogpWNbcGYy0bWIQ0q2mIoZ5VhioKE88c1x5uwed+ErF720VsqLCvKUY10x2CYp8LWyB3DASW2voLnf6nl3+xsdHcL2N2xmMIyFAwXFIm+E4DtyiCHZzczOb3V5/AJ/Jy4stVGcKp5YYAevFyzyGLMf5pSfkCAgoWBMS+y47HX08Q4yUW1bm0unwYZ4XWxJUpeAq9pliy/Z2D4v3DbZfs+Eh67OahMzKQtgqTlXYGnR44h8ZuMCk6fwUFv6FjSR4ZB7t4k7OlTgfaENndxdsx8aEROEWNhyyo8ak+odYv9f3U1Kbkb/PUKz/7vFCFugRPBOZKgjpapDNIoZ5BWPqltVAlfpKYGW2D4r4ekgzEDZZ53q0pN+bzdZWGpokzH2L0OUEtgYjIhcb86x3z8/QRfLoiL3FAg4W8ZeXaDtx1gM5HthAddip5R/xfq/UKqvNeKMEALVPl14aDYyNFwxVVQDVEtB/IddClE1TyZy5PYi0/DaOLT6LZpi3BFmfp+GovA8lYaBkldgCJStq8IdzLP1g5V84P3Uvzs/Ozk7do3tWuzfdr56dX1yAxzepPNEGasBOLd/H/fDkWLnhkFbKQUQNPNc0AQZ9gjryJYrLmdBLiwnNk2JwxBD3Mfml555SUyRtzUr5DtUOLFDEe7WQ5naPIDfUnCggtXT2AVzdeP5MCmLBZ114bWwM0QZKqH5X8+l0vN8KkOXocgQf+euCqlwHCSTI1ViVHnXNOqlLweL2ocXHtwUtyY0V1MSzJCU/frGQRXLDooEtqFr2YZl+LaY9U4why1uwwBB+PdNJq5RK2THjsF1qaB4sntw3nTp0AYolowfORFxk05QOPC4R/jVBi7DF8h1tih6mQ3NjGiwrVafTiS7Bh/XwdweYF99+EbzAwGmN1eRibNmOvKbcC+8gprBi/O8o82Hv14QFhZpXlk4BK84T2AmkFuQv9ImnVo8G6tDgbYF1blMmzeDaYaOGjSGpwxcQ3XXZFOzNwb7GXU6nzeXsAsBCurzmIl8TQlZ5IavGcjafsGiBx0/OQtjiIiIgzgdKHJHlcgMXrA7peYermp0dZf7FCAv0m1E+PW6FNuzCeiS5tMjKaDqtt6Fpy6XScX+bNI2reKMEN4BrNSkyCm6Bc/lUgqtHZC8CA72UOHpoQlKTrDTrZTPveMy/hBEI+csN2T+KPKQ0nukX8C7c8ewdTaZorBJdWr8ImLArKWaQaM3sgL+CkcwzL8RKpQBqwr29TJHLp78xJOI7ysIQDlmW4MILWfV0/HJyN4WhX481t7T2zhTESMGKWLUTk3sesia4+q37R9/kjMAFAgljBzvYYq4jXWZ2dOwFNHDFSoNtoBYKWMJ6ap4iISMm9zEFxMl5zLCVF7SXLw6w+RcsYU9iuH85nfBvcIqTYrXBKwrs1LJIRJHKzwhBgnckk8Dqt6XqiYFmuWGQghUrerdkrpcdxFexGMtgTpiKodEcr7JpK5ELpipdE+TdoVKYyiXs+ROkvcSyUqA+muoudJerVKplduMB2IT4iQlbsAo4/3j2I83VtdhVVqmgWAW5QpVVY75kzvcEwxbLDcUiXNguOCzX1mqIsDpgrFrVHZ/EAZu5Sp2setgSwApdiYyPrHypoG9RyclxTi3WJZHqaYYtmvhn5+x3YPKxqAJbXsE9lzqdhiCZkAoHq56A/bYIR405rUZe6RHkCpWOqQRUTx5bPMOONjfh8oZMMuFoCSrMgMd6uOrX1vUI+gpVEqeeA7Z84IploCN3aqNYJm3T9kEUk1Daevd/k/MssCXmjApcGct6sHHhkt9Q4wuYyy9Y8UvOkwlcElyFrHc57SGg0sU7yWv8TQcuAS7l/iXT3QKQ0gjxfAKr5GiRy3T/ymZ1hFkRpb0laYH4xirJ+ZbAZSynKe8UZc+j5Aa6WY/OCvCUJYFVcoy8aHvNvzz+csr1SXn15Hw8U/JSJicQXaIlM+3lJMZy8EczmtN5pgRUyZmPL7WDkDIwloK/Os2UthNMJedhENP2XNJen7nkRUrO/wVjX4qm/wEEgmAVg2EjjgAAAABJRU5ErkJggg==";
cc.loader.loadBinary=function(t,e){var i=this;var n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,true);if(cc.loader.loadBinary._IEFilter){n.setRequestHeader("Accept-Charset","x-user-defined");n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var t=cc._convertResponseBodyToText(n["responseBody"]);e(null,i._str2Uint8Array(t))}else e(r)}}else{if(n.overrideMimeType)n.overrideMimeType("text/plain; charset=x-user-defined");n.onload=function(){n.readyState===4&&n.status===200?e(null,i._str2Uint8Array(n.responseText)):e(r)}}n.send(null)};cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last;cc.loader._str2Uint8Array=function(t){if(!t)return null;var e=new Uint8Array(t.length);for(var i=0;i<t.length;i++){e[i]=t.charCodeAt(i)&255}return e};cc.loader.loadBinarySync=function(t){var e=this;var i=this.getXMLHttpRequest();var n="load "+t+" failed!";i.open("GET",t,false);var r=null;if(cc.loader.loadBinary._IEFilter){i.setRequestHeader("Accept-Charset","x-user-defined");i.send(null);if(i.status!==200){cc.log(n);return null}var s=cc._convertResponseBodyToText(i["responseBody"]);if(s){r=e._str2Uint8Array(s)}}else{if(i.overrideMimeType)i.overrideMimeType("text/plain; charset=x-user-defined");i.send(null);if(i.status!==200){cc.log(n);return null}r=this._str2Uint8Array(i.responseText)}return r};window.Uint8Array=window.Uint8Array||window.Array;if(cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script="<!-- IEBinaryToArray_ByteStr -->\r\n"+"Function IEBinaryToArray_ByteStr(Binary)\r\n"+"   IEBinaryToArray_ByteStr = CStr(Binary)\r\n"+"End Function\r\n"+"Function IEBinaryToArray_ByteStr_Last(Binary)\r\n"+"   Dim lastIndex\r\n"+"   lastIndex = LenB(Binary)\r\n"+"   if lastIndex mod 2 Then\r\n"+"       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n"+"   Else\r\n"+"       IEBinaryToArray_ByteStr_Last = "+'""'+"\r\n"+"   End If\r\n"+"End Function\r\n";var myVBScript=document.createElement("script");myVBScript.type="text/vbscript";myVBScript.textContent=IEBinaryToArray_ByteStr_Script;document.body.appendChild(myVBScript);cc._convertResponseBodyToText=function(t){var e={};for(var i=0;i<256;i++){for(var n=0;n<256;n++){e[String.fromCharCode(i+n*256)]=String.fromCharCode(i)+String.fromCharCode(n)}}var r=IEBinaryToArray_ByteStr(t);var s=IEBinaryToArray_ByteStr_Last(t);return r.replace(/[\s\S]/g,function(t){return e[t]})+s}}var cc=cc||{};var ClassManager={id:0|Math.random()*998,instanceId:0|Math.random()*998,getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};(function(){var t=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(e){var i=this.prototype;var n=Object.create(i);var r=ClassManager.getNewID();ClassManager[r]=i;var s={writable:true,enumerable:false,configurable:true};n.__instanceId=null;function a(){this.__instanceId=ClassManager.getNewInstanceId();if(this.ctor)this.ctor.apply(this,arguments)}a.id=r;s.value=r;Object.defineProperty(n,"__pid",s);a.prototype=n;s.value=a;Object.defineProperty(a.prototype,"constructor",s);this.__getters__&&(a.__getters__=cc.clone(this.__getters__));this.__setters__&&(a.__setters__=cc.clone(this.__setters__));for(var o=0,c=arguments.length;o<c;++o){var l=arguments[o];for(var h in l){var u=typeof l[h]==="function";var d=typeof i[h]==="function";var _=t.test(l[h]);if(u&&d&&_){s.value=function(t,e){return function(){var n=this._super;this._super=i[t];var r=e.apply(this,arguments);this._super=n;return r}}(h,l[h]);Object.defineProperty(n,h,s)}else if(u){s.value=l[h];Object.defineProperty(n,h,s)}else{n[h]=l[h]}if(u){var f,p,m;if(this.__getters__&&this.__getters__[h]){m=this.__getters__[h];for(var g in this.__setters__){if(this.__setters__[g]===m){p=g;break}}cc.defineGetterSetter(n,m,l[h],l[p]?l[p]:n[p],h,p)}if(this.__setters__&&this.__setters__[h]){m=this.__setters__[h];for(var g in this.__getters__){if(this.__getters__[g]===m){f=g;break}}cc.defineGetterSetter(n,m,l[f]?l[f]:n[f],l[h],f,h)}}}}a.extend=cc.Class.extend;a.implement=function(t){for(var e in t){n[e]=t[e]}};return a}})();cc.defineGetterSetter=function(t,e,i,n,r,s){if(t.__defineGetter__){i&&t.__defineGetter__(e,i);n&&t.__defineSetter__(e,n)}else if(Object.defineProperty){var a={enumerable:false,configurable:true};i&&(a.get=i);n&&(a.set=n);Object.defineProperty(t,e,a)}else{throw new Error("browser does not support getters")}if(!r&&!s){var o=i!=null,c=n!=undefined,l=Object.getOwnPropertyNames(t);for(var h=0;h<l.length;h++){var u=l[h];if((t.__lookupGetter__?t.__lookupGetter__(u):Object.getOwnPropertyDescriptor(t,u))||typeof t[u]!=="function")continue;var d=t[u];if(o&&d===i){r=u;if(!c||s)break}if(c&&d===n){s=u;if(!o||r)break}}}var _=t.constructor;if(r){if(!_.__getters__){_.__getters__={}}_.__getters__[r]=e}if(s){if(!_.__setters__){_.__setters__={}}_.__setters__[s]=e}};cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];if(typeof n==="object"&&n&&!(n instanceof cc.Node)&&!(n instanceof HTMLElement)){e[i]=cc.clone(n)}else{e[i]=n}}return e};cc.inject=function(t,e){for(var i in t)e[i]=t[i]};cc.Point=function(t,e){this.x=t||0;this.y=e||0};cc.p=function(t,e){if(t===undefined)return{x:0,y:0};if(e===undefined)return{x:t.x,y:t.y};return{x:t,y:e}};cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y};cc.Size=function(t,e){this.width=t||0;this.height=e||0};cc.size=function(t,e){if(t===undefined)return{width:0,height:0};if(e===undefined)return{width:t.width,height:t.height};return{width:t,height:e}};cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height};cc.Rect=function(t,e,i,n){this.x=t||0;this.y=e||0;this.width=i||0;this.height=n||0};cc.rect=function(t,e,i,n){if(t===undefined)return{x:0,y:0,width:0,height:0};if(e===undefined)return{x:t.x,y:t.y,width:t.width,height:t.height};return{x:t,y:e,width:i,height:n}};cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height};cc._rectEqualToZero=function(t){return t&&t.x===0&&t.y===0&&t.width===0&&t.height===0};cc.rectContainsRect=function(t,e){if(!t||!e)return false;return!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)};cc.rectGetMaxX=function(t){return t.x+t.width};cc.rectGetMidX=function(t){return t.x+t.width/2};cc.rectGetMinX=function(t){return t.x};cc.rectGetMaxY=function(t){return t.y+t.height};cc.rectGetMidY=function(t){return t.y+t.height/2};cc.rectGetMinY=function(t){return t.y};cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)};cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,s=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||s<t.y)};cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)};cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);i.x=Math.min(t.x,e.x);i.y=Math.min(t.y,e.y);i.width=Math.max(t.x+t.width,e.x+e.width)-i.x;i.height=Math.max(t.y+t.height,e.y+e.height)-i.y;return i};cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i);i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i);return i};cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){if(window.DOMParser){this._isSupportDOMParser=true;this._parser=new DOMParser}else{this._isSupportDOMParser=false}},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;if(this._isSupportDOMParser){e=this._parser.parseFromString(t,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(t)}return e}});cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t);var i=e.documentElement;if(i.tagName!=="plist"){cc.warn("Not a plist file!");return{}}var n=null;for(var r=0,s=i.childNodes.length;r<s;r++){n=i.childNodes[r];if(n.nodeType===1)break}e=null;return this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if(i==="dict"){e=this._parseDict(t)}else if(i==="array"){e=this._parseArray(t)}else if(i==="string"){if(t.childNodes.length===1)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}}else if(i==="false"){e=false}else if(i==="true"){e=true}else if(i==="real"){e=parseFloat(t.firstChild.nodeValue)}else if(i==="integer"){e=parseInt(t.firstChild.nodeValue,10)}return e},_parseArray:function(t){var e=[];for(var i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];if(r.nodeType!==1)continue;e.push(this._parseNode(r))}return e},_parseDict:function(t){var e={};var i=null;for(var n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];if(s.nodeType!==1)continue;if(s.tagName==="key")i=s.firstChild.nodeValue;else e[i]=this._parseNode(s)}return e}});cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser;cc._txtLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,n)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,n)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._jsLoader={load:function(t,e,i,n){cc.loader.loadJs(t,n)}};cc.loader.register(["js"],cc._jsLoader);cc._imgLoader={load:function(t,e,i,n){cc.loader.cache[e]=cc.loader.loadImg(t,function(t,i){if(t)return n(t);cc.textureCache.handleLoadedTexture(e);n(null,i)})}};cc.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],cc._imgLoader);cc._serverImgLoader={load:function(t,e,i,n){cc.loader.cache[e]=cc.loader.loadImg(i.src,function(t,i){if(t)return n(t);cc.textureCache.handleLoadedTexture(e);n(null,i)})}};cc.loader.register(["serverImg"],cc._serverImgLoader);cc._plistLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,function(t,e){if(t)return n(t);n(null,cc.plistParser.parse(e))})}};cc.loader.register(["plist"],cc._plistLoader);cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,i){var n=document,r=cc.path,s=this.TYPE,a=document.createElement("style");a.type="text/css";n.body.appendChild(a);var o="";if(isNaN(t-0))o+="@font-face { font-family:"+t+"; src:";else o+="@font-face { font-family:'"+t+"'; src:";if(e instanceof Array){for(var c=0,l=e.length;c<l;c++){var h=e[c];i=r.extname(h).toLowerCase();o+="url('"+e[c]+"') format('"+s[i]+"')";o+=c===l-1?";":","}}else{i=i.toLowerCase();o+="url('"+e+"') format('"+s[i]+"');"}a.textContent+=o+"}";var u=document.createElement("div");var d=u.style;d.fontFamily=t;u.innerHTML=".";d.position="absolute";d.left="-100px";d.top="-100px";n.body.appendChild(u)},load:function(t,e,i,n){var r=this;var s=i.type,a=i.name,o=i.srcs;if(cc.isString(i)){s=cc.path.extname(i);a=cc.path.basename(i,s);r._loadFont(a,i,s)}else{r._loadFont(a,o)}if(document.fonts){document.fonts.load("1em "+a).then(function(){n(null,true)},function(t){n(t)})}else{n(null,true)}}};cc.loader.register(["font","eot","ttf","woff","svg","ttc"],cc._fontLoader);cc._binaryLoader={load:function(t,e,i,n){cc.loader.loadBinary(t,n)}};cc._csbLoader={load:function(t,e,i,n){cc.loader.loadCsb(t,n)}};cc.loader.register(["csb"],cc._csbLoader);window["CocosEngine"]=cc.ENGINE_VERSION="Cocos2d-JS v3.10";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_SUPPORT=1;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;cc.SPRITEBATCHNODE_DEBUG_DRAW=0;cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.IS_RETINA_DISPLAY_SUPPORTED=1;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(t){var e=this===cc?document:this;var i=t instanceof HTMLElement?t:e.querySelector(t);if(i){i.find=i.find||cc.$;i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))};i.addClass=i.addClass||function(t){if(!this.hasClass(t)){if(this.className){this.className+=" "}this.className+=t}return this};i.removeClass=i.removeClass||function(t){if(this.hasClass(t)){this.className=this.className.replace(t,"")}return this};i.remove=i.remove||function(){if(this.parentNode)this.parentNode.removeChild(this);return this};i.appendTo=i.appendTo||function(t){t.appendChild(this);return this};i.prependTo=i.prependTo||function(t){t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this);return this};i.transforms=i.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this};i.position=i.position||{x:0,y:0};i.rotation=i.rotation||0;i.scale=i.scale||{x:1,y:1};i.skew=i.skew||{x:0,y:0};i.translates=function(t,e){this.position.x=t;this.position.y=e;this.transforms();return this};i.rotate=function(t){this.rotation=t;this.transforms();return this};i.resize=function(t,e){this.scale.x=t;this.scale.y=e;this.transforms();return this};i.setSkew=function(t,e){this.skew.x=t;this.skew.y=e;this.transforms();return this}}return i};switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=true;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=true;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=false;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=false;break;default:cc.$.pfx="webkit";cc.$.hd=true}cc.$.trans=cc.$.pfx+"Transform";cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "};cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "};cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "};cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"};cc.$new=function(t){return cc.$(document.createElement(t))};cc.$.findpos=function(t){var e=0;var i=0;do{e+=t.offsetLeft;i+=t.offsetTop}while(t=t.offsetParent);return{x:e,y:i}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(t,e,i){if(cc.isObject(i)&&!cc.isUndefined(i.x)&&!cc.isUndefined(i.y)){var n=i[t];i[t]=i[e];i[e]=n}else cc.log(cc._LogInfos.swap)};cc.lerp=function(t,e,i){return t+(e-t)*i};cc.rand=function(){return Math.random()*16777215};cc.randomMinus1To1=function(){return(Math.random()-.5)*2};cc.random0To1=Math.random;cc.degreesToRadians=function(t){return t*cc.RAD};cc.radiansToDegrees=function(t){return t*cc.DEG};cc.radiansToDegress=function(t){cc.log(cc._LogInfos.radiansToDegress);return t*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.nodeDrawSetup=function(t){if(t._shaderProgram){t._shaderProgram.use();t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4()}};cc.enableDefaultGLStates=function(){};cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t};cc.FLT_EPSILON=1.192092896e-7;cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1};cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)};cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)};cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i;e.y=t.y/i};cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)};cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)};cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i;e.height=t.height/i};cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return t};cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return t};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.LINEAR=9729;cc.REPEAT=10497;cc.CLAMP_TO_EDGE=33071;cc.MIRRORED_REPEAT=33648;cc.BLEND_SRC=cc.SRC_ALPHA;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA){cc.BLEND_SRC=cc.ONE}});cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA;cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();if(t){cc.log(cc._LogInfos.checkGLErrorDebug,t)}}};cc.DEVICE_ORIENTATION_PORTRAIT=0;cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1;cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3;cc.DEVICE_MAX_ORIENTATIONS=2;cc.VERTEX_ATTRIB_FLAG_NONE=0;cc.VERTEX_ATTRIB_FLAG_POSITION=1<<0;cc.VERTEX_ATTRIB_FLAG_COLOR=1<<1;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=1<<2;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=3;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;cc.NORMAL_TAG=8801;cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc.arrayVerifyType=function(t,e){if(t&&t.length>0){for(var i=0;i<t.length;i++){if(!(t[i]instanceof e)){cc.log("element type is wrong!");return false}}}return true};cc.arrayRemoveObject=function(t,e){for(var i=0,n=t.length;i<n;i++){if(t[i]===e){t.splice(i,1);break}}};cc.arrayRemoveArray=function(t,e){for(var i=0,n=e.length;i<n;i++){cc.arrayRemoveObject(t,e[i])}};cc.arrayAppendObjectsToIndex=function(t,e,i){t.splice.apply(t,[i,0].concat(e));return t};cc.copyArray=function(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n};cc._tmp.PrototypeColor=function(){var t=cc.color;t._getWhite=function(){return t(255,255,255)};t._getYellow=function(){return t(255,255,0)};t._getBlue=function(){return t(0,0,255)};t._getGreen=function(){return t(0,255,0)};t._getRed=function(){return t(255,0,0)};t._getMagenta=function(){return t(255,0,255)};t._getBlack=function(){return t(0,0,0)};t._getOrange=function(){return t(255,127,0)};t._getGray=function(){return t(166,166,166)};t.WHITE;cc.defineGetterSetter(t,"WHITE",t._getWhite);t.YELLOW;cc.defineGetterSetter(t,"YELLOW",t._getYellow);t.BLUE;cc.defineGetterSetter(t,"BLUE",t._getBlue);t.GREEN;cc.defineGetterSetter(t,"GREEN",t._getGreen);t.RED;cc.defineGetterSetter(t,"RED",t._getRed);t.MAGENTA;cc.defineGetterSetter(t,"MAGENTA",t._getMagenta);t.BLACK;cc.defineGetterSetter(t,"BLACK",t._getBlack);t.ORANGE;cc.defineGetterSetter(t,"ORANGE",t._getOrange);t.GRAY;cc.defineGetterSetter(t,"GRAY",t._getGray);cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)};cc.BlendFunc.DISABLE;cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable);cc.BlendFunc.ALPHA_PREMULTIPLIED;cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied);cc.BlendFunc.ALPHA_NON_PREMULTIPLIED;cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied);cc.BlendFunc.ADDITIVE;cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)};var cc=cc||{};cc._tmp=cc._tmp||{};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL){return}cc.color=function(t,e,i,n,r,s){if(t===undefined)return new cc.Color(0,0,0,255,r,s);if(cc.isString(t)){var a=cc.hexToColor(t);return new cc.Color(a.r,a.g,a.b,a.a)}if(cc.isObject(t))return new cc.Color(t.r,t.g,t.b,t.a,t.arrayBuffer,t.offset);return new cc.Color(t,e,i,n,r,s)};cc.Color=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT);this._offset=s||0;var a=this._arrayBuffer,o=this._offset,c=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(a,o,1);this._gU8=new Uint8Array(a,o+c,1);this._bU8=new Uint8Array(a,o+c*2,1);this._aU8=new Uint8Array(a,o+c*3,1);this._rU8[0]=t||0;this._gU8[0]=e||0;this._bU8[0]=i||0;this._aU8[0]=n==null?255:n;if(n===undefined)this.a_undefined=true};cc.Color.BYTES_PER_ELEMENT=4;var t=cc.Color.prototype;t._getR=function(){return this._rU8[0]};t._setR=function(t){this._rU8[0]=t<0?0:t};t._getG=function(){return this._gU8[0]};t._setG=function(t){this._gU8[0]=t<0?0:t};t._getB=function(){return this._bU8[0]};t._setB=function(t){this._bU8[0]=t<0?0:t};t._getA=function(){return this._aU8[0]};t._setA=function(t){this._aU8[0]=t<0?0:t};t.r;cc.defineGetterSetter(t,"r",t._getR,t._setR);t.g;cc.defineGetterSetter(t,"g",t._getG,t._setG);t.b;cc.defineGetterSetter(t,"b",t._getB,t._setB);t.a;cc.defineGetterSetter(t,"a",t._getA,t._setA);cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();delete cc._tmp.PrototypeColor;cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT);this._offset=n||0;this._xF32=new Float32Array(this._arrayBuffer,this._offset,1);this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1);this._xF32[0]=t||0;this._yF32[0]=e||0};cc.Vertex2F.BYTES_PER_ELEMENT=8;t=cc.Vertex2F.prototype;t._getX=function(){return this._xF32[0]};t._setX=function(t){this._xF32[0]=t};t._getY=function(){return this._yF32[0]};t._setY=function(t){this._yF32[0]=t};t.x;cc.defineGetterSetter(t,"x",t._getX,t._setX);t.y;cc.defineGetterSetter(t,"y",t._getY,t._setY);cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT);this._offset=r||0;var s=this._arrayBuffer,a=this._offset;this._xF32=new Float32Array(s,a,1);this._xF32[0]=t||0;this._yF32=new Float32Array(s,a+Float32Array.BYTES_PER_ELEMENT,1);this._yF32[0]=e||0;this._zF32=new Float32Array(s,a+Float32Array.BYTES_PER_ELEMENT*2,1);this._zF32[0]=i||0};cc.Vertex3F.BYTES_PER_ELEMENT=12;t=cc.Vertex3F.prototype;t._getX=function(){return this._xF32[0]};t._setX=function(t){this._xF32[0]=t};t._getY=function(){return this._yF32[0]};t._setY=function(t){this._yF32[0]=t};t._getZ=function(){return this._zF32[0]};t._setZ=function(t){this._zF32[0]=t};t.x;cc.defineGetterSetter(t,"x",t._getX,t._setX);t.y;cc.defineGetterSetter(t,"y",t._getY,t._setY);t.z;cc.defineGetterSetter(t,"z",t._getZ,t._setZ);cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT);this._offset=n||0;this._uF32=new Float32Array(this._arrayBuffer,this._offset,1);this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1);this._uF32[0]=t||0;this._vF32[0]=e||0};cc.Tex2F.BYTES_PER_ELEMENT=8;t=cc.Tex2F.prototype;t._getU=function(){return this._uF32[0]};t._setU=function(t){this._uF32[0]=t};t._getV=function(){return this._vF32[0]};t._setV=function(t){this._vF32[0]=t};t.u;cc.defineGetterSetter(t,"u",t._getU,t._setU);t.v;cc.defineGetterSetter(t,"v",t._getV,t._setV);cc.Quad2=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT);this._offset=s||0;var a=this._arrayBuffer,o=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,a,0):new cc.Vertex2F(0,0,a,0);this._tr=e?new cc.Vertex2F(e.x,e.y,a,o):new cc.Vertex2F(0,0,a,o);this._bl=i?new cc.Vertex2F(i.x,i.y,a,o*2):new cc.Vertex2F(0,0,a,o*2);this._br=n?new cc.Vertex2F(n.x,n.y,a,o*3):new cc.Vertex2F(0,0,a,o*3)};cc.Quad2.BYTES_PER_ELEMENT=32;t=cc.Quad2.prototype;t._getTL=function(){return this._tl};t._setTL=function(t){this._tl.x=t.x;this._tl.y=t.y};t._getTR=function(){return this._tr};t._setTR=function(t){this._tr.x=t.x;this._tr.y=t.y};t._getBL=function(){return this._bl};t._setBL=function(t){this._bl.x=t.x;this._bl.y=t.y};t._getBR=function(){return this._br};t._setBR=function(t){this._br.x=t.x;this._br.y=t.y};t.tl;cc.defineGetterSetter(t,"tl",t._getTL,t._setTL);t.tr;cc.defineGetterSetter(t,"tr",t._getTR,t._setTR);t.bl;cc.defineGetterSetter(t,"bl",t._getBL,t._setBL);t.br;cc.defineGetterSetter(t,"br",t._getBR,t._setBR);cc.Quad3=function(t,e,i,n){this.bl=t||new cc.Vertex3F(0,0,0);this.br=e||new cc.Vertex3F(0,0,0);this.tl=i||new cc.Vertex3F(0,0,0);this.tr=n||new cc.Vertex3F(0,0,0)};cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=r||0;var s=this._arrayBuffer,a=this._offset,o=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,a):new cc.Vertex3F(0,0,0,s,a);this._colors=e?cc.color(e.r,e.g,e.b,e.a,s,a+o):cc.color(0,0,0,0,s,a+o);this._texCoords=i?new cc.Tex2F(i.u,i.v,s,a+o+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,a+o+cc.Color.BYTES_PER_ELEMENT)};cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24;t=cc.V3F_C4B_T2F.prototype;t._getVertices=function(){return this._vertices};t._setVertices=function(t){var e=this._vertices;e.x=t.x;e.y=t.y;e.z=t.z};t._getColor=function(){return this._colors};t._setColor=function(t){var e=this._colors;e.r=t.r;e.g=t.g;e.b=t.b;e.a=t.a};t._getTexCoords=function(){return this._texCoords};t._setTexCoords=function(t){this._texCoords.u=t.u;this._texCoords.v=t.v};t.vertices;cc.defineGetterSetter(t,"vertices",t._getVertices,t._setVertices);t.colors;cc.defineGetterSetter(t,"colors",t._getColor,t._setColor);t.texCoords;cc.defineGetterSetter(t,"texCoords",t._getTexCoords,t._setTexCoords);cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._offset=s||0;var a=this._arrayBuffer,o=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,a,o):new cc.V3F_C4B_T2F(null,null,null,a,o);this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,a,o+c):new cc.V3F_C4B_T2F(null,null,null,a,o+c);this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,a,o+c*2):new cc.V3F_C4B_T2F(null,null,null,a,o+c*2);this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,a,o+c*3):new cc.V3F_C4B_T2F(null,null,null,a,o+c*3)};cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96;t=cc.V3F_C4B_T2F_Quad.prototype;t._getTL=function(){return this._tl};t._setTL=function(t){var e=this._tl;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getBL=function(){return this._bl};t._setBL=function(t){var e=this._bl;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getTR=function(){return this._tr};t._setTR=function(t){var e=this._tr;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getBR=function(){return this._br};t._setBR=function(t){var e=this._br;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getArrayBuffer=function(){return this._arrayBuffer};t.tl;cc.defineGetterSetter(t,"tl",t._getTL,t._setTL);t.tr;cc.defineGetterSetter(t,"tr",t._getTR,t._setTR);t.bl;cc.defineGetterSetter(t,"bl",t._getBL,t._setBL);t.br;cc.defineGetterSetter(t,"br",t._getBR,t._setBR);t.arrayBuffer;cc.defineGetterSetter(t,"arrayBuffer",t._getArrayBuffer,null);cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad};cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}};cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];var e=[];for(var i=0;i<t.length;i++){e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]))}return e};cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=r||0;var s=this._arrayBuffer,a=this._offset,o=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,a):new cc.Vertex2F(0,0,s,a);this._colors=e?cc.color(e.r,e.g,e.b,e.a,s,a+o):cc.color(0,0,0,0,s,a+o);this._texCoords=i?new cc.Tex2F(i.u,i.v,s,a+o+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,a+o+cc.Color.BYTES_PER_ELEMENT)};cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20;t=cc.V2F_C4B_T2F.prototype;t._getVertices=function(){return this._vertices};t._setVertices=function(t){this._vertices.x=t.x;this._vertices.y=t.y};t._getColor=function(){return this._colors};t._setColor=function(t){var e=this._colors;e.r=t.r;e.g=t.g;e.b=t.b;e.a=t.a};t._getTexCoords=function(){return this._texCoords};t._setTexCoords=function(t){this._texCoords.u=t.u;this._texCoords.v=t.v};t.vertices;cc.defineGetterSetter(t,"vertices",t._getVertices,t._setVertices);t.colors;cc.defineGetterSetter(t,"colors",t._getColor,t._setColor);t.texCoords;cc.defineGetterSetter(t,"texCoords",t._getTexCoords,t._setTexCoords);cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT);this._offset=r||0;var s=this._arrayBuffer,a=this._offset,o=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,a):new cc.V2F_C4B_T2F(null,null,null,s,a);this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,a+o):new cc.V2F_C4B_T2F(null,null,null,s,a+o);this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,a+o*2):new cc.V2F_C4B_T2F(null,null,null,s,a+o*2)};cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60;t=cc.V2F_C4B_T2F_Triangle.prototype;t._getA=function(){return this._a};t._setA=function(t){var e=this._a;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getB=function(){return this._b};t._setB=function(t){var e=this._b;e.vertices=t.vertices;e.colors=t.colors;e.texCoords=t.texCoords};t._getC=function(){return this._c};t._setC=function(t){var e=this._c;e.vertices=t.vertices;
e.colors=t.colors;e.texCoords=t.texCoords};t.a;cc.defineGetterSetter(t,"a",t._getA,t._setA);t.b;cc.defineGetterSetter(t,"b",t._getB,t._setB);t.c;cc.defineGetterSetter(t,"c",t._getC,t._setC)});cc.Color=function(t,e,i,n){this.r=t||0;this.g=e||0;this.b=i||0;this.a=n==null?255:n};cc.color=function(t,e,i,n){if(t===undefined)return{r:0,g:0,b:0,a:255};if(cc.isString(t))return cc.hexToColor(t);if(cc.isObject(t))return{r:t.r,g:t.g,b:t.b,a:t.a==null?255:t.a};return{r:t,g:e,b:i,a:n==null?255:n}};cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b};cc.Acceleration=function(t,e,i,n){this.x=t||0;this.y=e||0;this.z=i||0;this.timestamp=n||0};cc.Vertex2F=function(t,e){this.x=t||0;this.y=e||0};cc.vertex2=function(t,e){return new cc.Vertex2F(t,e)};cc.Vertex3F=function(t,e,i){this.x=t||0;this.y=e||0;this.z=i||0};cc.vertex3=function(t,e,i){return new cc.Vertex3F(t,e,i)};cc.Tex2F=function(t,e){this.u=t||0;this.v=e||0};cc.tex2=function(t,e){return new cc.Tex2F(t,e)};cc.BlendFunc=function(t,e){this.src=t;this.dst=e};cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t);var i=e>>16;var n=(e>>8)%256;var r=e%256;return cc.color(i,n,r)};cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|Math.random()*10)},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(t,e){if(e==null)return;var i=this.__getKey();this._keyMapTb[i]=e;this._valueMapTb[i]=t},objectForKey:function(t){if(t==null)return null;var e=this._keyMapTb;for(var i in e){if(e[i]===t)return this._valueMapTb[i]}return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(t==null)return;var e=this._keyMapTb;for(var i in e){if(e[i]===t){delete this._valueMapTb[i];delete e[i];return}}},removeObjectsForKeys:function(t){if(t==null)return;for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});cc.FontDefinition=function(t){var e=this;e.fontName="Arial";e.fontSize=12;e.textAlign=cc.TEXT_ALIGNMENT_CENTER;e.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;e.fillStyle=cc.color(255,255,255,255);e.boundingWidth=0;e.boundingHeight=0;e.strokeEnabled=false;e.strokeStyle=cc.color(255,255,255,255);e.lineWidth=1;e.lineHeight="normal";e.fontStyle="normal";e.fontWeight="normal";e.shadowEnabled=false;e.shadowOffsetX=0;e.shadowOffsetY=0;e.shadowBlur=0;e.shadowOpacity=1;if(t&&t instanceof Object){for(var i in t){e[i]=t[i]}}};cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=!this.lineHeight.charAt?this.lineHeight+"px":this.lineHeight;return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();delete cc._tmp.PrototypeColor}});cc.Touches=[];cc.TouchesIntergerDict={};cc.DENSITYDPI_DEVICE="device-dpi";cc.DENSITYDPI_HIGH="high-dpi";cc.DENSITYDPI_MEDIUM="medium-dpi";cc.DENSITYDPI_LOW="low-dpi";cc.__BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){if(!t||t===this.html)return window.innerWidth;else return t.clientWidth},availHeight:function(t){if(!t||t===this.html)return window.innerHeight;else return t.clientHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};if(window.navigator.userAgent.indexOf("OS 8_1_")>-1)cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI;if(cc.sys.os===cc.sys.OS_IOS)cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI;switch(cc.__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:cc.__BrowserGetter.meta["minimal-ui"]="true";cc.__BrowserGetter.availWidth=function(t){return t.clientWidth};cc.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:cc.__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:cc.__BrowserGetter.availWidth=function(t){return t.clientWidth};cc.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:cc.__BrowserGetter.init=function(t){if(t.__resizeWithBrowserSize)return;var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy);window.removeEventListener("resize",e,false)};window.addEventListener("resize",e,false)};break}cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:false,_autoFullScreen:true,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:false,_captured:false,_wnd:null,_hDC:null,_hRC:null,_supportTouch:false,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:false,_isAdjustViewPort:true,_targetDensityDPI:null,ctor:function(){var t=this,e=document,i=cc.ContainerStrategy,n=cc.ContentStrategy;cc.__BrowserGetter.init(this);t._frame=cc.container.parentNode===e.body?e.documentElement:cc.container.parentNode;t._frameSize=cc.size(0,0);t._initFrameSize();var r=cc._canvas.width,s=cc._canvas.height;t._designResolutionSize=cc.size(r,s);t._originalDesignResolutionSize=cc.size(r,s);t._viewPortRect=cc.rect(0,0,r,s);t._visibleRect=cc.rect(0,0,r,s);t._contentTranslateLeftTop={left:0,top:0};t._viewName="Cocos2dHTML5";var a=cc.sys;t.enableRetina(a.os===a.OS_IOS||a.os===a.OS_OSX);cc.visibleRect&&cc.visibleRect.init(t._visibleRect);t._rpExactFit=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.EXACT_FIT);t._rpShowAll=new cc.ResolutionPolicy(i.PROPORTION_TO_FRAME,n.SHOW_ALL);t._rpNoBorder=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.NO_BORDER);t._rpFixedHeight=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_HEIGHT);t._rpFixedWidth=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_WIDTH);t._hDC=cc._canvas;t._hRC=cc._renderContext;t._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var t;if(this.setDesignResolutionSize){t=this}else{t=cc.view}var e=t._frameSize.width,i=t._frameSize.height;t._initFrameSize();if(t._frameSize.width===e&&t._frameSize.height===i)return;if(t._resizeCallback){t._resizeCallback.call()}var n=t._originalDesignResolutionSize.width;var r=t._originalDesignResolutionSize.height;if(n>0)t.setDesignResolutionSize(n,r,t._resolutionPolicy)},setTargetDensityDPI:function(t){this._targetDensityDPI=t;this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){if(t){if(!this.__resizeWithBrowserSize){this.__resizeWithBrowserSize=true;window.addEventListener("resize",this._resizeEvent);window.addEventListener("orientationchange",this._resizeEvent)}}else{if(this.__resizeWithBrowserSize){this.__resizeWithBrowserSize=false;window.removeEventListener("resize",this._resizeEvent);window.removeEventListener("orientationchange",this._resizeEvent)}}},setResizeCallback:function(t){if(cc.isFunction(t)||t==null){this._resizeCallback=t}},_initFrameSize:function(){var t=this._frameSize;t.width=cc.__BrowserGetter.availWidth(this._frame);t.height=cc.__BrowserGetter.availHeight(this._frame)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width;var e=this._originalDesignResolutionSize.height;if(t>0)this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");if(i&&e){document.head.removeChild(i)}var n=document.getElementsByName("viewport"),r=n?n[0]:null,s,a,o;s=r?r.content:"";i=i||document.createElement("meta");i.id="cocosMetaElement";i.name="viewport";i.content="";for(a in t){if(s.indexOf(a)==-1){s+=","+a+"="+t[a]}else if(e){o=new RegExp(a+"s*=s*[^,]+");s.replace(o,a+"="+t[a])}}if(/^,/.test(s))s=s.substr(1);i.content=s;if(r)r.content=s;document.head.appendChild(i)},_adjustViewportMeta:function(){if(this._isAdjustViewPort){this._setViewportMeta(cc.__BrowserGetter.meta,false)}},_setScaleXYForRenderTexture:function(){var t=cc.contentScaleFactor();this._scaleX=t;this._scaleY=t},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=true},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=t?true:false},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){this._autoFullScreen=t?true:false},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return this._hDC!==null&&this._hRC!==null},setFrameZoomFactor:function(t){this._frameZoomFactor=t;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t;this._frameSize.height=e;this._frame.style.width=t+"px";this._frame.style.height=e+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return true},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy){e._resolutionPolicy=t}else{var i=cc.ResolutionPolicy;if(t===i.EXACT_FIT)e._resolutionPolicy=e._rpExactFit;if(t===i.SHOW_ALL)e._resolutionPolicy=e._rpShowAll;if(t===i.NO_BORDER)e._resolutionPolicy=e._rpNoBorder;if(t===i.FIXED_HEIGHT)e._resolutionPolicy=e._rpFixedHeight;if(t===i.FIXED_WIDTH)e._resolutionPolicy=e._rpFixedWidth}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0)){cc.log(cc._LogInfos.EGLView_setDesignResolutionSize);return}this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(!n){cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);return}n.preApply(this);if(cc.sys.isMobile)this._adjustViewportMeta();this._initFrameSize();this._originalDesignResolutionSize.width=this._designResolutionSize.width=t;this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&r.scale.length===2){this._scaleX=r.scale[0];this._scaleY=r.scale[1]}if(r.viewport){var s=this._viewPortRect,a=this._visibleRect,o=r.viewport;s.x=o.x;s.y=o.y;s.width=o.width;s.height=o.height;a.x=-s.x/this._scaleX;a.y=-s.y/this._scaleY;a.width=cc._canvas.width/this._scaleX;a.height=cc._canvas.height/this._scaleY;cc._renderContext.setOffset&&cc._renderContext.setOffset(s.x,-s.y)}var c=cc.director;c._winSizeInPoints.width=this._designResolutionSize.width;c._winSizeInPoints.height=this._designResolutionSize.height;n.postApply(this);cc.winSize.width=c._winSizeInPoints.width;cc.winSize.height=c._winSizeInPoints.height;if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){c.setGLDefaultValues()}this._originalScaleX=this._scaleX;this._originalScaleY=this._scaleY;if(cc.DOM)cc.DOM._resetEGLViewDiv();cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t,"target-densitydpi":cc.DENSITYDPI_DEVICE},true);document.body.style.width=t+"px";document.body.style.left="0px";document.body.style.top="0px";this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,a=this._scaleY;cc._renderContext.viewport(t*s*r+this._viewPortRect.x*r,e*a*r+this._viewPortRect.y*r,i*s*r,n*a*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,a=this._scaleY;cc._renderContext.scissor(t*s*r+this._viewPortRect.x*r,e*a*r+this._viewPortRect.y*r,i*s*r,n*a*r)},isScissorEnabled:function(){var t=cc._renderContext;return t.isEnabled(t.SCISSOR_TEST)},getScissorRect:function(){var t=cc._renderContext,e=this._scaleX,i=this._scaleY;var n=t.getParameter(t.SCISSOR_BOX);return cc.rect((n[0]-this._viewPortRect.x)/e,(n[1]-this._viewPortRect.y)/i,n[2]/e,n[3]/i)},setViewName:function(t){if(t!=null&&t.length>0){this._viewName=t}},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return{x:this._devicePixelRatio*(t-i.left),y:this._devicePixelRatio*(i.top+i.height-e)}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,n=this;t.x=(n._devicePixelRatio*(t.x-e.left)-i.x)/n._scaleX;t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-i.y)/n._scaleY},_convertTouchesWithScale:function(t){var e=this._viewPortRect,i=this._scaleX,n=this._scaleY,r,s,a;for(var o=0;o<t.length;o++){r=t[o];s=r._point;a=r._prevPoint;r._setPoint((s.x-e.x)/i,(s.y-e.y)/n);r._setPrevPoint((a.x-e.x)/i,(a.y-e.y)/n)}}});cc.EGLView._getInstance=function(){if(!this._instance){this._instance=this._instance||new cc.EGLView;this._instance.initialize()}return this._instance};cc.ContainerStrategy=cc.Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=t._frame;if(cc.view._autoFullScreen&&cc.sys.isMobile&&n===document.documentElement){cc.screen.autoFullScreen(n)}var r=cc._canvas,s=cc.container;s.style.width=r.style.width=e+"px";s.style.height=r.style.height=i+"px";var a=t._devicePixelRatio=1;if(t.isRetinaEnabled())a=t._devicePixelRatio=window.devicePixelRatio||1;r.width=e*a;r.height=i*a;cc._renderContext.resetCache&&cc._renderContext.resetCache();var o=document.body,c;if(o&&(c=o.style)){c.paddingTop=c.paddingTop||"0px";c.paddingRight=c.paddingRight||"0px";c.paddingBottom=c.paddingBottom||"0px";c.paddingLeft=c.paddingLeft||"0px";c.borderTop=c.borderTop||"0px";c.borderRight=c.borderRight||"0px";c.borderBottom=c.borderBottom||"0px";c.borderLeft=c.borderLeft||"0px";c.marginTop=c.marginTop||"0px";c.marginRight=c.marginRight||"0px";c.marginBottom=c.marginBottom||"0px";c.marginLeft=c.marginLeft||"0px"}},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px";t.height=window.innerHeight+"px";t.overflow="hidden";var e=cc.container.style;e.position="fixed";e.left=e.top="0px";document.body.scrollTop=0}});cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t);Math.abs(e-n)<2&&(n=e);var a=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){}this._result.scale=[r,s];this._result.viewport=a;return this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}});(function(){var t=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,t._frameSize.width,t._frameSize.height)}});var e=cc.ContainerStrategy.extend({apply:function(t,e){var i=t._frameSize.width,n=t._frameSize.height,r=cc.container.style,s=e.width,a=e.height,o=i/s,c=n/a,l,h;o<c?(l=i,h=a*o):(l=s*c,h=n);var u=Math.round((i-l)/2);var d=Math.round((n-h)/2);l=i-2*u;h=n-2*d;this._setupContainer(t,l,h);r.marginLeft=u+"px";r.marginRight=u+"px";r.marginTop=d+"px";r.marginBottom=d+"px"}});var i=t.extend({preApply:function(t){this._super(t);t._frame=document.documentElement},apply:function(t){this._super(t);this._fixContainer()}});var n=e.extend({preApply:function(t){this._super(t);t._frame=document.documentElement},apply:function(t,e){this._super(t,e);this._fixContainer()}});var r=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new t;cc.ContainerStrategy.PROPORTION_TO_FRAME=new e;cc.ContainerStrategy.ORIGINAL_CONTAINER=new r;var s=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=i/e.width,s=n/e.height;return this._buildResult(i,n,i,n,r,s)}});var a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.width,s=e.height,a=i/r,o=n/s,c=0,l,h;a<o?(c=a,l=i,h=s*c):(c=o,l=r*c,h=n);return this._buildResult(i,n,l,h,c,c)}});var o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.width,s=e.height,a=i/r,o=n/s,c,l,h;a<o?(c=o,l=r*c,h=n):(c=a,l=i,h=s*c);return this._buildResult(i,n,l,h,c,c)}});var c=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.height,s=n/r,a=i,o=n;return this._buildResult(i,n,a,o,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});var l=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=e.width,s=i/r,a=i,o=n;return this._buildResult(i,n,a,o,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new s;cc.ContentStrategy.SHOW_ALL=new a;cc.ContentStrategy.NO_BORDER=new o;cc.ContentStrategy.FIXED_HEIGHT=new c;cc.ContentStrategy.FIXED_WIDTH=new l})();cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t);this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t);this._contentStrategy.preApply(t)},apply:function(t,e){this._containerStrategy.apply(t,e);return this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t);this._contentStrategy.postApply(t)},setContainerStrategy:function(t){if(t instanceof cc.ContainerStrategy)this._containerStrategy=t},setContentStrategy:function(t){if(t instanceof cc.ContentStrategy)this._contentStrategy=t}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.screen={_supportsFullScreen:false,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i=this._fnMap,n;for(t=0,l=i.length;t<l;t++){e=i[t];if(e&&e[1]in document){for(t=0,n=e.length;t<n;t++){this._fn[i[0][t]]=e[t]}break}}this._supportsFullScreen=typeof this._fn.requestFullscreen!=="undefined";this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){if(!this._supportsFullScreen)return false;else if(document[this._fn.fullscreenElement]===undefined||document[this._fn.fullscreenElement]===null)return false;else return true},requestFullScreen:function(t,e){if(!this._supportsFullScreen){return}t=t||document.documentElement;if(e){var i=this._fn.fullscreenchange;if(this._preOnFullScreenChange){document.removeEventListener(i,this._preOnFullScreenChange)}this._preOnFullScreenChange=e;document.addEventListener(i,e,false)}return t[this._fn.requestFullscreen]()},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():true},autoFullScreen:function(t,e){t=t||document.body;var i=cc._canvas||t;var n=this;function r(){n.requestFullScreen(t,e);i.removeEventListener(n._touchEvent,r)}this.requestFullScreen(t,e);i.addEventListener(this._touchEvent,r)}};cc.screen.init();cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width;var i=this.height=t.height;var n=t.x,r=t.y,s=r+i,a=n+e;this.topLeft.x=n;this.topLeft.y=s;this.topRight.x=a;this.topRight.y=s;this.top.x=n+e/2;this.top.y=s;this.bottomLeft.x=n;this.bottomLeft.y=r;this.bottomRight.x=a;this.bottomRight.y=r;this.bottom.x=n+e/2;this.bottom.y=r;this.center.x=n+e/2;this.center.y=r+i/2;this.left.x=n;this.left.y=r+i/2;this.right.x=a;this.right.y=r+i/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;cc.inputManager={_mousePressed:false,_isRegisterEvent:false,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:false,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){var t=this._indexBitsUsed;for(var e=0;e<this._maxTouches;e++){if(!(t&1)){this._indexBitsUsed|=1<<e;return e}t>>=1}return-1},_removeUsedIndexBit:function(t){if(t<0||t>=this._maxTouches)return;var e=1<<t;e=~e;this._indexBitsUsed&=e},_glView:null,handleTouchesBegin:function(t){var e,i,n,r,s=[],a=this._touchesIntegerDict;for(var o=0,c=t.length;o<c;o++){e=t[o];r=e.getID();i=a[r];if(i==null){var l=this._getUnUsedIndex();if(l===-1){cc.log(cc._LogInfos.inputManager_handleTouchesBegin,l);continue}n=this._touches[l]=new cc.Touch(e._point.x,e._point.y,e.getID());n._setPrevPoint(e._prevPoint);a[r]=l;s.push(n)}}if(s.length>0){this._glView._convertTouchesWithScale(s);var h=new cc.EventTouch(s);h._eventCode=cc.EventTouch.EventCode.BEGAN;cc.eventManager.dispatchEvent(h)}},handleTouchesMove:function(t){var e,i,n,r=[],s=this._touches;for(var a=0,o=t.length;a<o;a++){e=t[a];n=e.getID();i=this._touchesIntegerDict[n];if(i==null){continue}if(s[i]){s[i]._setPoint(e._point);s[i]._setPrevPoint(e._prevPoint);r.push(s[i])}}if(r.length>0){this._glView._convertTouchesWithScale(r);var c=new cc.EventTouch(r);c._eventCode=cc.EventTouch.EventCode.MOVED;cc.eventManager.dispatchEvent(c)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.EventTouch(e);i._eventCode=cc.EventTouch.EventCode.ENDED;cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.EventTouch(e);i._eventCode=cc.EventTouch.EventCode.CANCELLED;cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){var e,i,n,r=[],s=this._touches,a=this._touchesIntegerDict;for(var o=0,c=t.length;o<c;o++){e=t[o];n=e.getID();i=a[n];if(i==null){continue}if(s[i]){s[i]._setPoint(e._point);s[i]._setPrevPoint(e._prevPoint);r.push(s[i]);this._removeUsedIndexBit(i);delete a[n]}}return r},getHTMLElementPosition:function(t){var e=document.documentElement;var i=window;var n=null;if(cc.isFunction(t.getBoundingClientRect)){n=t.getBoundingClientRect()}else{if(t instanceof HTMLCanvasElement){n={left:0,top:0,width:t.width,height:t.height}}else{n={left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)}}}return{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){var e=null;var i=this._preTouchPool;var n=t.getID();for(var r=i.length-1;r>=0;r--){if(i[r].getID()===n){e=i[r];break}}if(!e)e=t;return e},setPreTouch:function(t){var e=false;var i=this._preTouchPool;var n=t.getID();for(var r=i.length-1;r>=0;r--){if(i[r].getID()===n){i[r]=t;e=true;break}}if(!e){if(i.length<=50){i.push(t)}else{i[this._preTouchPoolPointer]=t;this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50}}},getTouchByXY:function(t,e,i){var n=this._preTouchPoint;var r=this._glView.convertToLocationInView(t,e,i);var s=new cc.Touch(r.x,r.y);s._setPrevPoint(n.x,n.y);n.x=r.x;n.y=r.y;return s},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var r=new cc.EventMouse(i);r.setLocation(t.x,t.y);r._setPrevCursor(n.x,n.y);n.x=t.x;n.y=t.y;return r},getPointByEvent:function(t,e){if(t.pageX!=null)return{x:t.pageX,y:t.pageY};e.left-=document.body.scrollLeft;e.top-=document.body.scrollTop;return{x:t.clientX,y:t.clientY}},getTouchesByEvent:function(t,e){var i=[],n=this._glView;var r,s,a;var o=this._preTouchPoint;var c=t.changedTouches.length;for(var l=0;l<c;l++){r=t.changedTouches[l];if(r){var h;if(cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType)h=n.convertToLocationInView(r.pageX,r.pageY,e);else h=n.convertToLocationInView(r.clientX,r.clientY,e);if(r.identifier!=null){s=new cc.Touch(h.x,h.y,r.identifier);a=this.getPreTouch(s).getLocation();s._setPrevPoint(a.x,a.y);this.setPreTouch(s)}else{s=new cc.Touch(h.x,h.y);s._setPrevPoint(o.x,o.y)}o.x=h.x;o.y=h.y;i.push(s)}}return i},registerSystemEvent:function(t){if(this._isRegisterEvent)return;var e=this._glView=cc.view;var i=this;var n="mouse"in cc.sys.capabilities,r="touches"in cc.sys.capabilities;var s=false;if(cc.sys.isMobile)s=true;if(n){window.addEventListener("mousedown",function(){i._mousePressed=true},false);window.addEventListener("mouseup",function(e){if(s)return;var n=i._mousePressed;i._mousePressed=false;if(!n)return;var r=i.getHTMLElementPosition(t);var a=i.getPointByEvent(e,r);if(!cc.rectContainsPoint(new cc.Rect(r.left,r.top,r.width,r.height),a)){i.handleTouchesEnd([i.getTouchByXY(a.x,a.y,r)]);var o=i.getMouseEvent(a,r,cc.EventMouse.UP);o.setButton(e.button);cc.eventManager.dispatchEvent(o)}},false);t.addEventListener("mousedown",function(e){if(s)return;i._mousePressed=true;var n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);i.handleTouchesBegin([i.getTouchByXY(r.x,r.y,n)]);var a=i.getMouseEvent(r,n,cc.EventMouse.DOWN);a.setButton(e.button);cc.eventManager.dispatchEvent(a);e.stopPropagation();e.preventDefault();t.focus()},false);t.addEventListener("mouseup",function(e){if(s)return;i._mousePressed=false;var n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);i.handleTouchesEnd([i.getTouchByXY(r.x,r.y,n)]);var a=i.getMouseEvent(r,n,cc.EventMouse.UP);a.setButton(e.button);cc.eventManager.dispatchEvent(a);e.stopPropagation();e.preventDefault()},false);t.addEventListener("mousemove",function(e){if(s)return;var n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);i.handleTouchesMove([i.getTouchByXY(r.x,r.y,n)]);var a=i.getMouseEvent(r,n,cc.EventMouse.MOVE);if(i._mousePressed)a.setButton(e.button);else a.setButton(null);cc.eventManager.dispatchEvent(a);e.stopPropagation();e.preventDefault()},false);t.addEventListener("mousewheel",function(e){var n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);var s=i.getMouseEvent(r,n,cc.EventMouse.SCROLL);s.setButton(e.button);s.setScrollData(0,e.wheelDelta);cc.eventManager.dispatchEvent(s);e.stopPropagation();e.preventDefault()},false);t.addEventListener("DOMMouseScroll",function(e){var n=i.getHTMLElementPosition(t);var r=i.getPointByEvent(e,n);var s=i.getMouseEvent(r,n,cc.EventMouse.SCROLL);s.setButton(e.button);s.setScrollData(0,e.detail*-120);cc.eventManager.dispatchEvent(s);e.stopPropagation();e.preventDefault()},false)}if(window.navigator.msPointerEnabled){var a={MSPointerDown:i.handleTouchesBegin,MSPointerMove:i.handleTouchesMove,MSPointerUp:i.handleTouchesEnd,MSPointerCancel:i.handleTouchesCancel};for(var o in a){(function(e,n){t.addEventListener(e,function(e){var r=i.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft;r.top-=document.documentElement.scrollTop;n.call(i,[i.getTouchByXY(e.clientX,e.clientY,r)]);e.stopPropagation()},false)})(o,a[o])}}if(r){t.addEventListener("touchstart",function(e){if(!e.changedTouches)return;var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft;n.top-=document.body.scrollTop;i.handleTouchesBegin(i.getTouchesByEvent(e,n));e.stopPropagation();e.preventDefault();t.focus()},false);t.addEventListener("touchmove",function(e){if(!e.changedTouches)return;var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft;n.top-=document.body.scrollTop;i.handleTouchesMove(i.getTouchesByEvent(e,n));e.stopPropagation();e.preventDefault()},false);t.addEventListener("touchend",function(e){if(!e.changedTouches)return;var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft;n.top-=document.body.scrollTop;i.handleTouchesEnd(i.getTouchesByEvent(e,n));e.stopPropagation();e.preventDefault()},false);t.addEventListener("touchcancel",function(e){if(!e.changedTouches)return;var n=i.getHTMLElementPosition(t);n.left-=document.body.scrollLeft;n.top-=document.body.scrollTop;i.handleTouchesCancel(i.getTouchesByEvent(e,n));e.stopPropagation();e.preventDefault()},false)}this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=true},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){if(this._accelCurTime>this._accelInterval){this._accelCurTime-=this._accelInterval;cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))}this._accelCurTime+=t}};cc.AffineTransform=function(t,e,i,n,r,s){this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=s};cc.affineTransformMake=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}};cc.pointApplyAffineTransform=function(t,e,i){var n,r;if(i===undefined){i=e;n=t.x;r=t.y}else{n=t;r=e}return{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}};cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)};cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}};cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t);var n=cc.rectGetMinX(t);var r=cc.rectGetMaxX(t);var s=cc.rectGetMaxY(t);var a=cc.pointApplyAffineTransform(n,i,e);var o=cc.pointApplyAffineTransform(r,i,e);var c=cc.pointApplyAffineTransform(n,s,e);var l=cc.pointApplyAffineTransform(r,s,e);var h=Math.min(a.x,o.x,c.x,l.x);var u=Math.max(a.x,o.x,c.x,l.x);var d=Math.min(a.y,o.y,c.y,l.y);var _=Math.max(a.y,o.y,c.y,l.y);return cc.rect(h,d,u-h,_-d)};cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t);var n=cc.rectGetMinX(t);var r=cc.rectGetMaxX(t);var s=cc.rectGetMaxY(t);var a=cc.pointApplyAffineTransform(n,i,e);
var o=cc.pointApplyAffineTransform(r,i,e);var c=cc.pointApplyAffineTransform(n,s,e);var l=cc.pointApplyAffineTransform(r,s,e);var h=Math.min(a.x,o.x,c.x,l.x);var u=Math.max(a.x,o.x,c.x,l.x);var d=Math.min(a.y,o.y,c.y,l.y);var _=Math.max(a.y,o.y,c.y,l.y);t.x=h;t.y=d;t.width=u-h;t.height=_-d;return t};cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}};cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}};cc.affineTransformRotate=function(t,e){var i=Math.sin(e);var n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}};cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}};cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,a=t.tx,o=t.ty;t.a=i*e.a+n*e.c;t.b=i*e.b+n*e.d;t.c=r*e.a+s*e.c;t.d=r*e.b+s*e.d;t.tx=a*e.a+o*e.c+e.tx;t.ty=a*e.b+o*e.d+e.ty;return t};cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty};cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)};cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)};cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)};cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)};cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)};cc.pDot=function(t,e){return t.x*e.x+t.y*e.y};cc.pCross=function(t,e){return t.x*e.y-t.y*e.x};cc.pPerp=function(t){return cc.p(-t.y,t.x)};cc.pRPerp=function(t){return cc.p(t.y,-t.x)};cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))};cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)};cc.pLengthSQ=function(t){return cc.pDot(t,t)};cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))};cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))};cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))};cc.pNormalize=function(t){var e=cc.pLength(t);return e===0?cc.p(t):cc.pMult(t,1/e)};cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))};cc.pToAngle=function(t){return Math.atan2(t.y,t.x)};cc.clampf=function(t,e,i){if(e>i){var n=e;e=i;i=n}return t<e?e:t<i?t:i};cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))};cc.pFromSize=function(t){return cc.p(t.width,t.height)};cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))};cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))};cc.pFuzzyEqual=function(t,e,i){if(t.x-i<=e.x&&e.x<=t.x+i){if(t.y-i<=e.y&&e.y<=t.y+i)return true}return false};cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)};cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t);var n=cc.pNormalize(e);var r=Math.atan2(i.x*n.y-i.y*n.x,cc.pDot(i,n));if(Math.abs(r)<cc.POINT_EPSILON)return 0;return r};cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));if(Math.abs(i)<cc.POINT_EPSILON)return 0;return i};cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e);var r=Math.cos(i),s=Math.sin(i);var a=n.x;n.x=a*r-n.y*s+e.x;n.y=a*s+n.y*r+e.y;return n};cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y){return false}var s=e.x-t.x;var a=e.y-t.y;var o=n.x-i.x;var c=n.y-i.y;var l=t.x-i.x;var h=t.y-i.y;var u=c*s-o*a;r.x=o*h-c*l;r.y=s*h-a*l;if(u===0){if(r.x===0||r.y===0){return true}return false}r.x=r.x/u;r.y=r.y/u;return true};cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r))if(r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)return true;return false};cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var s=cc.p(0,0);s.x=t.x+r.x*(e.x-t.x);s.y=t.y+r.x*(e.y-t.y);return s}return cc.p(0,0)};cc.pSameAs=function(t,e){if(t!=null&&e!=null){return t.x===e.x&&t.y===e.y}return false};cc.pZeroIn=function(t){t.x=0;t.y=0};cc.pIn=function(t,e){t.x=e.x;t.y=e.y};cc.pMultIn=function(t,e){t.x*=e;t.y*=e};cc.pSubIn=function(t,e){t.x-=e.x;t.y-=e.y};cc.pAddIn=function(t,e){t.x+=e.x;t.y+=e.y};cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))};cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:false,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){cc.log("getId is deprecated. Please use getID instead.");return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point;this._point=cc.p(e||0,i||0);this._id=t;if(!this._startPointCaptured){this._startPoint=cc.p(this._point);this._startPointCaptured=true}},_setPoint:function(t,e){if(e===undefined){this._point.x=t.x;this._point.y=t.y}else{this._point.x=t;this._point.y=e}},_setPrevPoint:function(t,e){if(e===undefined)this._prevPoint=cc.p(t.x,t.y);else this._prevPoint=cc.p(t||0,e||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:false,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=true},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.FOCUS=4;cc.Event.CUSTOM=6;cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=t},setScrollData:function(t,e){this._scrollX=t;this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t;this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t;this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS);this._widgetGetFocus=e;this._widgetLoseFocus=t}});cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:false,_fixedPriority:0,_node:null,_paused:true,_isEnabled:true,ctor:function(t,e,i){this._onEvent=i;this._type=t||0;this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return this._onEvent!==null},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=5;cc.EventListener.ACCELERATION=6;cc.EventListener.CUSTOM=8;cc.EventListener.FOCUS=7;cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this;var n=function(t){if(i._onCustomEvent!==null)i._onCustomEvent(t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,n)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&this._onCustomEvent!==null},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});cc._EventListenerCustom.create=function(t,e){return new cc._EventListenerCustom(t,e)};cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this;var e=function(e){var i=cc.EventMouse;switch(e._eventType){case i.DOWN:if(t.onMouseDown)t.onMouseDown(e);break;case i.UP:if(t.onMouseUp)t.onMouseUp(e);break;case i.MOVE:if(t.onMouseMove)t.onMouseMove(e);break;case i.SCROLL:if(t.onMouseScroll)t.onMouseScroll(e);break;default:break}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerMouse;t.onMouseDown=this.onMouseDown;t.onMouseUp=this.onMouseUp;t.onMouseMove=this.onMouseMove;t.onMouseScroll=this.onMouseScroll;return t},checkAvailable:function(){return true}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:false,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;t.onTouchBegan=this.onTouchBegan;t.onTouchMoved=this.onTouchMoved;t.onTouchEnded=this.onTouchEnded;t.onTouchCancelled=this.onTouchCancelled;t.swallowTouches=this.swallowTouches;return t},checkAvailable:function(){if(!this.onTouchBegan){cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable);return false}return true}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;t.onTouchesBegan=this.onTouchesBegan;t.onTouchesMoved=this.onTouchesMoved;t.onTouchesEnded=this.onTouchesEnded;t.onTouchesCancelled=this.onTouchesCancelled;return t},checkAvailable:function(){if(this.onTouchesBegan===null&&this.onTouchesMoved===null&&this.onTouchesEnded===null&&this.onTouchesCancelled===null){cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable);return false}return true}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener_create);var e=t.event;delete t.event;var i=null;if(e===cc.EventListener.TOUCH_ONE_BY_ONE)i=new cc._EventListenerTouchOneByOne;else if(e===cc.EventListener.TOUCH_ALL_AT_ONCE)i=new cc._EventListenerTouchAllAtOnce;else if(e===cc.EventListener.MOUSE)i=new cc._EventListenerMouse;else if(e===cc.EventListener.CUSTOM){i=new cc._EventListenerCustom(t.eventName,t.callback);delete t.eventName;delete t.callback}else if(e===cc.EventListener.KEYBOARD)i=new cc._EventListenerKeyboard;else if(e===cc.EventListener.ACCELERATION){i=new cc._EventListenerAcceleration(t.callback);delete t.callback}else if(e===cc.EventListener.FOCUS)i=new cc._EventListenerFocus;for(var n in t){i[n]=t[n]}return i};cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;t.onFocusChanged=this.onFocusChanged;return t},checkAvailable:function(){if(!this.onFocusChanged){cc.log("Invalid EventListenerFocus!");return false}return true},onFocusChanged:null,ctor:function(){var t=function(t){if(this.onFocusChanged)this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,t)}});cc._EventListenerFocus.LISTENER_ID="__cc_focus_event";cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return this._fixedListeners.length===0&&this._sceneGraphListeners.length===0},push:function(t){if(t._getFixedPriority()===0)this._sceneGraphListeners.push(t);else this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});cc.__getListenerID=function(t){var e=cc.Event,i=t.getType();if(i===e.ACCELERATION)return cc._EventListenerAcceleration.LISTENER_ID;if(i===e.CUSTOM)return t.getEventName();if(i===e.KEYBOARD)return cc._EventListenerKeyboard.LISTENER_ID;if(i===e.MOUSE)return cc._EventListenerMouse.LISTENER_ID;if(i===e.FOCUS)return cc._EventListenerFocus.LISTENER_ID;if(i===e.TOUCH){cc.log(cc._LogInfos.__getListenerID)}return""};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1<<0,DIRTY_SCENE_GRAPH_PRIORITY:1<<1,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:false,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){if(this._nodeListenersMap[t.__instanceId]!=null)this._dirtyNodes.push(t);var e=t.getChildren();for(var i=0,n=e.length;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i=this._nodeListenersMap[t.__instanceId],n,r;if(i){for(n=0,r=i.length;n<r;n++)i[n]._setPaused(true)}if(e===true){var s=t.getChildren();for(n=0,r=s.length;n<r;n++)this.pauseTarget(s[n],true)}},resumeTarget:function(t,e){var i=this._nodeListenersMap[t.__instanceId],n,r;if(i){for(n=0,r=i.length;n<r;n++)i[n]._setPaused(false)}this._setDirtyForNode(t);if(e===true){var s=t.getChildren();for(n=0,r=s.length;n<r;n++)this.resumeTarget(s[n],true)}},_addListener:function(t){if(this._inDispatch===0)this._forceAddEventListener(t);else this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID();var i=this._listenersMap[e];if(!i){i=new cc._EventListenerVector;this._listenersMap[e]=i}i.push(t);if(t._getFixedPriority()===0){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();if(n===null)cc.log(cc._LogInfos.eventManager__forceAddEventListener);this._associateNodeAndEventListener(n,t);if(n.isRunning())this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(this._dirtyNodes.length===0)return;var t=this._dirtyNodes,e,i,n=this._nodeListenersMap;for(var r=0,s=t.length;r<s;r++){e=n[t[r].__instanceId];if(e){for(var a=0,o=e.length;a<o;a++){i=e[a];if(i)this._setDirty(i._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY)}}}this._dirtyNodes.length=0},_removeAllListenersInVector:function(t){if(!t)return;var e;for(var i=0;i<t.length;){e=t[i];e._setRegistered(false);if(e._getSceneGraphPriority()!=null){this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e);e._setSceneGraphPriority(null)}if(this._inDispatch===0)cc.arrayRemoveObject(t,e);else++i}},_removeListenersForListenerID:function(t){var e=this._listenersMap[t],i;if(e){var n=e.getFixedPriorityListeners();var r=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r);this._removeAllListenersInVector(n);delete this._priorityDirtyFlagMap[t];if(!this._inDispatch){e.clear();delete this._listenersMap[t]}}var s=this._toAddedListeners,a;for(i=0;i<s.length;){a=s[i];if(a&&a._getListenerID()===t)cc.arrayRemoveObject(s,a);else++i}},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t])e=i[t];if(e!==this.DIRTY_NONE){i[t]=this.DIRTY_NONE;if(e&this.DIRTY_FIXED_PRIORITY)this._sortListenersOfFixedPriority(t);if(e&this.DIRTY_SCENE_GRAPH_PRIORITY){var n=cc.director.getRunningScene();if(n)this._sortListenersOfSceneGraphPriority(t,n);else i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY}}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(!i)return;var n=i.getSceneGraphPriorityListeners();if(!n||n.length===0)return;this._nodePriorityIndex=0;this._nodePriorityMap={};this._visitTarget(e,true);i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();if(!e||!r||!i[r.__instanceId])return-1;else if(!t||!n||!i[n.__instanceId])return 1;return i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(!e)return;var i=e.getFixedPriorityListeners();if(!i||i.length===0)return;i.sort(this._sortListenersOfFixedPriorityAsc);var n=0;for(var r=i.length;n<r;){if(i[n]._getFixedPriority()>=0)break;++n}e.gt0Index=n},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(!e)return;var i=e.getFixedPriorityListeners();var n=e.getSceneGraphPriorityListeners();var r,s;if(n){for(r=0;r<n.length;){s=n[r];if(!s._isRegistered()){cc.arrayRemoveObject(n,s)}else++r}}if(i){for(r=0;r<i.length;){s=i[r];if(!s._isRegistered())cc.arrayRemoveObject(i,s);else++r}}if(n&&n.length===0)e.clearSceneGraphListeners();if(i&&i.length===0)e.clearFixedListeners()},_updateListeners:function(t){var e=this._inDispatch;cc.assert(e>0,cc._LogInfos.EventManager__updateListeners);if(e>1)return;if(t.getType()===cc.Event.TOUCH){this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)}else this._onUpdateListeners(cc.__getListenerID(t));cc.assert(e===1,cc._LogInfos.EventManager__updateListeners_2);var i=this._listenersMap,n=this._priorityDirtyFlagMap;for(var r in i){if(i[r].empty()){delete n[r];delete i[r]}}var s=this._toAddedListeners;if(s.length!==0){for(var a=0,o=s.length;a<o;a++)this._forceAddEventListener(s[a]);this._toAddedListeners.length=0}},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return false;var i=e.event,n=e.selTouch;i._setCurrentTarget(t._node);var r=false,s;var a=i.getEventCode(),o=cc.EventTouch.EventCode;if(a===o.BEGAN){if(t.onTouchBegan){r=t.onTouchBegan(n,i);if(r&&t._registered)t._claimedTouches.push(n)}}else if(t._claimedTouches.length>0&&(s=t._claimedTouches.indexOf(n))!==-1){r=true;if(a===o.MOVED&&t.onTouchMoved){t.onTouchMoved(n,i)}else if(a===o.ENDED){if(t.onTouchEnded)t.onTouchEnded(n,i);if(t._registered)t._claimedTouches.splice(s,1)}else if(a===o.CANCELLED){if(t.onTouchCancelled)t.onTouchCancelled(n,i);if(t._registered)t._claimedTouches.splice(s,1)}}if(i.isStopped()){cc.eventManager._updateListeners(i);return true}if(r&&t._registered&&t.swallowTouches){if(e.needsMutableSet)e.touches.splice(n,1);return true}return false},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);var i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null===e&&null===i)return;var n=t.getTouches(),r=cc.copyArray(n);var s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e){for(var a=0;a<n.length;a++){s.selTouch=n[a];this._dispatchEventToListeners(e,this._onTouchEventCallback,s);if(t.isStopped())return}}if(i&&r.length>0){this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r});if(t.isStopped())return}this._updateListeners(t)},_onTouchesEventCallback:function(t,e){if(!t._registered)return false;var i=cc.EventTouch.EventCode,n=e.event,r=e.touches,s=n.getEventCode();n._setCurrentTarget(t._node);if(s===i.BEGAN&&t.onTouchesBegan)t.onTouchesBegan(r,n);else if(s===i.MOVED&&t.onTouchesMoved)t.onTouchesMoved(r,n);else if(s===i.ENDED&&t.onTouchesEnded)t.onTouchesEnded(r,n);else if(s===i.CANCELLED&&t.onTouchesCancelled)t.onTouchesCancelled(r,n);if(n.isStopped()){cc.eventManager._updateListeners(n);return true}return false},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(!i){i=[];this._nodeListenersMap[t.__instanceId]=i}i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(i){cc.arrayRemoveObject(i,e);if(i.length===0)delete this._nodeListenersMap[t.__instanceId]}},_dispatchEventToListeners:function(t,e,i){var n=false;var r=t.getFixedPriorityListeners();var s=t.getSceneGraphPriorityListeners();var a=0,o,c;if(r){if(r.length!==0){for(;a<t.gt0Index;++a){c=r[a];if(c.isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,i)){n=true;break}}}}if(s&&!n){for(o=0;o<s.length;o++){c=s[o];if(c.isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,i)){n=true;break}}}if(r&&!n){for(;a<r.length;++a){c=r[a];if(c.isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,i)){n=true;break}}}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;if(i[t]==null)i[t]=e;else i[t]=e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0;var r=i.length,s=this._globalZOrderNodeMap,a=this._nodeListenersMap;if(r>0){var o;for(;n<r;n++){o=i[n];if(o&&o.getLocalZOrder()<0)this._visitTarget(o,false);else break}if(a[t.__instanceId]!=null){if(!s[t.getGlobalZOrder()])s[t.getGlobalZOrder()]=[];s[t.getGlobalZOrder()].push(t.__instanceId)}for(;n<r;n++){o=i[n];if(o)this._visitTarget(o,false)}}else{if(a[t.__instanceId]!=null){if(!s[t.getGlobalZOrder()])s[t.getGlobalZOrder()]=[];s[t.getGlobalZOrder()].push(t.__instanceId)}}if(e){var c=[];for(var l in s)c.push(l);c.sort(this._sortNumberAsc);var h=c.length,u,d,_=this._nodePriorityMap;for(n=0;n<h;n++){u=s[c[n]];for(d=0;d<u.length;d++)_[u[d]]=++this._nodePriorityIndex}this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){cc.assert(t&&e,cc._LogInfos.eventManager_addListener_2);if(!(t instanceof cc.EventListener)){cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3);t=cc.EventListener.create(t)}else{if(t._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}}if(!t.checkAvailable())return;if(cc.isNumber(e)){if(e===0){cc.log(cc._LogInfos.eventManager_addListener);return}t._setSceneGraphPriority(null);t._setFixedPriority(e);t._setRegistered(true);t._setPaused(false);this._addListener(t)}else{t._setSceneGraphPriority(e);t._setFixedPriority(0);t._setRegistered(true);this._addListener(t)}return t},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);this.addListener(i,1);return i},removeListener:function(t){if(t==null)return;var e,i=this._listenersMap;for(var n in i){var r=i[n];var s=r.getFixedPriorityListeners(),a=r.getSceneGraphPriorityListeners();e=this._removeListenerInVector(a,t);if(e){this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY)}else{e=this._removeListenerInVector(s,t);if(e)this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)}if(r.empty()){delete this._priorityDirtyFlagMap[t._getListenerID()];delete i[n]}if(e)break}if(!e){var o=this._toAddedListeners;for(var c=0,l=o.length;c<l;c++){var h=o[c];if(h===t){cc.arrayRemoveObject(o,h);h._setRegistered(false);break}}}},_removeListenerInCallback:function(t,e){if(t==null)return false;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e){r._setRegistered(false);if(r._getSceneGraphPriority()!=null){this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r);r._setSceneGraphPriority(null)}if(this._inDispatch===0)cc.arrayRemoveObject(t,r);return true}}return false},_removeListenerInVector:function(t,e){if(t==null)return false;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e){r._setRegistered(false);if(r._getSceneGraphPriority()!=null){this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r);r._setSceneGraphPriority(null)}if(this._inDispatch===0)cc.arrayRemoveObject(t,r);return true}}return false},removeListeners:function(t,e){var i=this;if(t instanceof cc.Node){delete i._nodePriorityMap[t.__instanceId];cc.arrayRemoveObject(i._dirtyNodes,t);var n=i._nodeListenersMap[t.__instanceId],r;if(n){var s=cc.copyArray(n);for(r=0;r<s.length;r++)i.removeListener(s[r]);s.length=0}var a=i._toAddedListeners;for(r=0;r<a.length;){var o=a[r];if(o._getSceneGraphPriority()===t){o._setSceneGraphPriority(null);o._setRegistered(false);a.splice(r,1)}else++r}if(e===true){var c=t.getChildren(),l;for(r=0,l=c.length;r<l;r++)i.removeListeners(c[r],true)}}else{if(t===cc.EventListener.TOUCH_ONE_BY_ONE)i._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID);else if(t===cc.EventListener.TOUCH_ALL_AT_ONCE)i._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID);else if(t===cc.EventListener.MOUSE)i._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID);else if(t===cc.EventListener.ACCELERATION)i._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID);else if(t===cc.EventListener.KEYBOARD)i._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID);else cc.log(cc._LogInfos.eventManager_removeListeners)}},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t){if(e.indexOf(i)===-1)this._removeListenersForListenerID(i)}},setPriority:function(t,e){if(t==null)return;var i=this._listenersMap;for(var n in i){var r=i[n];var s=r.getFixedPriorityListeners();if(s){var a=s.indexOf(t);if(a!==-1){if(t._getSceneGraphPriority()!=null)cc.log(cc._LogInfos.eventManager_setPriority);if(t._getFixedPriority()!==e){t._setFixedPriority(e);this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)}return}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(!this._isEnabled)return;this._updateDirtyFlagForSceneGraph();this._inDispatch++;if(!t||!t.getType)throw new Error("event is undefined");if(t.getType()===cc.Event.TOUCH){this._dispatchTouchEvent(t);this._inDispatch--;return}var e=cc.__getListenerID(t);this._sortEventListeners(e);var i=this._listenersMap[e];if(i!=null)this._dispatchEventToListeners(i,this._onListenerCallback,t);this._updateListeners(t);this._inDispatch--},_onListenerCallback:function(t,e){e._setCurrentTarget(t._getSceneGraphPriority());t._onEvent(e);return e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.EventCustom(t);i.setUserData(e);this.dispatchEvent(i)}};cc._tmp.PrototypeCCNode=function(){var t=cc.Node.prototype;cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX);cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY);t.width;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth);t.height;cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight);t.anchorX;cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX);t.anchorY;cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY);t.skewX;cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX);t.skewY;cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY);t.zIndex;cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder);t.vertexZ;cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ);t.rotation;cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation);t.rotationX;cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX);t.rotationY;cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY);t.scale;cc.defineGetterSetter(t,"scale",t.getScale,t.setScale);t.scaleX;cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX);t.scaleY;cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY);t.children;cc.defineGetterSetter(t,"children",t.getChildren);t.childrenCount;cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount);t.parent;cc.defineGetterSetter(t,"parent",t.getParent,t.setParent);t.visible;cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible);t.running;cc.defineGetterSetter(t,"running",t.isRunning);t.ignoreAnchor;cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition);t.tag;t.userData;t.userObject;t.arrivalOrder;t.actionManager;cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager);t.scheduler;cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler);t.shaderProgram;cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram);t.opacity;cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity);t.opacityModifyRGB;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB);t.cascadeOpacity;cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled);t.color;cc.defineGetterSetter(t,"color",t.getColor,t.setColor);t.cascadeColor;cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:false,_normalizedPositionDirty:false,_skewX:0,_skewY:0,_children:null,_visible:true,_anchorPoint:null,_contentSize:null,_running:false,_parent:null,_ignoreAnchorPointForPosition:false,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:false,_shaderProgram:null,arrivalOrder:0,_actionManager:null,
_scheduler:null,_eventDispatcher:null,_additionalTransformDirty:false,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:false,_className:"Node",_showNode:false,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:false,_cascadeOpacityEnabled:false,_renderCmd:null,_camera:null,ctor:function(){this._initNode();this._initRendererCmd()},_initNode:function(){var t=this;t._anchorPoint=cc.p(0,0);t._contentSize=cc.size(0,0);t._position=cc.p(0,0);t._normalizedPosition=cc.p(0,0);t._children=[];var e=cc.director;t._actionManager=e.getActionManager();t._scheduler=e.getScheduler();t._additionalTransform=cc.affineTransformMakeIdentity();if(cc.ComponentContainer){t._componentContainer=new cc.ComponentContainer(t)}this._realOpacity=255;this._realColor=cc.color(255,255,255,255);this._cascadeColorEnabled=false;this._cascadeOpacityEnabled=false},init:function(){return true},_arrayMakeObjectsPerformSelector:function(t,e){if(!t||t.length===0)return;var i,n=t.length,r;var s=cc.Node._stateCallbackType;switch(e){case s.onEnter:for(i=0;i<n;i++){r=t[i];if(r)r.onEnter()}break;case s.onExit:for(i=0;i<n;i++){r=t[i];if(r)r.onExit()}break;case s.onEnterTransitionDidFinish:for(i=0;i<n;i++){r=t[i];if(r)r.onEnterTransitionDidFinish()}break;case s.cleanup:for(i=0;i<n;i++){r=t[i];if(r)r.cleanup()}break;case s.updateTransform:for(i=0;i<n;i++){r=t[i];if(r)r.updateTransform()}break;case s.onExitTransitionDidStart:for(i=0;i<n;i++){r=t[i];if(r)r.onExitTransitionDidStart()}break;case s.sortAllChildren:for(i=0;i<n;i++){r=t[i];if(r)r.sortAllChildren()}break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector);break}},attr:function(t){for(var e in t){this[e]=t[e]}},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t;if(this._parent)this._parent.reorderChild(this,t);cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(t){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(t)},setGlobalZOrder:function(t){if(this._globalZOrder!==t){this._globalZOrder=t;cc.eventManager._setDirtyForNode(this)}},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){if(this._rotationX!==this._rotationY)cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){if(this._scaleX!==this._scaleY)cc.log(cc._LogInfos.Node_getScale);return this._scaleX},setScale:function(t,e){this._scaleX=t;this._scaleY=e||e===0?e:t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(e===undefined){if(i.x===t.x&&i.y===t.y)return;i.x=t.x;i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t;i.y=e}this._usingNormalizedPosition=false;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var i=this._normalizedPosition;if(e===undefined){i.x=t.x;i.y=t.y}else{i.x=t;i.y=e}this._normalizedPositionDirty=this._usingNormalizedPosition=true;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){if(this._visible!==t){this._visible=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);cc.renderer.childrenOrderDirty=true}},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(e===undefined){if(t.x===i.x&&t.y===i.y)return;i.x=t.x;i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t;i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){if(this._anchorPoint.x===t)return;this._anchorPoint.x=t;this._renderCmd._updateAnchorPointInPoint()},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){if(this._anchorPoint.y===t)return;this._anchorPoint.y=t;this._renderCmd._updateAnchorPointInPoint()},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t;this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t;this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(e===undefined){if(t.width===i.width&&t.height===i.height)return;i.width=t.width;i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t;i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){if(t!==this._ignoreAnchorPointForPosition){this._ignoreAnchorPointForPosition=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){if(this.userObject!==t)this.userObject=t},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){if(!this._actionManager)this._actionManager=cc.director.getActionManager();return this._actionManager},setActionManager:function(t){if(this._actionManager!==t){this.stopAllActions();this._actionManager=t}},getScheduler:function(){if(!this._scheduler)this._scheduler=cc.director.getScheduler();return this._scheduler},setScheduler:function(t){if(this._scheduler!==t){this.unscheduleAllCallbacks();this._scheduler=t}},boundingBox:function(){cc.log(cc._LogInfos.Node_boundingBox);return this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(e!==null){for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}}return null},getChildByName:function(t){if(!t){cc.log("Invalid name");return null}var e=this._children;for(var i=0,n=e.length;i<n;i++){if(e[i]._name===t)return e[i]}return null},addChild:function(t,e,i){e=e===undefined?t._localZOrder:e;var n,r=false;if(cc.isUndefined(i)){i=undefined;n=t._name}else if(cc.isString(i)){n=i;i=undefined}else if(cc.isNumber(i)){r=true;n=""}cc.assert(t,cc._LogInfos.Node_addChild_3);cc.assert(t._parent===null,"child already added. It can't be added again");this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){if(!this._children)this._children=[];this._insertChild(t,e);if(r)t.setTag(i);else t.setName(n);t.setParent(this);t.setOrderOfArrival(cc.s_globalOrderOfArrival++);if(this._running){t.onEnter();if(this._isTransitionFinished)t.onEnterTransitionDidFinish()}if(this._cascadeColorEnabled)t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);if(this._cascadeOpacityEnabled)t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){if(this._parent){if(t===undefined)t=true;this._parent.removeChild(this,t)}},removeFromParentAndCleanup:function(t){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);this.removeFromParent(t)},removeChild:function(t,e){if(this._children.length===0)return;if(e===undefined)e=true;if(this._children.indexOf(t)>-1)this._detachChild(t,e);cc.renderer.childrenOrderDirty=true},removeChildByTag:function(t,e){if(t===cc.NODE_TAG_INVALID)cc.log(cc._LogInfos.Node_removeChildByTag);var i=this.getChildByTag(t);if(!i)cc.log(cc._LogInfos.Node_removeChildByTag_2,t);else this.removeChild(i,e)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(e!==null){if(t===undefined)t=true;for(var i=0;i<e.length;i++){var n=e[i];if(n){if(this._running){n.onExitTransitionDidStart();n.onExit()}if(t)n.cleanup();n.parent=null;n._renderCmd.detachFromParent()}}this._children.length=0;cc.renderer.childrenOrderDirty=true}},_detachChild:function(t,e){if(this._running){t.onExitTransitionDidStart();t.onExit()}if(e)t.cleanup();t.parent=null;t._renderCmd.detachFromParent();cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=true;this._children.push(t);t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Node_reorderChild);cc.renderer.childrenOrderDirty=this._reorderChildDirty=true;t.arrivalOrder=cc.s_globalOrderOfArrival;cc.s_globalOrderOfArrival++;t._setLocalZOrder(e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;var e=t.length,i,n,r;for(i=1;i<e;i++){r=t[i];n=i-1;while(n>=0){if(r._localZOrder<t[n]._localZOrder){t[n+1]=t[n]}else if(r._localZOrder===t[n]._localZOrder&&r.arrivalOrder<t[n].arrivalOrder){t[n+1]=t[n]}else{break}n--}t[n+1]=r}this._reorderChildDirty=false}},draw:function(t){},transformAncestors:function(){if(this._parent!==null){this._parent.transformAncestors();this._parent.transform()}},onEnter:function(){this._isTransitionFinished=false;this._running=true;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter);this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=true;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=false;this.pause();this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit);this.removeAllComponents()},runAction:function(t){cc.assert(t,cc._LogInfos.Node_runAction);this.actionManager.addAction(t,this,!this._running);return t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){if(t===cc.ACTION_TAG_INVALID){cc.log(cc._LogInfos.Node_stopActionByTag);return}this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){if(t===cc.ACTION_TAG_INVALID){cc.log(cc._LogInfos.Node_getActionByTag);return null}return this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var s=arguments.length;if(typeof t==="function"){if(s===1){e=0;i=cc.REPEAT_FOREVER;n=0;r=this.__instanceId}else if(s===2){if(typeof e==="number"){i=cc.REPEAT_FOREVER;n=0;r=this.__instanceId}else{r=e;e=0;i=cc.REPEAT_FOREVER;n=0}}else if(s===3){if(typeof i==="string"){r=i;i=cc.REPEAT_FOREVER}else{r=this.__instanceId}n=0}else if(s===4){r=this.__instanceId}}else{if(s===1){e=0;i=cc.REPEAT_FOREVER;n=0}else if(s===2){i=cc.REPEAT_FOREVER;n=0}}cc.assert(t,cc._LogInfos.Node_schedule);cc.assert(e>=0,cc._LogInfos.Node_schedule_2);e=e||0;i=i==null?cc.REPEAT_FOREVER:i;n=n||0;this.scheduler.schedule(t,this,e,i,n,!this._running,r)},scheduleOnce:function(t,e,i){if(i===undefined)i=this.__instanceId;this.schedule(t,0,0,e,i)},unschedule:function(t){if(!t)return;this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);this.resume()},resume:function(){this.scheduler.resumeTarget(this);this.actionManager&&this.actionManager.resumeTarget(this);cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){if(t===undefined)return this._additionalTransformDirty=false;this._additionalTransform=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._additionalTransformDirty=true},getParentToNodeTransform:function(){this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){var t=this.getNodeToParentTransform();for(var e=this._parent;e!==null;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){t=t||cc.p(0,0);return cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.p(0,0);var e=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return cc.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},update:function(t){if(this._componentContainer&&!this._componentContainer.isEmpty())this._componentContainer.visit(t)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(t){if(this._componentContainer)return this._componentContainer.getComponent(t);return null},addComponent:function(t){if(this._componentContainer)this._componentContainer.add(t)},removeComponent:function(t){if(this._componentContainer)return this._componentContainer.remove(t);return false},removeAllComponents:function(){if(this._componentContainer)this._componentContainer.removeAll()},grid:null,visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty};for(var n=this._parent;n!=null&&n!=t;n=n.getParent()){cc.affineTransformConcatIn(i,n.getNodeToParentTransform())}return i}else{return e}},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getCamera:function(){if(!this._camera)this._camera=new cc.Camera;return this._camera},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);var e=this.getNodeToWorldTransform();t=cc.rectApplyAffineTransform(t,e);if(!this._children)return t;var i=this._children;for(var n=0;n<i.length;n++){var r=i[n];if(r&&r._visible){var s=r._getBoundingBoxToCurrentNode(e);if(s)t=cc.rectUnion(t,s)}}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);var i=t===undefined?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t);e=cc.rectApplyAffineTransform(e,i);if(!this._children)return e;var n=this._children;for(var r=0;r<n.length;r++){var s=n[r];if(s&&s._visible){var a=s._getBoundingBoxToCurrentNode(i);if(a)e=cc.rectUnion(e,a)}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){if(this._cascadeOpacityEnabled===t)return;this._cascadeOpacityEnabled=t;this._renderCmd.setCascadeOpacityEnabledDirty()},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r;e.g=t.g;e.b=t.b;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){if(this._cascadeColorEnabled===t)return;this._cascadeColorEnabled=t;this._renderCmd.setCascadeColorEnabledDirty()},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.Node.CanvasRenderCmd(this);else return new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(t,e){cc.assert(t&&t.length!=0,"Invalid name");cc.assert(e!=null,"Invalid callback function");var i=t.length;var n=0;var r=i;var s=false;if(i>2&&t[0]==="/"&&t[1]==="/"){s=true;n=2;r-=2}var a=false;if(i>3&&t[i-3]==="/"&&t[i-2]==="."&&t[i-1]==="."){a=true;r-=3}var o=t.substr(n,r);if(a)o="[[:alnum:]]+/"+o;if(s)this.doEnumerateRecursive(this,o,e);else this.doEnumerate(o,e)},doEnumerateRecursive:function(t,e,i){var n=false;if(t.doEnumerate(e,i)){n=true}else{var r,s=t.getChildren(),a=s.length;for(var o=0;o<a;o++){r=s[o];if(this.doEnumerateRecursive(r,e,i)){n=true;break}}}},doEnumerate:function(t,e){var i=t.indexOf("/");var n=t;var r=false;if(i!==-1){n=t.substr(0,i);r=true}var s=false;var a,o=this._children,c=o.length;for(var l=0;l<c;l++){a=o[l];if(a._name.indexOf(n)!==-1){if(!r){if(e(a)){s=true;break}}else{s=a.doEnumerate(t,e);if(s)break}}}return s}});cc.Node.create=function(){return new cc.Node};cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.CustomRenderCmd=function(t,e){this._needDraw=true;this._target=t;this._callback=e;this.rendering=function(t,e,i){if(!this._callback)return;this._callback.call(this._target,t,e,i)}};cc.Node._dirtyFlags={transformDirty:1<<0,visibleDirty:1<<1,colorDirty:1<<2,opacityDirty:1<<3,cacheDirty:1<<4,orderDirty:1<<5,textDirty:1<<6,gradientDirty:1<<7,all:(1<<8)-1};cc.Node.RenderCmd=function(t){this._dirtyFlag=1;this._node=t;this._needDraw=false;this._anchorPointInPoints=new cc.Point(0,0);this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0};this._displayedOpacity=255;this._displayedColor=cc.color(255,255,255,255);this._cascadeColorEnabledDirty=false;this._cascadeOpacityEnabledDirty=false;this._curLevel=-1};cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=true;this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=true;this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){if(this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform());return this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x;t.y=e.height*i.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){if(this._dirtyFlag===0&&t!==0)cc.renderer.pushDirtyNode(this);this._dirtyFlag|=t},getParentRenderCmd:function(){if(this._node&&this._node._parent&&this._node._parent._renderCmd)return this._node._parent._renderCmd;return null},_updateDisplayColor:function(t){var e=this._node;var i=this._displayedColor,n=e._realColor;var r,s,a,o;if(this._cascadeColorEnabledDirty&&!e._cascadeColorEnabled){i.r=n.r;i.g=n.g;i.b=n.b;var c=new cc.Color(255,255,255,255);a=e._children;for(r=0,s=a.length;r<s;r++){o=a[r];if(o&&o._renderCmd)o._renderCmd._updateDisplayColor(c)}this._cascadeColorEnabledDirty=false}else{if(t===undefined){var l=e._parent;if(l&&l._cascadeColorEnabled)t=l.getDisplayedColor();else t=cc.color.WHITE}i.r=0|n.r*t.r/255;i.g=0|n.g*t.g/255;i.b=0|n.b*t.b/255;if(e._cascadeColorEnabled){a=e._children;for(r=0,s=a.length;r<s;r++){o=a[r];if(o&&o._renderCmd){o._renderCmd._updateDisplayColor(i);o._renderCmd._updateColor()}}}}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e=this._node;var i,n,r,s;if(this._cascadeOpacityEnabledDirty&&!e._cascadeOpacityEnabled){this._displayedOpacity=e._realOpacity;r=e._children;for(i=0,n=r.length;i<n;i++){s=r[i];if(s&&s._renderCmd)s._renderCmd._updateDisplayOpacity(255)}this._cascadeOpacityEnabledDirty=false}else{if(t===undefined){var a=e._parent;t=255;if(a&&a._cascadeOpacityEnabled)t=a.getDisplayedOpacity()}this._displayedOpacity=e._realOpacity*t/255;if(e._cascadeOpacityEnabled){r=e._children;for(i=0,n=r.length;i<n;i++){s=r[i];if(s&&s._renderCmd){s._renderCmd._updateDisplayOpacity(this._displayedOpacity);s._renderCmd._updateColor()}}}}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;if(t===undefined){var r=e._parent;if(r&&r._cascadeColorEnabled)t=r.getDisplayedColor();else t=cc.color.WHITE}i.r=0|n.r*t.r/255;i.g=0|n.g*t.g/255;i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(t===undefined){var i=e._parent;t=255;if(i&&i._cascadeOpacityEnabled)t=i.getDisplayedOpacity()}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;var i=e&t.colorDirty,n=e&t.opacityDirty;if(i)this._updateDisplayColor();if(n)this._updateDisplayOpacity();if(i||n)this._updateColor();if(e&t.transformDirty){this.transform(this.getParentRenderCmd(),true);this._dirtyFlag=this._dirtyFlag&t.transformDirty^this._dirtyFlag}if(e&t.orderDirty)this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag},getNodeToParentTransform:function(){var t=this._node;if(t._usingNormalizedPosition&&t._parent){var e=t._parent._contentSize;t._position.x=t._normalizedPosition.x*e.width;t._position.y=t._normalizedPosition.y*e.height;t._normalizedPositionDirty=false;this._dirtyFlag=this._dirtyFlag|cc.Node._dirtyFlags.transformDirty}if(this._dirtyFlag&cc.Node._dirtyFlags.transformDirty){var i=this._transform;i.tx=t._position.x;i.ty=t._position.y;var n=1,r=0,s=0,a=1;if(t._rotationX){var o=t._rotationX*.017453292519943295;s=Math.sin(o);a=Math.cos(o)}if(t._rotationY){var c=t._rotationY*.017453292519943295;n=Math.cos(c);r=-Math.sin(c)}i.a=n;i.b=r;i.c=s;i.d=a;var l=t._scaleX,h=t._scaleY;var u=this._anchorPointInPoints.x,d=this._anchorPointInPoints.y;var _=l<1e-6&&l>-1e-6?1e-6:l,f=h<1e-6&&h>-1e-6?1e-6:h;if(l!==1||h!==1){n=i.a*=_;r=i.b*=_;s=i.c*=f;a=i.d*=f}if(t._skewX||t._skewY){var p=Math.tan(-t._skewX*Math.PI/180);var m=Math.tan(-t._skewY*Math.PI/180);if(p===Infinity)p=99999999;if(m===Infinity)m=99999999;var g=d*p;var v=u*m;i.a=n-s*m;i.b=r-a*m;i.c=s-n*p;i.d=a-r*p;i.tx+=n*g+s*v;i.ty+=r*g+a*v}i.tx-=n*u+s*d;i.ty-=r*u+a*d;if(t._ignoreAnchorPointForPosition){i.tx+=u;i.ty+=d}if(t._additionalTransformDirty)this._transform=cc.affineTransformConcat(i,t._additionalTransform)}return this._transform},_syncStatus:function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;var n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i;if(r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();if(r||s)this._updateColor();if(cc._renderType===cc.game.RENDER_TYPE_WEBGL||i&e.transformDirty)this.transform(t,true);if(i&e.orderDirty)this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag},visitChildren:function(){var t=this._node;var e,i=t._children,n;var r=i.length;if(r>0){t.sortAllChildren();for(e=0;e<r;e++){n=i[e];if(n._localZOrder<0)n._renderCmd.visit(this);else break}cc.renderer.pushRenderCommand(this);for(;e<r;e++)i[e]._renderCmd.visit(this)}else{cc.renderer.pushRenderCommand(this)}this._dirtyFlag=0}};(function(){cc.Node.CanvasRenderCmd=function(t){cc.Node.RenderCmd.call(this,t);this._cachedParent=null;this._cacheDirty=false};var t=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.CanvasRenderCmd;t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._worldTransform;this._cacheDirty=true;if(t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c;n.b=i.a*r.b+i.b*r.d;n.c=i.c*r.a+i.d*r.c;n.d=i.c*r.b+i.d*r.d;n.tx=r.a*i.tx+r.c*i.ty+r.tx;n.ty=r.d*i.ty+r.ty+r.b*i.tx}else{n.a=i.a;n.b=i.b;n.c=i.c;n.d=i.d;n.tx=i.tx;n.ty=i.ty}if(e){var s=this._node._children;if(!s||s.length===0)return;var a,o;for(a=0,o=s.length;a<o;a++){s[a]._renderCmd.transform(this,e)}}};t.visit=function(t){var e=this._node;if(!e._visible)return;t=t||this.getParentRenderCmd();if(t)this._curLevel=t._curLevel+1;this._syncStatus(t);this.visitChildren()};t.setDirtyFlag=function(t,e){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e);this._setCacheDirty(e);if(this._cachedParent)this._cachedParent.setDirtyFlag(t,true)};t._setCacheDirty=function(){if(this._cacheDirty===false){this._cacheDirty=true;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}};t._setCachedParent=function(t){if(this._cachedParent===t)return;this._cachedParent=t;var e=this._node._children;for(var i=0,n=e.length;i<n;i++)e[i]._renderCmd._setCachedParent(t)};t.detachFromParent=function(){this._cachedParent=null;var t=this._node._children,e;for(var i=0,n=t.length;i<n;i++){e=t[i];if(e&&e._renderCmd)e._renderCmd.detachFromParent()}};t.setShaderProgram=function(t){};t.getShaderProgram=function(){return null};cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){if(!t)return"source-over";else{if(t.src===cc.SRC_ALPHA&&t.dst===cc.ONE||t.src===cc.ONE&&t.dst===cc.ONE)return"lighter";else if(t.src===cc.ZERO&&t.dst===cc.SRC_ALPHA)return"destination-in";else if(t.src===cc.ZERO&&t.dst===cc.ONE_MINUS_SRC_ALPHA)return"destination-out";else return"source-over"}}})();cc._tmp.PrototypeTexture2D=function(){var t=cc.Texture2D;t.PVRImagesHavePremultipliedAlpha=function(t){cc.PVRHaveAlphaPremultiplied_=t};t.PIXEL_FORMAT_RGBA8888=2;t.PIXEL_FORMAT_RGB888=3;t.PIXEL_FORMAT_RGB565=4;t.PIXEL_FORMAT_A8=5;t.PIXEL_FORMAT_I8=6;t.PIXEL_FORMAT_AI88=7;t.PIXEL_FORMAT_RGBA4444=8;t.PIXEL_FORMAT_RGB5A1=7;t.PIXEL_FORMAT_PVRTC4=9;t.PIXEL_FORMAT_PVRTC2=10;t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888;t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT;var e=cc.Texture2D._M={};e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888";e[t.PIXEL_FORMAT_RGB888]="RGB888";e[t.PIXEL_FORMAT_RGB565]="RGB565";e[t.PIXEL_FORMAT_A8]="A8";e[t.PIXEL_FORMAT_I8]="I8";e[t.PIXEL_FORMAT_AI88]="AI88";e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444";e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1";e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4";e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2";var i=cc.Texture2D._B={};i[t.PIXEL_FORMAT_RGBA8888]=32;i[t.PIXEL_FORMAT_RGB888]=24;i[t.PIXEL_FORMAT_RGB565]=16;i[t.PIXEL_FORMAT_A8]=8;i[t.PIXEL_FORMAT_I8]=8;i[t.PIXEL_FORMAT_AI88]=16;i[t.PIXEL_FORMAT_RGBA4444]=16;i[t.PIXEL_FORMAT_RGB5A1]=16;i[t.PIXEL_FORMAT_PVRTC4]=4;i[t.PIXEL_FORMAT_PVRTC2]=3;var n=cc.Texture2D.prototype;n.name;cc.defineGetterSetter(n,"name",n.getName);n.pixelFormat;cc.defineGetterSetter(n,"pixelFormat",n.getPixelFormat);n.pixelsWidth;cc.defineGetterSetter(n,"pixelsWidth",n.getPixelsWide);n.pixelsHeight;cc.defineGetterSetter(n,"pixelsHeight",n.getPixelsHigh);n.width;cc.defineGetterSetter(n,"width",n._getWidth);n.height;cc.defineGetterSetter(n,"height",n._getHeight)};cc._tmp.PrototypeTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t.totalQuads;cc.defineGetterSetter(t,"totalQuads",t.getTotalQuads);t.capacity;cc.defineGetterSetter(t,"capacity",t.getCapacity);t.quads;cc.defineGetterSetter(t,"quads",t.getQuads,t.setQuads)};cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:true,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:false,_hasMipmaps:false,shaderProgram:null,_textureLoaded:false,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0);this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){if(this._webTextureObj)cc._renderContext.deleteTexture(this._webTextureObj);cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide;
},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var t=this;return"<cc.Texture2D | Name = "+t._name+" | Dimensions = "+t._pixelsWide+" x "+t._pixelsHigh+" | Coordinates = ("+t.maxS+", "+t.maxT+")>"},releaseData:function(t){t=null},keepData:function(t,e){return t},initWithData:function(t,e,i,n,r){var s=this,a=cc.Texture2D;var o=cc._renderContext;var c=o.RGBA,l=o.UNSIGNED_BYTE;var h=cc.Texture2D._B[e];var u=i*h/8;if(u%8===0){o.pixelStorei(o.UNPACK_ALIGNMENT,8)}else if(u%4===0){o.pixelStorei(o.UNPACK_ALIGNMENT,4)}else if(u%2===0){o.pixelStorei(o.UNPACK_ALIGNMENT,2)}else{o.pixelStorei(o.UNPACK_ALIGNMENT,1)}s._webTextureObj=o.createTexture();cc.glBindTexture2D(s);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);switch(e){case a.PIXEL_FORMAT_RGBA8888:c=o.RGBA;break;case a.PIXEL_FORMAT_RGB888:c=o.RGB;break;case a.PIXEL_FORMAT_RGBA4444:l=o.UNSIGNED_SHORT_4_4_4_4;break;case a.PIXEL_FORMAT_RGB5A1:l=o.UNSIGNED_SHORT_5_5_5_1;break;case a.PIXEL_FORMAT_RGB565:l=o.UNSIGNED_SHORT_5_6_5;break;case a.PIXEL_FORMAT_AI88:c=o.LUMINANCE_ALPHA;break;case a.PIXEL_FORMAT_A8:c=o.ALPHA;break;case a.PIXEL_FORMAT_I8:c=o.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}o.texImage2D(o.TEXTURE_2D,0,c,i,n,0,c,l,t);s._contentSize.width=r.width;s._contentSize.height=r.height;s._pixelsWide=i;s._pixelsHigh=n;s._pixelFormat=e;s.maxS=r.width/i;s.maxT=r.height/n;s._hasPremultipliedAlpha=false;s._hasMipmaps=false;s.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);s._textureLoaded=true;return true},drawAtPoint:function(t){var e=this;var i=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0];var n=e._pixelsWide*e.maxS,r=e._pixelsHigh*e.maxT;var s=[t.x,t.y,0,n+t.x,t.y,0,t.x,r+t.y,0,n+t.x,r+t.y,0];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);e._shaderProgram.use();e._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(e);var a=cc._renderContext;a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,false,0,s);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,false,0,i);a.drawArrays(a.TRIANGLE_STRIP,0,4)},drawInRect:function(t){var e=this;var i=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0];var n=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);e._shaderProgram.use();e._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(e);var r=cc._renderContext;r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,false,0,n);r.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,r.FLOAT,false,0,i);r.drawArrays(r.TRIANGLE_STRIP,0,4)},initWithImage:function(t){if(t==null){cc.log(cc._LogInfos.Texture2D_initWithImage);return false}var e=t.getWidth();var i=t.getHeight();var n=cc.configuration.getMaxTextureSize();if(e>n||i>n){cc.log(cc._LogInfos.Texture2D_initWithImage_2,e,i,n,n);return false}this._textureLoaded=true;return this._initPremultipliedATextureWithImage(t,e,i)},initWithElement:function(t){if(!t)return;this._webTextureObj=cc._renderContext.createTexture();this._htmlElementObj=t;this._textureLoaded=true},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){t=t===undefined?false:t;var e=this;if(!cc.game._rendererInitialized)return;if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(!e._htmlElementObj.width||!e._htmlElementObj.height)return;var n=cc._renderContext;cc.glBindTexture2D(e);n.pixelStorei(n.UNPACK_ALIGNMENT,4);if(t)n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);e.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);cc.glBindTexture2D(null);if(t)n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var r=e._htmlElementObj.width;var s=e._htmlElementObj.height;e._pixelsWide=e._contentSize.width=r;e._pixelsHigh=e._contentSize.height=s;e._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888;e.maxS=1;e.maxT=1;e._hasPremultipliedAlpha=t;e._hasMipmaps=false;e.dispatchEvent("load")},initWithString:function(t,e,i,n,r,s){cc.log(cc._LogInfos.Texture2D_initWithString);return null},initWithETCFile:function(t){cc.log(cc._LogInfos.Texture2D_initWithETCFile_2);return false},initWithPVRFile:function(t){cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2);return false},initWithPVRTCData:function(t,e,i,n,r,s){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2);return false},setTexParameters:function(t,e,i,n){var r=this;var s=cc._renderContext;if(e!==undefined)t={minFilter:t,magFilter:e,wrapS:i,wrapT:n};cc.assert(r._pixelsWide===cc.NextPOT(r._pixelsWide)&&r._pixelsHigh===cc.NextPOT(r._pixelsHigh)||t.wrapS===s.CLAMP_TO_EDGE&&t.wrapT===s.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures");cc.glBindTexture2D(r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t.minFilter);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t.magFilter);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t.wrapS);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this);if(!this._hasMipmaps)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this);if(!this._hasMipmaps)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelsWide===cc.NextPOT(t._pixelsWide)&&t._pixelsHigh===cc.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures");cc.glBindTexture2D(t);cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D);t._hasMipmaps=true},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=cc.Texture2D._B[t];if(e!=null)return e;cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,t);return-1},_initPremultipliedATextureWithImage:function(t,e,i){var n=cc.Texture2D;var r=t.getData();var s=null;var a=null;var o=null;var c=t.hasAlpha();var l=cc.size(t.getWidth(),t.getHeight());var h=n.defaultPixelFormat;var u=t.getBitsPerComponent();var d;if(!c){if(u>=8){h=n.PIXEL_FORMAT_RGB888}else{cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage);h=n.PIXEL_FORMAT_RGB565}}var _=e*i;if(h===n.PIXEL_FORMAT_RGB565){if(c){r=new Uint16Array(e*i);s=t.getData();for(d=0;d<_;++d){r[d]=(s[d]>>0&255)>>3<<11|(s[d]>>8&255)>>2<<5|(s[d]>>16&255)>>3<<0}}else{r=new Uint16Array(e*i);a=t.getData();for(d=0;d<_;++d){r[d]=(a[d]&255)>>3<<11|(a[d]&255)>>2<<5|(a[d]&255)>>3<<0}}}else if(h===n.PIXEL_FORMAT_RGBA4444){r=new Uint16Array(e*i);s=t.getData();for(d=0;d<_;++d){r[d]=(s[d]>>0&255)>>4<<12|(s[d]>>8&255)>>4<<8|(s[d]>>16&255)>>4<<4|(s[d]>>24&255)>>4<<0}}else if(h===n.PIXEL_FORMAT_RGB5A1){r=new Uint16Array(e*i);s=t.getData();for(d=0;d<_;++d){r[d]=(s[d]>>0&255)>>3<<11|(s[d]>>8&255)>>3<<6|(s[d]>>16&255)>>3<<1|(s[d]>>24&255)>>7<<0}}else if(h===n.PIXEL_FORMAT_A8){r=new Uint8Array(e*i);s=t.getData();for(d=0;d<_;++d){r[d]=s>>24&255}}if(c&&h===n.PIXEL_FORMAT_RGB888){s=t.getData();r=new Uint8Array(e*i*3);for(d=0;d<_;++d){r[d*3]=s>>0&255;r[d*3+1]=s>>8&255;r[d*3+2]=s>>16&255}}this.initWithData(r,h,e,i,l);if(r!=t.getData())r=null;this._hasPremultipliedAlpha=t.isPremultipliedAlpha();return true},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventListener("load",t)}})};cc._tmp.WebGLTextureAtlas=function(){var t=cc.TextureAtlas.prototype;t._setupVBO=function(){var t=this;var e=cc._renderContext;t._buffersVBO[0]=e.createBuffer();t._buffersVBO[1]=e.createBuffer();t._quadsWebBuffer=e.createBuffer();t._mapBuffers()};t._mapBuffers=function(){var t=this;var e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer);e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]);e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)};t.drawNumberOfQuads=function(t,e){var i=this;e=e||0;if(0===t||!i.texture||!i.texture.isLoaded())return;var n=cc._renderContext;cc.glBindTexture2D(i.texture);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);n.bindBuffer(n.ARRAY_BUFFER,i._quadsWebBuffer);if(i.dirty){n.bufferData(n.ARRAY_BUFFER,i._quadsArrayBuffer,n.DYNAMIC_DRAW);i.dirty=false}n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,false,24,0);n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,true,24,12);n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,false,24,16);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]);if(cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP)n.drawElements(n.TRIANGLE_STRIP,t*6,n.UNSIGNED_SHORT,e*6*i._indices.BYTES_PER_ELEMENT);else n.drawElements(n.TRIANGLES,t*6,n.UNSIGNED_SHORT,e*6*i._indices.BYTES_PER_ELEMENT);cc.g_NumberOfDraws++}};cc._tmp.WebGLTextureCache=function(){var t=cc.textureCache;t.handleLoadedTexture=function(t){var e=this._textures,i,n;if(!cc.game._rendererInitialized){e=this._loadedTexturesBefore}i=e[t];if(!i){i=e[t]=new cc.Texture2D;i.url=t}n=cc.path.extname(t);if(n===".png"){i.handleLoadedTexture(true)}else{i.handleLoadedTexture()}};t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage_2);var n=this._textures;if(!cc.game._rendererInitialized){n=this._loadedTexturesBefore}var r=n[t]||n[cc.loader._getAliase(t)];if(r){if(r.isLoaded()){e&&e.call(i,r);return r}else{r.addEventListener("load",function(){e&&e.call(i,r)},i);return r}}r=n[t]=new cc.Texture2D;r.url=t;var s=cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg;s.call(cc.loader,t,function(r,s){if(r)return e&&e.call(i,r);cc.textureCache.handleLoadedTexture(t);var a=n[t];e&&e.call(i,a)});return r};t.addImageAsync=t.addImage;t=null};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=false;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t={_contentSize:null,_textureLoaded:false,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0);this._textureLoaded=false;this._htmlElementObj=null;this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var t=cc.contentScaleFactor();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){if(!t)return;this._htmlElementObj=t;this._contentSize.width=t.width;this._contentSize.height=t.height;this._textureLoaded=true},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(t._textureLoaded)return;if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}var i=t._htmlElementObj;t._contentSize.width=i.width;t._contentSize.height=i.height;t.dispatchEvent("load")},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(t,e,i,n,r){return false},initWithImage:function(t){return false},initWithString:function(t,e,i,n,r,s){return false},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(t){},getMaxT:function(){return 1},setMaxT:function(t){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(t){},hasPremultipliedAlpha:function(){return false},hasMipmaps:function(){return false},releaseData:function(t){t=null},keepData:function(t,e){return t},drawAtPoint:function(t){},drawInRect:function(t){},initWithETCFile:function(t){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return false},initWithPVRFile:function(t){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);return false},initWithPVRTCData:function(t,e,i,n,r,s){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return false},setTexParameters:function(t,e,i,n){if(e!==undefined)t={minFilter:t,magFilter:e,wrapS:i,wrapT:n};if(t.wrapS===cc.REPEAT&&t.wrapT===cc.REPEAT){this._pattern="repeat";return}if(t.wrapS===cc.REPEAT){this._pattern="repeat-x";return}if(t.wrapT===cc.REPEAT){this._pattern="repeat-y";return}this._pattern=""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventListener("load",t)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];e(this._htmlElementObj,t);return this.channelCache=t},_grayElementObj:null,_backupElement:null,_isGray:false,_switchToGray:function(t){if(!this._textureLoaded||this._isGray===t)return;this._isGray=t;if(this._isGray){this._backupElement=this._htmlElementObj;if(!this._grayElementObj)this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj);this._htmlElementObj=this._grayElementObj}else{if(this._backupElement!==null)this._htmlElementObj=this._backupElement}}};var e=function(t,e){var i=t.width;var n=t.height;e[0].width=i;e[0].height=n;e[1].width=i;e[1].height=n;e[2].width=i;e[2].height=n;e[3].width=i;e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);var s=r.getImageData(0,0,i,n).data;var a;for(var o=0;o<4;o++){a=e[o].getContext("2d");var c=a.getImageData(0,0,i,n);var l=c.data;for(var h=0;h<s.length;h+=4){l[h]=o===0?s[h]:0;l[h+1]=o===1?s[h+1]:0;l[h+2]=o===2?s[h+2]:0;l[h+3]=s[h+3]}a.putImageData(c,0,0)}t.onload=null};if(cc.sys._supportCanvasNewBlendModes){t._generateColorTexture=function(t,e,i,n,r){var s=false;if(r)s=true;else r=document.createElement("canvas");var a=this._htmlElementObj;if(!n)n=cc.rect(0,0,a.width,a.height);r.width=n.width;r.height=n.height;var o=r.getContext("2d");o.globalCompositeOperation="source-over";o.fillStyle="rgb("+(t|0)+","+(e|0)+","+(i|0)+")";o.fillRect(0,0,n.width,n.height);o.globalCompositeOperation="multiply";o.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height);o.globalCompositeOperation="destination-atop";o.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height);if(s)return r;var c=new cc.Texture2D;c.initWithElement(r);c.handleLoadedTexture();return c}}else{t._generateColorTexture=function(t,e,i,n,r){var s=false;if(r)s=true;else r=document.createElement("canvas");var a=this._htmlElementObj;if(!n)n=cc.rect(0,0,a.width,a.height);var o,c,l,h;o=n.x;c=n.y;l=n.width;h=n.height;if(!l||!h)return;r.width=l;r.height=h;var u=r.getContext("2d");var d=cc.textureCache.getTextureColors(this);u.globalCompositeOperation="lighter";u.drawImage(d[3],o,c,l,h,0,0,l,h);if(t>0){u.globalAlpha=t/255;u.drawImage(d[0],o,c,l,h,0,0,l,h)}if(e>0){u.globalAlpha=e/255;u.drawImage(d[1],o,c,l,h,0,0,l,h)}if(i>0){u.globalAlpha=i/255;u.drawImage(d[2],o,c,l,h,0,0,l,h)}if(s)return r;var _=new cc.Texture2D;_.initWithElement(r);_.handleLoadedTexture();return _}}cc.Texture2D=cc.Class.extend(t);cc.Texture2D._generateGrayTexture=function(t,e,i){if(t===null)return null;i=i||document.createElement("canvas");e=e||cc.rect(0,0,t.width,t.height);i.width=e.width;i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);var r=n.getImageData(0,0,e.width,e.height);var s=r.data;for(var a=0,o=s.length;a<o;a+=4){s[a]=s[a+1]=s[a+2]=.34*s[a]+.5*s[a+1]+.16*s[a+2]}n.putImageData(r,0,0);return i}}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js");cc._tmp.WebGLTexture2D();delete cc._tmp.WebGLTexture2D}cc.EventHelper.prototype.apply(cc.Texture2D.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D});cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|Math.random()*1e3,_loadedTexturesBefore:{},_initializingRenderer:function(){var t;var e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture();i[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(t){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){cc.log(cc._LogInfos.textureCache_textureForKey);return this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[cc.loader._getAliase(t)]},getKeyByTexture:function(t){for(var e in this._textures){if(this._textures[e]===t){return e}}return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj;var i=this.getKeyByTexture(e);if(!i){if(e instanceof HTMLImageElement)i=e.src;else i=this._generalTextureKey(t.__instanceId)}if(!this._textureColorsCache[i])this._textureColorsCache[i]=t._generateTextureCacheForColor();return this._textureColorsCache[i]},addPVRImage:function(t){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var t=this._textures;for(var e in t){if(t[e])t[e].releaseTexture()}this._textures={}},removeTexture:function(t){if(!t)return;var e=this._textures;for(var i in e){if(e[i]===t){e[i].releaseTexture();delete e[i]}}},removeTextureForKey:function(t){if(t==null)return;if(this._textures[t])delete this._textures[t]},cacheImage:function(t,e){if(e instanceof cc.Texture2D){this._textures[t]=e;return}var i=new cc.Texture2D;i.initWithElement(e);i.handleLoadedTexture();this._textures[t]=i},addUIImage:function(t,e){cc.assert(t,cc._LogInfos.textureCache_addUIImage_2);if(e){if(this._textures[e])return this._textures[e]}var i=new cc.Texture2D;i.initWithImage(t);if(e!=null)this._textures[e]=i;else cc.log(cc._LogInfos.textureCache_addUIImage);return i},dumpCachedTextureInfo:function(){var t=0;var e=0,i=this._textures;for(var n in i){var r=i[n];t++;if(r.getHtmlElementObj()instanceof HTMLImageElement)cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,n,r.getHtmlElementObj().src,r.pixelsWidth,r.pixelsHeight);else{cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,r.pixelsWidth,r.pixelsHeight)}e+=r.pixelsWidth*r.pixelsHeight*4}var s=this._textureColorsCache;for(n in s){var a=s[n];for(var o in a){var c=a[o];t++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,c.width,c.height);e+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,t,e/1024,(e/(1024*1024)).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache={};this._textureKeySeq=0|Math.random()*1e3;this._loadedTexturesBefore={}}};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.textureCache;t.handleLoadedTexture=function(t){var e=this._textures;var i=e[t];if(!i){i=e[t]=new cc.Texture2D;i.url=t}i.handleLoadedTexture()};t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D_addImage);var n=this._textures;var r=n[t]||n[cc.loader._getAliase(t)];if(r){if(r.isLoaded()){e&&e.call(i,r);return r}else{r.addEventListener("load",function(){e&&e.call(i,r)},i);return r}}r=n[t]=new cc.Texture2D;r.url=t;var s=cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg;s.call(cc.loader,t,function(r,s){if(r)return e&&e.call(i,r);cc.textureCache.handleLoadedTexture(t);var a=n[t];e&&e.call(i,a)});return r};t.addImageAsync=t.addImage;t=null}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js");cc._tmp.WebGLTextureCache();delete cc._tmp.WebGLTextureCache}});cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=true;this.setAnchorPoint(.5,.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var t=this;var e=160;var i=200;var n=t._bgLayer=new cc.LayerColor(cc.color(42,40,89));t.addChild(n,0);var r=24,s=-i/2+100;if(cc._loaderImage){cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:false},function(n,r){e=r.width;i=r.height;t._initStage(r,cc.visibleRect.center)});r=42;s=-i/2-10}var a=t._label=new cc.LabelTTF("加载中... 0%","Arial",r);a.setFontFillColor(cc.color(254,244,7));a.x=cc.director.getWinSize().width/2;a.y=cc.director.getWinSize().height/2-150;a.setColor(cc.color(180,180,180));n.addChild(this._label,10);return true},_initStage:function(t,e){var i=this;var n=i._texture2d=new cc.Texture2D;n.initWithElement(t);n.handleLoadedTexture();var r=i._logo=new cc.Sprite(n);r.setScale(cc.contentScaleFactor());r.x=e.x;r.y=cc.director.getWinSize().height*2/3;i._bgLayer.addChild(r,10)},onEnter:function(){var t=this;cc.Node.prototype.onEnter.call(t);t.schedule(t._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var t="加载中... 0%";this._label.setString(t)},initWithResources:function(t,e,i){if(cc.isString(t))t=[t];this.resources=t||[];this.cb=e;this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var e=t.resources;cc.loader.load(e,function(e,i,n){var r=n/i*100|0;r=Math.min(r,100);t._label.setString("加载中... "+r+"%")},function(){if(t.cb)t.cb.call(t.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}});cc.LoaderScene.preload=function(t,e,i){var n=cc;if(!n.loaderScene){n.loaderScene=new cc.LoaderScene;n.loaderScene.init();cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){n.loaderScene._updateTransform()})}n.loaderScene.initWithResources(t,e,i);cc.director.runScene(n.loaderScene);return n.loaderScene};cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){var t=cc.Node.prototype;t.ctor.call(this);this._ignoreAnchorPointForPosition=true;t.setAnchorPoint.call(this,.5,.5);t.setContentSize.call(this,cc.winSize)},init:function(){var t=this;t._ignoreAnchorPointForPosition=true;t.setAnchorPoint(.5,.5);t.setContentSize(cc.winSize);t._cascadeColorEnabled=false;t._cascadeOpacityEnabled=false;return true},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){cc.Node.prototype.addChild.call(this,t,e,i);this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.Layer.CanvasRenderCmd(this);else return new cc.Layer.WebGLRenderCmd(this)}});cc.Layer.create=function(){return new cc.Layer};cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t;this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},ctor:function(t,e,i){cc.Layer.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);cc.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS)this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR);var n=cc.director.getWinSize();t=t||cc.color(0,0,0,255);e=e===undefined?n.width:e;i=i===undefined?n.height:i;var r=this._realColor;r.r=t.r;r.g=t.g;r.b=t.b;this._realOpacity=t.a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty);cc.LayerColor.prototype.setContentSize.call(this,e,i);return true},setBlendFunc:function(t,e){var i=this._blendFunc;if(e===undefined){i.src=t.src;i.dst=t.dst}else{i.src=t;i.dst=e}this._renderCmd.updateBlendFunc(i)},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t);this._renderCmd._updateSquareVerticesWidth(t)},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t);this._renderCmd._updateSquareVerticesHeight(t)},setContentSize:function(t,e){cc.Layer.prototype.setContentSize.call(this,t,e);this._renderCmd._updateSquareVertices(t,e)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.LayerColor.CanvasRenderCmd(this);else return new cc.LayerColor.WebGLRenderCmd(this)}});cc.LayerColor.create=function(t,e,i){return new cc.LayerColor(t,e,i)};(function(){var t=cc.LayerColor.prototype;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth);cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)})();cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:false,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,n){cc.LayerColor.prototype.ctor.call(this);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._startOpacity=255;this._endOpacity=255;if(n&&n instanceof Array){this._colorStops=n;n.splice(0,0,{p:0,color:t||cc.color.BLACK});n.push({p:1,color:e||cc.color.BLACK})}else this._colorStops=[{p:0,color:t||cc.color.BLACK},{p:1,color:e||cc.color.BLACK}];cc.LayerGradient.prototype.init.call(this,t,e,i,n)},init:function(t,e,i,n){t=t||cc.color(0,0,0,255);e=e||cc.color(0,0,0,255);i=i||cc.p(0,-1);var r=this;var s=r._endColor;r._startOpacity=t.a;s.r=e.r;s.g=e.g;s.b=e.b;r._endOpacity=e.a;r._alongVector=i;r._compressedInterpolation=true;cc.LayerColor.prototype.init.call(r,cc.color(t.r,t.g,t.b,255));this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty);return true},setContentSize:function(t,e){cc.LayerColor.prototype.setContentSize.call(this,t,e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){cc.LayerColor.prototype._setWidth.call(this,t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){cc.LayerColor.prototype._setHeight.call(this,t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r;i.g=t.g;i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r;e.g=t.g;e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var n=i[i.length-1].color;n.r=t.r;n.g=t.g;n.b=t.b}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;if(e&&e.length>0)e[0].color.a=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;if(e&&e.length>0)e[e.length-1].color.a=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x;this._alongVector.y=t.y;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.LayerGradient.CanvasRenderCmd(this);else return new cc.LayerGradient.WebGLRenderCmd(this)}});cc.LayerGradient.create=function(t,e,i,n){return new cc.LayerGradient(t,e,i,n)};(function(){var t=cc.LayerGradient.prototype;t.startColor;cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor);t.endColor;cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor);t.startOpacity;cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity);t.endOpacity;cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity);t.vector;cc.defineGetterSetter(t,"vector",t.getVector,t.setVector);t.colorStops;cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)})();cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){cc.Layer.prototype.ctor.call(this);if(t instanceof Array)cc.LayerMultiplex.prototype.initWithLayers.call(this,t);else cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){if(t.length>0&&t[t.length-1]==null)cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=t;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);return true},switchTo:function(t){if(t>=this._layers.length){cc.log(cc._LogInfos.LayerMultiplex_switchTo);return}this.removeChild(this._layers[this._enabledLayer],true);this._enabledLayer=t;this.addChild(this._layers[t])},switchToAndReleaseMe:function(t){if(t>=this._layers.length){cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe);return}this.removeChild(this._layers[this._enabledLayer],true);this._layers[this._enabledLayer]=null;this._enabledLayer=t;this.addChild(this._layers[t])},addLayer:function(t){if(!t){cc.log(cc._LogInfos.LayerMultiplex_addLayer);return}this._layers.push(t)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))};(function(){cc.Layer.CanvasRenderCmd=function(t){
cc.Node.CanvasRenderCmd.call(this,t);this._isBaked=false;this._bakeSprite=null;this._updateCache=2};var t=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Layer.CanvasRenderCmd;t._setCacheDirty=function(t){if(t&&this._updateCache===0)this._updateCache=2;if(this._cacheDirty===false){this._cacheDirty=true;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}};t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;if(e&t.orderDirty){this._cacheDirty=true;if(this._updateCache===0)this._updateCache=2;this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag}cc.Node.RenderCmd.prototype.updateStatus.call(this)};t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;if(i&e.orderDirty){this._cacheDirty=true;if(this._updateCache===0)this._updateCache=2;this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag}cc.Node.RenderCmd.prototype._syncStatus.call(this,t)};t.transform=function(t,e){var i=this._worldTransform;var n=i.a,r=i.b,s=i.c,a=i.d,o=i.tx,c=i.ty;cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);if((i.a!==n||i.b!==r||i.c!==s||i.d!==a)&&this._updateCache===0)this._updateCache=2};t.bake=function(){if(!this._isBaked){this._needDraw=true;cc.renderer.childrenOrderDirty=true;this._isBaked=this._cacheDirty=true;if(this._updateCache===0)this._updateCache=2;var t=this._node._children;for(var e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(this);if(!this._bakeSprite){this._bakeSprite=new cc.BakeSprite;this._bakeSprite.setAnchorPoint(0,0)}}};t.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=true;this._needDraw=false;this._isBaked=false;this._cacheDirty=true;if(this._updateCache===0)this._updateCache=2;var t=this._node._children;for(var e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(null)}};t.isBaked=function(){return this._isBaked};t.rendering=function(){if(this._cacheDirty){var t=this._node;var e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),true);var n=this._getBoundingBoxForBake();n.width=0|n.width+.5;n.height=0|n.height+.5;var r=i.getCacheContext();var s=r.getContext();i.setPosition(n.x,n.y);if(this._updateCache>0){i.resetCanvasSize(n.width,n.height);r.setOffset(0-n.x,s.canvas.height-n.height+n.y);t.sortAllChildren();cc.renderer._turnToCacheMode(this.__instanceId);for(var a=0,o=e.length;a<o;a++){e[a].visit(this)}cc.renderer._renderingToCacheCanvas(r,this.__instanceId);i.transform();this._updateCache--}this._cacheDirty=false}};t.visit=function(t){if(!this._isBaked){cc.Node.CanvasRenderCmd.prototype.visit.call(this,t);return}var e=this._node,i=e._children;var n=i.length;if(!e._visible||n===0)return;this._syncStatus(t);cc.renderer.pushRenderCommand(this);this._bakeSprite.visit(this);this._dirtyFlag=0};t._bakeForAddChild=function(t){if(t._parent===this._node&&this._isBaked)t._renderCmd._setCachedParent(this)};t._getBoundingBoxForBake=function(){var t=null,e=this._node;if(!e._children||e._children.length===0)return cc.rect(0,0,10,10);var i=e.getNodeToWorldTransform();var n=e._children;for(var r=0,s=n.length;r<s;r++){var a=n[r];if(a&&a._visible){if(t){var o=a._getBoundingBoxToCurrentNode(i);if(o)t=cc.rectUnion(t,o)}else{t=a._getBoundingBoxToCurrentNode(i)}}}return t}})();(function(){cc.LayerColor.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t);this._needDraw=true;this._blendFuncStr="source-over";this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var t=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.LayerColor.CanvasRenderCmd;t.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this);this._needDraw=true};t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._node,a=this._displayedColor,o=this._displayedOpacity/255,c=s._contentSize.width,l=s._contentSize.height;if(o===0)return;n.setCompositeOperation(this._blendFuncStr);n.setGlobalAlpha(o);n.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)");n.setTransform(this._worldTransform,e,i);r.fillRect(0,0,c*e,-l*i);cc.g_NumberOfDraws++};t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)};t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){};t._bakeRendering=function(){if(this._cacheDirty){var t=this._node;var e=this._bakeSprite,i=t._children;var n=i.length,r;this.transform(this.getParentRenderCmd(),true);var s=this._getBoundingBoxForBake();s.width=0|s.width+.5;s.height=0|s.height+.5;var a=e.getCacheContext();var o=a.getContext();e.setPosition(s.x,s.y);if(this._updateCache>0){o.fillStyle=a._currentFillStyle;e.resetCanvasSize(s.width,s.height);a.setOffset(0-s.x,o.canvas.height-s.height+s.y);var c;cc.renderer._turnToCacheMode(this.__instanceId);if(n>0){t.sortAllChildren();for(r=0;r<n;r++){c=i[r];if(c._localZOrder<0)c._renderCmd.visit(this);else break}cc.renderer.pushRenderCommand(this);for(;r<n;r++){i[r]._renderCmd.visit(this)}}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(a,this.__instanceId);e.transform();this._updateCache--}this._cacheDirty=false}};t.visit=function(t){if(!this._isBaked){cc.Node.CanvasRenderCmd.prototype.visit.call(this);return}var e=this._node;if(!e._visible)return;this._syncStatus(t);cc.renderer.pushRenderCommand(this._bakeRenderCmd);this._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._bakeSprite.visit(this);this._dirtyFlag=0};t._getBoundingBoxForBake=function(){var t=this._node;var e=cc.rect(0,0,t._contentSize.width,t._contentSize.height);var i=t.getNodeToWorldTransform();e=cc.rectApplyAffineTransform(e,t.getNodeToWorldTransform());if(!t._children||t._children.length===0)return e;var n=t._children;for(var r=0;r<n.length;r++){var s=n[r];if(s&&s._visible){var a=s._getBoundingBoxToCurrentNode(i);e=cc.rectUnion(e,a)}}return e}})();(function(){cc.LayerGradient.RenderCmd={updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;if(e&t.gradientDirty){this._dirtyFlag|=t.colorDirty;this._dirtyFlag=this._dirtyFlag&t.gradientDirty^this._dirtyFlag}cc.Node.RenderCmd.prototype.updateStatus.call(this)}};cc.LayerGradient.CanvasRenderCmd=function(t){cc.LayerColor.CanvasRenderCmd.call(this,t);this._needDraw=true;this._startPoint=cc.p(0,0);this._endPoint=cc.p(0,0);this._startStopStr=null;this._endStopStr=null};var t=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,t);t.constructor=cc.LayerGradient.CanvasRenderCmd;t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._node,a=this._displayedOpacity/255;if(a===0)return;var o=s._contentSize.width,c=s._contentSize.height;n.setCompositeOperation(this._blendFuncStr);n.setGlobalAlpha(a);var l=r.createLinearGradient(this._startPoint.x*e,this._startPoint.y*i,this._endPoint.x*e,this._endPoint.y*i);if(s._colorStops){for(var h=0;h<s._colorStops.length;h++){var u=s._colorStops[h];l.addColorStop(u.p,this._colorStopsStr[h])}}else{l.addColorStop(0,this._startStopStr);l.addColorStop(1,this._endStopStr)}n.setFillStyle(l);n.setTransform(this._worldTransform,e,i);r.fillRect(0,0,o*e,-c*i);cc.g_NumberOfDraws++};t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;if(i&e.gradientDirty){this._dirtyFlag|=e.colorDirty;this._dirtyFlag=i&e.gradientDirty^i}cc.Node.RenderCmd.prototype._syncStatus.call(this,t)};t._updateColor=function(){var t=this._node;var e=t._contentSize;var i=e.width*.5,n=e.height*.5;this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var r=cc.pAngleSigned(cc.p(0,-1),t._alongVector);var s=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),r);var a=Math.min(Math.abs(1/s.x),Math.abs(1/s.y));this._startPoint.x=i*(-s.x*a)+i;this._startPoint.y=n*(s.y*a)-n;this._endPoint.x=i*(s.x*a)+i;this._endPoint.y=n*(-s.y*a)-n;var o=this._displayedColor,c=t._endColor;var l=t._startOpacity/255,h=t._endOpacity/255;this._startStopStr="rgba("+Math.round(o.r)+","+Math.round(o.g)+","+Math.round(o.b)+","+l.toFixed(4)+")";this._endStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+h.toFixed(4)+")";if(t._colorStops){this._startOpacity=0;this._endOpacity=0;this._colorStopsStr=[];for(var u=0;u<t._colorStops.length;u++){var d=t._colorStops[u].color;var _=d.a==null?1:d.a/255;this._colorStopsStr.push("rgba("+Math.round(d.r)+","+Math.round(d.g)+","+Math.round(d.b)+","+_.toFixed(4)+")")}}}})();cc._tmp.PrototypeSprite=function(){var t=cc.Sprite.prototype;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB);cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity);cc.defineGetterSetter(t,"color",t.getColor,t.setColor);t.dirty;t.flippedX;cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX);t.flippedY;cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY);t.offsetX;cc.defineGetterSetter(t,"offsetX",t._getOffsetX);t.offsetY;cc.defineGetterSetter(t,"offsetY",t._getOffsetY);t.atlasIndex;t.texture;cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture);t.textureRectRotated;cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated);t.textureAtlas;t.batchNode;cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode);t.quad;cc.defineGetterSetter(t,"quad",t.getQuad)};cc.Sprite=cc.Node.extend({dirty:false,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:false,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:false,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:false,_flippedX:false,_flippedY:false,_textureLoaded:false,_className:"Sprite",ctor:function(t,e,i){var n=this;cc.Node.prototype.ctor.call(n);n._shouldBeHidden=false;n._offsetPosition=cc.p(0,0);n._unflippedOffsetPositionFromCenter=cc.p(0,0);n._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};n._rect=cc.rect(0,0,0,0);n._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrame);if(!t.textureLoaded()){this._textureLoaded=false;t.addEventListener("load",this._renderCmd._spriteFrameLoadedCallback,this)}var e=cc._renderType===cc.game.RENDER_TYPE_CANVAS?false:t._rotated;var i=this.initWithTexture(t.getTexture(),t.getRect(),e);this.setSpriteFrame(t);return i},initWithSpriteFrameName:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrameName);var e=cc.spriteFrameCache.getSpriteFrame(t);cc.assert(e,t+cc._LogInfos.Sprite_initWithSpriteFrameName1);return this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas();this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;var e=t.length,i,n,r;for(i=1;i<e;i++){r=t[i];n=i-1;while(n>=0){if(r._localZOrder<t[n]._localZOrder){t[n+1]=t[n]}else if(r._localZOrder===t[n]._localZOrder&&r.arrivalOrder<t[n].arrivalOrder){t[n+1]=t[n]}else{break}n--}t[n+1]=r}if(this._batchNode){this._arrayMakeObjectsPerformSelector(t,cc.Node._stateCallbackType.sortAllChildren)}this._reorderChildDirty=false}},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Sprite_reorderChild_2);if(this._children.indexOf(t)===-1){cc.log(cc._LogInfos.Sprite_reorderChild);return}if(e===t.zIndex)return;if(this._batchNode&&!this._reorderChildDirty){this._setReorderChildDirtyRecursively();this._batchNode.reorderBatch(true)}cc.Node.prototype.reorderChild.call(this,t,e)},removeChild:function(t,e){if(this._batchNode)this._batchNode.removeSpriteFromAtlas(t);cc.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){cc.Node.prototype.setVisible.call(this,t);this._renderCmd.setDirtyRecursively(true)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&e!=null){for(var n=0,r=e.length;n<r;n++)i.removeSpriteFromAtlas(e[n])}cc.Node.prototype.removeAllChildren.call(this,t);this._hasChildren=false},ignoreAnchorPointForPosition:function(t){if(this._batchNode){cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition);return}cc.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){if(this._flippedX!==t){this._flippedX=t;this.setTextureRect(this._rect,this._rectRotated,this._contentSize);this.setNodeDirty(true)}},setFlippedY:function(t){if(this._flippedY!==t){this._flippedY=t;this.setTextureRect(this._rect,this._rectRotated,this._contentSize);this.setNodeDirty(true)}},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t;this._renderCmd._setColorDirty()}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assert(t,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var i=cc.animationCache.getAnimation(t);if(!i){cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName);return}var n=i.getFrames()[e];if(!n){cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2);return}this.setSpriteFrame(n.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=true;var t=this._parent;while(t&&t!==this._batchNode){t._setReorderChildDirtyRecursively();t=t.parent}}},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(t===undefined)cc.Sprite.prototype.init.call(this);else if(cc.isString(t)){if(t[0]==="#"){var n=t.substr(1,t.length-1);var r=cc.spriteFrameCache.getSpriteFrame(n);if(r)this.initWithSpriteFrame(r);else cc.log("%s does not exist",t)}else{cc.Sprite.prototype.init.call(this,t,e)}}else if(typeof t==="object"){if(t instanceof cc.Texture2D){this.initWithTexture(t,e,i)}else if(t instanceof cc.SpriteFrame){this.initWithSpriteFrame(t)}else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var s=new cc.Texture2D;s.initWithElement(t);s.handleLoadedTexture();this.initWithTexture(s)}}},getQuad:function(){return this._renderCmd.getQuad()},setBlendFunc:function(t,e){var i=this._blendFunc;if(e===undefined){i.src=t.src;i.dst=t.dst}else{i.src=t;i.dst=e}this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;if(arguments.length>0)return t.initWithFile(arguments[0],arguments[1]);cc.Node.prototype.init.call(t);t.dirty=t._recursiveDirty=false;t._blendFunc.src=cc.BLEND_SRC;t._blendFunc.dst=cc.BLEND_DST;t.texture=null;t._flippedX=t._flippedY=false;t.anchorX=.5;t.anchorY=.5;t._offsetPosition.x=0;t._offsetPosition.y=0;t._hasChildren=false;this._renderCmd._init();t.setTextureRect(cc.rect(0,0,0,0),false,cc.size(0,0));return true},initWithFile:function(t,e){cc.assert(t,cc._LogInfos.Sprite_initWithFile);var i=cc.textureCache.getTextureForKey(t);if(!i){i=cc.textureCache.addImage(t);return this.initWithTexture(i,e||cc.rect(0,0,i._contentSize.width,i._contentSize.height))}else{if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)}},initWithTexture:function(t,e,i,n){var r=this;cc.assert(arguments.length!==0,cc._LogInfos.CCSpriteBatchNode_initWithTexture);i=i||false;t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n);if(!cc.Node.prototype.init.call(r))return false;r._batchNode=null;r._recursiveDirty=false;r.dirty=false;r._opacityModifyRGB=true;r._blendFunc.src=cc.BLEND_SRC;r._blendFunc.dst=cc.BLEND_DST;r._flippedX=r._flippedY=false;r.setAnchorPoint(.5,.5);r._offsetPosition.x=0;r._offsetPosition.y=0;r._hasChildren=false;this._renderCmd._init();var s=t.isLoaded();r._textureLoaded=s;if(!s){r._rectRotated=i;if(e){r._rect.x=e.x;r._rect.y=e.y;r._rect.width=e.width;r._rect.height=e.height}if(r.texture)r.texture.removeEventListener("load",r);t.addEventListener("load",r._renderCmd._textureLoadedCallback,r);r.texture=t;return true}if(!e)e=cc.rect(0,0,t.width,t.height);this._renderCmd._checkTextureBoundary(t,e,i);r.setTexture(t);r.setTextureRect(e,i);r.setBatchNode(null);return true},setTextureRect:function(t,e,i,n){var r=this;r._rectRotated=e||false;r.setContentSize(i||t);r.setVertexRect(t);r._renderCmd._setTextureCoords(t,n);var s=r._unflippedOffsetPositionFromCenter.x,a=r._unflippedOffsetPositionFromCenter.y;if(r._flippedX)s=-s;if(r._flippedY)a=-a;var o=r._rect;r._offsetPosition.x=s+(r._contentSize.width-o.width)/2;r._offsetPosition.y=a+(r._contentSize.height-o.height)/2;if(r._batchNode){r.dirty=true}else{this._renderCmd._resetForBatchNode()}},updateTransform:function(){this._renderCmd.updateTransform()},addChild:function(t,e,i){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_addChild_2);if(e==null)e=t._localZOrder;if(i==null)i=t.tag;if(this._renderCmd._setBatchNodeForAddChild(t)){cc.Node.prototype.addChild.call(this,t,e,i);this._hasChildren=true}},setSpriteFrame:function(t){var e=this;if(cc.isString(t)){t=cc.spriteFrameCache.getSpriteFrame(t);cc.assert(t,cc._LogInfos.Sprite_setSpriteFrame)}this.setNodeDirty(true);var i=t.getOffset();e._unflippedOffsetPositionFromCenter.x=i.x;e._unflippedOffsetPositionFromCenter.y=i.y;var n=t.getTexture();var r=t.textureLoaded();if(!r){e._textureLoaded=false;t.addEventListener("load",function(t){e._textureLoaded=true;var i=t.getTexture();if(i!==e._texture)e._setTexture(i);e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize());e.dispatchEvent("load");e.setColor(e._realColor)},e)}else{e._textureLoaded=true;if(n!==e._texture){e._setTexture(n);e.setColor(e._realColor)}e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())}this._renderCmd._updateForSetSpriteFrame(n)},setDisplayFrame:function(t){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){var e=this;e._batchNode=t;if(!e._batchNode){e.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED;e.textureAtlas=null;e._recursiveDirty=false;e.dirty=false;this._renderCmd._resetForBatchNode()}else{e._transformToBatch=cc.affineTransformIdentity();e.textureAtlas=e._batchNode.getTextureAtlas()}},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=cc.isString(t);if(e)t=cc.textureCache.addImage(t);if(t._textureLoaded){this._setTexture(t,e);this.setColor(this._realColor);this._textureLoaded=true}else{this._renderCmd._setTexture(null);t.addEventListener("load",function(){this._setTexture(t,e);this.setColor(this._realColor);this._textureLoaded=true},this)}},_setTexture:function(t,e){this._renderCmd._setTexture(t);if(e)this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var e=t._contentSize;var i=cc.rect(0,0,e.width,e.height);this.setTextureRect(i)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.Sprite.CanvasRenderCmd(this);else return new cc.Sprite.WebGLRenderCmd(this)}});cc.Sprite.create=function(t,e,i){return new cc.Sprite(t,e,i)};cc.Sprite.createWithTexture=cc.Sprite.create;cc.Sprite.createWithSpriteFrameName=cc.Sprite.create;cc.Sprite.createWithSpriteFrame=cc.Sprite.create;cc.Sprite.INDEX_NOT_INITIALIZED=-1;cc.EventHelper.prototype.apply(cc.Sprite.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;(function(){cc.Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:false};this._blendFuncStr="source-over";this._colorized=false;this._textureToRender=null};var t=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.Sprite.CanvasRenderCmd;t._init=function(){};t.setDirtyRecursively=function(t){};t._resetForBatchNode=function(){};t._setTexture=function(t){var e=this._node;if(e._texture!==t){if(t){e._textureLoaded=t._textureLoaded}else{e._textureLoaded=false}e._texture=t;this._updateColor()}};t._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)};t.isFrameDisplayed=function(t){var e=this._node;if(t.getTexture()!==e._texture)return false;return cc.rectEqualToRect(t.getRect(),e._rect)};t.updateBlendFunc=function(t){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)};t._setBatchNodeForAddChild=function(t){return true};t._handleTextureForRotatedTexture=function(t,e,i,n){if(i&&t.isLoaded()){var r=t.getHtmlElementObj();r=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,e,n);var s=new cc.Texture2D;s.initWithElement(r);s.handleLoadedTexture();t=s;e.x=e.y=0;this._node._rect=cc.rect(0,0,e.width,e.height)}return t};t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n=e.x+e.width,r=e.y+e.height;if(n>t.width)cc.error(cc._LogInfos.RectWidth,t.url);if(r>t.height)cc.error(cc._LogInfos.RectHeight,t.url)}};t.rendering=function(t,e,i){var n=this._node;var r=this._textureCoord,s=this._displayedOpacity/255;var a=this._textureToRender||n._texture;if(a&&(r.width===0||r.height===0||!a._textureLoaded)||s===0)return;var o=t||cc._renderContext,c=o.getContext();var l=n._offsetPosition.x,h=n._rect.height,u=n._rect.width,d=-n._offsetPosition.y-h,_;o.setTransform(this._worldTransform,e,i);o.setCompositeOperation(this._blendFuncStr);o.setGlobalAlpha(s);if(n._flippedX||n._flippedY)o.save();if(n._flippedX){l=-l-u;c.scale(-1,1)}if(n._flippedY){d=n._offsetPosition.y;c.scale(1,-1)}var f,p,m,g,v,y,T,C;if(this._colorized){f=0;p=0}else{f=r.renderX;p=r.renderY}m=r.width;g=r.height;v=l*e;y=d*i;T=u*e;C=h*i;if(a){_=a._htmlElementObj;if(a._pattern!==""){o.setFillStyle(c.createPattern(_,a._pattern));c.fillRect(v,y,T,C)}else{c.drawImage(_,f,p,m,g,v,y,T,C)}}else{var S=n._contentSize;if(r.validRect){var x=this._displayedColor;o.setFillStyle("rgba("+x.r+","+x.g+","+x.b+",1)");c.fillRect(v,y,S.width*e,S.height*i)}}if(n._flippedX||n._flippedY)o.restore();cc.g_NumberOfDraws++};t._updateColor=function(){var t=this._node;var e=t._texture,i=this._textureCoord;var n=this._displayedColor;if(e){if(n.r!==255||n.g!==255||n.b!==255){this._textureToRender=e._generateColorTexture(n.r,n.g,n.b,i);this._colorized=true}else if(e){this._textureToRender=e;this._colorized=false}}};t.getQuad=function(){return null};t._updateForSetSpriteFrame=function(t,e){this._colorized=false;this._textureCoord.renderX=this._textureCoord.x;this._textureCoord.renderY=this._textureCoord.y;e=e||t._textureLoaded;if(e){var i=this._node.getColor();if(i.r!==255||i.g!==255||i.b!==255)this._updateColor()}};t.updateTransform=function(){var t=this,e=this._node;if(e.dirty){var i=e._parent;if(!e._visible||i&&i!==e._batchNode&&i._shouldBeHidden){e._shouldBeHidden=true}else{e._shouldBeHidden=false;if(!i||i===e._batchNode){e._transformToBatch=t.getNodeToParentTransform()}else{e._transformToBatch=cc.affineTransformConcat(t.getNodeToParentTransform(),i._transformToBatch)}}e._recursiveDirty=false;e.dirty=false}if(e._hasChildren)e._arrayMakeObjectsPerformSelector(e._children,cc.Node._stateCallbackType.updateTransform)};t._spriteFrameLoadedCallback=function(t){var e=this;e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize());e._renderCmd._updateColor();e.dispatchEvent("load")};t._textureLoadedCallback=function(t){var e=this;if(e._textureLoaded)return;e._textureLoaded=true;var i=e._rect,n=this._renderCmd;if(!i){i=cc.rect(0,0,t.width,t.height)}else if(cc._rectEqualToZero(i)){i.width=t.width;i.height=t.height}e.texture=t;e.setTextureRect(i,e._rectRotated);var r=n._displayedColor;if(r.r!==255||r.g!==255||r.b!==255)n._updateColor();e.setBatchNode(e._batchNode);e.dispatchEvent("load")};t._setTextureCoords=function(t,e){if(e===undefined)e=true;var i=this._textureCoord,n=e?cc.contentScaleFactor():1;i.renderX=i.x=0|t.x*n;i.renderY=i.y=0|t.y*n;i.width=0|t.width*n;i.height=0|t.height*n;i.validRect=!(i.width===0||i.height===0||i.x<0||i.y<0)};cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=i==null?true:i;var n=document.createElement("canvas");n.width=e.width;n.height=e.height;var r=n.getContext("2d");r.translate(n.width/2,n.height/2);if(i)r.rotate(-1.5707963267948966);else r.rotate(1.5707963267948966);r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width);return n}})();cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10;this._cacheCanvas=t;this._cacheContext=new cc.CanvasContextWrapper(t.getContext("2d"));var e=new cc.Texture2D;e.initWithElement(t);e.handleLoadedTexture();this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,n=this._cacheContext,r=n._context.strokeStyle,s=n._context.fillStyle;if(e===undefined){e=t.height;t=t.width}i.width=t;i.height=e;if(r!==n._context.strokeStyle)n._context.strokeStyle=r;if(s!==n._context.fillStyle)n._context.fillStyle=s;this.getTexture().handleLoadedTexture();this.setTextureRect(cc.rect(0,0,t,e),false,null,false)}});cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null;this._delayPerUnit=e||0;this._userInfo=i||null},clone:function(){var t=new cc.AnimationFrame;t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return t},copyWithZone:function(t){return cc.clone(this)},copy:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return e},initWithSpriteFrame:function(t,e,i){this._spriteFrame=t;this._delayPerUnit=e;this._userInfo=i;return true},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}});cc.AnimationFrame.create=function(t,e,i){return new cc.AnimationFrame(t,e,i)};cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:false,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){this._frames=[];if(t===undefined){this.initWithSpriteFrames(null,0)}else{var n=t[0];if(n){if(n instanceof cc.SpriteFrame){this.initWithSpriteFrames(t,e,i)}else if(n instanceof cc.AnimationFrame){this.initWithAnimationFrames(t,e,i)}}}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(t,1,null);this._frames.push(e);this._totalDelayUnits++},addSpriteFrameWithFile:function(t){var e=cc.textureCache.addImage(t);var i=cc.rect(0,0,0,0);i.width=e.width;i.height=e.height;var n=new cc.SpriteFrame(e,i);this.addSpriteFrame(n)},addSpriteFrameWithTexture:function(t,e){var i=new cc.SpriteFrame(t,e);this.addSpriteFrame(i)},initWithAnimationFrames:function(t,e,i){cc.arrayVerifyType(t,cc.AnimationFrame);this._delayPerUnit=e;this._loops=i===undefined?1:i;this._totalDelayUnits=0;var n=this._frames;n.length=0;for(var r=0;r<t.length;r++){var s=t[r];n.push(s);this._totalDelayUnits+=s.getDelayUnits()}return true},clone:function(){var t=new cc.Animation;t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);t.setRestoreOriginalFrame(this._restoreOriginalFrame);return t},copyWithZone:function(t){var e=new cc.Animation;e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);e.setRestoreOriginalFrame(this._restoreOriginalFrame);return e},_copyFrames:function(){var t=[];for(var e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){cc.arrayVerifyType(t,cc.SpriteFrame);this._loops=i===undefined?1:i;this._delayPerUnit=e||0;this._totalDelayUnits=0;var n=this._frames;n.length=0;if(t){for(var r=0;r<t.length;r++){var s=t[r];var a=new cc.AnimationFrame;a.initWithSpriteFrame(s,1,null);n.push(a)}this._totalDelayUnits+=t.length}return true},retain:function(){},release:function(){}});cc.Animation.create=function(t,e,i){return new cc.Animation(t,e,i)};cc.Animation.createWithAnimationFrames=cc.Animation.create;cc.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){if(!t){return}if(this._animations[t]){delete this._animations[t]}},getAnimation:function(t){if(this._animations[t])return this._animations[t];return null},_addAnimationsWithDictionary:function(t,e){var i=t["animations"];if(!i){cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary);return}var n=1;var r=t["properties"];if(r){n=r["format"]!=null?parseInt(r["format"]):n;var s=r["spritesheets"];var a=cc.spriteFrameCache;var o=cc.path;for(var c=0;c<s.length;c++){a.addSpriteFrames(o.changeBasename(e,s[c]))}}switch(n){case 1:this._parseVersion1(i);break;case 2:this._parseVersion2(i);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2);break}},addAnimations:function(t){cc.assert(t,cc._LogInfos.animationCache_addAnimations_2);var e=cc.loader.getRes(t);if(!e){cc.log(cc._LogInfos.animationCache_addAnimations);return}this._addAnimationsWithDictionary(e,t)},_parseVersion1:function(t){var e=cc.spriteFrameCache;for(var i in t){var n=t[i];var r=n["frames"];var s=parseFloat(n["delay"])||0;var a=null;if(!r){cc.log(cc._LogInfos.animationCache__parseVersion1,i);continue}var o=[];for(var c=0;c<r.length;c++){var l=e.getSpriteFrame(r[c]);if(!l){cc.log(cc._LogInfos.animationCache__parseVersion1_2,i,r[c]);continue}var h=new cc.AnimationFrame;h.initWithSpriteFrame(l,1,null);o.push(h)}if(o.length===0){cc.log(cc._LogInfos.animationCache__parseVersion1_3,i);continue}else if(o.length!==r.length){cc.log(cc._LogInfos.animationCache__parseVersion1_4,i)}a=new cc.Animation(o,s,1);cc.animationCache.addAnimation(a,i)}},_parseVersion2:function(t){var e=cc.spriteFrameCache;for(var i in t){var n=t[i];var r=n["loop"];var s=parseInt(n["loops"]);var a=r?cc.REPEAT_FOREVER:isNaN(s)?1:s;var o=n["restoreOriginalFrame"]&&n["restoreOriginalFrame"]==true?true:false;var c=n["frames"];if(!c){cc.log(cc._LogInfos.animationCache__parseVersion2,i);continue}var l=[];for(var h=0;h<c.length;h++){var u=c[h];var d=u["spriteframe"];var _=e.getSpriteFrame(d);if(!_){cc.log(cc._LogInfos.animationCache__parseVersion2_2,i,d);continue}var f=parseFloat(u["delayUnits"])||0;
var p=u["notification"];var m=new cc.AnimationFrame;m.initWithSpriteFrame(_,f,p);l.push(m)}var g=parseFloat(n["delayPerUnit"])||0;var v=new cc.Animation;v.initWithAnimationFrames(l,g,a);v.setRestoreOriginalFrame(o);cc.animationCache.addAnimation(v,i)}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:false,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:false,ctor:function(t,e,i,n,r){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=false;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=false;if(t!==undefined&&e!==undefined){if(i===undefined||n===undefined||r===undefined)this.initWithTexture(t,e);else this.initWithTexture(t,e,i,n,r)}},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){if(!this._rectInPixels){this._rectInPixels=cc.rect(0,0,0,0)}this._rectInPixels.x=t.x;this._rectInPixels.y=t.y;this._rectInPixels.width=t.width;this._rectInPixels.height=t.height;this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){if(!this._rect){this._rect=cc.rect(0,0,0,0)}this._rect.x=t.x;this._rect.y=t.y;this._rect.width=t.width;this._rect.height=t.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x;this._offsetInPixels.y=t.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width;this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width;this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(this._textureFilename!==""){var t=cc.textureCache.addImage(this._textureFilename);if(t)this._textureLoaded=t.isLoaded();return t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e;this._texture=t;if(!e){t.addEventListener("load",function(t){this._textureLoaded=true;if(this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var e=t.getHtmlElementObj();e=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(e,this.getRect());var i=new cc.Texture2D;i.initWithElement(e);i.handleLoadedTexture();this.setTexture(i);var n=this.getRect();this.setRect(cc.rect(0,0,n.width,n.height))}var r=this._rect;if(r.width===0&&r.height===0){var s=t.width,a=t.height;this._rect.width=s;this._rect.height=a;this._rectInPixels=cc.rectPointsToPixels(this._rect);this._originalSizeInPixels.width=this._rectInPixels.width;this._originalSizeInPixels.height=this._rectInPixels.height;this._originalSize.width=s;this._originalSize.height=a}this.dispatchEvent("load")},this)}}},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x;this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);t.setTexture(this._texture);return t},copyWithZone:function(){var t=new cc.SpriteFrame;t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);t.setTexture(this._texture);return t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,i,n,r){if(arguments.length===2)e=cc.rectPointsToPixels(e);n=n||cc.p(0,0);r=r||e;i=i||false;if(cc.isString(t)){this._texture=null;this._textureFilename=t}else if(t instanceof cc.Texture2D){this.setTexture(t)}t=this.getTexture();this._rectInPixels=e;e=this._rect=cc.rectPixelsToPoints(e);if(t&&t.url&&t.isLoaded()){var s,a;if(i){s=e.x+e.height;a=e.y+e.width}else{s=e.x+e.width;a=e.y+e.height}if(s>t.getPixelsWide()){cc.error(cc._LogInfos.RectWidth,t.url)}if(a>t.getPixelsHigh()){cc.error(cc._LogInfos.RectHeight,t.url)}}this._offsetInPixels.x=n.x;this._offsetInPixels.y=n.y;cc._pointPixelsToPointsOut(n,this._offset);this._originalSizeInPixels.width=r.width;this._originalSizeInPixels.height=r.height;cc._sizePixelsToPointsOut(r,this._originalSize);this._rotated=i;return true}});cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype);cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)};cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create;cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,i,n,r){var s=new cc.SpriteFrame;s._texture=t;s._rectInPixels=e;s._rect=cc.rectPixelsToPoints(e);s._offsetInPixels.x=n.x;s._offsetInPixels.y=n.y;cc._pointPixelsToPointsOut(s._offsetInPixels,s._offset);s._originalSizeInPixels.width=r.width;s._originalSizeInPixels.height=r.height;cc._sizePixelsToPointsOut(s._originalSizeInPixels,s._originalSize);s._rotated=i;return s};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);if(!e)return cc.rect(0,0,0,0);return cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4]))},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);if(!e)return cc.p(0,0);return cc.p(parseFloat(e[1]),parseFloat(e[2]))},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);if(!e)return cc.size(0,0);return cc.size(parseFloat(e[1]),parseFloat(e[2]))},_getFrameConfig:function(t){var e=cc.loader.getRes(t);cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t);cc.loader.release(t);if(e._inited){this._frameConfigCache[t]=e;return e}this._frameConfigCache[t]=this._parseFrameConfig(e);return this._frameConfigCache[t]},_getFrameConfigByJsonObject:function(t,e){cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t);this._frameConfigCache[t]=this._parseFrameConfig(e);return this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t["frames"],i=t["metadata"]||t["meta"];var n={},r={};var s=0;if(i){var a=i["format"];s=a.length<=1?parseInt(a):a;r.image=i["textureFileName"]||i["textureFileName"]||i["image"]}for(var o in e){var c=e[o];if(!c)continue;var l={};if(s==0){l.rect=cc.rect(c["x"],c["y"],c["width"],c["height"]);l.rotated=false;l.offset=cc.p(c["offsetX"],c["offsetY"]);var h=c["originalWidth"];var u=c["originalHeight"];if(!h||!u){cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig)}h=Math.abs(h);u=Math.abs(u);l.size=cc.size(h,u)}else if(s==1||s==2){l.rect=this._rectFromString(c["frame"]);l.rotated=c["rotated"]||false;l.offset=this._pointFromString(c["offset"]);l.size=this._sizeFromString(c["sourceSize"])}else if(s==3){var d=this._sizeFromString(c["spriteSize"]);var _=this._rectFromString(c["textureRect"]);if(d){_=cc.rect(_.x,_.y,d.width,d.height)}l.rect=_;l.rotated=c["textureRotated"]||false;l.offset=this._pointFromString(c["spriteOffset"]);l.size=this._sizeFromString(c["spriteSourceSize"]);l.aliases=c["aliases"]}else{var f=c["frame"],p=c["sourceSize"];o=c["filename"]||o;l.rect=cc.rect(f["x"],f["y"],f["w"],f["h"]);l.rotated=c["rotated"]||false;l.offset=cc.p(0,0);l.size=cc.size(p["w"],p["h"])}n[o]=l}return{_inited:true,frames:n,meta:r}},_addSpriteFramesByObject:function(t,e,i){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);if(!e||!e["frames"])return;var n=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,n,i)},_createSpriteFrames:function(t,e,i){var n=e.frames,r=e.meta;if(!i){var s=cc.path.changeBasename(t,r.image||".png");i=cc.textureCache.addImage(s)}else if(i instanceof cc.Texture2D){}else if(cc.isString(i)){i=cc.textureCache.addImage(i)}else{cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)}var a=this._spriteFramesAliases,o=this._spriteFrames;for(var c in n){var l=n[c];var h=o[c];if(!h){h=new cc.SpriteFrame(i,l.rect,l.rotated,l.offset,l.size);var u=l.aliases;if(u){for(var d=0,_=u.length;d<_;d++){var f=u[d];if(a[f])cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,f);a[f]=c}}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&h.isRotated()){var p=h.getTexture();if(p.isLoaded()){var m=h.getTexture().getHtmlElementObj();m=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(m,h.getRectInPixels());var g=new cc.Texture2D;g.initWithElement(m);g.handleLoadedTexture();h.setTexture(g);var v=h._rect;h.setRect(cc.rect(0,0,v.width,v.height))}}o[c]=h}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);if(!i||!i["frames"])return;var n=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,n,e)},_checkConflict:function(t){var e=t["frames"];for(var i in e){if(this._spriteFrames[i]){cc.log(cc._LogInfos.spriteFrameCache__checkConflict,i)}}},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){if(!t){return}if(this._spriteFramesAliases[t]){delete this._spriteFramesAliases[t]}if(this._spriteFrames[t]){delete this._spriteFrames[t]}},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases,r=e._frameConfigCache[t];if(!r)return;var s=r.frames;for(var a in s){if(i[a]){delete i[a];for(var o in n){if(n[o]===a)delete n[o]}}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases;for(var r in i){var s=i[r];if(s&&s.getTexture()===t){delete i[r];for(var a in n){if(n[a]===r)delete n[a]}}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var n=e._spriteFramesAliases[t];if(n){i=e._spriteFrames[n.toString()];if(!i)delete e._spriteFramesAliases[t]}}return i},_clear:function(){this._spriteFrames={};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.g_NumberOfDraws=0;cc.GLToClipTransform=function(t){cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);var e=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e);t.multiply(e)};cc.Director=cc.Class.extend({_landscape:false,_nextDeltaTimeZero:false,_paused:false,_purgeDirectorInNextLoop:false,_sendCleanupToScene:false,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var t=this;t._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._totalFrames=0;this._lastUpdate=Date.now();this._paused=false;this._purgeDirectorInNextLoop=false;this._winSizeInPoints=cc.size(0,0);this._openGLView=null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;if(cc.ActionManager){this._actionManager=new cc.ActionManager;this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,false)}else{this._actionManager=null}this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);this._eventProjectionChanged.setUserData(this);return true},calculateDeltaTime:function(){var t=Date.now();if(this._nextDeltaTimeZero){this._deltaTime=0;this._nextDeltaTimeZero=false}else{this._deltaTime=(t-this._lastUpdate)/1e3}if(cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>.2)this._deltaTime=1/60;this._lastUpdate=t},convertToGL:null,convertToUI:null,drawScene:function(){var t=cc.renderer;this.calculateDeltaTime();if(!this._paused){this._scheduler.update(this._deltaTime);cc.eventManager.dispatchEvent(this._eventAfterUpdate)}t.clear();if(this._nextScene){this.setNextScene()}if(this._beforeVisitScene)this._beforeVisitScene();if(this._runningScene){if(t.childrenOrderDirty===true){cc.renderer.clearRenderCommands();this._runningScene._renderCmd._curLevel=0;this._runningScene.visit();t.resetFlag()}else if(t.transformDirty()===true)t.transform()}if(this._notificationNode)this._notificationNode.visit();cc.eventManager.dispatchEvent(this._eventAfterVisit);cc.g_NumberOfDraws=0;if(this._afterVisitScene)this._afterVisitScene();t.rendering(cc._renderContext);this._totalFrames++;cc.eventManager.dispatchEvent(this._eventAfterDraw);this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=true},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){if(this._paused)return;this._oldAnimationInterval=this._animationInterval;this.setAnimationInterval(1/4);this._paused=true},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var t=this._scenesStack.length;if(t===0)this.end();else{this._sendCleanupToScene=true;this._nextScene=this._scenesStack[t-1]}},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll();if(cc.eventManager)cc.eventManager.setEnabled(false);if(this._runningScene){this._runningScene.onExitTransitionDidStart();this._runningScene.onExit();this._runningScene.cleanup()}this._runningScene=null;this._nextScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene);this._sendCleanupToScene=false;this._scenesStack.push(t);this._nextScene=t},runScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene);if(!this._runningScene){this.pushScene(t);this.startAnimation()}else{var e=this._scenesStack.length;if(e===0){this._sendCleanupToScene=true;this._scenesStack[e]=t;this._nextScene=t}else{this._sendCleanupToScene=true;this._scenesStack[e-1]=t;this._nextScene=t}}},resume:function(){if(!this._paused){return}this.setAnimationInterval(this._oldAnimationInterval);this._lastUpdate=Date.now();if(!this._lastUpdate){cc.log(cc._LogInfos.Director_resume)}this._paused=false;this._deltaTime=0},setContentScaleFactor:function(t){if(t!==this._contentScaleFactor){this._contentScaleFactor=t}},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=false,e=false;if(cc.TransitionScene){t=this._runningScene?this._runningScene instanceof cc.TransitionScene:false;e=this._nextScene?this._nextScene instanceof cc.TransitionScene:false}if(!e){var i=this._runningScene;if(i){i.onExitTransitionDidStart();i.onExit()}if(this._sendCleanupToScene&&i)i.cleanup()}this._runningScene=this._nextScene;cc.renderer.childrenOrderDirty=true;this._nextScene=null;if(!t&&this._runningScene!==null){this._runningScene.onEnter();this._runningScene.onEnterTransitionDidFinish()}},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=true;if(this._notificationNode){this._notificationNode.onExitTransitionDidStart();this._notificationNode.onExit();this._notificationNode.cleanup()}this._notificationNode=t;if(!t)return;this._notificationNode.onEnter();this._notificationNode.onEnterTransitionDidFinish()},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return cc.profiler?cc.profiler.isShowingStats():false},setDisplayStats:function(t){if(cc.profiler){t?cc.profiler.showStats():cc.profiler.hideStats()}},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack;var i=e.length;if(t===0){this.end();return}if(t>=i)return;while(i>t){var n=e.pop();if(n.running){n.onExitTransitionDidStart();n.onExit()}n.cleanup();i--}this._nextScene=e[e.length-1];this._sendCleanupToScene=true},getScheduler:function(){return this._scheduler},setScheduler:function(t){if(this._scheduler!==t){this._scheduler=t}},getActionManager:function(){return this._actionManager},setActionManager:function(t){if(this._actionManager!==t){this._actionManager=t}},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_UPDATE="director_after_update";cc.Director.EVENT_AFTER_VISIT="director_after_visit";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.DisplayLinkDirector=cc.Director.extend({invalid:false,startAnimation:function(){this._nextDeltaTimeZero=true;this.invalid=false},mainLoop:function(){if(this._purgeDirectorInNextLoop){this._purgeDirectorInNextLoop=false;this.purgeDirector()}else if(!this.invalid){this.drawScene()}},stopAnimation:function(){this.invalid=true},setAnimationInterval:function(t){this._animationInterval=t;if(!this.invalid){this.stopAnimation();this.startAnimation()}}});cc.Director.sharedDirector=null;cc.Director.firstUseDirector=true;cc.Director._getInstance=function(){if(cc.Director.firstUseDirector){cc.Director.firstUseDirector=false;cc.Director.sharedDirector=new cc.DisplayLinkDirector;cc.Director.sharedDirector.init()}return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection};t.setProjection=function(t){this._projection=t;cc.eventManager.dispatchEvent(this._eventProjectionChanged)};t.setDepthTest=function(){};t.setClearColor=function(t){cc.renderer._clearColor=t;cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"};t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=t||cc.view;if(cc.eventManager)cc.eventManager.setEnabled(true)};t.getVisibleSize=function(){return this.getWinSize()};t.getVisibleOrigin=function(){return cc.p(0,0)}}else{cc.Director._fpsImage=new Image;cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=true});if(cc._fpsImage){cc.Director._fpsImage.src=cc._fpsImage}}});cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1;cc.ListEntry=function(t,e,i,n,r,s,a){this.prev=t;this.next=e;this.callback=i;this.target=n;this.priority=r;this.paused=s;this.markedForDeletion=a};cc.HashUpdateEntry=function(t,e,i,n,r){this.list=t;this.entry=e;this.target=i;this.callback=n;this.hh=r};cc.HashTimerEntry=cc.hashSelectorEntry=function(t,e,i,n,r,s,a){var o=this;o.timers=t;o.target=e;o.timerIndex=i;o.currentTimer=n;o.currentTimerSalvaged=r;o.paused=s;o.hh=a};cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:false,_useDelay:false,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1;this._interval=t;this._delay=i;this._useDelay=this._delay>0;this._repeat=e;this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null;this._elapsed=-1;this._runForever=false;this._useDelay=false;this._timesExecuted=0;this._repeat=0;this._delay=0;this._interval=0},update:function(t){if(this._elapsed===-1){this._elapsed=0;this._timesExecuted=0}else{this._elapsed+=t;if(this._runForever&&!this._useDelay){if(this._elapsed>=this._interval){this.trigger();this._elapsed=0}}else{if(this._useDelay){if(this._elapsed>=this._delay){this.trigger();this._elapsed-=this._delay;this._timesExecuted+=1;this._useDelay=false}}else{if(this._elapsed>=this._interval){this.trigger();this._elapsed=0;this._timesExecuted+=1}}if(!this._runForever&&this._timesExecuted>this._repeat)this.cancel()}}}});cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._target=null;this._selector=null},initWithSelector:function(t,e,i,n,r,s){this._scheduler=t;this._target=i;this._selector=e;this.setupTimerWithInterval(n,r,s);return true},getSelector:function(){return this._selector},trigger:function(){if(this._target&&this._selector){this._target.call(this._selector,this._elapsed)}},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}});cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._target=null;this._callback=null},initWithCallback:function(t,e,i,n,r,s,a){this._scheduler=t;this._target=i;this._callback=e;this._key=n;this.setupTimerWithInterval(r,s,a);return true},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){if(this._callback)this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}});cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:false,_updateHashLocked:false,ctor:function(){this._timeScale=1;this._updatesNegList=[];this._updates0List=[];this._updatesPosList=[];this._hashForUpdates={};this._hashForTimers={};this._currentTarget=null;this._currentTargetSalvaged=false;this._updateHashLocked=false;this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[e.__instanceId];if(r&&r.entry){if(r.entry.priority!==i){if(this._updateHashLocked){cc.log("warning: you CANNOT change update priority in scheduled function");r.entry.markedForDeletion=false;r.entry.paused=n;return}else{this.unscheduleUpdate(e)}}else{r.entry.markedForDeletion=false;r.entry.paused=n;return}}if(i===0){this._appendIn(this._updates0List,t,e,n)}else if(i<0){this._priorityIn(this._updatesNegList,t,e,i,n)}else{this._priorityIn(this._updatesPosList,t,e,i,n)}},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId];cc.arrayRemoveObject(this._arrayForTimers,t);t.Timer=null;t.target=null;t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[t.target.__instanceId];if(i){cc.arrayRemoveObject(i.list,i.entry);delete e._hashForUpdates[i.target.__instanceId];i.entry=null;i.target=null}},_priorityIn:function(t,e,i,n,r){var s=this,a=new cc.ListEntry(null,null,e,i,n,r,false);if(!t){t=[];t.push(a)}else{var o=t.length-1;for(var c=0;c<=o;c++){if(n<t[c].priority){o=c;break}}t.splice(c,0,a)}s._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,a,i,null);return t},_appendIn:function(t,e,i,n){var r=this,s=new cc.ListEntry(null,null,e,i,0,n,false);t.push(s);r._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,s,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=true;if(this._timeScale!==1)t*=this._timeScale;var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;e<n;e++){r=i[e];if(!r.paused&&!r.markedForDeletion)r.callback(t)}for(e=0,i=this._updates0List,n=i.length;e<n;e++){r=i[e];if(!r.paused&&!r.markedForDeletion)r.callback(t)}for(e=0,i=this._updatesPosList,n=i.length;e<n;e++){r=i[e];if(!r.paused&&!r.markedForDeletion)r.callback(t)}var s,a=this._arrayForTimers;for(e=0;e<a.length;e++){s=a[e];this._currentTarget=s;this._currentTargetSalvaged=false;if(!s.paused){for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex){s.currentTimer=s.timers[s.timerIndex];s.currentTimerSalvaged=false;s.currentTimer.update(t);s.currentTimer=null}}if(this._currentTargetSalvaged&&this._currentTarget.timers.length===0)this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;){r=i[e];if(r.markedForDeletion)this._removeUpdateFromHash(r);else e++}for(e=0,i=this._updates0List;e<i.length;){r=i[e];if(r.markedForDeletion)this._removeUpdateFromHash(r);else e++}for(e=0,i=this._updatesPosList;e<i.length;){r=i[e];if(r.markedForDeletion)this._removeUpdateFromHash(r);else e++}this._updateHashLocked=false;this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,s){this.schedule(e,t,i,n,r,s,t.__instanceId+"")},schedule:function(t,e,i,n,r,s,a){var o=false;if(typeof t!=="function"){var c=t;o=true}if(o===false){if(arguments.length===4||arguments.length===5){a=r;s=n;r=0;n=cc.REPEAT_FOREVER}}else{if(arguments.length===4){s=n;n=cc.REPEAT_FOREVER;r=0}}if(a===undefined){a=e.__instanceId+""}cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var l=this._hashForTimers[e.__instanceId];if(!l){l=new cc.HashTimerEntry(null,e,0,null,null,s,null);this._arrayForTimers.push(l);this._hashForTimers[e.__instanceId]=l}else{cc.assert(l.paused===s,"")}var h,u;if(l.timers==null){l.timers=[]}else if(o===false){for(u=0;u<l.timers.length;u++){h=l.timers[u];if(t===h._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,h.getInterval().toFixed(4),i.toFixed(4));h._interval=i;return}}}else{for(u=0;u<l.timers.length;++u){h=l.timers[u];if(h&&c===h.getSelector()){cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",h.getInterval(),i);h.setInterval(i);return}}}if(o===false){h=new cc.TimerTargetCallback;h.initWithCallback(this,t,e,a,i,n,r);l.timers.push(h)}else{h=new cc.TimerTargetSelector;h.initWithSelector(this,c,e,i,n,r);l.timers.push(h)}},scheduleUpdate:function(t,e,i){this._schedulePerFrame(function(e){t.update(e)},t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(!e||!t)return;var i=this,n=i._hashForTimers[e.__instanceId];if(n){var r=n.timers;for(var s=0,a=r.length;s<a;s++){var o=r[s];if(this._getUnscheduleMark(t,o)){if(o===n.currentTimer&&!n.currentTimerSalvaged){n.currentTimerSalvaged=true}r.splice(s,1);if(n.timerIndex>=s){n.timerIndex--}if(r.length===0){if(i._currentTarget===n){i._currentTargetSalvaged=true}else{i._removeHashElement(n)}}return}}}},unscheduleUpdate:function(t){if(t==null)return;var e=this._hashForUpdates[t.__instanceId];if(e){if(this._updateHashLocked){e.entry.markedForDeletion=true}else{this._removeUpdateFromHash(e.entry)}}},unscheduleAllForTarget:function(t){if(t==null){return}var e=this._hashForTimers[t.__instanceId];if(e){if(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged){e.currentTimerSalvaged=true}e.timers.length=0;if(this._currentTarget===e){this._currentTargetSalvaged=true}else{this._removeHashElement(e)}}this.unscheduleUpdate(t)},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--){i=n[e];this.unscheduleAllForTarget(i.target)}var r;var s=0;if(t<0){for(e=0;e<this._updatesNegList.length;){s=this._updatesNegList.length;r=this._updatesNegList[e];if(r&&r.priority>=t)this.unscheduleUpdate(r.target);if(s==this._updatesNegList.length)e++}}if(t<=0){for(e=0;e<this._updates0List.length;){s=this._updates0List.length;r=this._updates0List[e];if(r)this.unscheduleUpdate(r.target);if(s==this._updates0List.length)e++}}for(e=0;e<this._updatesPosList.length;){s=this._updatesPosList.length;r=this._updatesPosList[e];if(r&&r.priority>=t)this.unscheduleUpdate(r.target);if(s==this._updatesPosList.length)e++}},isScheduled:function(t,e){cc.assert(t,"Argument key must not be empty");cc.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[e.__instanceId];if(!i){return false}if(i.timers==null){return false}else{var n=i.timers;for(var r=0;r<n.length;++r){var s=n[r];if(t===s.getKey()){return true}}return false}},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e=[];var i=this,n,r=i._arrayForTimers;var s,a;for(s=0,a=r.length;s<a;s++){n=r[s];if(n){n.paused=true;e.push(n.target)}}var o;if(t<0){for(s=0;s<this._updatesNegList.length;s++){o=this._updatesNegList[s];if(o){if(o.priority>=t){o.paused=true;e.push(o.target)}}}}if(t<=0){for(s=0;s<this._updates0List.length;s++){o=this._updates0List[s];if(o){o.paused=true;e.push(o.target)}}}for(s=0;s<this._updatesPosList.length;s++){o=this._updatesPosList[s];if(o){if(o.priority>=t){o.paused=true;e.push(o.target)}}}return e},resumeTargets:function(t){if(!t)return;for(var e=0;e<t.length;e++){this.resumeTarget(t[e])}},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_pauseTarget);var e=this,i=e._hashForTimers[t.__instanceId];if(i){i.paused=true}var n=e._hashForUpdates[t.__instanceId];if(n){n.entry.paused=true}},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_resumeTarget);var e=this,i=e._hashForTimers[t.__instanceId];if(i){i.paused=false}var n=e._hashForUpdates[t.__instanceId];if(n){n.entry.paused=false}},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];if(e){return e.paused}var i=this._hashForUpdates[t.__instanceId];if(i){return i.entry.paused}return false},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}});cc.Scheduler.PRIORITY_SYSTEM=-2147483647-1;cc._tmp.PrototypeLabelTTF=function(){var t=cc.LabelTTF.prototype;cc.defineGetterSetter(t,"color",t.getColor,t.setColor);cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity);t.string;cc.defineGetterSetter(t,"string",t.getString,t.setString);t.textAlign;cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment);
t.verticalAlign;cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment);t.fontSize;cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize);t.fontName;cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName);t.font;cc.defineGetterSetter(t,"font",t._getFont,t._setFont);t.boundingSize;t.boundingWidth;cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth);t.boundingHeight;cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight);t.fillStyle;cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor);t.strokeStyle;cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle);t.lineWidth;cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth);t.shadowOffset;t.shadowOffsetX;cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX);t.shadowOffsetY;cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY);t.shadowOpacity;cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity);t.shadowBlur;cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:true,_shadowEnabled:false,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:false,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:false,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,n,r,s){var a;if(t)a=t+"";else a="";i=i||16;n=n||cc.size(0,0);r=r||cc.TEXT_ALIGNMENT_LEFT;s=s||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=false;this._dimensions=cc.size(n.width,n.height);this._fontName=e||"Arial";this._hAlignment=r;this._vAlignment=s;this._fontSize=i;this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight);this.string=a;this._renderCmd._setColorsString();this._renderCmd._updateTexture();this._setUpdateTextureDirty();return true},_setUpdateTextureDirty:function(){this._needUpdateTexture=true;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,n,r,s){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=false;this._fontName="Arial";this._shadowEnabled=false;this._shadowOffset=cc.p(0,0);this._shadowOpacity=0;this._shadowBlur=0;this._strokeEnabled=false;this._strokeColor=cc.color(255,255,255,255);this._strokeSize=0;this._textFillColor=cc.color(255,255,255,255);this._strokeShadowOffsetX=0;this._strokeShadowOffsetY=0;this._needUpdateTexture=false;this._lineWidths=[];this._renderCmd._setColorsString();this._textureLoaded=true;if(e&&e instanceof cc.FontDefinition){this.initWithStringAndTextDefinition(t,e)}else{cc.LabelTTF.prototype.initWithString.call(this,t,e,i,n,r,s)}},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){this._updateWithTextDefinition(e,false);this.string=t;return true},setTextDefinition:function(t){if(t)this._updateWithTextDefinition(t,true)},getTextDefinition:function(){return this._prepareTextDefinition(false)},enableShadow:function(t,e,i,n){if(t.r!=null&&t.g!=null&&t.b!=null&&t.a!=null){this._enableShadow(t,e,i)}else{this._enableShadowNoneColor(t,e,i,n)}},_enableShadowNoneColor:function(t,e,i,n){i=i||.5;if(false===this._shadowEnabled)this._shadowEnabled=true;var r=this._shadowOffset;if(r&&r.x!==t||r._y!==e){r.x=t;r.y=e}if(this._shadowOpacity!==i){this._shadowOpacity=i}this._renderCmd._setColorsString();if(this._shadowBlur!==n)this._shadowBlur=n;this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){if(!this._shadowColor){this._shadowColor=cc.color(255,255,255,128)}this._shadowColor.r=t.r;this._shadowColor.g=t.g;this._shadowColor.b=t.b;var n,r,s,a;n=e.width||e.x||0;r=e.height||e.y||0;s=t.a!=null?t.a/255:.5;a=i;this._enableShadowNoneColor(n,r,s,a)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){if(false===this._shadowEnabled)this._shadowEnabled=true;if(this._shadowOffset.x!==t){this._shadowOffset.x=t;this._setUpdateTextureDirty()}},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){if(false===this._shadowEnabled)this._shadowEnabled=true;if(this._shadowOffset._y!==t){this._shadowOffset._y=t;this._setUpdateTextureDirty()}},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){if(false===this._shadowEnabled)this._shadowEnabled=true;if(this._shadowOffset.x!==t.x||this._shadowOffset.y!==t.y){this._shadowOffset.x=t.x;this._shadowOffset.y=t.y;this._setUpdateTextureDirty()}},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){if(false===this._shadowEnabled)this._shadowEnabled=true;if(this._shadowOpacity!==t){this._shadowOpacity=t;this._renderCmd._setColorsString();this._setUpdateTextureDirty()}},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){if(false===this._shadowEnabled)this._shadowEnabled=true;if(this._shadowBlur!==t){this._shadowBlur=t;this._setUpdateTextureDirty()}},disableShadow:function(){if(this._shadowEnabled){this._shadowEnabled=false;this._setUpdateTextureDirty()}},enableStroke:function(t,e){if(this._strokeEnabled===false)this._strokeEnabled=true;var i=this._strokeColor;if(i.r!==t.r||i.g!==t.g||i.b!==t.b){i.r=t.r;i.g=t.g;i.b=t.b;this._renderCmd._setColorsString()}if(this._strokeSize!==e)this._strokeSize=e||0;this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){if(this._strokeEnabled===false)this._strokeEnabled=true;var e=this._strokeColor;if(e.r!==t.r||e.g!==t.g||e.b!==t.b){e.r=t.r;e.g=t.g;e.b=t.b;this._renderCmd._setColorsString();this._setUpdateTextureDirty()}},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){if(this._strokeEnabled===false)this._strokeEnabled=true;if(this._strokeSize!==t){this._strokeSize=t||0;this._setUpdateTextureDirty()}},disableStroke:function(){if(this._strokeEnabled){this._strokeEnabled=false;this._setUpdateTextureDirty()}},setFontFillColor:function(t){var e=this._textFillColor;if(e.r!==t.r||e.g!==t.g||e.b!==t.b){e.r=t.r;e.g=t.g;e.b=t.b;this._renderCmd._setColorsString();this._needUpdateTexture=true}},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){if(t.fontDimensions){this._dimensions.width=t.boundingWidth;this._dimensions.height=t.boundingHeight}else{this._dimensions.width=0;this._dimensions.height=0}this._hAlignment=t.textAlign;this._vAlignment=t.verticalAlign;this._fontName=t.fontName;this._fontSize=t.fontSize||12;if(t.lineHeight)this._lineHeight=t.lineHeight;else this._lineHeight=this._fontSize;this._renderCmd._setFontStyle(t);if(t.shadowEnabled)this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur);if(t.strokeEnabled)this.enableStroke(t.strokeStyle,t.lineWidth);this.setFontFillColor(t.fillStyle);if(e)this._renderCmd._updateTexture();var i=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(i.colorDirty|i.opacityDirty|i.textDirty)},_prepareTextDefinition:function(t){var e=new cc.FontDefinition;if(t){e.fontSize=this._fontSize;e.boundingWidth=cc.contentScaleFactor()*this._dimensions.width;e.boundingHeight=cc.contentScaleFactor()*this._dimensions.height}else{e.fontSize=this._fontSize;e.boundingWidth=this._dimensions.width;e.boundingHeight=this._dimensions.height}e.fontName=this._fontName;e.textAlign=this._hAlignment;e.verticalAlign=this._vAlignment;if(this._strokeEnabled){e.strokeEnabled=true;var i=this._strokeColor;e.strokeStyle=cc.color(i.r,i.g,i.b);e.lineWidth=this._strokeSize}else e.strokeEnabled=false;if(this._shadowEnabled){e.shadowEnabled=true;e.shadowBlur=this._shadowBlur;e.shadowOpacity=this._shadowOpacity;e.shadowOffsetX=(t?cc.contentScaleFactor():1)*this._shadowOffset.x;e.shadowOffsetY=(t?cc.contentScaleFactor():1)*this._shadowOffset.y}else e._shadowEnabled=false;var n=this._textFillColor;e.fillStyle=cc.color(n.r,n.g,n.b);return e},setString:function(t){t=String(t);if(this._originalText!==t){this._originalText=t+"";this._updateString();this._setUpdateTextureDirty();this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}},_updateString:function(){if((!this._string||this._string==="")&&this._string!==this._originalText)cc.renderer.childrenOrderDirty=true;this._string=this._originalText},setHorizontalAlignment:function(t){if(t!==this._hAlignment){this._hAlignment=t;this._setUpdateTextureDirty()}},setVerticalAlignment:function(t){if(t!==this._vAlignment){this._vAlignment=t;this._setUpdateTextureDirty()}},setDimensions:function(t,e){var i;if(e===undefined){i=t.width;e=t.height}else i=t;if(i!==this._dimensions.width||e!==this._dimensions.height){this._dimensions.width=i;this._dimensions.height=e;this._updateString();this._setUpdateTextureDirty()}},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){if(t!==this._dimensions.width){this._dimensions.width=t;this._updateString();this._setUpdateTextureDirty()}},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){if(t!==this._dimensions.height){this._dimensions.height=t;this._updateString();this._setUpdateTextureDirty()}},setFontSize:function(t){if(this._fontSize!==t){this._fontSize=t;this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight);this._setUpdateTextureDirty()}},setFontName:function(t){if(this._fontName&&this._fontName!==t){this._fontName=t;this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight);this._setUpdateTextureDirty()}},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);if(e){this._fontSize=parseInt(e[1]);this._fontName=e[2];this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight);this._setUpdateTextureDirty()}},getContentSize:function(){if(this._needUpdateTexture)this._renderCmd._updateTTF();return cc.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){if(this._needUpdateTexture)this._renderCmd._updateTTF();return cc.Sprite.prototype._getWidth.call(this)},_getHeight:function(){if(this._needUpdateTexture)this._renderCmd._updateTTF();return cc.Sprite.prototype._getHeight.call(this)},setTextureRect:function(t,e,i){cc.Sprite.prototype.setTextureRect.call(this,t,e,i,false)},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.LabelTTF.WebGLRenderCmd(this);else if(this._onCacheCanvasMode)return new cc.LabelTTF.CacheCanvasRenderCmd(this);else return new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(t){if(this._fontStyle!==t){this._fontStyle=t;this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight);this._setUpdateTextureDirty()}},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){if(this._fontWeight!==t){this._fontWeight=t;this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight);this._setUpdateTextureDirty()}},_getFontWeight:function(){return this._fontWeight}});cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;cc.LabelTTF.create=function(t,e,i,n,r,s){return new cc.LabelTTF(t,e,i,n,r,s)};cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create;if(cc.USE_LA88_LABELS)cc.LabelTTF._SHADER_PROGRAM=cc.SHADER_POSITION_TEXTURECOLOR;else cc.LabelTTF._SHADER_PROGRAM=cc.SHADER_POSITION_TEXTUREA8COLOR;cc.LabelTTF.__labelHeightDiv=document.createElement("div");cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";cc.LabelTTF.__labelHeightDiv.style.position="absolute";cc.LabelTTF.__labelHeightDiv.style.left="-100px";cc.LabelTTF.__labelHeightDiv.style.top="-100px";cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,false);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},false);cc.LabelTTF.__getFontHeightByDiv=function(t,e){if(t instanceof cc.FontDefinition){var i=t;var n=cc.LabelTTF.__fontHeightCache[i._getCanvasFontStr()];if(n>0)return n;var r=cc.LabelTTF.__labelHeightDiv;r.innerHTML="ajghl~!";r.style.fontFamily=i.fontName;r.style.fontSize=i.fontSize+"px";r.style.fontStyle=i.fontStyle;r.style.fontWeight=i.fontWeight;n=r.clientHeight;cc.LabelTTF.__fontHeightCache[i._getCanvasFontStr()]=n;r.innerHTML="";return n}var n=cc.LabelTTF.__fontHeightCache[t+"."+e];if(n>0)return n;var r=cc.LabelTTF.__labelHeightDiv;r.innerHTML="ajghl~!";r.style.fontFamily=t;r.style.fontSize=e+"px";n=r.clientHeight;cc.LabelTTF.__fontHeightCache[t+"."+e]=n;r.innerHTML="";return n};cc.LabelTTF.__fontHeightCache={};cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF.wrapInspection=true;cc.LabelTTF._wordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)/;cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>、‘“》？。，！]/;cc.LabelTTF._lastWordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)$/;cc.LabelTTF._lastEnglish=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+$/;cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]/;(function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18;this._fontStyleStr="";this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeColorStr="";this._fillColorStr="rgba(255,255,255,1)";this._labelCanvas=null;this._labelContext=null;this._lineWidths=[];this._strings=[];this._isMultiLine=false;this._status=[];this._renderingIndex=0};var t=cc.LabelTTF.RenderCmd.prototype;t.constructor=cc.LabelTTF.RenderCmd;t._setFontStyle=function(t,e,i,n){if(t instanceof cc.FontDefinition){this._fontStyleStr=t._getCanvasFontStr();this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t)}else{this._fontStyleStr=i+" "+n+" "+e+"px '"+t+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,e)}};t._getFontStyle=function(){return this._fontStyleStr};t._getFontClientHeight=function(){return this._fontClientHeight};t._updateColor=function(){this._setColorsString();this._updateTexture()};t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor;var n=e._strokeColor,r=e._textFillColor;var s=t.r/255,a=t.g/255,o=t.b/255;this._shadowColorStr="rgba("+(0|s*i.r)+","+(0|a*i.g)+","+(0|o*i.b)+","+e._shadowOpacity+")";this._fillColorStr="rgba("+(0|s*r.r)+","+(0|a*r.g)+","+(0|o*r.b)+", 1)";this._strokeColorStr="rgba("+(0|s*n.r)+","+(0|a*n.g)+","+(0|o*n.b)+", 1)"};t._updateTTF=function(){var t=this._node;var e=t._dimensions.width,i,n;var r=this._lineWidths;r.length=0;this._isMultiLine=false;this._measureConfig();if(e!==0){this._strings=t._string.split("\n");for(i=0;i<this._strings.length;i++){this._checkWarp(this._strings,i,e)}}else{this._strings=t._string.split("\n");for(i=0,n=this._strings.length;i<n;i++){r.push(this._measure(this._strings[i]))}}if(this._strings.length>1)this._isMultiLine=true;var s,a=0,o=0;if(t._strokeEnabled)a=o=t._strokeSize*2;if(t._shadowEnabled){var c=t._shadowOffset;a+=Math.abs(c.x)*2;o+=Math.abs(c.y)*2}if(e===0){if(this._isMultiLine)s=cc.size(Math.ceil(Math.max.apply(Math,r)+a),Math.ceil(this._fontClientHeight*this._strings.length+o));else s=cc.size(Math.ceil(this._measure(t._string)+a),Math.ceil(this._fontClientHeight+o))}else{if(t._dimensions.height===0){if(this._isMultiLine)s=cc.size(Math.ceil(e+a),Math.ceil(t.getLineHeight()*this._strings.length+o));else s=cc.size(Math.ceil(e+a),Math.ceil(t.getLineHeight()+o))}else{s=cc.size(Math.ceil(e+a),Math.ceil(t._dimensions.height+o))}}if(t._getFontStyle()!=="normal"){s.width=Math.ceil(s.width+t._fontSize*.3)}t.setContentSize(s);t._strokeShadowOffsetX=a;t._strokeShadowOffsetY=o;var l=t._anchorPoint;this._anchorPointInPoints.x=a*.5+(s.width-a)*l.x;this._anchorPointInPoints.y=o*.5+(s.height-o)*l.y};t._saveStatus=function(){var t=this._node;var e=t._strokeShadowOffsetX,i=t._strokeShadowOffsetY;var n=t._contentSize.height-i,r=t._vAlignment,s=t._hAlignment;var a=e*.5,o=n+i*.5;var c=0,l=0,h=[];var u=t._contentSize.width-e;var d=t.getLineHeight();var _=(d-this._fontClientHeight)/2;if(s===cc.TEXT_ALIGNMENT_RIGHT)c+=u;else if(s===cc.TEXT_ALIGNMENT_CENTER)c+=u/2;else c+=0;if(this._isMultiLine){var f=this._strings.length;if(r===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM)l=d-_*2+n-d*f;else if(r===cc.VERTICAL_TEXT_ALIGNMENT_CENTER)l=(d-_*2)/2+(n-d*f)/2;for(var p=0;p<f;p++){var m=-n+(d*p+_)+l;h.push(m)}}else{if(r===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM){}else if(r===cc.VERTICAL_TEXT_ALIGNMENT_TOP){l-=n}else{l-=n*.5}h.push(l)}var g={contextTransform:cc.p(a,o),xOffset:c,OffsetYArray:h};this._status.push(g)};t._drawTTFInCanvas=function(t){if(!t)return;var e=this._status.pop();t.setTransform(1,0,0,1,e.contextTransform.x,e.contextTransform.y);var i=e.xOffset;var n=e.OffsetYArray;this.drawLabels(t,i,n)};t._checkWarp=function(t,e,i){var n=t[e];var r=this._measure(n);if(r>i&&n.length>1){var s=n.length*(i/r)|0;var a=n.substr(s);var o=r-this._measure(a);var c;var l=0;var h=0;while(o>i&&h++<100){s*=i/o;s=s|0;a=n.substr(s);o=r-this._measure(a)}h=0;while(o<i&&h++<100){if(a){var u=cc.LabelTTF._wordRex.exec(a);l=u?u[0].length:1;c=a}s=s+l;a=n.substr(s);o=r-this._measure(a)}s-=l;if(s===0){s=1;c=c.substr(1)}var d=n.substr(0,s),_;if(cc.LabelTTF.wrapInspection){if(cc.LabelTTF._symbolRex.test(c||a)){_=cc.LabelTTF._lastWordRex.exec(d);s-=_?_[0].length:0;c=n.substr(s);d=n.substr(0,s)}}if(cc.LabelTTF._firsrEnglish.test(c)){_=cc.LabelTTF._lastEnglish.exec(d);if(_&&d!==_[0]){s-=_[0].length;c=n.substr(s);d=n.substr(0,s)}}t[e]=c||a;t.splice(e,0,d)}};t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;cc.Node.RenderCmd.prototype.updateStatus.call(this);if(e&t.textDirty)this._updateTexture();if(this._dirtyFlag&t.transformDirty){this.transform(this.getParentRenderCmd(),true);this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag}};t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;cc.Node.RenderCmd.prototype._syncStatus.call(this,t);if(i&e.textDirty)this._updateTexture();if(cc._renderType===cc.game.RENDER_TYPE_WEBGL||i&e.transformDirty)this.transform(t)};t.drawLabels=function(t,e,i){var n=this._node;if(n._shadowEnabled){var r=n._shadowOffset;t.shadowColor=this._shadowColorStr;t.shadowOffsetX=r.x;t.shadowOffsetY=-r.y;t.shadowBlur=n._shadowBlur}var s=n._hAlignment,a=n._vAlignment,o=n._strokeSize;if(t.font!==this._fontStyleStr)t.font=this._fontStyleStr;t.fillStyle=this._fillColorStr;var c=n._strokeEnabled;if(c){t.lineWidth=o*2;t.strokeStyle=this._strokeColorStr}t.textBaseline=cc.LabelTTF._textBaseline[a];t.textAlign=cc.LabelTTF._textAlign[s];var l=this._strings.length;for(var h=0;h<l;h++){var u=this._strings[h];if(c)t.strokeText(u,e,i[h]);t.fillText(u,e,i[h])}cc.g_NumberOfDraws++}})();(function(){cc.LabelTTF.CacheRenderCmd=function(t){cc.LabelTTF.RenderCmd.call(this,t);var e=this._labelCanvas=document.createElement("canvas");e.width=1;e.height=1;this._labelContext=e.getContext("2d")};cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var t=cc.LabelTTF.CacheRenderCmd.prototype;t.constructor=cc.LabelTTF.CacheRenderCmd;t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node;var e=t._contentSize;this._updateTTF();var i=e.width,n=e.height;var r=this._labelContext,s=this._labelCanvas;if(!t._texture){var a=new cc.Texture2D;a.initWithElement(this._labelCanvas);t.setTexture(a)}if(t._string.length===0){s.width=1;s.height=e.height||1;t._texture&&t._texture.handleLoadedTexture();t.setTextureRect(cc.rect(0,0,1,e.height));return true}r.font=this._fontStyleStr;var o=s.width===i&&s.height===n;s.width=i;s.height=n;if(o)r.clearRect(0,0,i,n);this._saveStatus();this._drawTTFInCanvas(r);t._texture&&t._texture.handleLoadedTexture();t.setTextureRect(cc.rect(0,0,i,n));return true};t._measureConfig=function(){this._labelContext.font=this._fontStyleStr};t._measure=function(t){return this._labelContext.measureText(t).width}})();(function(){cc.LabelTTF.CacheCanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t);cc.LabelTTF.CacheRenderCmd.call(this)};var t=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t);t.constructor=cc.LabelTTF.CacheCanvasRenderCmd})();(function(){cc.LabelTTF.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t);cc.LabelTTF.RenderCmd.call(this)};cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var t=cc.LabelTTF.CanvasRenderCmd.prototype;t.constructor=cc.LabelTTF.CanvasRenderCmd;t._measureConfig=function(){};t._measure=function(t){var e=cc._renderContext.getContext();e.font=this._fontStyleStr;return e.measureText(t).width};t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node;var e=t._contentSize;this._updateTTF();var i=e.width,n=e.height;if(t._string.length===0){t.setTextureRect(cc.rect(0,0,1,e.height));return true}this._saveStatus();t.setTextureRect(cc.rect(0,0,i,n));return true};t.rendering=function(t){var e=cc.view.getScaleX(),i=cc.view.getScaleY();var n=t||cc._renderContext,r=n.getContext();if(!r)return;var s=this._node;n.computeRealOffsetY();if(this._status.length<=0)return;var a=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex;var o=this._status[a];this._renderingIndex=a+1;var c=s._rect.height,l=s._offsetPosition.x,h=-s._offsetPosition.y-c;var u=this._displayedOpacity/255;n.setTransform(this._worldTransform,e,i);n.setCompositeOperation(this._blendFuncStr);n.setGlobalAlpha(u);n.save();if(s._flippedX){l=-l-s._rect.width;r.scale(-1,1)}if(s._flippedY){h=s._offsetPosition.y;r.scale(1,-1)}var d=o.xOffset+o.contextTransform.x+l*e;var _=[];var f=this._strings.length;for(var p=0;p<f;p++)_.push(o.OffsetYArray[p]+o.contextTransform.y+h*i);this.drawLabels(r,d,_);n.restore()}})();var cc=cc||{};cc._tmp=cc._tmp||{};cc.associateWithNative=function(t,e){};cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};cc.FMT_JPG=0;cc.FMT_PNG=1;cc.FMT_TIFF=2;cc.FMT_RAWDATA=3;cc.FMT_WEBP=4;cc.FMT_UNKNOWN=5;cc.getImageFormatByData=function(t){if(t.length>8&&t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71&&t[4]===13&&t[5]===10&&t[6]===26&&t[7]===10){return cc.FMT_PNG}if(t.length>2&&(t[0]===73&&t[1]===73||t[0]===77&&t[1]===77||t[0]===255&&t[1]===216)){return cc.FMT_TIFF}return cc.FMT_UNKNOWN};cc.inherits=function(t,e){function i(){}i.prototype=e.prototype;t.superClass_=e.prototype;t.prototype=new i;t.prototype.constructor=t};cc.base=function(t,e,i){var n=arguments.callee.caller;if(n.superClass_){ret=n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));return ret}var r=Array.prototype.slice.call(arguments,2);var s=false;for(var a=t.constructor;a;a=a.superClass_&&a.superClass_.constructor){if(a.prototype[e]===n){s=true}else if(s){return a.prototype[e].apply(t,r)}}if(t[e]===n){return t.constructor.prototype[e].apply(t,r)}else{throw Error("cc.base called from a method of one name "+"to a method of a different name")}};cc.rendererCanvas={childrenOrderDirty:true,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:false,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e=this._renderCmds,i,n,r=cc.view.getScaleX(),s=cc.view.getScaleY();var a=t||cc._renderContext;a.computeRealOffsetY();for(i=0,n=e.length;i<n;i++){e[i].rendering(a,r,s)}},_renderingToCacheCanvas:function(t,e,i,n){if(!t)cc.log("The context of RenderTexture is invalid.");i=cc.isUndefined(i)?1:i;n=cc.isUndefined(n)?1:n;e=e||this._currentID;var r=this._cacheToCanvasCmds[e],s,a;t.computeRealOffsetY();for(s=0,a=r.length;s<a;s++){r[s].rendering(t,i,n)}r.length=0;var o=this._cacheInstanceIds;delete this._cacheToCanvasCmds[e];cc.arrayRemoveObject(o,e);if(o.length===0)this._isCacheToCanvasOn=false;else this._currentID=o[o.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=true;t=t||0;this._cacheToCanvasCmds[t]=[];if(this._cacheInstanceIds.indexOf(t)===-1)this._cacheInstanceIds.push(t);this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=false},resetFlag:function(){this.childrenOrderDirty=false;this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++){if(t[e]._dirtyFlag!==0)t[e].updateStatus()}t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){var t=cc._canvas;var e=cc._renderContext;var i=e.getContext();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,t.width,t.height);if(this._clearColor.r!==0||this._clearColor.g!==0||this._clearColor.b!==0){e.setFillStyle(this._clearFillStyle);e.setGlobalAlpha(this._clearColor.a);i.fillRect(0,0,t.width,t.height)}},clearRenderCommands:function(){this._renderCmds.length=0;this._cacheInstanceIds.length=0;this._isCacheToCanvasOn=false},pushRenderCommand:function(t){if(!t._needDraw)return;if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds;var n=i[e];if(n.indexOf(t)===-1)n.push(t)}else{if(this._renderCmds.indexOf(t)===-1)this._renderCmds.push(t)}}};(function(){cc.CanvasContextWrapper=function(t){this._context=t;this._saveCount=0;this._currentAlpha=t.globalAlpha;this._currentCompositeOperation=t.globalCompositeOperation;this._currentFillStyle=t.fillStyle;this._currentStrokeStyle=t.strokeStyle;this._offsetX=0;this._offsetY=0;this._realOffsetY=this.height;this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha;this._currentCompositeOperation=t.globalCompositeOperation;this._currentFillStyle=t.fillStyle;this._currentStrokeStyle=t.strokeStyle;this._realOffsetY=this._context.canvas.height+this._offsetY};t.setOffset=function(t,e){this._offsetX=t;this._offsetY=e;this._realOffsetY=this._context.canvas.height+this._offsetY};t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY};t.setViewScale=function(t,e){this._scaleX=t;this._scaleY=e};t.getContext=function(){return this._context};t.save=function(){this._context.save();this._saveCount++};t.restore=function(){this._context.restore();this._saveCount--};t.setGlobalAlpha=function(t){if(this._saveCount>0){this._context.globalAlpha=t}else{if(this._currentAlpha!==t){this._currentAlpha=t;this._context.globalAlpha=t}}};t.setCompositeOperation=function(t){if(this._saveCount>0){this._context.globalCompositeOperation=t}else{if(this._currentCompositeOperation!==t){this._currentCompositeOperation=t;this._context.globalCompositeOperation=t}}};t.setFillStyle=function(t){if(this._saveCount>0){this._context.fillStyle=t}else{if(this._currentFillStyle!==t){this._currentFillStyle=t;this._context.fillStyle=t}}};t.setStrokeStyle=function(t){if(this._saveCount>0){this._context.strokeStyle=t}else{if(this._currentStrokeStyle!==t){this._currentStrokeStyle=t;this._context.strokeStyle=t}}};t.setTransform=function(t,e,i){if(this._armatureMode>0){this.restore();this.save();this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i))}else{this._context.setTransform(t.a,-t.b,-t.c,t.d,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)}};t._switchToArmatureMode=function(t,e,i,n){if(t){this._armatureMode++;this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n);this.save()}else{this._armatureMode--;this.restore()}}})();cc.profiler=function(){var t=_showFPS=false;var e=_frameRate=_lastSPF=_accumDt=0;var n=_afterVisitListener=_FPSLabel=_SPFLabel=_drawsLabel=null;var r=.6,s=10;var a=[0,10,20,30];var o=[0,0,0,0];var c=3,l=0,h=0;var u=function(){var t=0;var e=cc.winSize.width,i=cc.winSize.height;var n=cc.DIRECTOR_STATS_POSITION;if(e>i)t=0|i/320*24;else t=0|e/320*24;_FPSLabel=new cc.LabelTTF("000.0","Arial",t);_SPFLabel=new cc.LabelTTF("0.000","Arial",t);_drawsLabel=new cc.LabelTTF("0000","Arial",t);_drawsLabel.setPosition(_drawsLabel.width/2+n.x,_drawsLabel.height*5/2+n.y);_SPFLabel.setPosition(_SPFLabel.width/2+n.x,_SPFLabel.height*3/2+n.y);_FPSLabel.setPosition(_FPSLabel.width/2+n.x,_FPSLabel.height/2+n.y)};var d=function(t){var e=i=a.length-1,n,u=0;l++;h+=t;for(;i>=0;i--){if(t>=a[i]){o[i]++;break}}if(l>=s){u=h/s;for(i=e;i>0;i--){n=o[i]/s;if(n>=r&&u>=a[i]){if(i!=c){c=i;p.onFrameRateChange&&p.onFrameRateChange(u.toFixed(2))}break}}_changeCount=0;l=0;h=0;for(i=e;i>0;i--){o[i]=0}}};var _=function(){_lastSPF=cc.director.getSecondsPerFrame();e++;_accumDt+=cc.director.getDeltaTime();if(_accumDt>cc.DIRECTOR_FPS_INTERVAL){_frameRate=e/_accumDt;e=0;_accumDt=0;if(p.onFrameRateChange){d(_frameRate)}if(_showFPS){_SPFLabel.string=_lastSPF.toFixed(3);_FPSLabel.string=_frameRate.toFixed(1);_drawsLabel.string=(0|cc.g_NumberOfDraws).toString()}}if(_showFPS){_FPSLabel.visit();_SPFLabel.visit();_drawsLabel.visit()}};var f=function(){_FPSLabel._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);_SPFLabel._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);_drawsLabel._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)};var p={onFrameRateChange:null,getSecondsPerFrame:function(){return _lastSPF},getFrameRate:function(){return _frameRate},setProfileDuration:function(t){if(!isNaN(t)&&t>0){s=t/cc.DIRECTOR_FPS_INTERVAL}},resumeProfiling:function(){cc.eventManager.addListener(_afterVisitListener,1)},stopProfiling:function(){cc.eventManager.removeListener(_afterVisitListener)},isShowingStats:function(){
return _showFPS},showStats:function(){if(!t){this.init()}if(cc.LabelTTF&&!_FPSLabel){u()}if(_FPSLabel){_showFPS=true}},hideStats:function(){_showFPS=false},init:function(){if(!t){_afterVisitListener=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,_);n=cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,f);t=true}}};return p}();cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL){return}cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var t=cc.Director.prototype;var e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++){e(n[i])}}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){var t=cc.director;var i=cc.director._scenesStack;for(var n=0;n<i.length;n++)e(i[n])});t.setProjection=function(t){var e=this;var i=e._winSizeInPoints;e.setViewport();var n=e._openGLView,r=n._viewPortRect.x/n._scaleX,s=n._viewPortRect.y/n._scaleY;switch(t){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();var a=cc.math.Matrix4.createOrthographicProjection(-r,i.width-r,-s,i.height-s,-1024,1024);cc.kmGLMultMatrix(a);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var o=e.getZEye();var c=new cc.math.Matrix4,l=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();c=cc.math.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,o*2);cc.kmGLMultMatrix(c);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();var h=new cc.math.Vec3(-r+i.width/2,-s+i.height/2,o);var u=new cc.math.Vec3(-r+i.width/2,-s+i.height/2,0);var d=new cc.math.Vec3(0,1,0);l.lookAt(h,u,d);cc.kmGLMultMatrix(l);break;case cc.Director.PROJECTION_CUSTOM:if(e._projectionDelegate)e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection);break}e._projection=t;cc.eventManager.dispatchEvent(e._eventProjectionChanged);cc.setProjectionMatrixDirty();cc.renderer.childrenOrderDirty=true};t.setDepthTest=function(t){cc.renderer.setDepthTest(t)};t.setClearColor=function(t){cc.renderer._clearColor=t};t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width;e._winSizeInPoints.height=cc._canvas.height;e._openGLView=t||cc.view;var i=cc.configuration;i.gatherGPUInfo();i.dumpInfo();e.setGLDefaultValues();if(cc.eventManager)cc.eventManager.setEnabled(true)};t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)};t._beforeVisitScene=function(){cc.kmGLPushMatrix()};t._afterVisitScene=function(){cc.kmGLPopMatrix()};t.convertToGL=function(t){var e=new cc.math.Matrix4;cc.GLToClipTransform(e);var i=e.inverse();var n=e.mat[14]/e.mat[15];var r=this._openGLView.getDesignResolutionSize();var s=new cc.math.Vec3(2*t.x/r.width-1,1-2*t.y/r.height,n);s.transformCoord(i);return cc.p(s.x,s.y)};t.convertToUI=function(t){var e=new cc.math.Matrix4;cc.GLToClipTransform(e);var i=new cc.math.Vec3(t.x,t.y,0);i.transformCoord(e);var n=this._openGLView.getDesignResolutionSize();return cc.p(n.width*(i.x*.5+.5),n.height*(-i.y*.5+.5))};t.getVisibleSize=function(){return this._openGLView.getVisibleSize()};t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()};t.getZEye=function(){return this._winSizeInPoints.height/1.1566};t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}};t.getOpenGLView=function(){return this._openGLView};t.getProjection=function(){return this._projection};t.setAlphaBlending=function(t){if(t)cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST);else cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)};t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(true);t.setDepthTest(false);t.setProjection(t._projection);cc._renderContext.clearColor(0,0,0,0)}});cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:false,_supportsNPOT:false,_supportsBGRA8888:false,_supportsDiscardFramebuffer:false,_supportsShareableVAO:false,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:false,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION;t["cocos2d.x.compiled_with_profiler"]=false;t["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE;this._inited=true},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return false},supportsS3TC:function(){return false},supportsATITC:function(){return false},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){if(!this._inited)this._init();var i=this._valueDict;if(i[t])return i[t];return e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){if(cc.ENABLE_GL_STATE_CACHE===0){cc.log("");cc.log(cc._LogInfos.configuration_dumpInfo);cc.log("")}},gatherGPUInfo:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return;if(!this._inited)this._init();var t=cc._renderContext;var e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR);e["gl.renderer"]=t.getParameter(t.RENDERER);e["gl.version"]=t.getParameter(t.VERSION);this._GlExtensions="";var i=t.getSupportedExtensions();for(var n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE);e["gl.max_texture_size"]=this._maxTextureSize;this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);e["gl.max_texture_units"]=this._maxTextureUnits;this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc");e["gl.supports_PVRTC"]=this._supportsPVRTC;this._supportsNPOT=false;e["gl.supports_NPOT"]=this._supportsNPOT;this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888");e["gl.supports_BGRA8888"]=this._supportsBGRA8888;this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer");e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer;this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object");e["gl.supports_vertex_array_object"]=this._supportsShareableVAO;cc.checkGLErrorDebug()},loadConfigFile:function(t){if(!this._inited)this._init();var e=cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);cc.assert(e,cc._LogInfos.configuration_loadConfigFile_2,t);var i=e["data"];if(!i){cc.log(cc._LogInfos.configuration_loadConfigFile,t);return}for(var n in i)this._valueDict[n]=i[n]}};cc.rendererWebGL={childrenOrderDirty:true,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:false,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e=this._renderCmds,i,n;var r=t||cc._renderContext;for(i=0,n=e.length;i<n;i++){e[i].rendering(r)}},_turnToCacheMode:function(t){this._isCacheToBufferOn=true;t=t||0;this._cacheToBufferCmds[t]=[];this._cacheInstanceIds.push(t);this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=false},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i,n;var r=cc._renderContext,s=this._cacheInstanceIds;for(i=0,n=e.length;i<n;i++){e[i].rendering(r)}e.length=0;delete this._cacheToBufferCmds[t];cc.arrayRemoveObject(s,t);if(s.length===0)this._isCacheToBufferOn=false;else this._currentID=s[s.length-1]},resetFlag:function(){this.childrenOrderDirty=false;this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++){t[e].updateStatus()}t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;if(t){e.clearDepth(1);e.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL)}else{e.disable(e.DEPTH_TEST)}},pushRenderCommand:function(t){if(!t._needDraw)return;if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds;var n=i[e];if(n.indexOf(t)===-1)n.push(t)}else{if(this._renderCmds.indexOf(t)===-1)this._renderCmds.push(t)}}};(function(){cc.Node.WebGLRenderCmd=function(t){cc.Node.RenderCmd.call(this,t);var e=new cc.math.Matrix4,i=e.mat;i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[14]=0;i[10]=i[15]=1;this._transform4x4=e;this._stackMatrix=new cc.math.Matrix4;this._shaderProgram=null;this._camera=null};var t=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.WebGLRenderCmd;t._updateColor=function(){};t.visit=function(t){var e=this._node;if(!e._visible)return;t=t||this.getParentRenderCmd();if(e._parent&&e._parent._renderCmd)this._curLevel=e._parent._renderCmd._curLevel+1;var i=cc.current_stack;i.stack.push(i.top);this._syncStatus(t);i.top=this._stackMatrix;this.visitChildren();i.top=i.stack.pop()};t.transform=function(t,e){var i=this._transform4x4,n=this._stackMatrix,r=this._node;t=t||this.getParentRenderCmd();var s=t?t._stackMatrix:cc.current_stack.top;var a=this.getNodeToParentTransform();this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag;var o=i.mat;o[0]=a.a;o[4]=a.c;o[12]=a.tx;o[1]=a.b;o[5]=a.d;o[13]=a.ty;o[14]=r._vertexZ;cc.kmMat4Multiply(n,s,i);if(r._camera!==null&&!(r.grid!==null&&r.grid.isActive())){var c=this._anchorPointInPoints.x,l=this._anchorPointInPoints.y;var h=c!==0||l!==0;if(h){if(!cc.SPRITEBATCHNODE_RENDER_SUBPIXEL){c=0|c;l=0|l}var u=cc.math.Matrix4.createByTranslation(c,l,0,i);n.multiply(u);r._camera._locateForRenderer(n);u=cc.math.Matrix4.createByTranslation(-c,-l,0,u);n.multiply(u);i.identity()}else{r._camera._locateForRenderer(n)}}if(!e||!r._children||r._children.length===0)return;var d,_,f=r._children;for(d=0,_=f.length;d<_;d++){f[d]._renderCmd.transform(this,e)}};t.setShaderProgram=function(t){this._shaderProgram=t};t.getShaderProgram=function(){return this._shaderProgram}})();(function(){cc.Layer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Layer.WebGLRenderCmd;t.bake=function(){};t.unbake=function(){};t._bakeForAddChild=function(){}})();(function(){cc.LayerColor.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t);this._needDraw=true;var e=this;e._squareVerticesAB=new ArrayBuffer(32);e._squareColorsAB=new ArrayBuffer(16);var i=e._squareVerticesAB,n=e._squareColorsAB;var r=cc.Vertex2F.BYTES_PER_ELEMENT,s=cc.Color.BYTES_PER_ELEMENT;e._squareVertices=[new cc.Vertex2F(0,0,i,0),new cc.Vertex2F(0,0,i,r),new cc.Vertex2F(0,0,i,r*2),new cc.Vertex2F(0,0,i,r*3)];e._squareColors=[cc.color(0,0,0,255,n,0),cc.color(0,0,0,255,n,s),cc.color(0,0,0,255,n,s*2),cc.color(0,0,0,255,n,s*3)];e._verticesFloat32Buffer=cc._renderContext.createBuffer();e._colorsUint8Buffer=cc._renderContext.createBuffer()};var t=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.LayerColor.WebGLRenderCmd;t.rendering=function(t){var e=t||cc._renderContext;var i=this._node;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR);cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst);e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer);e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer);e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,true,0,0);e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length)};t._updateSquareVertices=function(t,e){var i=this._squareVertices;if(e===undefined){i[1].x=t.width;i[2].y=t.height;i[3].x=t.width;i[3].y=t.height}else{i[1].x=t;i[2].y=e;i[3].x=t;i[3].y=e}this._bindLayerVerticesBufferData()};t._updateSquareVerticesWidth=function(t){var e=this._squareVertices;e[1].x=t;e[3].x=t;this._bindLayerVerticesBufferData()};t._updateSquareVerticesHeight=function(t){var e=this._squareVertices;e[2].y=t;e[3].y=t;this._bindLayerVerticesBufferData()};t._updateColor=function(){var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors;for(var n=0;n<4;n++){i[n].r=t.r;i[n].g=t.g;i[n].b=t.b;i[n].a=e}this._bindLayerColorsBufferData()};t._bindLayerVerticesBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer);t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.STATIC_DRAW)};t._bindLayerColorsBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer);t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)};t.updateBlendFunc=function(t){}})();(function(){cc.LayerGradient.WebGLRenderCmd=function(t){cc.LayerColor.WebGLRenderCmd.call(this,t);this._needDraw=true;this._clipRect=new cc.Rect;this._clippingRectDirty=false};var t=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,t);t.constructor=cc.LayerGradient.WebGLRenderCmd;t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;var n=t?t._node:null;if(n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty)i|=e.colorDirty;if(n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty)i|=e.opacityDirty;if(t&&t._dirtyFlag&e.transformDirty)i|=e.transformDirty;var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i;if(r)this._syncDisplayColor();if(s)this._syncDisplayOpacity();this.transform(t);if(r||s||i&e.gradientDirty){this._updateColor()}};t._updateColor=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var t=this._node,e=t._colorStops;if(!e||e.length<2)return;this._clippingRectDirty=true;var i=e.length,n=i*2,r,s=t._contentSize;this._squareVerticesAB=new ArrayBuffer(n*8);this._squareColorsAB=new ArrayBuffer(n*4);var a=this._squareVertices,o=this._squareColors;a.length=0;o.length=0;var c=this._squareVerticesAB,l=this._squareColorsAB;var h=cc.Vertex2F.BYTES_PER_ELEMENT,u=cc.Color.BYTES_PER_ELEMENT;for(r=0;r<n;r++){a.push(new cc.Vertex2F(0,0,c,h*r));o.push(cc.color(0,0,0,255,l,u*r))}var d=Math.PI+cc.pAngleSigned(cc.p(0,-1),t._alongVector),_=cc.p(s.width/2,s.height/2);var f=Math.round(cc.radiansToDegrees(d));var p=cc.affineTransformMake(1,0,0,1,_.x,_.y);p=cc.affineTransformRotate(p,d);var m,g;if(f<90){m=cc.p(-_.x,_.y);g=cc.p(_.x,_.y)}else if(f<180){m=cc.p(_.x,_.y);g=cc.p(_.x,-_.y)}else if(f<270){m=cc.p(_.x,-_.y);g=cc.p(-_.x,-_.y)}else{m=cc.p(-_.x,-_.y);g=cc.p(-_.x,_.y)}var v=Math.sin(d),y=Math.cos(d);var T=Math.abs((m.x*y-m.y*v)/_.x),C=Math.abs((g.x*v+g.y*y)/_.y);p=cc.affineTransformScale(p,T,C);for(r=0;r<i;r++){var S=e[r],x=S.p*s.height;var E=cc.pointApplyAffineTransform(-_.x,x-_.y,p);a[r*2].x=E.x;a[r*2].y=E.y;var b=cc.pointApplyAffineTransform(s.width-_.x,x-_.y,p);a[r*2+1].x=b.x;a[r*2+1].y=b.y}var A=this._displayedOpacity/255;for(r=0;r<i;r++){var R=e[r].color,P=o[r*2],w=o[r*2+1];P.r=R.r;P.g=R.g;P.b=R.b;P.a=R.a*A;w.r=R.r;w.g=R.g;w.b=R.b;w.a=R.a*A}this._bindLayerVerticesBufferData();this._bindLayerColorsBufferData()};t.rendering=function(t){var e=t||cc._renderContext,i=this._node;var n=this._getClippingRect();e.enable(e.SCISSOR_TEST);cc.view.setScissorInPoints(n.x,n.y,n.width,n.height);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR);cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst);e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer);e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer);e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,true,0,0);e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length);e.disable(e.SCISSOR_TEST)};t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node;var e=cc.rect(0,0,t._contentSize.width,t._contentSize.height);var i=t.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(e,i)}return this._clipRect}})();(function(){cc.Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._quad=new cc.V3F_C4B_T2F_Quad;this._quadWebBuffer=cc._renderContext.createBuffer();this._quadDirty=true;this._dirty=false;this._recursiveDirty=false};var t=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Sprite.WebGLRenderCmd;t.updateBlendFunc=function(t){};t.setDirtyFlag=function(t){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t);this._dirty=true};t.setDirtyRecursively=function(t){this._recursiveDirty=t;this._dirty=t;var e=this._node._children,i,n=e?e.length:0;for(var r=0;r<n;r++){i=e[r];i instanceof cc.Sprite&&i._renderCmd.setDirtyRecursively(t)}};t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.Sprite_addChild);return false}if(t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj)cc.log(cc._LogInfos.Sprite_addChild_2);e._batchNode.appendChild(t);if(!e._reorderChildDirty)e._setReorderChildDirtyRecursively()}return true};t._handleTextureForRotatedTexture=function(t){return t};t.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)};t._init=function(){var t={r:255,g:255,b:255,a:255},e=this._quad;e.bl.colors=t;e.br.colors=t;e.tl.colors=t;e.tr.colors=t;this._quadDirty=true};t._resetForBatchNode=function(){var t=this._node;var e=t._offsetPosition.x;var i=t._offsetPosition.y;var n=e+t._rect.width;var r=i+t._rect.height;var s=this._quad;s.bl.vertices={x:e,y:i,z:0};s.br.vertices={x:n,y:i,z:0};s.tl.vertices={x:e,y:r,z:0};s.tr.vertices={x:n,y:r,z:0};this._quadDirty=true};t.getQuad=function(){return this._quad};t._updateForSetSpriteFrame=function(){};t._spriteFrameLoadedCallback=function(t){this.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize());this.dispatchEvent("load")};t._textureLoadedCallback=function(t){var e=this._renderCmd;if(this._textureLoaded)return;this._textureLoaded=true;var i=this._rect;if(!i){i=cc.rect(0,0,t.width,t.height)}else if(cc._rectEqualToZero(i)){i.width=t.width;i.height=t.height}this.texture=t;this.setTextureRect(i,this._rectRotated);this.setBatchNode(this._batchNode);e._quadDirty=true;this.dispatchEvent("load")};t._setTextureCoords=function(t,e){if(e===undefined)e=true;if(e)t=cc.rectPointsToPixels(t);var i=this._node;var n=i._batchNode?i.textureAtlas.texture:i._texture;if(!n)return;var r=n.pixelsWidth;var s=n.pixelsHeight;var a,o,c,l,h,u=this._quad;if(i._rectRotated){if(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL){a=(2*t.x+1)/(2*r);o=a+(t.height*2-2)/(2*r);c=(2*t.y+1)/(2*s);l=c+(t.width*2-2)/(2*s)}else{a=t.x/r;o=(t.x+t.height)/r;c=t.y/s;l=(t.y+t.width)/s}if(i._flippedX){h=c;c=l;l=h}if(i._flippedY){h=a;a=o;o=h}u.bl.texCoords.u=a;u.bl.texCoords.v=c;u.br.texCoords.u=a;u.br.texCoords.v=l;u.tl.texCoords.u=o;u.tl.texCoords.v=c;u.tr.texCoords.u=o;u.tr.texCoords.v=l}else{if(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL){a=(2*t.x+1)/(2*r);o=a+(t.width*2-2)/(2*r);c=(2*t.y+1)/(2*s);l=c+(t.height*2-2)/(2*s)}else{a=t.x/r;o=(t.x+t.width)/r;c=t.y/s;l=(t.y+t.height)/s}if(i._flippedX){h=a;a=o;o=h}if(i._flippedY){h=c;c=l;l=h}u.bl.texCoords.u=a;u.bl.texCoords.v=l;u.br.texCoords.u=o;u.br.texCoords.v=l;u.tl.texCoords.u=a;u.tl.texCoords.v=c;u.tr.texCoords.u=o;u.tr.texCoords.v=c}this._quadDirty=true};t.transform=function(t,e){cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e);this._dirty=true};t._setColorDirty=function(){};t._updateColor=function(){var t=this._displayedColor,e=this._displayedOpacity,i=this._node;var n={r:t.r,g:t.g,b:t.b,a:e};if(i._opacityModifyRGB){n.r*=e/255;n.g*=e/255;n.b*=e/255}var r=this._quad;r.bl.colors=n;r.br.colors=n;r.tl.colors=n;r.tr.colors=n;if(i._batchNode){if(i.atlasIndex!==cc.Sprite.INDEX_NOT_INITIALIZED){i.textureAtlas.updateQuad(r,i.atlasIndex)}else{this._dirty=true}}this._quadDirty=true};t._updateBlendFunc=function(){if(this._batchNode){cc.log(cc._LogInfos.Sprite__updateBlendFunc);return}var t=this._node,e=t._blendFunc;if(!t._texture||!t._texture.hasPremultipliedAlpha()){if(e.src===cc.ONE&&e.dst===cc.BLEND_DST){e.src=cc.SRC_ALPHA}t.opacityModifyRGB=false}else{if(e.src===cc.SRC_ALPHA&&e.dst===cc.BLEND_DST){e.src=cc.ONE}t.opacityModifyRGB=true}};t._setTexture=function(t){var e=this._node;if(e._batchNode){if(e._batchNode.texture!==t){cc.log(cc._LogInfos.Sprite_setTexture);return}}else{if(e._texture!==t){e._textureLoaded=t?t._textureLoaded:false;e._texture=t;this._updateBlendFunc()}}if(t)this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);else this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};t.updateTransform=function(){var t=this,e=this._node;if(this._dirty){var i=t._quad,n=e._parent;if(!e._visible||n&&n!==e._batchNode&&n._shouldBeHidden){i.br.vertices=i.tl.vertices=i.tr.vertices=i.bl.vertices={x:0,y:0,z:0};e._shouldBeHidden=true}else{e._shouldBeHidden=false;if(this._dirtyFlag!==0){this.updateStatus();this._dirtyFlag=0}if(!n||n===e._batchNode){e._transformToBatch=t.getNodeToParentTransform()}else{e._transformToBatch=cc.affineTransformConcat(t.getNodeToParentTransform(),n._transformToBatch)}var r=e._transformToBatch;var s=e._rect;var a=e._offsetPosition.x;var o=e._offsetPosition.y;var c=a+s.width;var l=o+s.height;var h=r.tx;var u=r.ty;var d=r.a;var _=r.b;var f=r.d;var p=-r.c;var m=a*d-o*p+h;var g=a*_+o*f+u;var v=c*d-o*p+h;var y=c*_+o*f+u;var T=c*d-l*p+h;var C=c*_+l*f+u;var S=a*d-l*p+h;var x=a*_+l*f+u;var E=e._vertexZ;if(!cc.SPRITEBATCHNODE_RENDER_SUBPIXEL){m=0|m;g=0|g;v=0|v;y=0|y;T=0|T;C=0|C;S=0|S;x=0|x}i.bl.vertices={x:m,y:g,z:E};i.br.vertices={x:v,y:y,z:E};i.tl.vertices={x:S,y:x,z:E};i.tr.vertices={x:T,y:C,z:E}}e.textureAtlas.updateQuad(i,e.atlasIndex);e._recursiveDirty=false;this._dirty=false}if(e._hasChildren)e._arrayMakeObjectsPerformSelector(e._children,cc.Node._stateCallbackType.updateTransform)};t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n,r;if(i){n=e.x+e.height;r=e.y+e.width}else{n=e.x+e.width;r=e.y+e.height}if(n>t.width){cc.error(cc._LogInfos.RectWidth,t.url)}if(r>t.height){cc.error(cc._LogInfos.RectHeight,t.url)}}};t.rendering=function(t){var e=this._node,i=e._texture;if(i&&!i._textureLoaded||this._displayedOpacity===0)return;var n=t||cc._renderContext;if(i){if(i._textureLoaded){this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);cc.glBindTexture2DN(0,i);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);n.bindBuffer(n.ARRAY_BUFFER,this._quadWebBuffer);if(this._quadDirty){n.bufferData(n.ARRAY_BUFFER,this._quad.arrayBuffer,n.DYNAMIC_DRAW);this._quadDirty=false}n.vertexAttribPointer(0,3,n.FLOAT,false,24,0);n.vertexAttribPointer(1,4,n.UNSIGNED_BYTE,true,24,12);n.vertexAttribPointer(2,2,n.FLOAT,false,24,16);n.drawArrays(n.TRIANGLE_STRIP,0,4)}}else{this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);cc.glBindTexture2D(null);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR);n.bindBuffer(n.ARRAY_BUFFER,this._quadWebBuffer);if(this._quadDirty){n.bufferData(n.ARRAY_BUFFER,this._quad.arrayBuffer,n.STATIC_DRAW);this._quadDirty=false}n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,false,24,0);n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,true,24,12);n.drawArrays(n.TRIANGLE_STRIP,0,4)}cc.g_NumberOfDraws++;if(cc.SPRITE_DEBUG_DRAW===0&&!e._showNode)return;cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.current_stack.stack.push(cc.current_stack.top);cc.current_stack.top=this._stackMatrix;if(cc.SPRITE_DEBUG_DRAW===1||e._showNode){var r=this._quad;var s=[cc.p(r.tl.vertices.x,r.tl.vertices.y),cc.p(r.bl.vertices.x,r.bl.vertices.y),cc.p(r.br.vertices.x,r.br.vertices.y),cc.p(r.tr.vertices.x,r.tr.vertices.y)];cc._drawingUtil.drawPoly(s,4,true)}else if(cc.SPRITE_DEBUG_DRAW===2){var a=e.getTextureRect();var o=e.getOffsetPosition();var c=[cc.p(o.x,o.y),cc.p(o.x+a.width,o.y),cc.p(o.x+a.width,o.y+a.height),cc.p(o.x,o.y+a.height)];cc._drawingUtil.drawPoly(c,4,true)}cc.current_stack.top=cc.current_stack.stack.pop()}})();(function(){cc.LabelTTF.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t);cc.LabelTTF.CacheRenderCmd.call(this);this.setShaderProgram(cc.shaderCache.programForKey(cc.LabelTTF._SHADER_PROGRAM))};var t=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t);t.constructor=cc.LabelTTF.WebGLRenderCmd;t._updateColor=function(){this._updateTexture();cc.Sprite.WebGLRenderCmd.prototype._updateColor.call(this)}})();cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:false,_shader:null,_colorLocation:-1,_colorArray:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(t){if(t==null)t=cc._renderContext;if(!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t;this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;if(!t._initialized){t._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR);t._colorLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_color");t._pointSizeLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_pointSize");t._initialized=true}},drawInit:function(){this._initialized=false},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);e.uniform4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW);e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,false,0,0);e.drawArrays(e.POINTS,0,1);e.deleteBuffer(i);cc.incrementGLDraws(1)},drawPoints:function(t,e){if(!t||t.length===0)return;this.lazy_init();var i=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);i.uniform4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n);i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,false,0,0);i.drawArrays(i.POINTS,0,t.length);i.deleteBuffer(n);cc.incrementGLDraws(1)},_pointsToTypeArray:function(t){var e=new Float32Array(t.length*2);for(var i=0;i<t.length;i++){e[i*2]=t[i].x;e[i*2+1]=t[i].y}return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);i.uniform4fv(this._colorLocation,this._colorArray);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n);i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,false,0,0);i.drawArrays(i.LINES,0,2);i.deleteBuffer(n);cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y));this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y));this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y));this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i){this.lazy_init();var n=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);n.uniform4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r);n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW);n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,false,0,0);if(i)n.drawArrays(n.LINE_LOOP,0,t.length);else n.drawArrays(n.LINE_STRIP,0,t.length);n.deleteBuffer(r);cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init();if(i)this.setDrawColor(i.r,i.g,i.b,i.a);var n=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);n.uniform4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r);n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW);n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,false,0,0);n.drawArrays(n.TRIANGLE_FAN,0,t.length);n.deleteBuffer(r);cc.incrementGLDraws(1)},drawCircle:function(t,e,i,n,r){this.lazy_init();var s=1;if(r)s++;var a=2*Math.PI/n;var o=new Float32Array((n+2)*2);if(!o)return;for(var c=0;c<=n;c++){var l=c*a;var h=e*Math.cos(l+i)+t.x;var u=e*Math.sin(l+i)+t.y;o[c*2]=h;o[c*2+1]=u}o[(n+1)*2]=t.x;o[(n+1)*2+1]=t.y;var d=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);d.uniform4fv(this._colorLocation,this._colorArray);var _=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,_);d.bufferData(d.ARRAY_BUFFER,o,d.STATIC_DRAW);d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,false,0,0);d.drawArrays(d.LINE_STRIP,0,n+s);d.deleteBuffer(_);cc.incrementGLDraws(1)},drawQuadBezier:function(t,e,i,n){this.lazy_init();var r=new Float32Array((n+1)*2);var s=0;for(var a=0;a<n;a++){r[a*2]=Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x;r[a*2+1]=Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y;s+=1/n}r[n*2]=i.x;r[n*2+1]=i.y;var o=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);o.uniform4fv(this._colorLocation,this._colorArray);var c=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,c);o.bufferData(o.ARRAY_BUFFER,r,o.STATIC_DRAW);o.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,o.FLOAT,false,0,0);o.drawArrays(o.LINE_STRIP,0,n+1);o.deleteBuffer(c);cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,n,r){this.lazy_init();var s=new Float32Array((r+1)*2);var a=0;for(var o=0;o<r;o++){s[o*2]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x;s[o*2+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;a+=1/r}s[r*2]=n.x;s[r*2+1]=n.y;var c=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);c.uniform4fv(this._colorLocation,this._colorArray);var l=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,l);c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW);c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,false,0,0);
c.drawArrays(c.LINE_STRIP,0,r+1);c.deleteBuffer(l);cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();var n=new Float32Array((i+1)*2);var r,s,a=1/t.length;for(var o=0;o<i+1;o++){var c=o/i;if(c===1){r=t.length-1;s=1}else{r=0|c/a;s=(c-a*r)/a}var l=cc.cardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,s);n[o*2]=l.x;n[o*2+1]=l.y}var h=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);h.uniform4fv(this._colorLocation,this._colorArray);var u=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,u);h.bufferData(h.ARRAY_BUFFER,n,h.STATIC_DRAW);h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,false,0,0);h.drawArrays(h.LINE_STRIP,0,i+1);h.deleteBuffer(u);cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255;this._colorArray[1]=e/255;this._colorArray[2]=i/255;this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*cc.contentScaleFactor()},setLineWidth:function(t){if(this._renderContext.lineWidth)this._renderContext.lineWidth(t)}});var _p=cc.inputManager;_p.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled===t)return;e._accelEnabled=t;var i=cc.director.getScheduler();if(e._accelEnabled){e._accelCurTime=0;i.scheduleUpdate(e)}else{e._accelCurTime=0;i.scheduleUpdate(e)}};_p.setAccelerometerInterval=function(t){if(this._accelInterval!==t){this._accelInterval=t}};_p._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,true));t.stopPropagation();t.preventDefault()},false);cc._canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,false));t.stopPropagation();t.preventDefault()},false)};_p._registerAccelerometerEvent=function(){var t=window,e=this;e._acceleration=new cc.Acceleration;e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent;if(cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ)e._accelDeviceEvent=window.DeviceOrientationEvent;var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";var n=navigator.userAgent;if(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC){e._minus=-1}t.addEventListener(i,e.didAccelerate.bind(e),false)};_p.didAccelerate=function(t){var e=this,i=window;if(!e._accelEnabled)return;var n=e._acceleration;var r,s,a;if(e._accelDeviceEvent===window.DeviceMotionEvent){var o=t["accelerationIncludingGravity"];r=e._accelMinus*o.x*.1;s=e._accelMinus*o.y*.1;a=o.z*.1}else{r=t["gamma"]/90*.981;s=-(t["beta"]/90)*.981;a=t["alpha"]/90*.981}if(cc.sys.os===cc.sys.OS_ANDROID){n.x=-r;n.y=-s}else{n.x=r;n.y=s}n.z=a;n.timestamp=t.timeStamp||Date.now();var c=n.x;if(i.orientation===cc.UIInterfaceOrientationLandscapeRight){n.x=-n.y;n.y=c}else if(i.orientation===cc.UIInterfaceOrientationLandscapeLeft){n.x=n.y;n.y=-c}else if(i.orientation===cc.UIInterfaceOrientationPortraitUpsideDown){n.x=-n.x;n.y=-n.y}};delete _p;cc.vertexLineToPolygon=function(t,e,i,n,r){r+=n;if(r<=1)return;e*=.5;var s;var a=r-1;for(var o=n;o<r;o++){s=o*2;var c=cc.p(t[o*2],t[o*2+1]);var l;if(o===0)l=cc.pPerp(cc.pNormalize(cc.pSub(c,cc.p(t[(o+1)*2],t[(o+1)*2+1]))));else if(o===a)l=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[(o-1)*2],t[(o-1)*2+1]),c)));else{var h=cc.p(t[(o-1)*2],t[(o-1)*2+1]);var u=cc.p(t[(o+1)*2],t[(o+1)*2+1]);var d=cc.pNormalize(cc.pSub(u,c));var _=cc.pNormalize(cc.pSub(h,c));var f=Math.acos(cc.pDot(d,_));if(f<cc.degreesToRadians(70))l=cc.pPerp(cc.pNormalize(cc.pMidpoint(d,_)));else if(f<cc.degreesToRadians(170))l=cc.pNormalize(cc.pMidpoint(d,_));else l=cc.pPerp(cc.pNormalize(cc.pSub(u,h)))}l=cc.pMult(l,e);i[s*2]=c.x+l.x;i[s*2+1]=c.y+l.y;i[(s+1)*2]=c.x-l.x;i[(s+1)*2+1]=c.y-l.y}n=n===0?0:n-1;for(o=n;o<a;o++){s=o*2;var p=s+2;var m=cc.vertex2(i[s*2],i[s*2+1]);var g=cc.vertex2(i[(s+1)*2],i[(s+1)*2+1]);var v=cc.vertex2(i[p*2],i[p*2]);var y=cc.vertex2(i[(p+1)*2],i[(p+1)*2+1]);var T=!cc.vertexLineIntersect(m.x,m.y,y.x,y.y,g.x,g.y,v.x,v.y);if(!T.isSuccess)if(T.value<0||T.value>1)T.isSuccess=true;if(T.isSuccess){i[p*2]=y.x;i[p*2+1]=y.y;i[(p+1)*2]=v.x;i[(p+1)*2+1]=v.y}}};cc.vertexLineIntersect=function(t,e,i,n,r,s,a,o){var c,l,h,u;if(t===i&&e===n||r===a&&s===o)return{isSuccess:false,value:0};i-=t;n-=e;r-=t;s-=e;a-=t;o-=e;c=Math.sqrt(i*i+n*n);l=i/c;h=n/c;u=r*l+s*h;s=s*l-r*h;r=u;u=a*l+o*h;o=o*l-a*h;a=u;if(s===o)return{isSuccess:false,value:0};var d=(a+(r-a)*o/(o-s))/c;return{isSuccess:true,value:d}};cc.vertexListIsClockwise=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];var r=t[(e+1)%i];var s=t[(e+2)%i];if(cc.pCross(cc.pSub(r,n),cc.pSub(s,r))>0)return false}return true};cc.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0;e[10]=e[15]=1;e[0]=t.a;e[4]=t.c;e[12]=t.tx;e[1]=t.b;e[5]=t.d;e[13]=t.ty};cc.GLToCGAffine=function(t,e){e.a=t[0];e.c=t[4];e.tx=t[12];e.b=t[1];e.d=t[5];e.ty=t[13]};cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION);this._acc=t}});cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:false,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD);this._keyCode=t;this._isPressed=e}});cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this;var i=function(t){e._onAccelerationEvent(t._acc,t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable);return true},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}});cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";cc._EventListenerAcceleration.create=function(t){return new cc._EventListenerAcceleration(t)};cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this;var e=function(e){if(e._isPressed){if(t.onKeyPressed)t.onKeyPressed(e._keyCode,e)}else{if(t.onKeyReleased)t.onKeyReleased(e._keyCode,e)}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerKeyboard;t.onKeyPressed=this.onKeyPressed;t.onKeyReleased=this.onKeyReleased;return t},checkAvailable:function(){if(this.onKeyPressed===null&&this.onKeyReleased===null){cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable);return false}return true}});cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:false,_blendFunc:null,_ignoreContentScaleFactor:false,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._ignoreContentScaleFactor=false;n!==undefined&&this.initWithTileFile(t,e,i,n)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)this._renderCmd=new cc.AtlasNode.CanvasRenderCmd(this);else this._renderCmd=new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){if(this._opacityModifyRGB)return this._renderCmd._colorUnmodified;return cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t;this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(e===undefined)this._blendFunc=t;else this._blendFunc={src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,i,n){if(!t)throw new Error("cc.AtlasNode.initWithTileFile(): title should not be null");var r=cc.textureCache.addImage(t);return this.initWithTexture(r,e,i,n)},initWithTexture:function(t,e,i,n){return this._renderCmd.initWithTexture(t,e,i,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)},getTexture:function(){return this._texture},setTexture:function(t){this._texture=t},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}});var _p=cc.AtlasNode.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);_p.texture;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);_p.textureAtlas;_p.quadsToDraw;cc.EventHelper.prototype.apply(_p);cc.AtlasNode.create=function(t,e,i,n){return new cc.AtlasNode(t,e,i,n)};(function(){cc.AtlasNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=false;this._colorUnmodified=cc.color.WHITE;this._textureToRender=null};var t=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.AtlasNode.CanvasRenderCmd;t.initWithTexture=function(t,e,i,n){var r=this._node;r._itemWidth=e;r._itemHeight=i;r._opacityModifyRGB=true;r._texture=t;if(!r._texture){cc.log(cc._LogInfos.AtlasNode__initWithTexture);return false}this._textureToRender=t;this._calculateMaxItems();r.quadsToDraw=n;return true};t.setColor=function(t){var e=this._node;var i=e._realColor;if(i.r===t.r&&i.g===t.g&&i.b===t.b)return;this._colorUnmodified=t;this._changeTextureColor()};t._changeTextureColor=function(){var t=this._node;var e=t._texture,i=this._colorUnmodified,n=e.getHtmlElementObj();var r=cc.rect(0,0,n.width,n.height);if(e===this._textureToRender)this._textureToRender=e._generateColorTexture(i.r,i.g,i.b,r);else e._generateColorTexture(i.r,i.g,i.b,r,this._textureToRender.getHtmlElementObj())};t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t)};t._calculateMaxItems=function(){var t=this._node;var e=t._texture;var i=e.getContentSize();t._itemsPerColumn=0|i.height/t._itemHeight;t._itemsPerRow=0|i.width/t._itemWidth}})();cc.TextureAtlas=cc.Class.extend({dirty:false,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[];if(cc.isString(t)){this.initWithFile(t,e)}else if(t instanceof cc.Texture2D){this.initWithTexture(t,e)}},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(!t)return;for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;if(!i[e]){i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);return}i[e].bl=t.bl;i[e].br=t.br;i[e].tl=t.tl;i[e].tr=t.tr},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(this._capacity===0)return;var t=this._indices,e=this._capacity;for(var i=0;i<e;i++){if(cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP){t[i*6+0]=i*4+0;t[i*6+1]=i*4+0;t[i*6+2]=i*4+2;t[i*6+3]=i*4+1;t[i*6+4]=i*4+3;t[i*6+5]=i*4+3}else{t[i*6+0]=i*4+0;t[i*6+1]=i*4+1;t[i*6+2]=i*4+2;t[i*6+3]=i*4+3;t[i*6+4]=i*4+2;t[i*6+5]=i*4+1}}},_setupVBO:function(){var t=cc._renderContext;this._buffersVBO[0]=t.createBuffer();this._buffersVBO[1]=t.createBuffer();this._quadsWebBuffer=t.createBuffer();this._mapBuffers()},_mapBuffers:function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer);t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);if(i)return this.initWithTexture(i,e);else{cc.log(cc._LogInfos.TextureAtlas_initWithFile,t);return false}},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_initWithTexture);e=0|e;this._capacity=e;this._totalQuads=0;this.texture=t;this._quads=[];this._indices=new Uint16Array(e*6);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(i*e);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if(!(this._quads&&this._indices)&&e>0)return false;var n=this._quads;for(var r=0;r<e;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);this._setupIndices();this._setupVBO();this.dirty=true;return true},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas_updateQuad);cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2);this._totalQuads=Math.max(e+1,this._totalQuads);this._setQuadToArray(t,e);this.dirty=true},insertQuad:function(t,e){cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2);this._totalQuads++;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad);return}var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var n=this._totalQuads-1-e;var r=e*i;var s=n*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i);this._quadsReader.set(this._quadsReader.subarray(r,r+s),r+i);this._setQuadToArray(t,e);this.dirty=true},insertQuads:function(t,e,i){i=i||t.length;cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=i;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad);return}var r=this._totalQuads-1-e-i;var s=e*n;var a=r*n;var o=this._totalQuads-1-i;var c;for(c=0;c<i;c++)this._quads[o+c]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);this._quadsReader.set(this._quadsReader.subarray(s,s+a),s+n*i);for(c=0;c<i;c++)this._setQuadToArray(t[c],e+c);this.dirty=true},insertQuadFromIndex:function(t,e){if(t===e)return;cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex);cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var n=this._quadsReader;var r=n.subarray(t*i,i);var s,a;if(t>e){s=e*i;a=(t-e)*i;n.set(n.subarray(s,s+a),s+i);n.set(r,s)}else{s=(t+1)*i;a=(e-t)*i;n.set(n.subarray(s,s+a),s-i);n.set(r,e*i)}this.dirty=true},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--;this._quads.length=this._totalQuads;if(t!==this._totalQuads){var i=(t+1)*e;var n=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+n),i-e)}this.dirty=true},removeQuadsAtIndex:function(t,e){cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex);this._totalQuads-=e;if(t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var n=(t+e)*i;var r=(this._totalQuads-t)*i;var s=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+r),s)}this.dirty=true},removeAllQuads:function(){this._quads.length=0;this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return true;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t);this._capacity=0|t;var n,r=this._capacity,s=this._totalQuads;if(this._quads===null){this._quads=[];this._quadsArrayBuffer=new ArrayBuffer(e*r);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);for(n=0;n<r;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e)}else{var a,o,c=this._quads;if(r>i){a=[];o=new ArrayBuffer(e*r);for(n=0;n<s;n++){a[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,o,n*e)}for(;n<r;n++)a[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,o,n*e);this._quadsReader=new Uint8Array(o);this._quads=a;this._quadsArrayBuffer=o}else{var l=Math.max(s,r);a=[];o=new ArrayBuffer(e*r);for(n=0;n<l;n++){a[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,o,n*e)}this._quadsReader=new Uint8Array(o);this._quads=a;this._quadsArrayBuffer=o}}if(this._indices===null){this._indices=new Uint16Array(r*6)}else{if(r>i){var h=new Uint16Array(r*6);h.set(this._indices,0);this._indices=h}else{this._indices=this._indices.subarray(0,r*6)}}this._setupIndices();this._mapBuffers();this.dirty=true;return true},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(i===undefined){i=e;e=this._totalQuads-t;cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex);if(e===0)return}else{cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2);cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3);if(t===i)return}var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var r=t*n;var s=e*n;var a=this._quadsReader;var o=a.subarray(r,r+s);var c=i*n;var l,h;if(i<t){l=(t-i)*n;h=i*n;a.set(a.subarray(h,h+l),h+s)}else{l=(i-t)*n;h=(t+e)*n;a.set(a.subarray(h,h+l),r)}a.set(o,c);this.dirty=true},fillWithEmptyQuadsFromIndex:function(t,e){var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i);for(var r=0;r<i;r++)n[r]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var t=cc._renderContext;if(this._buffersVBO){if(this._buffersVBO[0])t.deleteBuffer(this._buffersVBO[0]);if(this._buffersVBO[1])t.deleteBuffer(this._buffersVBO[1])}if(this._quadsWebBuffer)t.deleteBuffer(this._quadsWebBuffer)}});var _p=cc.TextureAtlas.prototype;_p.totalQuads;cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);_p.capacity;cc.defineGetterSetter(_p,"capacity",_p.getCapacity);_p.quads;cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);cc.TextureAtlas.create=function(t,e){return new cc.TextureAtlas(t,e)};cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js");cc._tmp.WebGLTextureAtlas();delete cc._tmp.WebGLTextureAtlas}});cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTextureAtlas();delete cc._tmp.PrototypeTextureAtlas;cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:false,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new cc.math.Matrix4;this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(t){this._dirty=t},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0;this._eyeZ=cc.Camera.getZEye();this._centerX=this._centerY=this._centerZ=0;this._upX=0;this._upY=1;this._upZ=0;this._lookupMatrix.identity();this._dirty=false},locate:function(){if(this._dirty){var t=new cc.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),e=new cc.math.Vec3(this._centerX,this._centerY,this._centerZ),i=new cc.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(t,e,i);this._dirty=false}cc.kmGLMultMatrix(this._lookupMatrix)},_locateForRenderer:function(t){if(this._dirty){var e=new cc.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),i=new cc.math.Vec3(this._centerX,this._centerY,this._centerZ),n=new cc.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(e,i,n);this._dirty=false}t.multiply(this._lookupMatrix)},setEyeXYZ:function(t,e,i){this.setEye(t,e,i)},setEye:function(t,e,i){this._eyeX=t;this._eyeY=e;this._eyeZ=i;this._dirty=true},setCenterXYZ:function(t,e,i){this.setCenter(t,e,i)},setCenter:function(t,e,i){this._centerX=t;this._centerY=e;this._centerZ=i;this._dirty=true},setUpXYZ:function(t,e,i){this.setUp(t,e,i)},setUp:function(t,e,i){this._upX=t;this._upY=e;this._upZ=i;this._dirty=true},getEyeXYZ:function(t,e,i){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(t,e,i){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(t,e,i){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(t){}});cc.Camera.getZEye=function(){return cc.FLT_EPSILON};cc.PI2=Math.PI*2;cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){if(!e){e=1}var i=cc.view.getScaleX(),n=cc.view.getScaleY();var r=cc.p(t.x*i,t.y*n);var s=this._renderContext.getContext();s.beginPath();s.arc(r.x,-r.y,e*i,0,Math.PI*2,false);s.closePath();s.fill()},drawPoints:function(t,e,i){if(t==null)return;if(!i){i=1}var n=this._renderContext.getContext(),r=cc.view.getScaleX(),s=cc.view.getScaleY();n.beginPath();for(var a=0,o=t.length;a<o;a++)n.arc(t[a].x*r,-t[a].y*s,i*r,0,Math.PI*2,false);n.closePath();n.fill()},drawLine:function(t,e){var i=this._renderContext.getContext(),n=cc.view.getScaleX(),r=cc.view.getScaleY();i.beginPath();i.moveTo(t.x*n,-t.y*r);i.lineTo(e.x*n,-e.y*r);i.closePath();i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y));this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y));this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y));this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i,n){n=n||false;if(t==null)return;if(t.length<3)throw new Error("Polygon's point must greater than 2");var r=t[0],s=this._renderContext.getContext();var a=cc.view.getScaleX(),o=cc.view.getScaleY();s.beginPath();s.moveTo(r.x*a,-r.y*o);for(var c=1,l=t.length;c<l;c++)s.lineTo(t[c].x*a,-t[c].y*o);if(i)s.closePath();if(n)s.fill();else s.stroke()},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a);this.drawPoly(t,e,true,true)},drawCircle:function(t,e,i,n,r){r=r||false;var s=this._renderContext.getContext();var a=cc.view.getScaleX(),o=cc.view.getScaleY();s.beginPath();var c=i-Math.PI*2;s.arc(0|t.x*a,0|-(t.y*o),e*a,-i,-c,false);if(r){s.lineTo(0|t.x*a,0|-(t.y*o))}s.stroke()},drawQuadBezier:function(t,e,i,n){var r=this._cacheArray;r.length=0;var s=0;for(var a=0;a<n;a++){var o=Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x;var c=Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y;r.push(cc.p(o,c));s+=1/n}r.push(cc.p(i.x,i.y));this.drawPoly(r,n+1,false,false)},drawCubicBezier:function(t,e,i,n,r){var s=this._cacheArray;s.length=0;var a=0;for(var o=0;o<r;o++){var c=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*n.x;var l=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*n.y;s.push(cc.p(c,l));a+=1/r}s.push(cc.p(n.x,n.y));this.drawPoly(s,r+1,false,false)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;var r,s;var a=1/t.length;for(var o=0;o<i+1;o++){var c=o/i;if(c===1){r=t.length-1;s=1}else{r=0|c/a;s=(c-a*r)/a}var l=cc.CardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,s);n.push(l)}this.drawPoly(n,i+1,false,false)},drawImage:function(t,e,i,n,r){var s=arguments.length;var a=this._renderContext.getContext();switch(s){case 2:var o=t.height;a.drawImage(t,e.x,-(e.y+o));break;case 3:a.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:a.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil");break}},drawStar:function(t,e,i){var n=t||this._renderContext;var r=n.getContext();e*=cc.view.getScaleX();var s="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);n.setFillStyle(s+",1)");var a=e/10;r.beginPath();r.moveTo(-e,e);r.lineTo(0,a);r.lineTo(e,e);r.lineTo(a,0);r.lineTo(e,-e);r.lineTo(0,-a);r.lineTo(-e,-e);r.lineTo(-a,0);r.lineTo(-e,e);r.closePath();r.fill();var o=r.createRadialGradient(0,0,a,0,0,e);o.addColorStop(0,s+", 1)");o.addColorStop(.3,s+", 0.8)");o.addColorStop(1,s+", 0.0)");n.setFillStyle(o);r.beginPath();var c=0;var l=cc.PI2;r.arc(0,0,e-a,c,l,false);r.closePath();r.fill()},drawColorBall:function(t,e,i){var n=t||this._renderContext;var r=n.getContext();e*=cc.view.getScaleX();var s="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);var a=e/10;var o=r.createRadialGradient(0,0,a,0,0,e);o.addColorStop(0,s+", 1)");o.addColorStop(.3,s+", 0.8)");o.addColorStop(.6,s+", 0.4)");o.addColorStop(1,s+", 0.0)");n.setFillStyle(o);r.beginPath();var c=0;var l=cc.PI2;r.arc(0,0,e,c,l,false);r.closePath();r.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")");this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}});(function(){cc.AtlasNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._textureAtlas=null;this._colorUnmodified=cc.color.WHITE;this._colorF32Array=null;this._uniformColor=null;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.AtlasNode.WebGLRenderCmd;t._updateBlendFunc=function(){var t=this._node;if(!this._textureAtlas.texture.hasPremultipliedAlpha()){t._blendFunc.src=cc.SRC_ALPHA;t._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA}};t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()};t.rendering=function(t){var e=t||cc._renderContext,i=this._node;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst);if(this._uniformColor&&this._colorF32Array){e.uniform4fv(this._uniformColor,this._colorF32Array);this._textureAtlas.drawNumberOfQuads(i.quadsToDraw,0)}};t.initWithTexture=function(t,e,i,n){var r=this._node;r._itemWidth=e;r._itemHeight=i;this._colorUnmodified=cc.color.WHITE;r._opacityModifyRGB=true;r._blendFunc.src=cc.BLEND_SRC;r._blendFunc.dst=cc.BLEND_DST;var s=r._realColor;this._colorF32Array=new Float32Array([s.r/255,s.g/255,s.b/255,r._realOpacity/255]);this._textureAtlas=new cc.TextureAtlas;this._textureAtlas.initWithTexture(t,n);if(!this._textureAtlas){cc.log(cc._LogInfos.AtlasNode__initWithTexture);return false}this._updateBlendFunc();this._updateOpacityModifyRGB();this._calculateMaxItems();r.quadsToDraw=n;return true};t.setColor=function(t){var e=cc.color(t.r,t.g,t.b),i=this._node;this._colorUnmodified=t;var n=this._displayedOpacity;if(i._opacityModifyRGB){e.r=e.r*n/255;e.g=e.g*n/255;e.b=e.b*n/255}cc.Node.prototype.setColor.call(i,e)};t.setOpacity=function(t){var e=this._node;cc.Node.prototype.setOpacity.call(e,t);if(e._opacityModifyRGB){e.color=this._colorUnmodified}};t._updateColor=function(){var t=this._displayedColor;this._colorF32Array=new Float32Array([t.r/255,t.g/255,t.b/255,this._displayedOpacity/255])};t.getTexture=function(){return this._textureAtlas.texture};t.setTexture=function(t){this._textureAtlas.texture=t;this._updateBlendFunc();this._updateOpacityModifyRGB()};t._calculateMaxItems=function(){var t=this._node;var e=this._textureAtlas.texture;var i=e.getContentSize();if(t._ignoreContentScaleFactor)i=e.getContentSizeInPixels();t._itemsPerColumn=0|i.height/t._itemHeight;t._itemsPerRow=0|i.width/t._itemWidth}})();cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX != RotationY. Don't know which one to return",Node_getScale:"ScaleX != ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",
_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."};cc._logToWebPage=function(t){if(!cc._canvas)return;var e=cc._logList;var i=document;if(!e){var n=i.createElement("Div");var r=n.style;n.setAttribute("id","logInfoDiv");cc._canvas.parentNode.appendChild(n);n.setAttribute("width","200");n.setAttribute("height",cc._canvas.height);r.zIndex="99999";r.position="absolute";r.top="0";r.left="0";e=cc._logList=i.createElement("textarea");var s=e.style;e.setAttribute("rows","20");e.setAttribute("cols","30");e.setAttribute("disabled",true);n.appendChild(e);s.backgroundColor="transparent";s.borderBottom="1px solid #cccccc";s.borderRightWidth="0px";s.borderLeftWidth="0px";s.borderTopWidth="0px";s.borderTopStyle="none";s.borderRightStyle="none";s.borderLeftStyle="none";s.padding="0px";s.margin=0}e.value=e.value+t+"\r\n";e.scrollTop=e.scrollHeight};cc._formatString=function(t){if(cc.isObject(t)){try{return JSON.stringify(t)}catch(e){return""}}else return t};cc._initDebugSetting=function(t){var e=cc.game;if(t===e.DEBUG_MODE_NONE)return;var i;if(t>e.DEBUG_MODE_ERROR){i=cc._logToWebPage.bind(cc);cc.error=function(){i("ERROR :  "+cc.formatStr.apply(cc,arguments))};cc.assert=function(t,e){if(!t&&e){for(var n=2;n<arguments.length;n++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[n]));i("Assert: "+e)}};if(t!==e.DEBUG_MODE_ERROR_FOR_WEB_PAGE){cc.warn=function(){i("WARN :  "+cc.formatStr.apply(cc,arguments))}}if(t===e.DEBUG_MODE_INFO_FOR_WEB_PAGE){cc.log=function(){i(cc.formatStr.apply(cc,arguments))}}}else if(console&&console.log.apply){cc.error=function(){return console.error.apply(console,arguments)};cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));throw new Error(e)}};if(t!==e.DEBUG_MODE_ERROR)cc.warn=function(){return console.warn.apply(console,arguments)};if(t===e.DEBUG_MODE_INFO)cc.log=function(){return console.log.apply(console,arguments)}}};cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:false,paused:false,hh:null,ctor:function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.currentActionSalvaged=false;this.paused=false;this.hh=null}});cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:false,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++){if(e===t[i].target)return t[i]}return null},ctor:function(){this._hashTargets={};this._arrayTargets=[];this._currentTarget=null;this._currentTargetSalvaged=false},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[e.__instanceId];if(!n){n=new cc.HashElement;n.paused=i;n.target=e;this._hashTargets[e.__instanceId]=n;this._arrayTargets.push(n)}this._actionAllocWithHashElement(n);n.actions.push(t);t.startWithTarget(e)},removeAllActions:function(){var t=this._arrayTargets;for(var e=0;e<t.length;e++){var i=t[e];if(i)this.removeAllActionsFromTarget(i.target,true)}},removeAllActionsFromTarget:function(t,e){if(t==null)return;var i=this._hashTargets[t.__instanceId];if(i){if(i.actions.indexOf(i.currentAction)!==-1&&!i.currentActionSalvaged)i.currentActionSalvaged=true;i.actions.length=0;if(this._currentTarget===i&&!e){this._currentTargetSalvaged=true}else{this._deleteHashElement(i)}}},removeAction:function(t){if(t==null)return;var e=t.getOriginalTarget();var i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++){if(i.actions[n]===t){i.actions.splice(n,1);break}}}else{cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){if(t===cc.ACTION_TAG_INVALID)cc.log(cc._LogInfos.ActionManager_addAction);cc.assert(e,cc._LogInfos.ActionManager_addAction);var i=this._hashTargets[e.__instanceId];if(i){var n=i.actions.length;for(var r=0;r<n;++r){var s=i.actions[r];if(s&&s.getTag()===t&&s.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}}},getActionByTag:function(t,e){if(t===cc.ACTION_TAG_INVALID)cc.log(cc._LogInfos.ActionManager_getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(i.actions!=null){for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)return e.actions?e.actions.length:0;return 0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)e.paused=true},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];if(e)e.paused=false},pauseAllRunningActions:function(){var t=[];var e=this._arrayTargets;for(var i=0;i<e.length;i++){var n=e[i];if(n&&!n.paused){n.paused=true;t.push(n.target)}}return t},resumeTargets:function(t){if(!t)return;for(var e=0;e<t.length;e++){if(t[e])this.resumeTarget(t[e])}},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];if(i===e.currentAction&&!e.currentActionSalvaged)e.currentActionSalvaged=true;e.actions.splice(t,1);if(e.actionIndex>=t)e.actionIndex--;if(e.actions.length===0){if(this._currentTarget===e){this._currentTargetSalvaged=true}else{this._deleteHashElement(e)}}},_deleteHashElement:function(t){var e=false;if(t){if(this._hashTargets[t.target.__instanceId]){delete this._hashTargets[t.target.__instanceId];cc.arrayRemoveObject(this._arrayTargets,t);e=true}t.actions=null;t.target=null}return e},_actionAllocWithHashElement:function(t){if(t.actions==null){t.actions=[]}},update:function(t){var e=this._arrayTargets,i;for(var n=0;n<e.length;n++){this._currentTarget=e[n];i=this._currentTarget;if(!i.paused){for(i.actionIndex=0;i.actionIndex<(i.actions?i.actions.length:0);i.actionIndex++){i.currentAction=i.actions[i.actionIndex];if(!i.currentAction)continue;i.currentActionSalvaged=false;i.currentAction.step(t*(i.currentAction._speedMethod?i.currentAction._speed:1));if(i.currentActionSalvaged){i.currentAction=null}else if(i.currentAction.isDone()){i.currentAction.stop();var r=i.currentAction;i.currentAction=null;this.removeAction(r)}i.currentAction=null}}if(this._currentTargetSalvaged&&i.actions.length===0){this._deleteHashElement(i)&&n--}}}});cc.ACTION_TAG_INVALID=-1;cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.originalTarget=null;this.target=null;this.tag=cc.ACTION_TAG_INVALID},copy:function(){cc.log("copy is deprecated. Please use clone instead.");return this.clone()},clone:function(){var t=new cc.Action;t.originalTarget=null;t.target=null;t.tag=this.tag;return t},isDone:function(){return true},startWithTarget:function(t){this.originalTarget=t;this.target=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}});cc.action=function(){return new cc.Action};cc.Action.create=cc.action;cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this);this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){cc.log("cocos2d: FiniteTimeAction#reverse: Implement me");return null},clone:function(){return new cc.FiniteTimeAction}});cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this);this._speed=0;this._innerAction=null;t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");this._innerAction=t;this._speed=e;return true},clone:function(){var t=new cc.Speed;t.initWithAction(this._innerAction.clone(),this._speed);return t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t);this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){if(this._innerAction!==t){this._innerAction=t}},getInnerAction:function(){return this._innerAction}});cc.speed=function(t,e){return new cc.Speed(t,e)};cc.Speed.create=cc.speed;cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:false,_boundaryFullyCovered:false,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this);this._followedNode=null;this._boundarySet=false;this._boundaryFullyCovered=false;this._halfScreenSize=null;this._fullScreenSize=null;this.leftBoundary=0;this.rightBoundary=0;this.topBoundary=0;this.bottomBoundary=0;this._worldRect=cc.rect(0,0,0,0);if(t)e?this.initWithTarget(t,e):this.initWithTarget(t)},clone:function(){var t=new cc.Follow;var e=this._worldRect;var i=new cc.Rect(e.x,e.y,e.width,e.height);t.initWithTarget(this._followedNode,i);return t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var i=this;e=e||cc.rect(0,0,0,0);i._followedNode=t;i._worldRect=e;i._boundarySet=!cc._rectEqualToZero(e);i._boundaryFullyCovered=false;var n=cc.director.getWinSize();i._fullScreenSize=cc.p(n.width,n.height);i._halfScreenSize=cc.pMult(i._fullScreenSize,.5);if(i._boundarySet){i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x);i.rightBoundary=-e.x;i.topBoundary=-e.y;i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y);if(i.rightBoundary<i.leftBoundary){i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2}if(i.topBoundary<i.bottomBoundary){i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2}if(i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary)i._boundaryFullyCovered=true}return true},step:function(t){var e=this._followedNode.x;var i=this._followedNode.y;e=this._halfScreenSize.x-e;i=this._halfScreenSize.y-i;this.target._renderCmd._dirtyFlag=0;if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(e,this.leftBoundary,this.rightBoundary),cc.clampf(i,this.bottomBoundary,this.topBoundary))}else{this.target.setPosition(e,i)}},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.follow=function(t,e){return new cc.Follow(t,e)};cc.Follow.create=cc.follow;cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:false,_easeList:null,_timesForRepeat:1,_repeatForever:false,_repeatMethod:false,_speed:1,_speedMethod:false,ctor:function(t){this._speed=1;this._timesForRepeat=1;this._repeatForever=false;this.MAX_VALUE=2;this._repeatMethod=false;this._speedMethod=false;cc.FiniteTimeAction.prototype.ctor.call(this);t!==undefined&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){this._duration=t===0?cc.FLT_EPSILON:t;this._elapsed=0;this._firstTick=true;return true},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever;t._speed=this._speed;t._timesForRepeat=this._timesForRepeat;t._easeList=this._easeList;t._speedMethod=this._speedMethod;t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++){t._easeList.push(this._easeList[e].reverse())}}},clone:function(){var t=new cc.ActionInterval(this._duration);this._cloneDecoration(t);return t},easing:function(t){if(this._easeList)this._easeList.length=0;else this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||e.length===0)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){if(this._firstTick){this._firstTick=false;this._elapsed=0}else this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1;this.update(e>0?e:0);if(this._repeatMethod&&this._timesForRepeat>1&&this.isDone()){if(!this._repeatForever){this._timesForRepeat--}this.startWithTarget(this.target);this.step(this._elapsed-this._duration)}},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t);this._elapsed=0;this._firstTick=true},reverse:function(){cc.log("cc.IntervalAction: reverse not implemented.");return null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.");return 0},speed:function(t){if(t<=0){cc.log("The speed parameter error");return this}this._speedMethod=true;this._speed*=t;return this},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t;return this},repeat:function(t){t=Math.round(t);if(isNaN(t)||t<1){cc.log("The repeat parameter error");return this}this._repeatMethod=true;this._timesForRepeat*=t;return this},repeatForever:function(){this._repeatMethod=true;this._timesForRepeat=this.MAX_VALUE;this._repeatForever=true;return this}});cc.actionInterval=function(t){return new cc.ActionInterval(t)};cc.ActionInterval.create=cc.actionInterval;cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);this._actions=[];var e=t instanceof Array?t:arguments;var i=e.length-1;if(i>=0&&e[i]==null)cc.log("parameters should not be ending with null in Javascript");if(i>=0){var n=e[0],r;for(var s=1;s<i;s++){if(e[s]){r=n;n=cc.Sequence._actionOneTwo(r,e[s])}}this.initWithTwoActions(n,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration+e._duration;this.initWithDuration(i);this._actions[0]=t;this._actions[1]=e;return true},clone:function(){var t=new cc.Sequence;this._cloneDecoration(t);t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._split=this._actions[0]._duration/this._duration;this._last=-1},stop:function(){if(this._last!==-1)this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(t){var e,i=0;var n=this._split,r=this._actions,s=this._last,a;t=this._computeEaseTime(t);if(t<n){e=n!==0?t/n:1;if(i===0&&s===1){r[1].update(0);r[1].stop()}}else{i=1;e=n===1?1:(t-n)/(1-n);if(s===-1){r[0].startWithTarget(this.target);r[0].update(1);r[0].stop()}if(!s){r[0].update(1);r[0].stop()}}a=r[i];if(s===i&&a.isDone())return;if(s!==i)a.startWithTarget(this.target);e=e*a._timesForRepeat;a.update(e>1?e%1:e);this._last=i},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(e.length>0&&e[e.length-1]==null)cc.log("parameters should not be ending with null in Javascript");var i,n,r,s;while(e&&e.length>0){n=Array.prototype.shift.call(e);s=n._timesForRepeat||1;n._repeatMethod=false;n._timesForRepeat=1;r=0;if(!i){i=n;r=1}for(r;r<s;r++){i=cc.Sequence._actionOneTwo(i,n)}}return i};cc.Sequence.create=cc.sequence;cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;i.initWithTwoActions(t,e);return i};cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:false,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;if(this.initWithDuration(i)){this._times=e;this._innerAction=t;if(t instanceof cc.ActionInstant){this._actionInstant=true;this._times-=1}this._total=0;return true}return false},clone:function(){var t=new cc.Repeat;this._cloneDecoration(t);t.initWithAction(this._innerAction.clone(),this._times);return t},startWithTarget:function(t){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,t);this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction;var i=this._duration;var n=this._times;var r=this._nextDt;if(t>=r){while(t>r&&this._total<n){e.update(1);this._total++;e.stop();e.startWithTarget(this.target);r+=e._duration/i;this._nextDt=r}if(t>=1&&this._total<n)this._total++;if(!this._actionInstant){if(this._total===n){e.update(1);e.stop()}else{e.update(t-(r-e._duration/i))}}}else{e.update(t*n%1)}},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);this._cloneDecoration(t);this._reverseEaseList(t);return t},setInnerAction:function(t){if(this._innerAction!==t){this._innerAction=t}},getInnerAction:function(){return this._innerAction}});cc.repeat=function(t,e){return new cc.Repeat(t,e)};cc.Repeat.create=cc.repeat;cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);this._innerAction=null;t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");this._innerAction=t;return true},clone:function(){var t=new cc.RepeatForever;this._cloneDecoration(t);t.initWithAction(this._innerAction.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t);if(e.isDone()){e.startWithTarget(this.target);e.step(e.getElapsed()-e._duration)}},isDone:function(){return false},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());this._cloneDecoration(t);this._reverseEaseList(t);return t},setInnerAction:function(t){if(this._innerAction!==t){this._innerAction=t}},getInnerAction:function(){return this._innerAction}});cc.repeatForever=function(t){return new cc.RepeatForever(t)};cc.RepeatForever.create=cc.repeatForever;cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);this._one=null;this._two=null;var e=t instanceof Array?t:arguments;var i=e.length-1;if(i>=0&&e[i]==null)cc.log("parameters should not be ending with null in Javascript");if(i>=0){var n=e[0],r;for(var s=1;s<i;s++){if(e[s]){r=n;n=cc.Spawn._actionOneTwo(r,e[s])}}this.initWithTwoActions(n,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=false;var n=t._duration;var r=e._duration;if(this.initWithDuration(Math.max(n,r))){this._one=t;this._two=e;if(n>r){this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r))}else if(n<r){this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))}i=true}return i},clone:function(){var t=new cc.Spawn;this._cloneDecoration(t);t.initWithTwoActions(this._one.clone(),this._two.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._one.startWithTarget(t);this._two.startWithTarget(t)},stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);if(this._one)this._one.update(t);if(this._two)this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(e.length>0&&e[e.length-1]==null)cc.log("parameters should not be ending with null in Javascript");
var i=e[0];for(var n=1;n<e.length;n++){if(e[n]!=null)i=cc.Spawn._actionOneTwo(i,e[n])}return i};cc.Spawn.create=cc.spawn;cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;i.initWithTwoActions(t,e);return i};cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._dstAngleX=e||0;this._dstAngleY=i||this._dstAngleX;return true}return false},clone:function(){var t=new cc.RotateTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360;var i=this._dstAngleX-e;if(i>180)i-=360;if(i<-180)i+=360;this._startAngleX=e;this._diffAngleX=i;this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;if(n>180)n-=360;if(n<-180)n+=360;this._diffAngleY=n},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t);if(this.target){this.target.rotationX=this._startAngleX+this._diffAngleX*t;this.target.rotationY=this._startAngleY+this._diffAngleY*t}}});cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)};cc.RotateTo.create=cc.rotateTo;cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._angleX=e||0;this._angleY=i||this._angleX;return true}return false},clone:function(){var t=new cc.RotateBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._angleX,this._angleY);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._startAngleX=t.rotationX;this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t);if(this.target){this.target.rotationX=this._startAngleX+this._angleX*t;this.target.rotationY=this._startAngleY+this._angleY*t}},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)};cc.RotateBy.create=cc.rotateBy;cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);this._positionDelta=cc.p(0,0);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){if(e.x!==undefined){i=e.y;e=e.x}this._positionDelta.x=e;this._positionDelta.y=i;return true}return false},clone:function(){var t=new cc.MoveBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._positionDelta);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();var i=t.getPositionY();this._previousPosition.x=e;this._previousPosition.y=i;this._startPosition.x=e;this._startPosition.y=i},update:function(t){t=this._computeEaseTime(t);if(this.target){var e=this._positionDelta.x*t;var i=this._positionDelta.y*t;var n=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX();var s=this.target.getPositionY();var a=this._previousPosition;n.x=n.x+r-a.x;n.y=n.y+s-a.y;e=e+n.x;i=i+n.y;a.x=e;a.y=i;this.target.setPosition(e,i)}else{this.target.setPosition(n.x+e,n.y+i)}}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)};cc.MoveBy.create=cc.moveBy;cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)){if(e.x!==undefined){i=e.y;e=e.x}this._endPosition.x=e;this._endPosition.y=i;return true}return false},clone:function(){var t=new cc.MoveTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._endPosition);return t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t);this._positionDelta.x=this._endPosition.x-t.getPositionX();this._positionDelta.y=this._endPosition.y-t.getPositionY()}});cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)};cc.MoveTo.create=cc.moveTo;cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);i!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=false;if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._endSkewX=e;this._endSkewY=i;n=true}return n},clone:function(){var t=new cc.SkewTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._endSkewX,this._endSkewY);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._startSkewX=t.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;if(this._deltaX>180)this._deltaX-=360;if(this._deltaX<-180)this._deltaX+=360;this._startSkewY=t.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;if(this._deltaY>180)this._deltaY-=360;if(this._deltaY<-180)this._deltaY+=360},update:function(t){t=this._computeEaseTime(t);this.target.skewX=this._startSkewX+this._deltaX*t;this.target.skewY=this._startSkewY+this._deltaY*t}});cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)};cc.SkewTo.create=cc.skewTo;cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this);i!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=false;if(cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)){this._skewX=e;this._skewY=i;n=true}return n},clone:function(){var t=new cc.SkewBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._skewX,this._skewY);return t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t);this._deltaX=this._skewX;this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)};cc.SkewBy.create=cc.skewBy;cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);this._delta=cc.p(0,0);n!==undefined&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){if(r===undefined){r=n;n=i;i=e.y;e=e.x}this._delta.x=e;this._delta.y=i;this._height=n;this._jumps=r;return true}return false},clone:function(){var t=new cc.JumpBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._delta,this._height,this._jumps);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();var i=t.getPositionY();this._previousPosition.x=e;this._previousPosition.y=i;this._startPosition.x=e;this._startPosition.y=i},update:function(t){t=this._computeEaseTime(t);if(this.target){var e=t*this._jumps%1;var i=this._height*4*e*(1-e);i+=this._delta.y*t;var n=this._delta.x*t;var r=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX();var a=this.target.getPositionY();var o=this._previousPosition;r.x=r.x+s-o.x;r.y=r.y+a-o.y;n=n+r.x;i=i+r.y;o.x=n;o.y=i;this.target.setPosition(n,i)}else{this.target.setPosition(r.x+n,r.y+i)}}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)};cc.JumpBy.create=cc.jumpBy;cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);n!==undefined&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){if(cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)){if(r===undefined){i=e.y;e=e.x}this._endPosition.x=e;this._endPosition.y=i;return true}return false},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps);return t}});cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)};cc.JumpTo.create=cc.jumpTo;cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n};cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);this._config=[];this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._config=e;return true}return false},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);var e=[];for(var i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}t.initWithDuration(this._duration,e);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX();var i=t.getPositionY();this._previousPosition.x=e;this._previousPosition.y=i;this._startPosition.x=e;this._startPosition.y=i},update:function(t){t=this._computeEaseTime(t);if(this.target){var e=this._config;var i=0;var n=e[0].x;var r=e[1].x;var s=e[2].x;var a=0;var o=e[0].y;var c=e[1].y;var l=e[2].y;var h=cc.bezierAt(i,n,r,s,t);var u=cc.bezierAt(a,o,c,l,t);var d=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var _=this.target.getPositionX();var f=this.target.getPositionY();var p=this._previousPosition;d.x=d.x+_-p.x;d.y=d.y+f-p.y;h=h+d.x;u=u+d.y;p.x=h;p.y=u;this.target.setPosition(h,u)}else{this.target.setPosition(d.x+h,d.y+u)}}},reverse:function(){var t=this._config;var e=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])];var i=new cc.BezierBy(this._duration,e);this._cloneDecoration(i);this._reverseEaseList(i);return i}});cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)};cc.BezierBy.create=cc.bezierBy;cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this);this._toConfig=[];e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._toConfig=e;return true}return false},clone:function(){var t=new cc.BezierTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._toConfig);return t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition;var i=this._toConfig;var n=this._config;n[0]=cc.pSub(i[0],e);n[1]=cc.pSub(i[1],e);n[2]=cc.pSub(i[2],e)}});cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)};cc.BezierTo.create=cc.bezierTo;cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._endScaleX=e;this._endScaleY=i!=null?i:e;return true}return false},clone:function(){var t=new cc.ScaleTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._startScaleX=t.scaleX;this._startScaleY=t.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t);if(this.target){this.target.scaleX=this._startScaleX+this._deltaX*t;this.target.scaleY=this._startScaleY+this._deltaY*t}}});cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)};cc.ScaleTo.create=cc.scaleTo;cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);this._cloneDecoration(t);this._reverseEaseList(t);return t},clone:function(){var t=new cc.ScaleBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return t}});cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)};cc.ScaleBy.create=cc.scaleBy;cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:false,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._times=e;return true}return false},clone:function(){var t=new cc.Blink;this._cloneDecoration(t);t.initWithDuration(this._duration,this._times);return t},update:function(t){t=this._computeEaseTime(t);if(this.target&&!this.isDone()){var e=1/this._times;var i=t%e;this.target.visible=i>e/2}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._originalState=t.visible},stop:function(){this.target.visible=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.blink=function(t,e){return new cc.Blink(t,e)};cc.Blink.create=cc.blink;cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._toOpacity=e;return true}return false},clone:function(){var t=new cc.FadeTo;this._cloneDecoration(t);t.initWithDuration(this._duration,this._toOpacity);return t},update:function(t){t=this._computeEaseTime(t);var e=this._fromOpacity!==undefined?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._fromOpacity=t.opacity}});cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)};cc.FadeTo.create=cc.fadeTo;cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this);if(t==null)t=0;this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;t.initWithDuration(this._duration,0);this._cloneDecoration(t);this._reverseEaseList(t);return t},clone:function(){var t=new cc.FadeIn;this._cloneDecoration(t);t.initWithDuration(this._duration,this._toOpacity);return t},startWithTarget:function(t){if(this._reverseAction)this._toOpacity=this._reverseAction._fromOpacity;cc.FadeTo.prototype.startWithTarget.call(this,t)}});cc.fadeIn=function(t){return new cc.FadeIn(t)};cc.FadeIn.create=cc.fadeIn;cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this);if(t==null)t=0;this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;t._reverseAction=this;t.initWithDuration(this._duration,255);this._cloneDecoration(t);this._reverseEaseList(t);return t},clone:function(){var t=new cc.FadeOut;this._cloneDecoration(t);t.initWithDuration(this._duration,this._toOpacity);return t}});cc.fadeOut=function(t){return new cc.FadeOut(t)};cc.FadeOut.create=cc.fadeOut;cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this);this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._to=cc.color(e,i,n);return true}return false},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;t.initWithDuration(this._duration,e.r,e.g,e.b);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;if(e){this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}});cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)};cc.TintTo.create=cc.tintTo;cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._deltaR=e;this._deltaG=i;this._deltaB=n;return true}return false},clone:function(){var t=new cc.TintBy;this._cloneDecoration(t);t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r;this._fromG=e.g;this._fromB=e.b},update:function(t){t=this._computeEaseTime(t);this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);this._cloneDecoration(t);this._reverseEaseList(t);return t}});cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)};cc.TintBy.create=cc.tintBy;cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);this._cloneDecoration(t);this._reverseEaseList(t);return t},clone:function(){var t=new cc.DelayTime;this._cloneDecoration(t);t.initWithDuration(this._duration);return t}});cc.delayTime=function(t){return new cc.DelayTime(t)};cc.DelayTime.create=cc.delayTime;cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);this._other=null;t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");if(cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)){this._other=t;return true}return false},clone:function(){var t=new cc.ReverseTime;this._cloneDecoration(t);t.initWithAction(this._other.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t);if(this._other)this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.reverseTime=function(t){return new cc.ReverseTime(t)};cc.ReverseTime.create=cc.reverseTime;cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);this._splitTimes=[];t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0;this.setAnimation(t);this._origFrame=null;this._executedLoops=0;var i=this._splitTimes;i.length=0;var n=0;var r=e/t.getTotalDelayUnits();var s=t.getFrames();cc.arrayVerifyType(s,cc.AnimationFrame);for(var a=0;a<s.length;a++){var o=s[a];var c=n*r/e;n+=o.getDelayUnits();i.push(c)}return true}return false},clone:function(){var t=new cc.Animate;this._cloneDecoration(t);t.initWithAnimation(this._animation.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);if(this._animation.getRestoreOriginalFrame())this._origFrame=t.displayFrame();this._nextFrame=0;this._executedLoops=0},update:function(t){t=this._computeEaseTime(t);if(t<1){t*=this._animation.getLoops();var e=0|t;if(e>this._executedLoops){this._nextFrame=0;this._executedLoops++}t=t%1}var i=this._animation.getFrames();var n=i.length,r=this._splitTimes;for(var s=this._nextFrame;s<n;s++){if(r[s]<=t){_currFrameIndex=s;this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame());this._nextFrame=s+1}else{break}}},reverse:function(){var t=this._animation;var e=t.getFrames();var i=[];cc.arrayVerifyType(e,cc.AnimationFrame);if(e.length>0){for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}}var s=new cc.Animation(i,t.getDelayPerUnit(),t.getLoops());s.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var a=new cc.Animate(s);this._cloneDecoration(a);this._reverseEaseList(a);return a},stop:function(){if(this._animation.getRestoreOriginalFrame()&&this.target)this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}});cc.animate=function(t){return new cc.Animate(t)};cc.Animate.create=cc.animate;cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){if(this.initWithDuration(e._duration)){this._forcedTarget=t;this._action=e;return true}return false},clone:function(){var t=new cc.TargetedAction;this._cloneDecoration(t);t.initWithTarget(this._forcedTarget,this._action.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t);this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){if(this._forcedTarget!==t)this._forcedTarget=t}});cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)};cc.TargetedAction.create=cc.targetedAction;cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return true},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}});cc.Show=cc.ActionInstant.extend({update:function(t){this.target.visible=true},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}});cc.show=function(){return new cc.Show};cc.Show.create=cc.show;cc.Hide=cc.ActionInstant.extend({update:function(t){this.target.visible=false},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}});cc.hide=function(){return new cc.Hide};cc.Hide.create=cc.hide;cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}});cc.toggleVisibility=function(){return new cc.ToggleVisibility};cc.ToggleVisibility.create=cc.toggleVisibility;cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:true,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this);t!==undefined&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){this._isNeedCleanUp=t;return true},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}});cc.removeSelf=function(t){return new cc.RemoveSelf(t)};cc.RemoveSelf.create=cc.removeSelf;cc.FlipX=cc.ActionInstant.extend({_flippedX:false,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedX=false;t!==undefined&&this.initWithFlipX(t)},initWithFlipX:function(t){this._flippedX=t;return true},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;t.initWithFlipX(this._flippedX);return t}});cc.flipX=function(t){return new cc.FlipX(t)};cc.FlipX.create=cc.flipX;cc.FlipY=cc.ActionInstant.extend({_flippedY:false,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedY=false;t!==undefined&&this.initWithFlipY(t)},initWithFlipY:function(t){this._flippedY=t;return true},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;t.initWithFlipY(this._flippedY);return t}});cc.flipY=function(t){return new cc.FlipY(t)};cc.FlipY.create=cc.flipY;cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this);this._x=0;this._y=0;if(t!==undefined){if(t.x!==undefined){e=t.y;t=t.x}this.initWithPosition(t,e)}},initWithPosition:function(t,e){this._x=t;this._y=e;return true},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;t.initWithPosition(this._x,this._y);return t}});cc.place=function(t,e){return new cc.Place(t,e)};cc.Place.create=cc.place;cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this);this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){if(t){this._function=t}if(e){this._selectorTarget=e}if(i!==undefined){this._data=i}return true},execute:function(){if(this._function){this._function.call(this._selectorTarget,this.target,this._data)}},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){if(t!==this._selectorTarget){if(this._selectorTarget)this._selectorTarget=null;this._selectorTarget=t}},clone:function(){var t=new cc.CallFunc;t.initWithFunction(this._function,this._selectorTarget,this._data);return t}});cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)};cc.CallFunc.create=cc.callFunc;cc.ActionCamera=cc.ActionInterval.extend({_centerXOrig:0,_centerYOrig:0,_centerZOrig:0,_eyeXOrig:0,_eyeYOrig:0,_eyeZOrig:0,_upXOrig:0,_upYOrig:0,_upZOrig:0,ctor:function(){var t=this;cc.ActionInterval.prototype.ctor.call(t);t._centerXOrig=0;t._centerYOrig=0;t._centerZOrig=0;t._eyeXOrig=0;t._eyeYOrig=0;t._eyeZOrig=0;t._upXOrig=0;t._upYOrig=0;t._upZOrig=0},startWithTarget:function(t){var e=this;cc.ActionInterval.prototype.startWithTarget.call(e,t);var i=t.getCamera();var n=i.getCenter();e._centerXOrig=n.x;e._centerYOrig=n.y;e._centerZOrig=n.z;var r=i.getEye();e._eyeXOrig=r.x;e._eyeYOrig=r.y;e._eyeZOrig=r.z;var s=i.getUp();e._upXOrig=s.x;e._upYOrig=s.y;e._upZOrig=s.z},clone:function(){return new cc.ActionCamera},reverse:function(){return new cc.ReverseTime(this)}});cc.OrbitCamera=cc.ActionCamera.extend({_radius:0,_deltaRadius:0,_angleZ:0,_deltaAngleZ:0,_angleX:0,_deltaAngleX:0,_radZ:0,_radDeltaZ:0,_radX:0,_radDeltaX:0,ctor:function(t,e,i,n,r,s,a){cc.ActionCamera.prototype.ctor.call(this);a!==undefined&&this.initWithDuration(t,e,i,n,r,s,a)},initWithDuration:function(t,e,i,n,r,s,a){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){var o=this;o._radius=e;o._deltaRadius=i;o._angleZ=n;o._deltaAngleZ=r;o._angleX=s;o._deltaAngleX=a;o._radDeltaZ=cc.degreesToRadians(r);o._radDeltaX=cc.degreesToRadians(a);return true}return false},sphericalRadius:function(){var t,e,i;var n=this.target.getCamera();var r=n.getEye();var s=n.getCenter();var a=r.x-s.x,o=r.y-s.y,c=r.z-s.z;var l=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)+Math.pow(c,2));var h=Math.sqrt(Math.pow(a,2)+Math.pow(o,2));if(h===0)h=cc.FLT_EPSILON;if(l===0)l=cc.FLT_EPSILON;e=Math.acos(c/l);if(a<0)i=Math.PI-Math.asin(o/h);else i=Math.asin(o/h);t=l/cc.Camera.getZEye();return{newRadius:t,zenith:e,azimuth:i}},startWithTarget:function(t){var e=this;cc.ActionInterval.prototype.startWithTarget.call(e,t);var i=e.sphericalRadius();if(isNaN(e._radius))e._radius=i.newRadius;if(isNaN(e._angleZ))e._angleZ=cc.radiansToDegrees(i.zenith);if(isNaN(e._angleX))e._angleX=cc.radiansToDegrees(i.azimuth);e._radZ=cc.degreesToRadians(e._angleZ);e._radX=cc.degreesToRadians(e._angleX)},clone:function(){var t=new cc.OrbitCamera,e=this;t.initWithDuration(e._duration,e._radius,e._deltaRadius,e._angleZ,e._deltaAngleZ,e._angleX,e._deltaAngleX);return t},update:function(t){t=this._computeEaseTime(t);var e=(this._radius+this._deltaRadius*t)*cc.Camera.getZEye();var i=this._radZ+this._radDeltaZ*t;var n=this._radX+this._radDeltaX*t;var r=Math.sin(i)*Math.cos(n)*e+this._centerXOrig;var s=Math.sin(i)*Math.sin(n)*e+this._centerYOrig;var a=Math.cos(i)*e+this._centerZOrig;this.target.getCamera().setEye(r,s,a);this.target.setNodeDirty()}});cc.orbitCamera=function(t,e,i,n,r,s,a){return new cc.OrbitCamera(t,e,i,n,r,s,a)};cc.OrbitCamera.create=cc.orbitCamera;cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this);t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");if(this.initWithDuration(t.getDuration())){this._inner=t;return true}return false},clone:function(){var t=new cc.ActionEase;t.initWithAction(this._inner.clone());return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop();cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}});cc.actionEase=function(t){return new cc.ActionEase(t)};cc.ActionEase.create=cc.actionEase;cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this);e!==undefined&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){if(cc.ActionEase.prototype.initWithAction.call(this,t)){this._rate=e;return true}return false},clone:function(){var t=new cc.EaseRateAction;t.initWithAction(this._inner.clone(),this._rate);return t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}});cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)};cc.EaseRateAction.create=cc.easeRateAction;cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;t.initWithAction(this._inner.clone(),this._rate);return t}});cc.EaseIn.create=function(t,e){return new cc.EaseIn(t,e)};cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}};cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;t.initWithAction(this._inner.clone(),this._rate);return t}});cc.EaseOut.create=function(t,e){return new cc.EaseOut(t,e)};cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}};cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){t*=2;if(t<1)this._inner.update(.5*Math.pow(t,this._rate));else this._inner.update(1-.5*Math.pow(2-t,this._rate));
},clone:function(){var t=new cc.EaseInOut;t.initWithAction(this._inner.clone(),this._rate);return t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}});cc.EaseInOut.create=function(t,e){return new cc.EaseInOut(t,e)};cc.easeInOut=function(t){return{_rate:t,easing:function(t){t*=2;if(t<1)return.5*Math.pow(t,this._rate);else return 1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(t===0?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;t.initWithAction(this._inner.clone());return t}});cc.EaseExponentialIn.create=function(t){return new cc.EaseExponentialIn(t)};cc._easeExponentialInObj={easing:function(t){return t===0?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}};cc.easeExponentialIn=function(){return cc._easeExponentialInObj};cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(t===1?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;t.initWithAction(this._inner.clone());return t}});cc.EaseExponentialOut.create=function(t){return new cc.EaseExponentialOut(t)};cc._easeExponentialOutObj={easing:function(t){return t===1?1:-Math.pow(2,-10*t)+1},reverse:function(){return cc._easeExponentialInObj}};cc.easeExponentialOut=function(){return cc._easeExponentialOutObj};cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){if(t!==1&&t!==0){t*=2;if(t<1)t=.5*Math.pow(2,10*(t-1));else t=.5*(-Math.pow(2,-10*(t-1))+2)}this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;t.initWithAction(this._inner.clone());return t}});cc.EaseExponentialInOut.create=function(t){return new cc.EaseExponentialInOut(t)};cc._easeExponentialInOutObj={easing:function(t){if(t!==1&&t!==0){t*=2;if(t<1)return.5*Math.pow(2,10*(t-1));else return.5*(-Math.pow(2,-10*(t-1))+2)}return t},reverse:function(){return cc._easeExponentialInOutObj}};cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj};cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:-1*Math.cos(t*Math.PI/2)+1;this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;t.initWithAction(this._inner.clone());return t}});cc.EaseSineIn.create=function(t){return new cc.EaseSineIn(t)};cc._easeSineInObj={easing:function(t){return t===0||t===1?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}};cc.easeSineIn=function(){return cc._easeSineInObj};cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:Math.sin(t*Math.PI/2);this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;t.initWithAction(this._inner.clone());return t}});cc.EaseSineOut.create=function(t){return new cc.EaseSineOut(t)};cc._easeSineOutObj={easing:function(t){return t===0||t===1?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}};cc.easeSineOut=function(){return cc._easeSineOutObj};cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:-.5*(Math.cos(Math.PI*t)-1);this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}});cc.EaseSineInOut.create=function(t){return new cc.EaseSineInOut(t)};cc._easeSineInOutObj={easing:function(t){return t===0||t===1?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}};cc.easeSineInOut=function(){return cc._easeSineInOutObj};cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this);t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){cc.ActionEase.prototype.initWithAction.call(this,t);this._period=e==null?.3:e;return true},reverse:function(){cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass.");return null},clone:function(){var t=new cc.EaseElastic;t.initWithAction(this._inner.clone(),this._period);return t}});cc.EaseElastic.create=function(t,e){return new cc.EaseElastic(t,e)};cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;if(t===0||t===1){e=t}else{var i=this._period/4;t=t-1;e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;t.initWithAction(this._inner.clone(),this._period);return t}});cc.EaseElasticIn.create=function(t,e){return new cc.EaseElasticIn(t,e)};cc._easeElasticInObj={easing:function(t){if(t===0||t===1)return t;t=t-1;return-Math.pow(2,10*t)*Math.sin((t-.3/4)*Math.PI*2/.3)},reverse:function(){return cc._easeElasticOutObj}};cc.easeElasticIn=function(t){if(t&&t!==.3){return{_period:t,easing:function(t){if(t===0||t===1)return t;t=t-1;return-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)},reverse:function(){return cc.easeElasticOut(this._period)}}}return cc._easeElasticInObj};cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;if(t===0||t===1){e=t}else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;t.initWithAction(this._inner.clone(),this._period);return t}});cc.EaseElasticOut.create=function(t,e){return new cc.EaseElasticOut(t,e)};cc._easeElasticOutObj={easing:function(t){return t===0||t===1?t:Math.pow(2,-10*t)*Math.sin((t-.3/4)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}};cc.easeElasticOut=function(t){if(t&&t!==.3){return{_period:t,easing:function(t){return t===0||t===1?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}}return cc._easeElasticOutObj};cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0;var i=this._period;if(t===0||t===1){e=t}else{t=t*2;if(!i)i=this._period=.3*1.5;var n=i/4;t=t-1;if(t<0)e=-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i);else e=Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;t.initWithAction(this._inner.clone(),this._period);return t}});cc.EaseElasticInOut.create=function(t,e){return new cc.EaseElasticInOut(t,e)};cc.easeElasticInOut=function(t){t=t||.3;return{_period:t,easing:function(t){var e=0;var i=this._period;if(t===0||t===1){e=t}else{t=t*2;if(!i)i=this._period=.3*1.5;var n=i/4;t=t-1;if(t<0)e=-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i);else e=Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}};cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){t-=1.5/2.75;return 7.5625*t*t+.75}else if(t<2.5/2.75){t-=2.25/2.75;return 7.5625*t*t+.9375}t-=2.625/2.75;return 7.5625*t*t+.984375},clone:function(){var t=new cc.EaseBounce;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}});cc.EaseBounce.create=function(t){return new cc.EaseBounce(t)};cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;t.initWithAction(this._inner.clone());return t}});cc.EaseBounceIn.create=function(t){return new cc.EaseBounceIn(t)};cc._bounceTime=function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){t-=1.5/2.75;return 7.5625*t*t+.75}else if(t<2.5/2.75){t-=2.25/2.75;return 7.5625*t*t+.9375}t-=2.625/2.75;return 7.5625*t*t+.984375};cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}};cc.easeBounceIn=function(){return cc._easeBounceInObj};cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;t.initWithAction(this._inner.clone());return t}});cc.EaseBounceOut.create=function(t){return new cc.EaseBounceOut(t)};cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}};cc.easeBounceOut=function(){return cc._easeBounceOutObj};cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0;if(t<.5){t=t*2;e=(1-this.bounceTime(1-t))*.5}else{e=this.bounceTime(t*2-1)*.5+.5}this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}});cc.EaseBounceInOut.create=function(t){return new cc.EaseBounceInOut(t)};cc._easeBounceInOutObj={easing:function(t){var e;if(t<.5){t=t*2;e=(1-cc._bounceTime(1-t))*.5}else{e=cc._bounceTime(t*2-1)*.5+.5}return e},reverse:function(){return cc._easeBounceInOutObj}};cc.easeBounceInOut=function(){return cc._easeBounceInOutObj};cc.EaseBackIn=cc.ActionEase.extend({update:function(t){var e=1.70158;t=t===0||t===1?t:t*t*((e+1)*t-e);this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;t.initWithAction(this._inner.clone());return t}});cc.EaseBackIn.create=function(t){return new cc.EaseBackIn(t)};cc._easeBackInObj={easing:function(t){var e=1.70158;return t===0||t===1?t:t*t*((e+1)*t-e)},reverse:function(){return cc._easeBackOutObj}};cc.easeBackIn=function(){return cc._easeBackInObj};cc.EaseBackOut=cc.ActionEase.extend({update:function(t){var e=1.70158;t=t-1;this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;t.initWithAction(this._inner.clone());return t}});cc.EaseBackOut.create=function(t){return new cc.EaseBackOut(t)};cc._easeBackOutObj={easing:function(t){var e=1.70158;t=t-1;return t*t*((e+1)*t+e)+1},reverse:function(){return cc._easeBackInObj}};cc.easeBackOut=function(){return cc._easeBackOutObj};cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){var e=1.70158*1.525;t=t*2;if(t<1){this._inner.update(t*t*((e+1)*t-e)/2)}else{t=t-2;this._inner.update(t*t*((e+1)*t+e)/2+1)}},clone:function(){var t=new cc.EaseBackInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}});cc.EaseBackInOut.create=function(t){return new cc.EaseBackInOut(t)};cc._easeBackInOutObj={easing:function(t){var e=1.70158*1.525;t=t*2;if(t<1){return t*t*((e+1)*t-e)/2}else{t=t-2;return t*t*((e+1)*t+e)/2+1}},reverse:function(){return cc._easeBackInOutObj}};cc.easeBackInOut=function(){return cc._easeBackInOutObj};cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new cc.EaseBezierAction;t.initWithAction(this._inner.clone());t.setBezierParamer(this._p0,this._p1,this._p2,this._p3);return t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());t.setBezierParamer(this._p3,this._p2,this._p1,this._p0);return t},setBezierParamer:function(t,e,i,n){this._p0=t||0;this._p1=e||0;this._p2=i||0;this._p3=n||0}});cc.EaseBezierAction.create=function(t){return new cc.EaseBezierAction(t)};cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}};cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}});cc.EaseQuadraticActionIn.create=function(t){return new cc.EaseQuadraticActionIn(t)};cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}};cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn};cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;t.initWithAction();return t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}});cc.EaseQuadraticActionOut.create=function(t){return new cc.EaseQuadraticActionOut(t)};cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}};cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut};cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){var e=t;t*=2;if(t<1){e=t*t*.5}else{--t;e=-.5*(t*(t-2)-1)}return e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}});cc.EaseQuadraticActionInOut.create=function(t){return new cc.EaseQuadraticActionInOut(t)};cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}};cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut};cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}});cc.EaseQuarticActionIn.create=function(t){return new cc.EaseQuarticActionIn(t)};cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}};cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn};cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){t-=1;return-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}});cc.EaseQuarticActionOut.create=function(t){return new cc.EaseQuarticActionOut(t)};cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}};cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut};cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){t=t*2;if(t<1)return.5*t*t*t*t;t-=2;return-.5*(t*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}});cc.EaseQuarticActionInOut.create=function(t){return new cc.EaseQuarticActionInOut(t)};cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}};cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut};cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}});cc.EaseQuinticActionIn.create=function(t){return new cc.EaseQuinticActionIn(t)};cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}};cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn};cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){t-=1;return t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}});cc.EaseQuinticActionOut.create=function(t){return new cc.EaseQuinticActionOut(t)};cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}};cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut};cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){t=t*2;if(t<1)return.5*t*t*t*t*t;t-=2;return.5*(t*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}});cc.EaseQuinticActionInOut.create=function(t){return new cc.EaseQuinticActionInOut(t)};cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}};cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut};cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}});cc.EaseCircleActionIn.create=function(t){return new cc.EaseCircleActionIn(t)};cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}};cc.easeCircleActionIn=function(){return cc._easeCircleActionIn};cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){t=t-1;return Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}});cc.EaseCircleActionOut.create=function(t){return new cc.EaseCircleActionOut(t)};cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}};cc.easeCircleActionOut=function(){return cc._easeCircleActionOut};cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){t=t*2;if(t<1)return-.5*(Math.sqrt(1-t*t)-1);t-=2;return.5*(Math.sqrt(1-t*t)+1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}});cc.EaseCircleActionInOut.create=function(t){return new cc.EaseCircleActionInOut(t)};cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}};cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut};cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}});cc.EaseCubicActionIn.create=function(t){return new cc.EaseCubicActionIn(t)};cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}};cc.easeCubicActionIn=function(){return cc._easeCubicActionIn};cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){t-=1;return t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}});cc.EaseCubicActionOut.create=function(t){return new cc.EaseCubicActionOut(t)};cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}};cc.easeCubicActionOut=function(){return cc._easeCubicActionOut};cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){t=t*2;if(t<1)return.5*t*t*t;t-=2;return.5*(t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;t.initWithAction(this._inner.clone());return t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}});cc.EaseCubicActionInOut.create=function(t){return new cc.EaseCubicActionInOut(t)};cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}};cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut};cc.cardinalSplineAt=function(t,e,i,n,r,s){var a=s*s;var o=a*s;var c=(1-r)/2;var l=c*(-o+2*a-s);var h=c*(-o+a)+(2*o-3*a+1);var u=c*(o-2*a+s)+(-2*o+3*a);var d=c*(o-a);var _=t.x*l+e.x*h+i.x*u+n.x*d;var f=t.y*l+e.y*h+i.y*u+n.y*d;return cc.p(_,f)};cc.reverseControlPoints=function(t){var e=[];for(var i=t.length-1;i>=0;i--){e.push(cc.p(t[i].x,t[i].y))}return e};cc.cloneControlPoints=function(t){var e=[];for(var i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e};cc.copyControlPoints=cc.cloneControlPoints;cc.getControlPointAt=function(t,e){var i=Math.min(t.length-1,Math.max(e,0));return t[i]};cc.reverseControlPointsInline=function(t){var e=t.length;var i=0|e/2;for(var n=0;n<i;++n){var r=t[n];t[n]=t[e-n-1];t[e-n-1]=r}};cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);this._points=[];i!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||e.length===0)throw new Error("Invalid configuration. It must at least have one control point");if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this.setPoints(e);this._tension=i;return true}return false},clone:function(){var t=new cc.CardinalSplineTo;t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._deltaT=1/(this._points.length-1);this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY());this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i;var n=this._points;if(t===1){e=n.length-1;i=1}else{var r=this._deltaT;e=0|t/r;i=(t-r*e)/r}var s=cc.cardinalSplineAt(cc.getControlPointAt(n,e-1),cc.getControlPointAt(n,e-0),cc.getControlPointAt(n,e+1),cc.getControlPointAt(n,e+2),this._tension,i);if(cc.ENABLE_STACKABLE_ACTIONS){var a,o;a=this.target.getPositionX()-this._previousPosition.x;o=this.target.getPositionY()-this._previousPosition.y;if(a!==0||o!==0){var c=this._accumulatedDiff;a=c.x+a;o=c.y+o;c.x=a;c.y=o;s.x+=a;s.y+=o}}this.updatePosition(s)},reverse:function(){var t=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t);this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}});cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)};cc.CardinalSplineTo.create=cc.cardinalSplineTo;cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this);this._startPosition=cc.p(0,0);i!==undefined&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t);this._startPosition.x=t.getPositionX();this._startPosition.y=t.getPositionY()},reverse:function(){var t=this._points.slice();var e;var i=t[0];for(var n=1;n<t.length;++n){e=t[n];t[n]=cc.pSub(e,i);i=e}var r=cc.reverseControlPoints(t);i=r[r.length-1];r.pop();i.x=-i.x;i.y=-i.y;r.unshift(i);for(var n=1;n<r.length;++n){e=r[n];e.x=-e.x;e.y=-e.y;e.x+=i.x;e.y+=i.y;r[n]=e;i=e}return cc.cardinalSplineBy(this._duration,r,this._tension)},updatePosition:function(t){var e=this._startPosition;var i=t.x+e.x;var n=t.y+e.y;this._previousPosition.x=i;this._previousPosition.y=n;this.target.setPosition(i,n)},clone:function(){var t=new cc.CardinalSplineBy;t.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return t}});cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)};cc.CardinalSplineBy.create=cc.cardinalSplineBy;cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;t.initWithDuration(this._duration,cc.copyControlPoints(this._points));return t}});cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)};cc.CatmullRomTo.create=cc.catmullRomTo;cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;t.initWithDuration(this._duration,cc.copyControlPoints(this._points));return t}});cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)};cc.CatmullRomBy.create=cc.catmullRomBy;cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(t,e){}});cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this);this.key="";n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this.key=e;this.to=n;this.from=i;return true}return false},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw new Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");cc.ActionInterval.prototype.startWithTarget.call(this,t);this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new cc.ActionTween;t.initWithDuration(this._duration,this.key,this.from,this.to);return t}});cc.actionTween=function(t,e,i,n){return new cc.ActionTween(t,e,i,n)};cc.ActionTween.create=cc.actionTween;(function(){var t=false;var e=cc.sys;var i=e.browserVersion;var n=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);var r={common:{MULTI_CHANNEL:true,WEB_AUDIO:n,AUTOPLAY:true}};r[e.BROWSER_TYPE_IE]={MULTI_CHANNEL:true,WEB_AUDIO:n,AUTOPLAY:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_ANDROID]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false};r[e.BROWSER_TYPE_CHROME]={MULTI_CHANNEL:true,WEB_AUDIO:true,AUTOPLAY:false};r[e.BROWSER_TYPE_FIREFOX]={MULTI_CHANNEL:true,WEB_AUDIO:true,AUTOPLAY:true,DELAY_CREATE_CTX:true};r[e.BROWSER_TYPE_UC]={MULTI_CHANNEL:true,WEB_AUDIO:false,AUTOPLAY:false};r[e.BROWSER_TYPE_QQ]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:true};r[e.BROWSER_TYPE_OUPENG]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_WECHAT]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_360]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:true};r[e.BROWSER_TYPE_MIUI]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:true};r[e.BROWSER_TYPE_LIEBAO]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_SOUGOU]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_BAIDU]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_BAIDU_APP]={MULTI_CHANNEL:false,WEB_AUDIO:false,AUTOPLAY:false,REPLAY_AFTER_TOUCH:true,USE_EMPTIED_EVENT:true};r[e.BROWSER_TYPE_SAFARI]={MULTI_CHANNEL:true,WEB_AUDIO:true,AUTOPLAY:false,webAudioCallback:function(t){document.createElement("audio").src=t}};if(cc.sys.isMobile){if(cc.sys.os!==cc.sys.OS_IOS)window.__audioSupport=r[e.browserType]||r["common"];else window.__audioSupport=r[e.BROWSER_TYPE_SAFARI]}else{switch(e.browserType){case e.BROWSER_TYPE_IE:window.__audioSupport=r[e.BROWSER_TYPE_IE];break;case e.BROWSER_TYPE_FIREFOX:window.__audioSupport=r[e.BROWSER_TYPE_FIREFOX];break;default:window.__audioSupport=r["common"]}}if(i){switch(e.browserType){case e.BROWSER_TYPE_CHROME:i=parseInt(i);if(i<30){window.__audioSupport={MULTI_CHANNEL:false,WEB_AUDIO:true,AUTOPLAY:false}}else if(i===42){window.__audioSupport.NEED_MANUAL_LOOP=true}break;case e.BROWSER_TYPE_MIUI:if(cc.sys.isMobile){i=i.match(/\d+/g);if(i[0]<2||i[0]===2&&i[1]===0&&i[2]<=1){window.__audioSupport.AUTOPLAY=false}}break}}if(t){setTimeout(function(){cc.log("browse type: "+e.browserType);cc.log("browse version: "+i);cc.log("MULTI_CHANNEL: "+window.__audioSupport.MULTI_CHANNEL);cc.log("WEB_AUDIO: "+window.__audioSupport.WEB_AUDIO);cc.log("AUTOPLAY: "+window.__audioSupport.AUTOPLAY)},0)}})();cc.Audio=cc.Class.extend({volume:1,loop:false,src:null,_touch:false,_playing:false,_AUDIO_TYPE:"AUDIO",_pause:false,_buffer:null,_currentSource:null,_startTime:null,_currentTime:null,_context:null,_volume:null,_ignoreEnded:false,_manualLoop:false,_element:null,ctor:function(t,e,i){t&&(this._context=t);e&&(this._volume=e);if(t&&e){this._AUDIO_TYPE="WEBAUDIO"}this.src=i},_setBufferCallback:null,setBuffer:function(t){if(!t)return;var e=this._playing;this._AUDIO_TYPE="WEBAUDIO";if(this._buffer&&this._buffer!==t&&this.getPlaying())this.stop();this._buffer=t;if(e)this.play();this._volume["gain"].value=this.volume;this._setBufferCallback&&this._setBufferCallback(t)},_setElementCallback:null,setElement:function(t){if(!t)return;var e=this._playing;this._AUDIO_TYPE="AUDIO";if(this._element&&this._element!==t&&this.getPlaying())this.stop();this._element=t;if(e)this.play();t.volume=this.volume;t.loop=this.loop;this._setElementCallback&&this._setElementCallback(t)},play:function(t,e){this._playing=true;this.loop=e===undefined?this.loop:e;if(this._AUDIO_TYPE==="AUDIO"){this._playOfAudio(t)}else{this._playOfWebAudio(t)}},getPlaying:function(){if(!this._playing){return false}if(this._AUDIO_TYPE==="AUDIO"){var t=this._element;if(!t||this._pause||t.ended){return this._playing=false}return true}var e=this._currentSource;if(!e||!e["playbackState"])return true;if(this._currentTime+this._context.currentTime-this._startTime<e.buffer.duration)return true;return e["playbackState"]==2},_playOfWebAudio:function(t){var e=this._currentSource;if(!this._buffer){return}if(!this._pause&&e){if(this._context.currentTime===0||this._currentTime+this._context.currentTime-this._startTime>e.buffer.duration)this._stopOfWebAudio();else return}var i=this._context["createBufferSource"]();
i.buffer=this._buffer;i["connect"](this._volume);if(this._manualLoop)i.loop=false;else i.loop=this.loop;this._startTime=this._context.currentTime;this._currentTime=t||0;this._ignoreEnded=false;if(i.start){i.start(0,t||0)}else if(i["noteGrainOn"]){var n=i.buffer.duration;if(this.loop){i["noteGrainOn"](0,t,n)}else{i["noteGrainOn"](0,t,n-t)}}else{i["noteOn"](0)}this._currentSource=i;var r=this;i["onended"]=function(){if(r._manualLoop&&r._playing&&r.loop){r.stop();r.play();return}if(r._ignoreEnded){r._ignoreEnded=false}else{if(!r._pause)r.stop();else r._playing=false}}},_playOfAudio:function(){var t=this._element;if(t){t.loop=this.loop;t.play()}},stop:function(){this._playing=false;if(this._AUDIO_TYPE==="AUDIO"){this._stopOfAudio()}else{this._stopOfWebAudio()}},_stopOfWebAudio:function(){var t=this._currentSource;this._ignoreEnded=true;if(t){t.stop(0);this._currentSource=null}},_stopOfAudio:function(){var t=this._element;if(t){t.pause();if(t.duration&&t.duration!==Infinity)t.currentTime=0}},pause:function(){if(this.getPlaying()===false)return;this._playing=false;this._pause=true;if(this._AUDIO_TYPE==="AUDIO"){this._pauseOfAudio()}else{this._pauseOfWebAudio()}},_pauseOfWebAudio:function(){this._currentTime+=this._context.currentTime-this._startTime;var t=this._currentSource;if(t){t.stop(0)}},_pauseOfAudio:function(){var t=this._element;if(t){t.pause()}},resume:function(){if(this._pause){if(this._AUDIO_TYPE==="AUDIO"){this._resumeOfAudio()}else{this._resumeOfWebAudio()}this._pause=false;this._playing=true}},_resumeOfWebAudio:function(){var t=this._currentSource;if(t){this._startTime=this._context.currentTime;var e=this._currentTime%t.buffer.duration;this._playOfWebAudio(e)}},_resumeOfAudio:function(){var t=this._element;if(t){t.play()}},setVolume:function(t){if(t>1)t=1;if(t<0)t=0;this.volume=t;if(this._AUDIO_TYPE==="AUDIO"){if(this._element){this._element.volume=t}}else{if(this._volume){this._volume["gain"].value=t}}},getVolume:function(){return this.volume},cloneNode:function(){var t,e;if(this._AUDIO_TYPE==="AUDIO"){t=new cc.Audio;var i=document.createElement("audio");i.src=this.src;t.setElement(i)}else{var n=this._context["createGain"]();n["gain"].value=1;n["connect"](this._context["destination"]);t=new cc.Audio(this._context,n,this.src);if(this._buffer){t.setBuffer(this._buffer)}else{e=this;this._setBufferCallback=function(i){t.setBuffer(i);e._setBufferCallback=null}}t._manualLoop=this._manualLoop}t._AUDIO_TYPE=this._AUDIO_TYPE;return t}});(function(t){var e=t.WEB_AUDIO,i=t.MULTI_CHANNEL,n=t.AUTOPLAY;var r=[];(function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');if(e&&e!=="")r.push(".ogg");var i=t.canPlayType("audio/mpeg");if(i&&i!=="")r.push(".mp3");var n=t.canPlayType('audio/wav; codecs="1"');if(n&&n!=="")r.push(".wav");var s=t.canPlayType("audio/mp4");if(s&&s!=="")r.push(".mp4");var a=t.canPlayType("audio/x-m4a");if(a&&a!=="")r.push(".m4a")}})();try{if(e){var s=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);if(t.DELAY_CREATE_CTX)setTimeout(function(){s=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0)}}catch(a){e=false;cc.log("browser don't support web audio")}var o={cache:{},load:function(i,n,a,c){if(r.length===0)return c("can not support audio!");var l;if(cc.loader.audioPath)i=cc.path.join(cc.loader.audioPath,i);var h=cc.path.extname(i);var u=[h];for(l=0;l<r.length;l++){if(h!==r[l]){u.push(r[l])}}var d;if(o.cache[n])return c(null,o.cache[n]);if(e){try{var _=s["createGain"]();_["gain"].value=1;_["connect"](s["destination"]);d=new cc.Audio(s,_,i);if(t.NEED_MANUAL_LOOP)d._manualLoop=true}catch(f){e=false;cc.log("browser don't support web audio");d=new cc.Audio(null,null,i)}}else{d=new cc.Audio(null,null,i)}this.loadAudioFromExtList(i,u,d,c);o.cache[n]=d},loadAudioFromExtList:function(i,n,a,c){if(n.length===0){var l="can not found the resource of audio! Last match url is : ";l+=i.replace(/\.(.*)?$/,"(");r.forEach(function(t){l+=t+"|"});l=l.replace(/\|$/,")");return c({status:520,errorMessage:l},null)}i=cc.path.changeExtname(i,n.splice(0,1));if(e){if(t.webAudioCallback)t.webAudioCallback(i);var h=new XMLHttpRequest;h.open("GET",i,true);h.responseType="arraybuffer";h.onload=function(){s["decodeAudioData"](h.response,function(t){a.setBuffer(t);c(null,a)},function(){o.loadAudioFromExtList(i,n,a,c)})};h.onerror=function(){c({status:520,errorMessage:l},null)};h.send()}else{var u=document.createElement("audio");var d=false;var _=false;var f=setTimeout(function(){if(u.readyState===0){g()}else{_=true;u.pause();document.body.removeChild(u);c("audio load timeout : "+i,a)}},1e4);var p=function(){if(!d){try{u.currentTime=0;u.volume=1}catch(t){}document.body.removeChild(u);a.setElement(u);u.removeEventListener("canplaythrough",p,false);u.removeEventListener("error",m,false);u.removeEventListener("emptied",g,false);!_&&c(null,a);d=true;clearTimeout(f)}};var m=function(){if(!d)return;document.body.removeChild(u);u.removeEventListener("canplaythrough",p,false);u.removeEventListener("error",m,false);u.removeEventListener("emptied",g,false);!_&&o.loadAudioFromExtList(i,n,a,c);d=true;clearTimeout(f)};var g=function(){_=true;p();c(null,a)};u.addEventListener("canplaythrough",p,false);u.addEventListener("error",m,false);if(t.USE_EMPTIED_EVENT)u.addEventListener("emptied",g,false);u.src=i;document.body.appendChild(u);u.volume=0}}};cc.loader.register(["mp3","ogg","wav","mp4","m4a"],o);cc.audioEngine={_currMusic:null,_musicVolume:1,features:t,willPlayMusic:function(){return false},playMusic:function(t,e){var i=this._currMusic;if(i&&i.src!==t&&i.getPlaying()){i.stop()}var n=o.cache[t];if(!n){cc.loader.load(t);n=o.cache[t]}n.play(0,e);n.setVolume(this._musicVolume);this._currMusic=n},stopMusic:function(t){var e=this._currMusic;if(e){e.stop();if(t)cc.loader.release(e.src)}},pauseMusic:function(){var t=this._currMusic;if(t)t.pause()},resumeMusic:function(){var t=this._currMusic;if(t)t.resume()},rewindMusic:function(){var t=this._currMusic;if(t){t.stop();t.play()}},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t=t-0;if(isNaN(t))t=1;if(t>1)t=1;if(t<0)t=0;this._musicVolume=t;var e=this._currMusic;if(e){e.setVolume(t)}},isMusicPlaying:function(){var t=this._currMusic;if(t){return t.getPlaying()}else{return false}},_audioPool:{},_maxAudioInstance:5,_effectVolume:1,playEffect:function(t,n){if(!i){return null}var r=this._audioPool[t];if(!r){r=this._audioPool[t]=[]}var s;for(s=0;s<r.length;s++){if(!r[s].getPlaying()){break}}if(r[s]){a=r[s];a.setVolume(this._effectVolume);a.play(0,n)}else if(!e&&s>this._maxAudioInstance){cc.log("Error: %s greater than %d",t,this._maxAudioInstance)}else{var a=o.cache[t];if(!a){cc.loader.load(t);a=o.cache[t]}a=a.cloneNode();a.setVolume(this._effectVolume);a.loop=n||false;a.play();r.push(a)}return a},setEffectsVolume:function(t){t=t-0;if(isNaN(t))t=1;if(t>1)t=1;if(t<0)t=0;this._effectVolume=t;var e=this._audioPool;for(var i in e){var n=e[i];if(Array.isArray(n))for(var r=0;r<n.length;r++){n[r].setVolume(t)}}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){if(t){t.pause()}},pauseAllEffects:function(){var t=this._audioPool;for(var e in t){var i=t[e];for(var n=0;n<t[e].length;n++){if(i[n].getPlaying()){i[n].pause()}}}},resumeEffect:function(t){if(t)t.resume()},resumeAllEffects:function(){var t=this._audioPool;for(var e in t){var i=t[e];for(var n=0;n<t[e].length;n++){i[n].resume()}}},stopEffect:function(t){if(t)t.stop()},stopAllEffects:function(){var t=this._audioPool;for(var e in t){var i=t[e];for(var n=0;n<t[e].length;n++){i[n].stop()}}},unloadEffect:function(t){if(!t){return}cc.loader.release(t);var e=this._audioPool[t];if(e)e.length=0;delete this._audioPool[t];delete o.cache[t]},end:function(){this.stopMusic();this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;if(t&&t.getPlaying()){t.pause();this._pauseCache.push(t)}var e=this._audioPool;for(var i in e){var n=e[i];for(var r=0;r<e[i].length;r++){if(n[r].getPlaying()){n[r].pause();this._pauseCache.push(n[r])}}}},_resumePlaying:function(){var t=this._pauseCache;for(var e=0;e<t.length;e++){t[e].resume()}t.length=0}};if(!n){var c=function(){var e=cc.audioEngine._currMusic;if(e&&e._touch===false&&e._playing&&e.getPlaying()){e._touch=true;e.play(0,e.loop);!t.REPLAY_AFTER_TOUCH&&cc._canvas.removeEventListener("touchstart",c)}};setTimeout(function(){if(cc._canvas){cc._canvas.addEventListener("touchstart",c,false)}},150)}})(window.__audioSupport);cc._globalFontSize=cc.ITEM_SIZE;cc._globalFontName="Arial";cc._globalFontNameRelease=false;cc.MenuItem=cc.Node.extend({_enabled:false,_target:null,_callback:null,_isSelected:false,_className:"MenuItem",ctor:function(t,e){var i=cc.Node.prototype;i.ctor.call(this);this._target=null;this._callback=null;this._isSelected=false;this._enabled=false;i.setAnchorPoint.call(this,.5,.5);this._target=e||null;this._callback=t||null;if(this._callback){this._enabled=true}},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},setTarget:function(t,e){this._target=e;this._callback=t},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},initWithCallback:function(t,e){this.anchorX=.5;this.anchorY=.5;this._target=e;this._callback=t;this._enabled=true;this._isSelected=false;return true},rect:function(){var t=this._position,e=this._contentSize,i=this._anchorPoint;return cc.rect(t.x-e.width*i.x,t.y-e.height*i.y,e.width,e.height)},selected:function(){this._isSelected=true},unselected:function(){this._isSelected=false},setCallback:function(t,e){this._target=e;this._callback=t},activate:function(){if(this._enabled){var t=this._target,e=this._callback;if(!e)return;if(t&&cc.isString(e)){t[e](this)}else if(t&&cc.isFunction(e)){e.call(t,this)}else e(this)}}});var _p=cc.MenuItem.prototype;_p.enabled;cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);cc.MenuItem.create=function(t,e){return new cc.MenuItem(t,e)};cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(t,e,i){cc.MenuItem.prototype.ctor.call(this,e,i);this._disabledColor=null;this._label=null;this._colorBackup=null;if(t){this._originalScale=1;this._colorBackup=cc.color.WHITE;this._disabledColor=cc.color(126,126,126);this.setLabel(t);this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true)}},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getLabel:function(){return this._label},setLabel:function(t){if(t){this.addChild(t);t.anchorX=0;t.anchorY=0;this.width=t.width;this.height=t.height;t.setCascadeColorEnabled(true)}if(this._label){this.removeChild(this._label,true)}this._label=t},setEnabled:function(t){if(this._enabled!==t){if(!t){this._colorBackup=this.color;this.setColor(this._disabledColor)}else{this.setColor(this._colorBackup)}}cc.MenuItem.prototype.setEnabled.call(this,t)},initWithLabel:function(t,e,i){this.initWithCallback(e,i);this._originalScale=1;this._colorBackup=cc.color.WHITE;this._disabledColor=cc.color(126,126,126);this.setLabel(t);this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true);return true},setString:function(t){this._label.string=t;this.width=this._label.width;this.height=this._label.height},getString:function(){return this._label.string},activate:function(){if(this._enabled){this.stopAllActions();this.scale=this._originalScale;cc.MenuItem.prototype.activate.call(this)}},selected:function(){if(this._enabled){cc.MenuItem.prototype.selected.call(this);var t=this.getActionByTag(cc.ZOOM_ACTION_TAG);if(t)this.stopAction(t);else this._originalScale=this.scale;var e=cc.scaleTo(.1,this._originalScale*1.2);e.setTag(cc.ZOOM_ACTION_TAG);this.runAction(e)}},unselected:function(){if(this._enabled){cc.MenuItem.prototype.unselected.call(this);this.stopActionByTag(cc.ZOOM_ACTION_TAG);var t=cc.scaleTo(.1,this._originalScale);t.setTag(cc.ZOOM_ACTION_TAG);this.runAction(t)}}});var _p=cc.MenuItemLabel.prototype;_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.disabledColor;cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor);_p.label;cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel);cc.MenuItemLabel.create=function(t,e,i){return new cc.MenuItemLabel(t,e,i)};cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({ctor:function(t,e,i,n,r,s,a){var o;if(t&&t.length>0){o=new cc.LabelAtlas(t,e,i,n,r)}cc.MenuItemLabel.prototype.ctor.call(this,o,s,a)},initWithString:function(t,e,i,n,r,s,a){if(!t||t.length===0)throw new Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0");var o=new cc.LabelAtlas;o.initWithString(t,e,i,n,r);if(this.initWithLabel(o,s,a)){}return true}});cc.MenuItemAtlasFont.create=function(t,e,i,n,r,s,a){return new cc.MenuItemAtlasFont(t,e,i,n,r,s,a)};cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(t,e,i){var n;if(t&&t.length>0){this._fontName=cc._globalFontName;this._fontSize=cc._globalFontSize;n=new cc.LabelTTF(t,this._fontName,this._fontSize)}else{this._fontSize=0;this._fontName=""}cc.MenuItemLabel.prototype.ctor.call(this,n,e,i)},initWithString:function(t,e,i){if(!t||t.length===0)throw new Error("Value should be non-null and its length should be greater than 0");this._fontName=cc._globalFontName;this._fontSize=cc._globalFontSize;var n=new cc.LabelTTF(t,this._fontName,this._fontSize);if(this.initWithLabel(n,e,i)){}return true},setFontSize:function(t){this._fontSize=t;this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t;this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var t=new cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(t)}});cc.MenuItemFont.setFontSize=function(t){cc._globalFontSize=t};cc.MenuItemFont.fontSize=function(){return cc._globalFontSize};cc.MenuItemFont.setFontName=function(t){if(cc._globalFontNameRelease){cc._globalFontName=""}cc._globalFontName=t;cc._globalFontNameRelease=true};var _p=cc.MenuItemFont.prototype;_p.fontSize;cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);cc.MenuItemFont.fontName=function(){return cc._globalFontName};cc.MenuItemFont.create=function(t,e,i){return new cc.MenuItemFont(t,e,i)};cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(t,e,i,n,r){cc.MenuItem.prototype.ctor.call(this);this._normalImage=null;this._selectedImage=null;this._disabledImage=null;if(e!==undefined){var s,a,o;if(r!==undefined){s=i;o=n;a=r}else if(n!==undefined&&cc.isFunction(n)){s=i;o=n}else if(n!==undefined&&cc.isFunction(i)){a=n;o=i;s=null}else if(i===undefined){s=null}this.initWithNormalSprite(t,e,s,o,a)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(t){if(this._normalImage===t){return}if(t){this.addChild(t,0,cc.NORMAL_TAG);t.anchorX=0;t.anchorY=0}if(this._normalImage){this.removeChild(this._normalImage,true)}this._normalImage=t;if(!this._normalImage)return;this.width=this._normalImage.width;this.height=this._normalImage.height;this._updateImagesVisibility();if(t.textureLoaded&&!t.textureLoaded()){t.addEventListener("load",function(t){this.width=t.width;this.height=t.height},this)}},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(t){if(this._selectedImage===t)return;if(t){this.addChild(t,0,cc.SELECTED_TAG);t.anchorX=0;t.anchorY=0}if(this._selectedImage){this.removeChild(this._selectedImage,true)}this._selectedImage=t;this._updateImagesVisibility()},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(t){if(this._disabledImage===t)return;if(t){this.addChild(t,0,cc.DISABLE_TAG);t.anchorX=0;t.anchorY=0}if(this._disabledImage)this.removeChild(this._disabledImage,true);this._disabledImage=t;this._updateImagesVisibility()},initWithNormalSprite:function(t,e,i,n,r){this.initWithCallback(n,r);this.setNormalImage(t);this.setSelectedImage(e);this.setDisabledImage(i);var s=this._normalImage;if(s){this.width=s.width;this.height=s.height;if(s.textureLoaded&&!s.textureLoaded()){s.addEventListener("load",function(t){this.width=t.width;this.height=t.height;this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true)},this)}}this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true);return true},selected:function(){cc.MenuItem.prototype.selected.call(this);if(this._normalImage){if(this._disabledImage)this._disabledImage.visible=false;if(this._selectedImage){this._normalImage.visible=false;this._selectedImage.visible=true}else this._normalImage.visible=true}},unselected:function(){cc.MenuItem.prototype.unselected.call(this);if(this._normalImage){this._normalImage.visible=true;if(this._selectedImage)this._selectedImage.visible=false;if(this._disabledImage)this._disabledImage.visible=false}},setEnabled:function(t){if(this._enabled!==t){cc.MenuItem.prototype.setEnabled.call(this,t);this._updateImagesVisibility()}},_updateImagesVisibility:function(){var t=this._normalImage,e=this._selectedImage,i=this._disabledImage;if(this._enabled){if(t)t.visible=true;if(e)e.visible=false;if(i)i.visible=false}else{if(i){if(t)t.visible=false;if(e)e.visible=false;if(i)i.visible=true}else{if(t)t.visible=true;if(e)e.visible=false}}}});var _p=cc.MenuItemSprite.prototype;_p.normalImage;cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage);_p.selectedImage;cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage);_p.disabledImage;cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage);cc.MenuItemSprite.create=function(t,e,i,n,r){return new cc.MenuItemSprite(t,e,i,n,r||undefined)};cc.MenuItemImage=cc.MenuItemSprite.extend({ctor:function(t,e,i,n,r){var s=null,a=null,o=null,c=null,l=null;if(t===undefined||t===null){cc.MenuItemSprite.prototype.ctor.call(this)}else{s=new cc.Sprite(t);e&&(a=new cc.Sprite(e));if(n===undefined){c=i}else if(r===undefined){c=i;l=n}else if(r){o=new cc.Sprite(i);c=n;l=r}cc.MenuItemSprite.prototype.ctor.call(this,s,a,o,c,l)}},setNormalSpriteFrame:function(t){this.setNormalImage(new cc.Sprite(t))},setSelectedSpriteFrame:function(t){this.setSelectedImage(new cc.Sprite(t))},setDisabledSpriteFrame:function(t){this.setDisabledImage(new cc.Sprite(t))},initWithNormalImage:function(t,e,i,n,r){var s=null;var a=null;var o=null;if(t){s=new cc.Sprite(t)}if(e){a=new cc.Sprite(e)}if(i){o=new cc.Sprite(i)}return this.initWithNormalSprite(s,a,o,n,r)}});cc.MenuItemImage.create=function(t,e,i,n,r){return new cc.MenuItemImage(t,e,i,n,r)};cc.MenuItemToggle=cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this);this._selectedIndex=0;this.subItems=[];this._opacity=0;this._color=cc.color.WHITE;if(arguments.length>0)this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(t){this._opacity=t;if(this.subItems&&this.subItems.length>0){for(var e=0;e<this.subItems.length;e++){this.subItems[e].opacity=t}}this._color.a=t},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;e.r=t.r;e.g=t.g;e.b=t.b;if(this.subItems&&this.subItems.length>0){for(var i=0;i<this.subItems.length;i++){this.subItems[i].setColor(t)}}if(t.a!==undefined&&!t.a_undefined){this.setOpacity(t.a)}},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(t){if(t!==this._selectedIndex){this._selectedIndex=t;var e=this.getChildByTag(cc.CURRENT_ITEM);if(e)e.removeFromParent(false);var i=this.subItems[this._selectedIndex];this.addChild(i,0,cc.CURRENT_ITEM);var n=i.width,r=i.height;this.width=n;this.height=r;i.setPosition(n/2,r/2)}},getSubItems:function(){return this.subItems},setSubItems:function(t){this.subItems=t},initWithItems:function(t){var e=t.length;if(cc.isFunction(t[t.length-2])){this.initWithCallback(t[t.length-2],t[t.length-1]);e=e-2}else if(cc.isFunction(t[t.length-1])){this.initWithCallback(t[t.length-1],null);e=e-1}else{this.initWithCallback(null,null)}var i=this.subItems;i.length=0;for(var n=0;n<e;n++){if(t[n])i.push(t[n])}this._selectedIndex=cc.UINT_MAX;this.setSelectedIndex(0);this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true);return true},addSubItem:function(t){this.subItems.push(t)},activate:function(){if(this._enabled){var t=(this._selectedIndex+1)%this.subItems.length;this.setSelectedIndex(t)}cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this);this.subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this);this.subItems[this._selectedIndex].unselected()},setEnabled:function(t){if(this._enabled!==t){cc.MenuItem.prototype.setEnabled.call(this,t);var e=this.subItems;if(e&&e.length>0){for(var i=0;i<e.length;i++)e[i].enabled=t}}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.setSelectedIndex(this._selectedIndex)}});var _p=cc.MenuItemToggle.prototype;_p.selectedIndex;cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex);cc.MenuItemToggle.create=function(){if(arguments.length>0&&arguments[arguments.length-1]==null)cc.log("parameters should not be ending with null in Javascript");var t=new cc.MenuItemToggle;t.initWithItems(Array.prototype.slice.apply(arguments));return t};cc.MENU_STATE_WAITING=0;cc.MENU_STATE_TRACKING_TOUCH=1;cc.MENU_HANDLER_PRIORITY=-128;cc.DEFAULT_PADDING=5;cc.Menu=cc.Layer.extend({enabled:false,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(t){cc.Layer.prototype.ctor.call(this);this._color=cc.color.WHITE;this.enabled=false;this._opacity=255;this._selectedItem=null;this._state=-1;this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled});if(arguments.length>0&&arguments[arguments.length-1]==null)cc.log("parameters should not be ending with null in Javascript");var e=arguments.length,i;if(e===0){i=[]}else if(e===1){if(t instanceof Array){i=t}else i=[t]}else if(e>1){i=[];for(var n=0;n<e;n++){if(arguments[n])i.push(arguments[n])}}this.initWithArray(i)},onEnter:function(){var t=this._touchListener;if(!t._isRegistered())cc.eventManager.addListener(t,this);cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled=t},initWithItems:function(t){var e=[];if(t){for(var i=0;i<t.length;i++){if(t[i])e.push(t[i])}}return this.initWithArray(e)},initWithArray:function(t){if(cc.Layer.prototype.init.call(this)){this.enabled=true;var e=cc.winSize;this.setPosition(e.width/2,e.height/2);this.setContentSize(e);this.setAnchorPoint(.5,.5);this.ignoreAnchorPointForPosition(true);if(t){for(var i=0;i<t.length;i++)this.addChild(t[i],i)}this._selectedItem=null;this._state=cc.MENU_STATE_WAITING;this.cascadeColor=true;this.cascadeOpacity=true;return true}return false},addChild:function(t,e,i){if(!(t instanceof cc.MenuItem))throw new Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children");cc.Layer.prototype.addChild.call(this,t,e,i)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e=-t,i=this._children,n,r,s,a,o;if(i&&i.length>0){for(r=0,n=i.length;r<n;r++)e+=i[r].height*i[r].scaleY+t;var c=e/2;for(r=0,n=i.length;r<n;r++){o=i[r];a=o.height;s=o.scaleY;o.setPosition(0,c-a*s/2);c-=a*s+t}}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e=-t,i=this._children,n,r,s,a,o;if(i&&i.length>0){for(n=0,r=i.length;n<r;n++)e+=i[n].width*i[n].scaleX+t;var c=-e/2;for(n=0,r=i.length;n<r;n++){o=i[n];s=o.scaleX;a=i[n].width;o.setPosition(c+a*s/2,0);c+=a*s+t}}},alignItemsInColumns:function(){if(arguments.length>0&&arguments[arguments.length-1]==null)cc.log("parameters should not be ending with null in Javascript");var t=[];for(var e=0;e<arguments.length;e++){t.push(arguments[e])}var i=-5;var n=0;var r=0;var s=0;var a,o,c;var l=this._children;if(l&&l.length>0){for(e=0,c=l.length;e<c;e++){if(n>=t.length)continue;a=t[n];if(!a)continue;o=l[e].height;r=r>=o||isNaN(o)?r:o;++s;if(s>=a){i+=r+5;s=0;r=0;++n}}}var h=cc.director.getWinSize();n=0;r=0;a=0;var u=0;var d=0;var _=i/2;if(l&&l.length>0){for(e=0,c=l.length;e<c;e++){var f=l[e];if(a===0){a=t[n];u=h.width/(1+a);d=u}o=f._getHeight();r=r>=o||isNaN(o)?r:o;f.setPosition(d-h.width/2,_-o/2);d+=u;++s;if(s>=a){_-=r+5;s=0;a=0;r=0;++n}}}},alignItemsInRows:function(){if(arguments.length>0&&arguments[arguments.length-1]==null)cc.log("parameters should not be ending with null in Javascript");var t=[],e;for(e=0;e<arguments.length;e++){t.push(arguments[e])}var i=[];var n=[];var r=-10;var s=-5;var a=0;var o=0;var c=0;var l,h,u,d;var _=this._children;if(_&&_.length>0){for(e=0,u=_.length;e<u;e++){h=_[e];if(a>=t.length)continue;l=t[a];if(!l)continue;d=h.width;o=o>=d||isNaN(d)?o:d;s+=h.height+5;++c;if(c>=l){i.push(o);n.push(s);r+=o+10;c=0;o=0;s=-5;++a}}}var f=cc.director.getWinSize();a=0;o=0;l=0;var p=-r/2;var m=0;if(_&&_.length>0){for(e=0,u=_.length;e<u;e++){h=_[e];if(l===0){l=t[a];m=n[a]}d=h._getWidth();o=o>=d||isNaN(d)?o:d;h.setPosition(p+i[a]/2,m-f.height/2);m-=h.height+10;++c;if(c>=l){p+=o+5;c=0;l=0;o=0;++a}}}},removeChild:function(t,e){if(t==null)return;if(!(t instanceof cc.MenuItem)){cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children");return}if(this._selectedItem===t)this._selectedItem=null;cc.Node.prototype.removeChild.call(this,t,e)},_onTouchBegan:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_WAITING||!i._visible||!i.enabled)return false;for(var n=i.parent;n!=null;n=n.parent){if(!n.isVisible())return false}i._selectedItem=i._itemForTouch(t);if(i._selectedItem){i._state=cc.MENU_STATE_TRACKING_TOUCH;i._selectedItem.selected();i._selectedItem.setNodeDirty();return true}return false},_onTouchEnded:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchEnded(): invalid state");return}if(i._selectedItem){i._selectedItem.unselected();i._selectedItem.setNodeDirty();i._selectedItem.activate()}i._state=cc.MENU_STATE_WAITING},_onTouchCancelled:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchCancelled(): invalid state");return}if(i._selectedItem){i._selectedItem.unselected();i._selectedItem.setNodeDirty()}i._state=cc.MENU_STATE_WAITING},_onTouchMoved:function(t,e){var i=e.getCurrentTarget();if(i._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchMoved(): invalid state");return}var n=i._itemForTouch(t);if(n!==i._selectedItem){if(i._selectedItem){i._selectedItem.unselected();i._selectedItem.setNodeDirty()}i._selectedItem=n;if(i._selectedItem){i._selectedItem.selected();i._selectedItem.setNodeDirty()}}},onExit:function(){if(this._state===cc.MENU_STATE_TRACKING_TOUCH){if(this._selectedItem){this._selectedItem.unselected();this._selectedItem=null}this._state=cc.MENU_STATE_WAITING}cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},_itemForTouch:function(t){var e=t.getLocation();var i=this._children,n;if(i&&i.length>0){for(var r=i.length-1;r>=0;r--){n=i[r];if(n.isVisible()&&n.isEnabled()){var s=n.convertToNodeSpace(e);var a=n.rect();a.x=0;a.y=0;if(cc.rectContainsPoint(a,s))return n}}}return null}});var _p=cc.Menu.prototype;_p.enabled;cc.Menu.create=function(t){var e=arguments.length;if(e>0&&arguments[e-1]==null)cc.log("parameters should not be ending with null in Javascript");var i;if(e===0)i=new cc.Menu;else if(e===1)i=new cc.Menu(t);else i=new cc.Menu(Array.prototype.slice.call(arguments,0));return i};cc.math=cc.math||{};cc.math.EPSILON=1/64;cc.math.square=function(t){return t*t};cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e};(function(t){t.math.Vec2=function(t,e){if(e===undefined){this.x=t.x;this.y=t.y}else{this.x=t||0;this.y=e||0}};var e=t.math.Vec2.prototype;e.fill=function(t,e){this.x=t;this.y=e};e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))};e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)};e.normalize=function(){var t=1/this.length();this.x*=t;this.y*=t;return this};t.math.Vec2.add=function(t,e,i){t.x=e.x+i.x;t.y=e.y+i.y;return t};e.add=function(t){this.x+=t.x;this.y+=t.y;return this};e.dot=function(t){return this.x*t.x+this.y*t.y};t.math.Vec2.subtract=function(t,e,i){t.x=e.x-i.x;t.y=e.y-i.y;return t};e.subtract=function(t){this.x-=t.x;this.y-=t.y;return this};e.transform=function(t){var e=this.x,i=this.y;this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6];this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7];return this};t.math.Vec2.scale=function(t,e,i){t.x=e.x*i;t.y=e.y*i;return t};e.scale=function(t){this.x*=t;this.y*=t;return this};e.equals=function(e){return this.x<e.x+t.math.EPSILON&&this.x>e.x-t.math.EPSILON&&(this.y<e.y+t.math.EPSILON&&this.y>e.y-t.math.EPSILON)}})(cc);(function(t){t.kmVec3=t.math.Vec3=function(t,e,i){if(t&&e===undefined){this.x=t.x;this.y=t.y;this.z=t.z}else{this.x=t||0;this.y=e||0;this.z=i||0}};t.math.vec3=function(e,i,n){return new t.math.Vec3(e,i,n)};var e=t.math.Vec3.prototype;e.fill=function(t,e,i){if(t&&e===undefined){this.x=t.x;this.y=t.y;this.z=t.z}else{this.x=t;this.y=e;this.z=i}return this};e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))};e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)};e.normalize=function(){var t=1/this.length();this.x*=t;this.y*=t;this.z*=t;return this};e.cross=function(t){var e=this.x,i=this.y,n=this.z;this.x=i*t.z-n*t.y;this.y=n*t.x-e*t.z;this.z=e*t.y-i*t.x;return this};e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};e.add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;return this};e.subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;return this};e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;this.x=e*r[0]+i*r[4]+n*r[8]+r[12];this.y=e*r[1]+i*r[5]+n*r[9]+r[13];this.z=e*r[2]+i*r[6]+n*r[10]+r[14];return this};e.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;this.x=e*r[0]+i*r[4]+n*r[8];this.y=e*r[1]+i*r[5]+n*r[9];this.z=e*r[2]+i*r[6]+n*r[10];return this};e.transformCoord=function(e){var i=new t.math.Vec4(this.x,this.y,this.z,1);i.transform(e);this.x=i.x/i.w;this.y=i.y/i.w;this.z=i.z/i.w;return this};e.scale=function(t){this.x*=t;this.y*=t;this.z*=t;return this};e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&(this.y<e.y+i&&this.y>e.y-i)&&(this.z<e.z+i&&this.z>e.z-i)};e.inverseTransform=function(e){var i=e.mat;var n=new t.math.Vec3(this.x-i[12],this.y-i[13],this.z-i[14]);this.x=n.x*i[0]+n.y*i[1]+n.z*i[2];this.y=n.x*i[4]+n.y*i[5]+n.z*i[6];this.z=n.x*i[8]+n.y*i[9]+n.z*i[10];return this};e.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;this.x=e*r[0]+i*r[1]+n*r[2];this.y=e*r[4]+i*r[5]+n*r[6];this.z=e*r[8]+i*r[9]+n*r[10];return this};e.assignFrom=function(t){if(!t)return this;this.x=t.x;this.y=t.y;this.z=t.z;return this};t.math.Vec3.zero=function(t){t.x=t.y=t.z=0;return t};e.toTypeArray=function(){var t=new Float32Array(3);t[0]=this.x;t[1]=this.y;t[2]=this.z;return t}})(cc);(function(t){t.math.Vec4=function(t,e,i,n){
if(t&&e===undefined){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w}else{this.x=t||0;this.y=e||0;this.z=i||0;this.w=n||0}};t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(t,e,i,n){if(t&&e===undefined){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w}else{this.x=t;this.y=e;this.z=i;this.w=n}};e.add=function(t){if(!t)return this;this.x+=t.x;this.y+=t.y;this.z+=t.z;this.w+=t.w;return this};e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w};e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))};e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)};e.lerp=function(t,e){return this};e.normalize=function(){var t=1/this.length();this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this};e.scale=function(t){this.normalize();this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this};e.subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;this.w-=t.w};e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.mat;this.x=e*s[0]+i*s[4]+n*s[8]+r*s[12];this.y=e*s[1]+i*s[5]+n*s[9]+r*s[13];this.z=e*s[2]+i*s[6]+n*s[10]+r*s[14];this.w=e*s[3]+i*s[7]+n*s[11]+r*s[15];return this};t.math.Vec4.transformArray=function(e,i){var n=[];for(var r=0;r<e.length;r++){var s=new t.math.Vec4(e[r]);s.transform(i);n.push(s)}return n};e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&(this.y<e.y+i&&this.y>e.y-i)&&(this.z<e.z+i&&this.z>e.z-i)&&(this.w<e.w+i&&this.w>e.w-i)};e.assignFrom=function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;return this};e.toTypeArray=function(){var t=new Float32Array(4);t[0]=this.x;t[1]=this.y;t[2]=this.z;t[3]=this.w;return t}})(cc);(function(t){t.math.Ray2=function(e,i){this.start=e||new t.math.Vec2;this.dir=i||new t.math.Vec2};t.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t;this.start.y=e;this.dir.x=i;this.dir.y=n};t.math.Ray2.prototype.intersectLineSegment=function(e,i,n){var r=this.start.x,s=this.start.y;var a=this.start.x+this.dir.x,o=this.start.y+this.dir.y;var c=e.x,l=e.y;var h=i.x,u=i.y;var d=(u-l)*(a-r)-(h-c)*(o-s);var _,f,p;if(d>-t.math.EPSILON&&d<t.math.EPSILON)return false;_=((h-c)*(s-l)-(u-l)*(r-c))/d;f=r+_*(a-r);p=s+_*(o-s);if(f<Math.min(e.x,i.x)-t.math.EPSILON||f>Math.max(e.x,i.x)+t.math.EPSILON||p<Math.min(e.y,i.y)-t.math.EPSILON||p>Math.max(e.y,i.y)+t.math.EPSILON){return false}if(f<Math.min(r,a)-t.math.EPSILON||f>Math.max(r,a)+t.math.EPSILON||p<Math.min(s,o)-t.math.EPSILON||p>Math.max(s,o)+t.math.EPSILON){return false}n.x=f;n.y=p;return true};function e(e,i,n){var r=new t.math.Vec2(i);r.subtract(e);n.x=-r.y;n.y=r.x;n.normalize()}t.math.Ray2.prototype.intersectTriangle=function(i,n,r,s,a){var o=new t.math.Vec2,c=new t.math.Vec2;var l=new t.math.Vec2,h=1e4,u=false;var d;if(this.intersectLineSegment(i,n,o)){u=true;d=o.subtract(this.start).length();if(d<h){c.x=o.x;c.y=o.y;h=d;e(i,n,l)}}if(this.intersectLineSegment(n,r,o)){u=true;d=o.subtract(this.start).length();if(d<h){c.x=o.x;c.y=o.y;h=d;e(n,r,l)}}if(this.intersectLineSegment(r,i,o)){u=true;d=o.subtract(this.start).length();if(d<h){c.x=o.x;c.y=o.y;h=d;e(r,i,l)}}if(u){s.x=c.x;s.y=c.y;if(a){a.x=l.x;a.y=l.y}}return u}})(cc);window.Uint16Array=window.Uint16Array||window.Array;window.Float32Array=window.Float32Array||window.Array;(function(t){t.math.Matrix3=function(t){if(t&&t.mat){this.mat=new Float32Array(t.mat)}else{this.mat=new Float32Array(9)}};t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(t){var e=this.mat,i=t.mat;e[0]=i[0];e[1]=i[1];e[2]=i[2];e[3]=i[3];e[4]=i[4];e[5]=i[5];e[6]=i[6];e[7]=i[7];e[8]=i[8];return this};e.adjugate=function(){var t=this.mat;var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8];t[0]=s*l-a*c;t[1]=n*c-i*l;t[2]=i*a-n*s;t[3]=a*o-r*l;t[4]=e*l-n*o;t[5]=n*r-e*a;t[6]=r*c-s*o;t[8]=e*s-i*r;return this};e.identity=function(){var t=this.mat;t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0;t[0]=t[4]=t[8]=1;return this};var i=new t.math.Matrix3;e.inverse=function(t){if(t===0)return this;i.assignFrom(this);var e=1/t;this.adjugate();this.multiplyScalar(e);return this};e.isIdentity=function(){var t=this.mat;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===1&&t[5]===0&&t[6]===0&&t[7]===0&&t[8]===1};e.transpose=function(){var t=this.mat;var e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],a=t[7];t[1]=n;t[2]=s;t[3]=e;t[5]=a;t[6]=i;t[7]=r;return this};e.determinant=function(){var t=this.mat;var e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8];return e};e.multiply=function(t){var e=this.mat,i=t.mat;var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],u=e[8];var d=i[0],_=i[1],f=i[2],p=i[3],m=i[4],g=i[5],v=i[6],y=i[7],T=i[8];e[0]=n*d+a*_+l*f;e[1]=r*d+o*_+h*f;e[2]=s*d+c*_+u*f;e[3]=s*d+c*_+u*f;e[4]=r*p+o*m+h*g;e[5]=s*p+c*m+u*g;e[6]=n*v+a*y+l*T;e[7]=r*v+o*y+h*T;e[8]=s*v+c*y+u*T;return this};e.multiplyScalar=function(t){var e=this.mat;e[0]*=t;e[1]*=t;e[2]*=t;e[3]*=t;e[4]*=t;e[5]*=t;e[6]*=t;e[7]*=t;e[8]*=t;return this};t.math.Matrix3.rotationAxisAngle=function(e,i){var n=Math.cos(i),r=Math.sin(i);var s=new t.math.Matrix3;var a=s.mat;a[0]=n+e.x*e.x*(1-n);a[1]=e.z*r+e.y*e.x*(1-n);a[2]=-e.y*r+e.z*e.x*(1-n);a[3]=-e.z*r+e.x*e.y*(1-n);a[4]=n+e.y*e.y*(1-n);a[5]=e.x*r+e.z*e.y*(1-n);a[6]=e.y*r+e.x*e.z*(1-n);a[7]=-e.x*r+e.y*e.z*(1-n);a[8]=n+e.z*e.z*(1-n);return s};e.assignFrom=function(e){if(this===e){t.log("cc.math.Matrix3.assign(): current matrix equals matIn");return this}var i=this.mat,n=e.mat;i[0]=n[0];i[1]=n[1];i[2]=n[2];i[3]=n[3];i[4]=n[4];i[5]=n[5];i[6]=n[6];i[7]=n[7];i[8]=n[8];return this};e.equals=function(e){if(this===e)return true;var i=t.math.EPSILON,n=this.mat,r=e.mat;for(var s=0;s<9;++s){if(!(n[s]+i>r[s]&&n[s]-i<r[s]))return false}return true};t.math.Matrix3.createByRotationX=function(e){var i=new t.math.Matrix3,n=i.mat;n[0]=1;n[1]=0;n[2]=0;n[3]=0;n[4]=Math.cos(e);n[5]=Math.sin(e);n[6]=0;n[7]=-Math.sin(e);n[8]=Math.cos(e);return i};t.math.Matrix3.createByRotationY=function(e){var i=new t.math.Matrix3,n=i.mat;n[0]=Math.cos(e);n[1]=0;n[2]=-Math.sin(e);n[3]=0;n[4]=1;n[5]=0;n[6]=Math.sin(e);n[7]=0;n[8]=Math.cos(e);return i};t.math.Matrix3.createByRotationZ=function(e){var i=new t.math.Matrix3,n=i.mat;n[0]=Math.cos(e);n[1]=-Math.sin(e);n[2]=0;n[3]=Math.sin(e);n[4]=Math.cos(e);n[5]=0;n[6]=0;n[7]=0;n[8]=1;return i};t.math.Matrix3.createByRotation=function(e){var i=new t.math.Matrix3,n=i.mat;n[0]=Math.cos(e);n[1]=Math.sin(e);n[2]=0;n[3]=-Math.sin(e);n[4]=Math.cos(e);n[5]=0;n[6]=0;n[7]=0;n[8]=1;return i};t.math.Matrix3.createByScale=function(e,i){var n=new t.math.Matrix3;n.identity();n.mat[0]=e;n.mat[4]=i;return n};t.math.Matrix3.createByTranslation=function(e,i){var n=new t.math.Matrix3;n.identity();n.mat[6]=e;n.mat[7]=i;return n};t.math.Matrix3.createByQuaternion=function(e){if(!e)return null;var i=new t.math.Matrix3,n=i.mat;n[0]=1-2*(e.y*e.y+e.z*e.z);n[1]=2*(e.x*e.y-e.w*e.z);n[2]=2*(e.x*e.z+e.w*e.y);n[3]=2*(e.x*e.y+e.w*e.z);n[4]=1-2*(e.x*e.x+e.z*e.z);n[5]=2*(e.y*e.z-e.w*e.x);n[6]=2*(e.x*e.z-e.w*e.y);n[7]=2*(e.y*e.z+e.w*e.x);n[8]=1-2*(e.x*e.x+e.y*e.y);return i};e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}})(cc);(function(t){t.math.Matrix4=function(t){if(t&&t.mat){this.mat=new Float32Array(t.mat)}else{this.mat=new Float32Array(16)}};t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(t){var e=this.mat;for(var i=0;i<16;i++){e[i]=t[i]}return this};t.kmMat4Identity=function(t){var e=t.mat;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0;e[0]=e[5]=e[10]=e[15]=1;return t};e.identity=function(){var t=this.mat;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0;t[0]=t[5]=t[10]=t[15]=1;return this};e.get=function(t,e){return this.mat[t+4*e]};e.set=function(t,e,i){this.mat[t+4*e]=i};e.swap=function(t,e,i,n){var r=this.mat,s=r[t+4*e];r[t+4*e]=r[i+4*n];r[i+4*n]=s};t.math.Matrix4._gaussj=function(t,e){var i,n=0,r=0,s,a,o,c,l=4,h=4,u;var d,_,f;var p=[0,0,0,0],m=[0,0,0,0],g=[0,0,0,0];for(i=0;i<l;i++){d=0;for(s=0;s<l;s++){if(g[s]!==1){for(a=0;a<l;a++){if(g[a]===0){u=Math.abs(t.get(s,a));if(u>=d){d=u;r=s;n=a}}}}}++g[n];if(r!==n){for(o=0;o<l;o++)t.swap(r,o,n,o);for(o=0;o<h;o++)e.swap(r,o,n,o)}m[i]=r;p[i]=n;if(t.get(n,n)===0)return false;f=1/t.get(n,n);t.set(n,n,1);for(o=0;o<l;o++)t.set(n,o,t.get(n,o)*f);for(o=0;o<h;o++)e.set(n,o,e.get(n,o)*f);for(c=0;c<l;c++){if(c!==n){_=t.get(c,n);t.set(c,n,0);for(o=0;o<l;o++)t.set(c,o,t.get(c,o)-t.get(n,o)*_);for(o=0;o<h;o++)e.set(c,o,t.get(c,o)-e.get(n,o)*_)}}}for(o=l-1;o>=0;o--){if(m[o]!==p[o]){for(a=0;a<l;a++)t.swap(a,m[o],a,p[o])}}return true};var i=(new t.math.Matrix4).identity();t.kmMat4Inverse=function(e,n){var r=new t.math.Matrix4(n);var s=new t.math.Matrix4(i);if(t.math.Matrix4._gaussj(r,s)===false)return null;e.assignFrom(r);return e};e.inverse=function(){var e=new t.math.Matrix4(this);var n=new t.math.Matrix4(i);if(t.math.Matrix4._gaussj(e,n)===false)return null;return e};e.isIdentity=function(){var t=this.mat;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1};e.transpose=function(){var t=this.mat;var e=t[1],i=t[2],n=t[3],r=t[4],s=t[6],a=t[7],o=t[8],c=t[9],l=t[11],h=t[12],u=t[13],d=t[14];t[1]=r;t[2]=o;t[3]=h;t[4]=e;t[6]=c;t[7]=u;t[8]=i;t[9]=s;t[11]=d;t[12]=n;t[13]=a;t[14]=l;return this};t.kmMat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,s=i.mat;var a=r[0],o=r[1],c=r[2],l=r[3];var h=r[4],u=r[5],d=r[6],_=r[7];var f=r[8],p=r[9],m=r[10],g=r[11];var v=r[12],y=r[13],T=r[14],C=r[15];var S=s[0],x=s[1],E=s[2],b=s[3];var A=s[4],R=s[5],P=s[6],w=s[7];var I=s[8],D=s[9],L=s[10],O=s[11];var B=s[12],F=s[13],N=s[14],M=s[15];n[0]=S*a+x*h+E*f+b*v;n[1]=S*o+x*u+E*p+b*y;n[2]=S*c+x*d+E*m+b*T;n[3]=S*l+x*_+E*g+b*C;n[4]=A*a+R*h+P*f+w*v;n[5]=A*o+R*u+P*p+w*y;n[6]=A*c+R*d+P*m+w*T;n[7]=A*l+R*_+P*g+w*C;n[8]=I*a+D*h+L*f+O*v;n[9]=I*o+D*u+L*p+O*y;n[10]=I*c+D*d+L*m+O*T;n[11]=I*l+D*_+L*g+O*C;n[12]=B*a+F*h+N*f+M*v;n[13]=B*o+F*u+N*p+M*y;n[14]=B*c+F*d+N*m+M*T;n[15]=B*l+F*_+N*g+M*C;return t};e.multiply=function(t){var e=this.mat,i=t.mat;var n=e[0],r=e[1],s=e[2],a=e[3];var o=e[4],c=e[5],l=e[6],h=e[7];var u=e[8],d=e[9],_=e[10],f=e[11];var p=e[12],m=e[13],g=e[14],v=e[15];var y=i[0],T=i[1],C=i[2],S=i[3];var x=i[4],E=i[5],b=i[6],A=i[7];var R=i[8],P=i[9],w=i[10],I=i[11];var D=i[12],L=i[13],O=i[14],B=i[15];e[0]=y*n+T*o+C*u+S*p;e[1]=y*r+T*c+C*d+S*m;e[2]=y*s+T*l+C*_+S*g;e[3]=y*a+T*h+C*f+S*v;e[4]=x*n+E*o+b*u+A*p;e[5]=x*r+E*c+b*d+A*m;e[6]=x*s+E*l+b*_+A*g;e[7]=x*a+E*h+b*f+A*v;e[8]=R*n+P*o+w*u+I*p;e[9]=R*r+P*c+w*d+I*m;e[10]=R*s+P*l+w*_+I*g;e[11]=R*a+P*h+w*f+I*v;e[12]=D*n+L*o+O*u+B*p;e[13]=D*r+L*c+O*d+B*m;e[14]=D*s+L*l+O*_+B*g;e[15]=D*a+L*h+O*f+B*v;return this};t.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat;var r=new Float32Array(16);r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3];r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3];r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3];r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3];r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7];r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7];r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7];r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7];r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11];r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11];r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11];r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11];r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15];r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15];r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15];r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15];return r};t.kmMat4Assign=function(e,i){if(e===i){t.log("cc.kmMat4Assign(): pOut equals pIn");return e}var n=e.mat;var r=i.mat;n[0]=r[0];n[1]=r[1];n[2]=r[2];n[3]=r[3];n[4]=r[4];n[5]=r[5];n[6]=r[6];n[7]=r[7];n[8]=r[8];n[9]=r[9];n[10]=r[10];n[11]=r[11];n[12]=r[12];n[13]=r[13];n[14]=r[14];n[15]=r[15];return e};e.assignFrom=function(e){if(this===e){t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix");return this}var i=this.mat,n=e.mat;i[0]=n[0];i[1]=n[1];i[2]=n[2];i[3]=n[3];i[4]=n[4];i[5]=n[5];i[6]=n[6];i[7]=n[7];i[8]=n[8];i[9]=n[9];i[10]=n[10];i[11]=n[11];i[12]=n[12];i[13]=n[13];i[14]=n[14];i[15]=n[15];return this};e.equals=function(e){if(this===e){t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object.");return true}var i=this.mat,n=e.mat,r=t.math.EPSILON;for(var s=0;s<16;s++){if(!(i[s]+r>n[s]&&i[s]-r<n[s]))return false}return true};t.math.Matrix4.createByRotationX=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;n[0]=1;n[3]=n[2]=n[1]=0;n[4]=0;n[5]=Math.cos(e);n[6]=Math.sin(e);n[7]=0;n[8]=0;n[9]=-Math.sin(e);n[10]=Math.cos(e);n[11]=0;n[14]=n[13]=n[12]=0;n[15]=1;return i};t.math.Matrix4.createByRotationY=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;n[0]=Math.cos(e);n[1]=0;n[2]=-Math.sin(e);n[3]=0;n[7]=n[6]=n[4]=0;n[5]=1;n[8]=Math.sin(e);n[9]=0;n[10]=Math.cos(e);n[11]=0;n[14]=n[13]=n[12]=0;n[15]=1;return i};t.math.Matrix4.createByRotationZ=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;n[0]=Math.cos(e);n[1]=Math.sin(e);n[3]=n[2]=0;n[4]=-Math.sin(e);n[5]=Math.cos(e);n[7]=n[6]=0;n[11]=n[9]=n[8]=0;n[10]=1;n[14]=n[13]=n[12]=0;n[15]=1;return i};t.math.Matrix4.createByPitchYawRoll=function(e,i,n,r){r=r||new t.math.Matrix4;var s=Math.cos(e),a=Math.sin(e);var o=Math.cos(i),c=Math.sin(i);var l=Math.cos(n),h=Math.sin(n);var u=a*c,d=s*c;var _=r.mat;_[0]=o*l;_[4]=o*h;_[8]=-c;_[1]=u*l-s*h;_[5]=u*h+s*l;_[9]=a*o;_[2]=d*l+a*h;_[6]=d*h-a*l;_[10]=s*o;_[3]=_[7]=_[11]=0;_[15]=1;return r};t.math.Matrix4.createByQuaternion=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;n[0]=1-2*(e.y*e.y+e.z*e.z);n[1]=2*(e.x*e.y+e.z*e.w);n[2]=2*(e.x*e.z-e.y*e.w);n[3]=0;n[4]=2*(e.x*e.y-e.z*e.w);n[5]=1-2*(e.x*e.x+e.z*e.z);n[6]=2*(e.z*e.y+e.x*e.w);n[7]=0;n[8]=2*(e.x*e.z+e.y*e.w);n[9]=2*(e.y*e.z-e.x*e.w);n[10]=1-2*(e.x*e.x+e.y*e.y);n[11]=0;n[14]=n[13]=n[12]=0;n[15]=1;return i};t.math.Matrix4.createByRotationTranslation=function(e,i,n){n=n||new t.math.Matrix4;var r=n.mat,s=e.mat;r[0]=s[0];r[1]=s[1];r[2]=s[2];r[3]=0;r[4]=s[3];r[5]=s[4];r[6]=s[5];r[7]=0;r[8]=s[6];r[9]=s[7];r[10]=s[8];r[11]=0;r[12]=i.x;r[13]=i.y;r[14]=i.z;r[15]=1;return n};t.math.Matrix4.createByScale=function(e,i,n,r){r=r||new t.math.Matrix4;var s=r.mat;s[0]=e;s[5]=i;s[10]=n;s[15]=1;s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0;return r};t.kmMat4Translation=function(t,e,i,n){t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1;t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0;t.mat[12]=e;t.mat[13]=i;t.mat[14]=n;return t};t.math.Matrix4.createByTranslation=function(e,i,n,r){r=r||new t.math.Matrix4;r.identity();r.mat[12]=e;r.mat[13]=i;r.mat[14]=n;return r};e.getUpVec3=function(){var e=this.mat;var i=new t.math.Vec3(e[4],e[5],e[6]);return i.normalize()};e.getRightVec3=function(){var e=this.mat;var i=new t.math.Vec3(e[0],e[1],e[2]);return i.normalize()};e.getForwardVec3=function(){var e=this.mat;var i=new t.math.Vec3(e[8],e[9],e[10]);return i.normalize()};t.kmMat4PerspectiveProjection=function(e,i,n,r,s){var a=t.degreesToRadians(i/2);var o=s-r;var c=Math.sin(a);if(o===0||c===0||n===0)return null;var l=Math.cos(a)/c;e.identity();e.mat[0]=l/n;e.mat[5]=l;e.mat[10]=-(s+r)/o;e.mat[11]=-1;e.mat[14]=-2*r*s/o;e.mat[15]=0;return e};t.math.Matrix4.createPerspectiveProjection=function(e,i,n,r){var s=t.degreesToRadians(e/2),a=r-n;var o=Math.sin(s);if(a===0||o===0||i===0)return null;var c=Math.cos(s)/o;var l=new t.math.Matrix4,h=l.mat;l.identity();h[0]=c/i;h[5]=c;h[10]=-(r+n)/a;h[11]=-1;h[14]=-2*n*r/a;h[15]=0;return l};t.kmMat4OrthographicProjection=function(t,e,i,n,r,s,a){t.identity();t.mat[0]=2/(i-e);t.mat[5]=2/(r-n);t.mat[10]=-2/(a-s);t.mat[12]=-((i+e)/(i-e));t.mat[13]=-((r+n)/(r-n));t.mat[14]=-((a+s)/(a-s));return t};t.math.Matrix4.createOrthographicProjection=function(e,i,n,r,s,a){var o=new t.math.Matrix4,c=o.mat;o.identity();c[0]=2/(i-e);c[5]=2/(r-n);c[10]=-2/(a-s);c[12]=-((i+e)/(i-e));c[13]=-((r+n)/(r-n));c[14]=-((a+s)/(a-s));return o};t.kmMat4LookAt=function(e,i,n,r){var s=new t.math.Vec3(n),a=new t.math.Vec3(r);s.subtract(i);s.normalize();a.normalize();var o=new t.math.Vec3(s);o.cross(a);o.normalize();var c=new t.math.Vec3(o);c.cross(s);o.normalize();e.identity();e.mat[0]=o.x;e.mat[4]=o.y;e.mat[8]=o.z;e.mat[1]=c.x;e.mat[5]=c.y;e.mat[9]=c.z;e.mat[2]=-s.x;e.mat[6]=-s.y;e.mat[10]=-s.z;var l=t.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z);e.multiply(l);return e};var n=new t.math.Matrix4;e.lookAt=function(e,i,r){var s=new t.math.Vec3(i),a=new t.math.Vec3(r),o=this.mat;s.subtract(e);s.normalize();a.normalize();var c=new t.math.Vec3(s);c.cross(a);c.normalize();var l=new t.math.Vec3(c);l.cross(s);c.normalize();this.identity();o[0]=c.x;o[4]=c.y;o[8]=c.z;o[1]=l.x;o[5]=l.y;o[9]=l.z;o[2]=-s.x;o[6]=-s.y;o[10]=-s.z;n=t.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z,n);this.multiply(n);return this};t.kmMat4RotationAxisAngle=function(e,i,n){var r=Math.cos(n),s=Math.sin(n);var a=new t.math.Vec3(i);a.normalize();e.mat[0]=r+a.x*a.x*(1-r);e.mat[1]=a.z*s+a.y*a.x*(1-r);e.mat[2]=-a.y*s+a.z*a.x*(1-r);e.mat[3]=0;e.mat[4]=-a.z*s+a.x*a.y*(1-r);e.mat[5]=r+a.y*a.y*(1-r);e.mat[6]=a.x*s+a.z*a.y*(1-r);e.mat[7]=0;e.mat[8]=a.y*s+a.x*a.z*(1-r);e.mat[9]=-a.x*s+a.y*a.z*(1-r);e.mat[10]=r+a.z*a.z*(1-r);e.mat[11]=0;e.mat[12]=0;e.mat[13]=0;e.mat[14]=0;e.mat[15]=1;return e};t.math.Matrix4.createByAxisAndAngle=function(e,i,n){n=n||new t.math.Matrix4;var r=this.mat,s=Math.cos(i),a=Math.sin(i);var o=new t.math.Vec3(e);o.normalize();r[0]=s+o.x*o.x*(1-s);r[1]=o.z*a+o.y*o.x*(1-s);r[2]=-o.y*a+o.z*o.x*(1-s);r[3]=0;r[4]=-o.z*a+o.x*o.y*(1-s);r[5]=s+o.y*o.y*(1-s);r[6]=o.x*a+o.z*o.y*(1-s);r[7]=0;r[8]=o.y*a+o.x*o.z*(1-s);r[9]=-o.x*a+o.y*o.z*(1-s);r[10]=s+o.z*o.z*(1-s);r[11]=0;r[12]=r[13]=r[14]=0;r[15]=1;return n};e.extractRotation=function(){var e=new t.math.Matrix3,i=this.mat,n=e.mat;n[0]=i[0];n[1]=i[1];n[2]=i[2];n[3]=i[4];n[4]=i[5];n[5]=i[6];n[6]=i[8];n[7]=i[9];n[8]=i[10];return e};e.extractPlane=function(e){var i=new t.math.Plane,n=this.mat;switch(e){case t.math.Plane.RIGHT:i.a=n[3]-n[0];i.b=n[7]-n[4];i.c=n[11]-n[8];i.d=n[15]-n[12];break;case t.math.Plane.LEFT:i.a=n[3]+n[0];i.b=n[7]+n[4];i.c=n[11]+n[8];i.d=n[15]+n[12];break;case t.math.Plane.BOTTOM:i.a=n[3]+n[1];i.b=n[7]+n[5];i.c=n[11]+n[9];i.d=n[15]+n[13];break;case t.math.Plane.TOP:i.a=n[3]-n[1];i.b=n[7]-n[5];i.c=n[11]-n[9];i.d=n[15]-n[13];break;case t.math.Plane.FAR:i.a=n[3]-n[2];i.b=n[7]-n[6];i.c=n[11]-n[10];i.d=n[15]-n[14];break;case t.math.Plane.NEAR:i.a=n[3]+n[2];i.b=n[7]+n[6];i.c=n[11]+n[10];i.d=n[15]+n[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index");break}var r=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c);i.a/=r;i.b/=r;i.c/=r;i.d/=r;return i};e.toAxisAndAngle=function(){var e=this.extractRotation();var i=t.math.Quaternion.rotationMatrix(e);return i.toAxisAndAngle()}})(cc);(function(t){t.math.Plane=function(t,e,i,n){if(t&&e===undefined){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d}else{this.a=t||0;this.b=e||0;this.c=i||0;this.d=n||0}};t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0;t.math.Plane.RIGHT=1;t.math.Plane.BOTTOM=2;t.math.Plane.TOP=3;t.math.Plane.NEAR=4;t.math.Plane.FAR=5;t.math.Plane.POINT_INFRONT_OF_PLANE=0;t.math.Plane.POINT_BEHIND_PLANE=1;t.math.Plane.POINT_ON_PLANE=2;e.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w};e.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d};e.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z};t.math.Plane.fromPointNormal=function(e,i){return new t.math.Plane(i.x,i.y,i.z,-i.dot(e))};t.math.Plane.fromPoints=function(e,i,n){var r=new t.math.Vec3(i),s=new t.math.Vec3(n),a=new t.math.Plane;r.subtract(e);s.subtract(e);r.cross(s);r.normalize();a.a=r.x;a.b=r.y;a.c=r.z;a.d=r.scale(-1).dot(e);return a};e.normalize=function(){var e=new t.math.Vec3(this.a,this.b,this.c),i=1/e.length();e.normalize();this.a=e.x;this.b=e.y;this.c=e.z;this.d=this.d*i;return this};e.classifyPoint=function(e){var i=this.a*e.x+this.b*e.y+this.c*e.z+this.d;if(i>.001)return t.math.Plane.POINT_INFRONT_OF_PLANE;if(i<-.001)return t.math.Plane.POINT_BEHIND_PLANE;return t.math.Plane.POINT_ON_PLANE}})(cc);(function(t){t.math.Quaternion=function(t,e,i,n){if(t&&e===undefined){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w}else{this.x=t||0;this.y=e||0;this.z=i||0;this.w=n||0}};t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(t){this.x=-t.x;this.y=-t.y;this.z=-t.z;this.w=t.w;return this};e.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z};e.exponential=function(){return this};e.identity=function(){this.x=0;this.y=0;this.z=0;this.w=1;return this};e.inverse=function(){var e=this.length();if(Math.abs(e)>t.math.EPSILON){this.x=0;this.y=0;this.z=0;this.w=0;return this}this.conjugate(this).scale(1/e);return this};e.isIdentity=function(){return this.x===0&&this.y===0&&this.z===0&&this.w===1};e.length=function(){return Math.sqrt(this.lengthSq())};e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};e.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;this.w=r*t.w-e*t.x-i*t.y-n*t.z;this.x=r*t.x+e*t.w+i*t.z-n*t.y;this.y=r*t.y+i*t.w+n*t.x-e*t.z;this.z=r*t.z+n*t.w+e*t.y-i*t.x;return this};e.normalize=function(){var e=this.length();if(Math.abs(e)<=t.math.EPSILON)throw new Error("current quaternion is an invalid value");this.scale(1/e);return this};e.rotationAxis=function(t,e){var i=e*.5,n=Math.sin(i);this.w=Math.cos(i);this.x=t.x*n;this.y=t.y*n;this.z=t.z*n;return this};t.math.Quaternion.rotationMatrix=function(e){if(!e)return null;var i,n,r,s;var a=[],o=e.mat,c=0;a[0]=o[0];a[1]=o[3];a[2]=o[6];a[4]=o[1];a[5]=o[4];a[6]=o[7];a[8]=o[2];a[9]=o[5];a[10]=o[8];a[15]=1;var l=a[0];var h=l[0]+l[5]+l[10]+1;if(h>t.math.EPSILON){c=Math.sqrt(h)*2;i=(l[9]-l[6])/c;n=(l[2]-l[8])/c;r=(l[4]-l[1])/c;s=.25*c}else{if(l[0]>l[5]&&l[0]>l[10]){c=Math.sqrt(1+l[0]-l[5]-l[10])*2;i=.25*c;n=(l[4]+l[1])/c;r=(l[2]+l[8])/c;s=(l[9]-l[6])/c}else if(l[5]>l[10]){c=Math.sqrt(1+l[5]-l[0]-l[10])*2;i=(l[4]+l[1])/c;n=.25*c;r=(l[9]+l[6])/c;s=(l[2]-l[8])/c}else{c=Math.sqrt(1+l[10]-l[0]-l[5])*2;i=(l[2]+l[8])/c;n=(l[9]+l[6])/c;r=.25*c;s=(l[4]-l[1])/c}}return new t.math.Quaternion(i,n,r,s)};t.math.Quaternion.rotationYawPitchRoll=function(e,i,n){var r,s,a;var o,c,l,h,u,d,_,f;r=t.degreesToRadians(i)/2;s=t.degreesToRadians(e)/2;a=t.degreesToRadians(n)/2;o=Math.cos(r);c=Math.cos(s);l=Math.cos(a);h=Math.sin(r);u=Math.sin(s);d=Math.sin(a);_=c*l;f=u*d;var p=new t.math.Quaternion;p.w=o*_+h*f;p.x=h*_-o*f;p.y=o*u*l+h*c*d;p.z=o*c*d-h*u*l;p.normalize();return p};e.slerp=function(e,i){if(this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w){return this}var n=this.dot(e),r=Math.acos(n),s=Math.sqrt(1-t.math.square(n));var a=Math.sin(i*r)/s,o=Math.sin((1-i)*r)/s;var c=new t.math.Quaternion(e);this.scale(o);c.scale(a);this.add(c);return this};e.toAxisAndAngle=function(){var e;var i;var n,r=new t.math.Vec3;e=Math.acos(this.w);i=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z));if(i>-t.math.EPSILON&&i<t.math.EPSILON||i<2*Math.PI+t.math.EPSILON&&i>2*Math.PI-t.math.EPSILON){n=0;r.x=0;r.y=0;r.z=1}else{n=e*2;r.x=this.x/i;r.y=this.y/i;r.z=this.z/i;r.normalize()}return{axis:r,angle:n}};e.scale=function(t){this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this};e.assignFrom=function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;return this};e.add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;this.w+=t.w;return this};t.math.Quaternion.rotationBetweenVec3=function(e,i,n){var r=new t.math.Vec3(e),s=new t.math.Vec3(i);r.normalize();s.normalize();var a=r.dot(s),o=new t.math.Quaternion;if(a>=1){o.identity();return o}if(a<1e-6-1){if(Math.abs(n.lengthSq())<t.math.EPSILON){o.rotationAxis(n,Math.PI)}else{var c=new t.math.Vec3(1,0,0);c.cross(e);if(Math.abs(c.lengthSq())<t.math.EPSILON){c.fill(0,1,0);c.cross(e)}c.normalize();o.rotationAxis(c,Math.PI)}}else{var l=Math.sqrt((1+a)*2),h=1/l;r.cross(s);o.x=r.x*h;o.y=r.y*h;o.z=r.z*h;o.w=l*.5;o.normalize()}return o};e.multiplyVec3=function(e){var i=this.x,n=this.y,r=this.z,s=new t.math.Vec3(e);var a=new t.math.Vec3(i,n,r),o=new t.math.Vec3(i,n,r);a.cross(e);o.cross(a);a.scale(2*q.w);o.scale(2);s.add(a);s.add(o);return s}})(cc);cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3;this.max=e||new cc.math.Vec3};cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z};cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z};cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min);this.max.assignFrom(t.max)};cc.math.AABB.assign=function(t,e){t.min.assignFrom(e.min);t.max.assignFrom(e.max);return t};(function(t){t.math.Matrix4Stack=function(t,e){this.top=t;this.stack=e||[]};t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0;this.top=null};t.km_mat4_stack_push=function(e,i){e.stack.push(e.top);e.top=new t.math.Matrix4(i)};t.km_mat4_stack_pop=function(t,e){t.top=t.stack.pop()};t.km_mat4_stack_release=function(t){t.stack=null;t.top=null};e.push=function(e){e=e||this.top;this.stack.push(this.top);this.top=new t.math.Matrix4(e)};e.pop=function(){this.top=this.stack.pop()};e.release=function(){this.stack=null;this.top=null;this._matrixPool=null};e._getFromPool=function(e){var i=this._matrixPool;if(i.length===0)return new t.math.Matrix4(e);var n=i.pop();n.assignFrom(e);return n};e._putInPool=function(t){this._matrixPool.push(t)}})(cc);(function(t){t.KM_GL_MODELVIEW=5888;t.KM_GL_PROJECTION=5889;t.KM_GL_TEXTURE=5890;t.modelview_matrix_stack=new t.math.Matrix4Stack;t.projection_matrix_stack=new t.math.Matrix4Stack;t.texture_matrix_stack=new t.math.Matrix4Stack;t.current_stack=null;var e=false;t.lazyInitialize=function(){if(!e){var i=new t.math.Matrix4;t.modelview_matrix_stack.initialize();t.projection_matrix_stack.initialize();t.texture_matrix_stack.initialize();t.current_stack=t.modelview_matrix_stack;t.initialized=true;i.identity();t.modelview_matrix_stack.push(i);t.projection_matrix_stack.push(i);t.texture_matrix_stack.push(i)}};t.lazyInitialize();t.kmGLFreeAll=function(){t.modelview_matrix_stack.release();t.modelview_matrix_stack=null;t.projection_matrix_stack.release();t.projection_matrix_stack=null;t.texture_matrix_stack.release();t.texture_matrix_stack=null;t.initialized=false;t.current_stack=null};t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)};t.kmGLPushMatrixWitMat4=function(e){t.current_stack.stack.push(t.current_stack.top);e.assignFrom(t.current_stack.top);t.current_stack.top=e};t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()};t.kmGLMatrixMode=function(e){switch(e){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified");break}};t.kmGLLoadIdentity=function(){t.current_stack.top.identity()};t.kmGLLoadMatrix=function(e){t.current_stack.top.assignFrom(e)};t.kmGLMultMatrix=function(e){t.current_stack.top.multiply(e)};var i=new t.math.Matrix4;t.kmGLTranslatef=function(e,n,r){var s=t.math.Matrix4.createByTranslation(e,n,r,i);t.current_stack.top.multiply(s)};var n=new t.math.Vec3;t.kmGLRotatef=function(e,r,s,a){n.fill(r,s,a);var o=t.math.Matrix4.createByAxisAndAngle(n,t.degreesToRadians(e),i);t.current_stack.top.multiply(o)};t.kmGLScalef=function(e,n,r){var s=t.math.Matrix4.createByScale(e,n,r,i);t.current_stack.top.multiply(s)};t.kmGLGetMatrix=function(e,i){switch(e){case t.KM_GL_MODELVIEW:i.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:i.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:i.assignFrom(t.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified");break}}})(cc);cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\n"+"varying vec4 v_fragmentColor;\n"+"void main()                              \n"+"{ \n"+"    gl_FragColor = v_fragmentColor;      \n"+"}\n";cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\n"+"uniform    vec4 u_color;\n"+"uniform float u_pointSize;\n"+"varying lowp vec4 v_fragmentColor; \n"+"void main(void)   \n"+"{\n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    gl_PointSize = u_pointSize;          \n"+"    v_fragmentColor = u_color;           \n"+"}";cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \n"+"varying vec4 v_fragmentColor; \n"+"void main() \n"+"{ \n"+"     gl_FragColor = v_fragmentColor; \n"+"} ";cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\n"+"attribute vec4 a_color;\n"+"varying lowp vec4 v_fragmentColor;\n"+"void main()\n"+"{\n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    v_fragmentColor = a_color;             \n"+"}";cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\n"+"varying mediump vec4 v_color;\n"+"varying mediump vec2 v_texcoord;\n"+"void main()	\n"+"{ \n"+"// #if defined GL_OES_standard_derivatives	\n"+"// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n"+"// #else	\n"+"gl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n"+"// #endif \n"+"}";cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \n"+"attribute mediump vec2 a_texcoord; \n"+"attribute mediump vec4 a_color;	\n"+"varying mediump vec4 v_color; \n"+"varying mediump vec2 v_texcoord;	\n"+"void main() \n"+"{ \n"+"     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n"+"     v_texcoord = a_texcoord; \n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"}";cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \n"+"varying vec2 v_texCoord;  \n"+"void main() \n"+"{  \n"+"    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n"+"}";cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \n"+"attribute vec2 a_texCoord; \n"+"varying mediump vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    v_texCoord = a_texCoord;               \n"+"}";cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \n"+"uniform vec4 u_color; \n"+"varying vec2 v_texCoord; \n"+"void main() \n"+"{  \n"+"    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n"+"}";cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\n"+"attribute vec2 a_texCoord; \n"+"varying mediump vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    v_texCoord = a_texCoord;                 \n"+"}";cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \n"+"varying vec4 v_fragmentColor; \n"+"varying vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_FragColor = vec4( v_fragmentColor.rgb,         \n"+"        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n"+"    ); \n"+"}";cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \n"+"attribute vec2 a_texCoord; \n"+"attribute vec4 a_color;  \n"+"varying lowp vec4 v_fragmentColor; \n"+"varying mediump vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    v_fragmentColor = a_color; \n"+"    v_texCoord = a_texCoord; \n"+"}";cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\n"+"varying vec4 v_fragmentColor; \n"+"varying vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n"+"}";cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \n"+"attribute vec2 a_texCoord; \n"+"attribute vec4 a_color;  \n"+"varying lowp vec4 v_fragmentColor; \n"+"varying mediump vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n"+"    v_fragmentColor = a_color; \n"+"    v_texCoord = a_texCoord; \n"+"}";
cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \n"+"varying vec4 v_fragmentColor; \n"+"varying vec2 v_texCoord;   \n"+"uniform float CC_alpha_value; \n"+"void main() \n"+"{  \n"+"    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n"+"    if ( texColor.a <= CC_alpha_value )          \n"+"        discard; \n"+"    gl_FragColor = texColor * v_fragmentColor;  \n"+"}";cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \n"+"varying vec4 v_fragmentColor; \n"+"varying vec2 v_texCoord; \n"+"uniform sampler2D u_texture;  \n"+"uniform sampler2D   u_mask;   \n"+"void main()  \n"+"{  \n"+"    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n"+"    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n"+"    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n"+"    gl_FragColor    = v_fragmentColor * finalColor; \n"+"}";cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_MAX:8,_programs:{},_init:function(){this.loadDefaultShaders();return true},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG);t.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type");return}t.link();t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR);this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=t;this._programs["ShaderPositionTextureColor"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST);this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=t;this._programs["ShaderPositionTextureColorAlphaTest"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_COLOR);this._programs[cc.SHADER_POSITION_COLOR]=t;this._programs["ShaderPositionColor"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE);this._programs[cc.SHADER_POSITION_TEXTURE]=t;this._programs["ShaderPositionTexture"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR);this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=t;this._programs["ShaderPositionTextureUColor"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR);this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=t;this._programs["ShaderPositionTextureA8Color"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR);this._programs[cc.SHADER_POSITION_UCOLOR]=t;this._programs["ShaderPositionUColor"]=t;t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR);this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=t;this._programs["ShaderPositionLengthTextureColor"]=t},reloadDefaultShaders:function(){var t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR);t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST);t=this.programForKey(cc.SHADER_POSITION_COLOR);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_COLOR);t=this.programForKey(cc.SHADER_POSITION_TEXTURE);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE);t=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR);t=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR);t=this.programForKey(cc.SHADER_POSITION_UCOLOR);t.reset();this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}};cc.HashUniformEntry=function(t,e,i){this.value=t;this.location=e;this.hh=i||{}};cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:false,_updateUniformLocation:function(t,e,i){if(t==null)return false;var n=true;var r=null;for(var s=0;s<this._hashForUniforms.length;s++)if(this._hashForUniforms[s].location==t)r=this._hashForUniforms[s];if(!r){r=new cc.HashUniformEntry;r.location=t;r.value=e;this._hashForUniforms.push(r)}else{if(r.value==e)n=false;else r.value=e}return n},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return false;var n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=n+"uniform mat4 CC_PMatrix;         \n"+"uniform mat4 CC_MVMatrix;        \n"+"uniform mat4 CC_MVPMatrix;       \n"+"uniform vec4 CC_Time;            \n"+"uniform vec4 CC_SinTime;         \n"+"uniform vec4 CC_CosTime;         \n"+"uniform vec4 CC_Random01;        \n"+"uniform sampler2D CC_Texture0;   \n"+"//CC INCLUDES END                \n"+i;this._glContext.shaderSource(t,i);this._glContext.compileShader(t);var r=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);if(!r){cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t));if(e===this._glContext.VERTEX_SHADER)cc.log("cocos2d: \n"+this.vertexShaderLog());else cc.log("cocos2d: \n"+this.fragmentShaderLog())}return r===true},ctor:function(t,e,i){this._uniforms=[];this._hashForUniforms=[];this._glContext=i||cc._renderContext;t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null;this._fragShader=null;this._uniforms=null;this._hashForUniforms=null;this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;this._programObj=i.createProgram();this._vertShader=null;this._fragShader=null;if(t){this._vertShader=i.createShader(i.VERTEX_SHADER);if(!this._compileShader(this._vertShader,i.VERTEX_SHADER,t)){cc.log("cocos2d: ERROR: Failed to compile vertex shader")}}if(e){this._fragShader=i.createShader(i.FRAGMENT_SHADER);if(!this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)){cc.log("cocos2d: ERROR: Failed to compile fragment shader")}}if(this._vertShader)i.attachShader(this._programObj,this._vertShader);cc.checkGLErrorDebug();if(this._fragShader)i.attachShader(this._programObj,this._fragShader);this._hashForUniforms.length=0;cc.checkGLErrorDebug();return true},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj){cc.log("cc.GLProgram.link(): Cannot link invalid program");return false}this._glContext.linkProgram(this._programObj);if(this._vertShader)this._glContext.deleteShader(this._vertShader);if(this._fragShader)this._glContext.deleteShader(this._fragShader);this._vertShader=null;this._fragShader=null;if(cc.game.config[cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t){cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj));cc.glDeleteProgram(this._programObj);this._programObj=null;return false}}return true},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S);this._uniforms[cc.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S);this._uniforms[cc.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S);this._uniforms[cc.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S);this._uniforms[cc.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S);this._uniforms[cc.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S);this._usesTime=this._uniforms[cc.UNIFORM_TIME]!=null||this._uniforms[cc.UNIFORM_SINTIME]!=null||this._uniforms[cc.UNIFORM_COSTIME]!=null;this._uniforms[cc.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S);this._uniforms[cc.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S);this.use();this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER],0)},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._updateUniformLocation(t,e);if(i)this._glContext.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=[e,i];var r=this._updateUniformLocation(t,n);if(r)this._glContext.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=[e,i,n];var s=this._updateUniformLocation(t,r);if(s)this._glContext.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var s=[e,i,n,r];var a=this._updateUniformLocation(t,s);if(a)this._glContext.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(arguments[0],arguments[1])},setUniformLocationWith1f:function(t,e){var i=this._updateUniformLocation(t,e);if(i)this._glContext.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=[e,i];var r=this._updateUniformLocation(t,n);if(r)this._glContext.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=[e,i,n];var s=this._updateUniformLocation(t,r);if(s)this._glContext.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var s=[e,i,n,r];var a=this._updateUniformLocation(t,s);if(a)this._glContext.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniform4fv(t,e)},setUniformLocationWithMatrix4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);if(n)this._glContext.uniformMatrix4fv(t,false,e)},setUniformLocationF32:function(){if(arguments.length<2)return;switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break}},setUniformsForBuiltins:function(){var t=new cc.math.Matrix4;var e=new cc.math.Matrix4;var i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e);cc.kmMat4Multiply(i,t,e);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],t.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],e.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],i.mat,1);if(this._usesTime){var n=cc.director;var r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],r/10,r,r*2,r*4);this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],r/8,r/4,r/2,Math.sin(r));this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],r/8,r/4,r/2,Math.cos(r))}if(this._uniforms[cc.UNIFORM_RANDOM01]!==-1)this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(!t||!t._renderCmd)return;var e=new cc.math.Matrix4;var i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e);cc.kmMat4Multiply(i,e,t._renderCmd._stackMatrix);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],e.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],i.mat,1);if(this._usesTime){var n=cc.director;var r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],r/10,r,r*2,r*4);this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],r/8,r/4,r/2,Math.sin(r));this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],r/8,r/4,r/2,Math.cos(r))}if(this._uniforms[cc.UNIFORM_RANDOM01]!==-1)this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],false,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){cc.kmMat4Multiply(t,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],false,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],false,cc.modelview_matrix_stack.top.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],false,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],false,t.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],false,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null;this._fragShader=null;this._uniforms.length=0;this._glContext.deleteProgram(this._programObj);this._programObj=null;for(var t=0;t<this._hashForUniforms.length;t++){this._hashForUniforms[t].value=null;this._hashForUniforms[t]=null}this._hashForUniforms.length=0},getProgram:function(){return this._programObj},retain:function(){},release:function(){}});cc.GLProgram.create=function(t,e){return new cc.GLProgram(t,e)};cc.GLProgram._highpSupported=null;cc.GLProgram._isHighpSupported=function(){if(cc.GLProgram._highpSupported==null){var t=cc._renderContext;var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=e.precision!==0}return cc.GLProgram._highpSupported};cc.setProgram=function(t,e){t.shaderProgram=e;var i=t.children;if(!i)return;for(var n=0;n<i.length;n++)cc.setProgram(i[n],e)};cc._currentProjectionMatrix=-1;cc._vertexAttribPosition=false;cc._vertexAttribColor=false;cc._vertexAttribTexCoords=false;if(cc.ENABLE_GL_STATE_CACHE){cc.MAX_ACTIVETEXTURE=16;cc._currentShaderProgram=-1;cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];cc._blendingSource=-1;cc._blendingDest=-1;cc._GLServerState=0;if(cc.TEXTURE_ATLAS_USE_VAO)cc._uVAO=0}cc.glInvalidateStateCache=function(){cc.kmGLFreeAll();cc._currentProjectionMatrix=-1;cc._vertexAttribPosition=false;cc._vertexAttribColor=false;cc._vertexAttribTexCoords=false;if(cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var t=0;t<cc.MAX_ACTIVETEXTURE;t++){cc._currentBoundTexture[t]=-1}cc._blendingSource=-1;cc._blendingDest=-1;cc._GLServerState=0}};cc.glUseProgram=function(t){if(t!==cc._currentShaderProgram){cc._currentShaderProgram=t;cc._renderContext.useProgram(t)}};if(!cc.ENABLE_GL_STATE_CACHE){cc.glUseProgram=function(t){cc._renderContext.useProgram(t)}}cc.glDeleteProgram=function(t){if(cc.ENABLE_GL_STATE_CACHE){if(t===cc._currentShaderProgram)cc._currentShaderProgram=-1}gl.deleteProgram(t)};cc.glBlendFunc=function(t,e){if(t!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=t;cc._blendingDest=e;cc.setBlending(t,e)}};cc.setBlending=function(t,e){var i=cc._renderContext;if(t===i.ONE&&e===i.ZERO){i.disable(i.BLEND)}else{i.enable(i.BLEND);cc._renderContext.blendFunc(t,e)}};cc.glBlendFuncForParticle=function(t,e){if(t!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=t;cc._blendingDest=e;var i=cc._renderContext;if(t===i.ONE&&e===i.ZERO){i.disable(i.BLEND)}else{i.enable(i.BLEND);i.blendFuncSeparate(i.SRC_ALPHA,e,t,e)}}};if(!cc.ENABLE_GL_STATE_CACHE){cc.glBlendFunc=cc.setBlending}cc.glBlendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD);if(cc.ENABLE_GL_STATE_CACHE)cc.setBlending(cc._blendingSource,cc._blendingDest);else cc.setBlending(t.BLEND_SRC,t.BLEND_DST)};cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1};cc.glEnableVertexAttribs=function(t){var e=cc._renderContext;var i=t&cc.VERTEX_ATTRIB_FLAG_POSITION;if(i!==cc._vertexAttribPosition){if(i)e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);else e.disableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);cc._vertexAttribPosition=i}var n=t&cc.VERTEX_ATTRIB_FLAG_COLOR;if(n!==cc._vertexAttribColor){if(n)e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);else e.disableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);cc._vertexAttribColor=n}var r=t&cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;if(r!==cc._vertexAttribTexCoords){if(r)e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);else e.disableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);cc._vertexAttribTexCoords=r}};cc.glBindTexture2D=function(t){cc.glBindTexture2DN(0,t)};cc.glBindTexture2DN=function(t,e){if(cc._currentBoundTexture[t]===e)return;cc._currentBoundTexture[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t);if(e)i.bindTexture(i.TEXTURE_2D,e._webTextureObj);else i.bindTexture(i.TEXTURE_2D,null)};if(!cc.ENABLE_GL_STATE_CACHE){cc.glBindTexture2DN=function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t);if(e)i.bindTexture(i.TEXTURE_2D,e._webTextureObj);else i.bindTexture(i.TEXTURE_2D,null)}}cc.glDeleteTexture=function(t){cc.glDeleteTextureN(0,t)};cc.glDeleteTextureN=function(t,e){if(cc.ENABLE_GL_STATE_CACHE){if(e===cc._currentBoundTexture[t])cc._currentBoundTexture[t]=-1}cc._renderContext.deleteTexture(e)};cc.glBindVAO=function(t){if(!cc.TEXTURE_ATLAS_USE_VAO)return;if(cc.ENABLE_GL_STATE_CACHE){if(cc._uVAO!==t){cc._uVAO=t}}else{}};cc.glEnable=function(t){if(cc.ENABLE_GL_STATE_CACHE){}else{}};cc.IMAGE_FORMAT_JPEG=0;cc.IMAGE_FORMAT_PNG=1;cc.IMAGE_FORMAT_RAWDATA=9;cc.NextPOT=function(t){t=t-1;t=t|t>>1;t=t|t>>2;t=t|t>>4;t=t|t>>8;t=t|t>>16;return t+1};cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:false,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this);this._cascadeColorEnabled=true;this._cascadeOpacityEnabled=true;this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888;this._clearColor=new cc.Color(0,0,0,255);if(t!==undefined&&e!==undefined){i=i||cc.Texture2D.PIXEL_FORMAT_RGBA8888;n=n||0;this.initWithWidthAndHeight(t,e,i,n)}this.setAnchorPoint(0,0)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.RenderTexture.CanvasRenderCmd(this);else return new cc.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){cc.Node.prototype.onExit.call(this);this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId);this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,s){var a=cc._renderContext;r=r||a.COLOR_BUFFER_BIT;s=s||a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT;this._beginWithClear(t,e,i,n,r,s,a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,s,a){this.begin();this._renderCmd._beginWithClear(t,e,i,n,r,s,a)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n);this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r;e.g=t.g;e.b=t.b;e.a=t.a;this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){cc.log("saveToFile isn't supported on cocos2d-html5");return null},listenToBackground:function(t){},listenToForeground:function(t){}});var _p=cc.RenderTexture.prototype;_p.clearColorVal;cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor);cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)};(function(){cc.RenderTexture.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._clearColorStr="rgba(255,255,255,1)";this._cacheCanvas=document.createElement("canvas");this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.RenderTexture.CanvasRenderCmd;t.cleanup=function(){this._cacheContext=null;this._cacheCanvas=null};t.clearStencil=function(t){};t.setVirtualViewport=function(t,e,i){};t.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"};t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;var s=this._cacheCanvas,a=cc.contentScaleFactor();s.width=0|t*a;s.height=0|e*a;var o=new cc.Texture2D;o.initWithElement(s);o.handleLoadedTexture();var c=r.sprite=new cc.Sprite(o);c.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA);r.autoDraw=false;r.addChild(c);return true};t.begin=function(){};t._beginWithClear=function(t,e,i,n,r,s,a){t=t||0;e=e||0;i=i||0;n=isNaN(n)?255:n;var o=this._cacheContext.getContext();var c=this._cacheCanvas;o.setTransform(1,0,0,1,0,0);this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")");o.clearRect(0,0,c.width,c.height);o.fillRect(0,0,c.width,c.height)};t.end=function(){var t=this._node;var e=cc.contentScaleFactor();cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId,e,e)};t.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)};t.clearDepth=function(t){cc.log("clearDepth isn't supported on Cocos2d-Html5")};t.visit=function(t){var e=this._node;this._syncStatus(t);e.sprite.visit(this);this._dirtyFlag=0}})();(function(){cc.RenderTexture.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._fBO=null;this._oldFBO=null;this._textureCopy=null;this._depthRenderBuffer=null;this._rtTextureRect=new cc.Rect;this._fullRect=new cc.Rect;this._fullViewport=new cc.Rect};var t=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.RenderTexture.WebGLRenderCmd;t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x;this._rtTextureRect.y=t.y;this._fullRect=e;this._fullViewport=i};t.rendering=function(t){var e=t||cc._renderContext;var i=this._node;if(i.autoDraw){i.begin();var n=i.clearFlags;if(n){var r=[0,0,0,0];var s=0;var a=0;if(n&e.COLOR_BUFFER_BIT){r=e.getParameter(e.COLOR_CLEAR_VALUE);e.clearColor(i._clearColor.r/255,i._clearColor.g/255,i._clearColor.b/255,i._clearColor.a/255)}if(n&e.DEPTH_BUFFER_BIT){s=e.getParameter(e.DEPTH_CLEAR_VALUE);e.clearDepth(i.clearDepthVal)}if(n&e.STENCIL_BUFFER_BIT){a=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(i.clearStencilVal)}e.clear(n);if(n&e.COLOR_BUFFER_BIT)e.clearColor(r[0],r[1],r[2],r[3]);if(n&e.DEPTH_BUFFER_BIT)e.clearDepth(s);if(n&e.STENCIL_BUFFER_BIT)e.clearStencil(a)}i.sortAllChildren();var o=i._children;for(var c=0;c<o.length;c++){var l=o[c];if(l!==i.sprite){l._renderCmd.visit(i.sprite._renderCmd)}}i.end()}};t.clearStencil=function(t){var e=cc._renderContext;var i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t);e.clear(e.STENCIL_BUFFER_BIT);e.clearStencil(i)};t.cleanup=function(){var t=this._node;this._textureCopy=null;var e=cc._renderContext;e.deleteFramebuffer(this._fBO);if(this._depthRenderBuffer)e.deleteRenderbuffer(this._depthRenderBuffer)};t.updateClearColor=function(t){};t.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;if(i===cc.Texture2D.PIXEL_FORMAT_A8)cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var s=cc._renderContext,a=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,t,e);this._fullViewport=new cc.Rect(0,0,t,e);t=0|t*a;e=0|e*a;this._oldFBO=s.getParameter(s.FRAMEBUFFER_BINDING);var o,c;if(cc.configuration.supportsNPOT()){o=t;c=e}else{o=cc.NextPOT(t);c=cc.NextPOT(e)}var l=o*c*4;var h=new Uint8Array(l);for(var u=0;u<o*c*4;u++)h[u]=0;this._pixelFormat=i;var d=r._texture=new cc.Texture2D;if(!r._texture)return false;d.initWithData(h,r._pixelFormat,o,c,cc.size(t,e));var _=s.getParameter(s.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){this._textureCopy=new cc.Texture2D;if(!this._textureCopy)return false;this._textureCopy.initWithData(h,r._pixelFormat,o,c,cc.size(t,e))}this._fBO=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,this._fBO);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,d._webTextureObj,0);if(n!==0){this._depthRenderBuffer=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,this._depthRenderBuffer);s.renderbufferStorage(s.RENDERBUFFER,n,o,c);if(n===s.DEPTH_STENCIL)s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this._depthRenderBuffer);else if(n===s.STENCIL_INDEX||n===s.STENCIL_INDEX8)s.framebufferRenderbuffer(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.RENDERBUFFER,this._depthRenderBuffer);else if(n===s.DEPTH_COMPONENT16)s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this._depthRenderBuffer)}if(s.checkFramebufferStatus(s.FRAMEBUFFER)!==s.FRAMEBUFFER_COMPLETE)cc.log("Could not attach texture to the framebuffer");d.setAliasTexParameters();var f=r.sprite=new cc.Sprite(d);f.scaleY=-1;f.setBlendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA);s.bindRenderbuffer(s.RENDERBUFFER,_);s.bindFramebuffer(s.FRAMEBUFFER,this._oldFBO);r.autoDraw=false;r.addChild(f);return true};t.begin=function(){var t=this._node;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPushMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPushMatrix();var e=cc._renderContext;var i=cc.director;i.setProjection(i.getProjection());var n=t._texture.getContentSizeInPixels();var r=cc.director.getWinSizeInPixels();var s=r.width/n.width;var a=r.height/n.height;var o=cc.math.Matrix4.createOrthographicProjection(-1/s,1/s,-1/a,1/a,-1,1);cc.kmGLMultMatrix(o);var c=new cc.Rect(0,0,0,0);c.width=this._fullViewport.width;c.height=this._fullViewport.height;var l=c.width/this._fullRect.width;var h=c.height/this._fullRect.height;c.x=(this._fullRect.x-this._rtTextureRect.x)*l;c.y=(this._fullRect.y-this._rtTextureRect.y)*h;e.viewport(c.x,c.y,c.width,c.height);this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,this._fBO);if(cc.configuration.checkForGLExtension("GL_QCOM")){e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0)}};t._beginWithClear=function(t,e,i,n,r,s,a){t=t/255;e=e/255;i=i/255;n=n/255;var o=cc._renderContext;var c=[0,0,0,0];
var l=0;var h=0;if(a&o.COLOR_BUFFER_BIT){c=o.getParameter(o.COLOR_CLEAR_VALUE);o.clearColor(t,e,i,n)}if(a&o.DEPTH_BUFFER_BIT){l=o.getParameter(o.DEPTH_CLEAR_VALUE);o.clearDepth(r)}if(a&o.STENCIL_BUFFER_BIT){h=o.getParameter(o.STENCIL_CLEAR_VALUE);o.clearStencil(s)}o.clear(a);if(a&o.COLOR_BUFFER_BIT)o.clearColor(c[0],c[1],c[2],c[3]);if(a&o.DEPTH_BUFFER_BIT)o.clearDepth(l);if(a&o.STENCIL_BUFFER_BIT)o.clearStencil(h)};t.end=function(){var t=this._node;cc.renderer._renderingToBuffer(t.__instanceId);var e=cc._renderContext;var i=cc.director;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO);i.setViewport();cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPopMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPopMatrix()};t.clearRect=function(t,e,i,n){};t.clearDepth=function(t){var e=this._node;e.begin();var i=cc._renderContext;var n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t);i.clear(i.DEPTH_BUFFER_BIT);i.clearDepth(n);e.end()};t.visit=function(t){var e=this._node;if(!e._visible)return;cc.kmGLPushMatrix();this._syncStatus(t);cc.renderer.pushRenderCommand(this);e.sprite.visit(this);this._dirtyFlag=0;cc.kmGLPopMatrix()}})();cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",ctor:function(t,e){cc.Node.prototype.ctor.call(this);this._descendants=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);var i;e=e||cc.SpriteBatchNode.DEFAULT_CAPACITY;if(cc.isString(t)){i=cc.textureCache.getTextureForKey(t);if(!i)i=cc.textureCache.addImage(t)}else if(t instanceof cc.Texture2D)i=t;i&&this.initWithTexture(i,e)},addSpriteWithoutQuad:function(t,e,i){cc.assert(t,cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad_2);if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad);return null}t.atlasIndex=e;var n=0,r,s=this._descendants;if(s&&s.length>0){for(n=0,r=s.length;n<r;n++){var a=s[n];if(a&&a.atlasIndex>=e)break}}s.splice(n,0,t);cc.Node.prototype.addChild.call(this,t,e,i);this.reorderBatch(false);return this},getTextureAtlas:function(){return this._renderCmd.getTextureAtlas()},setTextureAtlas:function(t){this._renderCmd.getTextureAtlas(t)},getDescendants:function(){return this._descendants},initWithFile:function(t,e){var i=cc.textureCache.getTextureForKey(t);if(!i)i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},_setNodeDirtyForCache:function(){if(this._renderCmd&&this._renderCmd._setNodeDirtyForCache)this._renderCmd._setNodeDirtyForCache()},init:function(t,e){var i=cc.textureCache.getTextureForKey(t);if(!i)i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},increaseAtlasCapacity:function(){this._renderCmd.increaseAtlasCapacity()},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){var i=t.children;if(i&&i.length>0){for(var n=0;n<i.length;n++){var r=i[n];if(r&&r.zIndex<0)e=this.rebuildIndexInOrder(r,e)}}if(!t===this){t.atlasIndex=e;e++}if(i&&i.length>0){for(n=0;n<i.length;n++){r=i[n];if(r&&r.zIndex>=0)e=this.rebuildIndexInOrder(r,e)}}return e},highestAtlasIndexInChild:function(t){var e=t.children;if(!e||e.length===0)return t.atlasIndex;else return this.highestAtlasIndexInChild(e[e.length-1])},lowestAtlasIndexInChild:function(t){var e=t.children;if(!e||e.length===0)return t.atlasIndex;else return this.lowestAtlasIndexInChild(e[e.length-1])},atlasIndexForChild:function(t,e){var i=t.parent;var n=i.children;var r=n.indexOf(t);var s=i===this;var a=null;if(r>0&&r<cc.UINT_MAX)a=n[r-1];if(s){if(r===0)return 0;return this.highestAtlasIndexInChild(a)+1}if(r===0){if(e<0)return i.atlasIndex;else return i.atlasIndex+1}else{if(a.zIndex<0&&e<0||a.zIndex>=0&&e>=0)return this.highestAtlasIndexInChild(a)+1;return i.atlasIndex+1}},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){if(e===undefined)this._blendFunc=t;else this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.SpriteBatchNode_reorderChild_2);if(this._children.indexOf(t)===-1){cc.log(cc._LogInfos.SpriteBatchNode_reorderChild);return}if(e===t.zIndex)return;cc.Node.prototype.reorderChild.call(this,t,e)},removeChild:function(t,e){if(t==null)return;if(this._children.indexOf(t)===-1){cc.log(cc._LogInfos.SpriteBatchNode_removeChild);return}this.removeSpriteFromAtlas(t);cc.Node.prototype.removeChild.call(this,t,e)},updateQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2);if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite);return}this._renderCmd.checkAtlasCapacity();t.batchNode=this;t.atlasIndex=e;t.dirty=true;t.updateTransform()},insertQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite_2);if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite);return}this._renderCmd.insertQuad(t,e);t.batchNode=this;t.atlasIndex=e;t.dirty=true;t.updateTransform();this._renderCmd.cutting(t,e)},initWithTexture:function(t,e){this._children.length=0;this._descendants.length=0;e=e||cc.SpriteBatchNode.DEFAULT_CAPACITY;this._renderCmd.initWithTexture(t,e);return true},insertChild:function(t,e){t.batchNode=this;t.atlasIndex=e;t.dirty=true;this._renderCmd.insertQuad(t,e);this._descendants.splice(e,0,t);var i=e+1,n=this._descendants;if(n&&n.length>0){for(;i<n.length;i++)n[i].atlasIndex++}var r=t.children,s,a;if(r){for(i=0,a=r.length||0;i<a;i++){s=r[i];if(s){var o=this.atlasIndexForChild(s,s.zIndex);this.insertChild(s,o)}}}},appendChild:function(t){this._reorderChildDirty=true;t.batchNode=this;t.dirty=true;this._descendants.push(t);var e=this._descendants.length-1;t.atlasIndex=e;this._renderCmd.insertQuad(t,e);var i=t.children;for(var n=0,r=i.length||0;n<r;n++)this.appendChild(i[n])},removeSpriteFromAtlas:function(t){this._renderCmd.removeQuadAtIndex(t.atlasIndex);t.batchNode=null;var e=this._descendants;var i=e.indexOf(t);if(i!==-1){e.splice(i,1);var n=e.length;for(;i<n;++i){var r=e[i];r.atlasIndex--}}var s=t.children;if(s){for(var a=0,o=s.length||0;a<o;a++)s[a]&&this.removeSpriteFromAtlas(s[a])}},getTexture:function(){return this._renderCmd.getTexture()},setTexture:function(t){this._renderCmd.setTexture(t)},addChild:function(t,e,i){cc.assert(t!=null,cc._LogInfos.CCSpriteBatchNode_addChild_3);if(!this._renderCmd.isValidChild(t))return;e=e==null?t.zIndex:e;i=i==null?t.tag:i;cc.Node.prototype.addChild.call(this,t,e,i);this.appendChild(t)},removeAllChildren:function(t){var e=this._descendants;if(e&&e.length>0){for(var i=0,n=e.length;i<n;i++){if(e[i])e[i].batchNode=null}}cc.Node.prototype.removeAllChildren.call(this,t);this._descendants.length=0;this._renderCmd.removeAllQuads()},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;var e,i=0,n=t.length,r;for(e=1;e<n;e++){var s=t[e];i=e-1;r=t[i];while(i>=0&&(s._localZOrder<r._localZOrder||s._localZOrder===r._localZOrder&&s.arrivalOrder<r.arrivalOrder)){t[i+1]=r;i=i-1;r=t[i]}t[i+1]=s}if(t.length>0){this._arrayMakeObjectsPerformSelector(t,cc.Node._stateCallbackType.sortAllChildren);this._renderCmd.updateChildrenAtlasIndex(t)}this._reorderChildDirty=false}},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.SpriteBatchNode.CanvasRenderCmd(this);else return new cc.SpriteBatchNode.WebGLRenderCmd(this)}});var _p=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.defineGetterSetter(_p,"textureAtlas",_p.getTextureAtlas,_p.setTextureAtlas);_p.descendants;cc.defineGetterSetter(_p,"descendants",_p.getDescendants);cc.SpriteBatchNode.DEFAULT_CAPACITY=29;cc.SpriteBatchNode.create=function(t,e){return new cc.SpriteBatchNode(t,e)};cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create;(function(){cc.SpriteBatchNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._texture=null;this._textureToRender=null};var t=cc.SpriteBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.SpriteBatchNode.CanvasRenderCmd;t.checkAtlasCapacity=function(){};t.isValidChild=function(t){if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.Sprite_addChild_4);return false}return true};t.initWithTexture=function(t,e){this._textureToRender=this._texture=t};t.insertQuad=function(t,e){};t.increaseAtlasCapacity=function(){};t.removeQuadAtIndex=function(){};t.removeAllQuads=function(){};t.getTexture=function(){return this._texture};t.setTexture=function(t){this._texture=t;var e=this._node._children;for(var i=0;i<e.length;i++)e[i].setTexture(t)};t.updateChildrenAtlasIndex=function(t){this._node._descendants.length=0;for(var e=0,i=t.length;e<i;e++)this._updateAtlasIndex(t[e])};t._updateAtlasIndex=function(t){var e=this._node._descendants;var i=t.children,n,r=i.length;for(n=0;n<r;n++){if(i[n]._localZOrder<0){e.push(i[n])}else break}e.push(t);for(;n<r;n++){e.push(i[n])}};t.getTextureAtlas=function(){};t.setTextureAtlas=function(t){};t.cutting=function(t,e){var i=this._node;i._children.splice(e,0,t)}})();(function(){cc.SpriteBatchNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._textureAtlas=null};var t=cc.SpriteBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.SpriteBatchNode.WebGLRenderCmd;t.isValidChild=function(t){if(!(t instanceof cc.Sprite)){cc.log(cc._LogInfos.Sprite_addChild_4);return false}if(t.texture!=this.getTexture()){cc.log(cc._LogInfos.Sprite_addChild_5);return false}return true};t.rendering=function(){var t=this._node;if(this._textureAtlas.totalQuads===0)return;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);t._arrayMakeObjectsPerformSelector(t._children,cc.Node._stateCallbackType.updateTransform);cc.glBlendFunc(t._blendFunc.src,t._blendFunc.dst);this._textureAtlas.drawQuads()};t.visit=function(t){var e=this._node;if(!e._visible)return;if(e._parent&&e._parent._renderCmd)this._curLevel=e._parent._renderCmd._curLevel+1;var i=cc.current_stack;i.stack.push(i.top);if(!(this._dirtyFlag&cc.Node._dirtyFlags.transformDirty))this.transform(t);this.updateStatus(t);i.top=this._stackMatrix;e.sortAllChildren();cc.renderer.pushRenderCommand(this);this._dirtyFlag=0;i.top=i.stack.pop()};t.checkAtlasCapacity=function(t){var e=this._textureAtlas;while(t>=e.capacity||e.capacity===e.totalQuads){this.increaseAtlasCapacity()}};t.increaseAtlasCapacity=function(){var t=this._textureAtlas.capacity;var e=Math.floor((t+1)*4/3);cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity,t,e);if(!this._textureAtlas.resizeCapacity(e)){cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity_2)}};t.initWithTexture=function(t,e){this._textureAtlas=new cc.TextureAtlas;this._textureAtlas.initWithTexture(t,e);this._updateBlendFunc();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};t.insertQuad=function(t,e){var i=this._textureAtlas;if(i.totalQuads>=i.capacity)this.increaseAtlasCapacity();i.insertQuad(t.quad,e)};t.removeQuadAtIndex=function(t){this._textureAtlas.removeQuadAtIndex(t)};t.getTexture=function(){return this._textureAtlas.texture};t.setTexture=function(t){this._textureAtlas.setTexture(t);if(t)this._updateBlendFunc()};t.removeAllQuads=function(){this._textureAtlas.removeAllQuads()};t._swap=function(t,e){var i=this._node._descendants;var n=this._textureAtlas;var r=n.quads;var s=i[t];var a=cc.V3F_C4B_T2F_QuadCopy(r[t]);i[e].atlasIndex=t;i[t]=i[e];n.updateQuad(r[e],t);i[e]=s;n.updateQuad(a,e)};t._updateAtlasIndex=function(t,e){var i=0;var n=t.children;if(n)i=n.length;var r=0;if(i===0){r=t.atlasIndex;t.atlasIndex=e;t.arrivalOrder=0;if(r!==e)this._swap(r,e);e++}else{var s=true;if(n[0].zIndex>=0){r=t.atlasIndex;t.atlasIndex=e;t.arrivalOrder=0;if(r!==e)this._swap(r,e);e++;s=false}for(var a=0;a<n.length;a++){var o=n[a];if(s&&o.zIndex>=0){r=t.atlasIndex;t.atlasIndex=e;t.arrivalOrder=0;if(r!==e){this._swap(r,e)}e++;s=false}e=this._updateAtlasIndex(o,e)}if(s){r=t.atlasIndex;t.atlasIndex=e;t.arrivalOrder=0;if(r!==e){this._swap(r,e)}e++}}return e};t.updateChildrenAtlasIndex=function(t){var e=0;for(var i=0;i<t.length;i++)e=this._updateAtlasIndex(t[i],e)};t._updateBlendFunc=function(){if(!this._textureAtlas.texture.hasPremultipliedAlpha()){var t=this._node._blendFunc;t.src=cc.SRC_ALPHA;t.dst=cc.ONE_MINUS_SRC_ALPHA}};t.getTextureAtlas=function(){return this._textureAtlas};t.setTextureAtlas=function(t){if(t!==this._textureAtlas){this._textureAtlas=t}};t.cutting=function(){}})();cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:false,_className:"LabelAtlas",ctor:function(t,e,i,n,r){cc.AtlasNode.prototype.ctor.call(this);this._renderCmd.setCascade();e&&cc.LabelAtlas.prototype.initWithString.call(this,t,e,i,n,r)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.LabelAtlas.WebGLRenderCmd(this);else return new cc.LabelAtlas.CanvasRenderCmd(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},initWithString:function(t,e,i,n,r){var s=t+"",a,o,c,l;if(i===undefined){var h=cc.loader.getRes(e);if(parseInt(h["version"],10)!==1){cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version");return false}a=cc.path.changeBasename(e,h["textureFilename"]);var u=cc.contentScaleFactor();o=parseInt(h["itemWidth"],10)/u;c=parseInt(h["itemHeight"],10)/u;l=String.fromCharCode(parseInt(h["firstChar"],10))}else{a=e;o=i||0;c=n||0;l=r||" "}var d=null;if(a instanceof cc.Texture2D)d=a;else d=cc.textureCache.addImage(a);var _=d.isLoaded();this._textureLoaded=_;if(!_){this._string=s;d.addEventListener("load",function(t){this.initWithTexture(d,o,c,s.length);this.string=this._string;this.setColor(this._renderCmd._displayedColor);this.dispatchEvent("load")},this)}if(this.initWithTexture(d,o,c,s.length)){this._mapStartChar=l;this.string=s;return true}return false},setColor:function(t){cc.AtlasNode.prototype.setColor.call(this,t);this._renderCmd.updateAtlasValues()},getString:function(){return this._string},addChild:function(t,e,i){this._renderCmd._addChild(t);cc.Node.prototype.addChild.call(this,t,e,i)},updateAtlasValues:function(){this._renderCmd.updateAtlasValues()},setString:function(t){t=String(t);var e=t.length;this._string=t;this.setContentSize(e*this._itemWidth,this._itemHeight);this._renderCmd.setString(t);this._renderCmd.updateAtlasValues();this.quadsToDraw=e}});(function(){var t=cc.LabelAtlas.prototype;cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity);cc.defineGetterSetter(t,"color",t.getColor,t.setColor);t.string;cc.defineGetterSetter(t,"string",t.getString,t.setString)})();cc.LabelAtlas.create=function(t,e,i,n,r){return new cc.LabelAtlas(t,e,i,n,r)};(function(){cc.LabelAtlas.CanvasRenderCmd=function(t){cc.AtlasNode.CanvasRenderCmd.call(this,t);this._needDraw=false};var t=cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(cc.AtlasNode.CanvasRenderCmd.prototype);t.constructor=cc.LabelAtlas.CanvasRenderCmd;t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=true;t._cascadeColorEnabled=false};t.updateAtlasValues=function(){var t=this._node;var e=t._string||"";var i=e.length;var n=this._textureToRender;var r=t._itemWidth,s=t._itemHeight;for(var a=0,o=-1;a<i;a++){var c=e.charCodeAt(a)-t._mapStartChar.charCodeAt(0);var l=parseInt(c%t._itemsPerRow,10);var h=parseInt(c/t._itemsPerRow,10);if(l<0||h<0)continue;var u=cc.rect(l*r,h*s,r,s);var d=n._contentSize;if(u.x<0||u.y<0||u.x+u.width>d.width||u.y+u.height>d.height)continue;o++;var _=e.charCodeAt(a);var f=t.getChildByTag(a);if(!f){f=new cc.Sprite;if(_===32){f.init();f.setTextureRect(cc.rect(0,0,10,10),false,cc.size(0,0))}else f.initWithTexture(n,u);cc.Node.prototype.addChild.call(t,f,0,a)}else{if(_===32){f.init();f.setTextureRect(cc.rect(0,0,10,10),false,cc.size(0,0))}else{f.initWithTexture(n,u);f.visible=true}}f.setPosition(o*r+r/2,s/2)}this.updateContentSize(a,o+1)};t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;if(t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height){i.setContentSize(e*i._itemWidth,i._itemHeight)}};t.setString=function(t){var e=this._node;if(e._children){var i=e._children;var n=i.length;for(var r=0;r<n;r++){var s=i[r];if(s&&!s._lateChild)s.visible=false}}};t._addChild=function(){child._lateChild=true}})();cc.LABEL_AUTOMATIC_WIDTH=-1;cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:false,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:false,_imageOffset:null,_reusedChar:null,_textureLoaded:false,_className:"LabelBMFont",_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.LabelBMFont.WebGLRenderCmd(this);else return new cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(t,e){if(!e){this._string=t}else{this._initialString=t}var i=this._children;if(i){for(var n=0;n<i.length;n++){var r=i[n];if(r)r.setVisible(false)}}if(this._textureLoaded){this.createFontChars();if(e)this.updateLabel()}},ctor:function(t,e,i,n,r){cc.SpriteBatchNode.prototype.ctor.call(this);this._imageOffset=cc.p(0,0);this._reusedChar=[];this._cascadeColorEnabled=true;this._cascadeOpacityEnabled=true;this.initWithString(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t;var e=this._children;if(e){for(var i=0;i<e.length;i++){var n=e[i];if(n)n.opacityModifyRGB=this._opacityModifyRGB}}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,i,n,r){var s=this,a=t||"";var o=this._renderCmd;if(s._config)cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");var c;if(e){var l=cc.loader.getRes(e);if(!l){cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file");return false}s._config=l;s._fntFile=e;c=cc.textureCache.addImage(l.atlasName);var h=c.isLoaded();s._textureLoaded=h;if(!h){c.addEventListener("load",function(t){var e=this;e._textureLoaded=true;e.initWithTexture(t,e._initialString.length);e.setString(e._initialString,true);e.dispatchEvent("load")},s)}}else{c=new cc.Texture2D;var u=new Image;c.initWithElement(u);s._textureLoaded=false}if(s.initWithTexture(c,a.length)){s._alignment=n||cc.TEXT_ALIGNMENT_LEFT;s._imageOffset=r||cc.p(0,0);s._width=i==null?-1:i;s._realOpacity=255;s._realColor=cc.color(255,255,255,255);s._contentSize.width=0;s._contentSize.height=0;s.setAnchorPoint(.5,.5);this._renderCmd._initBatchTexture();s.setString(a,true);return true}return false},createFontChars:function(){var t=this;var e=this._renderCmd;var i=e._texture||t.textureAtlas.texture;var n=0;var r=cc.size(0,0);var s=0;var a=1;var o=t._string;var c=o?o.length:0;if(c===0)return;var l,h=t._config,u=h.kerningDict,d=h.commonHeight,_=h.fontDefDictionary;for(l=0;l<c-1;l++){if(o.charCodeAt(l)===10)a++}var f=d*a;var p=-(d-d*a);var m=-1;for(l=0;l<c;l++){var g=o.charCodeAt(l);if(g===0)continue;if(g===10){n=0;p-=h.commonHeight;continue}var v=u[m<<16|g&65535]||0;var y=_[g];if(!y){cc.log("cocos2d: LabelBMFont: character not found "+o[l]);y={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0}}var T=cc.rect(y.rect.x,y.rect.y,y.rect.width,y.rect.height);T=cc.rectPixelsToPoints(T);T.x+=t._imageOffset.x;T.y+=t._imageOffset.y;var C=t.getChildByTag(l);if(!C){C=new cc.Sprite;C.initWithTexture(i,T,false);C._newTextureWhenChangeColor=true;this.addChild(C,0,l)}else{this._renderCmd._updateCharTexture(C,T,g)}C.opacityModifyRGB=this._opacityModifyRGB;this._renderCmd._updateCharColorAndOpacity(C);var S=h.commonHeight-y.yOffset;var x=cc.p(n+y.xOffset+y.rect.width*.5+v,p+S-T.height*.5*cc.contentScaleFactor());C.setPosition(cc.pointPixelsToPoints(x));n+=y.xAdvance+v;m=g;if(s<n)s=n}if(y&&y.xAdvance<y.rect.width)r.width=s-y.xAdvance+y.rect.width;else r.width=s;r.height=f;t.setContentSize(cc.sizePixelsToPoints(r))},updateString:function(t){var e=this;var i=e._children;if(i){for(var n=0,r=i.length;n<r;n++){var s=i[n];if(s)s.visible=false}}if(e._config)e.createFontChars();if(!t)e.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){t=String(t);if(e==null)e=true;if(t==null||!cc.isString(t))t=t+"";this._initialString=t;this._setString(t,e)},_setStringForSetter:function(t){this.setString(t,false)},setCString:function(t){this.setString(t,true)},_getCharsWidth:function(t,e){if(e<=0){return 0}var i=this.getChildByTag(t);var n=this.getChildByTag(t+e);return this._getLetterPosXLeft(n)-this._getLetterPosXLeft(i)},_checkWarp:function(t,e,i,n){var r=this;var s=t[e];var a=0;for(var o=0;o<e;o++){a+=t[o].length}a=a+e-n;var c=r._getCharsWidth(a,t[e].length-1);if(c>i&&s.length>1){var l=s.length*(i/c)|0;var h=s.substr(l);var u=c-this._getCharsWidth(a+l,h.length-1);var d;var _=0;var f=0;while(u>i&&f++<100){l*=i/u;l=l|0;h=s.substr(l);u=c-this._getCharsWidth(a+l,h.length-1)}f=0;while(u<i&&f++<100){if(h){var p=cc.LabelTTF._wordRex.exec(h);_=p?p[0].length:1;d=h}if(r._lineBreakWithoutSpaces){_=0}l=l+_;h=s.substr(l);u=c-this._getCharsWidth(a+l,h.length-1)}l-=_;if(l===0){l=1;d=d.substr(1)}var m=s.substr(0,l),g;if(cc.LabelTTF.wrapInspection){if(cc.LabelTTF._symbolRex.test(d||h)){g=cc.LabelTTF._lastWordRex.exec(m);_=g?g[0].length:0;if(r._lineBreakWithoutSpaces){_=0}l-=_;d=s.substr(l);m=s.substr(0,l)}}if(cc.LabelTTF._firsrEnglish.test(d)){g=cc.LabelTTF._lastEnglish.exec(m);if(g&&m!==g[0]){_=g[0].length;if(r._lineBreakWithoutSpaces){_=0}l-=_;d=s.substr(l);m=s.substr(0,l)}}t[e]=d||h;t.splice(e,0,m)}},updateLabel:function(){var t=this;t.string=t._initialString;var e,i,n;if(t._width>0){var r=t.string.split("\n");var s="";var a=0;var o=0;for(e=0;e<r.length;e++){o=r.length;this._checkWarp(r,e,t._width*this._scaleX,a);if(o<r.length){a++}if(e>0){s+="\n"}s+=r[e]}s=s+String.fromCharCode(0);t._setString(s,false)}if(t._alignment!==cc.TEXT_ALIGNMENT_LEFT){e=0;var c=0;var l=t._string.length;var h=[];for(var u=0;u<l;u++){if(t._string[u].charCodeAt(0)===10||t._string[u].charCodeAt(0)===0){var d=0;var _=h.length;if(_===0){c++;continue}var f=e+_-1+c;if(f<0)continue;var p=t.getChildByTag(f);if(p==null)continue;d=p.getPositionX()+p._getWidth()/2;var m=0;switch(t._alignment){case cc.TEXT_ALIGNMENT_CENTER:m=t.width/2-d/2;break;case cc.TEXT_ALIGNMENT_RIGHT:m=t.width-d;break;default:break}if(m!==0){for(i=0;i<_;i++){f=e+i+c;if(f<0)continue;n=t.getChildByTag(f);if(n)n.x+=m}}e+=_;c++;h.length=0;continue}h.push(t._string[e])}}},setAlignment:function(t){this._alignment=t;this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t;this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t;this.updateLabel()},setScale:function(t,e){cc.Node.prototype.setScale.call(this,t,e);this.updateLabel()},setScaleX:function(t){cc.Node.prototype.setScaleX.call(this,t);this.updateLabel()},setScaleY:function(t){cc.Node.prototype.setScaleY.call(this,t);this.updateLabel()},setFntFile:function(t){var e=this;if(t!=null&&t!==e._fntFile){var i=cc.loader.getRes(t);if(!i){cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file");return}e._fntFile=t;e._config=i;var n=cc.textureCache.addImage(i.atlasName);var r=n.isLoaded();e._textureLoaded=r;e.texture=n;if(!r){n.addEventListener("load",function(t){var e=this;e._textureLoaded=true;e.texture=t;e.createFontChars();e._changeTextureColor();e.updateLabel();e.dispatchEvent("load")},e)}else{e.createFontChars()}}},getFntFile:function(){return this._fntFile},setTexture:function(t){this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){cc.Node.prototype.setAnchorPoint.call(this,t,e);this.updateLabel()},_setAnchorX:function(t){cc.Node.prototype._setAnchorX.call(this,t);this.updateLabel()},_setAnchorY:function(t){cc.Node.prototype._setAnchorY.call(this,t);this.updateLabel()},_atlasNameFromFntFile:function(t){},_kerningAmountForFirst:function(t,e){var i=0;var n=t<<16|e&65535;if(this._configuration.kerningDictionary){var r=this._configuration.kerningDictionary[n.toString()];if(r)i=r.amount}return i},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){t=t.charCodeAt(0);return t>=9&&t<=13||t===32||t===133||t===160||t===5760||t>=8192&&t<=8202||t===8232||t===8233||t===8239||t===8287||t===12288},_utf8_trim_ws:function(t){var e=t.length;if(e<=0)return;var i=e-1;if(this._isspace_unicode(t[i])){for(var n=i-1;n>=0;--n){if(this._isspace_unicode(t[n])){i=n}else{break}}this._utf8_trim_from(t,i)}},_utf8_trim_from:function(t,e){var i=t.length;if(e>=i||e<0)return;t.splice(e,i)}});(function(){var t=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(t);t.string;cc.defineGetterSetter(t,"string",t.getString,t._setStringForSetter);t.boundingWidth;cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth);t.textAlign;cc.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment)})();cc.LabelBMFont.create=function(t,e,i,n,r){return new cc.LabelBMFont(t,e,i,n,r)};cc._fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){var e=t.match(this.ITEM_EXP);var i={};if(e){for(var n=0,r=e.length;n<r;n++){var s=e[n];var a=s.indexOf("=");var o=s.substring(0,a);var c=s.substring(a+1);if(c.match(this.INT_EXP))c=parseInt(c);else if(c[0]==='"')c=c.substring(1,c.length-1);i[o]=c}}return i},parseFnt:function(t,e){var i=this,n={};var r=i._parseStrToObj(t.match(i.INFO_EXP)[0]);var s=r["padding"].split(",");var a={left:parseInt(s[0]),top:parseInt(s[1]),right:parseInt(s[2]),bottom:parseInt(s[3])};var o=i._parseStrToObj(t.match(i.COMMON_EXP)[0]);n.commonHeight=o["lineHeight"];if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var c=cc.configuration.getMaxTextureSize();if(o["scaleW"]>c.width||o["scaleH"]>c.height)cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}if(o["pages"]!==1)cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var l=i._parseStrToObj(t.match(i.PAGE_EXP)[0]);if(l["id"]!==0)cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found");n.atlasName=cc.path.changeBasename(e,l["file"]);var h=t.match(i.CHAR_EXP);var u=n.fontDefDictionary={};for(var d=0,_=h.length;d<_;d++){var f=i._parseStrToObj(h[d]);var p=f["id"];u[p]={rect:{x:f["x"],y:f["y"],width:f["width"],height:f["height"]},xOffset:f["xoffset"],yOffset:f["yoffset"],xAdvance:f["xadvance"]}}var m=n.kerningDict={};var g=t.match(i.KERNING_EXP);if(g){for(var d=0,_=g.length;d<_;d++){var v=i._parseStrToObj(g[d]);m[v["first"]<<16|v["second"]&65535]=v["amount"]}}return n},load:function(t,e,i,n){var r=this;cc.loader.loadTxt(t,function(t,i){if(t)return n(t);n(null,r.parseFnt(i,e))})}};cc.loader.register(["fnt"],cc._fntLoader);(function(){cc.LabelBMFont.CanvasRenderCmd=function(t){cc.SpriteBatchNode.CanvasRenderCmd.call(this,t);this._needDraw=true};var t=cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(cc.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=cc.LabelBMFont.CanvasRenderCmd;t.rendering=function(){void 0};t._updateCharTexture=function(t,e,i){if(i===32){t.setTextureRect(e,false,cc.size(0,0))}else{t.setTextureRect(e,false);t.visible=true}};t._updateCharColorAndOpacity=function(t){t._displayedColor=this._displayedColor;t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);t._displayedOpacity=this._displayedOpacity;t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)};t.setTexture=function(t){var e=this._node;var i=e._children;var n=this._displayedColor;for(var r=0;r<i.length;r++){var s=i[r];var a=s._renderCmd;var o=a._displayedColor;if(this._texture!==a._texture&&(o.r!==n.r||o.g!==n.g||o.b!==n.b))continue;s.texture=t}this._texture=t};t._changeTextureColor=function(){var t=this._node;var e=this._textureToRender,i=e.getContentSize();var n=t._texture,r=n.getHtmlElementObj();var s=this._displayedColor;var a=cc.rect(0,0,r.width,r.height);if(e&&i.width>0){if(!r)return;this._textureToRender=n._generateColorTexture(s.r,s.g,s.b,a)}};t._updateChildrenDisplayedOpacity=function(t){cc.Node.prototype.updateDisplayedOpacity.call(t,this._displayedOpacity)};t._updateChildrenDisplayedColor=function(t){cc.Node.prototype.updateDisplayedColor.call(t,this._displayedColor)};t._initBatchTexture=function(){}})();(function(){cc.LabelAtlas.WebGLRenderCmd=function(t){cc.AtlasNode.WebGLRenderCmd.call(this,t);this._needDraw=true};var t=cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(cc.AtlasNode.WebGLRenderCmd.prototype);t.constructor=cc.LabelAtlas.WebGLRenderCmd;t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=true;t._cascadeColorEnabled=true};t.rendering=function(t){cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,t);if(cc.LABELATLAS_DEBUG_DRAW){var e=this._node;var i=e.getContentSize();var n=e.getBoundingBoxToWorld();var r=n.x,s=n.y;i.width=n.width;i.height=n.height;var a=[cc.p(r,s),cc.p(r+i.width,s),cc.p(i.width+r,i.height+s),cc.p(r,s+i.height)];cc._drawingUtil.drawPoly(a,4,true)}};t.updateAtlasValues=function(){var t=this._node;var e=t._string;var i=e.length;var n=this._textureAtlas;var r=n.texture;var s=r.pixelsWidth;var a=r.pixelsHeight;var o=t._itemWidth;var c=t._itemHeight;if(!t._ignoreContentScaleFactor){o=t._itemWidth*cc.contentScaleFactor();c=t._itemHeight*cc.contentScaleFactor()}if(i>n.getCapacity())cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");var l=n.quads;var h=this._displayedColor;var u={r:h.r,g:h.g,b:h.b,a:t._displayedOpacity};var d=t._itemWidth;var _=t._itemHeight;for(var f=0,p=-1;f<i;f++){var m=e.charCodeAt(f)-t._mapStartChar.charCodeAt(0);var g=m%t._itemsPerRow;var v=0|m/t._itemsPerRow;if(g<0||v<0)continue;if(g*d+d>s||v*_+_>a)continue;p++;var y,T,C,S;if(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL){y=(2*g*o+1)/(2*s);T=y+(o*2-2)/(2*s);C=(2*v*c+1)/(2*a);S=C+(c*2-2)/(2*a)}else{y=g*o/s;T=y+o/s;C=v*c/a;S=C+c/a}var x=l[f];var E=x.tl,b=x.tr,A=x.bl,R=x.br;E.texCoords.u=y;E.texCoords.v=C;b.texCoords.u=T;b.texCoords.v=C;A.texCoords.u=y;A.texCoords.v=S;R.texCoords.u=T;R.texCoords.v=S;A.vertices.x=p*d;A.vertices.y=0;A.vertices.z=0;R.vertices.x=p*d+d;R.vertices.y=0;R.vertices.z=0;E.vertices.x=p*d;E.vertices.y=t._itemHeight;E.vertices.z=0;b.vertices.x=p*d+d;b.vertices.y=t._itemHeight;b.vertices.z=0;E.colors=u;b.colors=u;A.colors=u;R.colors=u}this.updateContentSize(f,p+1);if(i>0){n.dirty=true;var P=n.totalQuads;if(i>P)n.increaseTotalQuadsWith(i-P)}};t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;if(t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height){i.setContentSize(e*i._itemWidth,i._itemHeight)}};t.setString=function(t){var e=t.length;if(e>this._textureAtlas.totalQuads)this._textureAtlas.resizeCapacity(e)};t._addChild=function(){}})();(function(){cc.LabelBMFont.WebGLRenderCmd=function(t){cc.SpriteBatchNode.WebGLRenderCmd.call(this,t);this._needDraw=true};var t=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=cc.LabelBMFont.WebGLRenderCmd;t._updateCharTexture=function(t,e,i){t.setTextureRect(e,false);t.visible=true};t._changeTextureColor=function(){};t._updateChildrenDisplayedOpacity=function(t){t.updateDisplayedOpacity(this._displayedOpacity)};t._updateChildrenDisplayedColor=function(t){t.updateDisplayedColor(this._displayedColor)};t._initBatchTexture=function(){var t=this._node;
var e=t.textureAtlas.texture;t._opacityModifyRGB=e.hasPremultipliedAlpha();var i=t._reusedChar=new cc.Sprite;i.initWithTexture(e,cc.rect(0,0,0,0),false);i.batchNode=t};t.rendering=function(t){cc.SpriteBatchNode.WebGLRenderCmd.prototype.rendering.call(this,t);var e=this._node;if(cc.LABELBMFONT_DEBUG_DRAW){var i=e.getContentSize();var n=cc.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y);var r=[cc.p(n.x,n.y),cc.p(n.x+i.width,n.y),cc.p(n.x+i.width,n.y+i.height),cc.p(n.x,n.y+i.height)];cc._drawingUtil.setDrawColor(0,255,0,255);cc._drawingUtil.drawPoly(r,4,true)}};t._updateCharColorAndOpacity=function(){}})();cc.MotionStreak=cc.Node.extend({texture:null,fastMode:false,startingPositionInitialized:false,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,e,i,n,r){cc.Node.prototype.ctor.call(this);this._positionR=cc.p(0,0);this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this.fastMode=false;this.startingPositionInitialized=false;this.texture=null;this._stroke=0;this._fadeDelta=0;this._minSeg=0;this._maxPoints=0;this._nuPoints=0;this._previousNuPoints=0;this._pointVertexes=null;this._pointState=null;this._vertices=null;this._colorPointer=null;this._texCoords=null;this._verticesBuffer=null;this._colorPointerBuffer=null;this._texCoordsBuffer=null;if(r!==undefined)this.initWithFade(t,e,i,n,r)},getTexture:function(){return this.texture},setTexture:function(t){if(this.texture!==t)this.texture=t},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(e===undefined){this._blendFunc=t}else{this._blendFunc.src=t;this._blendFunc.dst=e}},getOpacity:function(){cc.log("cc.MotionStreak.getOpacity has not been supported.");return 0},setOpacity:function(t){cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},initWithFade:function(t,e,i,n,r){if(!r)throw new Error("cc.MotionStreak.initWithFade(): Invalid filename or texture");if(cc.isString(r))r=cc.textureCache.addImage(r);cc.Node.prototype.setPosition.call(this,cc.p(0,0));this.anchorX=0;this.anchorY=0;this.ignoreAnchor=true;this.startingPositionInitialized=false;this.fastMode=true;this._minSeg=e===-1?i/5:e;this._minSeg*=this._minSeg;this._stroke=i;this._fadeDelta=1/t;var s=(0|t*60)+2;this._maxPoints=s;this._nuPoints=0;this._pointState=new Float32Array(s);this._pointVertexes=new Float32Array(s*2);this._vertices=new Float32Array(s*4);this._texCoords=new Float32Array(s*4);this._colorPointer=new Uint8Array(s*8);this._verticesBuffer=gl.createBuffer();this._texCoordsBuffer=gl.createBuffer();this._colorPointerBuffer=gl.createBuffer();this._blendFunc.src=gl.SRC_ALPHA;this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA;this.texture=r;this.color=n;this.scheduleUpdate();gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW);return true},tintWithColor:function(t){this.color=t;var e=this._colorPointer;for(var i=0,n=this._nuPoints*2;i<n;i++){e[i*4]=t.r;e[i*4+1]=t.g;e[i*4+2]=t.b}},reset:function(){this._nuPoints=0},setPosition:function(t,e){this.startingPositionInitialized=true;if(e===undefined){this._positionR.x=t.x;this._positionR.y=t.y}else{this._positionR.x=t;this._positionR.y=e}},getPositionX:function(){return this._positionR.x},setPositionX:function(t){this._positionR.x=t;if(!this.startingPositionInitialized)this.startingPositionInitialized=true},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t;if(!this.startingPositionInitialized)this.startingPositionInitialized=true},update:function(t){if(!this.startingPositionInitialized)return;this._renderCmd._updateDisplayColor();t*=this._fadeDelta;var e,i,n,r;var s=0;var a=this._nuPoints;var o=this._pointState,c=this._pointVertexes,l=this._vertices;var h=this._colorPointer;for(n=0;n<a;n++){o[n]-=t;if(o[n]<=0)s++;else{e=n-s;if(s>0){o[e]=o[n];c[e*2]=c[n*2];c[e*2+1]=c[n*2+1];r=n*2;i=e*2;l[i*2]=l[r*2];l[i*2+1]=l[r*2+1];l[(i+1)*2]=l[(r+1)*2];l[(i+1)*2+1]=l[(r+1)*2+1];r*=4;i*=4;h[i+0]=h[r+0];h[i+1]=h[r+1];h[i+2]=h[r+2];h[i+4]=h[r+4];h[i+5]=h[r+5];h[i+6]=h[r+6]}else i=e*8;var u=o[e]*255;h[i+3]=u;h[i+7]=u}}a-=s;var d=true;if(a>=this._maxPoints)d=false;else if(a>0){var _=cc.pDistanceSQ(cc.p(c[(a-1)*2],c[(a-1)*2+1]),this._positionR)<this._minSeg;var f=a===1?false:cc.pDistanceSQ(cc.p(c[(a-2)*2],c[(a-2)*2+1]),this._positionR)<this._minSeg*2;if(_||f)d=false}if(d){c[a*2]=this._positionR.x;c[a*2+1]=this._positionR.y;o[a]=1;var p=a*8;var m=this.getDisplayedColor();h[p]=m.r;h[p+1]=m.g;h[p+2]=m.b;h[p+4]=m.r;h[p+5]=m.g;h[p+6]=m.b;h[p+3]=255;h[p+7]=255;if(a>0&&this.fastMode){if(a>1)cc.vertexLineToPolygon(c,this._stroke,this._vertices,a,1);else cc.vertexLineToPolygon(c,this._stroke,this._vertices,0,2)}a++}if(!this.fastMode)cc.vertexLineToPolygon(c,this._stroke,this._vertices,0,a);if(a&&this._previousNuPoints!==a){var g=1/a;var v=this._texCoords;for(n=0;n<a;n++){v[n*4]=0;v[n*4+1]=g*n;v[(n*2+1)*2]=1;v[(n*2+1)*2+1]=g*n}this._previousNuPoints=a}this._nuPoints=a},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.MotionStreak.WebGLRenderCmd(this);else return null}});cc.MotionStreak.create=function(t,e,i,n,r){return new cc.MotionStreak(t,e,i,n,r)};cc.MotionStreak.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};cc.MotionStreak.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.MotionStreak.WebGLRenderCmd.prototype.constructor=cc.Sprite.WebGLRenderCmd;cc.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._nuPoints<=1)return;if(e.texture&&e.texture.isLoaded()){t=t||cc._renderContext;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);cc.glBindTexture2D(e.texture);t.bindBuffer(t.ARRAY_BUFFER,e._verticesBuffer);t.bufferData(t.ARRAY_BUFFER,e._vertices,t.DYNAMIC_DRAW);t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,false,0,0);t.bindBuffer(t.ARRAY_BUFFER,e._texCoordsBuffer);t.bufferData(t.ARRAY_BUFFER,e._texCoords,t.DYNAMIC_DRAW);t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,false,0,0);t.bindBuffer(t.ARRAY_BUFFER,e._colorPointerBuffer);t.bufferData(t.ARRAY_BUFFER,e._colorPointer,t.DYNAMIC_DRAW);t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,true,0,0);t.drawArrays(t.TRIANGLE_STRIP,0,e._nuPoints*2);cc.g_NumberOfDraws++}};cc.NodeGrid=cc.Node.extend({grid:null,_target:null,_gridRect:null,ctor:function(t){cc.Node.prototype.ctor.call(this);if(t===undefined)t=cc.rect();this._gridRect=t},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},setGridRect:function(t){this._gridRect=t},getGridRect:function(){return this._gridRect},setTarget:function(t){this._target=t},_transformForWebGL:function(){var t=this._transform4x4,e=cc.current_stack.top;var i=this.getNodeToParentTransform();var n=t.mat;n[0]=i.a;n[4]=i.c;n[12]=i.tx;n[1]=i.b;n[5]=i.d;n[13]=i.ty;n[14]=this._vertexZ;e.multiply(t);if(this._camera!==null&&!(this.grid&&this.grid.isActive())){var r=this._renderCmd._anchorPointInPoints,s=r.x,a=r.y,o=s!==0||a!==0;if(o){if(!cc.SPRITEBATCHNODE_RENDER_SUBPIXEL){s=0|s;a=0|a}cc.kmGLTranslatef(s,a,0);this._camera.locate();cc.kmGLTranslatef(-s,-a,0)}else{this._camera.locate()}}},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.NodeGrid.WebGLRenderCmd(this);else return new cc.Node.CanvasRenderCmd(this)}});var _p=cc.NodeGrid.prototype;_p.grid;_p.target;cc.defineGetterSetter(_p,"target",null,_p.setTarget);cc.NodeGrid.create=function(){return new cc.NodeGrid};(function(){cc.NodeGrid.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=false;this._gridBeginCommand=new cc.CustomRenderCmd(this,this.onGridBeginDraw);this._gridEndCommand=new cc.CustomRenderCmd(this,this.onGridEndDraw)};var t=cc.NodeGrid.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.NodeGrid.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;t=t||this.getParentRenderCmd();if(e._parent&&e._parent._renderCmd)this._curLevel=e._parent._renderCmd._curLevel+1;var i=cc.current_stack;i.stack.push(i.top);this._syncStatus(t);i.top=this._stackMatrix;cc.renderer.pushRenderCommand(this._gridBeginCommand);if(e._target)e._target.visit();var n=e._children;if(n&&n.length>0){var r=n.length;e.sortAllChildren();for(var s=0;s<r;s++){var a=n[s];a&&a.visit()}}cc.renderer.pushRenderCommand(this._gridEndCommand);this._dirtyFlag=0;i.top=i.stack.pop()};t.onGridBeginDraw=function(){var t=this._node.grid;if(t&&t._active)t.beforeDraw()};t.onGridEndDraw=function(){var t=this._node.grid;if(t&&t._active)t.afterDraw(this._node)}})();cc.v2fzero=function(){return{x:0,y:0}};cc.v2f=function(t,e){return{x:t,y:e}};cc.v2fadd=function(t,e){return cc.v2f(t.x+e.x,t.y+e.y)};cc.v2fsub=function(t,e){return cc.v2f(t.x-e.x,t.y-e.y)};cc.v2fmult=function(t,e){return cc.v2f(t.x*e,t.y*e)};cc.v2fperp=function(t){return cc.v2f(-t.y,t.x)};cc.v2fneg=function(t){return cc.v2f(-t.x,-t.y)};cc.v2fdot=function(t,e){return t.x*e.x+t.y*e.y};cc.v2fforangle=function(t){return cc.v2f(Math.cos(t),Math.sin(t))};cc.v2fnormalize=function(t){var e=cc.pNormalize(cc.p(t.x,t.y));return cc.v2f(e.x,e.y)};cc.__v2f=function(t){return cc.v2f(t.x,t.y)};cc.__t=function(t){return{u:t.x,v:t.y}};cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(e===undefined){this._blendFunc.src=t.src;this._blendFunc.dst=t.dst}else{this._blendFunc.src=t;this._blendFunc.dst=e}},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r;e.g=t.g;e.b=t.b;e.a=t.a==null?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}});cc.DrawNode.create=function(){return new cc.DrawNode};cc.DrawNode.TYPE_DOT=0;cc.DrawNode.TYPE_SEGMENT=1;cc.DrawNode.TYPE_POLY=2;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){cc._DrawNodeElement=function(t,e,i,n,r,s,a,o,c){var l=this;l.type=t;l.verts=e||null;l.fillColor=i||null;l.lineWidth=n||0;l.lineColor=r||null;l.lineCap=s||"butt";l.isClosePolygon=a||false;l.isFill=o||false;l.isStroke=c||false};cc.extend(cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[];t._drawColor=this._drawColor=cc.color(255,255,255,255);t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this.init()},drawRect:function(t,e,i,n,r){n=n==null?this._lineWidth:n;r=r||this.getDrawColor();if(r.a==null)r.a=255;var s=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];var a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=s;a.lineWidth=n;a.lineColor=r;a.isClosePolygon=true;a.isStroke=true;a.lineCap="butt";a.fillColor=i;if(i){if(i.a==null)i.a=255;a.isFill=true}this._buffer.push(a)},drawCircle:function(t,e,i,n,r,s,a){s=s||this._lineWidth;a=a||this.getDrawColor();if(a.a==null)a.a=255;var o=2*Math.PI/n;var c=[];for(var l=0;l<=n;l++){var h=l*o;var u=e*Math.cos(h+i)+t.x;var d=e*Math.sin(h+i)+t.y;c.push(cc.p(u,d))}if(r){c.push(cc.p(t.x,t.y))}var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=c;_.lineWidth=s;_.lineColor=a;_.isClosePolygon=true;_.isStroke=true;this._buffer.push(_)},drawQuadBezier:function(t,e,i,n,r,s){r=r||this._lineWidth;s=s||this.getDrawColor();if(s.a==null)s.a=255;var a=[],o=0;for(var c=0;c<n;c++){var l=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x;var h=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;a.push(cc.p(l,h));o+=1/n}a.push(cc.p(i.x,i.y));var u=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);u.verts=a;u.lineWidth=r;u.lineColor=s;u.isStroke=true;u.lineCap="round";this._buffer.push(u)},drawCubicBezier:function(t,e,i,n,r,s,a){s=s||this._lineWidth;a=a||this.getDrawColor();if(a.a==null)a.a=255;var o=[],c=0;for(var l=0;l<r;l++){var h=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x;var u=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;o.push(cc.p(h,u));c+=1/r}o.push(cc.p(n.x,n.y));var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);d.verts=o;d.lineWidth=s;d.lineColor=a;d.isStroke=true;d.lineCap="round";this._buffer.push(d)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth;r=r||this.getDrawColor();if(r.a==null)r.a=255;var s=[],a,o,c=1/t.length;for(var l=0;l<i+1;l++){var h=l/i;if(h===1){a=t.length-1;o=1}else{a=0|h/c;o=(h-c*a)/c}var u=cc.cardinalSplineAt(cc.getControlPointAt(t,a-1),cc.getControlPointAt(t,a-0),cc.getControlPointAt(t,a+1),cc.getControlPointAt(t,a+2),e,o);s.push(u)}var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);d.verts=s;d.lineWidth=n;d.lineColor=r;d.isStroke=true;d.lineCap="round";this._buffer.push(d)},drawDot:function(t,e,i){i=i||this.getDrawColor();if(i.a==null)i.a=255;var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t];n.lineWidth=e;n.fillColor=i;this._buffer.push(n)},drawDots:function(t,e,i){if(!t||t.length==0)return;i=i||this.getDrawColor();if(i.a==null)i.a=255;for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)},drawSegment:function(t,e,i,n){i=i||this._lineWidth;n=n||this.getDrawColor();if(n.a==null)n.a=255;var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e];r.lineWidth=i*2;r.lineColor=n;r.isStroke=true;r.lineCap="round";this._buffer.push(r)},drawPoly_:function(t,e,i,n){i=i==null?this._lineWidth:i;n=n||this.getDrawColor();if(n.a==null)n.a=255;var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=t;r.fillColor=e;r.lineWidth=i;r.lineColor=n;r.isClosePolygon=true;r.isStroke=true;r.lineCap="round";if(e)r.isFill=true;this._buffer.push(r)},drawPoly:function(t,e,i,n){var r=[];for(var s=0;s<t.length;s++){r.push(cc.p(t[s].x,t[s].y))}return this.drawPoly_(r,e,i,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}})}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:false,_className:"DrawNodeWebGL",ctor:function(){cc.Node.prototype.ctor.call(this);this._buffer=[];this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this._drawColor=cc.color(255,255,255,255);this.init()},init:function(){if(cc.Node.prototype.init.call(this)){this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR);this._ensureCapacity(64);this._trianglesWebBuffer=cc._renderContext.createBuffer();this._dirty=true;return true}return false},drawRect:function(t,e,i,n,r){n=n==null?this._lineWidth:n;r=r||this.getDrawColor();if(r.a==null)r.a=255;var s=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];if(i==null)this._drawSegments(s,n,r,true);else this.drawPoly(s,i,n,r)},drawCircle:function(t,e,i,n,r,s,a){s=s||this._lineWidth;a=a||this.getDrawColor();if(a.a==null)a.a=255;var o=2*Math.PI/n,c=[],l,h;for(l=0;l<=n;l++){var u=l*o;var d=e*Math.cos(u+i)+t.x;var _=e*Math.sin(u+i)+t.y;c.push(cc.p(d,_))}if(r)c.push(cc.p(t.x,t.y));s*=.5;for(l=0,h=c.length;l<h-1;l++)this.drawSegment(c[l],c[l+1],s,a)},drawQuadBezier:function(t,e,i,n,r,s){r=r||this._lineWidth;s=s||this.getDrawColor();if(s.a==null)s.a=255;var a=[],o=0;for(var c=0;c<n;c++){var l=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x;var h=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;a.push(cc.p(l,h));o+=1/n}a.push(cc.p(i.x,i.y));this._drawSegments(a,r,s,false)},drawCubicBezier:function(t,e,i,n,r,s,a){s=s||this._lineWidth;a=a||this.getDrawColor();if(a.a==null)a.a=255;var o=[],c=0;for(var l=0;l<r;l++){var h=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x;var u=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;o.push(cc.p(h,u));c+=1/r}o.push(cc.p(n.x,n.y));this._drawSegments(o,s,a,false)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth;r=r||this.getDrawColor();if(r.a==null)r.a=255;var s=[],a,o,c=1/t.length;for(var l=0;l<i+1;l++){var h=l/i;if(h===1){a=t.length-1;o=1}else{a=0|h/c;o=(h-c*a)/c}var u=cc.cardinalSplineAt(cc.getControlPointAt(t,a-1),cc.getControlPointAt(t,a-0),cc.getControlPointAt(t,a+1),cc.getControlPointAt(t,a+2),e,o);s.push(u)}n*=.5;for(var d=0,_=s.length;d<_-1;d++)this.drawSegment(s[d],s[d+1],n,r)},_render:function(){var t=cc._renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer);if(this._dirty){t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW);this._dirty=false}var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,false,e,0);t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,true,e,8);t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,false,e,12);t.drawArrays(t.TRIANGLES,0,this._buffer.length*3);cc.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this;var i=e._buffer;if(i.length+t>e._bufferCapacity){var n=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;e._bufferCapacity+=Math.max(e._bufferCapacity,t);if(i==null||i.length===0){e._buffer=[];e._trianglesArrayBuffer=new ArrayBuffer(n*e._bufferCapacity);e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer)}else{var r=[];var s=new ArrayBuffer(n*e._bufferCapacity);for(var a=0;a<i.length;a++){r[a]=new cc.V2F_C4B_T2F_Triangle(i[a].a,i[a].b,i[a].c,s,a*n)}e._trianglesReader=new Uint8Array(s);e._trianglesArrayBuffer=s;e._buffer=r}}},drawDot:function(t,e,i){i=i||this.getDrawColor();if(i.a==null)i.a=255;var n={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a};var r={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}};var s={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}};var a={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}};var o={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(2*3);this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,s,a,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,a,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._dirty=true},drawDots:function(t,e,i){if(!t||t.length===0)return;i=i||this.getDrawColor();if(i.a==null)i.a=255;for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)},drawSegment:function(t,e,i,n){n=n||this.getDrawColor();if(n.a==null)n.a=255;i=i||this._lineWidth*.5;var r=6*3;this._ensureCapacity(r);var s={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a};var a=cc.__v2f(t),o=cc.__v2f(e);var c=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(o,a))),l=cc.v2fperp(c);var h=cc.v2fmult(c,i),u=cc.v2fmult(l,i);var d=cc.v2fsub(o,cc.v2fadd(h,u));var _=cc.v2fadd(o,cc.v2fsub(h,u));var f=cc.v2fsub(o,h);var p=cc.v2fadd(o,h);var m=cc.v2fsub(a,h);var g=cc.v2fadd(a,h);var v=cc.v2fsub(a,cc.v2fsub(h,u));var y=cc.v2fadd(a,cc.v2fadd(h,u));var T=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,S=this._buffer;S.push(new cc.V2F_C4B_T2F_Triangle({vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(c,l)))},{vertices:_,colors:s,texCoords:cc.__t(cc.v2fsub(c,l))},{vertices:f,colors:s,texCoords:cc.__t(cc.v2fneg(c))},C,S.length*T));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:s,texCoords:cc.__t(c)},{vertices:_,colors:s,texCoords:cc.__t(cc.v2fsub(c,l))},{vertices:f,colors:s,texCoords:cc.__t(cc.v2fneg(c))},C,S.length*T));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:s,texCoords:cc.__t(c)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(c))},{vertices:f,colors:s,texCoords:cc.__t(cc.v2fneg(c))},C,S.length*T));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:p,colors:s,texCoords:cc.__t(c)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(c))},{vertices:g,colors:s,texCoords:cc.__t(c)},C,S.length*T));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(cc.v2fsub(l,c))},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(c))},{vertices:g,colors:s,texCoords:cc.__t(c)},C,S.length*T));S.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(cc.v2fsub(l,c))},{vertices:y,colors:s,texCoords:cc.__t(cc.v2fadd(c,l))},{vertices:g,colors:s,texCoords:cc.__t(c)},C,S.length*T));this._dirty=true},drawPoly:function(t,e,i,n){if(e==null){this._drawSegments(t,i,n,true);return}if(e.a==null)e.a=255;if(n.a==null)n.a=255;i=i==null?this._lineWidth:i;i*=.5;var r={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a};var s={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a};var a=[],o,c,l,h,u=t.length;for(o=0;o<u;o++){c=cc.__v2f(t[(o-1+u)%u]);l=cc.__v2f(t[o]);h=cc.__v2f(t[(o+1)%u]);var d=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(l,c)));var _=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(h,l)));var f=cc.v2fmult(cc.v2fadd(d,_),1/(cc.v2fdot(d,_)+1));a[o]={offset:f,n:_}}var p=i>0,m=3*u-2,g=3*m;this._ensureCapacity(g);var v=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,y=this._trianglesArrayBuffer;var T=this._buffer;var C=p==false?.5:0;for(o=0;o<u-2;o++){c=cc.v2fsub(cc.__v2f(t[0]),cc.v2fmult(a[0].offset,C));l=cc.v2fsub(cc.__v2f(t[o+1]),cc.v2fmult(a[o+1].offset,C));h=cc.v2fsub(cc.__v2f(t[o+2]),cc.v2fmult(a[o+2].offset,C));T.push(new cc.V2F_C4B_T2F_Triangle({vertices:c,colors:r,texCoords:cc.__t(cc.v2fzero())},{vertices:l,colors:r,texCoords:cc.__t(cc.v2fzero())},{vertices:h,colors:r,texCoords:cc.__t(cc.v2fzero())},y,T.length*v))}for(o=0;o<u;o++){var S=(o+1)%u;c=cc.__v2f(t[o]);l=cc.__v2f(t[S]);var x=a[o].n;var E=a[o].offset;var b=a[S].offset;var A=p?cc.v2fsub(c,cc.v2fmult(E,i)):cc.v2fsub(c,cc.v2fmult(E,.5));var R=p?cc.v2fsub(l,cc.v2fmult(b,i)):cc.v2fsub(l,cc.v2fmult(b,.5));var P=p?cc.v2fadd(c,cc.v2fmult(E,i)):cc.v2fadd(c,cc.v2fmult(E,.5));var w=p?cc.v2fadd(l,cc.v2fmult(b,i)):cc.v2fadd(l,cc.v2fmult(b,.5));if(p){T.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:R,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:w,colors:s,texCoords:cc.__t(x)},y,T.length*v));T.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:P,colors:s,texCoords:cc.__t(x)},{vertices:w,colors:s,texCoords:cc.__t(x)},y,T.length*v))}else{T.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:r,texCoords:cc.__t(cc.v2fzero())},{vertices:R,colors:r,texCoords:cc.__t(cc.v2fzero())},{vertices:w,colors:r,texCoords:cc.__t(x)},y,T.length*v));T.push(new cc.V2F_C4B_T2F_Triangle({vertices:A,colors:r,texCoords:cc.__t(cc.v2fzero())},{vertices:P,colors:r,texCoords:cc.__t(x)},{vertices:w,colors:r,texCoords:cc.__t(x)},y,T.length*v))}}a=null;this._dirty=true},_drawSegments:function(t,e,i,n){e=e==null?this._lineWidth:e;i=i||this._drawColor;if(i.a==null)i.a=255;e*=.5;if(e<=0)return;var r={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a};var s=[],a,o,c,l,h=t.length;for(a=0;a<h;a++){o=cc.__v2f(t[(a-1+h)%h]);c=cc.__v2f(t[a]);l=cc.__v2f(t[(a+1)%h]);var u=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(c,o)));var d=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(l,c)));var _=cc.v2fmult(cc.v2fadd(u,d),1/(cc.v2fdot(u,d)+1));s[a]={offset:_,n:d}}var f=3*h-2,p=3*f;this._ensureCapacity(p);var m=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,g=this._trianglesArrayBuffer;var v=this._buffer;var y=n?h:h-1;for(a=0;a<y;a++){var T=(a+1)%h;o=cc.__v2f(t[a]);c=cc.__v2f(t[T]);var C=s[a].n;var S=s[a].offset;var x=s[T].offset;var E=cc.v2fsub(o,cc.v2fmult(S,e));var b=cc.v2fsub(c,cc.v2fmult(x,e));var A=cc.v2fadd(o,cc.v2fmult(S,e));var R=cc.v2fadd(c,cc.v2fmult(x,e));v.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:r,texCoords:cc.__t(cc.v2fneg(C))},{vertices:b,colors:r,texCoords:cc.__t(cc.v2fneg(C))},{vertices:R,colors:r,texCoords:cc.__t(C)},g,v.length*m));v.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:r,texCoords:cc.__t(cc.v2fneg(C))},{vertices:A,colors:r,texCoords:cc.__t(C)},{vertices:R,colors:r,texCoords:cc.__t(C)},g,v.length*m))}s=null;this._dirty=true},clear:function(){this._buffer.length=0;this._dirty=true},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}})}});(function(){cc.DrawNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._buffer=null;this._drawColor=null;this._blendFunc=null};cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd;cc.extend(cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._node;var a=s._displayedOpacity/255;if(a===0)return;n.setTransform(this._worldTransform,e,i);n.setGlobalAlpha(a);if(this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE)n.setCompositeOperation("lighter");var o=this._buffer;for(var c=0,l=o.length;c<l;c++){var h=o[c];switch(h.type){case cc.DrawNode.TYPE_DOT:this._drawDot(n,h,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,h,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(n,h,e,i);break}}},_drawDot:function(t,e,i,n){var r=e.fillColor,s=e.verts[0],a=e.lineWidth;var o=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")");o.beginPath();o.arc(s.x*i,-s.y*n,a*i,0,Math.PI*2,false);o.closePath();o.fill()},_drawSegment:function(t,e,i,n){var r=e.lineColor;var s=e.verts[0],a=e.verts[1];var o=e.lineWidth,c=e.lineCap;var l=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")");l.lineWidth=o*i;l.beginPath();l.lineCap=c;l.moveTo(s.x*i,-s.y*n);l.lineTo(a.x*i,-a.y*n);l.stroke()},_drawPoly:function(t,e,i,n){var r=e.verts,s=e.lineCap;if(r==null)return;var a=e.fillColor,o=e.lineWidth;var c=e.lineColor,l=e.isClosePolygon;var h=e.isFill,u=e.isStroke;var d=t.getContext();var _=r[0];d.lineCap=s;if(a)t.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")");if(o)d.lineWidth=o*i;if(c)t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")");d.beginPath();d.moveTo(_.x*i,-_.y*n);for(var f=1,p=r.length;f<p;f++)d.lineTo(r[f].x*i,-r[f].y*n);if(l)d.closePath();if(h)d.fill();if(u)d.stroke()}})})();(function(){cc.DrawNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true};cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd;cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);e._render()}})();cc.stencilBits=-1;cc.ClippingNode=cc.Node.extend({alphaThreshold:0,inverted:false,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null;cc.Node.prototype.ctor.call(this);this._stencil=t;this.alphaThreshold=1;this.inverted=false;this._renderCmd.initStencilBits()},init:function(t){this._stencil=t;this.alphaThreshold=1;this.inverted=false;this._renderCmd.initStencilBits();return true},onEnter:function(){cc.Node.prototype.onEnter.call(this);this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart();cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit();cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){if(this._stencil===t)return;this._renderCmd.setStencil(t)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ClippingNode.CanvasRenderCmd(this);else return new cc.ClippingNode.WebGLRenderCmd(this)}});var _p=cc.ClippingNode.prototype;cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil);_p.stencil;cc.ClippingNode.create=function(t){return new cc.ClippingNode(t)};(function(){cc.ClippingNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=false;this._godhelpme=false;this._clipElemType=false;this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback);this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback);this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var t=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ClippingNode.CanvasRenderCmd;t.initStencilBits=function(){};t.setStencil=function(t){if(t==null)return;this._node._stencil=t;if(t instanceof cc.DrawNode){if(t._buffer){for(var e=0;e<t._buffer.length;e++){t._buffer[e].isFill=false;t._buffer[e].isStroke=false}}t._renderCmd.rendering=function(e,i,n){i=i||cc.view.getScaleX();n=n||cc.view.getScaleY();var r=e||cc._renderContext,s=r.getContext();var a=this._transform;s.transform(a.a,a.b,a.c,a.d,a.tx*i,-a.ty*n);for(var o=0;o<t._buffer.length;o++){var c=t._buffer[o].verts;var l=c[0];s.moveTo(l.x*i,-l.y*n);for(var h=c.length-1;h>0;h--)s.lineTo(c[h].x*i,-c[h].y*n)}}}else{t._parent=this._node}};t._saveCmdCallback=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();if(this._clipElemType){var s=cc.ClippingNode.CanvasRenderCmd._getSharedCache();var a=r.canvas;s.width=a.width;s.height=a.height;var o=s.getContext("2d");o.drawImage(a,0,0)}else{n.save();r.beginPath();n.setTransform(this._worldTransform,e,i);if(this._node.inverted){r.rect(0,0,r.canvas.width,-r.canvas.height);r.clip()}}};t._setStencilCompositionOperation=function(t){if(!t)return;var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr)t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in";if(!t._children)return;var i=t._children;for(var n=0,r=i.length;n<r;n++){this._setStencilCompositionOperation(i[n])}};t._clipCmdCallback=function(t){var e=this._node;var i=t||cc._renderContext,n=i.getContext();if(this._clipElemType){this._setStencilCompositionOperation(e._stencil)}else{n.clip()}};t._restoreCmdCallback=function(t){var e=cc.ClippingNode.CanvasRenderCmd._getSharedCache();var i=t||cc._renderContext,n=i.getContext();if(this._clipElemType){n.save();n.setTransform(1,0,0,1,0,0);n.globalCompositeOperation="destination-over";n.drawImage(e,0,0);n.restore();this._dirtyFlag=0}else{i.restore()}};t.transform=function(t,e){cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node;if(i._stencil&&i._stencil._renderCmd)i._stencil._renderCmd.transform(this,e)};t._cangodhelpme=function(t){if(t===true||t===false)cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t;return cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme};t.visit=function(t){var e=this._node;if(!e._visible)return;t=t||this.getParentRenderCmd();if(t)this._curLevel=t._curLevel+1;var i=this;this._clipElemType=!(!this._cangodhelpme()&&e._stencil instanceof cc.DrawNode);
if(!e._stencil||!e._stencil.visible){if(this.inverted)cc.Node.CanvasRenderCmd.prototype.visit.call(this,t);return}this._syncStatus(t);cc.renderer.pushRenderCommand(this._rendererSaveCmd);if(this._clipElemType){cc.Node.CanvasRenderCmd.prototype.visit.call(this,t)}else{e._stencil.visit(this)}cc.renderer.pushRenderCommand(this._rendererClipCmd);if(this._clipElemType){e._stencil.visit(i)}else{var n,r=e._children;this._cangodhelpme(true);var s=r.length;if(s>0){e.sortAllChildren();for(n=0;n<s;n++)r[n]._renderCmd.visit(this)}this._cangodhelpme(false)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd);this._dirtyFlag=0};cc.ClippingNode.CanvasRenderCmd._sharedCache=null;cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}})();(function(){cc.ClippingNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=false;this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit);this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil);this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit);this._currentStencilFunc=null;this._currentStencilRef=null;this._currentStencilValueMask=null;this._currentStencilFail=null;this._currentStencilPassDepthFail=null;this._currentStencilPassDepthPass=null;this._currentStencilWriteMask=null;this._currentStencilEnabled=null;this._currentDepthWriteMask=null;this._mask_layer_le=null};var t=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ClippingNode.WebGLRenderCmd;cc.ClippingNode.WebGLRenderCmd._init_once=null;cc.ClippingNode.WebGLRenderCmd._visit_once=null;cc.ClippingNode.WebGLRenderCmd._layer=-1;t.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=true;if(cc.ClippingNode.WebGLRenderCmd._init_once){cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS);if(cc.stencilBits<=0)cc.log("Stencil buffer is not enabled.");cc.ClippingNode.WebGLRenderCmd._init_once=false}};t.transform=function(t,e){var i=this._node;cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e);if(i._stencil)i._stencil._renderCmd.transform(this,e)};t.visit=function(t){var e=this._node;if(!e._visible)return;if(e._parent&&e._parent._renderCmd)this._curLevel=e._parent._renderCmd._curLevel+1;if(cc.stencilBits<1){cc.Node.WebGLRenderCmd.prototype.visit.call(this,t);return}if(!e._stencil||!e._stencil.visible){if(e.inverted)cc.Node.WebGLRenderCmd.prototype.visit.call(this,t);return}if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits){cc.ClippingNode.WebGLRenderCmd._visit_once=true;if(cc.ClippingNode.WebGLRenderCmd._visit_once){cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children.");cc.ClippingNode.WebGLRenderCmd._visit_once=false}cc.Node.WebGLRenderCmd.prototype.visit.call(this,t);return}cc.renderer.pushRenderCommand(this._beforeVisitCmd);var i=cc.current_stack;i.stack.push(i.top);this._syncStatus(t);i.top=this._stackMatrix;e._stencil._renderCmd.visit(this);cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var n=e._children;if(n&&n.length>0){var r=n.length;e.sortAllChildren();for(var s=0;s<r;s++){n[s]._renderCmd.visit(this)}}cc.renderer.pushRenderCommand(this._afterVisitCmd);this._dirtyFlag=0;i.top=i.stack.pop()};t.setStencil=function(t){var e=this._node;if(e._stencil)e._stencil._parent=null;e._stencil=t;if(e._stencil)e._stencil._parent=e};t._drawFullScreenQuadClearStencil=function(){var t=cc.projection_matrix_stack;t.push();t.top.identity();var e=cc.modelview_matrix_stack;e.push();e.top.identity();cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255));t.pop();e.pop()};t._onBeforeVisit=function(t){var e=t||cc._renderContext,i=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var n=1<<cc.ClippingNode.WebGLRenderCmd._layer;var r=n-1;this._mask_layer_le=n|r;this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST);this._currentStencilWriteMask=e.getParameter(e.STENCIL_WRITEMASK);this._currentStencilFunc=e.getParameter(e.STENCIL_FUNC);this._currentStencilRef=e.getParameter(e.STENCIL_REF);this._currentStencilValueMask=e.getParameter(e.STENCIL_VALUE_MASK);this._currentStencilFail=e.getParameter(e.STENCIL_FAIL);this._currentStencilPassDepthFail=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL);this._currentStencilPassDepthPass=e.getParameter(e.STENCIL_PASS_DEPTH_PASS);e.enable(e.STENCIL_TEST);e.stencilMask(n);this._currentDepthWriteMask=e.getParameter(e.DEPTH_WRITEMASK);e.depthMask(false);e.stencilFunc(e.NEVER,n,n);e.stencilOp(!i.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP);this._drawFullScreenQuadClearStencil();e.stencilFunc(e.NEVER,n,n);e.stencilOp(!i.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP);if(i.alphaThreshold<1){var s=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);var a=e.getUniformLocation(s.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);cc.glUseProgram(s.getProgram());s.setUniformLocationWith1f(a,i.alphaThreshold);cc.setProgram(i._stencil,s)}};t._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(this._currentDepthWriteMask);e.stencilFunc(e.EQUAL,this._mask_layer_le,this._mask_layer_le);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)};t._onAfterVisit=function(t){var e=t||cc._renderContext;e.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask);e.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass);e.stencilMask(this._currentStencilWriteMask);if(!this._currentStencilEnabled)e.disable(e.STENCIL_TEST);cc.ClippingNode.WebGLRenderCmd._layer--}})();cc.GridBase=cc.Class.extend({_active:false,_reuseGrid:0,_gridSize:null,_gridRect:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:false,_shaderProgram:null,_directorProjection:0,_dirty:false,ctor:function(t,e,i,n){cc.sys._checkWebGLRenderMode();this._active=false;this._reuseGrid=0;this._gridSize=null;this._gridRect=new cc.rect;this._texture=null;this._step=cc.p(0,0);this._grabber=null;this._isTextureFlipped=false;this._shaderProgram=null;this._directorProjection=0;this._dirty=false;if(t!==undefined)this.initWithSize(t,e,i,n)},isActive:function(){return this._active},setActive:function(t){this._active=t;if(!t){var e=cc.director;var i=e.getProjection();e.setProjection(i)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(t){this._reuseGrid=t},getGridSize:function(){return cc.size(this._gridSize.width,this._gridSize.height)},setGridSize:function(t){this._gridSize.width=parseInt(t.width);this._gridSize.height=parseInt(t.height)},setGridRect:function(t){this._gridRect=t},getGridRect:function(){return this._gridRect},getStep:function(){return cc.p(this._step.x,this._step.y)},setStep:function(t){this._step.x=t.x;this._step.y=t.y},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(t){if(this._isTextureFlipped!==t){this._isTextureFlipped=t;this.calculateVertexPoints()}},initWithSize:function(t,e,i,n){if(!e){var r=cc.director;var s=r.getWinSizeInPixels();var a=cc.NextPOT(s.width);var o=cc.NextPOT(s.height);var c=new Uint8Array(a*o*4);if(!c){cc.log("cocos2d: CCGrid: not enough memory.");return false}e=new cc.Texture2D;e.initWithData(c,cc.Texture2D.PIXEL_FORMAT_RGBA8888,a,o,s);if(!e){cc.log("cocos2d: CCGrid: error creating texture");return false}}i=i||false;this._active=false;this._reuseGrid=0;this._gridSize=t;this._texture=e;this._isTextureFlipped=i;if(n===undefined||cc._rectEqualToZero(n)){var l=this._texture.getContentSize();n=new cc.rect(0,0,l.width,l.height)}this._gridRect=n;this._step.x=this._gridRect.width/t.width;this._step.y=this._gridRect.height/t.height;this._grabber=new cc.Grabber;if(!this._grabber)return false;this._grabber.grab(this._texture);this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);this.calculateVertexPoints();return true},beforeDraw:function(){this._directorProjection=cc.director.getProjection();var t=cc.director.getWinSizeInPixels();gl.viewport(0,0,t.width,t.height);this._grabber.beforeRender(this._texture)},afterDraw:function(t){this._grabber.afterRender(this._texture);cc.director.setViewport();if(t&&t.getCamera().isDirty()){var e=t.getAnchorPointInPoints();var i=t._renderCmd._stackMatrix;var n=cc.math.Matrix4.createByTranslation(e.x,e.y,0);i.multiply(n);t._camera._locateForRenderer(i);n=cc.math.Matrix4.createByTranslation(-e.x,-e.y,0,n);i.multiply(n)}cc.glBindTexture2D(this._texture);this.beforeBlit();this.blit(t);this.afterBlit()},beforeBlit:function(){},afterBlit:function(){},blit:function(){cc.log("cc.GridBase.blit(): Shall be overridden in subclass.")},reuse:function(){cc.log("cc.GridBase.reuse(): Shall be overridden in subclass.")},calculateVertexPoints:function(){cc.log("cc.GridBase.calculateVertexPoints(): Shall be overridden in subclass.")},set2DProjection:function(){var t=cc.director.getWinSizeInPixels();var e=cc._renderContext;e.viewport(0,0,t.width,t.height);cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();var i=cc.math.Matrix4.createOrthographicProjection(0,t.width,0,t.height,-1,1);cc.kmGLMultMatrix(i);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();cc.setProjectionMatrixDirty()}});cc.GridBase.create=function(t,e,i,n){return new cc.GridBase(t,e,i,n)};cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,_needDepthTestForBlit:false,_oldDepthTestValue:false,_oldDepthWriteValue:false,ctor:function(t,e,i,n){cc.GridBase.prototype.ctor.call(this);this._texCoordinates=null;this._vertices=null;this._originalVertices=null;this._indices=null;this._texCoordinateBuffer=null;this._verticesBuffer=null;this._indicesBuffer=null;if(t!==undefined)this.initWithSize(t,e,i,n)},vertex:function(t){return this.getVertex(t)},getVertex:function(t){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.Grid3D.vertex() : Numbers must be integers");var e=0|(t.x*(this._gridSize.height+1)+t.y)*3;var i=this._vertices;return new cc.Vertex3F(i[e],i[e+1],i[e+2])},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.Grid3D.originalVertex() : Numbers must be integers");var e=0|(t.x*(this._gridSize.height+1)+t.y)*3;var i=this._originalVertices;return new cc.Vertex3F(i[e],i[e+1],i[e+2])},setVertex:function(t,e){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.Grid3D.setVertex() : Numbers must be integers");var i=0|(t.x*(this._gridSize.height+1)+t.y)*3;var n=this._vertices;n[i]=e.x;n[i+1]=e.y;n[i+2]=e.z;this._dirty=true},beforeBlit:function(){if(this._needDepthTestForBlit){var t=cc._renderContext;this._oldDepthTestValue=t.isEnabled(t.DEPTH_TEST);this._oldDepthWriteValue=t.getParameter(t.DEPTH_WRITEMASK);t.enable(t.DEPTH_TEST);t.depthMask(true)}},afterBlit:function(){if(this._needDepthTestForBlit){var t=cc._renderContext;if(this._oldDepthTestValue)t.enable(t.DEPTH_TEST);else t.disable(t.DEPTH_TEST);t.depthMask(this._oldDepthWriteValue)}},blit:function(t){var e=this._gridSize.width*this._gridSize.height;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(t._renderCmd._stackMatrix);var i=cc._renderContext,n=this._dirty;i.bindBuffer(i.ARRAY_BUFFER,this._verticesBuffer);if(n)i.bufferData(i.ARRAY_BUFFER,this._vertices,i.DYNAMIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,false,0,0);i.bindBuffer(i.ARRAY_BUFFER,this._texCoordinateBuffer);if(n)i.bufferData(i.ARRAY_BUFFER,this._texCoordinates,i.DYNAMIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,false,0,0);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);if(n)i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._indices,i.STATIC_DRAW);i.drawElements(i.TRIANGLES,e*6,i.UNSIGNED_SHORT,0);if(n)this._dirty=false;cc.incrementGLDraws(1)},reuse:function(){if(this._reuseGrid>0){var t=this._originalVertices,e=this._vertices;for(var i=0,n=this._vertices.length;i<n;i++)t[i]=e[i];--this._reuseGrid}},calculateVertexPoints:function(){var t=cc._renderContext;var e=this._texture.pixelsWidth;var i=this._texture.pixelsHeight;var n=this._texture.getContentSizeInPixels().height;var r=this._gridSize;var s=(r.width+1)*(r.height+1);this._vertices=new Float32Array(s*3);this._texCoordinates=new Float32Array(s*2);this._indices=new Uint16Array(r.width*r.height*6);if(this._verticesBuffer)t.deleteBuffer(this._verticesBuffer);this._verticesBuffer=t.createBuffer();if(this._texCoordinateBuffer)t.deleteBuffer(this._texCoordinateBuffer);this._texCoordinateBuffer=t.createBuffer();if(this._indicesBuffer)t.deleteBuffer(this._indicesBuffer);this._indicesBuffer=t.createBuffer();var a,o,c,l=this._indices,h=this._texCoordinates;var u=this._isTextureFlipped,d=this._vertices;for(a=0;a<r.width;++a){for(o=0;o<r.height;++o){var _=o*r.width+a;var f=a*this._step.x+this._gridRect.x;var p=f+this._step.x;var m=o*this._step.y+this._gridRect.y;var g=m+this._step.y;var v=a*(r.height+1)+o;var y=(a+1)*(r.height+1)+o;var T=(a+1)*(r.height+1)+(o+1);var C=a*(r.height+1)+(o+1);l[_*6]=v;l[_*6+1]=y;l[_*6+2]=C;l[_*6+3]=y;l[_*6+4]=T;l[_*6+5]=C;var S=[v*3,y*3,T*3,C*3];var x={x:f,y:m,z:0};var E={x:p,y:m,z:0};var b={x:p,y:g,z:0};var A={x:f,y:g,z:0};var R=[x,E,b,A];var P=[v*2,y*2,T*2,C*2];var w=[cc.p(f,m),cc.p(p,m),cc.p(p,g),cc.p(f,g)];for(c=0;c<4;++c){d[S[c]]=R[c].x;d[S[c]+1]=R[c].y;d[S[c]+2]=R[c].z;h[P[c]]=w[c].x/e;if(u)h[P[c]+1]=(n-w[c].y)/i;else h[P[c]+1]=w[c].y/i}}}this._originalVertices=new Float32Array(this._vertices);t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer);t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer);t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW);this._dirty=true},setNeedDepthTestForBlit:function(t){this._needDepthTestForBlit=t},getNeedDepthTestForBlit:function(){return this._needDepthTestForBlit}});cc.Grid3D.create=function(t,e,i){return new cc.Grid3D(t,e,i)};cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(t,e,i,n){cc.GridBase.prototype.ctor.call(this);this._texCoordinates=null;this._vertices=null;this._originalVertices=null;this._indices=null;this._texCoordinateBuffer=null;this._verticesBuffer=null;this._indicesBuffer=null;if(t!==undefined)this.initWithSize(t,e,i,n)},tile:function(t){return this.getTile(t)},getTile:function(t){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.TiledGrid3D.tile() : Numbers must be integers");var e=(this._gridSize.height*t.x+t.y)*4*3;var i=this._vertices;return new cc.Quad3(new cc.Vertex3F(i[e],i[e+1],i[e+2]),new cc.Vertex3F(i[e+3],i[e+4],i[e+5]),new cc.Vertex3F(i[e+6],i[e+7],i[e+8]),new cc.Vertex3F(i[e+9],i[e+10],i[e+11]))},getOriginalTile:function(t){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.TiledGrid3D.originalTile() : Numbers must be integers");var e=(this._gridSize.height*t.x+t.y)*4*3;var i=this._originalVertices;return new cc.Quad3(new cc.Vertex3F(i[e],i[e+1],i[e+2]),new cc.Vertex3F(i[e+3],i[e+4],i[e+5]),new cc.Vertex3F(i[e+6],i[e+7],i[e+8]),new cc.Vertex3F(i[e+9],i[e+10],i[e+11]))},originalTile:function(t){return this.getOriginalTile(t)},setTile:function(t,e){if(t.x!==(0|t.x)||t.y!==(0|t.y))cc.log("cc.TiledGrid3D.setTile() : Numbers must be integers");var i=(this._gridSize.height*t.x+t.y)*12;var n=this._vertices;n[i]=e.bl.x;n[i+1]=e.bl.y;n[i+2]=e.bl.z;n[i+3]=e.br.x;n[i+4]=e.br.y;n[i+5]=e.br.z;n[i+6]=e.tl.x;n[i+7]=e.tl.y;n[i+8]=e.tl.z;n[i+9]=e.tr.x;n[i+10]=e.tr.y;n[i+11]=e.tr.z;this._dirty=true},blit:function(t){var e=this._gridSize.width*this._gridSize.height;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(t._renderCmd._stackMatrix);var i=cc._renderContext,n=this._dirty;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);i.bindBuffer(i.ARRAY_BUFFER,this._verticesBuffer);if(n)i.bufferData(i.ARRAY_BUFFER,this._vertices,i.DYNAMIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,false,0,this._vertices);i.bindBuffer(i.ARRAY_BUFFER,this._texCoordinateBuffer);if(n)i.bufferData(i.ARRAY_BUFFER,this._texCoordinates,i.DYNAMIC_DRAW);i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,false,0,this._texCoordinates);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);if(n)i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._indices,i.STATIC_DRAW);i.drawElements(i.TRIANGLES,e*6,i.UNSIGNED_SHORT,0);if(n)this._dirty=false;cc.incrementGLDraws(1)},reuse:function(){if(this._reuseGrid>0){var t=this._vertices,e=this._originalVertices;for(var i=0;i<t.length;i++)e[i]=t[i];--this._reuseGrid}},calculateVertexPoints:function(){var t=this._texture.pixelsWidth;var e=this._texture.pixelsHeight;var i=this._texture.getContentSizeInPixels().height;var n=this._gridSize;var r=n.width*n.height;this._vertices=new Float32Array(r*12);this._texCoordinates=new Float32Array(r*8);this._indices=new Uint16Array(r*6);var s=cc._renderContext;if(this._verticesBuffer)s.deleteBuffer(this._verticesBuffer);this._verticesBuffer=s.createBuffer();if(this._texCoordinateBuffer)s.deleteBuffer(this._texCoordinateBuffer);this._texCoordinateBuffer=s.createBuffer();if(this._indicesBuffer)s.deleteBuffer(this._indicesBuffer);this._indicesBuffer=s.createBuffer();var a,o,c=0;var l=this._step,h=this._vertices,u=this._texCoordinates,d=this._isTextureFlipped;for(a=0;a<n.width;a++){for(o=0;o<n.height;o++){var _=a*l.x;var f=_+l.x;var p=o*l.y;var m=p+l.y;h[c*12]=_;h[c*12+1]=p;h[c*12+2]=0;h[c*12+3]=f;h[c*12+4]=p;h[c*12+5]=0;h[c*12+6]=_;h[c*12+7]=m;h[c*12+8]=0;h[c*12+9]=f;h[c*12+10]=m;h[c*12+11]=0;var g=p;var v=m;if(d){g=i-p;v=i-m}u[c*8]=_/t;u[c*8+1]=g/e;u[c*8+2]=f/t;u[c*8+3]=g/e;u[c*8+4]=_/t;u[c*8+5]=v/e;u[c*8+6]=f/t;u[c*8+7]=v/e;c++}}var y=this._indices;for(a=0;a<r;a++){y[a*6+0]=a*4+0;y[a*6+1]=a*4+1;y[a*6+2]=a*4+2;y[a*6+3]=a*4+1;y[a*6+4]=a*4+2;y[a*6+5]=a*4+3}this._originalVertices=new Float32Array(this._vertices);s.bindBuffer(s.ARRAY_BUFFER,this._verticesBuffer);s.bufferData(s.ARRAY_BUFFER,this._vertices,s.DYNAMIC_DRAW);s.bindBuffer(s.ARRAY_BUFFER,this._texCoordinateBuffer);s.bufferData(s.ARRAY_BUFFER,this._texCoordinates,s.DYNAMIC_DRAW);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);s.bufferData(s.ELEMENT_ARRAY_BUFFER,this._indices,s.DYNAMIC_DRAW);this._dirty=true}});cc.TiledGrid3D.create=function(t,e,i){return new cc.TiledGrid3D(t,e,i)};cc.Grabber=cc.Class.extend({_FBO:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){cc.sys._checkWebGLRenderMode();this._gl=cc._renderContext;this._oldClearColor=[0,0,0,0];this._oldFBO=null;this._FBO=this._gl.createFramebuffer()},grab:function(t){var e=this._gl;this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,this._FBO);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._webTextureObj,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!==e.FRAMEBUFFER_COMPLETE)cc.log("Frame Grabber: could not attach texture to frmaebuffer");e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO)},beforeRender:function(t){var e=this._gl;this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,this._FBO);this._oldClearColor=e.getParameter(e.COLOR_CLEAR_VALUE);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},afterRender:function(t){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO);e.colorMask(true,true,true,true)},destroy:function(){this._gl.deleteFramebuffer(this._FBO)}});cc.GridAction=cc.ActionInterval.extend({_gridSize:null,_gridNodeTarget:null,ctor:function(t,e){cc.sys._checkWebGLRenderMode();cc.ActionInterval.prototype.ctor.call(this);this._gridSize=cc.size(0,0);e&&this.initWithDuration(t,e)},_cacheTargetAsGridNode:function(t){this._gridNodeTarget=t},clone:function(){var t=new cc.GridAction;var e=this._gridSize;t.initWithDuration(this._duration,cc.size(e.width,e.height));return t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);cc.renderer.childrenOrderDirty=true;this._cacheTargetAsGridNode(t);var e=this.getGrid();var i=this._gridNodeTarget.getGrid();if(i&&i.getReuseGrid()>0){var n=i.getGridSize();if(i.isActive()&&n.width===this._gridSize.width&&n.height===this._gridSize.height)i.reuse()}else{if(i&&i.isActive())i.setActive(false);this._gridNodeTarget.setGrid(e);this._gridNodeTarget.getGrid().setActive(true)}},reverse:function(){return new cc.ReverseTime(this)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._gridSize.width=e.width;this._gridSize.height=e.height;return true}return false},getGrid:function(){cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}});cc.gridAction=function(t,e){return new cc.GridAction(t,e)};cc.GridAction.create=cc.gridAction;cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return new cc.Grid3D(this._gridSize,undefined,undefined,this._gridNodeTarget.getGridRect())},getGridRect:function(){return this._gridNodeTarget.getGridRect()},vertex:function(t){return this.getVertex(t)},getVertex:function(t){return this.target.grid.getVertex(t)},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){return this.target.grid.originalVertex(t)},setVertex:function(t,e){this.target.grid.setVertex(t,e)}});cc.grid3DAction=function(t,e){return new cc.Grid3DAction(t,e)};cc.Grid3DAction.create=cc.grid3DAction;cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(t){return this.getTile(t)},getTile:function(t){return this.target.grid.tile(t)},originalTile:function(t){return this.getOriginalTile(t)},getOriginalTile:function(t){return this.target.grid.originalTile(t)},setTile:function(t,e){this.target.grid.setTile(t,e)},getGrid:function(){return new cc.TiledGrid3D(this._gridSize,undefined,undefined,this._gridNodeTarget.getGridRect())}});cc.tiledGrid3DAction=function(t,e){return new cc.TiledGrid3DAction(t,e)};cc.TiledGrid3DAction.create=cc.tiledGrid3DAction;cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(t){cc.ActionInstant.prototype.startWithTarget.call(this,t);cc.renderer.childrenOrderDirty=true;var e=this.target.grid;if(e&&e.isActive())e.setActive(false)}});cc.stopGrid=function(){return new cc.StopGrid};cc.StopGrid.create=cc.stopGrid;cc.ReuseGrid=cc.ActionInstant.extend({_times:null,ctor:function(t){cc.ActionInstant.prototype.ctor.call(this);t!==undefined&&this.initWithTimes(t)},initWithTimes:function(t){this._times=t;return true},startWithTarget:function(t){cc.ActionInstant.prototype.startWithTarget.call(this,t);cc.renderer.childrenOrderDirty=true;if(this.target.grid&&this.target.grid.isActive())this.target.grid.setReuseGrid(this.target.grid.getReuseGrid()+this._times)}});cc.reuseGrid=function(t){return new cc.ReuseGrid(t)};cc.ReuseGrid.create=cc.reuseGrid;cc.Waves3D=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this._waves=i;this._amplitude=n;this._amplitudeRate=1;return true}return false},update:function(t){var e=this._gridSize;var i=this._amplitude,n=cc.p(0,0);var r=this._amplitudeRate,s=this._waves;for(var a=0;a<e.width+1;++a){for(var o=0;o<e.height+1;++o){n.x=a;n.y=o;var c=this.originalVertex(n);c.z+=Math.sin(Math.PI*t*s*2+(c.y+c.x)*.01)*i*r;this.setVertex(n,c)}}}});cc.waves3D=function(t,e,i,n){return new cc.Waves3D(t,e,i,n)};cc.Waves3D.create=cc.waves3D;cc.FlipX3D=cc.Grid3DAction.extend({ctor:function(t){if(t!==undefined)cc.GridAction.prototype.ctor.call(this,t,cc.size(1,1));else cc.GridAction.prototype.ctor.call(this)},initWithDuration:function(t){return cc.Grid3DAction.prototype.initWithDuration.call(this,t,cc.size(1,1))},initWithSize:function(t,e){if(t.width!==1||t.height!==1){cc.log("Grid size must be (1,1)");return false}return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)},update:function(t){var e=Math.PI*t;var i=Math.sin(e);e=e/2;var n=Math.cos(e);var r=new cc.Vertex3F;var s=cc.p(0,0);s.x=s.y=1;var a=this.originalVertex(s);s.x=s.y=0;var o=this.originalVertex(s);var c=a.x;var l=o.x;var h;var u,d,_,f;if(c>l){u=cc.p(0,0);d=cc.p(0,1);_=cc.p(1,0);f=cc.p(1,1);h=c}else{_=cc.p(0,0);f=cc.p(0,1);u=cc.p(1,0);d=cc.p(1,1);h=l}r.x=h-h*n;r.z=Math.abs(parseFloat(h*i/4));var p=this.originalVertex(u);p.x=r.x;p.z+=r.z;this.setVertex(u,p);p=this.originalVertex(d);p.x=r.x;p.z+=r.z;this.setVertex(d,p);p=this.originalVertex(_);p.x-=r.x;p.z-=r.z;this.setVertex(_,p);p=this.originalVertex(f);p.x-=r.x;p.z-=r.z;this.setVertex(f,p)}});cc.flipX3D=function(t){return new cc.FlipX3D(t)};cc.FlipX3D.create=cc.flipX3D;cc.FlipY3D=cc.FlipX3D.extend({ctor:function(t){if(t!==undefined)cc.GridAction.prototype.ctor.call(this,t,cc.size(1,1));else cc.GridAction.prototype.ctor.call(this)},update:function(t){var e=Math.PI*t;var i=Math.sin(e);e=e/2;var n=Math.cos(e);var r=new cc.Vertex3F;var s=cc.p(0,0);s.x=s.y=1;var a=this.originalVertex(s);s.x=s.y=0;var o=this.originalVertex(s);var c=a.y;var l=o.y;var h;var u,d,_,f;if(c>l){u=cc.p(0,0);d=cc.p(0,1);_=cc.p(1,0);f=cc.p(1,1);h=c}else{d=cc.p(0,0);u=cc.p(0,1);f=cc.p(1,0);_=cc.p(1,1);h=l}r.y=h-h*n;r.z=Math.abs(parseFloat(h*i)/4);var p=this.originalVertex(u);p.y=r.y;p.z+=r.z;this.setVertex(u,p);p=this.originalVertex(d);p.y-=r.y;p.z-=r.z;this.setVertex(d,p);p=this.originalVertex(_);p.y=r.y;p.z+=r.z;this.setVertex(_,p);p=this.originalVertex(f);p.y-=r.y;p.z-=r.z;this.setVertex(f,p)}});cc.flipY3D=function(t){return new cc.FlipY3D(t)};cc.FlipY3D.create=cc.flipY3D;cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:false,_dirty:false,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);n!==undefined&&this.initWithDuration(t,e,i,n)},getLensEffect:function(){return this._lensEffect},setLensEffect:function(t){this._lensEffect=t},setConcave:function(t){this._concave=t},getPosition:function(){return this._position},setPosition:function(t){if(!cc.pointEqualToPoint(t,this._position)){this._position.x=t.x;this._position.y=t.y;this._dirty=true}},initWithDuration:function(t,e,i,n){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this.setPosition(i);this._radius=n;this._lensEffect=.7;this._dirty=true;return true}return false},update:function(t){if(this._dirty){var e=this._gridSize.width,i=this._gridSize.height;var n=this._radius,r=this._lensEffect;var s=cc.p(0,0);var a=cc.p(0,0);var o,c,l,h,u;for(var d=0;d<e+1;++d){for(var _=0;_<i+1;++_){s.x=d;s.y=_;o=this.originalVertex(s);a.x=this._position.x-o.x;a.y=this._position.y-o.y;c=cc.pLength(a);if(c<n){c=n-c;u=c/n;if(u===0)u=.001;l=Math.log(u)*r;h=Math.exp(l)*n;c=cc.pLength(a);if(c>0){a.x=a.x/c;a.y=a.y/c;a.x=a.x*h;a.y=a.y*h;o.z+=cc.pLength(a)*r}}this.setVertex(s,o)}}this._dirty=false}}});cc.lens3D=function(t,e,i,n){return new cc.Lens3D(t,e,i,n)};cc.Lens3D.create=cc.lens3D;cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:0,_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n,r,s){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);s!==undefined&&this.initWithDuration(t,e,i,n,r,s)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x;this._position.y=t.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r,s){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this.setPosition(i);this._radius=n;this._waves=r;this._amplitude=s;this._amplitudeRate=1;return true}return false},update:function(t){var e=this._gridSize.width,i=this._gridSize.height;var n=cc.p(0,0),r=this._radius;var s=this._waves,a=this._amplitude,o=this._amplitudeRate;var c,l,h=cc.p(0,0);for(var u=0;u<e+1;++u){for(var d=0;d<i+1;++d){n.x=u;n.y=d;c=this.originalVertex(n);h.x=this._position.x-c.x;h.y=this._position.y-c.y;l=cc.pLength(h);if(l<r){l=r-l;var _=Math.pow(l/r,2);c.z+=Math.sin(t*Math.PI*s*2+l*.1)*a*o*_}this.setVertex(n,c)}}}});cc.ripple3D=function(t,e,i,n,r,s){return new cc.Ripple3D(t,e,i,n,r,s)};cc.Ripple3D.create=cc.ripple3D;cc.Shaky3D=cc.Grid3DAction.extend({_randRange:0,_shakeZ:false,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this._randRange=i;this._shakeZ=n;return true}return false},update:function(t){var e=this._gridSize.width,i=this._gridSize.height;var n=this._randRange,r=this._shakeZ,s=cc.p(0,0);var a;for(var o=0;o<e+1;++o){for(var c=0;c<i+1;++c){s.x=o;s.y=c;a=this.originalVertex(s);a.x+=cc.rand()%(n*2)-n;a.y+=cc.rand()%(n*2)-n;if(r)a.z+=cc.rand()%(n*2)-n;this.setVertex(s,a)}}}});cc.shaky3D=function(t,e,i,n){return new cc.Shaky3D(t,e,i,n)};cc.Shaky3D.create=cc.shaky3D;cc.Liquid=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this._waves=i;this._amplitude=n;this._amplitudeRate=1;return true}return false},update:function(t){var e=this._gridSize.width,i=this._gridSize.height,n=cc.p(0,0);var r=this._waves,s=this._amplitude,a=this._amplitudeRate;var o;for(var c=1;c<e;++c){for(var l=1;l<i;++l){n.x=c;n.y=l;o=this.originalVertex(n);o.x=o.x+Math.sin(t*Math.PI*r*2+o.x*.01)*s*a;o.y=o.y+Math.sin(t*Math.PI*r*2+o.y*.01)*s*a;this.setVertex(n,o)}}}});cc.liquid=function(t,e,i,n){return new cc.Liquid(t,e,i,n)};cc.Liquid.create=cc.liquid;cc.Waves=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,_vertical:false,_horizontal:false,ctor:function(t,e,i,n,r,s){cc.GridAction.prototype.ctor.call(this);s!==undefined&&this.initWithDuration(t,e,i,n,r,s)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r,s){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this._waves=i;this._amplitude=n;this._amplitudeRate=1;this._horizontal=r;this._vertical=s;return true}return false},update:function(t){var e=this._gridSize.width,i=this._gridSize.height,n=cc.p(0,0);var r=this._vertical,s=this._horizontal;var a=this._waves,o=this._amplitude,c=this._amplitudeRate;var l;for(var h=0;h<e+1;++h){for(var u=0;u<i+1;++u){n.x=h;n.y=u;l=this.originalVertex(n);if(r)l.x=l.x+Math.sin(t*Math.PI*a*2+l.y*.01)*o*c;if(s)l.y=l.y+Math.sin(t*Math.PI*a*2+l.x*.01)*o*c;this.setVertex(n,l)}}}});cc.waves=function(t,e,i,n,r,s){return new cc.Waves(t,e,i,n,r,s)};cc.Waves.create=cc.waves;cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n,r){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);r!==undefined&&this.initWithDuration(t,e,i,n,r)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x;this._position.y=t.y},getAmplitude:function(){
return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n,r){if(cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)){this.setPosition(i);this._twirls=n;this._amplitude=r;this._amplitudeRate=1;return true}return false},update:function(t){var e=this._position;var i=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0);var s=.1*this._amplitude*this._amplitudeRate;var a=this._twirls;var o,c,l,h,u=cc.p(0,0);for(var d=0;d<i+1;++d){for(var _=0;_<n+1;++_){r.x=d;r.y=_;o=this.originalVertex(r);u.x=d-i/2;u.y=_-n/2;c=cc.pLength(u)*Math.cos(Math.PI/2+t*Math.PI*a*2)*s;l=Math.sin(c)*(o.y-e.y)+Math.cos(c)*(o.x-e.x);h=Math.cos(c)*(o.y-e.y)-Math.sin(c)*(o.x-e.x);o.x=e.x+l;o.y=e.y+h;this.setVertex(r,o)}}}});cc.twirl=function(t,e,i,n,r){return new cc.Twirl(t,e,i,n,r)};cc.Twirl.create=cc.twirl;cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:false,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._randRange=i;this._shakeZ=n;return true}return false},update:function(t){var e=this._gridSize,i=this._randRange;var n=cc.p(0,0);for(var r=0;r<e.width;++r){for(var s=0;s<e.height;++s){n.x=r;n.y=s;var a=this.originalTile(n);a.bl.x+=cc.rand()%(i*2)-i;a.br.x+=cc.rand()%(i*2)-i;a.tl.x+=cc.rand()%(i*2)-i;a.tr.x+=cc.rand()%(i*2)-i;a.bl.y+=cc.rand()%(i*2)-i;a.br.y+=cc.rand()%(i*2)-i;a.tl.y+=cc.rand()%(i*2)-i;a.tr.y+=cc.rand()%(i*2)-i;if(this._shakeZ){a.bl.z+=cc.rand()%(i*2)-i;a.br.z+=cc.rand()%(i*2)-i;a.tl.z+=cc.rand()%(i*2)-i;a.tr.z+=cc.rand()%(i*2)-i}this.setTile(n,a)}}}});cc.shakyTiles3D=function(t,e,i,n){return new cc.ShakyTiles3D(t,e,i,n)};cc.ShakyTiles3D.create=cc.shakyTiles3D;cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:false,_shatterZ:false,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._once=false;this._randRange=i;this._shatterZ=n;return true}return false},update:function(t){if(this._once===false){var e=this._gridSize,i=this._randRange;var n,r=cc.p(0,0);for(var s=0;s<e.width;++s){for(var a=0;a<e.height;++a){r.x=s;r.y=a;n=this.originalTile(r);n.bl.x+=cc.rand()%(i*2)-i;n.br.x+=cc.rand()%(i*2)-i;n.tl.x+=cc.rand()%(i*2)-i;n.tr.x+=cc.rand()%(i*2)-i;n.bl.y+=cc.rand()%(i*2)-i;n.br.y+=cc.rand()%(i*2)-i;n.tl.y+=cc.rand()%(i*2)-i;n.tr.y+=cc.rand()%(i*2)-i;if(this._shatterZ){n.bl.z+=cc.rand()%(i*2)-i;n.br.z+=cc.rand()%(i*2)-i;n.tl.z+=cc.rand()%(i*2)-i;n.tr.z+=cc.rand()%(i*2)-i}this.setTile(r,n)}}this._once=true}}});cc.shatteredTiles3D=function(t,e,i,n){return new cc.ShatteredTiles3D(t,e,i,n)};cc.ShatteredTiles3D.create=cc.shatteredTiles3D;cc.Tile=function(t,e,i){this.position=t||cc.p(0,0);this.startPosition=e||cc.p(0,0);this.delta=i||cc.p(0,0)};cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(t,e,i){cc.GridAction.prototype.ctor.call(this);this._tilesOrder=[];this._tiles=[];i!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._seed=i;this._tilesOrder.length=0;this._tiles.length=0;return true}return false},shuffle:function(t,e){for(var i=e-1;i>=0;i--){var n=0|cc.rand()%(i+1);var r=t[i];t[i]=t[n];t[n]=r}},getDelta:function(t){var e=this._gridSize;var i=t.width*e.height+t.height;return cc.size(this._tilesOrder[i]/e.height-t.width,this._tilesOrder[i]%e.height-t.height)},placeTile:function(t,e){var i=this.originalTile(t);var n=this.target.grid.getStep();var r=e.position;i.bl.x+=r.x*n.x;i.bl.y+=r.y*n.y;i.br.x+=r.x*n.x;i.br.y+=r.y*n.y;i.tl.x+=r.x*n.x;i.tl.y+=r.y*n.y;i.tr.x+=r.x*n.x;i.tr.y+=r.y*n.y;this.setTile(t,i)},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t);var e=this._gridSize;this._tilesCount=e.width*e.height;var i=this._tilesOrder;i.length=0;for(var n=0;n<this._tilesCount;++n)i[n]=n;this.shuffle(i,this._tilesCount);var r=this._tiles;r.length=0;var s=0,a=cc.size(0,0);for(var o=0;o<e.width;++o){for(var c=0;c<e.height;++c){r[s]=new cc.Tile;r[s].position=cc.p(o,c);r[s].startPosition=cc.p(o,c);a.width=o;a.height=c;r[s].delta=this.getDelta(a);++s}}},update:function(t){var e=0,i=this._gridSize,n=this._tiles;var r,s=cc.p(0,0);for(var a=0;a<i.width;++a){for(var o=0;o<i.height;++o){s.x=a;s.y=o;r=n[e];r.position.x=r.delta.width*t;r.position.y=r.delta.height*t;this.placeTile(s,r);++e}}}});cc.shuffleTiles=function(t,e,i){return new cc.ShuffleTiles(t,e,i)};cc.ShuffleTiles.create=cc.shuffleTiles;cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(t,e){var i=this._gridSize.width*e;var n=this._gridSize.height*e;if(i===this._gridSize.width&&n===this._gridSize.height)return 0;if(i+n===0)return 1;return Math.pow((t.x+t.y)/(i+n),6)},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new cc.Quad3)},transformTile:function(t,e){var i=this.originalTile(t);var n=this.target.grid.getStep();i.bl.x+=n.x/2*(1-e);i.bl.y+=n.y/2*(1-e);i.br.x-=n.x/2*(1-e);i.br.y+=n.y/2*(1-e);i.tl.x+=n.x/2*(1-e);i.tl.y-=n.y/2*(1-e);i.tr.x-=n.x/2*(1-e);i.tr.y-=n.y/2*(1-e);this.setTile(t,i)},update:function(t){var e=this._gridSize;var i=cc.p(0,0),n;for(var r=0;r<e.width;++r){for(var s=0;s<e.height;++s){i.x=r;i.y=s;n=this.testFunc(i,t);if(n===0)this.turnOffTile(i);else if(n<1)this.transformTile(i,n);else this.turnOnTile(i)}}}});cc.fadeOutTRTiles=function(t,e){return new cc.FadeOutTRTiles(t,e)};cc.FadeOutTRTiles.create=cc.fadeOutTRTiles;cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(t,e){var i=this._gridSize.width*(1-e);var n=this._gridSize.height*(1-e);if(i+n===0)return 0;if(t.x+t.y===0)return 1;return Math.pow((i+n)/(t.x+t.y),6)}});cc.fadeOutBLTiles=function(t,e){return new cc.FadeOutBLTiles(t,e)};cc.FadeOutBLTiles.create=cc.fadeOutBLTiles;cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(t,e){var i=this._gridSize.height*e;if(i===this._gridSize.height)return 0;if(i===0)return 1;return Math.pow(t.y/i,6)},transformTile:function(t,e){var i=this.originalTile(t);var n=this.target.grid.getStep();i.bl.y+=n.y/2*(1-e);i.br.y+=n.y/2*(1-e);i.tl.y-=n.y/2*(1-e);i.tr.y-=n.y/2*(1-e);this.setTile(t,i)}});cc.fadeOutUpTiles=function(t,e){return new cc.FadeOutUpTiles(t,e)};cc.FadeOutUpTiles.create=cc.fadeOutUpTiles;cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(t,e){var i=this._gridSize.height*(1-e);if(i===0)return 0;if(t.y===0)return 1;return Math.pow(i/t.y,6)}});cc.fadeOutDownTiles=function(t,e){return new cc.FadeOutDownTiles(t,e)};cc.FadeOutDownTiles.create=cc.fadeOutDownTiles;cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(t,e,i){cc.GridAction.prototype.ctor.call(this);this._tilesOrder=[];e!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._seed=i||0;this._tilesOrder.length=0;return true}return false},shuffle:function(t,e){for(var i=e-1;i>=0;i--){var n=0|cc.rand()%(i+1);var r=t[i];t[i]=t[n];t[n]=r}},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new cc.Quad3)},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t);this._tilesCount=this._gridSize.width*this._gridSize.height;var e=this._tilesOrder;e.length=0;for(var i=0;i<this._tilesCount;++i)e[i]=i;this.shuffle(e,this._tilesCount)},update:function(t){var e=0|t*this._tilesCount,i=this._gridSize;var n,r=cc.p(0,0),s=this._tilesOrder;for(var a=0;a<this._tilesCount;a++){n=s[a];r.x=0|n/i.height;r.y=n%(0|i.height);if(a<e)this.turnOffTile(r);else this.turnOnTile(r)}}});cc.turnOffTiles=function(t,e,i){return new cc.TurnOffTiles(t,e,i)};cc.TurnOffTiles.create=cc.turnOffTiles;cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._waves=i;this._amplitude=n;this._amplitudeRate=1;return true}return false},update:function(t){var e=this._gridSize,i=this._waves,n=this._amplitude,r=this._amplitudeRate;var s=cc.p(0,0),a;for(var o=0;o<e.width;o++){for(var c=0;c<e.height;c++){s.x=o;s.y=c;a=this.originalTile(s);a.bl.z=Math.sin(t*Math.PI*i*2+(a.bl.y+a.bl.x)*.01)*n*r;a.br.z=a.bl.z;a.tl.z=a.bl.z;a.tr.z=a.bl.z;this.setTile(s,a)}}}});cc.wavesTiles3D=function(t,e,i,n){return new cc.WavesTiles3D(t,e,i,n)};cc.WavesTiles3D.create=cc.wavesTiles3D;cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,i,n){cc.GridAction.prototype.ctor.call(this);n!==undefined&&this.initWithDuration(t,e,i,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,i,n){if(cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)){this._jumps=i;this._amplitude=n;this._amplitudeRate=1;return true}return false},update:function(t){var e=Math.sin(Math.PI*t*this._jumps*2)*this._amplitude*this._amplitudeRate;var i=Math.sin(Math.PI*(t*this._jumps*2+1))*this._amplitude*this._amplitudeRate;var n=this._gridSize;var r=this.target.grid;var s,a=cc.p(0,0);for(var o=0;o<n.width;o++){for(var c=0;c<n.height;c++){a.x=o;a.y=c;s=r.originalTile(a);if((o+c)%2===0){s.bl.z+=e;s.br.z+=e;s.tl.z+=e;s.tr.z+=e}else{s.bl.z+=i;s.br.z+=i;s.tl.z+=i;s.tr.z+=i}r.setTile(a,s)}}}});cc.jumpTiles3D=function(t,e,i,n){return new cc.JumpTiles3D(t,e,i,n)};cc.JumpTiles3D.create=cc.jumpTiles3D;cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(t,e){cc.GridAction.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e)},initWithDuration:function(t,e){this._rows=e;return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,cc.size(1,e))},update:function(t){var e=this._gridSize,i=this._winSize.width;var n,r,s=cc.p(0,0);for(var a=0;a<e.height;++a){s.y=a;n=this.originalTile(s);r=1;if(a%2===0)r=-1;n.bl.x+=r*i*t;n.br.x+=r*i*t;n.tl.x+=r*i*t;n.tr.x+=r*i*t;this.setTile(s,n)}},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t);this._winSize=cc.director.getWinSizeInPixels()}});cc.splitRows=function(t,e){return new cc.SplitRows(t,e)};cc.SplitRows.create=cc.splitRows;cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(t,e){cc.GridAction.prototype.ctor.call(this);e!==undefined&&this.initWithDuration(t,e)},initWithDuration:function(t,e){this._cols=e;return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,cc.size(e,1))},update:function(t){var e=this._gridSize.width,i=this._winSize.height;var n,r,s=cc.p(0,0);for(var a=0;a<e;++a){s.x=a;n=this.originalTile(s);r=1;if(a%2===0)r=-1;n.bl.y+=r*i*t;n.br.y+=r*i*t;n.tl.y+=r*i*t;n.tr.y+=r*i*t;this.setTile(s,n)}cc.renderer.childrenOrderDirty=true},startWithTarget:function(t){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t);this._winSize=cc.director.getWinSizeInPixels()}});cc.splitCols=function(t,e){return new cc.SplitCols(t,e)};cc.SplitCols.create=cc.splitCols;cc.PageTurn3D=cc.Grid3DAction.extend({getGrid:function(){var t=new cc.Grid3D(this._gridSize,undefined,undefined,this._gridNodeTarget.getGridRect());t.setNeedDepthTestForBlit(true);return t},clone:function(){var t=new cc.PageTurn3D;t.initWithDuration(this._duration,this._gridSize);return t},update:function(t){var e=Math.max(0,t-.25);var i=e*e*500;var n=-100-i;var r=Math.sqrt(t);var s=r>.5?Math.PI/2*r:Math.PI/2*(1-r);var a=(2-t)*Math.PI;var o=Math.sin(s);var c=Math.cos(s);var l=this._gridSize;var h=cc.p(0,0);for(var u=0;u<=l.width;++u){for(var d=0;d<=l.height;++d){h.x=u;h.y=d;var _=this.getOriginalVertex(h);_.x-=this.getGridRect().x;var f=Math.sqrt(_.x*_.x+(_.y-n)*(_.y-n));var p=f*o;var m=Math.asin(_.x/f);var g=m/o;var v=Math.cos(g);if(g<=Math.PI)_.x=p*Math.sin(g);else _.x=0;_.y=f+n-p*(1-v)*o;_.z=p*(1-v)*c;_.x=_.z*Math.sin(a)+_.x*Math.cos(a);_.z=_.z*Math.cos(a)-_.x*Math.cos(a);_.z/=7;if(_.z<.5)_.z=.5;_.x+=this.getGridRect().x;this.setVertex(h,_)}}}});cc.pageTurn3D=function(t,e){return new cc.PageTurn3D(t,e)};cc.PageTurn3D.create=cc.pageTurn3D;cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:false,_className:"ProgressTimer",ctor:function(t){cc.Node.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=false;this._sprite=null;t&&this.initWithSprite(t)},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){if(this._percentage!==t){this._percentage=cc.clampf(t,0,100);this._renderCmd._updateProgress()}},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){if(this._reverseDirection!==t){this._reverseDirection=t;this._renderCmd.releaseData()}},setSprite:function(t){if(this._sprite!==t){this._sprite=t;if(t)this.setContentSize(t.width,t.height);else this.setContentSize(0,0);this._renderCmd.releaseData()}},setType:function(t){if(t!==this._type){this._type=t;this._renderCmd.releaseData()}},setReverseDirection:function(t){if(this._reverseDirection!==t){this._reverseDirection=t;this._renderCmd.releaseData()}},initWithSprite:function(t){this.percentage=0;this.setAnchorPoint(.5,.5);this._type=cc.ProgressTimer.TYPE_RADIAL;this._reverseDirection=false;this.midPoint=cc.p(.5,.5);this.barChangeRate=cc.p(1,1);this.setSprite(t);this._renderCmd.initCmd();return true},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ProgressTimer.CanvasRenderCmd(this);else return new cc.ProgressTimer.WebGLRenderCmd(this)}});var _p=cc.ProgressTimer.prototype;_p.midPoint;cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint);_p.barChangeRate;cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate);_p.type;cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);_p.percentage;cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);_p.sprite;cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite);_p.reverseDir;cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection);cc.ProgressTimer.create=function(t){return new cc.ProgressTimer(t)};cc.ProgressTimer.TEXTURE_COORDS_COUNT=4;cc.ProgressTimer.TEXTURE_COORDS=75;cc.ProgressTimer.TYPE_RADIAL=0;cc.ProgressTimer.TYPE_BAR=1;(function(){cc.ProgressTimer.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._PI180=Math.PI/180;this._barRect=cc.rect(0,0,0,0);this._origin=cc.p(0,0);this._radius=0;this._startAngle=270;this._endAngle=270;this._counterClockWise=false};var t=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ProgressTimer.CanvasRenderCmd;t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._node,a=s._sprite;var o=a._renderCmd._textureCoord,c=a._renderCmd._displayedOpacity/255;if(o.width===0||o.height===0)return;if(!a._texture||!o.validRect||c===0)return;n.setTransform(this._worldTransform,e,i);n.setCompositeOperation(a._blendFuncStr);n.setGlobalAlpha(c);var l=a._rect,h=a._offsetPosition;var u=h.x,d=-h.y-l.height,_=l.width,f=l.height;n.save();if(a._flippedX){u=-u-_;r.scale(-1,1)}if(a._flippedY){d=h.y;r.scale(1,-1)}if(s._type===cc.ProgressTimer.TYPE_BAR){var p=this._barRect;r.beginPath();r.rect(p.x*e,p.y*i,p.width*e,p.height*i);r.clip();r.closePath()}else if(s._type===cc.ProgressTimer.TYPE_RADIAL){var m=this._origin.x*e;var g=this._origin.y*i;r.beginPath();r.arc(m,g,this._radius*i,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise);r.lineTo(m,g);r.clip();r.closePath()}var v=a._texture.getHtmlElementObj();if(a._renderCmd._colorized){r.drawImage(v,0,0,o.width,o.height,u*e,d*i,_*e,f*i)}else{r.drawImage(v,o.renderX,o.renderY,o.width,o.height,u*e,d*i,_*e,f*i)}n.restore();cc.g_NumberOfDraws++};t.releaseData=function(){};t.initCmd=function(){};t._updateProgress=function(){var t=this._node;var e=t._sprite;var i=e.width,n=e.height;var r=t._midPoint;if(t._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(i*i+n*n));var s,a,o=false,c=this._origin;c.x=i*r.x;c.y=-n*r.y;if(t._reverseDirection){a=270;s=270-3.6*t._percentage}else{s=-90;a=-90+3.6*t._percentage}if(e._flippedX){c.x-=i*(t._midPoint.x*2);s=-s;a=-a;s-=180;a-=180;o=!o}if(e._flippedY){c.y+=n*(t._midPoint.y*2);o=!o;s=-s;a=-a}this._startAngle=s;this._endAngle=a;this._counterClockWise=o}else{var l=t._barChangeRate;var h=t._percentage/100;var u=this._barRect;var d=cc.size(i*(1-l.x),n*(1-l.y));var _=cc.size((i-d.width)*h,(n-d.height)*h);var f=cc.size(d.width+_.width,d.height+_.height);var p=cc.p(i*r.x,n*r.y);var m=p.x-f.width/2;if(r.x>.5&&f.width/2>=i-p.x)m=i-f.width;var g=p.y-f.height/2;if(r.y>.5&&f.height/2>=n-p.y)g=n-f.height;u.x=0;var v=1;if(e._flippedX){u.x-=f.width;v=-1}if(m>0)u.x+=m*v;u.y=0;var y=1;if(e._flippedY){u.y+=f.height;y=-1}if(g>0)u.y-=g*y;u.width=f.width;u.height=-f.height}};t._updateColor=function(){};t._syncStatus=function(t){var e=this._node;if(!e._sprite)return;var i=cc.Node._dirtyFlags,n=this._dirtyFlag;var r=t?t._node:null;if(r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty)n|=i.colorDirty;if(r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty)n|=i.opacityDirty;if(t&&t._dirtyFlag&i.transformDirty)n|=i.transformDirty;this._dirtyFlag=n;var s=e._sprite._renderCmd;var a=s._dirtyFlag;var o=a&i.colorDirty,c=a&i.opacityDirty;if(o){s._syncDisplayColor()}if(c){s._syncDisplayOpacity()}if(o||c){s._updateColor()}if(n&i.transformDirty){this.transform(t)}if(n&i.orderDirty){this._dirtyFlag=this._dirtyFlag&i.orderDirty^this._dirtyFlag}};t.updateStatus=function(){var t=this._node;if(!t._sprite)return;var e=cc.Node._dirtyFlags,i=this._dirtyFlag;var n=t._sprite._renderCmd;var r=n._dirtyFlag;var s=r&e.colorDirty,a=r&e.opacityDirty;if(s){n._updateDisplayColor()}if(a){n._updateDisplayOpacity()}if(s||a){n._updateColor()}if(i&e.transformDirty){this.transform(this.getParentRenderCmd(),true)}this._dirtyFlag=0}})();cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this);this._to=0;this._from=0;e!==undefined&&this.initWithDuration(t,e)},initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._to=e;return true}return false},clone:function(){var t=new cc.ProgressTo;t.initWithDuration(this._duration,this._to);return t},reverse:function(){cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported.");return null},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._from=t.percentage},update:function(t){if(this.target instanceof cc.ProgressTimer)this.target.percentage=this._from+(this._to-this._from)*t}});cc.progressTo=function(t,e){return new cc.ProgressTo(t,e)};cc.ProgressTo.create=cc.progressTo;cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this);this._to=0;this._from=0;i!==undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._to=i;this._from=e;return true}return false},clone:function(){var t=new cc.ProgressFromTo;t.initWithDuration(this._duration,this._from,this._to);return t},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){if(this.target instanceof cc.ProgressTimer)this.target.percentage=this._from+(this._to-this._from)*t}});cc.progressFromTo=function(t,e,i){return new cc.ProgressFromTo(t,e,i)};cc.ProgressFromTo.create=cc.progressFromTo;(function(){cc.ProgressTimer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._vertexWebGLBuffer=cc._renderContext.createBuffer();this._vertexDataCount=0;this._vertexData=null;this._vertexArrayBuffer=null;this._vertexDataDirty=false};var t=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ProgressTimer.WebGLRenderCmd;t.rendering=function(t){var e=this._node;var i=t||cc._renderContext;if(!this._vertexData||!e._sprite)return;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);var n=e._sprite._blendFunc;cc.glBlendFunc(n.src,n.dst);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);cc.glBindTexture2D(e._sprite.texture);i.bindBuffer(i.ARRAY_BUFFER,this._vertexWebGLBuffer);if(this._vertexDataDirty){i.bufferData(i.ARRAY_BUFFER,this._vertexArrayBuffer,i.DYNAMIC_DRAW);this._vertexDataDirty=false}var r=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,false,r,0);i.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,true,r,8);i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,false,r,12);if(e._type===cc.ProgressTimer.TYPE_RADIAL)i.drawArrays(i.TRIANGLE_FAN,0,this._vertexDataCount);else if(e._type===cc.ProgressTimer.TYPE_BAR){if(!e._reverseDirection)i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount);else{i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount/2);i.drawArrays(i.TRIANGLE_STRIP,4,this._vertexDataCount/2);cc.g_NumberOfDraws++}}cc.g_NumberOfDraws++};t._syncStatus=function(t){var e=this._node;if(!e._sprite)return;var i=cc.Node._dirtyFlags,n=this._dirtyFlag;var r=t?t._node:null;if(r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty)n|=i.colorDirty;if(r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty)n|=i.opacityDirty;if(t&&t._dirtyFlag&i.transformDirty)n|=i.transformDirty;this._dirtyFlag=n;var s=e._sprite._renderCmd;var a=s._dirtyFlag;var o=a&i.colorDirty,c=a&i.opacityDirty;if(o){s._syncDisplayColor()}if(c){s._syncDisplayOpacity()}if(o||c){s._updateColor();this._updateColor()}this.transform(t);s._dirtyFlag=0};t.updateStatus=function(){var t=this._node;if(!t._sprite)return;var e=cc.Node._dirtyFlags,i=this._dirtyFlag;var n=t._sprite._renderCmd;var r=n._dirtyFlag;var s=r&e.colorDirty,a=r&e.opacityDirty;if(s){n._updateDisplayColor();this._dirtyFlag=this._dirtyFlag&e.colorDirty^this._dirtyFlag}if(a){n._updateDisplayOpacity();this._dirtyFlag=this._dirtyFlag&e.opacityDirty^this._dirtyFlag}if(s||a){n._updateColor();this._updateColor()}if(i&e.transformDirty){this.transform(this.getParentRenderCmd(),true)}if(i&e.orderDirty){this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag}};t.releaseData=function(){if(this._vertexData){this._vertexData=null;this._vertexArrayBuffer=null;this._vertexDataCount=0}};t.initCmd=function(){this._vertexData=null;this._vertexArrayBuffer=null;this._vertexDataCount=0;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};t._updateProgress=function(){var t=this._node;var e=t._type;if(e===cc.ProgressTimer.TYPE_RADIAL)this._updateRadial();else if(e===cc.ProgressTimer.TYPE_BAR)this._updateBar();this._vertexDataDirty=true};t._updateBar=function(){var t=this._node;if(!t._sprite)return;var e,i=t._percentage/100;var n=t._barChangeRate;var r=cc.pMult(cc.p(1-n.x+i*n.x,1-n.y+i*n.y),.5);var s=cc.pSub(t._midPoint,r),a=cc.pAdd(t._midPoint,r);if(s.x<0){a.x+=-s.x;s.x=0}if(a.x>1){s.x-=a.x-1;a.x=1}if(s.y<0){a.y+=-s.y;s.y=0}if(a.y>1){s.y-=a.y-1;a.y=1}var o;if(!this._reverseDirection){if(!this._vertexData){this._vertexDataCount=4;var c=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,l=4;this._vertexArrayBuffer=new ArrayBuffer(l*c);this._vertexData=[];for(e=0;e<l;e++)this._vertexData[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*c)}o=this._vertexData;o[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,a.y));o[0].vertices=this._vertexFromAlphaPoint(cc.p(s.x,a.y));o[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,s.y));o[1].vertices=this._vertexFromAlphaPoint(cc.p(s.x,s.y));o[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,a.y));o[2].vertices=this._vertexFromAlphaPoint(cc.p(a.x,a.y));o[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,s.y));o[3].vertices=this._vertexFromAlphaPoint(cc.p(a.x,s.y))}else{if(!this._vertexData){this._vertexDataCount=8;var h=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,u=8;this._vertexArrayBuffer=new ArrayBuffer(u*h);var d=[];for(e=0;e<u;e++)d[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*h);d[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1));d[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1));d[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0));d[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0));d[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1));d[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1));d[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,0));d[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0));this._vertexData=d}o=this._vertexData;o[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,a.y));o[2].vertices=this._vertexFromAlphaPoint(cc.p(s.x,a.y));o[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,s.y));o[3].vertices=this._vertexFromAlphaPoint(cc.p(s.x,s.y));o[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,a.y));o[4].vertices=this._vertexFromAlphaPoint(cc.p(a.x,a.y));o[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,s.y));o[5].vertices=this._vertexFromAlphaPoint(cc.p(a.x,s.y))}this._updateColor()};t._updateRadial=function(){var t=this._node;if(!t._sprite)return;var e,i=t._midPoint;var n=t._percentage/100;var r=2*cc.PI*(t._reverseDirection?n:1-n);var s=cc.p(i.x,1);var a=cc.pRotateByAngle(s,i,r);var o=0;var c;if(n===0){c=s;o=0}else if(n===1){c=s;o=4}else{var l=cc.FLT_MAX;var h=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(e=0;e<=h;++e){var u=(e+(h-1))%h;var d=this._boundaryTexCoord(e%h);var _=this._boundaryTexCoord(u);if(e===0)_=cc.pLerp(d,_,1-i.x);else if(e===4)d=cc.pLerp(d,_,1-i.x);var f=cc.p(0,0);if(cc.pLineIntersect(d,_,i,a,f)){if(e===0||e===4){if(!(0<=f.x&&f.x<=1))continue}if(f.y>=0){if(f.y<l){l=f.y;o=e}}}}c=cc.pAdd(i,cc.pMult(cc.pSub(a,i),l))}var p=true;if(this._vertexDataCount!==o+3){p=false;this._vertexData=null;this._vertexArrayBuffer=null;this._vertexDataCount=0}if(!this._vertexData){this._vertexDataCount=o+3;var m=this._vertexDataCount,g=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(m*g);var v=[];for(e=0;e<m;e++)v[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*g);this._vertexData=v;if(!this._vertexData){cc.log("cc.ProgressTimer._updateRadial() : Not enough memory");return}}this._updateColor();var y=this._vertexData;if(!p){y[0].texCoords=this._textureCoordFromAlphaPoint(i);y[0].vertices=this._vertexFromAlphaPoint(i);y[1].texCoords=this._textureCoordFromAlphaPoint(s);y[1].vertices=this._vertexFromAlphaPoint(s);for(e=0;e<o;e++){var T=this._boundaryTexCoord(e);y[e+2].texCoords=this._textureCoordFromAlphaPoint(T);y[e+2].vertices=this._vertexFromAlphaPoint(T)}}y[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(c);y[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(c)};t._boundaryTexCoord=function(t){if(t<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var e=cc.ProgressTimer.TEXTURE_COORDS;if(this._node._reverseDirection)return cc.p(e>>7-(t<<1)&1,e>>7-((t<<1)+1)&1);else return cc.p(e>>(t<<1)+1&1,e>>(t<<1)&1)}return cc.p(0,0)};t._textureCoordFromAlphaPoint=function(t){var e=this._node._sprite;if(!e){return{u:0,v:0}}var i=e.quad;var n=cc.p(i.bl.texCoords.u,i.bl.texCoords.v);var r=cc.p(i.tr.texCoords.u,i.tr.texCoords.v);if(e.textureRectRotated){var s=t.x;t.x=t.y;t.y=s}return{u:n.x*(1-t.x)+r.x*t.x,v:n.y*(1-t.y)+r.y*t.y}};t._vertexFromAlphaPoint=function(t){var e=this._node._sprite;if(!e){return{x:0,y:0}}var i=e.quad;var n=cc.p(i.bl.vertices.x,i.bl.vertices.y);var r=cc.p(i.tr.vertices.x,i.tr.vertices.y);return{x:n.x*(1-t.x)+r.x*t.x,y:n.y*(1-t.y)+r.y*t.y}};t._updateColor=function(){var t=this._node;if(!t._sprite||!this._vertexData)return;var e=t._sprite.quad.tl.colors;var i=this._vertexData;for(var n=0,r=this._vertexDataCount;n<r;++n)i[n].colors=e;this._vertexDataDirty=true}})();cc.SCENE_FADE=4208917214;cc.TRANSITION_ORIENTATION_LEFT_OVER=0;cc.TRANSITION_ORIENTATION_RIGHT_OVER=1;cc.TRANSITION_ORIENTATION_UP_OVER=0;cc.TRANSITION_ORIENTATION_DOWN_OVER=1;cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:false,_isSendCleanupToScene:false,_className:"TransitionScene",ctor:function(t,e){cc.Scene.prototype.ctor.call(this);if(t!==undefined&&e!==undefined)this.initWithDuration(t,e)},_setNewScene:function(t){this.unschedule(this._setNewScene);var e=cc.director;this._isSendCleanupToScene=e.isSendCleanupToScene();e.runScene(this._inScene);cc.eventManager.setEnabled(true);this._outScene.visible=true},_sceneOrder:function(){this._isInSceneOnTop=true},visit:function(){if(this._isInSceneOnTop){this._outScene.visit();this._inScene.visit()}else{this._inScene.visit();this._outScene.visit()}cc.Node.prototype.visit.call(this)},onEnter:function(){cc.Node.prototype.onEnter.call(this);cc.eventManager.setEnabled(false);this._outScene.onExitTransitionDidStart();this._inScene.onEnter()},onExit:function(){cc.Node.prototype.onExit.call(this);cc.eventManager.setEnabled(true);this._outScene.onExit();this._inScene.onEnterTransitionDidFinish()},cleanup:function(){cc.Node.prototype.cleanup.call(this);if(this._isSendCleanupToScene)this._outScene.cleanup()},initWithDuration:function(t,e){if(!e)throw new Error("cc.TransitionScene.initWithDuration(): Argument scene must be non-nil");if(this.init()){this._duration=t;this.attr({x:0,y:0,anchorX:0,anchorY:0});this._inScene=e;this._outScene=cc.director.getRunningScene();if(!this._outScene){this._outScene=new cc.Scene;this._outScene.init()}if(this._inScene===this._outScene)throw new Error("cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene");this._sceneOrder();return true}else{return false}},finish:function(){this._inScene.attr({visible:true,x:0,y:0,scale:1,rotation:0});if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)this._inScene.getCamera().restore();this._outScene.attr({visible:false,x:0,y:0,scale:1,rotation:0});if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)this._outScene.getCamera().restore();this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=true;this._outScene.visible=false}});cc.TransitionScene.create=function(t,e){return new cc.TransitionScene(t,e)};cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this);
i!=undefined&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(cc.TransitionScene.prototype.initWithDuration.call(this,t,e)){this._orientation=i}return true}});cc.TransitionSceneOriented.create=function(t,e,i){return new cc.TransitionSceneOriented(t,e,i)};cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:.001,anchorX:.5,anchorY:.5});this._outScene.attr({scale:1,anchorX:.5,anchorY:.5});var t=cc.sequence(cc.spawn(cc.scaleBy(this._duration/2,.001),cc.rotateBy(this._duration/2,360*2)),cc.delayTime(this._duration/2));this._outScene.runAction(t);this._inScene.runAction(cc.sequence(t.reverse(),cc.callFunc(this.finish,this)))}});cc.TransitionRotoZoom.create=function(t,e){return new cc.TransitionRotoZoom(t,e)};cc.TransitionJumpZoom=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.director.getWinSize();this._inScene.attr({scale:.5,x:t.width,y:0,anchorX:.5,anchorY:.5});this._outScene.anchorX=.5;this._outScene.anchorY=.5;var e=cc.jumpBy(this._duration/4,cc.p(-t.width,0),t.width/4,2);var i=cc.scaleTo(this._duration/4,1);var n=cc.scaleTo(this._duration/4,.5);var r=cc.sequence(n,e);var s=cc.sequence(e,i);var a=cc.delayTime(this._duration/2);this._outScene.runAction(r);this._inScene.runAction(cc.sequence(a,s,cc.callFunc(this.finish,this)))}});cc.TransitionJumpZoom.create=function(t,e){return new cc.TransitionJumpZoom(t,e)};cc.TransitionMoveInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var t=this.action();this._inScene.runAction(cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width,0)},action:function(){return cc.moveTo(this._duration,cc.p(0,0))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}});cc.TransitionMoveInL.create=function(t,e){return new cc.TransitionMoveInL(t,e)};cc.TransitionMoveInR=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width,0)}});cc.TransitionMoveInR.create=function(t,e){return new cc.TransitionMoveInR(t,e)};cc.TransitionMoveInT=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height)}});cc.TransitionMoveInT.create=function(t,e){return new cc.TransitionMoveInT(t,e)};cc.TransitionMoveInB=cc.TransitionMoveInL.extend({ctor:function(t,e){cc.TransitionMoveInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,-cc.director.getWinSize().height)}});cc.TransitionMoveInB.create=function(t,e){return new cc.TransitionMoveInB(t,e)};cc.ADJUST_FACTOR=.5;cc.TransitionSlideInL=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=false},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var t=this.action();var e=this.action();var i=cc.sequence(this.easeActionWithAction(t),cc.callFunc(this.finish,this));var n=this.easeActionWithAction(e);this._inScene.runAction(i);this._outScene.runAction(n)},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width+cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(t){return new cc.EaseInOut(t,2)}});cc.TransitionSlideInL.create=function(t,e){return new cc.TransitionSlideInL(t,e)};cc.TransitionSlideInR=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=true},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(-(cc.director.getWinSize().width-cc.ADJUST_FACTOR),0))}});cc.TransitionSlideInR.create=function(t,e){return new cc.TransitionSlideInR(t,e)};cc.TransitionSlideInB=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=false},initScenes:function(){this._inScene.setPosition(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.moveBy(this._duration,cc.p(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR))}});cc.TransitionSlideInB.create=function(t,e){return new cc.TransitionSlideInB(t,e)};cc.TransitionSlideInT=cc.TransitionSlideInL.extend({ctor:function(t,e){cc.TransitionSlideInL.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=true},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.moveBy(this._duration,cc.p(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR)))}});cc.TransitionSlideInT.create=function(t,e){return new cc.TransitionSlideInT(t,e)};cc.TransitionShrinkGrow=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:.001,anchorX:2/3,anchorY:.5});this._outScene.attr({scale:1,anchorX:1/3,anchorY:.5});var t=cc.scaleTo(this._duration,.01);var e=cc.scaleTo(this._duration,1);this._inScene.runAction(cc.sequence(this.easeActionWithAction(e),cc.callFunc(this.finish,this)));this._outScene.runAction(this.easeActionWithAction(t))},easeActionWithAction:function(t){return new cc.EaseOut(t,2)}});cc.TransitionShrinkGrow.create=function(t,e){return new cc.TransitionShrinkGrow(t,e)};cc.TransitionFlipX=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_RIGHT_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,n,i,0,0),cc.callFunc(this.finish,this));e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,s,r,0,0),cc.hide(),cc.delayTime(this._duration/2));this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionFlipX.create=function(t,e,i){return new cc.TransitionFlipX(t,e,i)};cc.TransitionFlipY=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_UP_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,n,i,90,0),cc.callFunc(this.finish,this));e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,s,r,90,0),cc.hide(),cc.delayTime(this._duration/2));this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionFlipY.create=function(t,e,i){return new cc.TransitionFlipY(t,e,i)};cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_RIGHT_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.show(),cc.orbitCamera(this._duration/2,1,0,n,i,-45,0),cc.callFunc(this.finish,this));e=cc.sequence(cc.orbitCamera(this._duration/2,1,0,s,r,45,0),cc.hide(),cc.delayTime(this._duration/2));this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionFlipAngular.create=function(t,e,i){return new cc.TransitionFlipAngular(t,e,i)};cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_RIGHT_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,n,i,0,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.callFunc(this.finish,this));e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,s,r,0,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2));this._inScene.scale=.5;this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionZoomFlipX.create=function(t,e,i){return new cc.TransitionZoomFlipX(t,e,i)};cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_UP_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,n,i,90,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.callFunc(this.finish,this));e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,s,r,90,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2));this._inScene.scale=.5;this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionZoomFlipY.create=function(t,e,i){return new cc.TransitionZoomFlipY(t,e,i)};cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({ctor:function(t,e,i){cc.TransitionSceneOriented.prototype.ctor.call(this);if(i==null)i=cc.TRANSITION_ORIENTATION_RIGHT_OVER;e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t,e;this._inScene.visible=false;var i,n,r,s;if(this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER){i=90;n=270;r=90;s=0}else{i=-90;n=90;r=-90;s=0}t=cc.sequence(cc.delayTime(this._duration/2),cc.spawn(cc.orbitCamera(this._duration/2,1,0,n,i,-45,0),cc.scaleTo(this._duration/2,1),cc.show()),cc.show(),cc.callFunc(this.finish,this));e=cc.sequence(cc.spawn(cc.orbitCamera(this._duration/2,1,0,s,r,45,0),cc.scaleTo(this._duration/2,.5)),cc.hide(),cc.delayTime(this._duration/2));this._inScene.scale=.5;this._inScene.runAction(t);this._outScene.runAction(e)}});cc.TransitionZoomFlipAngular.create=function(t,e,i){return new cc.TransitionZoomFlipAngular(t,e,i)};cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this);this._color=cc.color();e&&this.initWithDuration(t,e,i)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=new cc.LayerColor(this._color);this._inScene.visible=false;this.addChild(t,2,cc.SCENE_FADE);var e=this.getChildByTag(cc.SCENE_FADE);var i=cc.sequence(cc.fadeIn(this._duration/2),cc.callFunc(this.hideOutShowIn,this),cc.fadeOut(this._duration/2),cc.callFunc(this.finish,this));e.runAction(i)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this);this.removeChildByTag(cc.SCENE_FADE,false)},initWithDuration:function(t,e,i){i=i||cc.color.BLACK;if(cc.TransitionScene.prototype.initWithDuration.call(this,t,e)){this._color.r=i.r;this._color.g=i.g;this._color.b=i.b;this._color.a=0}return true}});cc.TransitionFade.create=function(t,e,i){return new cc.TransitionFade(t,e,i)};cc.TransitionCrossFade=cc.TransitionScene.extend({ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.color(0,0,0,0);var e=cc.director.getWinSize();var i=new cc.LayerColor(t);var n=new cc.RenderTexture(e.width,e.height);n.sprite.anchorX=.5;n.sprite.anchorY=.5;n.attr({x:e.width/2,y:e.height/2,anchorX:.5,anchorY:.5});n.begin();this._inScene.visit();n.end();var r=new cc.RenderTexture(e.width,e.height);r.setPosition(e.width/2,e.height/2);r.sprite.anchorX=r.anchorX=.5;r.sprite.anchorY=r.anchorY=.5;r.begin();this._outScene.visit();r.end();n.sprite.setBlendFunc(cc.ONE,cc.ONE);r.sprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);i.addChild(n);i.addChild(r);n.sprite.opacity=255;r.sprite.opacity=255;var s=cc.sequence(cc.fadeTo(this._duration,0),cc.callFunc(this.hideOutShowIn,this),cc.callFunc(this.finish,this));r.sprite.runAction(s);this.addChild(i,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,false);cc.TransitionScene.prototype.onExit.call(this)},visit:function(){cc.Node.prototype.visit.call(this)},draw:function(){}});cc.TransitionCrossFade.create=function(t,e){return new cc.TransitionCrossFade(t,e)};cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=false},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy.onEnter();var t=cc.director.getWinSize();var e=t.width/t.height;var i=0|12*e;var n=12;var r=cc.turnOffTiles(this._duration,cc.size(i,n));var s=this.easeActionWithAction(r);this._gridProxy.runAction(cc.sequence(s,cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit();this._gridProxy.visit()},easeActionWithAction:function(t){return t}});cc.TransitionTurnOffTiles.create=function(t,e){return new cc.TransitionTurnOffTiles(t,e)};cc.TransitionSplitCols=cc.TransitionScene.extend({_gridProxy:null,_switchTargetToInscene:function(){this._gridProxy.setTarget(this._inScene)},ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;e&&this.initWithDuration(t,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy.onEnter();var t=this.action();var e=cc.sequence(t,cc.callFunc(this._switchTargetToInscene,this),t.reverse());this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(e),cc.callFunc(this.finish,this),cc.stopGrid()))},onExit:function(){this._gridProxy.setTarget(null);this._gridProxy.onExit();cc.TransitionScene.prototype.onExit.call(this)},visit:function(){this._gridProxy.visit()},easeActionWithAction:function(t){return new cc.EaseInOut(t,3)},action:function(){return cc.splitCols(this._duration/2,3)}});cc.TransitionSplitCols.create=function(t,e){return new cc.TransitionSplitCols(t,e)};cc.TransitionSplitRows=cc.TransitionSplitCols.extend({ctor:function(t,e){cc.TransitionSplitCols.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},action:function(){return cc.splitRows(this._duration/2,3)}});cc.TransitionSplitRows.create=function(t,e){return new cc.TransitionSplitRows(t,e)};cc.TransitionFadeTR=cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=false},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy.onEnter();var t=cc.director.getWinSize();var e=t.width/t.height;var i=0|12*e;var n=12;var r=this.actionWithSize(cc.size(i,n));this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(r),cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit();this._gridProxy.visit()},easeActionWithAction:function(t){return t},actionWithSize:function(t){return cc.fadeOutTRTiles(this._duration,t)}});cc.TransitionFadeTR.create=function(t,e){return new cc.TransitionFadeTR(t,e)};cc.TransitionFadeBL=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutBLTiles(this._duration,t)}});cc.TransitionFadeBL.create=function(t,e){return new cc.TransitionFadeBL(t,e)};cc.TransitionFadeUp=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},actionWithSize:function(t){return new cc.FadeOutUpTiles(this._duration,t)}});cc.TransitionFadeUp.create=function(t,e){return new cc.TransitionFadeUp(t,e)};cc.TransitionFadeDown=cc.TransitionFadeTR.extend({ctor:function(t,e){cc.TransitionFadeTR.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},actionWithSize:function(t){return cc.fadeOutDownTiles(this._duration,t)}});cc.TransitionFadeDown.create=function(t,e){return new cc.TransitionFadeDown(t,e)};cc.SCENE_RADIAL=49153;cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",ctor:function(t,e){cc.TransitionScene.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_setAttrs:function(t,e,i){t.attr({x:e,y:i,anchorX:.5,anchorY:.5})},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._setupTransition();var t=cc.director.getWinSize();var e=new cc.RenderTexture(t.width,t.height);e.sprite.anchorX=.5;e.sprite.anchorY=.5;this._setAttrs(e,t.width/2,t.height/2);e.clear(0,0,0,1);e.begin();this._sceneToBeModified.visit();e.end();if(this._sceneToBeModified===this._outScene)this.hideOutShowIn();var i=this._progressTimerNodeWithRenderTexture(e);var n=cc.sequence(cc.progressFromTo(this._duration,this._from,this._to),cc.callFunc(this.finish,this));i.runAction(n);this.addChild(i,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,true);cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene;this._from=100;this._to=0},_progressTimerNodeWithRenderTexture:function(t){cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass");return null},_sceneOrder:function(){this._isInSceneOnTop=false}});cc.TransitionProgress.create=function(t,e){return new cc.TransitionProgress(t,e)};cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_RADIAL;i.reverseDir=false;i.percentage=100;this._setAttrs(i,e.width/2,e.height/2);return i}});cc.TransitionProgressRadialCCW.create=function(t,e){return new cc.TransitionProgressRadialCCW(t,e)};cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_RADIAL;i.reverseDir=true;i.percentage=100;this._setAttrs(i,e.width/2,e.height/2);return i}});cc.TransitionProgressRadialCW.create=function(t,e){var i=new cc.TransitionProgressRadialCW;if(i!==null&&i.initWithDuration(t,e)){return i}return new cc.TransitionProgressRadialCW(t,e)};cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_BAR;i.midPoint=cc.p(1,0);i.barChangeRate=cc.p(1,0);i.percentage=100;this._setAttrs(i,e.width/2,e.height/2);return i}});cc.TransitionProgressHorizontal.create=function(t,e){return new cc.TransitionProgressHorizontal(t,e)};cc.TransitionProgressVertical=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_BAR;i.midPoint=cc.p(0,0);i.barChangeRate=cc.p(0,1);i.percentage=100;this._setAttrs(i,e.width/2,e.height/2);return i}});cc.TransitionProgressVertical.create=function(t,e){return new cc.TransitionProgressVertical(t,e)};cc.TransitionProgressInOut=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_BAR;i.midPoint=cc.p(.5,.5);i.barChangeRate=cc.p(1,1);i.percentage=0;this._setAttrs(i,e.width/2,e.height/2);return i},_sceneOrder:function(){this._isInSceneOnTop=false},_setupTransition:function(){this._sceneToBeModified=this._inScene;this._from=0;this._to=100}});cc.TransitionProgressInOut.create=function(t,e){return new cc.TransitionProgressInOut(t,e)};cc.TransitionProgressOutIn=cc.TransitionProgress.extend({ctor:function(t,e){cc.TransitionProgress.prototype.ctor.call(this);e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=cc.director.getWinSize();var i=new cc.ProgressTimer(t.sprite);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)i.sprite.flippedY=true;i.type=cc.ProgressTimer.TYPE_BAR;i.midPoint=cc.p(.5,.5);i.barChangeRate=cc.p(1,1);i.percentage=100;this._setAttrs(i,e.width/2,e.height/2);return i}});cc.TransitionProgressOutIn.create=function(t,e){return new cc.TransitionProgressOutIn(t,e)};cc.TransitionPageTurn=cc.TransitionScene.extend({ctor:function(t,e,i){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;this.initWithDuration(t,e,i)},_back:true,_gridProxy:null,_className:"TransitionPageTurn",initWithDuration:function(t,e,i){this._back=i;if(cc.TransitionScene.prototype.initWithDuration.call(this,t,e)){}return true},actionWithSize:function(t){if(this._back)return cc.reverseTime(cc.pageTurn3D(this._duration,t));else return cc.pageTurn3D(this._duration,t)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var t=cc.director.getWinSize();var e,i;if(t.width>t.height){e=16;i=12}else{e=12;i=16}var n=this.actionWithSize(cc.size(e,i)),r=this._gridProxy;if(!this._back){r.setTarget(this._outScene);r.onEnter();r.runAction(cc.sequence(n,cc.callFunc(this.finish,this),cc.stopGrid()))}else{r.setTarget(this._inScene);r.onEnter();this._inScene.visible=false;r.runAction(cc.sequence(n,cc.callFunc(this.finish,this),cc.stopGrid()));this._inScene.runAction(cc.show())}},visit:function(){if(this._back)this._outScene.visit();else this._inScene.visit();this._gridProxy.visit()},_sceneOrder:function(){this._isInSceneOnTop=this._back}});cc.TransitionPageTurn.create=function(t,e,i){return new cc.TransitionPageTurn(t,e,i)};cc.Codec={name:"Jacob__Codec"};cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)};cc.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[t])};cc.unzipBase64AsArray=function(t,e){e=e||1;var i=this.unzipBase64(t),n=[],r,s,a;for(r=0,a=i.length/e;r<a;r++){n[r]=0;for(s=e-1;s>=0;--s){n[r]+=i.charCodeAt(r*e+s)<<s*8}}return n};cc.unzipAsArray=function(t,e){e=e||1;var i=this.unzip(t),n=[],r,s,a;for(r=0,a=i.length/e;r<a;r++){n[r]=0;for(s=e-1;s>=0;--s){n[r]+=i.charCodeAt(r*e+s)<<s*8}}return n};cc.StringToArray=function(t){var e=t.split(","),i=[],n;for(n=0;n<e.length;n++){i.push(parseInt(e[n]))}return i};cc.Codec.Base64={name:"Jacob__Codec__Base64"};cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";cc.Codec.Base64.decode=function t(e){var i=[],n,r,s,a,o,c,l,h=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(h<e.length){a=this._keyStr.indexOf(e.charAt(h++));o=this._keyStr.indexOf(e.charAt(h++));c=this._keyStr.indexOf(e.charAt(h++));l=this._keyStr.indexOf(e.charAt(h++));n=a<<2|o>>4;r=(o&15)<<4|c>>2;s=(c&3)<<6|l;i.push(String.fromCharCode(n));if(c!==64){i.push(String.fromCharCode(r))}if(l!==64){i.push(String.fromCharCode(s))}}i=i.join("");return i};cc.Codec.Base64.decodeAsArray=function e(t,i){var n=this.decode(t),r=[],s,a,o;for(s=0,o=n.length/i;s<o;s++){r[s]=0;for(a=i-1;a>=0;--a){r[s]+=n.charCodeAt(s*i+a)<<a*8}}return r};cc.uint8ArrayToUint32Array=function(t){if(t.length%4!==0)return null;var e=t.length/4;var i=window.Uint32Array?new Uint32Array(e):[];for(var n=0;n<e;n++){var r=n*4;i[n]=t[r]+t[r+1]*(1<<8)+t[r+2]*(1<<16)+t[r+3]*(1<<24)}return i};cc.Codec.GZip=function n(t){this.data=t;this.debug=false;this.gpflags=undefined;this.files=0;this.unzipped=[];this.buf32k=new Array(32768);this.bIdx=0;this.modeZIP=false;this.bytepos=0;this.bb=1;this.bits=0;this.nameBuf=[];this.fileout=undefined;this.literalTree=new Array(cc.Codec.GZip.LITERALS);this.distanceTree=new Array(32);this.treepos=0;this.Places=null;this.len=0;this.fpos=new Array(17);this.fpos[0]=0;this.flens=undefined;this.fmax=undefined};cc.Codec.GZip.gunzip=function(t){if(t.constructor===Array){}else if(t.constructor===String){}var e=new cc.Codec.GZip(t);return e.gunzip()[0][0]};cc.Codec.GZip.HufNode=function(){this.b0=0;this.b1=0;this.jump=null;this.jumppos=-1};cc.Codec.GZip.LITERALS=288;cc.Codec.GZip.NAMEMAX=256;cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255];cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99];cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];cc.Codec.GZip.prototype.gunzip=function(){this.outputArr=[];this.nextFile();return this.unzipped};cc.Codec.GZip.prototype.readByte=function(){this.bits+=8;if(this.bytepos<this.data.length){return this.data.charCodeAt(this.bytepos++)}else{return-1}};cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1};cc.Codec.GZip.prototype.readBit=function(){var t;this.bits++;t=this.bb&1;this.bb>>=1;if(this.bb===0){this.bb=this.readByte();t=this.bb&1;this.bb=this.bb>>1|128}return t};cc.Codec.GZip.prototype.readBits=function(t){var e=0,i=t;while(i--)e=e<<1|this.readBit();if(t)e=cc.Codec.GZip.bitReverse[e]>>8-t;return e};cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0};cc.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t;this.outputArr.push(String.fromCharCode(t));if(this.bIdx===32768)this.bIdx=0};cc.Codec.GZip.prototype.IsPat=function(){while(1){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}};cc.Codec.GZip.prototype.Rec=function(){var t=this.Places[this.treepos];var e;if(this.len===17){return-1}this.treepos++;this.len++;e=this.IsPat();if(e>=0){t.b0=e}else{t.b0=32768;if(this.Rec())return-1}e=this.IsPat();if(e>=0){t.b1=e;t.jump=null}else{t.b1=32768;t.jump=this.Places[this.treepos];t.jumppos=this.treepos;if(this.Rec())return-1}this.len--;return 0};cc.Codec.GZip.prototype.CreateTree=function(t,e,i,n){var r;this.Places=t;this.treepos=0;this.flens=i;this.fmax=e;for(r=0;r<17;r++)this.fpos[r]=0;this.len=0;if(this.Rec()){return-1}return 0};cc.Codec.GZip.prototype.DecodeValue=function(t){var e,i,n=0,r=t[n],s;while(1){s=this.readBit();if(s){if(!(r.b1&32768)){return r.b1}r=r.jump;e=t.length;for(i=0;i<e;i++){if(t[i]===r){n=i;break}}}else{if(!(r.b0&32768)){return r.b0}n++;r=t[n]}}return-1};cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,n,r;do{t=this.readBit();i=this.readBits(2);if(i===0){var s,a;this.byteAlign();s=this.readByte();s|=this.readByte()<<8;a=this.readByte();a|=this.readByte()<<8;if((s^~a)&65535){document.write("BlockLen checksum mismatch\n")}while(s--){e=this.readByte();this.addBuffer(e)}}else if(i===1){var o;while(1){o=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1;if(o>23){o=o<<1|this.readBit();if(o>199){o-=128;o=o<<1|this.readBit()}else{o-=48;if(o>143){o=o+136}}}else{o+=256}if(o<256){this.addBuffer(o)}else if(o===256){break}else{var r,c;o-=256+1;r=this.readBits(cc.Codec.GZip.cplext[o])+cc.Codec.GZip.cplens[o];o=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3;if(cc.Codec.GZip.cpdext[o]>8){c=this.readBits(8);c|=this.readBits(cc.Codec.GZip.cpdext[o]-8)<<8}else{c=this.readBits(cc.Codec.GZip.cpdext[o])}c+=cc.Codec.GZip.cpdist[o];for(o=0;o<r;o++){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}}}else if(i===2){var o,l,h,u,d;var _=new Array(288+32);h=257+this.readBits(5);u=1+this.readBits(5);d=4+this.readBits(4);for(o=0;o<19;o++){_[o]=0}for(o=0;o<d;o++){_[cc.Codec.GZip.border[o]]=this.readBits(3)}r=this.distanceTree.length;for(n=0;n<r;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,_,0)){this.flushBuffer();return 1}l=h+u;n=0;var f=-1;while(n<l){f++;o=this.DecodeValue(this.distanceTree);if(o<16){_[n++]=o}else if(o===16){var p;o=3+this.readBits(2);if(n+o>l){this.flushBuffer();return 1}p=n?_[n-1]:0;while(o--){_[n++]=p}}else{if(o===17){o=3+this.readBits(3)}else{o=11+this.readBits(7)}if(n+o>l){this.flushBuffer();return 1}while(o--){_[n++]=0}}}r=this.literalTree.length;for(n=0;n<r;n++)this.literalTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,h,_,0)){this.flushBuffer();return 1}r=this.literalTree.length;for(n=0;n<r;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;var m=new Array;for(n=h;n<_.length;n++)m[n-h]=_[n];if(this.CreateTree(this.distanceTree,u,m,0)){this.flushBuffer();return 1}while(1){o=this.DecodeValue(this.literalTree);if(o>=256){var r,c;o-=256;if(o===0){break}o--;r=this.readBits(cc.Codec.GZip.cplext[o])+cc.Codec.GZip.cplens[o];o=this.DecodeValue(this.distanceTree);if(cc.Codec.GZip.cpdext[o]>8){c=this.readBits(8);c|=this.readBits(cc.Codec.GZip.cpdext[o]-8)<<8}else{c=this.readBits(cc.Codec.GZip.cpdext[o]);
}c+=cc.Codec.GZip.cpdist[o];while(r--){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else{this.addBuffer(o)}}}}while(!t);this.flushBuffer();this.byteAlign();return 0};cc.Codec.GZip.prototype.unzipFile=function(t){var e;this.gunzip();for(e=0;e<this.unzipped.length;e++){if(this.unzipped[e][1]===t){return this.unzipped[e][0]}}};cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[];this.modeZIP=false;var t=[];t[0]=this.readByte();t[1]=this.readByte();if(t[0]===120&&t[1]===218){this.DeflateLoop();this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"];this.files++}if(t[0]===31&&t[1]===139){this.skipdir();this.unzipped[this.files]=[this.outputArr.join(""),"file"];this.files++}if(t[0]===80&&t[1]===75){this.modeZIP=true;t[2]=this.readByte();t[3]=this.readByte();if(t[2]===3&&t[3]===4){t[0]=this.readByte();t[1]=this.readByte();this.gpflags=this.readByte();this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8;this.readByte();this.readByte();this.readByte();this.readByte();var i=this.readByte();i|=this.readByte()<<8;i|=this.readByte()<<16;i|=this.readByte()<<24;var n=this.readByte();n|=this.readByte()<<8;n|=this.readByte()<<16;n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8;var s=this.readByte();s|=this.readByte()<<8;o=0;this.nameBuf=[];while(r--){var a=this.readByte();if(a==="/"|a===":"){o=0}else if(o<cc.Codec.GZip.NAMEMAX-1){this.nameBuf[o++]=String.fromCharCode(a)}}if(!this.fileout)this.fileout=this.nameBuf;var o=0;while(o<s){a=this.readByte();o++}if(e===8){this.DeflateLoop();this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")];this.files++}this.skipdir()}}};cc.Codec.GZip.prototype.skipdir=function(){var t=[];var e,i,n,r,s;if(this.gpflags&8){t[0]=this.readByte();t[1]=this.readByte();t[2]=this.readByte();t[3]=this.readByte();e=this.readByte();e|=this.readByte()<<8;e|=this.readByte()<<16;e|=this.readByte()<<24;i=this.readByte();i|=this.readByte()<<8;i|=this.readByte()<<16;i|=this.readByte()<<24}if(this.modeZIP)this.nextFile();t[0]=this.readByte();if(t[0]!==8){return 0}this.gpflags=this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();n=this.readByte();if(this.gpflags&4){t[0]=this.readByte();t[2]=this.readByte();this.len=t[0]+256*t[1];for(r=0;r<this.len;r++)this.readByte()}if(this.gpflags&8){r=0;this.nameBuf=[];while(s=this.readByte()){if(s==="7"||s===":")r=0;if(r<cc.Codec.GZip.NAMEMAX-1)this.nameBuf[r++]=s}}if(this.gpflags&16){while(s=this.readByte()){}}if(this.gpflags&2){this.readByte();this.readByte()}this.DeflateLoop();i=this.readByte();i|=this.readByte()<<8;i|=this.readByte()<<16;i|=this.readByte()<<24;if(this.modeZIP)this.nextFile()};(function(){"use strict";function t(t){throw t}var e=void 0,i=!0,n=this;function r(t,i){var r=t.split("."),s=n;!(r[0]in s)&&s.execScript&&s.execScript("var "+r[0]);for(var a;r.length&&(a=r.shift());)!r.length&&i!==e?s[a]=i:s=s[a]?s[a]:s[a]={}}var s="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;function a(t){if("string"===typeof t){var e=t.split(""),i,n;i=0;for(n=e.length;i<n;i++)e[i]=(e[i].charCodeAt(0)&255)>>>0;t=e}for(var r=1,s=0,a=t.length,o,c=0;0<a;){o=1024<a?1024:a;a-=o;do r+=t[c++],s+=r;while(--o);r%=65521;s%=65521}return(s<<16|r)>>>0}function o(e,i){this.index="number"===typeof i?i:0;this.i=0;this.buffer=e instanceof(s?Uint8Array:Array)?e:new(s?Uint8Array:Array)(32768);2*this.buffer.length<=this.index&&t(Error("invalid index"));this.buffer.length<=this.index&&this.f()}o.prototype.f=function(){var t=this.buffer,e,i=t.length,n=new(s?Uint8Array:Array)(i<<1);if(s)n.set(t);else for(e=0;e<i;++e)n[e]=t[e];return this.buffer=n};o.prototype.d=function(t,e,i){var n=this.buffer,r=this.index,s=this.i,a=n[r],o;i&&1<e&&(t=8<e?(_[t&255]<<24|_[t>>>8&255]<<16|_[t>>>16&255]<<8|_[t>>>24&255])>>32-e:_[t]>>8-e);if(8>e+s)a=a<<e|t,s+=e;else for(o=0;o<e;++o)a=a<<1|t>>e-o-1&1,8===++s&&(s=0,n[r++]=_[a],a=0,r===n.length&&(n=this.f()));n[r]=a;this.buffer=n;this.i=s;this.index=r};o.prototype.finish=function(){var t=this.buffer,e=this.index,i;0<this.i&&(t[e]<<=8-this.i,t[e]=_[t[e]],e++);s?i=t.subarray(0,e):(t.length=e,i=t);return i};var c=new(s?Uint8Array:Array)(256),l;for(l=0;256>l;++l){for(var h=l,u=h,d=7,h=h>>>1;h;h>>>=1)u<<=1,u|=h&1,--d;c[l]=(u<<d&255)>>>0}var _=c;var f=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];s&&new Uint32Array(f);function p(t){this.buffer=new(s?Uint16Array:Array)(2*t);this.length=0}p.prototype.getParent=function(t){return 2*((t-2)/4|0)};p.prototype.push=function(t,e){var i,n,r=this.buffer,s;i=this.length;r[this.length++]=e;for(r[this.length++]=t;0<i;)if(n=this.getParent(i),r[i]>r[n])s=r[i],r[i]=r[n],r[n]=s,s=r[i+1],r[i+1]=r[n+1],r[n+1]=s,i=n;else break;return this.length};p.prototype.pop=function(){var t,e,i=this.buffer,n,r,s;e=i[0];t=i[1];this.length-=2;i[0]=i[this.length];i[1]=i[this.length+1];for(s=0;;){r=2*s+2;if(r>=this.length)break;r+2<this.length&&i[r+2]>i[r]&&(r+=2);if(i[r]>i[s])n=i[s],i[s]=i[r],i[r]=n,n=i[s+1],i[s+1]=i[r+1],i[r+1]=n;else break;s=r}return{index:t,value:e,length:this.length}};function m(t){var e=t.length,i=0,n=Number.POSITIVE_INFINITY,r,a,o,c,l,h,u,d,_;for(d=0;d<e;++d)t[d]>i&&(i=t[d]),t[d]<n&&(n=t[d]);r=1<<i;a=new(s?Uint32Array:Array)(r);o=1;c=0;for(l=2;o<=i;){for(d=0;d<e;++d)if(t[d]===o){h=0;u=c;for(_=0;_<o;++_)h=h<<1|u&1,u>>=1;for(_=h;_<r;_+=l)a[_]=o<<16|d;++c}++o;c<<=1;l<<=1}return[a,i,n]}function g(t,e){this.h=v;this.w=0;this.input=t;this.b=0;e&&(e.lazy&&(this.w=e.lazy),"number"===typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"===typeof e.outputIndex&&(this.b=e.outputIndex));this.a||(this.a=new(s?Uint8Array:Array)(32768))}var v=2,y={NONE:0,r:1,j:v,N:3},T=[],C;for(C=0;288>C;C++)switch(i){case 143>=C:T.push([C+48,8]);break;case 255>=C:T.push([C-144+400,9]);break;case 279>=C:T.push([C-256+0,7]);break;case 287>=C:T.push([C-280+192,8]);break;default:t("invalid literal: "+C)}g.prototype.n=function(){var n,r,a,c,l=this.input;switch(this.h){case 0:a=0;for(c=l.length;a<c;){r=s?l.subarray(a,a+65535):l.slice(a,a+65535);a+=r.length;var h=r,u=a===c,d=e,_=e,f=e,p=e,m=e,g=this.a,y=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=y+h.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}d=u?1:0;g[y++]=d|0;_=h.length;f=~_+65536&65535;g[y++]=_&255;g[y++]=_>>>8&255;g[y++]=f&255;g[y++]=f>>>8&255;if(s)g.set(h,y),y+=h.length,g=g.subarray(0,y);else{p=0;for(m=h.length;p<m;++p)g[y++]=h[p];g.length=y}this.b=y;this.a=g}break;case 1:var C=new o(new Uint8Array(this.a.buffer),this.b);C.d(1,1,i);C.d(1,2,i);var S=P(this,l),x,E,b;x=0;for(E=S.length;x<E;x++)if(b=S[x],o.prototype.d.apply(C,T[b]),256<b)C.d(S[++x],S[++x],i),C.d(S[++x],5),C.d(S[++x],S[++x],i);else if(256===b)break;this.a=C.finish();this.b=this.a.length;break;case v:var A=new o(new Uint8Array(this.a),this.b),R,D,L,O,B,F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N,M,V,k,W,G=Array(19),z,U,Y,X,H;R=v;A.d(1,1,i);A.d(R,2,i);D=P(this,l);N=w(this.L,15);M=I(N);V=w(this.K,7);k=I(V);for(L=286;257<L&&0===N[L-1];L--);for(O=30;1<O&&0===V[O-1];O--);var j=L,q=O,J=new(s?Uint32Array:Array)(j+q),Z,K,Q,$,tt=new(s?Uint32Array:Array)(316),et,it,nt=new(s?Uint8Array:Array)(19);for(Z=K=0;Z<j;Z++)J[K++]=N[Z];for(Z=0;Z<q;Z++)J[K++]=V[Z];if(!s){Z=0;for($=nt.length;Z<$;++Z)nt[Z]=0}Z=et=0;for($=J.length;Z<$;Z+=K){for(K=1;Z+K<$&&J[Z+K]===J[Z];++K);Q=K;if(0===J[Z])if(3>Q)for(;0<Q--;)tt[et++]=0,nt[0]++;else for(;0<Q;)it=138>Q?Q:138,it>Q-3&&it<Q&&(it=Q-3),10>=it?(tt[et++]=17,tt[et++]=it-3,nt[17]++):(tt[et++]=18,tt[et++]=it-11,nt[18]++),Q-=it;else if(tt[et++]=J[Z],nt[J[Z]]++,Q--,3>Q)for(;0<Q--;)tt[et++]=J[Z],nt[J[Z]]++;else for(;0<Q;)it=6>Q?Q:6,it>Q-3&&it<Q&&(it=Q-3),tt[et++]=16,tt[et++]=it-3,nt[16]++,Q-=it}n=s?tt.subarray(0,et):tt.slice(0,et);W=w(nt,7);for(X=0;19>X;X++)G[X]=W[F[X]];for(B=19;4<B&&0===G[B-1];B--);z=I(W);A.d(L-257,5,i);A.d(O-1,5,i);A.d(B-4,4,i);for(X=0;X<B;X++)A.d(G[X],3,i);X=0;for(H=n.length;X<H;X++)if(U=n[X],A.d(z[U],W[U],i),16<=U){X++;switch(U){case 16:Y=2;break;case 17:Y=3;break;case 18:Y=7;break;default:t("invalid code: "+U)}A.d(n[X],Y,i)}var rt=[M,N],st=[k,V],at,ot,ct,lt,ht,ut,dt,_t;ht=rt[0];ut=rt[1];dt=st[0];_t=st[1];at=0;for(ot=D.length;at<ot;++at)if(ct=D[at],A.d(ht[ct],ut[ct],i),256<ct)A.d(D[++at],D[++at],i),lt=D[++at],A.d(dt[lt],_t[lt],i),A.d(D[++at],D[++at],i);else if(256===ct)break;this.a=A.finish();this.b=this.a.length;break;default:t("invalid compression type")}return this.a};function S(t,e){this.length=t;this.G=e}function x(){var e=b;switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var E=[],b,A;for(b=3;258>=b;b++)A=x(),E[b]=A[2]<<24|A[1]<<16|A[0];var R=s?new Uint32Array(E):E;function P(n,r){function a(e,n){var r=e.G,s=[],a=0,o;o=R[e.length];s[a++]=o&65535;s[a++]=o>>16&255;s[a++]=o>>24;var c;switch(i){case 1===r:c=[0,r-1,0];break;case 2===r:c=[1,r-2,0];break;case 3===r:c=[2,r-3,0];break;case 4===r:c=[3,r-4,0];break;case 6>=r:c=[4,r-5,1];break;case 8>=r:c=[5,r-7,1];break;case 12>=r:c=[6,r-9,2];break;case 16>=r:c=[7,r-13,2];break;case 24>=r:c=[8,r-17,3];break;case 32>=r:c=[9,r-25,3];break;case 48>=r:c=[10,r-33,4];break;case 64>=r:c=[11,r-49,4];break;case 96>=r:c=[12,r-65,5];break;case 128>=r:c=[13,r-97,5];break;case 192>=r:c=[14,r-129,6];break;case 256>=r:c=[15,r-193,6];break;case 384>=r:c=[16,r-257,7];break;case 512>=r:c=[17,r-385,7];break;case 768>=r:c=[18,r-513,8];break;case 1024>=r:c=[19,r-769,8];break;case 1536>=r:c=[20,r-1025,9];break;case 2048>=r:c=[21,r-1537,9];break;case 3072>=r:c=[22,r-2049,10];break;case 4096>=r:c=[23,r-3073,10];break;case 6144>=r:c=[24,r-4097,11];break;case 8192>=r:c=[25,r-6145,11];break;case 12288>=r:c=[26,r-8193,12];break;case 16384>=r:c=[27,r-12289,12];break;case 24576>=r:c=[28,r-16385,13];break;case 32768>=r:c=[29,r-24577,13];break;default:t("invalid distance")}o=c;s[a++]=o[0];s[a++]=o[1];s[a++]=o[2];var l,h;l=0;for(h=s.length;l<h;++l)m[g++]=s[l];y[s[0]]++;T[s[3]]++;v=e.length+n-1;p=null}var o,c,l,h,u,d={},_,f,p,m=s?new Uint16Array(2*r.length):[],g=0,v=0,y=new(s?Uint32Array:Array)(286),T=new(s?Uint32Array:Array)(30),C=n.w,x;if(!s){for(l=0;285>=l;)y[l++]=0;for(l=0;29>=l;)T[l++]=0}y[256]=1;o=0;for(c=r.length;o<c;++o){l=u=0;for(h=3;l<h&&o+l!==c;++l)u=u<<8|r[o+l];d[u]===e&&(d[u]=[]);_=d[u];if(!(0<v--)){for(;0<_.length&&32768<o-_[0];)_.shift();if(o+3>=c){p&&a(p,-1);l=0;for(h=c-o;l<h;++l)x=r[o+l],m[g++]=x,++y[x];break}if(0<_.length){var E=e,b=e,A=0,P=e,w=e,I=e,D=e,L=r.length,w=0,D=_.length;t:for(;w<D;w++){E=_[D-w-1];P=3;if(3<A){for(I=A;3<I;I--)if(r[E+I-1]!==r[o+I-1])continue t;P=A}for(;258>P&&o+P<L&&r[E+P]===r[o+P];)++P;P>A&&(b=E,A=P);if(258===P)break}f=new S(A,o-b);p?p.length<f.length?(x=r[o-1],m[g++]=x,++y[x],a(f,0)):a(p,-1):f.length<C?p=f:a(f,0)}else p?a(p,-1):(x=r[o],m[g++]=x,++y[x])}_.push(o)}m[g++]=256;y[256]++;n.L=y;n.K=T;return s?m.subarray(0,g):m}function w(t,e){function i(t){var e=v[t][y[t]];e===d?(i(t+1),i(t+1)):--m[e];++y[t]}var n=t.length,r=new p(572),a=new(s?Uint8Array:Array)(n),o,c,l,h,u;if(!s)for(h=0;h<n;h++)a[h]=0;for(h=0;h<n;++h)0<t[h]&&r.push(h,t[h]);o=Array(r.length/2);c=new(s?Uint32Array:Array)(r.length/2);if(1===o.length)return a[r.pop().index]=1,a;h=0;for(u=r.length/2;h<u;++h)o[h]=r.pop(),c[h]=o[h].value;var d=c.length,_=new(s?Uint16Array:Array)(e),f=new(s?Uint8Array:Array)(e),m=new(s?Uint8Array:Array)(d),g=Array(e),v=Array(e),y=Array(e),T=(1<<e)-d,C=1<<e-1,S,x,E,b,A;_[e-1]=d;for(x=0;x<e;++x)T<C?f[x]=0:(f[x]=1,T-=C),T<<=1,_[e-2-x]=(_[e-1-x]/2|0)+d;_[0]=f[0];g[0]=Array(_[0]);v[0]=Array(_[0]);for(x=1;x<e;++x)_[x]>2*_[x-1]+f[x]&&(_[x]=2*_[x-1]+f[x]),g[x]=Array(_[x]),v[x]=Array(_[x]);for(S=0;S<d;++S)m[S]=e;for(E=0;E<_[e-1];++E)g[e-1][E]=c[E],v[e-1][E]=E;for(S=0;S<e;++S)y[S]=0;1===f[e-1]&&(--m[0],++y[e-1]);for(x=e-2;0<=x;--x){b=S=0;A=y[x+1];for(E=0;E<_[x];E++)b=g[x+1][A]+g[x+1][A+1],b>c[S]?(g[x][E]=b,v[x][E]=d,A+=2):(g[x][E]=c[S],v[x][E]=S,++S);y[x]=0;1===f[x]&&i(x)}l=m;h=0;for(u=o.length;h<u;++h)a[o[h].index]=l[h];return a}function I(e){var i=new(s?Uint16Array:Array)(e.length),n=[],r=[],a=0,o,c,l,h;o=0;for(c=e.length;o<c;o++)n[e[o]]=(n[e[o]]|0)+1;o=1;for(c=16;o<=c;o++)r[o]=a,a+=n[o]|0,a>1<<o&&t("overcommitted"),a<<=1;65536>a&&t("undercommitted");o=0;for(c=e.length;o<c;o++){a=r[e[o]];r[e[o]]+=1;l=i[o]=0;for(h=e[o];l<h;l++)i[o]=i[o]<<1|a&1,a>>>=1}return i}function D(t,e){this.input=t;this.a=new(s?Uint8Array:Array)(32768);this.h=L.j;var i={},n;if((e||!(e={}))&&"number"===typeof e.compressionType)this.h=e.compressionType;for(n in e)i[n]=e[n];i.outputBuffer=this.a;this.z=new g(this.input,i)}var L=y;D.prototype.n=function(){var e,i,n,r,o,c,l,h=0;l=this.a;e=mt;switch(e){case mt:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}n=i<<4|e;l[h++]=n;switch(e){case mt:switch(this.h){case L.NONE:o=0;break;case L.r:o=1;break;case L.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}r=o<<6|0;l[h++]=r|31-(256*n+r)%31;c=a(this.input);this.z.b=h;l=this.z.n();h=l.length;s&&(l=new Uint8Array(l.buffer),l.length<=h+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,h+4));l[h++]=c>>24&255;l[h++]=c>>16&255;l[h++]=c>>8&255;l[h++]=c&255;return l};r("Zlib.Deflate",D);r("Zlib.Deflate.compress",function(t,e){return new D(t,e).n()});r("Zlib.Deflate.CompressionType",L);r("Zlib.Deflate.CompressionType.NONE",L.NONE);r("Zlib.Deflate.CompressionType.FIXED",L.r);r("Zlib.Deflate.CompressionType.DYNAMIC",L.j);function O(e,i){this.k=[];this.l=32768;this.e=this.g=this.c=this.q=0;this.input=s?new Uint8Array(e):e;this.s=!1;this.m=F;this.B=!1;if(i||!(i={}))i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize);switch(this.m){case B:this.b=32768;this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case F:this.b=0;this.a=new(s?Uint8Array:Array)(this.l);this.f=this.J;this.t=this.H;this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var B=0,F=1,N={D:B,C:F};O.prototype.p=function(){for(;!this.s;){var n=et(this,3);n&1&&(this.s=i);n>>>=1;switch(n){case 0:var r=this.input,a=this.c,o=this.a,c=this.b,l=e,h=e,u=e,d=o.length,_=e;this.e=this.g=0;l=r[a++];l===e&&t(Error("invalid uncompressed block header: LEN (first byte)"));h=l;l=r[a++];l===e&&t(Error("invalid uncompressed block header: LEN (second byte)"));h|=l<<8;l=r[a++];l===e&&t(Error("invalid uncompressed block header: NLEN (first byte)"));u=l;l=r[a++];l===e&&t(Error("invalid uncompressed block header: NLEN (second byte)"));u|=l<<8;h===~u&&t(Error("invalid uncompressed block header: length verify"));a+h>r.length&&t(Error("input buffer is broken"));switch(this.m){case B:for(;c+h>o.length;){_=d-c;h-=_;if(s)o.set(r.subarray(a,a+_),c),c+=_,a+=_;else for(;_--;)o[c++]=r[a++];this.b=c;o=this.f();c=this.b}break;case F:for(;c+h>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)o.set(r.subarray(a,a+h),c),c+=h,a+=h;else for(;h--;)o[c++]=r[a++];this.c=a;this.b=c;this.a=o;break;case 1:this.o(Z,tt);break;case 2:nt(this);break;default:t(Error("unknown BTYPE: "+n))}}return this.t()};var M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=s?new Uint16Array(M):M,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],W=s?new Uint16Array(k):k,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],z=s?new Uint8Array(G):G,U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Y=s?new Uint16Array(U):U,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=s?new Uint8Array(X):X,j=new(s?Uint8Array:Array)(288),q,J;q=0;for(J=j.length;q<J;++q)j[q]=143>=q?8:255>=q?9:279>=q?7:8;var Z=m(j),K=new(s?Uint8Array:Array)(30),Q,$;Q=0;for($=K.length;Q<$;++Q)K[Q]=5;var tt=m(K);function et(i,n){for(var r=i.g,s=i.e,a=i.input,o=i.c,c;s<n;)c=a[o++],c===e&&t(Error("input buffer is broken")),r|=c<<s,s+=8;c=r&(1<<n)-1;i.g=r>>>n;i.e=s-n;i.c=o;return c}function it(i,n){for(var r=i.g,s=i.e,a=i.input,o=i.c,c=n[0],l=n[1],h,u,d;s<l;)h=a[o++],h===e&&t(Error("input buffer is broken")),r|=h<<s,s+=8;u=c[r&(1<<l)-1];d=u>>>16;i.g=r>>d;i.e=s-d;i.c=o;return u&65535}function nt(t){function e(t,e,i){var n,r,s,a;for(a=0;a<t;)switch(n=it(this,e),n){case 16:for(s=3+et(this,2);s--;)i[a++]=r;break;case 17:for(s=3+et(this,3);s--;)i[a++]=0;r=0;break;case 18:for(s=11+et(this,7);s--;)i[a++]=0;r=0;break;default:r=i[a++]=n}return i}var i=et(t,5)+257,n=et(t,5)+1,r=et(t,4)+4,a=new(s?Uint8Array:Array)(V.length),o,c,l,h;for(h=0;h<r;++h)a[V[h]]=et(t,3);o=m(a);c=new(s?Uint8Array:Array)(i);l=new(s?Uint8Array:Array)(n);t.o(m(e.call(t,i,o,c)),m(e.call(t,n,o,l)))}O.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r=i.length-258,s,a,o,c;256!==(s=it(this,t));)if(256>s)n>=r&&(this.b=n,i=this.f(),n=this.b),i[n++]=s;else{a=s-257;c=W[a];0<z[a]&&(c+=et(this,z[a]));s=it(this,e);o=Y[s];0<H[s]&&(o+=et(this,H[s]));n>=r&&(this.b=n,i=this.f(),n=this.b);for(;c--;)i[n]=i[n++-o]}for(;8<=this.e;)this.e-=8,this.c--;this.b=n};O.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r=i.length,s,a,o,c;256!==(s=it(this,t));)if(256>s)n>=r&&(i=this.f(),r=i.length),i[n++]=s;else{a=s-257;c=W[a];0<z[a]&&(c+=et(this,z[a]));s=it(this,e);o=Y[s];0<H[s]&&(o+=et(this,H[s]));n+c>r&&(i=this.f(),r=i.length);for(;c--;)i[n]=i[n++-o]}for(;8<=this.e;)this.e-=8,this.c--;this.b=n};O.prototype.f=function(){var t=new(s?Uint8Array:Array)(this.b-32768),e=this.b-32768,i,n,r=this.a;if(s)t.set(r.subarray(32768,t.length));else{i=0;for(n=t.length;i<n;++i)t[i]=r[i+32768]}this.k.push(t);this.q+=t.length;if(s)r.set(r.subarray(e,e+32768));else for(i=0;32768>i;++i)r[i]=r[e+i];this.b=32768;return r};O.prototype.J=function(t){var e,i=this.input.length/this.c+1|0,n,r,a,o=this.input,c=this.a;t&&("number"===typeof t.v&&(i=t.v),"number"===typeof t.F&&(i+=t.F));2>i?(n=(o.length-this.c)/this.u[2],a=258*(n/2)|0,r=a<c.length?c.length+a:c.length<<1):r=c.length*i;s?(e=new Uint8Array(r),e.set(c)):e=c;return this.a=e};O.prototype.t=function(){var t=0,e=this.a,i=this.k,n,r=new(s?Uint8Array:Array)(this.q+(this.b-32768)),a,o,c,l;if(0===i.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);a=0;for(o=i.length;a<o;++a){n=i[a];c=0;for(l=n.length;c<l;++c)r[t++]=n[c]}a=32768;for(o=this.b;a<o;++a)r[t++]=e[a];this.k=[];return this.buffer=r};O.prototype.H=function(){var t,e=this.b;s?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a);return this.buffer=t};function rt(e,i){var n,r;this.input=e;this.c=0;if(i||!(i={}))i.index&&(this.c=i.index),i.verify&&(this.M=i.verify);n=e[this.c++];r=e[this.c++];switch(n&15){case mt:this.method=mt;break;default:t(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31));r&32&&t(Error("fdict flag is not supported"));this.A=new O(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}rt.prototype.p=function(){var e=this.input,i,n;i=this.A.p();this.c=this.A.c;this.M&&(n=(e[this.c++]<<24|e[this.c++]<<16|e[this.c++]<<8|e[this.c++])>>>0,n!==a(i)&&t(Error("invalid adler-32 checksum")));return i};r("Zlib.Inflate",rt);r("Zlib.Inflate.BufferType",N);N.ADAPTIVE=N.C;N.BLOCK=N.D;r("Zlib.Inflate.prototype.decompress",rt.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];s&&new Uint16Array(st);var at=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];s&&new Uint16Array(at);var ot=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];s&&new Uint8Array(ot);var ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];s&&new Uint16Array(ct);var lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];s&&new Uint8Array(lt);var ht=new(s?Uint8Array:Array)(288),ut,dt;ut=0;for(dt=ht.length;ut<dt;++ut)ht[ut]=143>=ut?8:255>=ut?9:279>=ut?7:8;m(ht);var _t=new(s?Uint8Array:Array)(30),ft,pt;ft=0;for(pt=_t.length;ft<pt;++ft)_t[ft]=5;m(_t);var mt=8}).call(this);var _p=window;_p=_p.Zlib=_p["Zlib"];_p.Deflate=_p["Deflate"];_p.Deflate.compress=_p.Deflate["compress"];_p.Inflate=_p["Inflate"];_p.Inflate.BufferType=_p.Inflate["BufferType"];_p.Inflate.prototype.decompress=_p.Inflate.prototype["decompress"];cc.PNGReader=cc.Class.extend({ctor:function(t){var e,i,n,r,s,a,o,c,l,h,u,d,_,f;this.data=t;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};s=null;while(true){e=this.readUInt32();l=function(){var t,e;e=[];for(a=t=0;t<4;a=++t){e.push(String.fromCharCode(this.data[this.pos++]))}return e}.call(this).join("");switch(l){case"IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":if(s){this.animation.frames.push(s)}this.pos+=4;s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};r=this.readUInt16();n=this.readUInt16()||100;s.delay=1e3*r/n;s.disposeOp=this.data[this.pos++];s.blendOp=this.data[this.pos++];s.data=[];break;case"IDAT":case"fdAT":if(l==="fdAT"){this.pos+=4;e-=4}t=(s!=null?s.data:void 0)||this.imgData;for(a=d=0;0<=e?d<e:d>e;a=0<=e?++d:--d){t.push(this.data[this.pos++])}break;case"tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(e);h=255-this.transparency.indexed.length;if(h>0){for(a=_=0;0<=h?_<h:_>h;a=0<=h?++_:--_){this.transparency.indexed.push(255)}}break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":u=this.read(e);o=u.indexOf(0);c=String.fromCharCode.apply(String,u.slice(0,o));this.text[c]=String.fromCharCode.apply(String,u.slice(o+1));break;case"IEND":if(s){this.animation.frames.push(s)}this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);this.hasAlphaChannel=(f=this.colorType)===4||f===6;i=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*i;this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this);if(Uint8Array!=Array)this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=e}this.pos+=4;if(this.pos>this.data.length){throw new Error("Incomplete or corrupt PNG file")}}},read:function(t){var e,i,n;n=[];for(e=i=0;0<=t?i<t:i>t;e=0<=t?++i:--i){n.push(this.data[this.pos++])}return n},readUInt32:function(){var t,e,i,n;t=this.data[this.pos++]<<24;e=this.data[this.pos++]<<16;i=this.data[this.pos++]<<8;n=this.data[this.pos++];return t|e|i|n},readUInt16:function(){var t,e;t=this.data[this.pos++]<<8;e=this.data[this.pos++];return t|e},decodePixels:function(t){var e,i,n,r,s,a,o,c,l,h,u,d,_,f,p,m,g,v,y,T,C,S,x;if(t==null){t=this.imgData}if(t.length===0){return new Uint8Array(0)}var E=new Zlib.Inflate(t,{index:0,verify:false});t=E.decompress();d=this.pixelBitlength/8;m=d*this.width;_=new Uint8Array(m*this.height);a=t.length;p=0;f=0;i=0;while(f<a){switch(t[f++]){case 0:for(r=y=0;y<m;r=y+=1){_[i++]=t[f++]}break;case 1:for(r=T=0;T<m;r=T+=1){e=t[f++];s=r<d?0:_[i-d];_[i++]=(e+s)%256}break;case 2:for(r=C=0;C<m;r=C+=1){e=t[f++];n=(r-r%d)/d;g=p&&_[(p-1)*m+n*d+r%d];_[i++]=(g+e)%256}break;case 3:for(r=S=0;S<m;r=S+=1){e=t[f++];n=(r-r%d)/d;s=r<d?0:_[i-d];g=p&&_[(p-1)*m+n*d+r%d];_[i++]=(e+Math.floor((s+g)/2))%256}break;case 4:for(r=x=0;x<m;r=x+=1){e=t[f++];n=(r-r%d)/d;s=r<d?0:_[i-d];if(p===0){g=v=0}else{g=_[(p-1)*m+n*d+r%d];v=n&&_[(p-1)*m+(n-1)*d+r%d]}o=s+g-v;c=Math.abs(o-s);h=Math.abs(o-g);u=Math.abs(o-v);if(c<=h&&c<=u){l=s}else if(h<=u){l=g}else{l=v}_[i++]=(e+l)%256}break;default:throw new Error("Invalid filter algorithm: "+t[f-1])}p++}return _},copyToImageData:function(t,e){var i,n,r,s,a,o,c,l,h,u,d;n=this.colors;h=null;i=this.hasAlphaChannel;if(this.palette.length){h=(d=this._decodedPalette)!=null?d:this._decodedPalette=this.decodePalette();n=4;i=true}r=t.data||t;l=r.length;a=h||e;s=o=0;if(n===1){while(s<l){c=h?e[s/4]*4:o;u=a[c++];r[s++]=u;r[s++]=u;r[s++]=u;r[s++]=i?a[c++]:255;o=c}}else{while(s<l){c=h?e[s/4]*4:o;r[s++]=a[c++];r[s++]=a[c++];r[s++]=a[c++];r[s++]=i?a[c++]:255;o=c}}},decodePalette:function(){var t,e,i,n,r,s,a,o,c;i=this.palette;s=this.transparency.indexed||[];r=new Uint8Array((s.length||0)+i.length);n=0;t=0;for(e=a=0,o=i.length;a<o;e=a+=3){r[n++]=i[e];r[n++]=i[e+1];r[n++]=i[e+2];r[n++]=(c=s[t++])!=null?c:255}return r},render:function(t){var e,i;t.width=this.width;t.height=this.height;e=t.getContext("2d");i=e.createImageData(this.width,this.height);this.copyToImageData(i,this.decodePixels());return e.putImageData(i,0,0)}});cc.tiffReader={_littleEndian:false,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){if(this._littleEndian)return this._tiffData[t+1]<<8|this._tiffData[t];else return this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;if(this._littleEndian)return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t];else return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(t===18761){this.littleEndian=true}else if(t===19789){this.littleEndian=false}else{console.log(t);throw TypeError("Invalid byte order value.")}return this.littleEndian},hasTowel:function(){if(this.getUint16(2)!==42){throw RangeError("You forgot your towel!");return false}return true},getFieldTypeName:function(t){var e=this.fieldTypeNames;if(t in e){return e[t]}return null},getFieldTagName:function(t){var e=this.fieldTagNames;if(t in e){return e[t]}else{console.log("Unknown Field Tag:",t);return"Tag"+t}},getFieldTypeLength:function(t){if(["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)!==-1){return 1}else if(["SHORT","SSHORT"].indexOf(t)!==-1){return 2}else if(["LONG","SLONG","FLOAT"].indexOf(t)!==-1){return 4}else if(["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)!==-1){return 8}return null},getFieldValues:function(t,e,i,n){var r=[];var s=this.getFieldTypeLength(e);var a=s*i;if(a<=4){if(this.littleEndian===false)r.push(n>>>(4-s)*8);else r.push(n)}else{for(var o=0;o<i;o++){var c=s*o;if(s>=8){if(["RATIONAL","SRATIONAL"].indexOf(e)!==-1){r.push(this.getUint32(n+c));r.push(this.getUint32(n+c+4))}else{cc.log("Can't handle this field type or size")}}else{r.push(this.getBytes(s,n+c))}}}if(e==="ASCII"){r.forEach(function(t,e,i){i[e]=String.fromCharCode(t)})}return r},getBytes:function(t,e){if(t<=0){cc.log("No bytes requested")}else if(t<=1){return this.getUint8(e)}else if(t<=2){return this.getUint16(e)}else if(t<=3){return this.getUint32(e)>>>8}else if(t<=4){return this.getUint32(e)}else{cc.log("Too many bytes requested")}},getBits:function(t,e,i){i=i||0;var n=Math.floor(i/8);var r=e+n;var s=i+t;var a=32-t;var o,c;if(s<=0){console.log("No bits requested")}else if(s<=8){o=24+i;c=this.getUint8(r)}else if(s<=16){o=16+i;c=this.getUint16(r)}else if(s<=32){o=i;c=this.getUint32(r)}else{console.log("Too many bits requested")}return{bits:c<<o>>>a,byteOffset:r+Math.floor(s/8),bitOffset:s%8}},parseFileDirectory:function(t){var e=this.getUint16(t);var i=[];for(var n=t+2,r=0;r<e;n+=12,r++){var s=this.getUint16(n);var a=this.getUint16(n+2);var o=this.getUint32(n+4);var c=this.getUint32(n+8);var l=this.getFieldTagName(s);var h=this.getFieldTypeName(a);var u=this.getFieldValues(l,h,o,c);i[l]={type:h,values:u}}this._fileDirectories.push(i);var d=this.getUint32(n);if(d!==0){this.parseFileDirectory(d)}},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){e=e||document.createElement("canvas");this._tiffData=t;this.canvas=e;this.checkLittleEndian();if(!this.hasTowel()){return}var i=this.getUint32(4);this._fileDirectories.length=0;this.parseFileDirectory(i);var n=this._fileDirectories[0];var r=n["ImageWidth"].values[0];var s=n["ImageLength"].values[0];this.canvas.width=r;this.canvas.height=s;var a=[];var o=n["Compression"]?n["Compression"].values[0]:1;var c=n["SamplesPerPixel"].values[0];var l=[];var h=0;var u=false;n["BitsPerSample"].values.forEach(function(t,e,i){l[e]={bitsPerSample:t,
hasBytesPerSample:false,bytesPerSample:undefined};if(t%8===0){l[e].hasBytesPerSample=true;l[e].bytesPerSample=t/8}h+=t},this);if(h%8===0){u=true;var d=h/8}var _=n["StripOffsets"].values;var f=_.length;if(n["StripByteCounts"]){var p=n["StripByteCounts"].values}else{cc.log("Missing StripByteCounts!");if(f===1){var p=[Math.ceil(r*s*h/8)]}else{throw Error("Cannot recover from missing StripByteCounts")}}for(var m=0;m<f;m++){var g=_[m];a[m]=[];var v=p[m];for(var y=0,T=0,C=1,S=true,x=[],E=0,b=0,A=0;y<v;y+=C){switch(o){case 1:for(var R=0,x=[];R<c;R++){if(l[R].hasBytesPerSample){var P=l[R].bytesPerSample*R;x.push(this.getBytes(l[R].bytesPerSample,g+y+P))}else{var w=this.getBits(l[R].bitsPerSample,g+y,T);x.push(w.bits);y=w.byteOffset-g;T=w.bitOffset;throw RangeError("Cannot handle sub-byte bits per sample")}}a[m].push(x);if(u){C=d}else{C=0;throw RangeError("Cannot handle sub-byte bits per pixel")}break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(S){S=false;var I=1;var D=1;var L=this.getInt8(g+y);if(L>=0&&L<=127){I=L+1}else if(L>=-127&&L<=-1){D=-L+1}else{S=true}}else{var O=this.getUint8(g+y);for(var R=0;R<D;R++){if(l[b].hasBytesPerSample){A=A<<8*E|O;E++;if(E===l[b].bytesPerSample){x.push(A);A=E=0;b++}}else{throw RangeError("Cannot handle sub-byte bits per sample")}if(b===c){a[m].push(x);x=[];b=0}}I--;if(I===0){S=true}}C=1;break;default:break}}}if(e.getContext){var B=this.canvas.getContext("2d");B.fillStyle="rgba(255, 255, 255, 0)";var F=n["RowsPerStrip"]?n["RowsPerStrip"].values[0]:s;var N=a.length;var M=s%F;var V=M===0?F:M;var k=F;var W=0;var G=n["PhotometricInterpretation"].values[0];var z=[];var U=0;if(n["ExtraSamples"]){z=n["ExtraSamples"].values;U=z.length}if(n["ColorMap"]){var Y=n["ColorMap"].values;var X=Math.pow(2,l[0].bitsPerSample)}for(var m=0;m<N;m++){if(m+1===N){k=V}var H=a[m].length;var j=W*m;for(var q=0,J=0;q<k,J<H;q++){for(var Z=0;Z<r;Z++,J++){var K=a[m][J];var Q=0;var $=0;var tt=0;var et=1;if(U>0){for(var it=0;it<U;it++){if(z[it]===1||z[it]===2){et=K[3+it]/256;break}}}switch(G){case 0:if(l[0].hasBytesPerSample){var nt=Math.pow(16,l[0].bytesPerSample*2)}K.forEach(function(t,e,i){i[e]=nt-t});case 1:Q=$=tt=this.clampColorSample(K[0],l[0].bitsPerSample);break;case 2:Q=this.clampColorSample(K[0],l[0].bitsPerSample);$=this.clampColorSample(K[1],l[1].bitsPerSample);tt=this.clampColorSample(K[2],l[2].bitsPerSample);break;case 3:if(Y===undefined){throw Error("Palette image missing color map")}var rt=K[0];Q=this.clampColorSample(Y[rt],16);$=this.clampColorSample(Y[X+rt],16);tt=this.clampColorSample(Y[2*X+rt],16);break;default:throw RangeError("Unknown Photometric Interpretation:",G);break}B.fillStyle="rgba("+Q+", "+$+", "+tt+", "+et+")";B.fillRect(Z,j+q,1,1)}}W=k}}return this.canvas},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};cc.Particle=function(t,e,i,n,r,s,a,o,c,l,h,u){this.pos=t?t:cc.p(0,0);this.startPos=e?e:cc.p(0,0);this.color=i?i:{r:0,g:0,b:0,a:255};this.deltaColor=n?n:{r:0,g:0,b:0,a:255};this.size=r||0;this.deltaSize=s||0;this.rotation=a||0;this.deltaRotation=o||0;this.timeToLive=c||0;this.atlasIndex=l||0;this.modeA=h?h:new cc.Particle.ModeA;this.modeB=u?u:new cc.Particle.ModeB;this.isChangeColor=false;this.drawPos=cc.p(0,0)};cc.Particle.ModeA=function(t,e,i){this.dir=t?t:cc.p(0,0);this.radialAccel=e||0;this.tangentialAccel=i||0};cc.Particle.ModeB=function(t,e,i,n){this.angle=t||0;this.degreesPerSecond=e||0;this.radius=i||0;this.deltaRadius=n||0};cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()];cc.ParticleSystem=cc.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:false,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:false,_allocatedParticles:0,_isActive:false,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:false,positionType:null,autoRemoveOnFinish:false,emitterMode:0,_textureLoaded:null,ctor:function(t){cc.Node.prototype.ctor.call(this);this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this.modeA=new cc.ParticleSystem.ModeA;this.modeB=new cc.ParticleSystem.ModeB;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._particles=[];this._sourcePosition=cc.p(0,0);this._posVar=cc.p(0,0);this._startColor=cc.color(255,255,255,255);this._startColorVar=cc.color(255,255,255,255);this._endColor=cc.color(255,255,255,255);this._endColorVar=cc.color(255,255,255,255);this._plistFile="";this._elapsed=0;this._dontTint=false;this._pointZeroForParticle=cc.p(0,0);this._emitCounter=0;this._particleIdx=0;this._batchNode=null;this.atlasIndex=0;this._transformSystemDirty=false;this._allocatedParticles=0;this._isActive=false;this.particleCount=0;this.duration=0;this.life=0;this.lifeVar=0;this.angle=0;this.angleVar=0;this.startSize=0;this.startSizeVar=0;this.endSize=0;this.endSizeVar=0;this.startSpin=0;this.startSpinVar=0;this.endSpin=0;this.endSpinVar=0;this.emissionRate=0;this._totalParticles=0;this._texture=null;this._opacityModifyRGB=false;this.positionType=cc.ParticleSystem.TYPE_FREE;this.autoRemoveOnFinish=false;this._textureLoaded=true;if(!t||cc.isNumber(t)){var e=t||100;this.setDrawMode(cc.ParticleSystem.TEXTURE_MODE);this.initWithTotalParticles(e)}else if(cc.isString(t)){this.initWithFile(t)}else if(cc.isObject(t)){this.initWithDictionary(t,"")}},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ParticleSystem.CanvasRenderCmd(this);else return new cc.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var t=this.modeA.gravity;return cc.p(t.x,t.y)},setGravity:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity");this.modeA.gravity=t},getSpeed:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity");return this.modeA.speed},setSpeed:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity");this.modeA.speed=t},getSpeedVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity");return this.modeA.speedVar},setSpeedVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity");this.modeA.speedVar=t},getTangentialAccel:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity");return this.modeA.tangentialAccel},setTangentialAccel:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity");this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity");return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity");this.modeA.tangentialAccelVar=t},getRadialAccel:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity");return this.modeA.radialAccel},setRadialAccel:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity");this.modeA.radialAccel=t},getRadialAccelVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity");return this.modeA.radialAccelVar},setRadialAccelVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity");this.modeA.radialAccelVar=t},getRotationIsDir:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity");return this.modeA.rotationIsDir},setRotationIsDir:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY)cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity");this.modeA.rotationIsDir=t},getStartRadius:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius");return this.modeB.startRadius},setStartRadius:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius");this.modeB.startRadius=t},getStartRadiusVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius");return this.modeB.startRadiusVar},setStartRadiusVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius");this.modeB.startRadiusVar=t},getEndRadius:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius");return this.modeB.endRadius},setEndRadius:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius");this.modeB.endRadius=t},getEndRadiusVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius");return this.modeB.endRadiusVar},setEndRadiusVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius");this.modeB.endRadiusVar=t},getRotatePerSecond:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius");return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius");this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius");return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){if(this.emitterMode!==cc.ParticleSystem.MODE_RADIUS)cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius");this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=true;cc.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=true;cc.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=true;cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=true;cc.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=cc.color(t)},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=cc.color(t)},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=cc.color(t)},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=cc.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){if(!t)return;if(t.isLoaded()){this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))}else{this._textureLoaded=false;t.addEventListener("load",function(t){this._textureLoaded=true;this.setTextureWithRect(t,cc.rect(0,0,t.width,t.height))},this)}},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){if(e===undefined){if(this._blendFunc!==t){this._blendFunc=t;this._updateBlendFunc()}}else{if(this._blendFunc.src!==t||this._blendFunc.dst!==e){this._blendFunc={src:t,dst:e};this._updateBlendFunc()}}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE||this._blendFunc.src===cc.ONE&&this._blendFunc.dst===cc.ONE},setBlendAdditive:function(t){var e=this._blendFunc;if(t){e.src=cc.SRC_ALPHA;e.dst=cc.ONE}else{this._renderCmd._setBlendAdditive()}},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var e=cc.loader.getRes(t);if(!e){cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found");return false}return this.initWithDictionary(e,"")},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(t,e){var i=false;var n=null;var r=null;var s=this._valueForKey;var a=parseInt(s("maxParticles",t));if(this.initWithTotalParticles(a)){this.angle=parseFloat(s("angle",t));this.angleVar=parseFloat(s("angleVariance",t));this.duration=parseFloat(s("duration",t));this._blendFunc.src=parseInt(s("blendFuncSource",t));this._blendFunc.dst=parseInt(s("blendFuncDestination",t));var o=this._startColor;o.r=parseFloat(s("startColorRed",t))*255;o.g=parseFloat(s("startColorGreen",t))*255;o.b=parseFloat(s("startColorBlue",t))*255;o.a=parseFloat(s("startColorAlpha",t))*255;var c=this._startColorVar;c.r=parseFloat(s("startColorVarianceRed",t))*255;c.g=parseFloat(s("startColorVarianceGreen",t))*255;c.b=parseFloat(s("startColorVarianceBlue",t))*255;c.a=parseFloat(s("startColorVarianceAlpha",t))*255;var l=this._endColor;l.r=parseFloat(s("finishColorRed",t))*255;l.g=parseFloat(s("finishColorGreen",t))*255;l.b=parseFloat(s("finishColorBlue",t))*255;l.a=parseFloat(s("finishColorAlpha",t))*255;var h=this._endColorVar;h.r=parseFloat(s("finishColorVarianceRed",t))*255;h.g=parseFloat(s("finishColorVarianceGreen",t))*255;h.b=parseFloat(s("finishColorVarianceBlue",t))*255;h.a=parseFloat(s("finishColorVarianceAlpha",t))*255;this.startSize=parseFloat(s("startParticleSize",t));this.startSizeVar=parseFloat(s("startParticleSizeVariance",t));this.endSize=parseFloat(s("finishParticleSize",t));this.endSizeVar=parseFloat(s("finishParticleSizeVariance",t));this.setPosition(parseFloat(s("sourcePositionx",t)),parseFloat(s("sourcePositiony",t)));this._posVar.x=parseFloat(s("sourcePositionVariancex",t));this._posVar.y=parseFloat(s("sourcePositionVariancey",t));this.startSpin=parseFloat(s("rotationStart",t));this.startSpinVar=parseFloat(s("rotationStartVariance",t));this.endSpin=parseFloat(s("rotationEnd",t));this.endSpinVar=parseFloat(s("rotationEndVariance",t));this.emitterMode=parseInt(s("emitterType",t));if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var u=this.modeA;u.gravity.x=parseFloat(s("gravityx",t));u.gravity.y=parseFloat(s("gravityy",t));u.speed=parseFloat(s("speed",t));u.speedVar=parseFloat(s("speedVariance",t));var d=s("radialAcceleration",t);u.radialAccel=d?parseFloat(d):0;d=s("radialAccelVariance",t);u.radialAccelVar=d?parseFloat(d):0;d=s("tangentialAcceleration",t);u.tangentialAccel=d?parseFloat(d):0;d=s("tangentialAccelVariance",t);u.tangentialAccelVar=d?parseFloat(d):0;var _=s("rotationIsDir",t).toLowerCase();u.rotationIsDir=_!=null&&(_==="true"||_==="1")}else if(this.emitterMode===cc.ParticleSystem.MODE_RADIUS){var f=this.modeB;f.startRadius=parseFloat(s("maxRadius",t));f.startRadiusVar=parseFloat(s("maxRadiusVariance",t));f.endRadius=parseFloat(s("minRadius",t));f.endRadiusVar=0;f.rotatePerSecond=parseFloat(s("rotatePerSecond",t));f.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",t))}else{cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file");return false}this.life=parseFloat(s("particleLifespan",t));this.lifeVar=parseFloat(s("particleLifespanVariance",t));this.emissionRate=this._totalParticles/this.life;if(!this._batchNode){this._opacityModifyRGB=false;var p=s("textureFileName",t);var m=cc.path.changeBasename(this._plistFile,p);var g=cc.textureCache.getTextureForKey(m);if(g){this.setTexture(g)}else{var v=s("textureImageData",t);if(!v||v.length===0){g=cc.textureCache.addImage(m);if(!g)return false;this.setTexture(g)}else{n=cc.unzipBase64AsArray(v,1);if(!n){cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData");return false}var y=cc.getImageFormatByData(n);if(y!==cc.FMT_TIFF&&y!==cc.FMT_PNG){cc.log("cc.ParticleSystem: unknown image format with Data");return false}var T=document.createElement("canvas");if(y===cc.FMT_PNG){var C=new cc.PNGReader(n);C.render(T)}else{var S=cc.tiffReader;S.parseTIFF(n,T)}cc.textureCache.cacheImage(m,T);var x=cc.textureCache.getTextureForKey(m);if(!x)cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture");this.setTexture(x)}}}i=true}return i},initWithTotalParticles:function(t){this._totalParticles=t;var e,i=this._particles;i.length=0;for(e=0;e<t;e++){i[e]=new cc.Particle}if(!i){cc.log("Particle system: not enough memory");return false}this._allocatedParticles=t;if(this._batchNode)for(e=0;e<this._totalParticles;e++)i[e].atlasIndex=e;this._isActive=true;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.positionType=cc.ParticleSystem.TYPE_FREE;this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this.autoRemoveOnFinish=false;this._transformSystemDirty=false;this.scheduleUpdateWithPriority(1);this._renderCmd._initWithTotalParticles(t);return true},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return false;var t=this._renderCmd.addParticle();this.initParticle(t);++this.particleCount;return true},initParticle:function(t){var e=cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e();t.timeToLive=Math.max(0,t.timeToLive);t.pos.x=this._sourcePosition.x+this._posVar.x*e();t.pos.y=this._sourcePosition.y+this._posVar.y*e();var i,n;var r=this._startColor,s=this._startColorVar;var a=this._endColor,o=this._endColorVar;i={r:cc.clampf(r.r+s.r*e(),0,255),g:cc.clampf(r.g+s.g*e(),0,255),b:cc.clampf(r.b+s.b*e(),0,255),a:cc.clampf(r.a+s.a*e(),0,255)};n={r:cc.clampf(a.r+o.r*e(),0,255),g:cc.clampf(a.g+o.g*e(),0,255),b:cc.clampf(a.b+o.b*e(),0,255),a:cc.clampf(a.a+o.a*e(),0,255)};t.color=i;var c=t.deltaColor,l=t.timeToLive;c.r=(n.r-i.r)/l;c.g=(n.g-i.g)/l;c.b=(n.b-i.b)/l;c.a=(n.a-i.a)/l;var h=this.startSize+this.startSizeVar*e();h=Math.max(0,h);t.size=h;if(this.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE){t.deltaSize=0}else{var u=this.endSize+this.endSizeVar*e();u=Math.max(0,u);t.deltaSize=(u-h)/l}var d=this.startSpin+this.startSpinVar*e();var _=this.endSpin+this.endSpinVar*e();t.rotation=d;t.deltaRotation=(_-d)/l;if(this.positionType===cc.ParticleSystem.TYPE_FREE)t.startPos=this.convertToWorldSpace(this._pointZeroForParticle);else if(this.positionType===cc.ParticleSystem.TYPE_RELATIVE){t.startPos.x=this._position.x;t.startPos.y=this._position.y}var f=cc.degreesToRadians(this.angle+this.angleVar*e());if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var p=this.modeA,m=t.modeA;var g=p.speed+p.speedVar*e();m.dir.x=Math.cos(f);m.dir.y=Math.sin(f);cc.pMultIn(m.dir,g);m.radialAccel=p.radialAccel+p.radialAccelVar*e();m.tangentialAccel=p.tangentialAccel+p.tangentialAccelVar*e();if(p.rotationIsDir)t.rotation=-cc.radiansToDegrees(cc.pToAngle(m.dir))}else{var v=this.modeB,y=t.modeB;var T=v.startRadius+v.startRadiusVar*e();var C=v.endRadius+v.endRadiusVar*e();y.radius=T;y.deltaRadius=v.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(C-T)/l;y.angle=f;y.degreesPerSecond=cc.degreesToRadians(v.rotatePerSecond+v.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=false;this._elapsed=this.duration;this._emitCounter=0},resetSystem:function(){this._isActive=true;this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var e=1/this.emissionRate;if(this.particleCount<this._totalParticles)this._emitCounter+=t;while(this.particleCount<this._totalParticles&&this._emitCounter>e){this.addParticle();this._emitCounter-=e}this._elapsed+=t;if(this.duration!==-1&&this.duration<this._elapsed)this.stopSystem()}this._particleIdx=0;var i=cc.Particle.TemporaryPoints[0];if(this.positionType===cc.ParticleSystem.TYPE_FREE){cc.pIn(i,this.convertToWorldSpace(this._pointZeroForParticle))}else if(this.positionType===cc.ParticleSystem.TYPE_RELATIVE){i.x=this._position.x;i.y=this._position.y}if(this._visible){var n=cc.Particle.TemporaryPoints[1],r=cc.Particle.TemporaryPoints[2],s=cc.Particle.TemporaryPoints[3];var a=this._particles;while(this._particleIdx<this.particleCount){cc.pZeroIn(n);cc.pZeroIn(r);cc.pZeroIn(s);var o=a[this._particleIdx];o.timeToLive-=t;if(o.timeToLive>0){if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var c=s,l=n,h=r;if(o.pos.x||o.pos.y){cc.pIn(l,o.pos);cc.pNormalizeIn(l)}else{cc.pZeroIn(l)}cc.pIn(h,l);cc.pMultIn(l,o.modeA.radialAccel);var u=h.x;h.x=-h.y;h.y=u;cc.pMultIn(h,o.modeA.tangentialAccel);cc.pIn(c,l);cc.pAddIn(c,h);cc.pAddIn(c,this.modeA.gravity);cc.pMultIn(c,t);cc.pAddIn(o.modeA.dir,c);cc.pIn(c,o.modeA.dir);cc.pMultIn(c,t);cc.pAddIn(o.pos,c)}else{var d=o.modeB;d.angle+=d.degreesPerSecond*t;d.radius+=d.deltaRadius*t;o.pos.x=-Math.cos(d.angle)*d.radius;o.pos.y=-Math.sin(d.angle)*d.radius}this._renderCmd._updateDeltaColor(o,t);o.size+=o.deltaSize*t;o.size=Math.max(0,o.size);o.rotation+=o.deltaRotation*t;var _=n;if(this.positionType===cc.ParticleSystem.TYPE_FREE||this.positionType===cc.ParticleSystem.TYPE_RELATIVE){var f=r;cc.pIn(f,i);cc.pSubIn(f,o.startPos);cc.pIn(_,o.pos);cc.pSubIn(_,f)}else{cc.pIn(_,o.pos)}if(this._batchNode){_.x+=this._position.x;_.y+=this._position.y}this._renderCmd.updateParticlePosition(o,_);++this._particleIdx}else{var p=o.atlasIndex;if(this._particleIdx!==this.particleCount-1){var m=a[this._particleIdx];a[this._particleIdx]=a[this.particleCount-1];a[this.particleCount-1]=m}if(this._batchNode){this._batchNode.disableParticle(this.atlasIndex+p);a[this.particleCount-1].atlasIndex=p}--this.particleCount;if(this.particleCount===0&&this.autoRemoveOnFinish){this.unscheduleUpdate();this._parent.removeChild(this,true);return}}}this._transformSystemDirty=false}if(!this._batchNode)this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var i=e[t];return i!=null?i:""}return""},_updateBlendFunc:function(){if(this._batchNode){cc.log("Can't change blending functions when the particle is being batched");return}var t=this._texture;if(t&&t instanceof cc.Texture2D){this._opacityModifyRGB=false;var e=this._blendFunc;if(e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST){if(t.hasPremultipliedAlpha()){this._opacityModifyRGB=true}else{e.src=cc.SRC_ALPHA;e.dst=cc.ONE_MINUS_SRC_ALPHA}}}},clone:function(){var t=new cc.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle());t.setAngleVar(this.getAngleVar());t.setDuration(this.getDuration());var e=this.getBlendFunc();t.setBlendFunc(e.src,e.dst);t.setStartColor(this.getStartColor());t.setStartColorVar(this.getStartColorVar());t.setEndColor(this.getEndColor());t.setEndColorVar(this.getEndColorVar());t.setStartSize(this.getStartSize());t.setStartSizeVar(this.getStartSizeVar());t.setEndSize(this.getEndSize());t.setEndSizeVar(this.getEndSizeVar());t.setPosition(cc.p(this.x,this.y));t.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y));t.setPositionType(this.getPositionType());t.setStartSpin(this.getStartSpin()||0);t.setStartSpinVar(this.getStartSpinVar()||0);t.setEndSpin(this.getEndSpin()||0);t.setEndSpinVar(this.getEndSpinVar()||0);t.setEmitterMode(this.getEmitterMode());if(this.getEmitterMode()===cc.ParticleSystem.MODE_GRAVITY){var i=this.getGravity();t.setGravity(cc.p(i.x,i.y));t.setSpeed(this.getSpeed());t.setSpeedVar(this.getSpeedVar());t.setRadialAccel(this.getRadialAccel());t.setRadialAccelVar(this.getRadialAccelVar());t.setTangentialAccel(this.getTangentialAccel());t.setTangentialAccelVar(this.getTangentialAccelVar())}else if(this.getEmitterMode()===cc.ParticleSystem.MODE_RADIUS){t.setStartRadius(this.getStartRadius());t.setStartRadiusVar(this.getStartRadiusVar());t.setEndRadius(this.getEndRadius());t.setEndRadiusVar(this.getEndRadiusVar());t.setRotatePerSecond(this.getRotatePerSecond());t.setRotatePerSecondVar(this.getRotatePerSecondVar())}t.setLife(this.getLife());t.setLifeVar(this.getLifeVar());t.setEmissionRate(this.getEmissionRate());if(!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var n=this.getTexture();if(n){var r=n.getContentSize();t.setTextureWithRect(n,cc.rect(0,0,r.width,r.height))}}}return t},setDisplayFrame:function(t){if(!t)return;var e=t.getOffsetInPixels();if(e.x!==0||e.y!==0)cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");var i=t.getTexture(),n=this._texture;if(n!==i)this.setTexture(i)},setTextureWithRect:function(t,e){var i=this._texture;if(i!==t){this._texture=t;this._updateBlendFunc()}this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var _p=cc.ParticleSystem.prototype;_p.opacityModifyRGB;cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB);_p.batchNode;cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode);_p.drawMode;cc.defineGetterSetter(_p,"drawMode",_p.getDrawMode,_p.setDrawMode);_p.shapeType;cc.defineGetterSetter(_p,"shapeType",_p.getShapeType,_p.setShapeType);_p.active;cc.defineGetterSetter(_p,"active",_p.isActive);_p.sourcePos;cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition);_p.posVar;cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar);_p.gravity;cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity);_p.speed;cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed);_p.speedVar;cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar);_p.tangentialAccel;cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel);_p.tangentialAccelVar;cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar);_p.radialAccel;cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel);_p.radialAccelVar;cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar);_p.rotationIsDir;
cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir);_p.startRadius;cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius);_p.startRadiusVar;cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar);_p.endRadius;cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius);_p.endRadiusVar;cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar);_p.rotatePerS;cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond);_p.rotatePerSVar;cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar);_p.startColor;cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor);_p.startColorVar;cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar);_p.endColor;cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor);_p.endColorVar;cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar);_p.totalParticles;cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles);_p.texture;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.ParticleSystem.create=function(t){return new cc.ParticleSystem(t)};cc.ParticleSystem.createWithTotalParticles=cc.ParticleSystem.create;cc.ParticleSystem.ModeA=function(t,e,i,n,r,s,a,o){this.gravity=t?t:cc.p(0,0);this.speed=e||0;this.speedVar=i||0;this.tangentialAccel=n||0;this.tangentialAccelVar=r||0;this.radialAccel=s||0;this.radialAccelVar=a||0;this.rotationIsDir=o||false};cc.ParticleSystem.ModeB=function(t,e,i,n,r,s){this.startRadius=t||0;this.startRadiusVar=e||0;this.endRadius=i||0;this.endRadiusVar=n||0;this.rotatePerSecond=r||0;this.rotatePerSecondVar=s||0};cc.ParticleSystem.SHAPE_MODE=0;cc.ParticleSystem.TEXTURE_MODE=1;cc.ParticleSystem.STAR_SHAPE=0;cc.ParticleSystem.BALL_SHAPE=1;cc.ParticleSystem.DURATION_INFINITY=-1;cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1;cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1;cc.ParticleSystem.MODE_GRAVITY=0;cc.ParticleSystem.MODE_RADIUS=1;cc.ParticleSystem.TYPE_FREE=0;cc.ParticleSystem.TYPE_RELATIVE=1;cc.ParticleSystem.TYPE_GROUPED=2;(function(){cc.ParticleSystem.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._drawMode=cc.ParticleSystem.TEXTURE_MODE;this._shapeType=cc.ParticleSystem.BALL_SHAPE;this._pointRect=cc.rect(0,0,0,0);this._tintCache=document.createElement("canvas")};var t=cc.ParticleSystem.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleSystem.CanvasRenderCmd;t.getDrawMode=function(){return this._drawMode};t.setDrawMode=function(t){this._drawMode=t};t.getShapeType=function(){return this._shapeType};t.setShapeType=function(t){this._shapeType=t};t.setBatchNode=function(t){if(this._batchNode!==t){this._node._batchNode=t}};t.updateQuadWithParticle=function(t,e){};t.updateParticlePosition=function(t,e){cc.pIn(t.drawPos,e)};t.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._node,a=this._pointRect;n.setTransform(this._worldTransform,e,i);n.save();if(s.isBlendAdditive())r.globalCompositeOperation="lighter";else r.globalCompositeOperation="source-over";var o,c,l,h;var u=this._node.particleCount,d=this._node._particles;if(s.drawMode!==cc.ParticleSystem.SHAPE_MODE&&s._texture){if(!s._texture._textureLoaded){n.restore();return}var _=s._texture.getHtmlElementObj();if(!_.width||!_.height){n.restore();return}var f=_;for(o=0;o<u;o++){c=d[o];l=0|c.size*.5;h=c.color.a/255;if(h===0)continue;r.globalAlpha=h;r.save();r.translate(0|c.drawPos.x,-(0|c.drawPos.y));var p=Math.floor(c.size/4)*4;var m=a.width;var g=a.height;r.scale(Math.max(1/m*p,1e-6),Math.max(1/g*p,1e-6));if(c.rotation)r.rotate(cc.degreesToRadians(c.rotation));f=c.isChangeColor?this._changeTextureColor(s._texture,c.color,this._pointRect):_;r.drawImage(f,-(0|m/2),-(0|g/2));r.restore()}}else{var v=cc._drawingUtil;for(o=0;o<u;o++){c=d[o];l=0|c.size*.5;h=c.color.a/255;if(h===0)continue;r.globalAlpha=h;r.save();r.translate(0|c.drawPos.x,-(0|c.drawPos.y));if(s.shapeType===cc.ParticleSystem.STAR_SHAPE){if(c.rotation)r.rotate(cc.degreesToRadians(c.rotation));v.drawStar(n,l,c.color)}else v.drawColorBall(n,l,c.color);r.restore()}}n.restore();cc.g_NumberOfDraws++};t._changeTextureColor=function(t,e,i){var n=this._tintCache;var r=t.getContentSize();n.width=r.width;n.height=r.height;return t._generateColorTexture(e.r,e.g,e.b,i,n)};t.initTexCoordsWithRect=function(t){this._pointRect=t};t.setTotalParticles=function(t){this._node._totalParticles=t<200?t:200};t.addParticle=function(){var t=this._node,e=t._particles,i;if(t.particleCount<e.length){i=e[t.particleCount]}else{i=new cc.Particle;e.push(i)}return i};t._setupVBO=function(){};t._allocMemory=function(){return true};t.postStep=function(){};t._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=cc.BLEND_SRC;t.dst=cc.BLEND_DST};t._initWithTotalParticles=function(t){};t._updateDeltaColor=function(t,e){if(!this._node._dontTint){t.color.r+=t.deltaColor.r*e;t.color.g+=t.deltaColor.g*e;t.color.b+=t.deltaColor.b*e;t.color.a+=t.deltaColor.a*e;t.isChangeColor=true}}})();cc.ParticleFire=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setRadialAccel(0);this.setRadialAccelVar(0);this.setSpeed(60);this.setSpeedVar(20);this.setAngle(90);this.setAngleVar(10);var e=cc.director.getWinSize();this.setPosition(e.width/2,60);this.setPosVar(cc.p(40,20));this.setLife(3);this.setLifeVar(.25);this.setStartSize(54);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(194,64,31,255));this.setStartColorVar(cc.color(0,0,0,0));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(true);return true}return false}});cc.ParticleFire.create=function(){return new cc.ParticleFire};cc.ParticleFireworks=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,-90));this.setRadialAccel(0);this.setRadialAccelVar(0);this.setSpeed(180);this.setSpeedVar(50);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setAngle(90);this.setAngleVar(20);this.setLife(3.5);this.setLifeVar(1);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(128,128,128,255));this.setStartColorVar(cc.color(128,128,128,255));this.setEndColor(cc.color(26,26,26,51));this.setEndColorVar(cc.color(26,26,26,51));this.setStartSize(8);this.setStartSizeVar(2);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setBlendAdditive(false);return true}return false}});cc.ParticleFireworks.create=function(){return new cc.ParticleFireworks};cc.ParticleSun=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setBlendAdditive(true);this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setRadialAccel(0);this.setRadialAccelVar(0);this.setSpeed(20);this.setSpeedVar(5);this.setAngle(90);this.setAngleVar(360);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(1);this.setLifeVar(.5);this.setStartSize(30);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(194,64,31,255));this.setStartColorVar(cc.color(0,0,0,0));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));return true}return false}});cc.ParticleSun.create=function(){return new cc.ParticleSun};cc.ParticleGalaxy=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setSpeed(60);this.setSpeedVar(10);this.setRadialAccel(-80);this.setRadialAccelVar(0);this.setTangentialAccel(80);this.setTangentialAccelVar(0);this.setAngle(90);this.setAngleVar(360);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(4);this.setLifeVar(1);this.setStartSize(37);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(31,64,194,255));this.setStartColorVar(cc.color(0,0,0,0));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(true);return true}return false}});cc.ParticleGalaxy.create=function(){return new cc.ParticleGalaxy};cc.ParticleFlower=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setSpeed(80);this.setSpeedVar(10);this.setRadialAccel(-60);this.setRadialAccelVar(0);this.setTangentialAccel(15);this.setTangentialAccelVar(0);this.setAngle(90);this.setAngleVar(360);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(4);this.setLifeVar(1);this.setStartSize(30);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(128,128,128,255));this.setStartColorVar(cc.color(128,128,128,128));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(true);return true}return false}});cc.ParticleFlower.create=function(){return new cc.ParticleFlower};cc.ParticleMeteor=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(-200,200));this.setSpeed(15);this.setSpeedVar(5);this.setRadialAccel(0);this.setRadialAccelVar(0);this.setTangentialAccel(0);this.setTangentialAccelVar(0);this.setAngle(90);this.setAngleVar(360);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(2);this.setLifeVar(1);this.setStartSize(60);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(51,102,179));this.setStartColorVar(cc.color(0,0,51,26));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(true);return true}return false}});cc.ParticleMeteor.create=function(){return new cc.ParticleMeteor};cc.ParticleSpiral=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setSpeed(150);this.setSpeedVar(0);this.setRadialAccel(-380);this.setRadialAccelVar(0);this.setTangentialAccel(45);this.setTangentialAccelVar(0);this.setAngle(90);this.setAngleVar(0);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(12);this.setLifeVar(0);this.setStartSize(20);this.setStartSizeVar(0);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(128,128,128,255));this.setStartColorVar(cc.color(128,128,128,0));this.setEndColor(cc.color(128,128,128,255));this.setEndColorVar(cc.color(128,128,128,0));this.setBlendAdditive(false);return true}return false}});cc.ParticleSpiral.create=function(){return new cc.ParticleSpiral};cc.ParticleExplosion=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(.1);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setSpeed(70);this.setSpeedVar(40);this.setRadialAccel(0);this.setRadialAccelVar(0);this.setTangentialAccel(0);this.setTangentialAccelVar(0);this.setAngle(90);this.setAngleVar(360);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height/2);this.setPosVar(cc.p(0,0));this.setLife(5);this.setLifeVar(2);this.setStartSize(15);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getDuration());this.setStartColor(cc.color(179,26,51,255));this.setStartColorVar(cc.color(128,128,128,0));this.setEndColor(cc.color(128,128,128,0));this.setEndColorVar(cc.color(128,128,128,0));this.setBlendAdditive(false);return true}return false}});cc.ParticleExplosion.create=function(){return new cc.ParticleExplosion};cc.ParticleSmoke=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,0));this.setRadialAccel(0);this.setRadialAccelVar(0);this.setSpeed(25);this.setSpeedVar(10);this.setAngle(90);this.setAngleVar(5);var e=cc.director.getWinSize();this.setPosition(e.width/2,0);this.setPosVar(cc.p(20,0));this.setLife(4);this.setLifeVar(1);this.setStartSize(60);this.setStartSizeVar(10);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(this.getTotalParticles()/this.getLife());this.setStartColor(cc.color(204,204,204,255));this.setStartColorVar(cc.color(5,5,5,0));this.setEndColor(cc.color(0,0,0,255));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(false);return true}return false}});cc.ParticleSmoke.create=function(){return new cc.ParticleSmoke};cc.ParticleSnow=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(0,-1));this.setSpeed(5);this.setSpeedVar(1);this.setRadialAccel(0);this.setRadialAccelVar(1);this.setTangentialAccel(0);this.setTangentialAccelVar(1);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height+10);this.setPosVar(cc.p(e.width/2,0));this.setAngle(-90);this.setAngleVar(5);this.setLife(45);this.setLifeVar(15);this.setStartSize(10);this.setStartSizeVar(5);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(10);this.setStartColor(cc.color(255,255,255,255));this.setStartColorVar(cc.color(0,0,0,0));this.setEndColor(cc.color(255,255,255,0));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(false);return true}return false}});cc.ParticleSnow.create=function(){return new cc.ParticleSnow};cc.ParticleRain=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1e3:300)},initWithTotalParticles:function(t){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(cc.ParticleSystem.DURATION_INFINITY);this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY);this.setGravity(cc.p(10,-10));this.setRadialAccel(0);this.setRadialAccelVar(1);this.setTangentialAccel(0);this.setTangentialAccelVar(1);this.setSpeed(130);this.setSpeedVar(30);this.setAngle(-90);this.setAngleVar(5);var e=cc.director.getWinSize();this.setPosition(e.width/2,e.height);this.setPosVar(cc.p(e.width/2,0));this.setLife(4.5);this.setLifeVar(0);this.setStartSize(4);this.setStartSizeVar(2);this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE);this.setEmissionRate(20);this.setStartColor(cc.color(179,204,255,255));this.setStartColorVar(cc.color(0,0,0,0));this.setEndColor(cc.color(179,204,255,128));this.setEndColorVar(cc.color(0,0,0,0));this.setBlendAdditive(false);return true}return false}});cc.ParticleRain.create=function(){return new cc.ParticleRain};cc.PARTICLE_DEFAULT_CAPACITY=500;cc.ParticleBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};if(cc.isString(t)){this.init(t,e)}else if(t instanceof cc.Texture2D){this.initWithTexture(t,e)}},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ParticleBatchNode.CanvasRenderCmd(this);else return new cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(t,e);this._children.length=0;this._renderCmd._initWithTexture();return true},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},init:function(t,e){var i=cc.textureCache.addImage(t);return this.initWithTexture(i,e)},addChild:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children");e=e==null?t.zIndex:e;i=i==null?t.tag:i;if(t.getTexture()!==this.textureAtlas.texture)throw new Error("cc.ParticleSystem.addChild() : the child is not using the same texture id");var n=t.getBlendFunc();if(this._children.length===0)this.setBlendFunc(n);else{if(n.src!==this._blendFunc.src||n.dst!==this._blendFunc.dst){cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");return}}var r=this._addChildHelper(t,e,i);var s=0;if(r!==0){var a=this._children[r-1];s=a.getAtlasIndex()+a.getTotalParticles()}else s=0;this.insertChild(t,s);t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles();var n=this.textureAtlas;var r=n.totalQuads;t.setAtlasIndex(e);if(r+i>n.getCapacity()){this._increaseAtlasCapacityTo(r+i);n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i)}if(t.getAtlasIndex()+i!==r)n.moveQuadsFromIndex(e,e+i);n.increaseTotalQuadsWith(i);this._updateAllAtlasIndexes()},removeChild:function(t,e){if(t==null)return;if(!(t instanceof cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children");if(this._children.indexOf(t)===-1){cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");return}cc.Node.prototype.removeChild.call(this,t,e);var i=this.textureAtlas;i.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles());i.fillWithEmptyQuadsFromIndex(i.totalQuads,t.getTotalParticles());t.setBatchNode(null);this._updateAllAtlasIndexes()},reorderChild:function(t,e){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(this._children.indexOf(t)===-1){cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");return}if(e===t.zIndex)return;if(this._children.length>1){var i=this._getCurrentIndex(t,e);if(i.oldIndex!==i.newIndex){this._children.splice(i.oldIndex,1);this._children.splice(i.newIndex,0,t);var n=t.getAtlasIndex();this._updateAllAtlasIndexes();var r=0;var s=this._children;for(var a=0;a<s.length;a++){var o=s[a];if(o===t){r=t.getAtlasIndex();break}}this.textureAtlas.moveQuadsFromIndex(n,t.getTotalParticles(),r);t.updateWithNoTime()}}t._setLocalZOrder(e)},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){var e=this._children;for(var i=0;i<e.length;i++){e[i].setBatchNode(null)}cc.Node.prototype.removeAllChildren.call(this,t);this.textureAtlas.removeAllQuads()},disableParticle:function(t){var e=this.textureAtlas.quads[t];e.br.vertices.x=e.br.vertices.y=e.tr.vertices.x=e.tr.vertices.y=e.tl.vertices.x=e.tl.vertices.y=e.bl.vertices.x=e.bl.vertices.y=0;this.textureAtlas._setDirty(true)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;if(t&&!t.hasPremultipliedAlpha()&&(e.src===cc.BLEND_SRC&&e.dst===cc.BLEND_DST)){e.src=cc.SRC_ALPHA;e.dst=cc.ONE_MINUS_SRC_ALPHA}},setBlendFunc:function(t,e){if(e===undefined){this._blendFunc.src=t.src;this._blendFunc.dst=t.dst}else{this._blendFunc.src=t;this._blendFunc.src=e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){var t=0;var e=this._children;for(var i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t);t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"].");if(!this.textureAtlas.resizeCapacity(t)){cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")}},_searchNewPositionInChildrenForZ:function(t){var e=this._children;var i=e.length;for(var n=0;n<i;n++){if(e[n].zIndex>t)return n}return i},_getCurrentIndex:function(t,e){var i=false;var n=false;var r=0;var s=0;var a=0,o=this._children;var c=o.length;for(var l=0;l<c;l++){var h=o[l];if(h.zIndex>e&&!n){r=l;n=true;if(i&&n)break}if(t===h){s=l;i=true;if(!n)a=-1;if(i&&n)break}}if(!n)r=c;r+=a;return{newIndex:r,oldIndex:s}},_addChildHelper:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent){cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again");return null}if(!this._children)this._children=[];var n=this._searchNewPositionInChildrenForZ(e);this._children.splice(n,0,t);t.tag=i;t._setLocalZOrder(e);t.parent=this;if(this._running){t.onEnter();t.onEnterTransitionDidFinish()}return n},_updateBlendFunc:function(){if(!this.textureAtlas.texture.hasPremultipliedAlpha()){this._blendFunc.src=cc.SRC_ALPHA;this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA}},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var _p=cc.ParticleBatchNode.prototype;_p.texture;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.ParticleBatchNode.create=function(t,e){return new cc.ParticleBatchNode(t,e)};(function(){cc.ParticleBatchNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=false};var t=cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.CanvasRenderCmd;t._initWithTexture=function(){}})();(function(){cc.ParticleBatchNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true};var t=cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleBatchNode.WebGLRenderCmd;t.rendering=function(t){var e=this._node;if(e.textureAtlas.totalQuads===0)return;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst);e.textureAtlas.drawQuads()};t._initWithTexture=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};t.visit=function(t){var e=this._node;if(!e._visible)return;var i=cc.current_stack;i.stack.push(i.top);this._syncStatus(t);i.top=this._stackMatrix;cc.renderer.pushRenderCommand(this);this._dirtyFlag=0;cc.kmGLPopMatrix()}})();(function(){cc.ParticleSystem.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._buffersVBO=[0,0];this._quads=[];this._indices=[];this._quadsArrayBuffer=null};var t=cc.ParticleSystem.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParticleSystem.WebGLRenderCmd;t.getDrawMode=function(){};t.setDrawMode=function(t){};t.getShapeType=function(){};t.setShapeType=function(t){};t.setBatchNode=function(t){var e=this._node;if(e._batchNode!==t){var i=e._batchNode;e._batchNode=t;if(t){var n=e._particles;for(var r=0;r<e._totalParticles;r++)n[r].atlasIndex=r}if(!t){this._allocMemory();this.initIndices(e._totalParticles);e.setTexture(i.getTexture());this._setupVBO()}else if(!i){e._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,e.atlasIndex);cc._renderContext.deleteBuffer(this._buffersVBO[1])}}};t.initIndices=function(t){var e=this._indices;for(var i=0,n=t;i<n;++i){var r=i*6;var s=i*4;e[r+0]=s+0;e[r+1]=s+1;e[r+2]=s+2;e[r+5]=s+1;e[r+4]=s+2;e[r+3]=s+3}};t.isDifferentTexture=function(t,e){return t===e};t.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)};t.updateQuadWithParticle=function(t,e){var i=null,n=this._node;if(n._batchNode){var r=n._batchNode.textureAtlas.quads;i=r[n.atlasIndex+t.atlasIndex];n._batchNode.textureAtlas.dirty=true}else i=this._quads[n._particleIdx];var s,a,o,c;if(n._opacityModifyRGB){s=0|t.color.r*t.color.a/255;a=0|t.color.g*t.color.a/255;o=0|t.color.b*t.color.a/255}else{s=0|t.color.r;a=0|t.color.g;o=0|t.color.b}c=0|t.color.a;var l=i.bl.colors,h=i.br.colors,u=i.tl.colors,d=i.tr.colors;l.r=h.r=u.r=d.r=s;l.g=h.g=u.g=d.g=a;l.b=h.b=u.b=d.b=o;l.a=h.a=u.a=d.a=c;var _=t.size/2;if(t.rotation){var f=-_,p=-_;var m=_,g=_;var v=e.x,y=e.y;var T=-cc.degreesToRadians(t.rotation);var C=Math.cos(T),S=Math.sin(T);var x=f*C-p*S+v;var E=f*S+p*C+y;var b=m*C-p*S+v;var A=m*S+p*C+y;var R=m*C-g*S+v;var P=m*S+g*C+y;var w=f*C-g*S+v;var I=f*S+g*C+y;i.bl.vertices.x=x;i.bl.vertices.y=E;i.br.vertices.x=b;i.br.vertices.y=A;i.tl.vertices.x=w;i.tl.vertices.y=I;i.tr.vertices.x=R;i.tr.vertices.y=P}else{i.bl.vertices.x=e.x-_;i.bl.vertices.y=e.y-_;i.br.vertices.x=e.x+_;i.br.vertices.y=e.y-_;i.tl.vertices.x=e.x-_;i.tl.vertices.y=e.y+_;i.tr.vertices.x=e.x+_;i.tr.vertices.y=e.y+_}};t.rendering=function(t){var e=this._node;if(!e._texture)return;var i=t||cc._renderContext;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);cc.glBindTexture2D(e._texture);cc.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);i.bindBuffer(i.ARRAY_BUFFER,this._buffersVBO[0]);i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,i.FLOAT,false,24,0);i.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,true,24,12);i.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,false,24,16);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);i.drawElements(i.TRIANGLES,e._particleIdx*6,i.UNSIGNED_SHORT,0)};t.initTexCoordsWithRect=function(t){var e=this._node;var i=e.texture;var n=cc.contentScaleFactor();var r=cc.rect(t.x*n,t.y*n,t.width*n,t.height*n);var s=t.width;var a=t.height;if(i){s=i.pixelsWidth;a=i.pixelsHeight}var o,c,l,h;if(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL){o=(r.x*2+1)/(s*2);c=(r.y*2+1)/(a*2);l=o+(r.width*2-2)/(s*2);h=c+(r.height*2-2)/(a*2)}else{o=r.x/s;c=r.y/a;l=o+r.width/s;h=c+r.height/a}var u=h;h=c;c=u;var d;var _=0,f=0;if(e._batchNode){d=e._batchNode.textureAtlas.quads;_=e.atlasIndex;f=e.atlasIndex+e._totalParticles}else{d=this._quads;_=0;f=e._totalParticles}for(var p=_;p<f;p++){if(!d[p])d[p]=cc.V3F_C4B_T2F_QuadZero();var m=d[p];m.bl.texCoords.u=o;m.bl.texCoords.v=c;m.br.texCoords.u=l;m.br.texCoords.v=c;m.tl.texCoords.u=o;m.tl.texCoords.v=h;m.tr.texCoords.u=l;m.tr.texCoords.v=h}};t.setTotalParticles=function(t){var e=this._node;if(t>e._allocatedParticles){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(t*6);var n=new ArrayBuffer(t*i);var r=e._particles;r.length=0;var s=this._quads;s.length=0;for(var a=0;a<t;a++){r[a]=new cc.Particle;s[a]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,a*i)}e._allocatedParticles=t;e._totalParticles=t;if(e._batchNode){for(var o=0;o<t;o++)r[o].atlasIndex=o}this._quadsArrayBuffer=n;this.initIndices(t);this._setupVBO();if(e._texture){this.initTexCoordsWithRect(cc.rect(0,0,e._texture.width,e._texture.height))}}else e._totalParticles=t;e.resetSystem()};t.addParticle=function(){var t=this._node,e=t._particles;return e[t.particleCount]};t._setupVBO=function(){var t=this;var e=cc._renderContext;this._buffersVBO[0]=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._buffersVBO[0]);e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW);this._buffersVBO[1]=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)};t._allocMemory=function(){var t=this._node;if(t._batchNode){cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode");return false}var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;var i=t._totalParticles;var n=this._quads;n.length=0;this._indices=new Uint16Array(i*6);var r=new ArrayBuffer(e*i);for(var s=0;s<i;s++)n[s]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,r,s*e);if(!n||!this._indices){cc.log("cocos2d: Particle system: not enough memory");return false}this._quadsArrayBuffer=r;return true};t.postStep=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]);t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW)};t._setBlendAdditive=function(){var t=this._node._blendFunc;if(this._texture&&!this._texture.hasPremultipliedAlpha()){t.src=cc.SRC_ALPHA;t.dst=cc.ONE_MINUS_SRC_ALPHA}else{t.src=cc.BLEND_SRC;t.dst=cc.BLEND_DST}};t._initWithTotalParticles=function(t){if(!this._allocMemory())return false;this.initIndices(t);this._setupVBO();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};t._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e;t.color.g+=t.deltaColor.g*e;t.color.b+=t.deltaColor.b*e;t.color.a+=t.deltaColor.a*e;t.isChangeColor=true}})();cc.IMEKeyboardNotificationInfo=function(t,e,i){this.begin=t||cc.rect(0,0,0,0);this.end=e||cc.rect(0,0,0,0);this.duration=i||0};cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return false},didAttachWithIME:function(){},canDetachWithIME:function(){return false},didDetachWithIME:function(){},insertText:function(t,e){},deleteBackward:function(){},
getContentText:function(){return""},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}});cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl;this._lastClickPosition=cc.p(0,0)},init:function(){if(cc.sys.isMobile)return;this._domInputControl=cc.$("#imeDispatcherInput");if(!this._domInputControl){this._domInputControl=cc.$new("input");this._domInputControl.setAttribute("type","text");this._domInputControl.setAttribute("id","imeDispatcherInput");this._domInputControl.resize(0,0);this._domInputControl.translates(0,0);this._domInputControl.style.opacity="0";this._domInputControl.style.fontSize="1px";this._domInputControl.setAttribute("tabindex",2);this._domInputControl.style.position="absolute";this._domInputControl.style.top=0;this._domInputControl.style.left=0;document.body.appendChild(this._domInputControl)}var t=this;this._domInputControl.addEventListener("input",function(){t._processDomInputString(t._domInputControl.value)},false);this._domInputControl.addEventListener("keydown",function(e){if(e.keyCode===cc.KEY.tab){e.stopPropagation();e.preventDefault()}else if(e.keyCode===cc.KEY.enter){t.dispatchInsertText("\n",1);e.stopPropagation();e.preventDefault()}},false);if(/msie/i.test(navigator.userAgent)){this._domInputControl.addEventListener("keyup",function(e){if(e.keyCode===cc.KEY.backspace){t._processDomInputString(t._domInputControl.value)}},false)}window.addEventListener("mousedown",function(e){var i=e.pageX||0;var n=e.pageY||0;t._lastClickPosition.x=i;t._lastClickPosition.y=n},false)},_processDomInputString:function(t){var e,i;var n=this._currentInputString.length<t.length?this._currentInputString.length:t.length;for(i=0;i<n;i++){if(t[i]!==this._currentInputString[i])break}var r=this._currentInputString.length-i;var s=t.length-i;for(e=0;e<r;e++)this.dispatchDeleteBackward();for(e=0;e<s;e++)this.dispatchInsertText(t[i+e],1);this._currentInputString=t},dispatchInsertText:function(t,e){if(!this.impl||!t||e<=0)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){if(!this.impl){return}if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var t=this.impl._delegateWithIme.getContentText();return t?t:""}return""},dispatchKeyboardWillShow:function(t){if(this.impl){for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];if(i){i.keyboardWillShow(t)}}}},dispatchKeyboardDidShow:function(t){if(this.impl){for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];if(i)i.keyboardDidShow(t)}}},dispatchKeyboardWillHide:function(t){if(this.impl){for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];if(i){i.keyboardWillHide(t)}}}},dispatchKeyboardDidHide:function(t){if(this.impl){for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];if(i){i.keyboardDidHide(t)}}}},addDelegate:function(t){if(!t||!this.impl)return;if(this.impl._delegateList.indexOf(t)>-1){return}this.impl._delegateList.splice(0,0,t)},attachDelegateWithIME:function(t){if(!this.impl||!t)return false;if(this.impl._delegateList.indexOf(t)===-1)return false;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME())return false;var e=this.impl._delegateWithIme;this.impl._delegateWithIme=null;e.didDetachWithIME();this._focusDomInput(t);return true}if(!t.canAttachWithIME())return false;this._focusDomInput(t);return true},_focusDomInput:function(t){if(cc.sys.isMobile){this.impl._delegateWithIme=t;t.didAttachWithIME();this._currentInputString=t.string||"";var e=t.getTipMessage?t.getTipMessage():"please enter your word:";var i;if(window.Window&&Window.prototype.prompt!=prompt){i=Window.prototype.prompt.call(window,e,this._currentInputString)}else{i=prompt(e,this._currentInputString)}if(i!=null)this._processDomInputString(i);this.dispatchInsertText("\n",1)}else{this.impl._delegateWithIme=t;this._currentInputString=t.string||"";t.didAttachWithIME();this._domInputControl.focus();this._domInputControl.value=this._currentInputString;this._domInputControlTranslate()}},_domInputControlTranslate:function(){if(/msie/i.test(navigator.userAgent)){this._domInputControl.style.left=this._lastClickPosition.x+"px";this._domInputControl.style.top=this._lastClickPosition.y+"px"}else{this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)}},detachDelegateWithIME:function(t){if(!this.impl||!t)return false;if(this.impl._delegateWithIme!==t)return false;if(!t.canDetachWithIME())return false;this.impl._delegateWithIme=null;t.didDetachWithIME();cc._canvas.focus();return true},removeDelegate:function(t){if(!this.impl||!t)return;if(this.impl._delegateList.indexOf(t)===-1)return;if(this.impl._delegateWithIme){if(t===this.impl._delegateWithIme){this.impl._delegateWithIme=null}}cc.arrayRemoveObject(this.impl._delegateList,t)},processKeycode:function(t){if(t<32){if(t===cc.KEY.backspace){this.dispatchDeleteBackward()}else if(t===cc.KEY.enter){this.dispatchInsertText("\n",1)}else if(t===cc.KEY.tab){}else if(t===cc.KEY.escape){}}else if(t<255){this.dispatchInsertText(String.fromCharCode(t),1)}else{}}});cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++){if(this._delegateList[e]===t)return e}return null}});cc.imeDispatcher=new cc.IMEDispatcher;document.body?cc.imeDispatcher.init():window.addEventListener("load",function(){cc.imeDispatcher.init()},false);cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(t){return false},onTextFieldDetachWithIME:function(t){return false},onTextFieldInsertText:function(t,e,i){return false},onTextFieldDeleteBackward:function(t,e,i){return false},onDraw:function(t){return false}});cc.TextFieldTTF=cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,i,n,r){this.colorSpaceHolder=cc.color(127,127,127);this._colorText=cc.color(255,255,255,255);cc.LabelTTF.prototype.ctor.call(this);if(r!==undefined){this.initWithPlaceHolder("",e,i,n,r);if(t)this.setPlaceHolder(t)}else if(n===undefined&&i!==undefined){this.initWithString("",arguments[1],arguments[2]);if(t)this.setPlaceHolder(t)}},onEnter:function(){cc.LabelTTF.prototype.onEnter.call(this);cc.imeDispatcher.addDelegate(this)},onExit:function(){cc.LabelTTF.prototype.onExit.call(this);cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r;this.colorSpaceHolder.g=t.g;this.colorSpaceHolder.b=t.b;this.colorSpaceHolder.a=cc.isUndefined(t.a)?255:t.a;if(!this._inputText.length)this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r;this._colorText.g=t.g;this._colorText.b=t.b;this._colorText.a=cc.isUndefined(t.a)?255:t.a;if(this._inputText.length)this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,i,n,r){switch(arguments.length){case 5:if(t)this.setPlaceHolder(t);return this.initWithString(this._placeHolder,n,r,e,i);break;case 3:if(t)this.setPlaceHolder(t);return this.initWithString(this._placeHolder,arguments[1],arguments[2]);break;default:throw new Error("Argument must be non-nil ");break}},setString:function(t){t=String(t);this._inputText=t||"";if(!this._inputText.length){cc.LabelTTF.prototype.setString.call(this,this._placeHolder);this.setColor(this.colorSpaceHolder)}else{cc.LabelTTF.prototype.setString.call(this,this._inputText);this.setColor(this._colorText)}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)this._renderCmd._updateTexture();this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"";if(!this._inputText.length){cc.LabelTTF.prototype.setString.call(this,this._placeHolder);this.setColor(this.colorSpaceHolder)}},getPlaceHolder:function(){return this._placeHolder},draw:function(t){var e=t||cc._renderContext;if(this.delegate&&this.delegate.onDraw(this))return;cc.LabelTTF.prototype.draw.call(this,e)},visit:function(t){this._super(t)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return this.delegate?!this.delegate.onTextFieldAttachWithIME(this):true},didAttachWithIME:function(){},canDetachWithIME:function(){return this.delegate?!this.delegate.onTextFieldDetachWithIME(this):true},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;if(t===0)return;var e=1;if(this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-e],e)){return}if(t<=e){this._inputText="";this._charCount=0;cc.LabelTTF.prototype.setString.call(this,this._placeHolder);this.setColor(this.colorSpaceHolder);return}this.string=this._inputText.substring(0,t-e)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){if(t==null)return;this._tipMessage=t},getTipMessage:function(){return this._tipMessage},insertText:function(t,e){var i=t;var n=i.indexOf("\n");if(n>-1){i=i.substring(0,n)}if(i.length>0){if(this.delegate&&this.delegate.onTextFieldInsertText(this,i,i.length)){return}var r=this._inputText+i;this._charCount=r.length;this.string=r}if(n===-1)return;if(this.delegate&&this.delegate.onTextFieldInsertText(this,"\n",1))return;this.detachWithIME()},getContentText:function(){return this._inputText},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}});var _p=cc.TextFieldTTF.prototype;_p.charCount;cc.defineGetterSetter(_p,"charCount",_p.getCharCount);_p.placeHolder;cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);cc.TextFieldTTF.create=function(t,e,i,n,r){return new cc.TextFieldTTF(t,e,i,n,r)};cc.TGA_OK=0;cc.TGA_ERROR_FILE_OPEN=1;cc.TGA_ERROR_READING_FILE=2;cc.TGA_ERROR_INDEXED_COLOR=3;cc.TGA_ERROR_MEMORY=4;cc.TGA_ERROR_COMPRESSED_FILE=5;cc.ImageTGA=function(t,e,i,n,r,s,a){this.status=t||0;this.type=e||0;this.pixelDepth=i||0;this.width=n||0;this.height=r||0;this.imageData=s||[];this.flipped=a||0};cc.tgaLoadHeader=function(t,e,i){var n=2;if(n+1>e)return false;var r=new cc.BinaryStreamReader(t);r.setOffset(n);i.type=r.readByte();n+=10;if(n+4+1>e)return false;r.setOffset(n);i.width=r.readUnsignedShort();i.height=r.readUnsignedInteger();i.pixelDepth=r.readByte();n+=5;if(n+1>e)return false;var s=r.readByte();i.flipped=0;if(s&32)i.flipped=1;return true};cc.tgaLoadImageData=function(t,e,i){var n,r,s,a;var o=18;n=0|i.pixelDepth/2;r=i.height*i.width*n;if(o+r>e)return false;i.imageData=cc.__getSubArray(t,o,o+r);if(n>=3){for(s=0;s<r;s+=n){a=i.imageData[s];i.imageData[s]=i.imageData[s+2];i.imageData[s+2]=a}}return true};cc.tgaRGBtogreyscale=function(t){var e,i;if(t.pixelDepth===8)return;var n=t.pixelDepth/8;var r=new Uint8Array(t.height*t.width);if(r===null)return;for(e=0,i=0;i<t.width*t.height;e+=n,i++)r[i]=.3*t.imageData[e]+.59*t.imageData[e+1]+.11*t.imageData[e+2];t.pixelDepth=8;t.type=3;t.imageData=r};cc.tgaDestroy=function(t){if(!t)return;t.imageData=null;t=null};cc.tgaLoadRLEImageData=function(t,e,i){var n,r,s,a=0,o=0,c=0;var l=[],h=0;var u=18;n=i.pixelDepth/8;r=i.height*i.width;for(s=0;s<r;s++){if(h!==0){h--;o=c!==0}else{if(u+1>e)break;h=t[u];u+=1;c=h&128;if(c)h-=128;o=0}if(!o){if(u+n>e)break;l=cc.__getSubArray(t,u,u+n);u+=n;if(n>=3){var d=l[0];l[0]=l[2];l[2]=d}}for(var _=0;_<n;_++)i.imageData[a+_]=l[_];a+=n}return true};cc.tgaFlipImage=function(t){var e=t.pixelDepth/8;var i=t.width*e;for(var n=0;n<t.height/2;n++){var r=cc.__getSubArray(t.imageData,n*i,n*i+i);cc.__setDataToArray(cc.__getSubArray(t.imageData,(t.height-(n+1))*i,i),t.imageData,n*i);cc.__setDataToArray(r,t.imageData,(t.height-(n+1))*i)}t.flipped=0};cc.__getSubArray=function(t,e,i){if(t instanceof Array)return t.slice(e,i);else return t.subarray(e,i)};cc.__setDataToArray=function(t,e,i){for(var n=0;n<t.length;n++)e[i+n]=t[n]};cc.BinaryStreamReader=cc.Class.extend({_binaryData:null,_offset:0,ctor:function(t){this._binaryData=t},setBinaryData:function(t){this._binaryData=t;this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(t){if(!(this._offset+Math.ceil(t/8)<this._data.length))throw new Error("Index out of bound")},_decodeFloat:function(t,e){var i=t+e+1;var n=i>>3;this._checkSize(i);var r=Math.pow(2,e-1)-1;var s=this._readBits(t+e,1,n);var a=this._readBits(t,e,n);var o=0;var c=2;var l=0;do{var h=this._readByte(++l,n);var u=t%8||8;var d=1<<u;while(d>>=1){if(h&d)o+=1/c;c*=2}}while(t-=u);this._offset+=n;return a===(r<<1)+1?o?NaN:s?-Infinity:+Infinity:(1+s*-2)*(a||o?!a?Math.pow(2,-r+1)*o:Math.pow(2,a-r)*(1+o):0)},_readByte:function(t,e){return this._data[this._offset+e-t-1]},_decodeInt:function(t,e){var i=this._readBits(0,t,t/8),n=Math.pow(2,t);var r=e&&i>=n/2?i-n:i;this._offset+=t/8;return r},_shl:function(t,e){for(++e;--e;t=((t%=2147483647+1)&1073741824)===1073741824?t*2:(t-1073741824)*2+2147483647+1){}return t},_readBits:function(t,e,i){var n=(t+e)%8;var r=t%8;var s=i-(t>>3)-1;var a=i+(-(t+e)>>3);var o=s-a;var c=this._readByte(s,i)>>r&(1<<(o?8-r:e))-1;if(o&&n)c+=(this._readByte(a++,i)&(1<<n)-1)<<(o--<<3)-r;while(o)c+=this._shl(this._readByte(a++,i),(o--<<3)-r);return c},readInteger:function(){return this._decodeInt(32,true)},readUnsignedInteger:function(){return this._decodeInt(32,false)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,true)},readUnsignedShort:function(){return this._decodeInt(16,false)},readByte:function(){var t=this._data[this._offset];this._offset+=1;return t},readData:function(t,e){if(this._binaryData instanceof Array){return this._binaryData.slice(t,e)}else{return this._binaryData.subarray(t,e)}},setOffset:function(t){this._offset=t},getOffset:function(){return this._offset}});cc.TMX_ORIENTATION_ORTHO=0;cc.TMX_ORIENTATION_HEX=1;cc.TMX_ORIENTATION_ISO=2;cc.TMXTiledMap=cc.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,e){cc.Node.prototype.ctor.call(this);this._mapSize=cc.size(0,0);this._tileSize=cc.size(0,0);if(e!==undefined){this.initWithXML(t,e)}else if(t!==undefined){this.initWithTMXFile(t)}},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width;this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width;this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(t){this.objectGroups=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.");this.width=0;this.height=0;var e=new cc.TMXMapInfo(t);if(!e)return false;var i=e.getTilesets();if(!i||i.length===0)cc.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename.");this._buildWithMapInfo(e);return true},initWithXML:function(t,e){this.width=0;this.height=0;var i=new cc.TMXMapInfo(t,e);var n=i.getTilesets();if(!n||n.length===0)cc.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename.");this._buildWithMapInfo(i);return true},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize();this._tileSize=t.getTileSize();this.mapOrientation=t.orientation;this.objectGroups=t.getObjectGroups();this.properties=t.properties;this._tileProperties=t.getTileProperties();var e=0;var i=t.getLayers();if(i){var n=null;for(var r=0,s=i.length;r<s;r++){n=i[r];if(n&&n.visible){var a=this._parseLayer(n,t);this.addChild(a,e,e);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height);e++}}}},allLayers:function(){var t=[],e=this._children;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r&&r instanceof cc.TMXLayer)t.push(r)}return t},getLayer:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");var e=this._children;for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");if(this.objectGroups){for(var e=0;e<this.objectGroups.length;e++){var i=this.objectGroups[e];if(i&&i.groupName===t){return i}}}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){cc.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead.");return this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var i=this._tilesetForLayer(t,e);var n=new cc.TMXLayer(i,t,e);t.ownTiles=false;n.setupTiles();return n},_tilesetForLayer:function(t,e){var i=t._layerSize;var n=e.getTilesets();if(n){for(var r=n.length-1;r>=0;r--){var s=n[r];if(s){for(var a=0;a<i.height;a++){for(var o=0;o<i.width;o++){var c=o+i.width*a;var l=t._tiles[c];if(l!==0){if((l&cc.TMX_TILE_FLIPPED_MASK)>>>0>=s.firstGid){return s}}}}}}}cc.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles");return null}});var _p=cc.TMXTiledMap.prototype;_p.mapWidth;cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);_p.mapHeight;cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);_p.tileWidth;cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);cc.TMXTiledMap.create=function(t,e){return new cc.TMXTiledMap(t,e)};cc.TMX_PROPERTY_NONE=0;cc.TMX_PROPERTY_MAP=1;cc.TMX_PROPERTY_LAYER=2;cc.TMX_PROPERTY_OBJECTGROUP=3;cc.TMX_PROPERTY_OBJECT=4;cc.TMX_PROPERTY_TILE=5;cc.TMX_TILE_HORIZONTAL_FLAG=2147483648;cc.TMX_TILE_VERTICAL_FLAG=1073741824;cc.TMX_TILE_DIAGONAL_FLAG=536870912;cc.TMX_TILE_FLIPPED_ALL=(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_DIAGONAL_FLAG)>>>0;cc.TMX_TILE_FLIPPED_MASK=~cc.TMX_TILE_FLIPPED_ALL>>>0;cc.TMXLayerInfo=cc.Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:true,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties=[];this.name="";this._layerSize=null;this._tiles=[];this.visible=true;this._opacity=0;this.ownTiles=true;this._minGID=1e5;this._maxGID=0;this.offset=cc.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}});cc.TMXTilesetInfo=cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=cc.size(0,0);this.imageSize=cc.size(0,0)},rectForGID:function(t){var e=cc.rect(0,0,0,0);e.width=this._tileSize.width;e.height=this._tileSize.height;t&=cc.TMX_TILE_FLIPPED_MASK;t=t-parseInt(this.firstGid,10);var i=parseInt((this.imageSize.width-this.margin*2+this.spacing)/(this._tileSize.width+this.spacing),10);e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10);e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10);return e}});cc.TMXMapInfo=cc.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:false,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(t,e){cc.SAXParser.prototype.ctor.apply(this);this._mapSize=cc.size(0,0);this._tileSize=cc.size(0,0);this._layers=[];this._tilesets=[];this._objectGroups=[];this.properties=[];this._tileProperties={};this._currentFirstGID=0;if(e!==undefined){this.initWithXML(t,e)}else if(t!==undefined){this.initWithTMXFile(t)}},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width;this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width;this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._objectGroups.push(t)},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){this._internalInit(t,null);return this.parseXMLFile(t)},initWithXML:function(t,e){this._internalInit(null,e);return this.parseXMLString(t)},parseXMLFile:function(t,e){e=e||false;var i=e?t:cc.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);var n=this._parseXML(i);var r,s;var a=n.documentElement;var o=a.getAttribute("version");var c=a.getAttribute("orientation");if(a.nodeName==="map"){if(o!=="1.0"&&o!==null)cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+o);if(c==="orthogonal")this.orientation=cc.TMX_ORIENTATION_ORTHO;else if(c==="isometric")this.orientation=cc.TMX_ORIENTATION_ISO;else if(c==="hexagonal")this.orientation=cc.TMX_ORIENTATION_HEX;else if(c!==null)cc.log("cocos2d: TMXFomat: Unsupported orientation:"+c);var l=cc.size(0,0);l.width=parseFloat(a.getAttribute("width"));l.height=parseFloat(a.getAttribute("height"));this.setMapSize(l);l=cc.size(0,0);l.width=parseFloat(a.getAttribute("tilewidth"));l.height=parseFloat(a.getAttribute("tileheight"));this.setTileSize(l);var h=a.querySelectorAll("map > properties >  property");if(h){var u={};for(r=0;r<h.length;r++){u[h[r].getAttribute("name")]=h[r].getAttribute("value")}this.properties=u}}var d=a.getElementsByTagName("tileset");if(a.nodeName!=="map"){d=[];d.push(a)}for(r=0;r<d.length;r++){var _=d[r];var f=_.getAttribute("source");if(f){var p=e?cc.path.join(this._resources,f):cc.path.changeBasename(t,f);this.parseXMLFile(p)}else{var m=new cc.TMXTilesetInfo;m.name=_.getAttribute("name")||"";m.firstGid=parseInt(_.getAttribute("firstgid"))||0;m.spacing=parseInt(_.getAttribute("spacing"))||0;m.margin=parseInt(_.getAttribute("margin"))||0;var g=cc.size(0,0);g.width=parseFloat(_.getAttribute("tilewidth"));g.height=parseFloat(_.getAttribute("tileheight"));m._tileSize=g;var v=_.getElementsByTagName("image")[0];var y=v.getAttribute("source");var T=-1;if(this.tmxFileName)T=this.tmxFileName.lastIndexOf("/");if(T!==-1){var C=this.tmxFileName.substr(0,T+1);m.sourceImage=C+y}else{m.sourceImage=this._resources+(this._resources?"/":"")+y}this.setTilesets(m);var S=_.getElementsByTagName("tile");if(S){for(var x=0;x<S.length;x++){var E=S[x];this.parentGID=parseInt(m.firstGid)+parseInt(E.getAttribute("id")||0);var b=E.querySelectorAll("properties > property");if(b){var A={};for(s=0;s<b.length;s++){var R=b[s].getAttribute("name");A[R]=b[s].getAttribute("value")}this._tileProperties[this.parentGID]=A}}}}}var P=a.getElementsByTagName("layer");if(P){for(r=0;r<P.length;r++){var w=P[r];var I=w.getElementsByTagName("data")[0];var D=new cc.TMXLayerInfo;D.name=w.getAttribute("name");var L=cc.size(0,0);L.width=parseFloat(w.getAttribute("width"));L.height=parseFloat(w.getAttribute("height"));D._layerSize=L;var O=w.getAttribute("visible");D.visible=!(O=="0");var B=w.getAttribute("opacity")||1;if(B)D._opacity=parseInt(255*parseFloat(B));else D._opacity=255;D.offset=cc.p(parseFloat(w.getAttribute("x"))||0,parseFloat(w.getAttribute("y"))||0);var F="";for(s=0;s<I.childNodes.length;s++){F+=I.childNodes[s].nodeValue}F=F.trim();var N=I.getAttribute("compression");var M=I.getAttribute("encoding");if(N&&N!=="gzip"&&N!=="zlib"){cc.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method");return null}switch(N){case"gzip":D._tiles=cc.unzipBase64AsArray(F,4);break;case"zlib":var V=new Zlib.Inflate(cc.Codec.Base64.decodeAsArray(F,1));D._tiles=cc.uint8ArrayToUint32Array(V.decompress());break;case null:case"":if(M==="base64")D._tiles=cc.Codec.Base64.decodeAsArray(F,4);else if(M==="csv"){D._tiles=[];var k=F.split(",");for(var W=0;W<k.length;W++)D._tiles.push(parseInt(k[W]))}else{var G=I.getElementsByTagName("tile");D._tiles=[];for(var z=0;z<G.length;z++)D._tiles.push(parseInt(G[z].getAttribute("gid")))}break;default:if(this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE)cc.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported");break}var U=w.querySelectorAll("properties > property");if(U){var Y={};for(s=0;s<U.length;s++){Y[U[s].getAttribute("name")]=U[s].getAttribute("value")}D.properties=Y}this.setLayers(D)}}var X=a.getElementsByTagName("objectgroup");if(X){for(r=0;r<X.length;r++){var H=X[r];var j=new cc.TMXObjectGroup;j.groupName=H.getAttribute("name");j.setPositionOffset(cc.p(parseFloat(H.getAttribute("x"))*this.getTileSize().width||0,parseFloat(H.getAttribute("y"))*this.getTileSize().height||0));var q=H.querySelectorAll("objectgroup > properties > property");if(q){for(s=0;s<q.length;s++){var J={};J[q[s].getAttribute("name")]=q[s].getAttribute("value");j.properties=J}}var Z=H.querySelectorAll("object");var K=cc.director.getContentScaleFactor();if(Z){for(s=0;s<Z.length;s++){var Q=Z[s];var $={};$["name"]=Q.getAttribute("name")||"";$["type"]=Q.getAttribute("type")||"";$["width"]=parseInt(Q.getAttribute("width"))||0;$["height"]=parseInt(Q.getAttribute("height"))||0;$["x"]=(((Q.getAttribute("x")||0)|0)+j.getPositionOffset().x)/K;var tt=((Q.getAttribute("y")||0)|0)+j.getPositionOffset().y/K;$["y"]=(parseInt(this.getMapSize().height*this.getTileSize().height)-tt-$["height"])/cc.director.getContentScaleFactor();$["rotation"]=parseInt(Q.getAttribute("rotation"))||0;var et=Q.querySelectorAll("properties > property");if(et){for(var it=0;it<et.length;it++)$[et[it].getAttribute("name")]=et[it].getAttribute("value")}var nt=Q.querySelectorAll("polygon");if(nt&&nt.length>0){var rt=nt[0].getAttribute("points");if(rt)$["points"]=this._parsePointsString(rt)}var st=Q.querySelectorAll("polyline");if(st&&st.length>0){var at=st[0].getAttribute("points");if(at)$["polylinePoints"]=this._parsePointsString(at)}j.setObjects($)}}this.setObjectGroups(j)}}return a},_parsePointsString:function(t){if(!t)return null;var e=[];var i=t.split(" ");for(var n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:r[0],y:r[1]})}return e},parseXMLString:function(t){return this.parseXMLFile(t,true)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,e){this._tilesets.length=0;this._layers.length=0;this.tmxFileName=t;if(e)this._resources=e;this._objectGroups.length=0;this.properties.length=0;this._tileProperties.length=0;this.currentString="";this.storingCharacters=false;this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE;this.parentElement=cc.TMX_PROPERTY_NONE;this._currentFirstGID=0}});var _p=cc.TMXMapInfo.prototype;_p.mapWidth;cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);_p.mapHeight;cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);_p.tileWidth;cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);cc.TMXMapInfo.create=function(t,e){return new cc.TMXMapInfo(t,e)};cc.loader.register(["tmx","tsx"],cc._txtLoader);cc.TMXLayerInfo.ATTRIB_NONE=1<<0;cc.TMXLayerInfo.ATTRIB_BASE64=1<<1;cc.TMXLayerInfo.ATTRIB_GZIP=1<<2;cc.TMXLayerInfo.ATTRIB_ZLIB=1<<3;cc.TMXObjectGroup=cc.Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="";this._positionOffset=cc.p(0,0);this.properties=[];this._objects=[]},getPositionOffset:function(){return cc.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x;this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties.push(t)},getGroupName:function(){return this.groupName.toString()},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){if(this._objects&&this._objects.length>0){var e=this._objects;for(var i=0,n=e.length;i<n;i++){var r=e[i]["name"];if(r&&r===t)return e[i]}}return null},getObjects:function(){return this._objects},setObjects:function(t){this._objects.push(t)}});cc.TMXLayer=cc.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(t,e,i){cc.SpriteBatchNode.prototype.ctor.call(this);this._descendants=[];this._layerSize=cc.size(0,0);this._mapTileSize=cc.size(0,0);if(i!==undefined)this.initWithTilesetInfo(t,e,i)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.TMXLayer.CanvasRenderCmd(this);else return new cc.TMXLayer.WebGLRenderCmd(this)},setContentSize:function(t,e){cc.Node.prototype.setContentSize.call(this,t,e);this._renderCmd._updateCacheContext(t,e)},getTexture:function(){return this._renderCmd.getTexture()},getLayerSize:function(){return cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width;this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){
this._layerSize.height=t},getMapTileSize:function(){return cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width;this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileset:function(){return this.tileset},setTileset:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTilesetInfo:function(t,e,i){var n=e._layerSize;var r=parseInt(n.width*n.height);var s=r*.35+1;var a;if(t)a=cc.textureCache.addImage(t.sourceImage);if(this.initWithTexture(a,s)){this.layerName=e.name;this._layerSize=n;this.tiles=e._tiles;this._minGID=e._minGID;this._maxGID=e._maxGID;this._opacity=e._opacity;this.properties=e.properties;this._contentScaleFactor=cc.director.getContentScaleFactor();this.tileset=t;this._mapTileSize=i.getTileSize();this.layerOrientation=i.orientation;var o=this._calculateLayerOffset(e.offset);this.setPosition(cc.pointPixelsToPoints(o));this._atlasIndexArray=[];this.setContentSize(cc.sizePixelsToPoints(cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height)));this._useAutomaticVertexZ=false;this._vertexZvalue=0;return true}return false},releaseMap:function(){if(this.tiles)this.tiles=null;if(this._atlasIndexArray)this._atlasIndexArray=null},getTileAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.getTileAt(): pos should be non-null");if(e!==undefined)t=cc.p(t,e);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray){cc.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released");return null}var i=null,n=this.getTileGIDAt(t);if(n===0)return i;var r=0|t.x+t.y*this._layerSize.width;i=this.getChildByTag(r);if(!i){var s=this.tileset.rectForGID(n);s=cc.rectPixelsToPoints(s);i=new cc.Sprite;i.initWithTexture(this.texture,s);i.batchNode=this;i.setPosition(this.getPositionAt(t));i.vertexZ=this._vertexZForPos(t);i.anchorX=0;i.anchorY=0;i.opacity=this._opacity;var a=this._atlasIndexForExistantZ(r);this.addSpriteWithoutQuad(i,a,r)}return i},getTileGIDAt:function(t,e){if(t==null)throw new Error("cc.TMXLayer.getTileGIDAt(): pos should be non-null");if(e!==undefined)t=cc.p(t,e);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles||!this._atlasIndexArray){cc.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released");return null}var i=0|t.x+t.y*this._layerSize.width;var n=this.tiles[i];return(n&cc.TMX_TILE_FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.getTileFlagsAt(): pos should be non-null");if(e!==undefined)t=cc.p(t,e);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles||!this._atlasIndexArray){cc.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released");return null}var i=0|t.x+t.y*this._layerSize.width;var n=this.tiles[i];return(n&cc.TMX_TILE_FLIPPED_ALL)>>>0},setTileGID:function(t,e,i,n){if(!e)throw new Error("cc.TMXLayer.setTileGID(): pos should be non-null");var r;if(n!==undefined){r=cc.p(e,i)}else{r=e;n=i}if(r.x>=this._layerSize.width||r.y>=this._layerSize.height||r.x<0||r.y<0)throw new Error("cc.TMXLayer.setTileGID(): invalid position");if(!this.tiles||!this._atlasIndexArray){cc.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released");return}if(t!==0&&t<this.tileset.firstGid){cc.log("cc.TMXLayer.setTileGID(): invalid gid:"+t);return}n=n||0;this._setNodeDirtyForCache();var s=this.getTileFlagsAt(r);var a=this.getTileGIDAt(r);if(a!==t||s!==n){var o=(t|n)>>>0;if(t===0)this.removeTileAt(r);else if(a===0)this._insertTileForGID(o,r);else{var c=r.x+r.y*this._layerSize.width;var l=this.getChildByTag(c);if(l){var h=this.tileset.rectForGID(t);h=cc.rectPixelsToPoints(h);l.setTextureRect(h,false);if(n!=null)this._setupTileSprite(l,r,o);this.tiles[c]=o}else this._updateTileForGID(o,r)}}},removeTileAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.removeTileAt(): pos should be non-null");if(e!==undefined)t=cc.p(t,e);if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.removeTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray){cc.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");return}var i=this.getTileGIDAt(t);if(i!==0){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();var n=0|t.x+t.y*this._layerSize.width;var r=this._atlasIndexForExistantZ(n);this.tiles[n]=0;this._atlasIndexArray.splice(r,1);var s=this.getChildByTag(n);if(s)cc.SpriteBatchNode.prototype.removeChild.call(this,s,true);else{if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)this.textureAtlas.removeQuadAtIndex(r);if(this._children){var a=this._children;for(var o=0,c=a.length;o<c;o++){var l=a[o];if(l){var h=l.atlasIndex;if(h>=r)l.atlasIndex=h-1}}}}}},getPositionAt:function(t,e){if(e!==undefined)t=cc.p(t,e);var i=cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:i=this._positionForOrthoAt(t);break;case cc.TMX_ORIENTATION_ISO:i=this._positionForIsoAt(t);break;case cc.TMX_ORIENTATION_HEX:i=this._positionForHexAt(t);break}return cc.pointPixelsToPoints(i)},getProperty:function(t){return this.properties[t]},setupTiles:function(){this._renderCmd.initImageSize();this._parseInternalProperties();if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();var t=this._layerSize.height,e=this._layerSize.width;for(var i=0;i<t;i++){for(var n=0;n<e;n++){var r=n+e*i;var s=this.tiles[r];if(s!==0){this._appendTileForGID(s,cc.p(n,i));this._minGID=Math.min(s,this._minGID);this._maxGID=Math.max(s,this._maxGID)}}}if(!(this._maxGID>=this.tileset.firstGid&&this._minGID>=this.tileset.firstGid)){cc.log("cocos2d:TMX: Only 1 tileset per layer is supported")}},addChild:function(t,e,i){cc.log("addChild: is not supported on cc.TMXLayer. Instead use setTileGID or tileAt.")},removeChild:function(t,e){if(!t)return;if(this._children.indexOf(t)===-1){cc.log("cc.TMXLayer.removeChild(): Tile does not belong to TMXLayer");return}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)this._setNodeDirtyForCache();var i=t.atlasIndex;var n=this._atlasIndexArray[i];this.tiles[n]=0;this._atlasIndexArray.splice(i,1);cc.SpriteBatchNode.prototype.removeChild.call(this,t,e);cc.renderer.childrenOrderDirty=true},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},_positionForIsoAt:function(t){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(this._layerSize.height*2-t.x-t.y-2))},_positionForOrthoAt:function(t){return cc.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var e=t.x%2===1?-this._mapTileSize.height/2:0;return cc.p(t.x*this._mapTileSize.width*3/4,(this._layerSize.height-t.y-1)*this._mapTileSize.height+e)},_calculateLayerOffset:function(t){var e=cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:e=cc.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case cc.TMX_ORIENTATION_ISO:e=cc.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case cc.TMX_ORIENTATION_HEX:if(t.x!==0||t.y!==0)cc.log("offset for hexagonal map not implemented yet");break}return e},_appendTileForGID:function(t,e){var i=this.tileset.rectForGID(t);i=cc.rectPixelsToPoints(i);var n=0|e.x+e.y*this._layerSize.width;var r=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(r,e,t);var s=this._atlasIndexArray.length;this.insertQuadFromSprite(r,s);this._atlasIndexArray.splice(s,0,n);return r},_insertTileForGID:function(t,e){var i=this.tileset.rectForGID(t);i=cc.rectPixelsToPoints(i);var n=0|e.x+e.y*this._layerSize.width;var r=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(r,e,t);var s=this._atlasIndexForNewZ(n);this.insertQuadFromSprite(r,s);this._atlasIndexArray.splice(s,0,n);if(this._children){var a=this._children;for(var o=0,c=a.length;o<c;o++){var l=a[o];if(l){var h=l.atlasIndex;if(h>=s)l.atlasIndex=h+1}}}this.tiles[n]=t;return r},_updateTileForGID:function(t,e){var i=this.tileset.rectForGID(t);var n=this._contentScaleFactor;i=cc.rect(i.x/n,i.y/n,i.width/n,i.height/n);var r=e.x+e.y*this._layerSize.width;var s=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(s,e,t);s.atlasIndex=this._atlasIndexForExistantZ(r);s.dirty=true;s.updateTransform();this.tiles[r]=t;return s},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t){if(t==="automatic"){this._useAutomaticVertexZ=true;var e=this.getProperty("cc_alpha_func");var i=0;if(e)i=parseFloat(e);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);var n=cc._renderContext.getUniformLocation(this.shaderProgram.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);this.shaderProgram.use();this.shaderProgram.setUniformLocationWith1f(n,i)}}else this._vertexZvalue=parseInt(t,10)}},_setupTileSprite:function(t,e,i){var n=e.x+e.y*this._layerSize.width;t.setPosition(this.getPositionAt(e));if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)t.vertexZ=this._vertexZForPos(e);else t.tag=n;t.anchorX=0;t.anchorY=0;t.opacity=this._opacity;if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){t.rotation=0}t.setFlippedX(false);t.setFlippedY(false);if((i&cc.TMX_TILE_DIAGONAL_FLAG)>>>0){t.anchorX=.5;t.anchorY=.5;t.x=this.getPositionAt(e).x+t.width/2;t.y=this.getPositionAt(e).y+t.height/2;var r=(i&(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0;if(r===cc.TMX_TILE_HORIZONTAL_FLAG)t.rotation=90;else if(r===cc.TMX_TILE_VERTICAL_FLAG)t.rotation=270;else if(r===(cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_HORIZONTAL_FLAG)>>>0){t.rotation=90;t.setFlippedX(true)}else{t.rotation=270;t.setFlippedX(true)}}else{if((i&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0){t.setFlippedX(true)}if((i&cc.TMX_TILE_VERTICAL_FLAG)>>>0){t.setFlippedY(true)}}},_vertexZForPos:function(t){var e=0;var i=0;if(this._useAutomaticVertexZ){switch(this.layerOrientation){case cc.TMX_ORIENTATION_ISO:i=this._layerSize.width+this._layerSize.height;e=-(i-(t.x+t.y));break;case cc.TMX_ORIENTATION_ORTHO:e=-(this._layerSize.height-t.y);break;case cc.TMX_ORIENTATION_HEX:cc.log("TMX Hexa zOrder not supported");break;default:cc.log("TMX invalid value");break}}else e=this._vertexZvalue;return e},_atlasIndexForExistantZ:function(t){var e;if(this._atlasIndexArray){var i=this._atlasIndexArray;for(var n=0,r=i.length;n<r;n++){e=i[n];if(e===t)break}}if(!cc.isNumber(e))cc.log("cc.TMXLayer._atlasIndexForExistantZ(): TMX atlas index not found. Shall not happen");return n},_atlasIndexForNewZ:function(t){var e=this._atlasIndexArray;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t<r)break}return i}});var _p=cc.TMXLayer.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);_p.layerWidth;cc.defineGetterSetter(_p,"layerWidth",_p._getLayerWidth,_p._setLayerWidth);_p.layerHeight;cc.defineGetterSetter(_p,"layerHeight",_p._getLayerHeight,_p._setLayerHeight);_p.tileWidth;cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);cc.TMXLayer.create=function(t,e,i){return new cc.TMXLayer(t,e,i)};(function(){cc.TMXLayer.CanvasRenderCmd=function(t){cc.SpriteBatchNode.CanvasRenderCmd.call(this,t);this._needDraw=true;this._realWorldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};var e=cc._canvas;var i=document.createElement("canvas");i.width=e.width;i.height=e.height;this._cacheCanvas=i;this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"));var n=new cc.Texture2D;n.initWithElement(i);n.handleLoadedTexture();this._cacheTexture=n;this._cacheDirty=false};var t=cc.TMXLayer.CanvasRenderCmd.prototype=Object.create(cc.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=cc.TMXLayer.CanvasRenderCmd;t._setNodeDirtyForCache=function(){this._cacheDirty=true};t._renderingChildToCache=function(){if(this._cacheDirty){var t=this._cacheContext,e=t.getContext(),i=this._cacheCanvas;e.setTransform(1,0,0,1,0,0);e.clearRect(0,0,i.width,i.height);var n=this._node._children;for(var r=0,s=n.length;r<s;r++){if(n[r]){var a=n[r]._renderCmd;if(a){a.rendering(t,1,1);a._cacheDirty=false}}}this._cacheDirty=false}};t.rendering=function(t,e,i){var n=this._displayedOpacity/255;if(n<=0)return;var r=this._node;this._renderingChildToCache();var s=t||cc._renderContext,a=s.getContext();s.setGlobalAlpha(n);var o=this._cacheCanvas;if(o&&o.width!==0&&o.height!==0){s.setTransform(this._realWorldTransform,e,i);var c=o.height*i;if(r.layerOrientation===cc.TMX_ORIENTATION_HEX){var l=r._mapTileSize.height*.5*i;a.drawImage(o,0,0,o.width,o.height,0,-c+l,o.width*e,c)}else{a.drawImage(o,0,0,o.width,o.height,0,-c,o.width*e,c)}}cc.g_NumberOfDraws++};t._updateCacheContext=function(t,e){var i=this._node,n=i._contentSize,r=this._cacheCanvas,s=cc.contentScaleFactor();r.width=0|n.width*1.5*s;r.height=0|n.height*1.5*s;if(i.layerOrientation===cc.TMX_ORIENTATION_HEX)this._cacheContext.setOffset(0,-i._mapTileSize.height*.5);else this._cacheContext.setOffset(0,0);var a=this._cacheTexture._contentSize;a.width=r.width;a.height=r.height};t.getTexture=function(){return this._cacheTexture};t.visit=function(t){var e=this._node;var i,n,r=e._children;if(!e._visible||!r||r.length===0)return;t=t||this.getParentRenderCmd();if(t)this._curLevel=t._curLevel+1;this._syncStatus(t);if(this._cacheDirty){var s=this._cacheContext,a=this._cacheCanvas,o=s.getContext(),c=e.__instanceId,l=cc.renderer;l._turnToCacheMode(c);e.sortAllChildren();for(i=0,n=r.length;i<n;i++){if(r[i]){var h=r[i]._renderCmd;if(h){h.visit(this);h._cacheDirty=false}}}o.setTransform(1,0,0,1,0,0);o.clearRect(0,0,a.width,a.height);l._renderingToCacheCanvas(s,c);this._cacheDirty=false}cc.renderer.pushRenderCommand(this);this._dirtyFlag=0};t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._realWorldTransform;if(t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c;n.b=i.a*r.b+i.b*r.d;n.c=i.c*r.a+i.d*r.c;n.d=i.c*r.b+i.d*r.d;n.tx=r.a*i.tx+r.c*i.ty+r.tx;n.ty=r.d*i.ty+r.ty+r.b*i.tx}else{n.a=i.a;n.b=i.b;n.c=i.c;n.d=i.d;n.tx=i.tx;n.ty=i.ty}if(e){var s=this._node._children;if(!s||s.length===0)return;var a,o;for(a=0,o=s.length;a<o;a++){s[a]._renderCmd.transform(this,e)}}};t.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._texture.getContentSizeInPixels()};t._reusedTileWithRect=function(t){var e=this._node;e._reusedTile=new cc.Sprite;e._reusedTile.initWithTexture(this._texture,t,false);e._reusedTile.batchNode=e;e._reusedTile.parent=e;e._reusedTile._renderCmd._cachedParent=e._renderCmd;return e._reusedTile}})();(function(){cc.TMXLayer.WebGLRenderCmd=function(t){cc.SpriteBatchNode.WebGLRenderCmd.call(this,t);this._needDraw=true};var t=cc.TMXLayer.WebGLRenderCmd.prototype=Object.create(cc.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=cc.TMXLayer.WebGLRenderCmd;t._updateCacheContext=function(){};t.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._textureAtlas.texture.getContentSizeInPixels();this._textureAtlas.texture.setAliasTexParameters()};t._reusedTileWithRect=function(t){var e=this._node;if(!e._reusedTile){e._reusedTile=new cc.Sprite;e._reusedTile.initWithTexture(e.texture,t,false);e._reusedTile.batchNode=e}else{e._reusedTile.batchNode=null;e._reusedTile.setTextureRect(t,false);e._reusedTile.batchNode=e}return e._reusedTile}})();cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(t,e){this.initWithCCPoint(t,e)},getRatio:function(){return this._ratio},setRatio:function(t){this._ratio=t},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},getChild:function(){return this._child},setChild:function(t){this._child=t},initWithCCPoint:function(t,e){this._ratio=t;this._offset=e;this._child=null;return true}});cc.PointObject.create=function(t,e){return new cc.PointObject(t,e)};cc.ParallaxNode=cc.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(t){this.parallaxArray=t},ctor:function(){cc.Node.prototype.ctor.call(this);this.parallaxArray=[];this._lastPosition=cc.p(-100,-100)},addChild:function(t,e,i,n){if(arguments.length===3){cc.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");return}if(!t)throw new Error("cc.ParallaxNode.addChild(): child should be non-null");var r=new cc.PointObject(i,n);r.setChild(t);this.parallaxArray.push(r);t.setPosition(this._position.x*i.x+n.x,this._position.y*i.y+n.y);cc.Node.prototype.addChild.call(this,t,e,t.tag)},removeChild:function(t,e){var i=this.parallaxArray;for(var n=0;n<i.length;n++){var r=i[n];if(r.getChild()===t){i.splice(n,1);break}}cc.Node.prototype.removeChild.call(this,t,e)},removeAllChildren:function(t){this.parallaxArray.length=0;cc.Node.prototype.removeAllChildren.call(this,t)},_updateParallaxPosition:function(){var t=this._absolutePosition();if(!cc.pointEqualToPoint(t,this._lastPosition)){var e=this.parallaxArray;for(var i=0,n=e.length;i<n;i++){var r=e[i];var s=r.getChild();s.setPosition(-t.x+t.x*r.getRatio().x+r.getOffset().x,-t.y+t.y*r.getRatio().y+r.getOffset().y)}this._lastPosition=t}},_absolutePosition:function(){var t=this._position;var e=this;while(e.parent!==null){e=e.parent;t=cc.pAdd(t,e.getPosition())}return t},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ParallaxNode.CanvasRenderCmd(this);else return new cc.ParallaxNode.WebGLRenderCmd(this)}});cc.ParallaxNode.create=function(){return new cc.ParallaxNode};(function(){cc.ParallaxNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=false};var t=cc.ParallaxNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.ParallaxNode.CanvasRenderCmd;t.updateStatus=function(){this._node._updateParallaxPosition();cc.Node.CanvasRenderCmd.prototype.updateStatus.call(this)};t._syncStatus=function(t){this._node._updateParallaxPosition();cc.Node.CanvasRenderCmd.prototype._syncStatus.call(this,t)}})();cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)return;cc.ParallaxNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=false};var t=cc.ParallaxNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ParallaxNode.WebGLRenderCmd;t.updateStatus=function(){this._node._updateParallaxPosition();cc.Node.WebGLRenderCmd.prototype.updateStatus.call(this)};t._syncStatus=function(t){this._node._updateParallaxPosition();cc.Node.WebGLRenderCmd.prototype._syncStatus.call(this,t)}});cc.CONTROL_EVENT_TOTAL_NUMBER=9;cc.CONTROL_EVENT_TOUCH_DOWN=1<<0;cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=1<<1;cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=1<<2;cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=1<<3;cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=1<<4;cc.CONTROL_EVENT_TOUCH_UP_INSIDE=1<<5;cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=1<<6;cc.CONTROL_EVENT_TOUCH_CANCEL=1<<7;cc.CONTROL_EVENT_VALUECHANGED=1<<8;cc.CONTROL_STATE_NORMAL=1<<0;cc.CONTROL_STATE_HIGHLIGHTED=1<<1;cc.CONTROL_STATE_DISABLED=1<<2;cc.CONTROL_STATE_SELECTED=1<<3;cc.CONTROL_STATE_INITIAL=1<<3;cc.Control=cc.Layer.extend({_isOpacityModifyRGB:false,_hasVisibleParents:false,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(t){this._isOpacityModifyRGB=t;var e=this.getChildren();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r)r.setOpacityModifyRGB(t)}},_state:cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:false,_selected:false,_highlighted:false,_dispatchTable:null,setEnabled:function(t){this._enabled=t;this._state=t?cc.CONTROL_STATE_NORMAL:cc.CONTROL_STATE_DISABLED;this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(t){this._selected=t;this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(t){this._highlighted=t;this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){var t=this.getParent();for(var e=t;e!=null;e=e.getParent()){if(!e.isVisible())return false}return true},ctor:function(){cc.Layer.prototype.ctor.call(this);this._dispatchTable={};this._color=cc.color.WHITE},init:function(){if(cc.Layer.prototype.init.call(this)){this._state=cc.CONTROL_STATE_NORMAL;this._enabled=true;this._selected=false;this._highlighted=false;var t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true});if(this.onTouchBegan)t.onTouchBegan=this.onTouchBegan.bind(this);if(this.onTouchMoved)t.onTouchMoved=this.onTouchMoved.bind(this);if(this.onTouchEnded)t.onTouchEnded=this.onTouchEnded.bind(this);if(this.onTouchCancelled)t.onTouchCancelled=this.onTouchCancelled.bind(this);this._touchListener=t;return true}else return false},onEnter:function(){var t=this._touchListener;if(!t._isRegistered())cc.eventManager.addListener(t,this);cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(t){for(var e=0,i=cc.CONTROL_EVENT_TOTAL_NUMBER;e<i;e++){if(t&1<<e){var n=this._dispatchListforControlEvent(1<<e);for(var r=0,s=n.length;r<s;r++){n[r].invoke(this)}}}},addTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++){if(i&1<<n)this._addTargetWithActionForControlEvent(t,e,1<<n)}},removeTargetWithActionForControlEvents:function(t,e,i){for(var n=0,r=cc.CONTROL_EVENT_TOTAL_NUMBER;n<r;n++){if(i&1<<n)this._removeTargetWithActionForControlEvent(t,e,1<<n)}},getTouchLocation:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},isTouchInside:function(t){var e=t.getLocation();e=this.getParent().convertToNodeSpace(e);return cc.rectContainsPoint(this.getBoundingBox(),e)},_invocationWithTargetAndActionForControlEvent:function(t,e,i){return null},_dispatchListforControlEvent:function(t){t=t.toString();if(!this._dispatchTable[t])this._dispatchTable[t]=[];return this._dispatchTable[t]},_addTargetWithActionForControlEvent:function(t,e,i){var n=new cc.Invocation(t,e,i);var r=this._dispatchListforControlEvent(i);r.push(n)},_removeTargetWithActionForControlEvent:function(t,e,i){var n=this._dispatchListforControlEvent(i);var r=true;if(!t&&!e){n.length=0}else{for(var s=0;s<n.length;){var a=n[s];var o=true;if(t)o=t===a.getTarget();if(e)o=o&&e===a.getAction();if(o)cc.arrayRemoveObject(n,a);else s++}}},needsLayout:function(){}});var _p=cc.Control.prototype;_p.state;cc.defineGetterSetter(_p,"state",_p.getState);_p.enabled;cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);_p.selected;cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);_p.highlighted;cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted);_p=null;cc.Control.create=function(){var t=new cc.Control;if(t&&t.init())return t;return null};cc.CONTROL_ZOOM_ACTION_TAG=3435855873;cc.ControlButton=cc.Control.extend({_doesAdjustBackgroundImage:false,zoomOnTouchDown:false,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:false,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:false,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this);this._preferredSize=cc.size(0,0);this._labelAnchorPoint=cc.p(0,0);this._currentTitle="";this._currentTitleColor=cc.color.WHITE;this._titleDispatchTable={};this._titleColorDispatchTable={};this._titleLabelDispatchTable={};this._backgroundSpriteDispatchTable={};if(i!=undefined)this.initWithTitleAndFontNameAndFontSize(t,e,i);else if(e!=undefined)this.initWithLabelAndBackgroundSprite(t,e);else if(t!=undefined)this.initWithBackgroundSprite(t);else this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new cc.LabelTTF("","Arial",12),new cc.Scale9Sprite)},needsLayout:function(){if(!this._parentInited){return}if(this._titleLabel)this._titleLabel.setVisible(false);if(this._backgroundSprite)this._backgroundSprite.setVisible(false);this.setLabelAnchorPoint(this._labelAnchorPoint);var t=this._state;this._currentTitle=this.getTitleForState(t);this._currentTitleColor=this.getTitleColorForState(t);this._titleLabel=this.getTitleLabelForState(t);var e=this._titleLabel;if(e&&e.setString)e.setString(this._currentTitle);if(e)e.setColor(this._currentTitleColor);var i=this.getContentSize();if(e)e.setPosition(i.width/2,i.height/2);this._backgroundSprite=this.getBackgroundSpriteForState(t);var n=this._backgroundSprite;if(n)n.setPosition(i.width/2,i.height/2);var r=cc.size(0,0);if(e){var s=e.getBoundingBox();r.width=s.width;r.height=s.height}if(this._doesAdjustBackgroundImage){if(n)n.setContentSize(r.width+this._marginH*2,r.height+this._marginV*2)}else{if(n){var a=n.getPreferredSize();a=cc.size(a.width,a.height);if(a.width<=0)a.width=r.width;if(a.height<=0)a.height=r.height;n.setContentSize(a)}}var o=e?e.getBoundingBox():cc.rect(0,0,0,0);var c=n?n.getBoundingBox():cc.rect(0,0,0,0);var l=cc.rectUnion(o,c);this.setContentSize(l.width,l.height);i=this.getContentSize();if(e){e.setPosition(i.width/2,i.height/2);e.setVisible(true)}if(n){n.setPosition(i.width/2,i.height/2);n.setVisible(true)}},initWithLabelAndBackgroundSprite:function(t,e){if(!t)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null");if(!e)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null");if(cc.Control.prototype.init.call(this,true)){this._parentInited=true;this._titleDispatchTable={};this._titleColorDispatchTable={};this._titleLabelDispatchTable={};this._backgroundSpriteDispatchTable={};this._isPushed=false;this.zoomOnTouchDown=true;this._currentTitle=null;this.setAdjustBackgroundImage(true);this.setPreferredSize(cc.size(0,0));this.zoomOnTouchDown=true;this.ignoreAnchorPointForPosition(false);this.setAnchorPoint(.5,.5);this._titleLabel=t;this._backgroundSprite=e;this.setOpacity(255);this.setOpacityModifyRGB(true);var i=t.getString();this.setTitleForState(i,cc.CONTROL_STATE_NORMAL);this.setTitleColorForState(t.getColor(),cc.CONTROL_STATE_NORMAL);this.setTitleLabelForState(t,cc.CONTROL_STATE_NORMAL);this.setBackgroundSpriteForState(e,cc.CONTROL_STATE_NORMAL);this._state=cc.CONTROL_STATE_NORMAL;this._marginH=24;this._marginV=12;this._labelAnchorPoint=cc.p(.5,.5);this.setPreferredSize(cc.size(0,0));this.needsLayout();return true}else return false},initWithTitleAndFontNameAndFontSize:function(t,e,i){var n=new cc.LabelTTF(t,e,i);return this.initWithLabelAndBackgroundSprite(n,new cc.Scale9Sprite)},initWithBackgroundSprite:function(t){var e=new cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(e,t)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(t){this._doesAdjustBackgroundImage=t;this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(t){return this.zoomOnTouchDown=t},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(t){if(t.width===0&&t.height===0){this._doesAdjustBackgroundImage=true}else{this._doesAdjustBackgroundImage=false;var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setPreferredSize(t)}this._preferredSize=t;this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(t){this._labelAnchorPoint=t;if(this._titleLabel)this._titleLabel.setAnchorPoint(t)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},getOpacity:function(){return this._opacity},setOpacity:function(t){cc.Control.prototype.setOpacity.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setOpacity(t)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var i in e)e[i].setColor(t)},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},setMargins:function(t,e){this._marginV=e;this._marginH=t;this.needsLayout()},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t);this.needsLayout()},setSelected:function(t){cc.Control.prototype.setSelected.call(this,t);this.needsLayout()},setHighlighted:function(t){this._state=t?cc.CONTROL_STATE_HIGHLIGHTED:cc.CONTROL_STATE_NORMAL;cc.Control.prototype.setHighlighted.call(this,t);var e=this.getActionByTag(cc.CONTROL_ZOOM_ACTION_TAG);if(e)this.stopAction(e);if(this.zoomOnTouchDown){var i=this.isHighlighted()&&this.isEnabled()&&!this.isSelected()?1.1:1;var n=cc.scaleTo(.05,i);n.setTag(cc.CONTROL_ZOOM_ACTION_TAG);this.runAction(n)}},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()||!this.hasVisibleParents())return false;this._isPushed=true;this.setHighlighted(true);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DOWN);return true},onTouchMoved:function(t,e){if(!this._enabled||!this._isPushed||this._selected){if(this._highlighted)this.setHighlighted(false);return}var i=this.isTouchInside(t);if(i&&!this._highlighted){this.setHighlighted(true);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)}else if(i&&this._highlighted){this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE)}else if(!i&&this._highlighted){this.setHighlighted(false);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)}else if(!i&&!this._highlighted){this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE)}},onTouchEnded:function(t,e){this._isPushed=false;this.setHighlighted(false);if(this.isTouchInside(t)){this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_INSIDE)}else{this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)}},onTouchCancelled:function(t,e){this._isPushed=false;this.setHighlighted(false);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(t){var e=this._titleDispatchTable;if(e){if(e[t])return e[t];return e[cc.CONTROL_STATE_NORMAL]}return""},setTitleForState:function(t,e){this._titleDispatchTable[e]=t||"";if(this.getState()===e)this.needsLayout()},getTitleColorForState:function(t){var e=this._titleColorDispatchTable[t];if(e)return e;e=this._titleColorDispatchTable[cc.CONTROL_STATE_NORMAL];if(e)return e;return cc.color.WHITE},setTitleColorForState:function(t,e){this._titleColorDispatchTable[e]=t;if(this.getState()===e)this.needsLayout()},getTitleLabelForState:function(t){var e=this._titleLabelDispatchTable;if(e[t])return e[t];return e[cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(t,e){var i=this._titleLabelDispatchTable;if(i[e]){var n=i[e];if(n)this.removeChild(n,true)}i[e]=t;t.setVisible(false);t.setAnchorPoint(.5,.5);this.addChild(t,1);if(this.getState()===e)this.needsLayout()},setTitleTTFForState:function(t,e){var i=this.getTitleForState(e);if(!i)i="";this.setTitleLabelForState(new cc.LabelTTF(i,t,12),e)},getTitleTTFForState:function(t){var e=this.getTitleLabelForState(t);if(e!=null&&e instanceof cc.LabelTTF){
return e.getFontName()}else{return""}},setTitleTTFSizeForState:function(t,e){var i=this.getTitleLabelForState(e);if(i!=null&&i instanceof cc.LabelTTF){i.setFontSize(t)}},getTitleTTFSizeForState:function(t){var e=this.getTitleLabelForState(t);if(e!=null&&e instanceof cc.LabelTTF){return e.getFontSize()}return 0},setTitleBMFontForState:function(t,e){var i=this.getTitleForState(e);if(!i)i="";this.setTitleLabelForState(new cc.LabelBMFont(i,t),e)},getTitleBMFontForState:function(t){var e=this.getTitleLabelForState(t);if(e!=null&&e instanceof cc.LabelBMFont){return e.getFntFile()}return""},getBackgroundSpriteForState:function(t){var e=this._backgroundSpriteDispatchTable;if(e[t]){return e[t]}return e[cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(t,e){var i=this._backgroundSpriteDispatchTable;if(i[e]){var n=i[e];if(n)this.removeChild(n,true)}i[e]=t;t.setVisible(false);t.setAnchorPoint(.5,.5);this.addChild(t);var r=this._preferredSize;if(r.width!==0||r.height!==0){t.setPreferredSize(r)}if(this._state===e)this.needsLayout()},setBackgroundSpriteFrameForState:function(t,e){var i=cc.Scale9Sprite.createWithSpriteFrame(t);this.setBackgroundSpriteForState(i,e)}});var _p=cc.ControlButton.prototype;_p.adjustBackground;cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage);_p.preferredSize;cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize);_p.labelAnchor;cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint);_p=null;cc.ControlButton.create=function(t,e,i){return new cc.ControlButton(t,e,i)};cc.RGBA=function(t,e,i,n){this.r=t;this.g=e;this.b=i;this.a=n};cc.HSV=function(t,e,i){this.h=t;this.s=e;this.v=i};cc.ControlUtils={};cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(t,e,i,n){var r=new cc.Sprite("#"+t);if(!r)return null;r.setPosition(i);r.setAnchorPoint(n);e.addChild(r);return r};cc.ControlUtils.HSVfromRGB=function(t){var e=new cc.HSV;var i,n,r;i=t.r<t.g?t.r:t.g;i=i<t.b?i:t.b;n=t.r>t.g?t.r:t.g;n=n>t.b?n:t.b;e.v=n;r=n-i;if(n>0){e.s=r/n}else{e.s=0;e.h=-1;return e}if(t.r>=n){e.h=(t.g-t.b)/r}else{if(t.g>=n)e.h=2+(t.b-t.r)/r;else e.h=4+(t.r-t.g)/r}e.h*=60;if(e.h<0)e.h+=360;return e};cc.ControlUtils.RGBfromHSV=function(t){var e,i,n,r,s;var a;var o=new cc.RGBA;o.a=1;if(t.s<=0){if(!t.h){o.r=t.v;o.g=t.v;o.b=t.v;return o}o.r=0;o.g=0;o.b=0;return o}e=t.h;if(e>=360)e=0;e/=60;a=0|e;s=e-a;i=t.v*(1-t.s);n=t.v*(1-t.s*s);r=t.v*(1-t.s*(1-s));switch(a){case 0:o.r=t.v;o.g=r;o.b=i;break;case 1:o.r=n;o.g=t.v;o.b=i;break;case 2:o.r=i;o.g=t.v;o.b=r;break;case 3:o.r=i;o.g=n;o.b=t.v;break;case 4:o.r=r;o.g=i;o.b=t.v;break;default:o.r=t.v;o.g=i;o.b=n;break}return o};cc.ControlUtils.CCRectUnion=function(t,e){return cc.rectUnion(t,e)};cc.Invocation=cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(t,e,i){this._target=t;this._action=e;this._controlEvent=i},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(t){if(this._target&&this._action){if(cc.isString(this._action)){this._target[this._action](t,this._controlEvent)}else{this._action.call(this._target,t,this._controlEvent)}}}});cc.Spacer=cc.Layer.extend({});cc.Spacer.verticalSpacer=function(t){var e=new cc.Spacer;e.init();e.setContentSize(0,t);return e};cc.Spacer.horizontalSpacer=function(t){var e=new cc.Spacer;e.init();e.setContentSize(t,0);return e};cc.MenuPassive=cc.Layer.extend({_color:null,_opacity:0,_className:"MenuPassive",ctor:function(){},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;e.r=t.r;e.g=t.g;e.b=t.b;if(this._children&&this._children.length>0){for(var i=0;i<this._children.length;i++){if(this._children[i]){this._children[i].setColor(t)}}}if(t.a!==undefined&&!t.a_undefined){this.setOpacity(t.a)}},getOpacity:function(){return this._opacity},setOpacity:function(t){this._opacity=t;if(this._children&&this._children.length>0){for(var e=0;e<this._children.length;e++){if(this._children[e]){this._children[e].setOpacity(t)}}}this._color.a=t},initWithItems:function(t,e){if(this.init()){var i=cc.director.getWinSize();this.ignoreAnchorPointForPosition(true);this.setAnchorPoint(.5,.5);this.setContentSize(i);this.setPosition(i.width/2,i.height/2);var n=0;if(t){this.addChild(t,n);for(var r=0;r<e.length;r++){if(e[r]){n++;this.addChild(e[r],n)}}}return true}return false},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e=-t;var i;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){e+=this._children[i].getContentSize().height*this._children[i].getScaleY()+t}}}var n=0;var r=e/2;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){n=Math.max(n,this._children[i].getContentSize().width);this._children[i].setPosition(0,r-this._children[i].getContentSize().height*this._children[i].getScaleY()/2);r-=this._children[i].getContentSize().height*this._children[i].getScaleY()+t}}}this.setContentSize(n,e)},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e=-t;var i;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){e+=this._children[i].getContentSize().width*this._children[i].getScaleX()+t}}}var n=0;var r=-e/2;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){n=Math.max(n,this._children[i].getContentSize().height);this._children[i].setPosition(r+this._children[i].getContentSize().width*this._children[i].getScaleX()/2,0);r+=this._children[i].getContentSize().width*this._children[i].getScaleX()+t}}}this.setContentSize(e,n)},alignItemsInColumns:function(t){var e=[];var i;for(i=1;i<arguments.length;i++){e.push(arguments[i])}var n=-5;var r=0;var s=0;var a=0;var o;var c;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){if(r>=e.length){cc.log("cc.MenuPassive.alignItemsInColumns(): invalid row index");continue}o=e[r];if(!o){cc.log("cc.MenuPassive.alignItemsInColumns(): can not have zero columns on a row");continue}c=this._children[i].getContentSize().height;s=0|(s>=c||c==null?s:c);++a;if(a>=o){n+=s+5;a=0;s=0;++r}}}}var l=cc.director.getWinSize();r=0;s=0;o=0;var h=0;var u=0;var d=n/2;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){if(o===0){o=e[r];h=l.width/(1+o);u=h}c=this._children[i].getContentSize().height;s=0|(s>=c||c==null?s:c);this._children[i].setPosition(u-l.width/2,d-this._children[i].getContentSize().height/2);u+=h;++a;if(a>=o){d-=s+5;a=0;o=0;s=0;++r}}}}},alignItemsInRows:function(t){var e=[];var i;for(i=1;i<arguments.length;i++){e.push(arguments[i])}var n=[];var r=[];var s=-10;var a=-5;var o=0;var c=0;var l=0;var h;var u;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){if(o>=e.length){cc.log("cc.MenuPassive.alignItemsInRows(): invalid row index");continue}h=e[o];if(!h){cc.log("cc.MenuPassive.alignItemsInColumns(): can't have zero rows on a column");continue}u=this._children[i].getContentSize().width;c=0|(c>=u||u==null?c:u);a+=0|this._children[i].getContentSize().height+5;++l;if(l>=h){n.push(c);r.push(a);s+=c+10;l=0;c=0;a=-5;++o}}}}var d=cc.director.getWinSize();o=0;c=0;h=null;var _=-s/2;var f=0;if(this._children&&this._children.length>0){for(i=0;i<this._children.length;i++){if(this._children[i]){if(h==null){h=e[o];f=r[o]}u=this._children[i].getContentSize().width;c=0|(c>=u||u==null?c:u);this._children[i].setPosition(_+n[o]/2,f-d.height/2);f-=this._children[i].getContentSize().height+10;++l;if(l>=h){_+=c+5;l=0;h=0;c=0;++o}}}}},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return false}});cc.MenuPassive.create=function(t){if(!t){t=null}var e=[];for(var i=1;i<arguments.length;i++){e.push(arguments[i])}var n=new cc.MenuPassive;if(n&&n.initWithItems(t,e)){return n}return null};cc.MenuPassive.createWithItem=function(t){return cc.MenuPassive.create(t,null)};cc.ControlSaturationBrightnessPicker=cc.Control.extend({_saturation:0,_brightness:0,_background:null,_overlay:null,_shadow:null,_slider:null,_startPos:null,_boxPos:0,_boxSize:0,_className:"ControlSaturationBrightnessPicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this);e&&this.initWithTargetAndPos(t,e)},getSaturation:function(){return this._saturation},getBrightness:function(){return this._brightness},getBackground:function(){return this._background},getOverlay:function(){return this._brightness},getShadow:function(){return this._shadow},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){if(cc.Control.prototype.init.call(this)){this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerBackground.png",t,e,cc.p(0,0));this._overlay=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerOverlay.png",t,e,cc.p(0,0));this._shadow=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerShadow.png",t,e,cc.p(0,0));this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5));this._startPos=e;this._boxPos=35;this._boxSize=this._background.getContentSize().width/2;return true}else return false},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t);if(this._slider){this._slider.setOpacity(t?255:128)}},updateWithHSV:function(t){var e=new cc.HSV;e.s=1;e.h=t.h;e.v=1;var i=cc.ControlUtils.RGBfromHSV(e);this._background.setColor(cc.color(0|i.r*255,0|i.g*255,0|i.b*255))},updateDraggerWithHSV:function(t){var e=cc.p(this._startPos.x+this._boxPos+this._boxSize*(1-t.s),this._startPos.y+this._boxPos+this._boxSize*t.v);this._updateSliderPosition(e)},_updateSliderPosition:function(t){var e=this._startPos.x+this._background.getBoundingBox().width*.5;var i=this._startPos.y+this._background.getBoundingBox().height*.5;var n=t.x-e;var r=t.y-i;var s=Math.sqrt(n*n+r*r);var a=Math.atan2(r,n);var o=this._background.getBoundingBox().width*.5;if(s>o){t.x=e+o*Math.cos(a);t.y=i+o*Math.sin(a)}this._slider.setPosition(t);if(t.x<this._startPos.x+this._boxPos)t.x=this._startPos.x+this._boxPos;else if(t.x>this._startPos.x+this._boxPos+this._boxSize-1)t.x=this._startPos.x+this._boxPos+this._boxSize-1;if(t.y<this._startPos.y+this._boxPos)t.y=this._startPos.y+this._boxPos;else if(t.y>this._startPos.y+this._boxPos+this._boxSize)t.y=this._startPos.y+this._boxPos+this._boxSize;this._saturation=1-Math.abs((this._startPos.x+this._boxPos-t.x)/this._boxSize);this._brightness=Math.abs((this._startPos.y+this._boxPos-t.y)/this._boxSize)},_checkSliderPosition:function(t){var e=this._startPos.x+this._background.getBoundingBox().width*.5;var i=this._startPos.y+this._background.getBoundingBox().height*.5;var n=t.x-e;var r=t.y-i;var s=Math.sqrt(n*n+r*r);if(s<=this._background.getBoundingBox().width*.5){this._updateSliderPosition(t);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED);return true}return false},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible()){return false}var i=this.getTouchLocation(t);return this._checkSliderPosition(i)},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this._checkSliderPosition(i)}});var _p=cc.ControlSaturationBrightnessPicker.prototype;_p.saturation;cc.defineGetterSetter(_p,"saturation",_p.getSaturation);_p.brightness;cc.defineGetterSetter(_p,"brightness",_p.getBrightness);_p.background;cc.defineGetterSetter(_p,"background",_p.getBackground);_p.overlay;cc.defineGetterSetter(_p,"overlay",_p.getOverlay);_p.shadow;cc.defineGetterSetter(_p,"shadow",_p.getShadow);_p.slider;cc.defineGetterSetter(_p,"slider",_p.getSlider);_p.startPos;cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;cc.ControlSaturationBrightnessPicker.create=function(t,e){return new cc.ControlSaturationBrightnessPicker(t,e)};cc.ControlHuePicker=cc.Control.extend({_hue:0,_huePercentage:0,_background:null,_slider:null,_startPos:null,_className:"ControlHuePicker",ctor:function(t,e){cc.Control.prototype.ctor.call(this);e&&this.initWithTargetAndPos(t,e)},getHue:function(){return this._hue},setHue:function(t){this._hue=t;this.setHuePercentage(this._hue/360)},getHuePercentage:function(){return this._huePercentage},setHuePercentage:function(t){this._huePercentage=t;this._hue=this._huePercentage*360;var e=this._background.getBoundingBox();var i=this._startPos.x+e.width*.5;var n=this._startPos.y+e.height*.5;var r=e.width*.5-15;var s=this._huePercentage*360-180;var a=cc.degreesToRadians(s);var o=i+r*Math.cos(a);var c=n+r*Math.sin(a);this._slider.setPosition(o,c)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t);if(this._slider){this._slider.setOpacity(t?255:128)}},getBackground:function(){return this._background},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){if(cc.Control.prototype.init.call(this)){this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("huePickerBackground.png",t,e,cc.p(0,0));this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,cc.p(.5,.5));this._slider.setPosition(e.x,e.y+this._background.getBoundingBox().height*.5);this._startPos=e;this._hue=0;this._huePercentage=0;return true}else return false},_updateSliderPosition:function(t){var e=this._background.getBoundingBox();var i=this._startPos.x+e.width*.5;var n=this._startPos.y+e.height*.5;var r=t.x-i;var s=t.y-n;var a=Math.atan2(s,r);var o=cc.radiansToDegrees(a)+180;this.setHue(o);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},_checkSliderPosition:function(t){var e=Math.sqrt(Math.pow(t.x+10,2)+Math.pow(t.y,2));if(80>e&&e>59){this._updateSliderPosition(t);return true}return false},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible()){return false}var i=this.getTouchLocation(t);return this._checkSliderPosition(i)},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this._checkSliderPosition(i)}});var _p=cc.ControlHuePicker.prototype;_p.hue;cc.defineGetterSetter(_p,"hue",_p.getHue,_p.setHue);_p.huePercent;cc.defineGetterSetter(_p,"huePercent",_p.getHuePercentage,_p.setHuePercentage);_p.background;cc.defineGetterSetter(_p,"background",_p.getBackground);_p.slider;cc.defineGetterSetter(_p,"slider",_p.getSlider);_p.startPos;cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;cc.ControlHuePicker.create=function(t,e){return new cc.ControlHuePicker(t,e)};cc.ControlColourPicker=cc.Control.extend({_hsv:null,_colourPicker:null,_huePicker:null,_background:null,_className:"ControlColourPicker",ctor:function(){cc.Control.prototype.ctor.call(this);this.init()},hueSliderValueChanged:function(t,e){this._hsv.h=t.getHue();var i=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|i.r*255,0|i.g*255,0|i.b*255));this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED);this._updateControlPicker()},colourSliderValueChanged:function(t,e){this._hsv.s=t.getSaturation();this._hsv.v=t.getBrightness();var i=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|i.r*255,0|i.g*255,0|i.b*255));this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},setColor:function(t){cc.Control.prototype.setColor.call(this,t);var e=new cc.RGBA;e.r=t.r/255;e.g=t.g/255;e.b=t.b/255;e.a=1;this._hsv=cc.ControlUtils.HSVfromRGB(e);this._updateHueAndControlPicker()},getBackground:function(){return this._background},init:function(){if(cc.Control.prototype.init.call(this)){cc.spriteFrameCache.addSpriteFrames(res.CCControlColourPickerSpriteSheet_plist);var t=new cc.SpriteBatchNode(res.CCControlColourPickerSpriteSheet_png);this.addChild(t);this._hsv=new cc.HSV(0,0,0);this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("menuColourPanelBackground.png",t,cc.p(0,0),cc.p(.5,.5));var e=cc.pSub(this._background.getPosition(),cc.p(this._background.getContentSize().width/2,this._background.getContentSize().height/2));var i=8;var n=28;this._huePicker=new cc.ControlHuePicker(t,cc.p(e.x+i,e.y+i));this._colourPicker=new cc.ControlSaturationBrightnessPicker(t,cc.p(e.x+n,e.y+n));this._huePicker.addTargetWithActionForControlEvents(this,this.hueSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED);this._colourPicker.addTargetWithActionForControlEvents(this,this.colourSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED);this._updateHueAndControlPicker();this.addChild(this._huePicker);this.addChild(this._colourPicker);this.setContentSize(this._background.getContentSize());return true}else return false},_updateControlPicker:function(){this._huePicker.setHue(this._hsv.h);this._colourPicker.updateWithHSV(this._hsv)},_updateHueAndControlPicker:function(){this._huePicker.setHue(this._hsv.h);this._colourPicker.updateWithHSV(this._hsv);this._colourPicker.updateDraggerWithHSV(this._hsv)},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t);if(this._huePicker!==null){this._huePicker.setEnabled(t)}if(this._colourPicker){this._colourPicker.setEnabled(t)}},onTouchBegan:function(){return false}});var _p=cc.ControlColourPicker.prototype;_p.background;cc.defineGetterSetter(_p,"background",_p.getBackground);_p=null;cc.ControlColourPicker.create=function(){return new cc.ControlColourPicker};var res=res||{};res.CCControlColourPickerSpriteSheet_plist=res.CCControlColourPickerSpriteSheet_plist||"res/extensions/CCControlColourPickerSpriteSheet.plist";res.CCControlColourPickerSpriteSheet_png=res.CCControlColourPickerSpriteSheet_png||"res/extensions/CCControlColourPickerSpriteSheet.png";cc.SLIDER_MARGIN_H=24;cc.SLIDER_MARGIN_V=8;cc.ControlSlider=cc.Control.extend({_value:0,_minimumValue:0,_maximumValue:0,_minimumAllowedValue:0,_maximumAllowedValue:0,_thumbSprite:null,_progressSprite:null,_backgroundSprite:null,_className:"ControlSlider",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this);if(i!=undefined){var n=new cc.Sprite(t);var r=new cc.Sprite(e);var s=new cc.Sprite(i);this.initWithSprites(n,r,s)}},getValue:function(){return this._value},setValue:function(t){t=Math.max(t,this._minimumValue);t=Math.min(t,this._maximumValue);this._value=t;this.needsLayout();this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getMinimumValue:function(){return this._minimumValue},setMinimumValue:function(t){this._minimumValue=t;this._minimumAllowedValue=t;if(this._minimumValue>=this._maximumValue)this._maximumValue=this._minimumValue+1;this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setMaximumValue:function(t){this._maximumValue=t;this._maximumAllowedValue=t;if(this._maximumValue<=this._minimumValue)this._minimumValue=this._maximumValue-1;this.setValue(this._value)},isTouchInside:function(t){var e=t.getLocation();e=this.getParent().convertToNodeSpace(e);var i=this.getBoundingBox();i.width+=this._thumbSprite.getContentSize().width;i.x-=this._thumbSprite.getContentSize().width/2;return cc.rectContainsPoint(i,e)},locationFromTouch:function(t){var e=t.getLocation();e=this.convertToNodeSpace(e);if(e.x<0){e.x=0}else if(e.x>this._backgroundSprite.getContentSize().width){e.x=this._backgroundSprite.getContentSize().width}return e},getMinimumAllowedValue:function(){return this._minimumAllowedValue},setMinimumAllowedValue:function(t){this._minimumAllowedValue=t},getMaximumAllowedValue:function(){return this._maximumAllowedValue},setMaximumAllowedValue:function(t){this._maximumAllowedValue=t},getThumbSprite:function(){return this._thumbSprite},getProgressSprite:function(){return this._progressSprite},getBackgroundSprite:function(){return this._backgroundSprite},initWithSprites:function(t,e,i){if(cc.Control.prototype.init.call(this)){this.ignoreAnchorPointForPosition(false);this._backgroundSprite=t;this._progressSprite=e;this._thumbSprite=i;var n=cc.ControlUtils.CCRectUnion(t.getBoundingBox(),i.getBoundingBox());this.setContentSize(n.width,n.height);this._backgroundSprite.setAnchorPoint(.5,.5);this._backgroundSprite.setPosition(n.width/2,n.height/2);this.addChild(this._backgroundSprite);this._progressSprite.setAnchorPoint(0,.5);this._progressSprite.setPosition(0,n.height/2);this.addChild(this._progressSprite);this._thumbSprite.setPosition(0,n.height/2);this.addChild(this._thumbSprite);this._minimumValue=0;this._maximumValue=1;this.setValue(this._minimumValue);return true}else return false},setEnabled:function(t){cc.Control.prototype.setEnabled.call(this,t);if(this._thumbSprite){this._thumbSprite.setOpacity(t?255:128)}},sliderBegan:function(t){this.setSelected(true);this._thumbSprite.setColor(cc.color.GRAY);this.setValue(this.valueForLocation(t))},sliderMoved:function(t){this.setValue(this.valueForLocation(t))},sliderEnded:function(t){if(this.isSelected()){this.setValue(this.valueForLocation(this._thumbSprite.getPosition()))}this._thumbSprite.setColor(cc.color.WHITE);this.setSelected(false)},getTouchLocationInControl:function(t){var e=t.getLocation();e=this.convertToNodeSpace(e);if(e.x<0){e.x=0}else if(e.x>this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H){e.x=this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H}return e},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return false;var i=this.locationFromTouch(t);this.sliderBegan(i);return true},onTouchMoved:function(t,e){var i=this.locationFromTouch(t);this.sliderMoved(i)},onTouchEnded:function(t,e){this.sliderEnded(cc.p(0,0))},needsLayout:function(){var t=(this._value-this._minimumValue)/(this._maximumValue-this._minimumValue);this._thumbSprite.setPositionX(t*this._backgroundSprite.getContentSize().width);var e=this._progressSprite.getTextureRect();e=cc.rect(e.x,e.y,this._thumbSprite.getPositionX(),e.height);this._progressSprite.setTextureRect(e,this._progressSprite.isTextureRectRotated());this._thumbSprite._renderCmd.transform(this._renderCmd)},valueForLocation:function(t){var e=t.x/this._backgroundSprite.getContentSize().width;return Math.max(Math.min(this._minimumValue+e*(this._maximumValue-this._minimumValue),this._maximumAllowedValue),this._minimumAllowedValue)}});var _p=cc.ControlSlider.prototype;_p.value;cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.minAllowedValue;cc.defineGetterSetter(_p,"minAllowedValue",_p.getMinimumAllowedValue,_p.setMinimumAllowedValue);_p.maxAllowedValue;cc.defineGetterSetter(_p,"maxAllowedValue",_p.getMaximumAllowedValue,_p.setMaximumAllowedValue);_p.thumbSprite;cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite);_p.progressSprite;cc.defineGetterSetter(_p,"progressSprite",_p.getProgressSprite);_p.backgroundSprite;cc.defineGetterSetter(_p,"backgroundSprite",_p.getBackgroundSprite);_p=null;cc.ControlSlider.create=function(t,e,i){return new cc.ControlSlider(t,e,i)};cc.ControlSwitch=cc.Control.extend({_switchSprite:null,_initialTouchXPosition:0,_moved:false,_on:false,_className:"ControlSwitch",ctor:function(t,e,i,n,r,s){cc.Control.prototype.ctor.call(this);s&&this.initWithMaskSprite(t,e,i,n,r,s)},initWithMaskSprite:function(t,e,i,n,r,s){if(!t)throw new Error("cc.ControlSwitch.initWithMaskSprite(): maskSprite should be non-null.");if(!e)throw new Error("cc.ControlSwitch.initWithMaskSprite(): onSprite should be non-null.");if(!i)throw new Error("cc.ControlSwitch.initWithMaskSprite(): offSprite should be non-null.");if(!n)throw new Error("cc.ControlSwitch.initWithMaskSprite(): thumbSprite should be non-null.");if(this.init()){this._on=true;this._switchSprite=new cc.ControlSwitchSprite;this._switchSprite.initWithMaskSprite(t,e,i,n,r,s);this._switchSprite.setPosition(this._switchSprite.getContentSize().width/2,this._switchSprite.getContentSize().height/2);this.addChild(this._switchSprite);this.ignoreAnchorPointForPosition(false);this.setAnchorPoint(.5,.5);this.setContentSize(this._switchSprite.getContentSize());return true}return false},setOn:function(t,e){e=e||false;this._on=t;var i=this._on?this._switchSprite.getOnPosition():this._switchSprite.getOffPosition();if(e){this._switchSprite.runAction(new cc.ActionTween(.2,"sliderXPosition",this._switchSprite.getSliderXPosition(),i))}else{this._switchSprite.setSliderXPosition(i)}this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},isOn:function(){return this._on},hasMoved:function(){return this._moved},setEnabled:function(t){this._enabled=t;this._switchSprite.setOpacity(t?255:128)},locationFromTouch:function(t){var e=t.getLocation();e=this.convertToNodeSpace(e);return e},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()){return false}this._moved=false;var i=this.locationFromTouch(t);this._initialTouchXPosition=i.x-this._switchSprite.getSliderXPosition();this._switchSprite.getThumbSprite().setColor(cc.color.GRAY);this._switchSprite.needsLayout();return true},onTouchMoved:function(t,e){var i=this.locationFromTouch(t);i=cc.p(i.x-this._initialTouchXPosition,0);this._moved=true;this._switchSprite.setSliderXPosition(i.x)},onTouchEnded:function(t,e){var i=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE);if(this.hasMoved()){this.setOn(!(i.x<this._switchSprite.getContentSize().width/2),true)}else{this.setOn(!this._on,true)}},onTouchCancelled:function(t,e){var i=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE);if(this.hasMoved()){this.setOn(!(i.x<this._switchSprite.getContentSize().width/2),true)}else{this.setOn(!this._on,true)}}});cc.ControlSwitch.create=function(t,e,i,n,r,s){return new cc.ControlSwitch(t,e,i,n,r,s)};cc.ControlSwitchSprite=cc.Sprite.extend({_sliderXPosition:0,_onPosition:0,_offPosition:0,_textureLocation:0,_maskLocation:0,_maskSize:null,_onSprite:null,_offSprite:null,_thumbSprite:null,_onLabel:null,_offLabel:null,_clipper:null,_stencil:null,_backRT:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);this._sliderXPosition=0;this._onPosition=0;this._offPosition=0;this._maskLocation=0;this._maskSize=cc.size(0,0);this._onSprite=null;this._offSprite=null;this._thumbSprite=null;this._onLabel=null;this._offLabel=null},initWithMaskSprite:function(t,e,i,n,r,s){if(cc.Sprite.prototype.init.call(this)){this.setSpriteFrame(t.displayFrame());this._onPosition=0;this._offPosition=-e.getContentSize().width+n.getContentSize().width/2;this._sliderXPosition=this._onPosition;this.setOnSprite(e);this.setOffSprite(i);this.setThumbSprite(n);this.setOnLabel(r);this.setOffLabel(s);this._stencil=t;var a=this._maskSize=this._stencil.getContentSize();this._stencil.setPosition(0,0);this._clipper=new cc.ClippingNode;this._clipper.setAnchorPoint(.5,.5);this._clipper.setPosition(a.width/2,a.height/2);this._clipper.setStencil(this._stencil);this.addChild(this._clipper);this._clipper.addChild(e);this._clipper.addChild(i);this._clipper.addChild(r);this._clipper.addChild(s);this.addChild(this._thumbSprite);this.needsLayout();return true}return false},needsLayout:function(){var t=this._maskSize;this._onSprite.setPosition(this._onSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._onSprite.getContentSize().height/2-t.height/2);this._offSprite.setPosition(this._onSprite.getContentSize().width+this._offSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._offSprite.getContentSize().height/2-t.height/2);if(this._onLabel){this._onLabel.setPosition(this._onSprite.getPositionX()-this._thumbSprite.getContentSize().width/6,this._onSprite.getContentSize().height/2-t.height/2)}if(this._offLabel){this._offLabel.setPosition(this._offSprite.getPositionX()+this._thumbSprite.getContentSize().width/6,this._offSprite.getContentSize().height/2-t.height/2)}this._thumbSprite.setPosition(this._onSprite.getContentSize().width+this._sliderXPosition,this._maskSize.height/2)},setSliderXPosition:function(t){if(t<=this._offPosition){t=this._offPosition}else if(t>=this._onPosition){t=this._onPosition}this._sliderXPosition=t;this.needsLayout()},getSliderXPosition:function(){return this._sliderXPosition},_getOnSideWidth:function(){return this._onSprite.getContentSize().width},_getOffSideWidth:function(){return this._offSprite.getContentSize().height},updateTweenAction:function(t,e){if(e==="sliderXPosition")this.setSliderXPosition(t)},setOnPosition:function(t){this._onPosition=t},getOnPosition:function(){return this._onPosition},setOffPosition:function(t){this._offPosition=t},getOffPosition:function(){return this._offPosition},setMaskTexture:function(t){this._stencil.setTexture(t)},getMaskTexture:function(){return this._stencil.getTexture()},setTextureLocation:function(t){this._textureLocation=t},getTextureLocation:function(){return this._textureLocation},setMaskLocation:function(t){this._maskLocation=t},getMaskLocation:function(){return this._maskLocation},setOnSprite:function(t){this._onSprite=t},getOnSprite:function(){return this._onSprite},setOffSprite:function(t){this._offSprite=t},getOffSprite:function(){return this._offSprite},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setOnLabel:function(t){this._onLabel=t},getOnLabel:function(){return this._onLabel},setOffLabel:function(t){this._offLabel=t},getOffLabel:function(){return this._offLabel}});var _p=cc.ControlSwitchSprite.prototype;_p.sliderX;cc.defineGetterSetter(_p,"sliderX",_p.getSliderXPosition,_p.setSliderXPosition);_p.onPos;cc.defineGetterSetter(_p,"onPos",_p.getOnPosition,_p.setOnPosition);_p.offPos;cc.defineGetterSetter(_p,"offPos",_p.getOffPosition,_p.setOffPosition);_p.maskTexture;cc.defineGetterSetter(_p,"maskTexture",_p.getMaskTexture,_p.setMaskTexture);_p.maskPos;cc.defineGetterSetter(_p,"maskPos",_p.getMaskLocation,_p.setMaskLocation);_p.onSprite;cc.defineGetterSetter(_p,"onSprite",_p.getOnSprite,_p.setOnSprite);_p.offSprite;cc.defineGetterSetter(_p,"offSprite",_p.getOffSprite,_p.setOffSprite);_p.thumbSprite;cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);_p.onLabel;cc.defineGetterSetter(_p,"onLabel",_p.getOnLabel,_p.setOnLabel);_p.offLabel;cc.defineGetterSetter(_p,"offLabel",_p.getOffLabel,_p.setOffLabel);_p.onSideWidth;cc.defineGetterSetter(_p,"onSideWidth",_p._getOnSideWidth);_p.offSideWidth;cc.defineGetterSetter(_p,"offSideWidth",_p._getOffSideWidth);_p=null;cc.CONTROL_STEPPER_PARTMINUS=0;cc.CONTROL_STEPPER_PARTPLUS=1;cc.CONTROL_STEPPER_PARTNONE=2;cc.CONTROL_STEPPER_LABELCOLOR_ENABLED=cc.color(55,55,55);cc.CONTROL_STEPPER_LABELCOLOR_DISABLED=cc.color(147,147,147);cc.CONTROL_STEPPER_LABELFONT="CourierNewPSMT";cc.AUTOREPEAT_DELTATIME=.15;cc.AUTOREPEAT_INCREASETIME_INCREMENT=12;cc.ControlStepper=cc.Control.extend({_minusSprite:null,_plusSprite:null,_minusLabel:null,_plusLabel:null,_value:0,_continuous:false,_autorepeat:false,_wraps:false,_minimumValue:0,_maximumValue:0,_stepValue:0,_touchInsideFlag:false,_touchedPart:cc.CONTROL_STEPPER_PARTNONE,_autorepeatCount:0,_className:"ControlStepper",ctor:function(t,e){cc.Control.prototype.ctor.call(this);this._minusSprite=null;this._plusSprite=null;this._minusLabel=null;this._plusLabel=null;this._value=0;this._continuous=false;this._autorepeat=false;this._wraps=false;this._minimumValue=0;this._maximumValue=0;this._stepValue=0;this._touchInsideFlag=false;this._touchedPart=cc.CONTROL_STEPPER_PARTNONE;this._autorepeatCount=0;e&&this.initWithMinusSpriteAndPlusSprite(t,e)},initWithMinusSpriteAndPlusSprite:function(t,e){if(!t)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Minus sprite should be non-null.");if(!e)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Plus sprite should be non-null.");if(this.init()){this._autorepeat=true;this._continuous=true;
this._minimumValue=0;this._maximumValue=100;this._value=0;this._stepValue=1;this._wraps=false;this.ignoreAnchorPointForPosition(false);this.setMinusSprite(t);this._minusSprite.setPosition(t.getContentSize().width/2,t.getContentSize().height/2);this.addChild(this._minusSprite);this.setMinusLabel(new cc.LabelTTF("-",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER));this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_DISABLED);this._minusLabel.setPosition(this._minusSprite.getContentSize().width/2,this._minusSprite.getContentSize().height/2);this._minusSprite.addChild(this._minusLabel);this.setPlusSprite(e);this._plusSprite.setPosition(t.getContentSize().width+e.getContentSize().width/2,t.getContentSize().height/2);this.addChild(this._plusSprite);this.setPlusLabel(new cc.LabelTTF("+",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER));this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED);this._plusLabel.setPosition(this._plusSprite.getContentSize().width/2,this._plusSprite.getContentSize().height/2);this._plusSprite.addChild(this._plusLabel);var i=cc.ControlUtils.CCRectUnion(this._minusSprite.getBoundingBox(),this._plusSprite.getBoundingBox());this.setContentSize(this._minusSprite.getContentSize().width+this._plusSprite.getContentSize().height,i.height);return true}return false},setWraps:function(t){this._wraps=t;if(this._wraps){this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED);this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)}this.setValue(this._value)},getWraps:function(){return this._wraps},setMinimumValue:function(t){if(t>=this._maximumValue)throw new Error("cc.ControlStepper.setMinimumValue(): minimumValue should be numerically less than maximumValue.");this._minimumValue=t;this.setValue(this._value)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){if(t<=this._minimumValue)throw new Error("cc.ControlStepper.setMaximumValue(): maximumValue should be numerically less than maximumValue.");this._maximumValue=t;this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setValue:function(t){this.setValueWithSendingEvent(t,true)},getValue:function(){return this._value},setStepValue:function(t){if(t<=0)throw new Error("cc.ControlStepper.setMaximumValue(): stepValue should be numerically greater than 0.");this._stepValue=t},getStepValue:function(){return this._stepValue},isContinuous:function(){return this._continuous},setValueWithSendingEvent:function(t,e){if(t<this._minimumValue){t=this._wraps?this._maximumValue:this._minimumValue}else if(t>this._maximumValue){t=this._wraps?this._minimumValue:this._maximumValue}this._value=t;if(!this._wraps){this._minusLabel.setColor(t===this._minimumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED);this._plusLabel.setColor(t===this._maximumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)}if(e){this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)}},startAutorepeat:function(){this._autorepeatCount=-1;this.schedule(this.update,cc.AUTOREPEAT_DELTATIME,cc.REPEAT_FOREVER,cc.AUTOREPEAT_DELTATIME*3)},stopAutorepeat:function(){this.unschedule(this.update)},update:function(t){this._autorepeatCount++;if(this._autorepeatCount<cc.AUTOREPEAT_INCREASETIME_INCREMENT&&this._autorepeatCount%3!==0)return;if(this._touchedPart===cc.CONTROL_STEPPER_PARTMINUS){this.setValueWithSendingEvent(this._value-this._stepValue,this._continuous)}else if(this._touchedPart===cc.CONTROL_STEPPER_PARTPLUS){this.setValueWithSendingEvent(this._value+this._stepValue,this._continuous)}},updateLayoutUsingTouchLocation:function(t){if(t.x<this._minusSprite.getContentSize().width&&this._value>this._minimumValue){this._touchedPart=cc.CONTROL_STEPPER_PARTMINUS;this._minusSprite.setColor(cc.color.GRAY);this._plusSprite.setColor(cc.color.WHITE)}else if(t.x>=this._minusSprite.getContentSize().width&&this._value<this._maximumValue){this._touchedPart=cc.CONTROL_STEPPER_PARTPLUS;this._minusSprite.setColor(cc.color.WHITE);this._plusSprite.setColor(cc.color.GRAY)}else{this._touchedPart=cc.CONTROL_STEPPER_PARTNONE;this._minusSprite.setColor(cc.color.WHITE);this._plusSprite.setColor(cc.color.WHITE)}},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()){return false}var i=this.getTouchLocation(t);this.updateLayoutUsingTouchLocation(i);this._touchInsideFlag=true;if(this._autorepeat){this.startAutorepeat()}return true},onTouchMoved:function(t,e){if(this.isTouchInside(t)){var i=this.getTouchLocation(t);this.updateLayoutUsingTouchLocation(i);if(!this._touchInsideFlag){this._touchInsideFlag=true;if(this._autorepeat){this.startAutorepeat()}}}else{this._touchInsideFlag=false;this._touchedPart=cc.CONTROL_STEPPER_PARTNONE;this._minusSprite.setColor(cc.color.WHITE);this._plusSprite.setColor(cc.color.WHITE);if(this._autorepeat){this.stopAutorepeat()}}},onTouchEnded:function(t,e){this._minusSprite.setColor(cc.color.WHITE);this._plusSprite.setColor(cc.color.WHITE);if(this._autorepeat){this.stopAutorepeat()}if(this.isTouchInside(t)){var i=this.getTouchLocation(t);this.setValue(this._value+(i.x<this._minusSprite.getContentSize().width?0-this._stepValue:this._stepValue))}},setMinusSprite:function(t){this._minusSprite=t},getMinusSprite:function(){return this._minusSprite},setPlusSprite:function(t){this._plusSprite=t},getPlusSprite:function(){return this._plusSprite},setMinusLabel:function(t){this._minusLabel=t},getMinusLabel:function(){return this._minusLabel},setPlusLabel:function(t){this._plusLabel=t},getPlusLabel:function(){return this._plusLabel}});var _p=cc.ControlStepper.prototype;_p.wraps;cc.defineGetterSetter(_p,"wraps",_p.getWraps,_p.setWraps);_p.value;cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.stepValue;cc.defineGetterSetter(_p,"stepValue",_p.getStepValue,_p.setStepValue);_p.continuous;cc.defineGetterSetter(_p,"continuous",_p.isContinuous);_p.minusSprite;cc.defineGetterSetter(_p,"minusSprite",_p.getMinusSprite,_p.setMinusSprite);_p.plusSprite;cc.defineGetterSetter(_p,"plusSprite",_p.getPlusSprite,_p.setPlusSprite);_p.minusLabel;cc.defineGetterSetter(_p,"minusLabel",_p.getMinusLabel,_p.setMinusLabel);_p.plusLabel;cc.defineGetterSetter(_p,"plusLabel",_p.getPlusLabel,_p.setPlusLabel);_p=null;cc.ControlStepper.create=function(t,e){return new cc.ControlStepper(t,e)};cc.ControlPotentiometer=cc.Control.extend({_thumbSprite:null,_progressTimer:null,_previousLocation:null,_value:0,_minimumValue:0,_maximumValue:1,_className:"ControlPotentiometer",ctor:function(t,e,i){cc.Control.prototype.ctor.call(this);if(i!=undefined){var n=new cc.Sprite(t);var r=new cc.Sprite(i);var s=new cc.ProgressTimer(new cc.Sprite(e));this.initWithTrackSprite_ProgressTimer_ThumbSprite(n,s,r)}},initWithTrackSprite_ProgressTimer_ThumbSprite:function(t,e,i){if(this.init()){this.setProgressTimer(e);this.setThumbSprite(i);this._thumbSprite.setPosition(e.getPosition());this.addChild(i,2);this.addChild(e,1);this.addChild(t);this.setContentSize(t.getContentSize());this._minimumValue=0;this._maximumValue=1;this.setValue(this._minimumValue);return true}return false},setEnabled:function(t){this.setEnabled(t);if(this._thumbSprite!==null){this._thumbSprite.setOpacity(t?255:128)}},setValue:function(t){if(t<this._minimumValue){t=this._minimumValue}if(t>this._maximumValue){t=this._maximumValue}this._value=t;var e=(t-this._minimumValue)/(this._maximumValue-this._minimumValue);this._progressTimer.setPercentage(e*100);this._thumbSprite.setRotation(e*360);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getValue:function(){return this._value},setMinimumValue:function(t){this._minimumValue=t;if(this._minimumValue>=this._maximumValue){this._maximumValue=this._minimumValue+1}this.setValue(this._maximumValue)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){this._maximumValue=t;if(this._maximumValue<=this._minimumValue){this._minimumValue=this._maximumValue-1}this.setValue(this._minimumValue)},getMaximumValue:function(){return this._maximumValue},isTouchInside:function(t){var e=this.getTouchLocation(t);var i=this.distanceBetweenPointAndPoint(this._progressTimer.getPosition(),e);return i<Math.min(this.getContentSize().width/2,this.getContentSize().height/2)},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()){return false}this._previousLocation=this.getTouchLocation(t);this.potentiometerBegan(this._previousLocation);return true},onTouchMoved:function(t,e){var i=this.getTouchLocation(t);this.potentiometerMoved(i)},onTouchEnded:function(t,e){this.potentiometerEnded(cc.p(0,0))},distanceBetweenPointAndPoint:function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(i*i+n*n)},angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint:function(t,e,i,n){var r=e.x-t.x;var s=e.y-t.y;var a=n.x-i.x;var o=n.y-i.y;var c=Math.atan2(r,s);var l=Math.atan2(a,o);return(c-l)*180/Math.PI},potentiometerBegan:function(t){this.setSelected(true);this.getThumbSprite().setColor(cc.color.GRAY)},potentiometerMoved:function(t){var e=this.angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint(this._progressTimer.getPosition(),t,this._progressTimer.getPosition(),this._previousLocation);if(e>180){e-=360}else if(e<-180){e+=360}this.setValue(this._value+e/360*(this._maximumValue-this._minimumValue));this._previousLocation=t},potentiometerEnded:function(t){this.getThumbSprite().setColor(cc.color.WHITE);this.setSelected(false)},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setProgressTimer:function(t){this._progressTimer=t},getProgressTimer:function(){return this._progressTimer},setPreviousLocation:function(t){this._previousLocation=t},getPreviousLocation:function(){return this._previousLocation}});var _p=cc.ControlPotentiometer.prototype;_p.value;cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.progressTimer;cc.defineGetterSetter(_p,"progressTimer",_p.getProgressTimer,_p.setProgressTimer);_p.thumbSprite;cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);_p.prevLocation;cc.defineGetterSetter(_p,"prevLocation",_p.getPreviousLocation,_p.setPreviousLocation);_p=null;cc.ControlPotentiometer.create=function(t,e,i){return new cc.ControlPotentiometer(t,e,i)};cc.SCROLLVIEW_DIRECTION_NONE=-1;cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0;cc.SCROLLVIEW_DIRECTION_VERTICAL=1;cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=.95;var SCROLL_DEACCEL_DIST=1;var BOUNCE_DURATION=.15;var INSET_RATIO=.2;var MOVE_INCH=7/160;var BOUNCE_BACK_FACTOR=.35;cc.convertDistanceFromPointToInch=function(t){var e=cc.view;var i=(e.getScaleX()+e.getScaleY())/2;return t*i/160};cc.ScrollViewDelegate=cc.Class.extend({scrollViewDidScroll:function(t){},scrollViewDidZoom:function(t){}});cc.ScrollView=cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:false,_contentOffset:null,_container:null,_touchMoved:false,_maxInset:null,_minInset:null,_bounceable:false,_clippingToBounds:false,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:false,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(t,e){cc.Layer.prototype.ctor.call(this);this._contentOffset=cc.p(0,0);this._maxInset=cc.p(0,0);this._minInset=cc.p(0,0);this._scrollDistance=cc.p(0,0);this._touchPoint=cc.p(0,0);this._touches=[];this._viewSize=cc.size(0,0);this._parentScissorRect=new cc.Rect(0,0,0,0);this._tmpViewRect=new cc.Rect(0,0,0,0);if(e!=undefined)this.initWithViewSize(t,e);else this.initWithViewSize(cc.size(200,200),null)},init:function(){return this.initWithViewSize(cc.size(200,200),null)},initWithViewSize:function(t,e){var i=cc.p(0,0);if(cc.Layer.prototype.init.call(this)){if(!e&&!this._container){e=new cc.Layer}if(e){this.setContainer(e)}this.setViewSize(t);this.setTouchEnabled(true);this._touches.length=0;this._delegate=null;this._bounceable=true;this._clippingToBounds=true;this._direction=cc.SCROLLVIEW_DIRECTION_BOTH;this._container.setPosition(i);this._touchLength=0;this._minScale=this._maxScale=1;return true}return false},setContentOffset:function(t,e){if(e){this.setContentOffsetInDuration(t,BOUNCE_DURATION);return}if(!this._bounceable){var i=this.minContainerOffset();var n=this.maxContainerOffset();t.x=Math.max(i.x,Math.min(n.x,t.x));t.y=Math.max(i.y,Math.min(n.y,t.y))}this._container.setPosition(t);var r=this._delegate;if(r!=null&&r.scrollViewDidScroll){r.scrollViewDidScroll(this)}},getContentOffset:function(){var t=this._container.getPosition();return cc.p(t.x,t.y)},setContentOffsetInDuration:function(t,e){var i=cc.moveTo(e,t);var n=cc.callFunc(this._stoppedAnimatedScroll,this);this._container.runAction(cc.sequence(i,n));this.schedule(this._performedAnimatedScroll)},setZoomScale:function(t,e){if(e){this.setZoomScaleInDuration(t,BOUNCE_DURATION);return}var i=this._container;if(i.getScale()!==t){var n,r;var s;if(this._touchLength===0){var a=this._viewSize;s=cc.p(a.width*.5,a.height*.5);s=this.convertToWorldSpace(s)}else s=this._touchPoint;n=i.convertToNodeSpace(s);i.setScale(Math.max(this._minScale,Math.min(this._maxScale,t)));r=i.convertToWorldSpace(n);var o=cc.pSub(s,r);if(this._delegate&&this._delegate.scrollViewDidZoom)this._delegate.scrollViewDidZoom(this);this.setContentOffset(cc.pAdd(i.getPosition(),o))}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(t,e){if(e>0){var i=this._container.getScale();if(i!==t){var n=cc.actionTween(e,"zoomScale",i,t);this.runAction(n)}}else{this.setZoomScale(t)}},minContainerOffset:function(){var t=this._container;var e=t.getContentSize(),i=this._viewSize;return cc.p(i.width-e.width*t.getScaleX(),i.height-e.height*t.getScaleY())},maxContainerOffset:function(){return cc.p(0,0)},isNodeVisible:function(t){var e=this.getContentOffset();var i=this.getViewSize();var n=this.getZoomScale();var r=cc.rect(-e.x/n,-e.y/n,i.width/n,i.height/n);return cc.rectIntersectsRect(r,t.getBoundingBox())},pause:function(t){this._container.pause();var e=this._container.getChildren();for(var i=0;i<e.length;i++){e[i].pause()}this._super()},resume:function(t){var e=this._container.getChildren();for(var i=0,n=e.length;i<n;i++){e[i].resume()}this._container.resume();this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(t){this._bounceable=t},getViewSize:function(){return this._viewSize},setViewSize:function(t){this._viewSize=t;cc.Node.prototype.setContentSize.call(this,t)},getContainer:function(){return this._container},setContainer:function(t){if(!t)return;this.removeAllChildren(true);this._container=t;t.ignoreAnchorPointForPosition(false);t.setAnchorPoint(0,0);this.addChild(t);this.setViewSize(this._viewSize)},getDirection:function(){return this._direction},setDirection:function(t){this._direction=t},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},onTouchBegan:function(t,e){for(var i=this;i!=null;i=i.parent){if(!i.isVisible())return false}var n=this._getViewRect();var r=this._container;var s=r.convertToWorldSpace(r.convertTouchToNodeSpace(t));var a=this._touches;if(a.length>2||this._touchMoved||!cc.rectContainsPoint(n,s))return false;a.push(t);if(a.length===1){this._touchPoint=this.convertTouchToNodeSpace(t);this._touchMoved=false;this._dragging=true;this._scrollDistance.x=0;this._scrollDistance.y=0;this._touchLength=0}else if(a.length===2){this._touchPoint=cc.pMidpoint(this.convertTouchToNodeSpace(a[0]),this.convertTouchToNodeSpace(a[1]));this._touchLength=cc.pDistance(r.convertTouchToNodeSpace(a[0]),r.convertTouchToNodeSpace(a[1]));this._dragging=false}return true},onTouchMoved:function(t,e){if(!this.isVisible())return;this.setNodeDirty();if(this._touches.length===1&&this._dragging){this._touchMoved=true;var i=this._getViewRect();var n=this.convertTouchToNodeSpace(t);var r=cc.pSub(n,this._touchPoint);var s=0,a=this._direction,o;if(a===cc.SCROLLVIEW_DIRECTION_VERTICAL){s=r.y;o=this._container.getPositionY();if(!(this.minContainerOffset().y<=o&&o<=this.maxContainerOffset().y))r.y*=BOUNCE_BACK_FACTOR}else if(a===cc.SCROLLVIEW_DIRECTION_HORIZONTAL){s=r.x;o=this._container.getPositionX();if(!(this.minContainerOffset().x<=o&&o<=this.maxContainerOffset().x))r.x*=BOUNCE_BACK_FACTOR}else{s=Math.sqrt(r.x*r.x+r.y*r.y);o=this._container.getPositionY();var c=this.minContainerOffset(),l=this.maxContainerOffset();if(!(c.y<=o&&o<=l.y))r.y*=BOUNCE_BACK_FACTOR;o=this._container.getPositionX();if(!(c.x<=o&&o<=l.x))r.x*=BOUNCE_BACK_FACTOR}if(!this._touchMoved&&Math.abs(cc.convertDistanceFromPointToInch(s))<MOVE_INCH){return}if(!this._touchMoved){r.x=0;r.y=0}this._touchPoint=n;this._touchMoved=true;if(this._dragging){switch(a){case cc.SCROLLVIEW_DIRECTION_VERTICAL:r.x=0;break;case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:r.y=0;break;default:break}var h=this._container.getPosition();var u=h.x+r.x;var d=h.y+r.y;this._scrollDistance=r;this.setContentOffset(cc.p(u,d))}}else if(this._touches.length===2&&!this._dragging){var _=cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1]));this.setZoomScale(this.getZoomScale()*_/this._touchLength)}},onTouchEnded:function(t,e){if(!this.isVisible())return;if(this._touches.length===1&&this._touchMoved)this.schedule(this._deaccelerateScrolling);this._touches.length=0;this._dragging=false;this._touchMoved=false},onTouchCancelled:function(t,e){if(!this.isVisible())return;this._touches.length=0;this._dragging=false;this._touchMoved=false},setContentSize:function(t,e){if(this.getContainer()!==null){if(e===undefined)this.getContainer().setContentSize(t);else this.getContainer().setContentSize(t,e);this.updateInset()}},_setWidth:function(t){var e=this.getContainer();if(e!==null){e._setWidth(t);this.updateInset()}},_setHeight:function(t){var e=this.getContainer();if(e!==null){e._setHeight(t);this.updateInset()}},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(this.getContainer()!==null){var t=this._viewSize;var e=this.maxContainerOffset();this._maxInset.x=e.x+t.width*INSET_RATIO;this._maxInset.y=e.y+t.height*INSET_RATIO;e=this.minContainerOffset();this._minInset.x=e.x-t.width*INSET_RATIO;this._minInset.y=e.y-t.height*INSET_RATIO}},isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(t){this._clippingToBounds=t},visit:function(t){if(!this.isVisible())return;this._renderCmd.visit(t)},addChild:function(t,e,i){if(!t)throw new Error("child must not nil!");e=e||t.getLocalZOrder();i=i||t.getTag();if(this._container!==t){this._container.addChild(t,e,i)}else{cc.Layer.prototype.addChild.call(this,t,e,i)}},isTouchEnabled:function(){return this._touchListener!==null},setTouchEnabled:function(t){if(this._touchListener)cc.eventManager.removeListener(this._touchListener);this._touchListener=null;if(!t){this._dragging=false;this._touchMoved=false;this._touches.length=0}else{var e=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});if(this.onTouchBegan)e.onTouchBegan=this.onTouchBegan.bind(this);if(this.onTouchMoved)e.onTouchMoved=this.onTouchMoved.bind(this);if(this.onTouchEnded)e.onTouchEnded=this.onTouchEnded.bind(this);if(this.onTouchCancelled)e.onTouchCancelled=this.onTouchCancelled.bind(this);this._touchListener=e;cc.eventManager.addListener(e,this)}},_initWithViewSize:function(t){return null},_relocateContainer:function(t){var e=this.minContainerOffset();var i=this.maxContainerOffset();var n=this._direction;var r=this._container.getPosition();var s=r.x;var a=r.y;if(n===cc.SCROLLVIEW_DIRECTION_BOTH||n===cc.SCROLLVIEW_DIRECTION_HORIZONTAL){s=Math.max(s,e.x);s=Math.min(s,i.x)}if(n===cc.SCROLLVIEW_DIRECTION_BOTH||n===cc.SCROLLVIEW_DIRECTION_VERTICAL){a=Math.min(a,i.y);a=Math.max(a,e.y)}if(a!==r.y||s!==r.x){this.setContentOffset(cc.p(s,a),t)}},_deaccelerateScrolling:function(t){if(this._dragging){this.unschedule(this._deaccelerateScrolling);return}var e,i;var n=this._container.getPosition();var r=this._scrollDistance;this._container.setPosition(n.x+r.x,n.y+r.y);if(this._bounceable){e=this._maxInset;i=this._minInset}else{e=this.maxContainerOffset();i=this.minContainerOffset()}var s=this._container.getPositionX();var a=this._container.getPositionY();r.x=r.x*SCROLL_DEACCEL_RATE;r.y=r.y*SCROLL_DEACCEL_RATE;this.setContentOffset(cc.p(s,a));if(Math.abs(r.x)<=SCROLL_DEACCEL_DIST&&Math.abs(r.y)<=SCROLL_DEACCEL_DIST||a>e.y||a<i.y||s>e.x||s<i.x||s===e.x||s===i.x||a===e.y||a===i.y){this.unschedule(this._deaccelerateScrolling);this._relocateContainer(true)}},_performedAnimatedScroll:function(t){if(this._dragging){this.unschedule(this._performedAnimatedScroll);return}if(this._delegate&&this._delegate.scrollViewDidScroll)this._delegate.scrollViewDidScroll(this)},_stoppedAnimatedScroll:function(t){this.unschedule(this._performedAnimatedScroll);if(this._delegate&&this._delegate.scrollViewDidScroll){this._delegate.scrollViewDidScroll(this)}},_handleZoom:function(){},_getViewRect:function(){var t=this.convertToWorldSpace(cc.p(0,0));var e=this._viewSize;var i=this.getScaleX();var n=this.getScaleY();for(var r=this._parent;r!=null;r=r.getParent()){i*=r.getScaleX();n*=r.getScaleY()}if(i<0){t.x+=e.width*i;i=-i}if(n<0){t.y+=e.height*n;n=-n}var s=this._tmpViewRect;s.x=t.x;s.y=t.y;s.width=e.width*i;s.height=e.height*n;return s},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){return new cc.ScrollView.CanvasRenderCmd(this)}else{return new cc.ScrollView.WebGLRenderCmd(this)}}});var _p=cc.ScrollView.prototype;_p.minOffset;cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset);_p.maxOffset;cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset);_p.bounceable;cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable);_p.viewSize;cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize);_p.container;cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer);_p.direction;cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);_p.delegate;cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);_p.clippingToBounds;cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds);_p=null;cc.ScrollView.create=function(t,e){return new cc.ScrollView(t,e)};(function(){cc.ScrollView.CanvasRenderCmd=function(t){cc.Layer.CanvasRenderCmd.call(this,t);this._needDraw=false;this.startCmd=new cc.CustomRenderCmd(this,this._startCmd);this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);t.constructor=cc.ScrollView.CanvasRenderCmd;t._startCmd=function(t,e,i){var n=this._node;var r=t||cc._renderContext,s=r.getContext();r.save();if(n._clippingToBounds){this._scissorRestored=false;r.setTransform(this._worldTransform,e,i);var a=n.getScaleX(),o=n.getScaleY();var c=n._viewSize.width*a*e;var l=n._viewSize.height*o*i;s.beginPath();s.rect(0,0,c,-l);s.closePath();s.clip()}};t._endCmd=function(t){t=t||cc._renderContext;t.restore()};t.visit=function(t){var e=this._node;if(!e._visible)return;var i,n=e._children,r;this.transform(t);cc.renderer.pushRenderCommand(this.startCmd);if(n&&n.length>0){r=n.length;e.sortAllChildren();for(i=0;i<r;i++){n[i]._renderCmd.visit(this)}}cc.renderer.pushRenderCommand(this.endCmd)}})();cc.SortableObject=cc.Class.extend({setObjectID:function(t){},getObjectID:function(){return 0}});cc.SortedObject=cc.SortableObject.extend({_objectID:0,ctor:function(){this._objectID=0},setObjectID:function(t){this._objectID=t},getObjectID:function(){return this._objectID}});var _compareObject=function(t,e){return t.getObjectID()-e.getObjectID()};cc.ArrayForObjectSorting=cc.Class.extend({_saveObjectArr:null,ctor:function(){this._saveObjectArr=[]},insertSortedObject:function(t){if(!t)throw new Error("cc.ArrayForObjectSorting.insertSortedObject(): addObject should be non-null.");var e=this.indexOfSortedObject(t);this.insertObject(t,e)},removeSortedObject:function(t){if(this.count()===0){return}var e=this.indexOfSortedObject(t);if(e<this.count()&&e!==cc.INVALID_INDEX){var i=this.objectAtIndex(e);if(i.getObjectID()===t.getObjectID()){this.removeObjectAtIndex(e)}}},setObjectID_ofSortedObject:function(t,e){var i=this.indexOfSortedObject(e);if(i<this.count()&&i!==cc.INVALID_INDEX){var n=this.objectAtIndex(i);if(n.getObjectID()===e.getObjectID()){this.removeObjectAtIndex(i);n.setObjectID(t);this.insertSortedObject(n)}}},objectWithObjectID:function(t){if(this.count()===0){return null}var e=new cc.SortedObject;e.setObjectID(t);var i=this.indexOfSortedObject(e);if(i<this.count()&&i!==cc.INVALID_INDEX){e=this.objectAtIndex(i);if(e.getObjectID()!==t)e=null}return e},getObjectWithObjectID:function(t){return null},indexOfSortedObject:function(t){var e=0;if(t){var i=0;var n=t.getObjectID();var r=this._saveObjectArr;for(var s=0;s<r.length;s++){var a=r[s];var o=a.getObjectID();if(n===o||n>=i&&n<o){break}i=o;e++}}else{e=cc.INVALID_INDEX}return e},count:function(){return this._saveObjectArr.length},lastObject:function(){var t=this._saveObjectArr;if(t.length===0)return null;return t[t.length-1]},objectAtIndex:function(t){return this._saveObjectArr[t]},addObject:function(t){this._saveObjectArr.push(t);this._saveObjectArr.sort(_compareObject)},removeObjectAtIndex:function(t){this._saveObjectArr.splice(t,1);this._saveObjectArr.sort(_compareObject)},insertObject:function(t,e){this._saveObjectArr.splice(e,0,t);this._saveObjectArr.sort(_compareObject)}});cc.TABLEVIEW_FILL_TOPDOWN=0;cc.TABLEVIEW_FILL_BOTTOMUP=1;cc.TableViewCell=cc.Node.extend({_idx:0,_className:"TableViewCell",getIdx:function(){return this._idx},setIdx:function(t){this._idx=t},reset:function(){this._idx=cc.INVALID_INDEX},setObjectID:function(t){this._idx=t},getObjectID:function(){return this._idx}});var _p=cc.TableViewCell.prototype;_p.objectId;cc.defineGetterSetter(_p,"objectId",_p.getObjectID,_p.setObjectID);_p=null;cc.TableViewDelegate=cc.ScrollViewDelegate.extend({tableCellTouched:function(t,e){},tableCellHighlight:function(t,e){},tableCellUnhighlight:function(t,e){},tableCellWillRecycle:function(t,e){}});cc.TableViewDataSource=cc.Class.extend({tableCellSizeForIndex:function(t,e){return this.cellSizeForTable(t)},cellSizeForTable:function(t){return cc.size(0,0)},tableCellAtIndex:function(t,e){return null},numberOfCellsInTableView:function(t){return 0}});cc.TableView=cc.ScrollView.extend({_vOrdering:null,_indices:null,_cellsFreed:null,_dataSource:null,_tableViewDelegate:null,_oldDirection:null,_cellsPositions:null,_touchedCell:null,ctor:function(t,e,i){cc.ScrollView.prototype.ctor.call(this);this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;this._cellsPositions=[];this.initWithViewSize(e,i);this.setDataSource(t);this._updateCellPositions();this._updateContentSize()},__indexFromOffset:function(t){var e=0;var i=this._dataSource.numberOfCellsInTableView(this)-1;var n;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n=t.x;break;default:n=t.y;break}var r=this._cellsPositions;while(i>=e){var s=0|e+(i-e)/2;var a=r[s];var o=r[s+1];if(n>=a&&n<=o){return s}else if(n<a){i=s-1}else{e=s+1}}if(e<=0)return 0;return-1},_indexFromOffset:function(t){var e={x:t.x,y:t.y};var i=this._dataSource;var n=i.numberOfCellsInTableView(this)-1;if(this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN)e.y=this.getContainer().getContentSize().height-e.y;var r=this.__indexFromOffset(e);if(r!==-1){r=Math.max(0,r);if(r>n)r=cc.INVALID_INDEX}return r},__offsetFromIndex:function(t){var e;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:e=cc.p(this._cellsPositions[t],0);break;default:e=cc.p(0,this._cellsPositions[t]);break}return e},_offsetFromIndex:function(t){var e=this.__offsetFromIndex(t);var i=this._dataSource.tableCellSizeForIndex(this,t);if(this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN)e.y=this.getContainer().getContentSize().height-e.y-i.height;return e},_updateCellPositions:function(){var t=this._dataSource.numberOfCellsInTableView(this);var e=this._cellsPositions;if(t>0){var i=0;var n,r=this._dataSource;for(var s=0;s<t;s++){e[s]=i;n=r.tableCellSizeForIndex(this,s);switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:i+=n.width;break;default:i+=n.height;break}}this._cellsPositions[t]=i}},_updateContentSize:function(){var t=cc.size(0,0);var e=this._dataSource.numberOfCellsInTableView(this);if(e>0){var i=this._cellsPositions[e];switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=cc.size(i,this._viewSize.height);break;default:t=cc.size(this._viewSize.width,i);break}}this.setContentSize(t);if(this._oldDirection!==this._direction){if(this._direction===cc.SCROLLVIEW_DIRECTION_HORIZONTAL){this.setContentOffset(cc.p(0,0))}else{this.setContentOffset(cc.p(0,this.minContainerOffset().y))}this._oldDirection=this._direction}},_moveCellOutOfSight:function(t){if(this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle)this._tableViewDelegate.tableCellWillRecycle(this,t);this._cellsFreed.addObject(t);this._cellsUsed.removeSortedObject(t);cc.arrayRemoveObject(this._indices,t.getIdx());t.reset();if(t.getParent()===this.getContainer()){this.getContainer().removeChild(t,true)}},_setIndexForCell:function(t,e){e.setAnchorPoint(0,0);e.setPosition(this._offsetFromIndex(t));e.setIdx(t)},_addCellIfNecessary:function(t){if(t.getParent()!==this.getContainer()){this.getContainer().addChild(t)}this._cellsUsed.insertSortedObject(t);var e=this._indices,i=t.getIdx();if(e.indexOf(i)===-1){e.push(i);e.sort(function(t,e){return t-e})}},getDataSource:function(){return this._dataSource},setDataSource:function(t){this._dataSource=t},getDelegate:function(){return this._tableViewDelegate},setDelegate:function(t){this._tableViewDelegate=t},setVerticalFillOrder:function(t){if(this._vOrdering!==t){this._vOrdering=t;if(this._cellsUsed.count()>0){this.reloadData()}}},getVerticalFillOrder:function(){return this._vOrdering},initWithViewSize:function(t,e){if(cc.ScrollView.prototype.initWithViewSize.call(this,t,e)){this._cellsUsed=new cc.ArrayForObjectSorting;this._cellsFreed=new cc.ArrayForObjectSorting;this._indices=[];this._tableViewDelegate=null;this._vOrdering=cc.TABLEVIEW_FILL_BOTTOMUP;this.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);cc.ScrollView.prototype.setDelegate.call(this,this);return true}return false},updateCellAtIndex:function(t){if(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)return;var e=this.cellAtIndex(t);if(e)this._moveCellOutOfSight(e);e=this._dataSource.tableCellAtIndex(this,t);this._setIndexForCell(t,e);this._addCellIfNecessary(e)},insertCellAtIndex:function(t){if(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)return;var e,i=this._cellsUsed;var n=i.objectWithObjectID(t);if(n){e=i.indexOfSortedObject(n);for(var r=e;r<i.count();r++){n=i.objectAtIndex(r);this._setIndexForCell(n.getIdx()+1,n)}}n=this._dataSource.tableCellAtIndex(this,t);this._setIndexForCell(t,n);this._addCellIfNecessary(n);this._updateCellPositions();this._updateContentSize()},removeCellAtIndex:function(t){if(t===cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)return;var e=this.cellAtIndex(t);if(!e)return;var i=this._cellsUsed;var n=i.indexOfSortedObject(e);this._moveCellOutOfSight(e);cc.arrayRemoveObject(this._indices,t);
this._updateCellPositions();for(var r=i.count()-1;r>n;r--){e=i.objectAtIndex(r);this._setIndexForCell(e.getIdx()-1,e)}},reloadData:function(){this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;var t=this._cellsUsed,e=this._cellsFreed,i=this.getContainer();for(var n=0,r=t.count();n<r;n++){var s=t.objectAtIndex(n);if(this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle)this._tableViewDelegate.tableCellWillRecycle(this,s);e.addObject(s);s.reset();if(s.getParent()===i)i.removeChild(s,true)}this._indices=[];this._cellsUsed=new cc.ArrayForObjectSorting;this._updateCellPositions();this._updateContentSize();if(this._dataSource.numberOfCellsInTableView(this)>0)this.scrollViewDidScroll(this)},dequeueCell:function(){if(this._cellsFreed.count()===0){return null}else{var t=this._cellsFreed.objectAtIndex(0);this._cellsFreed.removeObjectAtIndex(0);return t}},cellAtIndex:function(t){var e=this._indices.indexOf(t);if(e===-1)return null;return this._cellsUsed.objectWithObjectID(t)},scrollViewDidScroll:function(t){var e=this._dataSource;var i=e.numberOfCellsInTableView(this);if(0===i)return;if(this._tableViewDelegate!==null&&this._tableViewDelegate.scrollViewDidScroll)this._tableViewDelegate.scrollViewDidScroll(this);var n=0,r=this._viewSize,s=this.getContainer();var a=this.getContentOffset();a.x*=-1;a.y*=-1;var o=Math.max(i-1,0);if(this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN)a.y=a.y+r.height/s.getScaleY();var c=this._indexFromOffset(a);if(c===cc.INVALID_INDEX)c=i-1;if(this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN)a.y-=r.height/s.getScaleY();else a.y+=r.height/s.getScaleY();a.x+=r.width/s.getScaleX();var l=this._indexFromOffset(a);if(l===cc.INVALID_INDEX)l=i-1;var h,u=this._cellsUsed;if(u.count()>0){h=u.objectAtIndex(0);n=h.getIdx();while(n<c){this._moveCellOutOfSight(h);if(u.count()>0){h=u.objectAtIndex(0);n=h.getIdx()}else break}}if(u.count()>0){h=u.lastObject();n=h.getIdx();while(n<=o&&n>l){this._moveCellOutOfSight(h);if(u.count()>0){h=u.lastObject();n=h.getIdx()}else break}}var d=this._indices;for(var _=c;_<=l;_++){if(d.indexOf(_)!==-1)continue;this.updateCellAtIndex(_)}},scrollViewDidZoom:function(t){},onTouchEnded:function(t,e){if(!this.isVisible())return;if(this._touchedCell){var i=this.getBoundingBox();var n=cc.p(i.x,i.y);n=this._parent.convertToWorldSpace(n);i.x=n.x;i.y=n.y;var r=this._tableViewDelegate;if(cc.rectContainsPoint(i,t.getLocation())&&r!==null){if(r.tableCellUnhighlight)r.tableCellUnhighlight(this,this._touchedCell);if(r.tableCellTouched)r.tableCellTouched(this,this._touchedCell)}this._touchedCell=null}cc.ScrollView.prototype.onTouchEnded.call(this,t,e)},onTouchBegan:function(t,e){for(var i=this;i!=null;i=i.parent){if(!i.isVisible())return false}var n=cc.ScrollView.prototype.onTouchBegan.call(this,t,e);if(this._touches.length===1){var r,s;s=this.getContainer().convertTouchToNodeSpace(t);r=this._indexFromOffset(s);if(r===cc.INVALID_INDEX)this._touchedCell=null;else this._touchedCell=this.cellAtIndex(r);if(this._touchedCell&&this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellHighlight)this._tableViewDelegate.tableCellHighlight(this,this._touchedCell)}else if(this._touchedCell){if(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight)this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell);this._touchedCell=null}return n},onTouchMoved:function(t,e){cc.ScrollView.prototype.onTouchMoved.call(this,t,e);if(this._touchedCell&&this.isTouchMoved()){if(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight)this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell);this._touchedCell=null}},onTouchCancelled:function(t,e){cc.ScrollView.prototype.onTouchCancelled.call(this,t,e);if(this._touchedCell){if(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight)this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell);this._touchedCell=null}}});var _p=cc.TableView.prototype;_p.dataSource;cc.defineGetterSetter(_p,"dataSource",_p.getDataSource,_p.setDataSource);_p.delegate;cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);_p.verticalFillOrder;cc.defineGetterSetter(_p,"verticalFillOrder",_p.getVerticalFillOrder,_p.setVerticalFillOrder);_p=null;cc.TableView.create=function(t,e,i){return new cc.TableView(t,e,i)};(function(){cc.ScrollView.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t);this._needDraw=false;this.startCmd=new cc.CustomRenderCmd(this,this._startCmd);this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var t=cc.ScrollView.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.ScrollView.WebGLRenderCmd;t._startCmd=function(){var t=this._node;var e=cc.view;var i=t._getViewRect();if(e.isScissorEnabled()){t._scissorRestored=true;t._parentScissorRect=e.getScissorRect();if(cc.rectIntersection(i,t._parentScissorRect)){var n=t._parentScissorRect;var r=Math.max(i.x,n.x);var s=Math.max(i.y,n.y);var a=Math.min(i.x+i.width,n.x+n.width);var o=Math.min(i.y+i.height,n.y+n.height);e.setScissorInPoints(r,s,a-r,o-s)}}else{var c=cc._renderContext;c.enable(c.SCISSOR_TEST);e.setScissorInPoints(i.x,i.y,i.width,i.height)}};t._endCmd=function(){var t=this._node;if(t._scissorRestored){var e=t._parentScissorRect;cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)}else{var i=cc._renderContext;i.disable(i.SCISSOR_TEST)}};t.visit=function(t){var e=this._node;if(!e._visible)return;var i,n=e._children,r,s;cc.kmGLPushMatrix();this.transform(t);if(e._clippingToBounds){cc.renderer.pushRenderCommand(this.startCmd)}if(n&&n.length>0){s=n.length;for(i=0;i<s;i++){r=n[i];if(r&&r._localZOrder<0)r._renderCmd.visit();else break}for(;i<s;i++)n[i]._renderCmd.visit()}if(e._clippingToBounds){cc.renderer.pushRenderCommand(this.endCmd)}this._dirtyFlag=0;cc.kmGLPopMatrix()}})();var PROPERTY_POSITION="position";var PROPERTY_CONTENTSIZE="contentSize";var PROPERTY_SKEW="skew";var PROPERTY_ANCHORPOINT="anchorPoint";var PROPERTY_SCALE="scale";var PROPERTY_ROTATION="rotation";var PROPERTY_TAG="tag";var PROPERTY_IGNOREANCHORPOINTFORPOSITION="ignoreAnchorPointForPosition";var PROPERTY_VISIBLE="visible";var ASSERT_FAIL_UNEXPECTED_PROPERTY=function(t){cc.log("Unexpected property: '"+t+"'!")};var ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE=function(t){cc.log("Unexpected property type: '"+t+"'!")};function BlockData(t,e){this.selMenuHander=t;this.target=e}function BlockCCControlData(t,e,i){this.selCCControlHandler=t;this.target=e;this.controlEvents=i}cc.NodeLoader=cc.Class.extend({_customProperties:null,ctor:function(){this._customProperties=new cc._Dictionary},loadCCNode:function(t,e){return this._createCCNode(t,e)},parseProperties:function(t,e,i){var n=i.readInt(false);var r=i.readInt(false);var s=n+r;for(var a=0;a<s;a++){var o=a>=n;var c=i.readInt(false);var l=i.readCachedString();var h=false;var u=i.readByte();if(u===CCB_PLATFORM_ALL||u===CCB_PLATFORM_IOS||u===CCB_PLATFORM_MAC)h=true;if(t instanceof cc.BuilderFile){if(t.getCCBFileNode()&&o){t=t.getCCBFileNode();var d=t.userObject;h=d.indexOf(l)!==-1}}else if(o&&t===i.getAnimationManager().getRootNode()){var _=t.userObject;if(!_){_=[];t.userObject=_}_.push(l)}switch(c){case CCB_PROPTYPE_POSITION:{var f=this.parsePropTypePosition(t,e,i,l);if(h)this.onHandlePropTypePosition(t,e,l,f,i);break}case CCB_PROPTYPE_POINT:{var p=this.parsePropTypePoint(t,e,i);if(h)this.onHandlePropTypePoint(t,e,l,p,i);break}case CCB_PROPTYPE_POINTLOCK:{var m=this.parsePropTypePointLock(t,e,i);if(h)this.onHandlePropTypePointLock(t,e,l,m,i);break}case CCB_PROPTYPE_SIZE:{var g=this.parsePropTypeSize(t,e,i);if(h)this.onHandlePropTypeSize(t,e,l,g,i);break}case CCB_PROPTYPE_SCALELOCK:{var v=this.parsePropTypeScaleLock(t,e,i,l);if(h)this.onHandlePropTypeScaleLock(t,e,l,v,i);break}case CCB_PROPTYPE_FLOATXY:{var y=this.parsePropTypeFloatXY(t,e,i);if(h)this.onHandlePropTypeFloatXY(t,e,l,y,i);break}case CCB_PROPTYPE_FLOAT:{var T=this.parsePropTypeFloat(t,e,i);if(h){this.onHandlePropTypeFloat(t,e,l,T,i)}break}case CCB_PROPTYPE_DEGREES:{var C=this.parsePropTypeDegrees(t,e,i,l);if(h){this.onHandlePropTypeDegrees(t,e,l,C,i)}break}case CCB_PROPTYPE_FLOATSCALE:{var S=this.parsePropTypeFloatScale(t,e,i);if(h){this.onHandlePropTypeFloatScale(t,e,l,S,i)}break}case CCB_PROPTYPE_INTEGER:{var x=this.parsePropTypeInteger(t,e,i);if(h){this.onHandlePropTypeInteger(t,e,l,x,i)}break}case CCB_PROPTYPE_INTEGERLABELED:{var E=this.parsePropTypeIntegerLabeled(t,e,i);if(h){this.onHandlePropTypeIntegerLabeled(t,e,l,E,i)}break}case CCB_PROPTYPE_FLOATVAR:{var b=this.parsePropTypeFloatVar(t,e,i);if(h){this.onHandlePropTypeFloatVar(t,e,l,b,i)}break}case CCB_PROPTYPE_CHECK:{var A=this.parsePropTypeCheck(t,e,i,l);if(h){this.onHandlePropTypeCheck(t,e,l,A,i)}break}case CCB_PROPTYPE_SPRITEFRAME:{var R=this.parsePropTypeSpriteFrame(t,e,i,l);if(h){this.onHandlePropTypeSpriteFrame(t,e,l,R,i)}break}case CCB_PROPTYPE_ANIMATION:{var P=this.parsePropTypeAnimation(t,e,i);if(h){this.onHandlePropTypeAnimation(t,e,l,P,i)}break}case CCB_PROPTYPE_TEXTURE:{var w=this.parsePropTypeTexture(t,e,i);if(h){this.onHandlePropTypeTexture(t,e,l,w,i)}break}case CCB_PROPTYPE_BYTE:{var I=this.parsePropTypeByte(t,e,i,l);if(h){this.onHandlePropTypeByte(t,e,l,I,i)}break}case CCB_PROPTYPE_COLOR3:{var D=this.parsePropTypeColor3(t,e,i,l);if(h){this.onHandlePropTypeColor3(t,e,l,D,i)}break}case CCB_PROPTYPE_COLOR4VAR:{var L=this.parsePropTypeColor4FVar(t,e,i);if(h){this.onHandlePropTypeColor4FVar(t,e,l,L,i)}break}case CCB_PROPTYPE_FLIP:{var O=this.parsePropTypeFlip(t,e,i);if(h){this.onHandlePropTypeFlip(t,e,l,O,i)}break}case CCB_PROPTYPE_BLENDMODE:{var B=this.parsePropTypeBlendFunc(t,e,i);if(h){this.onHandlePropTypeBlendFunc(t,e,l,B,i)}break}case CCB_PROPTYPE_FNTFILE:{var F=i.getCCBRootPath()+this.parsePropTypeFntFile(t,e,i);if(h){this.onHandlePropTypeFntFile(t,e,l,F,i)}break}case CCB_PROPTYPE_FONTTTF:{var N=this.parsePropTypeFontTTF(t,e,i);if(h){this.onHandlePropTypeFontTTF(t,e,l,N,i)}break}case CCB_PROPTYPE_STRING:{var M=this.parsePropTypeString(t,e,i);if(h){this.onHandlePropTypeString(t,e,l,M,i)}break}case CCB_PROPTYPE_TEXT:{var V=this.parsePropTypeText(t,e,i);if(h){this.onHandlePropTypeText(t,e,l,V,i)}break}case CCB_PROPTYPE_BLOCK:{var k=this.parsePropTypeBlock(t,e,i);if(h){this.onHandlePropTypeBlock(t,e,l,k,i)}break}case CCB_PROPTYPE_BLOCKCCCONTROL:{var W=this.parsePropTypeBlockCCControl(t,e,i);if(h&&W!=null){this.onHandlePropTypeBlockCCControl(t,e,l,W,i)}break}case CCB_PROPTYPE_CCBFILE:{var G=this.parsePropTypeCCBFile(t,e,i);if(h){this.onHandlePropTypeCCBFile(t,e,l,G,i)}break}default:ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE(c);break}}},getCustomProperties:function(){return this._customProperties},_createCCNode:function(t,e){return new cc.Node},parsePropTypePosition:function(t,e,i,n){var r=i.readFloat();var s=i.readFloat();var a=i.readInt(false);var o=i.getAnimationManager().getContainerSize(e);var c=cc._getAbsolutePosition(r,s,a,o,n);t.setPosition(cc.getAbsolutePosition(c,a,o,n));if(i.getAnimatedProperties().indexOf(n)>-1){var l=[r,s,a];i.getAnimationManager().setBaseValue(l,t,n)}return c},parsePropTypePoint:function(t,e,i){var n=i.readFloat();var r=i.readFloat();return cc.p(n,r)},parsePropTypePointLock:function(t,e,i){var n=i.readFloat();var r=i.readFloat();return cc.p(n,r)},parsePropTypeSize:function(t,e,i){var n=i.readFloat();var r=i.readFloat();var s=i.readInt(false);var a=i.getAnimationManager().getContainerSize(e);switch(s){case CCB_SIZETYPE_ABSOLUTE:break;case CCB_SIZETYPE_RELATIVE_CONTAINER:n=a.width-n;r=a.height-r;break;case CCB_SIZETYPE_PERCENT:n=a.width*n/100;r=a.height*r/100;break;case CCB_SIZETYPE_HORIZONTAL_PERCENT:n=a.width*n/100;break;case CCB_SIZETYPE_VERTICAL_PERCENT:r=a.height*r/100;break;case CCB_SIZETYPE_MULTIPLY_RESOLUTION:var o=cc.BuilderReader.getResolutionScale();n*=o;r*=o;break;default:cc.log("Unknown CCB type.");break}return cc.size(n,r)},parsePropTypeScaleLock:function(t,e,i,n){var r=i.readFloat();var s=i.readFloat();var a=i.readInt(false);cc.setRelativeScale(t,r,s,a,n);if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue([r,s,a],t,n)}if(a===CCB_SCALETYPE_MULTIPLY_RESOLUTION){r*=cc.BuilderReader.getResolutionScale();s*=cc.BuilderReader.getResolutionScale()}return[r,s]},parsePropTypeFloat:function(t,e,i){return i.readFloat()},parsePropTypeDegrees:function(t,e,i,n){var r=i.readFloat();if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue(r,t,n)}return r},parsePropTypeFloatScale:function(t,e,i){var n=i.readFloat();var r=i.readInt(false);if(r===CCB_SCALETYPE_MULTIPLY_RESOLUTION){n*=cc.BuilderReader.getResolutionScale()}return n},parsePropTypeInteger:function(t,e,i){return i.readInt(true)},parsePropTypeIntegerLabeled:function(t,e,i){return i.readInt(true)},parsePropTypeFloatVar:function(t,e,i){var n=i.readFloat();var r=i.readFloat();return[n,r]},parsePropTypeCheck:function(t,e,i,n){var r=i.readBool();if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue(r,t,n)}return r},parsePropTypeSpriteFrame:function(t,e,i,n){var r=i.readCachedString();var s=i.readCachedString();var a;if(s!=null&&s.length!==0){if(r.length===0){s=i.getCCBRootPath()+s;var o=cc.textureCache.addImage(s);var c=o.getContentSize();var l=cc.rect(0,0,c.width,c.height);a=new cc.SpriteFrame(o,l)}else{var h=cc.spriteFrameCache;r=i.getCCBRootPath()+r;if(i.getLoadedSpriteSheet().indexOf(r)===-1){h.addSpriteFrames(r);i.getLoadedSpriteSheet().push(r)}a=h.getSpriteFrame(s)}if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue(a,t,n)}}return a},parsePropTypeAnimation:function(t,e,i){var n=i.getCCBRootPath()+i.readCachedString();var r=i.readCachedString();var s=null;r=cc.BuilderReader.lastPathComponent(r);n=cc.BuilderReader.lastPathComponent(n);if(r!=null&&r!==""){var a=cc.animationCache;a.addAnimations(n);s=a.getAnimation(r)}return s},parsePropTypeTexture:function(t,e,i){var n=i.getCCBRootPath()+i.readCachedString();if(n!=="")return cc.textureCache.addImage(n);return null},parsePropTypeByte:function(t,e,i,n){var r=i.readByte();if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue(r,t,n)}return r},parsePropTypeColor3:function(t,e,i,n){var r=i.readByte();var s=i.readByte();var a=i.readByte();var o={r:r,g:s,b:a};if(i.getAnimatedProperties().indexOf(n)>-1){i.getAnimationManager().setBaseValue(cc.Color3BWapper.create(o),t,n)}return o},parsePropTypeColor4FVar:function(t,e,i){var n=0|i.readFloat()*255;var r=0|i.readFloat()*255;var s=0|i.readFloat()*255;var a=i.readFloat();a=a<=1?0|a*255:a;var o=0|i.readFloat()*255;var c=0|i.readFloat()*255;var l=0|i.readFloat()*255;var h=i.readFloat();h=h<=1?0|h*255:h;var u=[];u[0]={r:n,g:r,b:s,a:a};u[1]={r:o,g:c,b:l,a:h};return u},parsePropTypeFlip:function(t,e,i){var n=i.readBool();var r=i.readBool();return[n,r]},parsePropTypeBlendFunc:function(t,e,i){var n=i.readInt(false);var r=i.readInt(false);return new cc.BlendFunc(n,r)},parsePropTypeFntFile:function(t,e,i){return i.readCachedString()},parsePropTypeString:function(t,e,i){return i.readCachedString()},parsePropTypeText:function(t,e,i){return i.readCachedString()},parsePropTypeFontTTF:function(t,e,i){return i.readCachedString()},parsePropTypeBlock:function(t,e,i){var n=i.readCachedString();var r=i.readInt(false);if(r!==CCB_TARGETTYPE_NONE){var s=null;if(!i.isJSControlled()){if(r===CCB_TARGETTYPE_DOCUMENTROOT){s=i.getAnimationManager().getRootNode()}else if(r===CCB_TARGETTYPE_OWNER){s=i.getOwner()}if(s!==null){if(n.length>0){var a=0;if(s.onResolveCCBCCMenuItemSelector)a=s.onResolveCCBCCMenuItemSelector(s,n);if(a===0){var o=i.getCCBSelectorResolver();if(o!=null)a=o.onResolveCCBCCMenuItemSelector(s,n)}if(a===0){cc.log("Skipping selector '"+n+"' since no CCBSelectorResolver is present.")}else{return new BlockData(a,s)}}else{cc.log("Unexpected empty selector.")}}else{cc.log("Unexpected NULL target for selector.")}}else{if(r===CCB_TARGETTYPE_DOCUMENTROOT){i.addDocumentCallbackNode(t);i.addDocumentCallbackName(n);i.addDocumentCallbackControlEvents(0)}else{i.addOwnerCallbackNode(t);i.addOwnerCallbackName(n);i.addOwnerCallbackControlEvents(0)}}}return null},parsePropTypeBlockCCControl:function(t,e,i){var n=i.readCachedString();var r=i.readInt(false);var s=i.readInt(false);if(r!==CCB_TARGETTYPE_NONE){if(!i.isJSControlled()){var a=null;if(r===CCB_TARGETTYPE_DOCUMENTROOT){a=i.getAnimationManager().getRootNode()}else if(r===CCB_TARGETTYPE_OWNER){a=i.getOwner()}if(a!==null){if(n.length>0){var o=0;if(a.onResolveCCBCCControlSelector){o=a.onResolveCCBCCControlSelector(a,n)}if(o===0){var c=i.getCCBSelectorResolver();if(c!=null){o=c.onResolveCCBCCControlSelector(a,n)}}if(o===0){cc.log("Skipping selector '"+n+"' since no CCBSelectorResolver is present.")}else{return new BlockCCControlData(o,a,s)}}else{cc.log("Unexpected empty selector.")}}else{cc.log("Unexpected NULL target for selector.")}}else{if(r===CCB_TARGETTYPE_DOCUMENTROOT){i.addDocumentCallbackNode(t);i.addDocumentCallbackName(n);i.addDocumentCallbackControlEvents(s)}else{i.addOwnerCallbackNode(t);i.addOwnerCallbackName(n);i.addOwnerCallbackControlEvents(s)}}}return null},parsePropTypeCCBFile:function(t,e,i){var n=i.getCCBRootPath()+i.readCachedString();var r=cc.BuilderReader.deletePathExtension(n);n=r+".ccbi";var s=new cc.BuilderReader(i);var a=cc.loader.getRes(n);if(!a){var o=cc.loader.getUrl(n);a=cc.loader.loadBinarySync(o);cc.loader.cache[n]=a}s.initWithData(a,i.getOwner());s.getAnimationManager().setRootContainerSize(e.getContentSize());s.setAnimationManagers(i.getAnimationManagers());s.getAnimationManager().setOwner(i.getOwner());var c=s.readFileWithCleanUp(false);i.setAnimationManagers(s.getAnimationManagers());if(c&&s.getAnimationManager().getAutoPlaySequenceId()!==-1)s.getAnimationManager().runAnimations(s.getAnimationManager().getAutoPlaySequenceId(),0);return c},parsePropTypeFloatXY:function(t,e,i){var n=i.readFloat();var r=i.readFloat();return[n,r]},onHandlePropTypePosition:function(t,e,i,n,r){if(i===PROPERTY_POSITION){t.setPosition(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypePoint:function(t,e,i,n,r){if(i===PROPERTY_ANCHORPOINT){t.setAnchorPoint(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypePointLock:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeSize:function(t,e,i,n,r){if(i===PROPERTY_CONTENTSIZE){t.setContentSize(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypeScaleLock:function(t,e,i,n,r){if(i===PROPERTY_SCALE){t.setScaleX(n[0]);t.setScaleY(n[1])}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypeFloatXY:function(t,e,i,n,r){if(i===PROPERTY_SKEW){t.setSkewX(n[0]);t.setSkewY(n[1])}else{var s=i+"X";var a=i+"Y";if(!t[s]||!t[a])ASSERT_FAIL_UNEXPECTED_PROPERTY(i);t[s](n[0]);t[a](n[1])}},onHandlePropTypeFloat:function(t,e,i,n,r){this._customProperties.setObject(n,i)},onHandlePropTypeDegrees:function(t,e,i,n,r){if(i===PROPERTY_ROTATION){t.setRotation(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypeFloatScale:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeInteger:function(t,e,i,n,r){if(i===PROPERTY_TAG){t.setTag(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFloatVar:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_VISIBLE){t.setVisible(n)}else if(i===PROPERTY_IGNOREANCHORPOINTFORPOSITION){t.ignoreAnchorPointForPosition(n)}else{ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeAnimation:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeTexture:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeByte:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeColor3:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeColor4FVar:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFlip:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlendFunc:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFntFile:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeString:function(t,e,i,n,r){this._customProperties.setObject(n,i)},onHandlePropTypeText:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeFontTTF:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlock:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeBlockCCControl:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)},onHandlePropTypeCCBFile:function(t,e,i,n,r){ASSERT_FAIL_UNEXPECTED_PROPERTY(i)}});cc.NodeLoader.loader=function(){return new cc.NodeLoader};cc.NodeLoaderListener=cc.Class.extend({onNodeLoaded:function(t,e){}});cc.BuilderSelectorResolver=cc.Class.extend({onResolveCCBCCMenuItemSelector:function(t,e){},onResolveCCBCCCallFuncSelector:function(t,e){},onResolveCCBCCControlSelector:function(t,e){}});cc.BuilderScriptOwnerProtocol=cc.Class.extend({createNew:function(){}});cc.BuilderMemberVariableAssigner=cc.Class.extend({onAssignCCBMemberVariable:function(t,e,i){return false},onAssignCCBCustomProperty:function(t,e,i){return false}});var PROPERTY_CCBFILE="ccbFile";cc.BuilderFileLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return cc.BuilderFile.create()},onHandlePropTypeCCBFile:function(t,e,i,n,r){if(i===PROPERTY_CCBFILE){t.setCCBFileNode(n)}else{cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,i,n,r)}}});cc.BuilderFileLoader.loader=function(){return new cc.BuilderFileLoader};var PROPERTY_ENABLED="enabled";var PROPERTY_SELECTED="selected";var PROPERTY_CCCONTROL="ccControl";cc.ControlLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){},onHandlePropTypeBlockCCControl:function(t,e,i,n,r){if(i===PROPERTY_CCCONTROL){t.addTargetWithActionForControlEvents(n.target,n.selCCControlHandler,n.controlEvents)}else{cc.NodeLoader.prototype.onHandlePropTypeBlockCCControl.call(this,t,e,i,n,r)}},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_ENABLED){t.setEnabled(n)}else if(i===PROPERTY_SELECTED){t.setSelected(n)}else{cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}}});var PROPERTY_ZOOMONTOUCHDOWN="zoomOnTouchDown";var PROPERTY_TITLE_NORMAL="title|1";var PROPERTY_TITLE_HIGHLIGHTED="title|2";var PROPERTY_TITLE_DISABLED="title|3";var PROPERTY_TITLECOLOR_NORMAL="titleColor|1";var PROPERTY_TITLECOLOR_HIGHLIGHTED="titleColor|2";var PROPERTY_TITLECOLOR_DISABLED="titleColor|3";var PROPERTY_TITLETTF_NORMAL="titleTTF|1";var PROPERTY_TITLETTF_HIGHLIGHTED="titleTTF|2";var PROPERTY_TITLETTF_DISABLED="titleTTF|3";var PROPERTY_TITLETTFSIZE_NORMAL="titleTTFSize|1";var PROPERTY_TITLETTFSIZE_HIGHLIGHTED="titleTTFSize|2";var PROPERTY_TITLETTFSIZE_DISABLED="titleTTFSize|4";var PROPERTY_LABELANCHORPOINT="labelAnchorPoint";var PROPERTY_PREFEREDSIZE="preferedSize";var PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL="backgroundSpriteFrame|1";var PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED="backgroundSpriteFrame|2";var PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED="backgroundSpriteFrame|3";cc.ControlButtonLoader=cc.ControlLoader.extend({_createCCNode:function(t,e){return new cc.ControlButton},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_ZOOMONTOUCHDOWN){t.setZoomOnTouchDown(n)}else{cc.ControlLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}},onHandlePropTypeString:function(t,e,i,n,r){if(i===PROPERTY_TITLE_NORMAL){t.setTitleForState(n,cc.CONTROL_STATE_NORMAL)}else if(i===PROPERTY_TITLE_HIGHLIGHTED){t.setTitleForState(n,cc.CONTROL_STATE_HIGHLIGHTED)}else if(i===PROPERTY_TITLE_DISABLED){t.setTitleForState(n,cc.CONTROL_STATE_DISABLED)}else{cc.ControlLoader.prototype.onHandlePropTypeString.call(this,t,e,i,n,r)}},onHandlePropTypeFontTTF:function(t,e,i,n,r){if(i===PROPERTY_TITLETTF_NORMAL){t.setTitleTTFForState(n,cc.CONTROL_STATE_NORMAL)}else if(i===PROPERTY_TITLETTF_HIGHLIGHTED){t.setTitleTTFForState(n,cc.CONTROL_STATE_HIGHLIGHTED)}else if(i===PROPERTY_TITLETTF_DISABLED){t.setTitleTTFForState(n,cc.CONTROL_STATE_DISABLED)}else{cc.ControlLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,i,n,r)}},onHandlePropTypeFloatScale:function(t,e,i,n,r){if(i===PROPERTY_TITLETTFSIZE_NORMAL){t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_NORMAL)}else if(i===PROPERTY_TITLETTFSIZE_HIGHLIGHTED){t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_HIGHLIGHTED)}else if(i===PROPERTY_TITLETTFSIZE_DISABLED){t.setTitleTTFSizeForState(n,cc.CONTROL_STATE_DISABLED)}else{cc.ControlLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,i,n,r)}},onHandlePropTypePoint:function(t,e,i,n,r){if(i===PROPERTY_LABELANCHORPOINT){t.setLabelAnchorPoint(n)}else{cc.ControlLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)}},onHandlePropTypeSize:function(t,e,i,n,r){if(i===PROPERTY_PREFEREDSIZE){t.setPreferredSize(n)}else{cc.ControlLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)}},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){if(i===PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL){if(n!=null){t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_NORMAL)}}else if(i===PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED){if(n!=null){t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_HIGHLIGHTED)}}else if(i===PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED){if(n!=null){t.setBackgroundSpriteFrameForState(n,cc.CONTROL_STATE_DISABLED)}}else{cc.ControlLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)}},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_TITLECOLOR_NORMAL){t.setTitleColorForState(n,cc.CONTROL_STATE_NORMAL)}else if(i===PROPERTY_TITLECOLOR_HIGHLIGHTED){t.setTitleColorForState(n,cc.CONTROL_STATE_HIGHLIGHTED)}else if(i===PROPERTY_TITLECOLOR_DISABLED){t.setTitleColorForState(n,cc.CONTROL_STATE_DISABLED)}else{cc.ControlLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}}});cc.ControlButtonLoader.loader=function(){return new cc.ControlButtonLoader};var PROPERTY_CONTAINER="container";var PROPERTY_DIRECTION="direction";var PROPERTY_CLIPSTOBOUNDS="clipsToBounds";var PROPERTY_BOUNCES="bounces";var PROPERTY_SCALE="scale";cc.ScrollViewLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return new cc.ScrollView},onHandlePropTypeSize:function(t,e,i,n,r){if(i===PROPERTY_CONTENTSIZE){t.setViewSize(n)}else{cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)}},onHandlePropTypeCCBFile:function(t,e,i,n,r){if(i===PROPERTY_CONTAINER){t.setContainer(n);t.updateInset()}else{cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,i,n,r)}},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_CLIPSTOBOUNDS){t.setClippingToBounds(n)}else if(i===PROPERTY_BOUNCES){t.setBounceable(n)}else{cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}},onHandlePropTypeFloat:function(t,e,i,n,r){if(i===PROPERTY_SCALE){t.setScale(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)}},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){if(i===PROPERTY_DIRECTION){t.setDirection(n)}else{cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)}}});cc.ScrollViewLoader.loader=function(){return new cc.ScrollViewLoader};var PROPERTY_CONTENTSIZE="contentSize";var PROPERTY_SPRITEFRAME="spriteFrame";var PROPERTY_COLOR="color";var PROPERTY_OPACITY="opacity";var PROPERTY_BLENDFUNC="blendFunc";var PROPERTY_INSETLEFT="insetLeft";var PROPERTY_INSETTOP="insetTop";var PROPERTY_INSETRIGHT="insetRight";var PROPERTY_INSETBOTTOM="insetBottom";cc.Scale9SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){var i=new cc.Scale9Sprite;i.setAnchorPoint(0,0);return i},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_COLOR){if(n.r!==255||n.g!==255||n.b!==255){t.setColor(n)}}else{cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_OPACITY){t.setOpacity(n)}else{cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){}else{cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){if(i===PROPERTY_SPRITEFRAME){t.setSpriteFrame(n)}else{cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)}},onHandlePropTypeSize:function(t,e,i,n,r){if(i===PROPERTY_CONTENTSIZE){}else if(i===PROPERTY_PREFEREDSIZE){t.setPreferredSize(n)}else{cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)}},onHandlePropTypeFloat:function(t,e,i,n,r){if(i===PROPERTY_INSETLEFT){t.setInsetLeft(n)}else if(i===PROPERTY_INSETTOP){t.setInsetTop(n)}else if(i===PROPERTY_INSETRIGHT){t.setInsetRight(n)}else if(i===PROPERTY_INSETBOTTOM){t.setInsetBottom(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)}}});cc.Scale9SpriteLoader.loader=function(){return new cc.Scale9SpriteLoader};var PROPERTY_FLIP="flip";var PROPERTY_DISPLAYFRAME="displayFrame";var PROPERTY_COLOR="color";var PROPERTY_OPACITY="opacity";var PROPERTY_BLENDFUNC="blendFunc";cc.SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return new cc.Sprite},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_COLOR){if(n.r!==255||n.g!==255||n.b!==255){t.setColor(n)}}else{cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_OPACITY){t.setOpacity(n)}else{cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){if(i===PROPERTY_DISPLAYFRAME){if(n)t.setSpriteFrame(n);else cc.log("ERROR: SpriteFrame is null")}else{cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)}},onHandlePropTypeFlip:function(t,e,i,n,r){if(i===PROPERTY_FLIP){t.setFlippedX(n[0]);t.setFlippedY(n[1])}else{cc.NodeLoader.prototype.onHandlePropTypeFlip.call(this,t,e,i,n,r)}}});cc.SpriteLoader.loader=function(){return new cc.SpriteLoader};var PROPERTY_TOUCH_ENABLED="touchEnabled";var PROPERTY_IS_TOUCH_ENABLED="isTouchEnabled";var PROPERTY_ACCELEROMETER_ENABLED="accelerometerEnabled";var PROPERTY_IS_ACCELEROMETER_ENABLED="isAccelerometerEnabled";var PROPERTY_IS_MOUSE_ENABLED="isMouseEnabled";var PROPERTY_MOUSE_ENABLED="mouseEnabled";var PROPERTY_KEYBOARD_ENABLED="keyboardEnabled";var PROPERTY_IS_KEYBOARD_ENABLED="isKeyboardEnabled";cc.LayerLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){var i=new cc.Layer;i.setContentSize(0,0);return i},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_TOUCH_ENABLED||i===PROPERTY_IS_TOUCH_ENABLED){}else if(i===PROPERTY_ACCELEROMETER_ENABLED||i===PROPERTY_IS_ACCELEROMETER_ENABLED){}else if(i===PROPERTY_MOUSE_ENABLED||i===PROPERTY_IS_MOUSE_ENABLED){}else if(i===PROPERTY_KEYBOARD_ENABLED||i===PROPERTY_IS_KEYBOARD_ENABLED){if(t.setKeyboardEnabled&&!cc.sys.isNative){t.setKeyboardEnabled(n)}else{cc.log("The property '"+PROPERTY_IS_KEYBOARD_ENABLED+"' is not supported!")}}else{cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}}});cc.LayerLoader.loader=function(){return new cc.LayerLoader};cc.LayerColorLoader=cc.LayerLoader.extend({_createCCNode:function(t,e){return new cc.LayerColor},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_COLOR){t.setColor(n)}else{cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_OPACITY){t.setOpacity(n)}else{cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}}});cc.LayerColorLoader.loader=function(){return new cc.LayerColorLoader};var PROPERTY_STARTCOLOR="startColor";var PROPERTY_ENDCOLOR="endColor";
var PROPERTY_STARTOPACITY="startOpacity";var PROPERTY_ENDOPACITY="endOpacity";var PROPERTY_VECTOR="vector";cc.LayerGradientLoader=cc.LayerLoader.extend({_createCCNode:function(t,e){return new cc.LayerGradient},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_STARTCOLOR){t.setStartColor(n)}else if(i===PROPERTY_ENDCOLOR){t.setEndColor(n)}else{cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_STARTOPACITY){t.setStartOpacity(n)}else if(i===PROPERTY_ENDOPACITY){t.setEndOpacity(n)}else{cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypePoint:function(t,e,i,n,r){if(i===PROPERTY_VECTOR){t.setVector(n)}else{cc.LayerLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}}});cc.LayerGradientLoader.loader=function(){return new cc.LayerGradientLoader};cc.MenuLoader=cc.LayerLoader.extend({_createCCNode:function(t,e){var i=new cc.Menu;i.setContentSize(0,0);return i}});cc.MenuLoader.loader=function(){return new cc.MenuLoader};var PROPERTY_BLOCK="block";var PROPERTY_ISENABLED="isEnabled";cc.MenuItemLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return null},onHandlePropTypeBlock:function(t,e,i,n,r){if(i===PROPERTY_BLOCK){if(null!=n){t.setTarget(n.selMenuHander,n.target)}}else{cc.NodeLoader.prototype.onHandlePropTypeBlock.call(this,t,e,i,n,r)}},onHandlePropTypeCheck:function(t,e,i,n,r){if(i===PROPERTY_ISENABLED){t.setEnabled(n)}else{cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,i,n,r)}}});var PROPERTY_NORMALDISPLAYFRAME="normalSpriteFrame";var PROPERTY_SELECTEDDISPLAYFRAME="selectedSpriteFrame";var PROPERTY_DISABLEDDISPLAYFRAME="disabledSpriteFrame";cc.MenuItemImageLoader=cc.MenuItemLoader.extend({_createCCNode:function(t,e){return new cc.MenuItemImage},onHandlePropTypeSpriteFrame:function(t,e,i,n,r){if(i===PROPERTY_NORMALDISPLAYFRAME){if(n!=null){t.setNormalSpriteFrame(n)}}else if(i===PROPERTY_SELECTEDDISPLAYFRAME){if(n!=null){t.setSelectedSpriteFrame(n)}}else if(i===PROPERTY_DISABLEDDISPLAYFRAME){if(n!=null){t.setDisabledSpriteFrame(n)}}else{cc.MenuItemLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,i,n,r)}}});cc.MenuItemImageLoader.loader=function(){return new cc.MenuItemImageLoader};var PROPERTY_FONTNAME="fontName";var PROPERTY_FONTSIZE="fontSize";var PROPERTY_HORIZONTALALIGNMENT="horizontalAlignment";var PROPERTY_VERTICALALIGNMENT="verticalAlignment";var PROPERTY_STRING="string";var PROPERTY_DIMENSIONS="dimensions";cc.LabelTTFLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return new cc.LabelTTF},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_COLOR){if(n.r!==255||n.g!==255||n.b!==255){t.setColor(n)}}else{cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_OPACITY){t.setOpacity(n)}else{cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}},onHandlePropTypeFontTTF:function(t,e,i,n,r){if(i===PROPERTY_FONTNAME){t.setFontName(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,i,n,r)}},onHandlePropTypeText:function(t,e,i,n,r){if(i===PROPERTY_STRING){t.setString(n)}else{cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,i,n,r)}},onHandlePropTypeFloatScale:function(t,e,i,n,r){if(i===PROPERTY_FONTSIZE){t.setFontSize(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,i,n,r)}},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){if(i===PROPERTY_HORIZONTALALIGNMENT){t.setHorizontalAlignment(n)}else if(i===PROPERTY_VERTICALALIGNMENT){t.setVerticalAlignment(n)}else{cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)}},onHandlePropTypeSize:function(t,e,i,n,r){if(i===PROPERTY_DIMENSIONS){t.setDimensions(n)}else{cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,i,n,r)}}});cc.LabelTTFLoader.loader=function(){return new cc.LabelTTFLoader};var PROPERTY_FNTFILE="fntFile";cc.LabelBMFontLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return new cc.LabelBMFont},onHandlePropTypeColor3:function(t,e,i,n,r){if(i===PROPERTY_COLOR){if(n.r!==255||n.g!==255||n.b!==255){t.setColor(n)}}else{cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,i,n,r)}},onHandlePropTypeByte:function(t,e,i,n,r){if(i===PROPERTY_OPACITY){t.setOpacity(n)}else{cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}},onHandlePropTypeFntFile:function(t,e,i,n,r){if(i===PROPERTY_FNTFILE){t.setFntFile(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFntFile.call(this,t,e,i,n,r)}},onHandlePropTypeText:function(t,e,i,n,r){if(i===PROPERTY_STRING){t.setString(n)}else{cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,i,n,r)}}});cc.LabelBMFontLoader.loader=function(){return new cc.LabelBMFontLoader};var PROPERTY_EMITERMODE="emitterMode";var PROPERTY_POSVAR="posVar";var PROPERTY_EMISSIONRATE="emissionRate";var PROPERTY_DURATION="duration";var PROPERTY_TOTALPARTICLES="totalParticles";var PROPERTY_LIFE="life";var PROPERTY_STARTSIZE="startSize";var PROPERTY_ENDSIZE="endSize";var PROPERTY_STARTSPIN="startSpin";var PROPERTY_ENDSPIN="endSpin";var PROPERTY_ANGLE="angle";var PROPERTY_GRAVITY="gravity";var PROPERTY_SPEED="speed";var PROPERTY_TANGENTIALACCEL="tangentialAccel";var PROPERTY_RADIALACCEL="radialAccel";var PROPERTY_TEXTURE="texture";var PROPERTY_STARTRADIUS="startRadius";var PROPERTY_ENDRADIUS="endRadius";var PROPERTY_ROTATEPERSECOND="rotatePerSecond";cc.ParticleSystemLoader=cc.NodeLoader.extend({_createCCNode:function(t,e){return new cc.ParticleSystem},onHandlePropTypeIntegerLabeled:function(t,e,i,n,r){if(i===PROPERTY_EMITERMODE){t.setEmitterMode(n)}else{cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,i,n,r)}},onHandlePropTypePoint:function(t,e,i,n,r){if(i===PROPERTY_POSVAR){t.setPosVar(n)}else if(i===PROPERTY_GRAVITY){t.setGravity(n)}else{cc.NodeLoader.prototype.onHandlePropTypePoint.call(this,t,e,i,n,r)}},onHandlePropTypeFloat:function(t,e,i,n,r){if(i===PROPERTY_EMISSIONRATE){t.setEmissionRate(n)}else if(i===PROPERTY_DURATION){t.setDuration(n)}else{cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,i,n,r)}},onHandlePropTypeInteger:function(t,e,i,n,r){if(i===PROPERTY_TOTALPARTICLES){t.setTotalParticles(n)}else{cc.NodeLoader.prototype.onHandlePropTypeInteger.call(this,t,e,i,n,r)}},onHandlePropTypeFloatVar:function(t,e,i,n,r){if(i===PROPERTY_LIFE){t.setLife(n[0]);t.setLifeVar(n[1])}else if(i===PROPERTY_STARTSIZE){t.setStartSize(n[0]);t.setStartSizeVar(n[1])}else if(i===PROPERTY_ENDSIZE){t.setEndSize(n[0]);t.setEndSizeVar(n[1])}else if(i===PROPERTY_STARTSPIN){t.setStartSpin(n[0]);t.setStartSpinVar(n[1])}else if(i===PROPERTY_ENDSPIN){t.setEndSpin(n[0]);t.setEndSpinVar(n[1])}else if(i===PROPERTY_ANGLE){t.setAngle(n[0]);t.setAngleVar(n[1])}else if(i===PROPERTY_SPEED){t.setSpeed(n[0]);t.setSpeedVar(n[1])}else if(i===PROPERTY_TANGENTIALACCEL){t.setTangentialAccel(n[0]);t.setTangentialAccelVar(n[1])}else if(i===PROPERTY_RADIALACCEL){t.setRadialAccel(n[0]);t.setRadialAccelVar(n[1])}else if(i===PROPERTY_STARTRADIUS){t.setStartRadius(n[0]);t.setStartRadiusVar(n[1])}else if(i===PROPERTY_ENDRADIUS){t.setEndRadius(n[0]);t.setEndRadiusVar(n[1])}else if(i===PROPERTY_ROTATEPERSECOND){t.setRotatePerSecond(n[0]);t.setRotatePerSecondVar(n[1])}else{cc.NodeLoader.prototype.onHandlePropTypeFloatVar.call(this,t,e,i,n,r)}},onHandlePropTypeColor4FVar:function(t,e,i,n,r){if(i===PROPERTY_STARTCOLOR){t.setStartColor(n[0]);t.setStartColorVar(n[1])}else if(i===PROPERTY_ENDCOLOR){t.setEndColor(n[0]);t.setEndColorVar(n[1])}else{cc.NodeLoader.prototype.onHandlePropTypeColor4FVar.call(this,t,e,i,n,r)}},onHandlePropTypeBlendFunc:function(t,e,i,n,r){if(i===PROPERTY_BLENDFUNC){t.setBlendFunc(n)}else{cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,i,n,r)}},onHandlePropTypeTexture:function(t,e,i,n,r){if(i===PROPERTY_TEXTURE){t.setTexture(n)}else{cc.NodeLoader.prototype.onHandlePropTypeTexture.call(this,t,e,i,n,r)}}});cc.ParticleSystemLoader.loader=function(){return new cc.ParticleSystemLoader};cc.NodeLoaderLibrary=cc.Class.extend({_ccNodeLoaders:null,ctor:function(){this._ccNodeLoaders={}},registerDefaultCCNodeLoaders:function(){this.registerCCNodeLoader("CCNode",cc.NodeLoader.loader());this.registerCCNodeLoader("CCLayer",cc.LayerLoader.loader());this.registerCCNodeLoader("CCLayerColor",cc.LayerColorLoader.loader());this.registerCCNodeLoader("CCLayerGradient",cc.LayerGradientLoader.loader());this.registerCCNodeLoader("CCSprite",cc.SpriteLoader.loader());this.registerCCNodeLoader("CCLabelBMFont",cc.LabelBMFontLoader.loader());this.registerCCNodeLoader("CCLabelTTF",cc.LabelTTFLoader.loader());this.registerCCNodeLoader("CCScale9Sprite",cc.Scale9SpriteLoader.loader());this.registerCCNodeLoader("CCScrollView",cc.ScrollViewLoader.loader());this.registerCCNodeLoader("CCBFile",cc.BuilderFileLoader.loader());this.registerCCNodeLoader("CCMenu",cc.MenuLoader.loader());this.registerCCNodeLoader("CCMenuItemImage",cc.MenuItemImageLoader.loader());this.registerCCNodeLoader("CCControlButton",cc.ControlButtonLoader.loader());this.registerCCNodeLoader("CCParticleSystemQuad",cc.ParticleSystemLoader.loader())},registerCCNodeLoader:function(t,e){this._ccNodeLoaders[t]=e},unregisterCCNodeLoader:function(t){if(this._ccNodeLoaders[t]){delete this._ccNodeLoaders[t]}},getCCNodeLoader:function(t){if(this._ccNodeLoaders[t])return this._ccNodeLoaders[t];return null},purge:function(t){if(t){for(var e in this._ccNodeLoaders){delete this._ccNodeLoaders[e]}}this._ccNodeLoaders={}}});cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null;cc.NodeLoaderLibrary.library=function(){return new cc.NodeLoaderLibrary};cc.NodeLoaderLibrary.sharedCCNodeLoaderLibrary=function(){if(cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary==null){cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=new cc.NodeLoaderLibrary;cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary.registerDefaultCCNodeLoaders()}return cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary};cc.NodeLoaderLibrary.purgeSharedCCNodeLoaderLibrary=function(){cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null};cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary=function(){var t=cc.NodeLoaderLibrary.library();t.registerDefaultCCNodeLoaders();return t};var CCB_VERSION=5;var CCB_PROPTYPE_POSITION=0;var CCB_PROPTYPE_SIZE=1;var CCB_PROPTYPE_POINT=2;var CCB_PROPTYPE_POINTLOCK=3;var CCB_PROPTYPE_SCALELOCK=4;var CCB_PROPTYPE_DEGREES=5;var CCB_PROPTYPE_INTEGER=6;var CCB_PROPTYPE_FLOAT=7;var CCB_PROPTYPE_FLOATVAR=8;var CCB_PROPTYPE_CHECK=9;var CCB_PROPTYPE_SPRITEFRAME=10;var CCB_PROPTYPE_TEXTURE=11;var CCB_PROPTYPE_BYTE=12;var CCB_PROPTYPE_COLOR3=13;var CCB_PROPTYPE_COLOR4VAR=14;var CCB_PROPTYPE_FLIP=15;var CCB_PROPTYPE_BLENDMODE=16;var CCB_PROPTYPE_FNTFILE=17;var CCB_PROPTYPE_TEXT=18;var CCB_PROPTYPE_FONTTTF=19;var CCB_PROPTYPE_INTEGERLABELED=20;var CCB_PROPTYPE_BLOCK=21;var CCB_PROPTYPE_ANIMATION=22;var CCB_PROPTYPE_CCBFILE=23;var CCB_PROPTYPE_STRING=24;var CCB_PROPTYPE_BLOCKCCCONTROL=25;var CCB_PROPTYPE_FLOATSCALE=26;var CCB_PROPTYPE_FLOATXY=27;var CCB_FLOAT0=0;var CCB_FLOAT1=1;var CCB_FLOAT_MINUS1=2;var CCB_FLOAT05=3;var CCB_FLOAT_INTEGER=4;var CCB_FLOAT_FULL=5;var CCB_PLATFORM_ALL=0;var CCB_PLATFORM_IOS=1;var CCB_PLATFORM_MAC=2;var CCB_TARGETTYPE_NONE=0;var CCB_TARGETTYPE_DOCUMENTROOT=1;var CCB_TARGETTYPE_OWNER=2;var CCB_KEYFRAME_EASING_INSTANT=0;var CCB_KEYFRAME_EASING_LINEAR=1;var CCB_KEYFRAME_EASING_CUBIC_IN=2;var CCB_KEYFRAME_EASING_CUBIC_OUT=3;var CCB_KEYFRAME_EASING_CUBIC_INOUT=4;var CCB_KEYFRAME_EASING_ELASTIC_IN=5;var CCB_KEYFRAME_EASING_ELASTIC_OUT=6;var CCB_KEYFRAME_EASING_ELASTIC_INOUT=7;var CCB_KEYFRAME_EASING_BOUNCE_IN=8;var CCB_KEYFRAME_EASING_BOUNCE_OUT=9;var CCB_KEYFRAME_EASING_BOUNCE_INOUT=10;var CCB_KEYFRAME_EASING_BACK_IN=11;var CCB_KEYFRAME_EASING_BACK_OUT=12;var CCB_KEYFRAME_EASING_BACK_INOUT=13;var CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT=0;var CCB_POSITIONTYPE_RELATIVE_TOP_LEFT=1;var CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT=2;var CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT=3;var CCB_POSITIONTYPE_PERCENT=4;var CCB_POSITIONTYPE_MULTIPLY_RESOLUTION=5;var CCB_SIZETYPE_ABSOLUTE=0;var CCB_SIZETYPE_PERCENT=1;var CCB_SIZETYPE_RELATIVE_CONTAINER=2;var CCB_SIZETYPE_HORIZONTAL_PERCENT=3;var CCB_SIZETYPE_VERTICAL_PERCENT=4;var CCB_SIZETYPE_MULTIPLY_RESOLUTION=5;var CCB_SCALETYPE_ABSOLUTE=0;var CCB_SCALETYPE_MULTIPLY_RESOLUTION=1;cc.BuilderFile=cc.Node.extend({_ccbFileNode:null,getCCBFileNode:function(){return this._ccbFileNode},setCCBFileNode:function(t){this._ccbFileNode=t}});cc.BuilderFile.create=function(){return new cc.BuilderFile};cc.BuilderReader=cc.Class.extend({_jsControlled:false,_data:null,_ccbRootPath:"",_bytes:0,_currentByte:0,_currentBit:0,_stringCache:null,_loadedSpriteSheets:null,_owner:null,_animationManager:null,_animationManagers:null,_animatedProps:null,_ccNodeLoaderLibrary:null,_ccNodeLoaderListener:null,_ccbMemberVariableAssigner:null,_ccbSelectorResolver:null,_ownerOutletNames:null,_ownerOutletNodes:null,_nodesWithAnimationManagers:null,_animationManagerForNodes:null,_ownerCallbackNames:null,_ownerCallbackNodes:null,_ownerCallbackEvents:null,_readNodeGraphFromData:false,ctor:function(t,e,i,n){this._stringCache=[];this._loadedSpriteSheets=[];this._currentBit=-1;this._currentByte=-1;if(arguments.length!==0){if(t instanceof cc.BuilderReader){var r=t;this._loadedSpriteSheets=r._loadedSpriteSheets;this._ccNodeLoaderLibrary=r._ccNodeLoaderLibrary;this._ccbMemberVariableAssigner=r._ccbMemberVariableAssigner;this._ccbSelectorResolver=r._ccbSelectorResolver;this._ccNodeLoaderListener=r._ccNodeLoaderListener;this._ownerCallbackNames=r._ownerCallbackNames;this._ownerCallbackNodes=r._ownerCallbackNodes;this._ownerCallbackEvents=r._ownerCallbackEvents;this._ownerOutletNames=r._ownerOutletNames;this._ownerOutletNodes=r._ownerOutletNodes;this._ccbRootPath=r._ccbRootPath}else{this._ccNodeLoaderLibrary=t;this._ccbMemberVariableAssigner=e;this._ccbSelectorResolver=i;this._ccNodeLoaderListener=n}}},getCCBRootPath:function(){return this._ccbRootPath},setCCBRootPath:function(t){this._ccbRootPath=t},initWithData:function(t,e){this._animationManager=new cc.BuilderAnimationManager;this._data=t;this._bytes=t.length;this._currentBit=0;this._currentByte=0;this._owner=e;this._animationManager.setRootContainerSize(cc.director.getWinSize());return true},_loadBinarySync:function(t){var e=this;var i=this.getXMLHttpRequest();var n="load "+t+" failed!";i.open("GET",t,false);var r=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){i.setRequestHeader("Accept-Charset","x-user-defined");i.send(null);if(i.status!==200){cc.log(n);return null}var s=cc._convertResponseBodyToText(i["responseBody"]);if(s){r=this._stringConvertToArray(s);this._fileDataCache[t]=r}}else{if(i.overrideMimeType)i.overrideMimeType("text/plain; charset=x-user-defined");i.send(null);if(i.status!==200){cc.log(n);return null}r=this._stringConvertToArray(i.responseText);this._fileDataCache[t]=r}return r},readNodeGraphFromFile:function(t,e,i,n){if(i==null){i=cc.director.getWinSize()}else if(i instanceof cc.BuilderAnimationManager){n=i;i=cc.director.getWinSize()}var r=cc.loader.getRes(t);if(!r){var s=cc.loader.getUrl(t);r=cc.loader.loadBinarySync(s);cc.loader.cache[t]=r}return this.readNodeGraphFromData(r,e,i,n)},readNodeGraphFromData:function(t,e,i){this.initWithData(t,e);var n=this._animationManager;n.setRootContainerSize(i);n.setOwner(e);this._ownerOutletNames=[];this._ownerOutletNodes=[];this._ownerCallbackNames=[];this._ownerCallbackNodes=[];this._ownerCallbackEvents=[];this._animationManagers=new cc._Dictionary;var r=this.readFileWithCleanUp(true);if(r&&n.getAutoPlaySequenceId()!==-1){n.runAnimations(n.getAutoPlaySequenceId(),0)}if(this._jsControlled){var s=[];var a=[];var o=this._animationManagers;var c=o.allKeys();for(var l=0;l<c.length;l++){s.push(c[l]);a.push(o.objectForKey(c[l]))}this._nodesWithAnimationManagers=s;this._animationManagerForNodes=a}return r},createSceneWithNodeGraphFromFile:function(t,e,i,n){var r=this.readNodeGraphFromFile(t,e,i,n);var s=new cc.Scene;s.addChild(r);return s},getCCBMemberVariableAssigner:function(){return this._ccbMemberVariableAssigner},getCCBSelectorResolver:function(){return this._ccbSelectorResolver},getAnimationManager:function(){return this._animationManager},setAnimationManager:function(t){this._animationManager=t},getAnimatedProperties:function(){return this._animatedProps},getLoadedSpriteSheet:function(){return this._loadedSpriteSheets},getOwner:function(){return this._owner},readInt:function(t){var e=0;while(!this._getBit()){e++}var i=0;for(var n=e-1;n>=0;n--){if(this._getBit()){i|=1<<n}}i|=1<<e;var r;if(t){var s=i%2;if(s){r=0|i/2}else{r=0|-i/2}}else{r=i-1}this._alignBits();return r},readByte:function(){var t=this._data[this._currentByte];this._currentByte++;return t},readBool:function(){return 0!==this.readByte()},readFloat:function(){var t=this.readByte();switch(t){case CCB_FLOAT0:return 0;case CCB_FLOAT1:return 1;case CCB_FLOAT_MINUS1:return-1;case CCB_FLOAT05:return.5;case CCB_FLOAT_INTEGER:return this.readInt(true);default:var e=this._decodeFloat(23,8);return e}},_decodeFloat:function(t,e){var i=t+e+1;var n=i>>3;this._checkSize(i);var r=Math.pow(2,e-1)-1;var s=this._readBitsOnly(t+e,1,n);var a=this._readBitsOnly(t,e,n);var o=0;var c=2;var l=0;do{var h=this._readByteOnly(++l,n);var u=t%8||8;var d=1<<u;while(d>>=1){if(h&d){o+=1/c}c*=2}}while(t-=u);this._currentByte+=n;return a===(r<<1)+1?o?NaN:s?-Infinity:+Infinity:(1+s*-2)*(a||o?!a?Math.pow(2,-r+1)*o:Math.pow(2,a-r)*(1+o):0)},_readBitsOnly:function(t,e,i){var n=(t+e)%8;var r=t%8;var s=i-(t>>3)-1;var a=i+(-(t+e)>>3);var o=s-a;var c=this._readByteOnly(s,i)>>r&(1<<(o?8-r:e))-1;if(o&&n){c+=(this._readByteOnly(a++,i)&(1<<n)-1)<<(o--<<3)-r}while(o){c+=this._shl(this._readByteOnly(a++,i),(o--<<3)-r)}return c},_readByteOnly:function(t,e){return this._data[this._currentByte+e-t-1]},_shl:function(t,e){for(++e;--e;t=((t%=2147483647+1)&1073741824)===1073741824?t*2:(t-1073741824)*2+2147483647+1);return t},_checkSize:function(t){if(!(this._currentByte+Math.ceil(t/8)<this._data.length)){throw new Error("Index out of bound")}},readCachedString:function(){return this._stringCache[this.readInt(false)]},isJSControlled:function(){return this._jsControlled},getOwnerCallbackNames:function(){return this._ownerCallbackNames},getOwnerCallbackNodes:function(){return this._ownerCallbackNodes},getOwnerCallbackControlEvents:function(){return this._ownerCallbackEvents},getOwnerOutletNames:function(){return this._ownerOutletNames},getOwnerOutletNodes:function(){return this._ownerOutletNodes},getNodesWithAnimationManagers:function(){return this._nodesWithAnimationManagers},getAnimationManagersForNodes:function(){return this._animationManagerForNodes},getAnimationManagers:function(){return this._animationManagers},setAnimationManagers:function(t){this._animationManagers=t},addOwnerCallbackName:function(t){this._ownerCallbackNames.push(t)},addOwnerCallbackNode:function(t){this._ownerCallbackNodes.push(t)},addOwnerCallbackControlEvents:function(t){this._ownerCallbackEvents.push(t)},addDocumentCallbackName:function(t){this._animationManager.addDocumentCallbackName(t)},addDocumentCallbackNode:function(t){this._animationManager.addDocumentCallbackNode(t)},addDocumentCallbackControlEvents:function(t){this._animationManager.addDocumentCallbackControlEvents(t)},readFileWithCleanUp:function(t){if(!this._readHeader())return null;if(!this._readStringCache())return null;if(!this._readSequences())return null;var e=this._readNodeGraph();this._animationManagers.setObject(this._animationManager,e);if(t)this._cleanUpNodeGraph(e);return e},addOwnerOutletName:function(t){this._ownerOutletNames.push(t)},addOwnerOutletNode:function(t){if(t==null)return;this._ownerOutletNodes.push(t)},_cleanUpNodeGraph:function(t){t.userObject=null;var e=t.getChildren();for(var i=0,n=e.length;i<n;i++){this._cleanUpNodeGraph(e[i])}},_readCallbackKeyframesForSeq:function(t){var e=this.readInt(false);if(!e)return true;var i=new cc.BuilderSequenceProperty;var n=this._jsControlled,r=this._animationManager,s=i.getKeyframes();for(var a=0;a<e;a++){var o=this.readFloat();var c=this.readCachedString();var l=this.readInt(false);var h=[c,l];var u=new cc.BuilderKeyframe;u.setTime(o);u.setValue(h);if(n)r.getKeyframeCallbacks().push(l+":"+c);s.push(u)}t.setCallbackChannel(i);return true},_readSoundKeyframesForSeq:function(t){var e=this.readInt(false);if(!e)return true;var i=new cc.BuilderSequenceProperty;var n=i.getKeyframes();for(var r=0;r<e;r++){var s=this.readFloat();var a=this.readCachedString();var o=this.readFloat();var c=this.readFloat();var l=this.readFloat();var h=[a,o,c,l];var u=new cc.BuilderKeyframe;u.setTime(s);u.setValue(h);n.push(u)}t.setSoundChannel(i);return true},_readSequences:function(){var t=this._animationManager.getSequences();var e=this.readInt(false);for(var i=0;i<e;i++){var n=new cc.BuilderSequence;n.setDuration(this.readFloat());n.setName(this.readCachedString());n.setSequenceId(this.readInt(false));n.setChainedSequenceId(this.readInt(true));if(!this._readCallbackKeyframesForSeq(n))return false;if(!this._readSoundKeyframesForSeq(n))return false;t.push(n)}this._animationManager.setAutoPlaySequenceId(this.readInt(true));return true},readKeyframe:function(t){var e=new cc.BuilderKeyframe;e.setTime(this.readFloat());var i=this.readInt(false);var n=0;var r=null;if(i===CCB_KEYFRAME_EASING_CUBIC_IN||i===CCB_KEYFRAME_EASING_CUBIC_OUT||i===CCB_KEYFRAME_EASING_CUBIC_INOUT||i===CCB_KEYFRAME_EASING_ELASTIC_IN||i===CCB_KEYFRAME_EASING_ELASTIC_OUT||i===CCB_KEYFRAME_EASING_ELASTIC_INOUT){n=this.readFloat()}e.setEasingType(i);e.setEasingOpt(n);if(t===CCB_PROPTYPE_CHECK){r=this.readBool()}else if(t===CCB_PROPTYPE_BYTE){r=this.readByte()}else if(t===CCB_PROPTYPE_COLOR3){var s=cc.color(this.readByte(),this.readByte(),this.readByte());r=cc.Color3BWapper.create(s)}else if(t===CCB_PROPTYPE_FLOATXY){r=[this.readFloat(),this.readFloat()]}else if(t===CCB_PROPTYPE_DEGREES){r=this.readFloat()}else if(t===CCB_PROPTYPE_SCALELOCK||t===CCB_PROPTYPE_POSITION||t===CCB_PROPTYPE_FLOATXY){r=[this.readFloat(),this.readFloat()]}else if(t===CCB_PROPTYPE_SPRITEFRAME){var a=this.readCachedString();var o=this.readCachedString();if(a===""){o=this._ccbRootPath+o;var c=cc.textureCache.addImage(o);var l=c.getContentSize();var h=cc.rect(0,0,l.width,l.height);r=new cc.SpriteFrame(c,h)}else{a=this._ccbRootPath+a;var u=cc.spriteFrameCache;if(this._loadedSpriteSheets.indexOf(a)===-1){u.addSpriteFrames(a);this._loadedSpriteSheets.push(a)}r=u.getSpriteFrame(o)}}e.setValue(r);return e},_readHeader:function(){if(!this._data)return false;var t=this._readStringFromBytes(this._currentByte,4,true);this._currentByte+=4;if(t!=="ccbi"){return false}var e=this.readInt(false);if(e!==CCB_VERSION){cc.log("WARNING! Incompatible ccbi file version (file: "+e+" reader: "+CCB_VERSION+")");return false}this._jsControlled=this.readBool();this._animationManager._jsControlled=this._jsControlled;return true},_readStringFromBytes:function(t,e,i){i=i||false;var n="";var r,s=this._data,a=this._currentByte;if(i){for(r=e-1;r>=0;r--)n+=String.fromCharCode(s[a+r])}else{for(r=0;r<e;r++)n+=String.fromCharCode(s[a+r])}return n},_readStringCache:function(){var t=this.readInt(false);for(var e=0;e<t;e++)this._readStringCacheEntry();return true},_readStringCacheEntry:function(){var t=this.readByte();var e=this.readByte();var i=t<<8|e;var n="",r=this._data,s=this._currentByte;for(var a=0;a<i;a++){var o=r[s+a].toString("16").toUpperCase();o=o.length>1?o:"0"+o;n+="%"+o}n=decodeURIComponent(n);this._currentByte+=i;this._stringCache.push(n)},_readNodeGraph:function(t){var e=this.readCachedString();var i,n=this._jsControlled,r=this._animationManager;if(n)i=this.readCachedString();var s=this.readInt(false);var a;if(s!==CCB_TARGETTYPE_NONE){a=this.readCachedString()}var o=this._ccNodeLoaderLibrary.getCCNodeLoader(e);if(!o){o=this._ccNodeLoaderLibrary.getCCNodeLoader("CCNode")}var c=o.loadCCNode(t,this);if(!r.getRootNode())r.setRootNode(c);if(n&&c===r.getRootNode()){r.setDocumentControllerName(i)}var l=new cc._Dictionary;this._animatedProps=[];var h,u=this._animatedProps;var d=this.readInt(false);for(h=0;h<d;++h){var _=this.readInt(false);var f=new cc._Dictionary;var p=this.readInt(false);for(var m=0;m<p;++m){var g=new cc.BuilderSequenceProperty;g.setName(this.readCachedString());g.setType(this.readInt(false));u.push(g.getName());var v=this.readInt(false);var y=g.getKeyframes();for(var T=0;T<v;++T){var C=this.readKeyframe(g.getType());y.push(C)}f.setObject(g,g.getName())}l.setObject(f,_)}if(l.count()>0)r.addNode(c,l);o.parseProperties(c,t,this);var S=c instanceof cc.BuilderFile;if(S){var x=c.getCCBFileNode();x.setPosition(c.getPosition());x.setRotation(c.getRotation());x.setScaleX(c.getScaleX());x.setScaleY(c.getScaleY());x.setTag(c.getTag());x.setVisible(true);r.moveAnimationsFromNode(c,x);c.setCCBFileNode(null);c=x}var E=null,b=null;if(s!==CCB_TARGETTYPE_NONE){if(!n){if(s===CCB_TARGETTYPE_DOCUMENTROOT){E=r.getRootNode()}else if(s===CCB_TARGETTYPE_OWNER){E=this._owner}if(!E){var A=false;if(E.onAssignCCBMemberVariable)A=E.onAssignCCBMemberVariable(E,a,c);b=this._ccbMemberVariableAssigner;if(!A&&b!=null&&b.onAssignCCBMemberVariable){b.onAssignCCBMemberVariable(E,a,c)}}}else{if(s===CCB_TARGETTYPE_DOCUMENTROOT){r.addDocumentOutletName(a);r.addDocumentOutletNode(c)}else{this._ownerOutletNames.push(a);this._ownerOutletNodes.push(c)}}}if(o.getCustomProperties().length>0){var R=false;if(!n){E=c;if(E!=null&&E.onAssignCCBCustomProperty!=null){var P=o.getCustomProperties();var w=P.allKeys();for(h=0;h<w.length;h++){var I=P.objectForKey(w[h]);R=E.onAssignCCBCustomProperty(E,w[h],I);b=this._ccbMemberVariableAssigner;if(!R&&b!=null&&b.onAssignCCBCustomProperty!=null)R=b.onAssignCCBCustomProperty(E,w[h],I)}}}}this._animatedProps=null;var D=this.readInt(false);for(h=0;h<D;h++){var L=this._readNodeGraph(c);c.addChild(L)}if(!S){if(c!=null&&c.onNodeLoaded)c.onNodeLoaded(c,o);else if(this._ccNodeLoaderListener!=null)this._ccNodeLoaderListener.onNodeLoaded(c,o)}return c},_getBit:function(){var t=(this._data[this._currentByte]&1<<this._currentBit)!==0;this._currentBit++;if(this._currentBit>=8){this._currentBit=0;this._currentByte++;if(this._currentByte>this._data.length)throw new Error("out of the data bound")}return t},_alignBits:function(){if(this._currentBit){this._currentBit=0;this._currentByte++}},_readUTF8:function(){}});cc.BuilderReader._ccbResolutionScale=1;cc.BuilderReader.setResolutionScale=function(t){cc.BuilderReader._ccbResolutionScale=t};cc.BuilderReader.getResolutionScale=function(){return cc.BuilderReader._ccbResolutionScale};cc.BuilderReader.loadAsScene=function(t,e,i,n){n=n||cc.BuilderReader.getResourcePath();var r=cc.BuilderReader.load(t,e,i,n);var s=new cc.Scene;s.addChild(r);return s};cc.BuilderReader._controllerClassCache={};cc.BuilderReader.registerController=function(t,e){cc.BuilderReader._controllerClassCache[t]=cc.Class.extend(e)};cc.BuilderReader.load=function(t,e,i,n){n=n||cc.BuilderReader.getResourcePath();var r=new cc.BuilderReader(cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary());r.setCCBRootPath(n);if(t.length<5||t.toLowerCase().lastIndexOf(".ccbi")!==t.length-5)t=t+".ccbi";var s=r.readNodeGraphFromFile(t,e,i);var a;var o,c,l,h,u;if(e){var d=r.getOwnerCallbackNames();var _=r.getOwnerCallbackNodes();var f=r.getOwnerCallbackControlEvents();for(a=0;a<d.length;a++){o=d[a];c=_[a];l=f[a];if(c instanceof cc.ControlButton)c.addTargetWithActionForControlEvents(e,e[o],l);else c.setCallback(e[o],e)}var p=r.getOwnerOutletNames();var m=r.getOwnerOutletNodes();for(a=0;a<p.length;a++){h=p[a];u=m[a];e[h]=u}}var g=r.getNodesWithAnimationManagers();var v=r.getAnimationManagersForNodes();if(!g||!v)return s;var y=cc.BuilderReader._controllerClassCache;for(a=0;a<g.length;a++){var T=g[a];var C=v[a];var S;T.animationManager=C;var x=C.getDocumentControllerName();if(!x)continue;var E=y[x];if(!E)throw new Error("Can not find controller : "+x);var b=new E;b.controllerName=x;T.controller=b;b.rootNode=T;var A=C.getDocumentCallbackNames();var R=C.getDocumentCallbackNodes();var P=C.getDocumentCallbackControlEvents();for(S=0;S<A.length;S++){o=A[S];c=R[S];l=P[S];if(c instanceof cc.ControlButton)c.addTargetWithActionForControlEvents(b,b[o],l);else c.setCallback(b[o],b)}var w=C.getDocumentOutletNames();var I=C.getDocumentOutletNodes();for(S=0;S<w.length;S++){h=w[S];u=I[S];b[h]=u}if(b.onDidLoadFromCCB&&cc.isFunction(b.onDidLoadFromCCB))b.onDidLoadFromCCB();var D=C.getKeyframeCallbacks();for(S=0;S<D.length;S++){var L=D[S].split(":");var O=L[0];var B=L[1];if(O==1){C.setCallFunc(cc.callFunc(b[B],b),D[S])}else if(O==2&&e){C.setCallFunc(cc.callFunc(e[B],e),D[S])}}}C.runAnimations(C.getAutoPlaySequenceId(),0);return s};cc.BuilderReader._resourcePath="";cc.BuilderReader.setResourcePath=function(t){cc.BuilderReader._resourcePath=t};cc.BuilderReader.getResourcePath=function(){return cc.BuilderReader._resourcePath};cc.BuilderReader.lastPathComponent=function(t){var e=t.lastIndexOf("/");if(e!==-1){return t.substring(e+1,t.length-e)}return t};cc.BuilderReader.deletePathExtension=function(t){var e=t.lastIndexOf(".");if(e!==-1){return t.substring(0,e)}return t};cc.BuilderReader.toLowerCase=function(t){return t.toLowerCase()};cc.BuilderReader.endsWith=function(t,e){if(t.length>=e.length)return t.lastIndexOf(e)===0;else return false};cc.BuilderReader.concat=function(t,e){return t+e};cc.loader.register(["ccbi"],cc._binaryLoader);cc.INT_VALUE=0;cc.FLOAT_VALUE=1;cc.POINTER_VALUE=2;cc.BOOL_VALUE=3;cc.UNSIGNEDCHAR_VALUE=4;cc.Color3BWapper=cc.Class.extend({_color:null,ctor:function(){this._color=cc.color(0,0,0)},getColor:function(){return this._color}});cc.Color3BWapper.create=function(t){var e=new cc.Color3BWapper;if(e){e._color.r=t.r;e._color.g=t.g;e._color.b=t.b}return e};cc.BuilderValue=cc.Class.extend({_value:null,_type:0,getIntValue:function(){},getFloatValue:function(){},getBoolValue:function(){},getByteValue:function(){},getPointer:function(){},getValue:function(){return this._value}});cc.BuilderValue.create=function(t){return new cc.BuilderValue};cc.BuilderKeyframe=cc.Class.extend({_value:null,_time:0,_easingType:0,_easingOpt:0,getValue:function(){return this._value},setValue:function(t){this._value=t},getTime:function(){return this._time},setTime:function(t){this._time=t},getEasingType:function(){return this._easingType},setEasingType:function(t){this._easingType=t},getEasingOpt:function(){return this._easingOpt},setEasingOpt:function(t){this._easingOpt=t}});cc.BuilderSequence=cc.Class.extend({_duration:0,_name:"",_sequenceId:0,_chainedSequenceId:0,_callbackChannel:null,_soundChannel:null,ctor:function(){this._name=""},getDuration:function(){return this._duration},setDuration:function(t){this._duration=t},getName:function(){return this._name},setName:function(t){this._name=t},getSequenceId:function(){return this._sequenceId},setSequenceId:function(t){this._sequenceId=t},getChainedSequenceId:function(){return this._chainedSequenceId},setChainedSequenceId:function(t){this._chainedSequenceId=t},getCallbackChannel:function(){return this._callbackChannel},setCallbackChannel:function(t){this._callbackChannel=t},getSoundChannel:function(){return this._soundChannel},setSoundChannel:function(t){this._soundChannel=t}});cc.BuilderSequenceProperty=cc.Class.extend({_name:null,_type:0,_keyFrames:null,ctor:function(){this.init()},init:function(){this._keyFrames=[];this._name=""},getName:function(){return this._name;
},setName:function(t){this._name=t},getType:function(){return this._type},setType:function(t){this._type=t},getKeyframes:function(){return this._keyFrames}});cc.getAbsolutePosition=function(t,e,i,n){var r=cc.p(0,0);if(e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT)r=t;else if(e===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT){r.x=t.x;r.y=i.height-t.y}else if(e===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT){r.x=i.width-t.x;r.y=i.height-t.y}else if(e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT){r.x=i.width-t.x;r.y=t.y}else if(e===CCB_POSITIONTYPE_PERCENT){r.x=i.width*t.x/100;r.y=i.height*t.y/100}else if(e===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var s=cc.BuilderReader.getResolutionScale();r.x=t.x*s;r.y=t.y*s}return r};cc._getAbsolutePosition=function(t,e,i,n,r){var s=cc.p(0,0);if(i===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT){s.x=t;s.y=e}else if(i===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT){s.x=t;s.y=n.height-e}else if(i===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT){s.x=n.width-t;s.y=n.height-e}else if(i===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT){s.x=n.width-t;s.y=e}else if(i===CCB_POSITIONTYPE_PERCENT){s.x=n.width*t/100;s.y=n.height*e/100}else if(i===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var a=cc.BuilderReader.getResolutionScale();s.x=t*a;s.y=e*a}return s};cc.setRelativeScale=function(t,e,i,n,r){if(!t)throw new Error("cc.setRelativeScale(): node should be non-null");if(n===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var s=cc.BuilderReader.getResolutionScale();e*=s;i*=s}t.setScaleX(e);t.setScaleY(i)};cc.BuilderAnimationManagerDelegate=cc.Class.extend({completedAnimationSequenceNamed:function(t){}});cc.BuilderAnimationManager=cc.Class.extend({_sequences:null,_nodeSequences:null,_baseValues:null,_autoPlaySequenceId:0,_rootNode:null,_owner:null,_rootContainerSize:null,_delegate:null,_runningSequence:null,_documentOutletNames:null,_documentOutletNodes:null,_documentCallbackNames:null,_documentCallbackNodes:null,_documentCallbackControlEvents:null,_documentControllerName:"",_lastCompletedSequenceName:"",_keyframeCallbacks:null,_keyframeCallFuncs:null,_animationCompleteCallbackFunc:null,_target:null,_jsControlled:false,ctor:function(){this._rootContainerSize=cc.size(0,0);this.init()},init:function(){this._sequences=[];this._nodeSequences=new cc._Dictionary;this._baseValues=new cc._Dictionary;this._documentOutletNames=[];this._documentOutletNodes=[];this._documentCallbackNames=[];this._documentCallbackNodes=[];this._documentCallbackControlEvents=[];this._keyframeCallbacks=[];this._keyframeCallFuncs={};return true},getSequences:function(){return this._sequences},setSequences:function(t){this._sequences=t},getAutoPlaySequenceId:function(){return this._autoPlaySequenceId},setAutoPlaySequenceId:function(t){this._autoPlaySequenceId=t},getRootNode:function(){return this._rootNode},setRootNode:function(t){this._rootNode=t},getOwner:function(){return this._owner},setOwner:function(t){this._owner=t},addDocumentCallbackNode:function(t){this._documentCallbackNodes.push(t)},addDocumentCallbackName:function(t){this._documentCallbackNames.push(t)},addDocumentCallbackControlEvents:function(t){this._documentCallbackControlEvents.push(t)},addDocumentOutletNode:function(t){this._documentOutletNodes.push(t)},addDocumentOutletName:function(t){this._documentOutletNames.push(t)},setDocumentControllerName:function(t){this._documentControllerName=t},getDocumentControllerName:function(){return this._documentControllerName},getDocumentCallbackNames:function(){return this._documentCallbackNames},getDocumentCallbackNodes:function(){return this._documentCallbackNodes},getDocumentCallbackControlEvents:function(){return this._documentCallbackControlEvents},getDocumentOutletNames:function(){return this._documentOutletNames},getDocumentOutletNodes:function(){return this._documentOutletNodes},getLastCompletedSequenceName:function(){return this._lastCompletedSequenceName},getKeyframeCallbacks:function(){return this._keyframeCallbacks},getRootContainerSize:function(){return this._rootContainerSize},setRootContainerSize:function(t){this._rootContainerSize=cc.size(t.width,t.height)},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},getRunningSequenceName:function(){if(this._runningSequence)return this._runningSequence.getName();return null},getContainerSize:function(t){if(t)return t.getContentSize();else return this._rootContainerSize},addNode:function(t,e){this._nodeSequences.setObject(e,t)},setBaseValue:function(t,e,i){var n=this._baseValues.objectForKey(e);if(!n){n=new cc._Dictionary;this._baseValues.setObject(n,e)}n.setObject(t,i)},moveAnimationsFromNode:function(t,e){var i=this._baseValues;var n=i.objectForKey(t);if(n!==null){i.setObject(n,e);i.removeObjectForKey(t)}var r=this._nodeSequences;var s=r.objectForKey(t);if(s!=null){r.setObject(s,e);r.removeObjectForKey(t)}},getActionForCallbackChannel:function(t){var e=0;var i=[];var n=t.getKeyframes();var r=n.length;for(var s=0;s<r;++s){var a=n[s];var o=a.getTime()-e;e=a.getTime();if(o>0){i.push(cc.delayTime(o))}var c=a.getValue();var l=c[0];var h=c[1];if(this._jsControlled){var u=h+":"+l;var d=this._keyframeCallFuncs[u];if(d!=null)i.push(d)}else{var _;if(h===CCB_TARGETTYPE_DOCUMENTROOT)_=this._rootNode;else if(h===CCB_TARGETTYPE_OWNER)_=this._owner;if(_!=null){if(l.length>0){var f=0;if(_.onResolveCCBCCCallFuncSelector!=null)f=_.onResolveCCBCCCallFuncSelector(_,l);if(f===0)cc.log("Skipping selector '"+l+"' since no CCBSelectorResolver is present.");else i.push(cc.callFunc(f,_))}else{cc.log("Unexpected empty selector.")}}}}if(i.length<1)return null;return cc.sequence(i)},getActionForSoundChannel:function(t){var e=0;var i=[];var n=t.getKeyframes();var r=n.length;for(var s=0;s<r;++s){var a=n[s];var o=a.getTime()-e;e=a.getTime();if(o>0){i.push(cc.delayTime(o))}var c=a.getValue();var l=cc.BuilderReader.getResourcePath()+c[0];var h=parseFloat(c[1]),u=parseFloat(c[2]),d=parseFloat(c[3]);i.push(cc.BuilderSoundEffect.create(l,h,u,d))}if(i.length<1)return null;return cc.sequence(i)},runAnimationsForSequenceNamed:function(t){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),0)},runAnimationsForSequenceNamedTweenDuration:function(t,e){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),e)},runAnimationsForSequenceIdTweenDuration:function(t,e){if(t===-1)throw new Error("cc.BuilderAnimationManager.runAnimationsForSequenceIdTweenDuration(): Sequence id should not be -1");e=e||0;this._rootNode.stopAllActions();var i=this._nodeSequences.allKeys();for(var n=0,r=i.length;n<r;n++){var s=i[n];s.stopAllActions();var a=this._nodeSequences.objectForKey(s);var o=a.objectForKey(t);var c;var l=[];if(o){var h=o.allKeys();for(c=0;c<h.length;c++){var u=h[c];var d=o.objectForKey(u);l.push(u);this._setFirstFrame(s,d,e);this._runAction(s,d,e)}}var _=this._baseValues.objectForKey(s);if(_){var f=_.allKeys();for(c=0;c<f.length;c++){var p=f[c];if(l.indexOf(p)===-1){var m=_.objectForKey(p);if(m!=null)this._setAnimatedProperty(p,s,m,e)}}}}var g=this._getSequence(t);var v=cc.sequence(cc.delayTime(g.getDuration()+e),cc.callFunc(this._sequenceCompleted,this));this._rootNode.runAction(v);var y;if(g.getCallbackChannel()){y=this.getActionForCallbackChannel(g.getCallbackChannel());if(y){this._rootNode.runAction(y)}}if(g.getSoundChannel()){y=this.getActionForSoundChannel(g.getSoundChannel());if(y){this._rootNode.runAction(y)}}this._runningSequence=this._getSequence(t)},runAnimations:function(t,e){e=e||0;var i;if(cc.isString(t))i=this._getSequenceId(t);else i=t;this.runAnimationsForSequenceIdTweenDuration(i,e)},setAnimationCompletedCallback:function(t,e){this._target=t;this._animationCompleteCallbackFunc=e},setCompletedAnimationCallback:function(t,e){this.setAnimationCompletedCallback(t,e)},setCallFunc:function(t,e){this._keyframeCallFuncs[e]=t},debug:function(){},_getBaseValue:function(t,e){var i=this._baseValues.objectForKey(t);if(i)return i.objectForKey(e);return null},_getSequenceId:function(t){var e=null;var i=this._sequences;for(var n=0,r=i.length;n<r;n++){e=i[n];if(e&&e.getName()===t)return e.getSequenceId()}return-1},_getSequence:function(t){var e=null;var i=this._sequences;for(var n=0,r=i.length;n<r;n++){e=i[n];if(e&&e.getSequenceId()===t)return e}return null},_getAction:function(t,e,i,n){var r=e.getTime()-(t?t.getTime():0);var s,a,o,c,l;if(i==="rotation"){return cc.BuilderRotateTo.create(r,e.getValue())}else if(i==="rotationX"){return cc.BuilderRotateXTo.create(r,e.getValue())}else if(i==="rotationY"){return cc.BuilderRotateYTo.create(r,e.getValue())}else if(i==="opacity"){return cc.fadeTo(r,e.getValue())}else if(i==="color"){var h=e.getValue().getColor();return cc.tintTo(r,h.r,h.g,h.b)}else if(i==="visible"){var u=e.getValue();if(u){return cc.sequence(cc.delayTime(r),cc.show())}else{return cc.sequence(cc.delayTime(r),cc.hide())}}else if(i==="displayFrame"){return cc.sequence(cc.delayTime(r),cc.BuilderSetSpriteFrame.create(e.getValue()))}else if(i==="position"){s=this._getBaseValue(n,i);a=s[2];o=e.getValue();c=o[0];l=o[1];var d=this.getContainerSize(n.getParent());var _=cc._getAbsolutePosition(c,l,a,d,i);return cc.moveTo(r,_)}else if(i==="scale"){s=this._getBaseValue(n,i);a=s[2];o=e.getValue();c=o[0];l=o[1];if(a===CCB_SCALETYPE_MULTIPLY_RESOLUTION){var f=cc.BuilderReader.getResolutionScale();c*=f;l*=f}return cc.scaleTo(r,c,l)}else if(i==="skew"){o=e.getValue();c=o[0];l=o[1];return cc.skewTo(r,c,l)}else{cc.log("BuilderReader: Failed to create animation for property: "+i)}return null},_setAnimatedProperty:function(t,e,i,n){if(n>0){var r=new cc.BuilderKeyframe;r.setValue(i);r.setTime(n);r.setEasingType(CCB_KEYFRAME_EASING_LINEAR);var s=this._getAction(null,r,t,e);e.runAction(s)}else{var a,o,c,l;if(t==="position"){a=this._getBaseValue(e,t);o=a[2];c=i[0];l=i[1];e.setPosition(cc._getAbsolutePosition(c,l,o,this.getContainerSize(e.getParent()),t))}else if(t==="scale"){a=this._getBaseValue(e,t);o=a[2];c=i[0];l=i[1];cc.setRelativeScale(e,c,l,o,t)}else if(t==="skew"){c=i[0];l=i[1];e.setSkewX(c);e.setSkewY(l)}else{if(t==="rotation"){e.setRotation(i)}else if(t==="rotationX"){e.setRotationSkewX(i)}else if(t==="rotationY"){e.setRotationSkewY(i)}else if(t==="opacity"){e.setOpacity(i)}else if(t==="displayFrame"){e.setSpriteFrame(i)}else if(t==="color"){var h=i.getColor();if(h.r!==255||h.g!==255||h.b!==255){e.setColor(h)}}else if(t==="visible"){i=i||false;e.setVisible(i)}else{cc.log("unsupported property name is "+t)}}}},_setFirstFrame:function(t,e,i){var n=e.getKeyframes();if(n.length===0){var r=this._getBaseValue(t,e.getName());if(!r)cc.log("cc.BuilderAnimationManager._setFirstFrame(): No baseValue found for property");this._setAnimatedProperty(e.getName(),t,r,i)}else{var s=n[0];this._setAnimatedProperty(e.getName(),t,s.getValue(),i)}},_getEaseAction:function(t,e,i){if(e===CCB_KEYFRAME_EASING_LINEAR||e===CCB_KEYFRAME_EASING_INSTANT){return t}else if(e===CCB_KEYFRAME_EASING_CUBIC_IN){return t.easing(cc.easeIn(i))}else if(e===CCB_KEYFRAME_EASING_CUBIC_OUT){return t.easing(cc.easeOut(i))}else if(e===CCB_KEYFRAME_EASING_CUBIC_INOUT){return t.easing(cc.easeInOut(i))}else if(e===CCB_KEYFRAME_EASING_BACK_IN){return t.easing(cc.easeBackIn())}else if(e===CCB_KEYFRAME_EASING_BACK_OUT){return t.easing(cc.easeBackOut())}else if(e===CCB_KEYFRAME_EASING_BACK_INOUT){return t.easing(cc.easeBackInOut())}else if(e===CCB_KEYFRAME_EASING_BOUNCE_IN){return t.easing(cc.easeBounceIn())}else if(e===CCB_KEYFRAME_EASING_BOUNCE_OUT){return t.easing(cc.easeBounceOut())}else if(e===CCB_KEYFRAME_EASING_BOUNCE_INOUT){return t.easing(cc.easeBounceInOut())}else if(e===CCB_KEYFRAME_EASING_ELASTIC_IN){return t.easing(cc.easeElasticIn(i))}else if(e===CCB_KEYFRAME_EASING_ELASTIC_OUT){return t.easing(cc.easeElasticOut(i))}else if(e===CCB_KEYFRAME_EASING_ELASTIC_INOUT){return t.easing(cc.easeElasticInOut(i))}else{cc.log("BuilderReader: Unkown easing type "+e);return t}},_runAction:function(t,e,i){var n=e.getKeyframes();var r=n.length;if(r>1){var s=[];var a=n[0];var o=a.getTime()+i;if(o>0){s.push(cc.delayTime(o))}for(var c=0;c<r-1;++c){var l=n[c];var h=n[c+1];var u=this._getAction(l,h,e.getName(),t);if(u){u=this._getEaseAction(u,l.getEasingType(),l.getEasingOpt());s.push(u)}}t.runAction(cc.sequence(s))}},_sequenceCompleted:function(){var t=this._runningSequence;var e=t.getName();if(this._lastCompletedSequenceName!=t.getName()){this._lastCompletedSequenceName=t.getName()}var i=t.getChainedSequenceId();this._runningSequence=null;if(i!==-1)this.runAnimations(i,0);if(this._delegate)this._delegate.completedAnimationSequenceNamed(e);if(this._target&&this._animationCompleteCallbackFunc){this._animationCompleteCallbackFunc.call(this._target)}}});cc.BuilderSetSpriteFrame=cc.ActionInstant.extend({_spriteFrame:null,initWithSpriteFrame:function(t){this._spriteFrame=t;return true},update:function(t){this.target.setSpriteFrame(this._spriteFrame)}});cc.BuilderSetSpriteFrame.create=function(t){var e=new cc.BuilderSetSpriteFrame;if(e){if(e.initWithSpriteFrame(t))return e}return null};cc.BuilderRotateTo=cc.ActionInterval.extend({_startAngle:0,_dstAngle:0,_diffAngle:0,initWithDuration:function(t,e){if(cc.ActionInterval.prototype.initWithDuration.call(this,t)){this._dstAngle=e;return true}else{return false}},update:function(t){this.target.setRotation(this._startAngle+this._diffAngle*t)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);this._startAngle=this.target.getRotation();this._diffAngle=this._dstAngle-this._startAngle}});cc.BuilderRotateTo.create=function(t,e){var i=new cc.BuilderRotateTo;if(i){if(i.initWithDuration(t,e))return i}return null};cc.BuilderRotateXTo=cc.ActionInterval.extend({});cc.BuilderRotateXTo.create=function(t,e){throw new Error("rotationX has not been implemented in cocos2d-html5")};cc.BuilderRotateYTo=cc.ActionInterval.extend({});cc.BuilderRotateYTo.create=function(t,e){throw new Error("rotationY has not been implemented in cocos2d-html5")};cc.BuilderSoundEffect=cc.ActionInstant.extend({init:function(t){this._file=t;return true},update:function(t){cc.audioEngine.playEffect(this._file)}});cc.BuilderSoundEffect.create=function(t,e,i,n){var r=new cc.BuilderSoundEffect;if(r&&r.init(t)){return r}return null};cc.DOM={};cc.DOM._addMethods=function(t){for(var e in cc.DOM.methods){t[e]=cc.DOM.methods[e]}cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX);cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY);cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth);cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight);cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX);cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY);cc.defineGetterSetter(t,"scale",t.getScale,t.setScale);cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX);cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY);cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation);cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX);cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY);cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible);cc.defineGetterSetter(t,"parent",t.getParent,t.setParent);cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity)};cc.DOM.methods={setPosition:function(t,e){if(e===undefined){this._position.x=t.x;this._position.y=t.y}else{this._position.x=t;this._position.y=e}this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(t){this._position.y=t;this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(t){this._position.x=t;this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setScale:function(t,e){this._scaleX=t;this._scaleY=e||t;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(t){this._scaleX=t;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(t){this._scaleY=t;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(t,e){var i=this._renderCmd;var n=this._anchorPoint;if(e===undefined){n.x=t.x;n.y=t.y}else{n.x=t;n.y=e}var r=i._anchorPointInPoints,s=this._contentSize;r.x=s.width*n.x;r.y=s.height*n.y;this.dom.style[cc.$.pfx+"TransformOrigin"]=""+r.x+"px "+-r.y+"px";if(this.ignoreAnchor){this.dom.style.marginLeft=0;this.dom.style.marginBottom=0}else{this.dom.style.marginLeft=this.isToggler?0:-r.x+"px";this.dom.style.marginBottom=-r.y+"px"}this.setNodeDirty()},_setAnchorX:function(t){var e=this._anchorPoint;var i=this._renderCmd;if(t===e.x)return;e.x=t;var n=i._anchorPointInPoints,r=this._contentSize;n.x=r.width*e.x;this.dom.style[cc.$.pfx+"TransformOrigin"]=""+n.x+"px "+-n.y+"px";if(this.ignoreAnchor){this.dom.style.marginLeft=0;this.dom.style.marginBottom=0}else{this.dom.style.marginLeft=this.isToggler?0:-n.x+"px"}this.setNodeDirty()},_setAnchorY:function(t){var e=this._anchorPoint;var i=this._renderCmd;if(t===e.y)return;e.y=t;var n=i._anchorPointInPoints,r=this._contentSize;n.y=r.height*e.y;this.dom.style[cc.$.pfx+"TransformOrigin"]=""+n.x+"px "+-n.y+"px";if(this.ignoreAnchor){this.dom.style.marginLeft=0;this.dom.style.marginBottom=0}else{this.dom.style.marginBottom=-n.y+"px"}this.setNodeDirty()},setContentSize:function(t,e){var i=this._renderCmd;var n=this._contentSize;if(e===undefined){n.width=t.width;n.height=t.height}else{n.width=t;n.height=e}var r=i._anchorPointInPoints,s=this._anchorPoint;r.x=n.width*s.x;r.y=n.height*s.y;this.dom.width=n.width;this.dom.height=n.height;this.setAnchorPoint(this.getAnchorPoint());if(this.canvas){this.canvas.width=n.width;this.canvas.height=n.height}this.setNodeDirty();this.redraw()},_setWidth:function(t){var e=this._contentSize;var i=this._renderCmd;if(t===e.width)return;e.width=t;var n=i._anchorPointInPoints,r=this._anchorPoint;n.x=e.width*r.x;this.dom.width=e.width;this.anchorX=r.x;if(this.canvas){this.canvas.width=e.width}this.setNodeDirty();this.redraw()},_setHeight:function(t){var e=this._contentSize;var i=this._renderCmd;if(t===e.height)return;e.height=t;var n=i._anchorPointInPoints,r=this._anchorPoint;n.y=e.height*r.y;this.dom.height=e.height;this.anchorY=r.y;if(this.canvas){this.canvas.height=e.height}this.setNodeDirty();this.redraw()},setRotation:function(t){if(this._rotation===t)return;this._rotationX=this._rotationY=t;this.setNodeDirty();this.dom.rotate(t)},setSkewX:function(t){this._skewX=t;this.setNodeDirty();this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(t){this._skewY=t;this.setNodeDirty();this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(t){this._visible=t;this.setNodeDirty();if(this.dom)this.dom.style.display=t?"block":"none"},_setLocalZOrder:function(t){this._localZOrder=t;this.setNodeDirty();if(this.dom)this.dom.zIndex=t},setParent:function(t){this._parent=t;if(t!==null){t.setAnchorPoint(t.getAnchorPoint());this.setNodeDirty();cc.DOM.parentDOM(this)}},resume:function(){this.getScheduler().resumeTarget(this);this.getActionManager().resumeTarget(this);cc.eventManager.resumeTarget(this);if(this.dom&&!this.dom.parentNode){if(!this.getParent()){if(this.dom.id===""){cc.DOM._createEGLViewDiv(this)}else{this.dom.appendTo(cc.container)}}else{cc.DOM.parentDOM(this)}}if(this.dom)this.dom.style.visibility="visible"},pause:function(){this.getScheduler().pauseTarget(this);this.getActionManager().pauseTarget(this);cc.eventManager.pauseTarget(this);if(this.dom){this.dom.style.visibility="hidden"}},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup);if(this.dom){this.dom.remove()}},setOpacity:function(t){this._opacity=t;this.dom.style.opacity=t/255},redraw:function(){if(this.isSprite){var t=this._children;this._children=[];cc.Sprite.prototype.visit.call(this,this.ctx);this._children=t}else{cc.Sprite.prototype.visit.call(this,this.ctx)}}};cc.DOM._resetEGLViewDiv=function(){var t=cc.$("#EGLViewDiv");if(t){var e=cc.view;var i=e.getDesignResolutionSize();var n=e.getViewPortRect();var r=e.getFrameSize();var s=e.getDevicePixelRatio();var a=i.width,o=i.height;if(i.width===0&&i.height===0){a=r.width;o=r.height}var c=n.width/s;if(n.width===0&&n.height===0){c=r.width}t.style.position="absolute";t.style.width=a+"px";t.style.maxHeight=o+"px";t.style.margin=0;t.resize(e.getScaleX()/s,e.getScaleY()/s);if(e.getResolutionPolicy()===e._rpNoBorder){t.style.left=(e.getFrameSize().width-a)/2+"px";t.style.bottom=(e.getFrameSize().height-o*e.getScaleY()/s)/2+"px"}else{t.style.left=(a*e.getScaleX()/s-a)/2+"px";t.style.bottom="0px"}}};cc.DOM.parentDOM=function(t){var e=t.getParent();if(!e||!t.dom)return false;if(!e.dom){cc.DOM.placeHolder(e);e.setParent=cc.DOM.methods.setParent}t.dom.appendTo(e.dom);e.setAnchorPoint(e.getAnchorPoint());if(e.getParent()){cc.DOM.parentDOM(e)}else{if(e.isRunning()){var i=cc.$("#EGLViewDiv");if(i){e.dom.appendTo(i)}else{cc.DOM._createEGLViewDiv(e)}}}return true};cc.DOM._createEGLViewDiv=function(t){var e=cc.$("#EGLViewDiv");if(!e){e=cc.$new("div");e.id="EGLViewDiv"}var i=cc.view;var n=i.getDesignResolutionSize();var r=i.getViewPortRect();var s=i.getFrameSize();var a=i.getDevicePixelRatio();var o=n.width,c=n.height;if(n.width===0&&n.height===0){o=s.width;c=s.height}var l=r.width/a;if(r.width===0&&r.height===0){l=s.width}e.style.position="absolute";e.style.width=o+"px";e.style.maxHeight=c+"px";e.style.margin=0;e.resize(i.getScaleX()/a,i.getScaleY()/a);if(i.getResolutionPolicy()===i._rpNoBorder){e.style.left=(s.width-o)/2+"px";e.style.bottom=(s.height-c*i.getScaleY()/a)/2+"px"}else{e.style.left=(o*i.getScaleX()/a-o)/2+"px";e.style.bottom="0px"}t.dom.appendTo(e);e.appendTo(cc.container)};cc.DOM.setTransform=function(t){if(t.ctx){t.ctx.translate(t.getAnchorPointInPoints().x,t.getAnchorPointInPoints().y);if(t.isSprite){var e=t._children;t._children=[];cc.Sprite.prototype.visit.call(t);t._children=e}else{cc.Sprite.prototype.visit.call(t)}}if(t.dom){t.dom.position.x=t.getPositionX();t.dom.position.y=-t.getPositionY();t.dom.rotation=t.getRotation();t.dom.scale={x:t.getScaleX(),y:t.getScaleY()};t.dom.skew={x:t.getSkewX(),y:t.getSkewY()};if(t.setAnchorPoint)t.setAnchorPoint(t.getAnchorPoint());t.dom.transforms()}};cc.DOM.forSprite=function(t){t.dom=cc.$new("div");t.canvas=cc.$new("canvas");var e=t.getContentSize();t.canvas.width=e.width;t.canvas.height=e.height;t.dom.style.position="absolute";t.dom.style.bottom=0;t.ctx=t.canvas.getContext("2d");t.dom.appendChild(t.canvas);if(t.getParent()){cc.DOM.parentDOM(t)}t.isSprite=true};cc.DOM.placeHolder=function(t){t.dom=cc.$new("div");t.placeholder=true;t.dom.style.position="absolute";t.dom.style.bottom=0;t.dom.style.width=(t.getContentSize().width||cc.director.getWinSize().width)+"px";t.dom.style.maxHeight=(t.getContentSize().height||cc.director.getWinSize().height)+"px";t.dom.style.margin=0;cc.DOM.setTransform(t);t.dom.transforms();cc.DOM._addMethods(t)};cc.DOM.convert=function(t){if(arguments.length>1){cc.DOM.convert(arguments);return}else if(arguments.length===1&&!arguments[0].length){cc.DOM.convert([arguments[0]]);return}var e=arguments[0];for(var i=0;i<e.length;i++){if(e[i]instanceof cc.Sprite){if(!e[i].dom)cc.DOM.forSprite(e[i])}else{cc.log("DOM converter only supports sprite and menuitems yet")}cc.DOM._addMethods(e[i]);e[i].visit=function(){};e[i].transform=function(){};cc.DOM.setTransform(e[i]);e[i].setVisible(e[i].isVisible())}};cc.KEYBOARD_RETURNTYPE_DEFAULT=0;cc.KEYBOARD_RETURNTYPE_DONE=1;cc.KEYBOARD_RETURNTYPE_SEND=2;cc.KEYBOARD_RETURNTYPE_SEARCH=3;cc.KEYBOARD_RETURNTYPE_GO=4;cc.EDITBOX_INPUT_MODE_ANY=0;cc.EDITBOX_INPUT_MODE_EMAILADDR=1;cc.EDITBOX_INPUT_MODE_NUMERIC=2;cc.EDITBOX_INPUT_MODE_PHONENUMBER=3;cc.EDITBOX_INPUT_MODE_URL=4;cc.EDITBOX_INPUT_MODE_DECIMAL=5;cc.EDITBOX_INPUT_MODE_SINGLELINE=6;cc.EDITBOX_INPUT_FLAG_PASSWORD=0;cc.EDITBOX_INPUT_FLAG_SENSITIVE=1;cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2;cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3;cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4;cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(t){},editBoxEditingDidEnd:function(t){},editBoxTextChanged:function(t,e){},editBoxReturn:function(t){}});cc.EditBox=cc.ControlButton.extend({_domInputSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_text:"",_placeholderText:"",_textColor:null,_placeholderColor:null,_maxLength:50,_adjustHeight:18,_edTxt:null,_edFontSize:14,_edFontName:"Arial",_placeholderFontName:"",_placeholderFontSize:14,_tooltip:false,_className:"EditBox",_onCanvasClick:null,_inputEvent:null,_keyPressEvent:null,_focusEvent:null,_blurEvent:null,ctor:function(t,e,i,n){cc.ControlButton.prototype.ctor.call(this);this._textColor=cc.color.WHITE;this._placeholderColor=cc.color.GRAY;this.setContentSize(t);var r=this._domInputSprite=new cc.Sprite;r.draw=function(){};this.addChild(r);var s=this._edTxt=document.createElement("input");s.type="text";s.style.fontSize=this._edFontSize+"px";s.style.color="#000000";s.style.border=0;s.style.background="transparent";s.style.width="100%";s.style.height="100%";s.style.active=0;s.style.outline="medium";s.style.padding="0";var a=function(){this._edTxt.blur()};this._onCanvasClick=a.bind(this);var o=function(){if(this._delegate&&this._delegate.editBoxTextChanged)this._delegate.editBoxTextChanged(this,this._edTxt.value)};this._inputEvent=o.bind(this);var c=function(t){if(t.keyCode===cc.KEY.enter){t.stopPropagation();t.preventDefault();if(this._delegate&&this._delegate.editBoxReturn)this._delegate.editBoxReturn(this);cc._canvas.focus()}};this._keyPressEvent=c.bind(this);var l=function(){if(this._edTxt.value===this._placeholderText){this._edTxt.value="";this._edTxt.style.fontSize=this._edFontSize+"px";this._edTxt.style.color=cc.colorToHex(this._textColor);if(this._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD)this._edTxt.type="password";else this._edTxt.type="text"}if(this._delegate&&this._delegate.editBoxEditingDidBegin)this._delegate.editBoxEditingDidBegin(this);cc._canvas.addEventListener("click",this._onCanvasClick)};this._focusEvent=l.bind(this);var h=function(){if(this._edTxt.value===""){this._edTxt.value=this._placeholderText;this._edTxt.style.fontSize=this._placeholderFontSize+"px";this._edTxt.style.color=cc.colorToHex(this._placeholderColor);this._edTxt.type="text"}if(this._delegate&&this._delegate.editBoxEditingDidEnd)this._delegate.editBoxEditingDidEnd(this);cc._canvas.removeEventListener("click",this._onCanvasClick)};this._blurEvent=h.bind(this);s.addEventListener("input",this._inputEvent);s.addEventListener("keypress",this._keyPressEvent);s.addEventListener("focus",this._focusEvent);s.addEventListener("blur",this._blurEvent);cc.DOM.convert(r);r.dom.appendChild(s);r.dom.showTooltipDiv=false;r.dom.style.width=t.width-6+"px";r.dom.style.height=t.height-6+"px";r.canvas.remove();if(this.initWithSizeAndBackgroundSprite(t,e)){if(i)this.setBackgroundSpriteForState(i,cc.CONTROL_STATE_HIGHLIGHTED);if(n)this.setBackgroundSpriteForState(n,cc.CONTROL_STATE_DISABLED)}},setFont:function(t,e){this._edFontSize=e;this._edFontName=t;this._setFontToEditBox()},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);if(e){this._edFontSize=parseInt(e[1]);this._edFontName=e[2];this._setFontToEditBox()}},setFontName:function(t){this._edFontName=t;this._setFontToEditBox()},setFontSize:function(t){this._edFontSize=t;this._setFontToEditBox()},_setFontToEditBox:function(){if(this._edTxt.value!==this._placeholderText){this._edTxt.style.fontFamily=this._edFontName;this._edTxt.style.fontSize=this._edFontSize+"px";if(this._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD)this._edTxt.type="password";else this._edTxt.type="text"}},setText:function(t){cc.log("Please use the setString");this.setString(t)},setString:function(t){if(t!=null){if(t===""){this._edTxt.value=this._placeholderText;this._edTxt.style.color=cc.colorToHex(this._placeholderColor);this._edTxt.type="text"}else{this._edTxt.value=t;this._edTxt.style.color=cc.colorToHex(this._textColor);if(this._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD)this._edTxt.type="password";else this._edTxt.type="text"}}},setFontColor:function(t){this._textColor=t;if(this._edTxt.value!==this._placeholderText){this._edTxt.style.color=cc.colorToHex(t)}},setMaxLength:function(t){if(!isNaN(t)&&t>0){this._maxLength=t;this._edTxt.maxLength=t}},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){if(t!=null){var e=this._placeholderText;this._placeholderText=t;if(this._edTxt.value===e){this._edTxt.value=t;this._edTxt.style.color=cc.colorToHex(this._placeholderColor);this._setPlaceholderFontToEditText()}}},setPlaceholderFont:function(t,e){this._placeholderFontName=t;this._placeholderFontSize=e;this._setPlaceholderFontToEditText()},_setPlaceholderFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);if(e){this._placeholderFontName=e[2];this._placeholderFontSize=parseInt(e[1]);this._setPlaceholderFontToEditText()}},setPlaceholderFontName:function(t){this._placeholderFontName=t;this._setPlaceholderFontToEditText()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t;this._setPlaceholderFontToEditText()},_setPlaceholderFontToEditText:function(){if(this._edTxt.value===this._placeholderText){this._edTxt.style.fontFamily=this._placeholderFontName;this._edTxt.style.fontSize=this._placeholderFontSize+"px";this._edTxt.type="text"}},setPlaceholderFontColor:function(t){this._placeholderColor=t;if(this._edTxt.value===this._placeholderText){this._edTxt.style.color=cc.colorToHex(t)}},setInputFlag:function(t){this._editBoxInputFlag=t;if(this._edTxt.value!==this._placeholderText&&t===cc.EDITBOX_INPUT_FLAG_PASSWORD)this._edTxt.type="password";else this._edTxt.type="text"},getText:function(){cc.log("Please use the getString");return this._edTxt.value},getString:function(){if(this._edTxt.value===this._placeholderText)return"";return this._edTxt.value},initWithSizeAndBackgroundSprite:function(t,e){if(this.initWithBackgroundSprite(e)){this._domInputSprite.x=3;this._domInputSprite.y=3;this.setZoomOnTouchDown(false);this.setPreferredSize(t);this.x=0;this.y=0;this._addTargetWithActionForControlEvent(this,this.touchDownAction,cc.CONTROL_EVENT_TOUCH_UP_INSIDE);return true}return false},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){this._editBoxInputMode=t},setReturnType:function(t){this._keyboardReturnType=t},keyboardWillShow:function(t){var e=cc.EditBox.getRect(this);e.y-=4;if(!e.intersectsRect(t.end)){cc.log("needn't to adjust view layout.");return}this._adjustHeight=t.end.getMaxY()-e.getMinY()},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){},touchDownAction:function(t,e){},initWithBackgroundColor:function(t,e){this._edWidth=t.width;this.dom.style.width=this._edWidth.toString()+"px";this._edHeight=t.height;this.dom.style.height=this._edHeight.toString()+"px";this.dom.style.backgroundColor=cc.colorToHex(e)},cleanup:function(){this._edTxt.removeEventListener("input",this._inputEvent);this._edTxt.removeEventListener("keypress",this._keyPressEvent);this._edTxt.removeEventListener("focus",this._focusEvent);this._edTxt.removeEventListener("blur",this._blurEvent);cc._canvas.removeEventListener("click",this._onCanvasClick);this._super()}});var _p=cc.EditBox.prototype;_p.font;cc.defineGetterSetter(_p,"font",null,_p._setFont);_p.fontName;cc.defineGetterSetter(_p,"fontName",null,_p.setFontName);_p.fontSize;cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize);_p.fontColor;cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor);_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.maxLength;cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);_p.placeHolder;cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);_p.placeHolderFont;cc.defineGetterSetter(_p,"placeHolderFont",null,_p._setPlaceholderFont);_p.placeHolderFontName;cc.defineGetterSetter(_p,"placeHolderFontName",null,_p.setPlaceholderFontName);
_p.placeHolderFontSize;cc.defineGetterSetter(_p,"placeHolderFontSize",null,_p.setPlaceholderFontSize);_p.placeHolderFontColor;cc.defineGetterSetter(_p,"placeHolderFontColor",null,_p.setPlaceholderFontColor);_p.inputFlag;cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag);_p.delegate;cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate);_p.inputMode;cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode);_p.returnType;cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType);_p=null;cc.EditBox.getRect=function(t){var e=t.getContentSize();var i=cc.rect(0,0,e.width,e.height);return cc.rectApplyAffineTransform(i,t.getNodeToWorldTransform())};cc.EditBox.create=function(t,e,i,n){return new cc.EditBox(t,e,i,n)};cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:false,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=true;this._protectedChildren.push(t);t._setLocalZOrder(e)},ctor:function(){cc.Node.prototype.ctor.call(this);this._protectedChildren=[]},addProtectedChild:function(t,e,i){cc.assert(t!=null,"child must be non-nil");cc.assert(!t.parent,"child already added. It can't be added again");e=e||t.getLocalZOrder();if(i)t.setTag(i);this._insertProtectedChild(t,e);t.setParent(this);t.setOrderOfArrival(cc.s_globalOrderOfArrival);if(this._running){t.onEnter();if(this._isTransitionFinished)t.onEnterTransitionDidFinish()}if(this._cascadeColorEnabled)this._renderCmd.setCascadeColorEnabledDirty();if(this._cascadeOpacityEnabled)this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag");var e=this._protectedChildren;for(var i=0,n=e.length;i<n;i++)if(e.getTag()===t)return e[i];return null},removeProtectedChild:function(t,e){if(e==null)e=true;var i=this._protectedChildren;if(i.length===0)return;var n=i.indexOf(t);if(n>-1){if(this._running){t.onExitTransitionDidStart();t.onExit()}if(e)t.cleanup();t.setParent(null);i.splice(n,1)}},removeProtectedChildByTag:function(t,e){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag");if(e==null)e=true;var i=this.getProtectedChildByTag(t);if(i==null)cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",t);else this.removeProtectedChild(i,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(true)},removeAllProtectedChildrenWithCleanup:function(t){if(t==null)t=true;var e=this._protectedChildren;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(this._running){r.onExitTransitionDidStart();r.onExit()}if(t)r.cleanup();r.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){cc.assert(t!=null,"Child must be non-nil");this._reorderProtectedChildDirty=true;t.setOrderOfArrival(cc.s_globalOrderOfArrival++);t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var t=this._protectedChildren;var e=t.length,i,n,r;for(i=1;i<e;i++){r=t[i];n=i-1;while(n>=0){if(r._localZOrder<t[n]._localZOrder){t[n+1]=t[n]}else if(r._localZOrder===t[n]._localZOrder&&r.arrivalOrder<t[n].arrivalOrder){t[n+1]=t[n]}else break;n--}t[n+1]=r}this._reorderProtectedChildDirty=false}},_changePosition:function(){},cleanup:function(){cc.Node.prototype.cleanup.call(this);var t=this._protectedChildren;for(var e=0,i=t.length;e<i;e++)t[e].cleanup()},onEnter:function(){cc.Node.prototype.onEnter.call(this);var t=this._protectedChildren;for(var e=0,i=t.length;e<i;e++)t[e].onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);var t=this._protectedChildren;for(var e=0,i=t.length;e<i;e++)t[e].onEnterTransitionDidFinish()},onExit:function(){cc.Node.prototype.onExit.call(this);var t=this._protectedChildren;for(var e=0,i=t.length;e<i;e++)t[e].onExit()},onExitTransitionDidStart:function(){cc.Node.prototype.onExitTransitionDidStart.call(this);var t=this._protectedChildren;for(var e=0,i=t.length;e<i;e++)t[e].onExitTransitionDidStart()},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.ProtectedNode.CanvasRenderCmd(this);else return new cc.ProtectedNode.WebGLRenderCmd(this)}});cc.ProtectedNode.create=function(){return new cc.ProtectedNode};(function(){cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(t){var e=this._node;var i=this._displayedColor,n=e._realColor;var r,s,a,o;if(this._cascadeColorEnabledDirty&&!e._cascadeColorEnabled){i.r=n.r;i.g=n.g;i.b=n.b;var c=new cc.Color(255,255,255,255);a=e._children;for(r=0,s=a.length;r<s;r++){o=a[r];if(o&&o._renderCmd)o._renderCmd._updateDisplayColor(c)}this._cascadeColorEnabledDirty=false}else{if(t===undefined){var l=e._parent;if(l&&l._cascadeColorEnabled)t=l.getDisplayedColor();else t=cc.color.WHITE}i.r=0|n.r*t.r/255;i.g=0|n.g*t.g/255;i.b=0|n.b*t.b/255;if(e._cascadeColorEnabled){a=e._children;for(r=0,s=a.length;r<s;r++){o=a[r];if(o&&o._renderCmd){o._renderCmd._updateDisplayColor(i);o._renderCmd._updateColor()}}}a=e._protectedChildren;for(r=0,s=a.length;r<s;r++){o=a[r];if(o&&o._renderCmd){o._renderCmd._updateDisplayColor(i);o._renderCmd._updateColor()}}}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e=this._node;var i,n,r,s;if(this._cascadeOpacityEnabledDirty&&!e._cascadeOpacityEnabled){this._displayedOpacity=e._realOpacity;r=e._children;for(i=0,n=r.length;i<n;i++){s=r[i];if(s&&s._renderCmd)s._renderCmd._updateDisplayOpacity(255)}this._cascadeOpacityEnabledDirty=false}else{if(t===undefined){var a=e._parent;t=255;if(a&&a._cascadeOpacityEnabled)t=a.getDisplayedOpacity()}this._displayedOpacity=e._realOpacity*t/255;if(e._cascadeOpacityEnabled){r=e._children;for(i=0,n=r.length;i<n;i++){s=r[i];if(s&&s._renderCmd){s._renderCmd._updateDisplayOpacity(this._displayedOpacity);s._renderCmd._updateColor()}}}r=e._protectedChildren;for(i=0,n=r.length;i<n;i++){s=r[i];if(s&&s._renderCmd){s._renderCmd._updateDisplayOpacity(this._displayedOpacity);s._renderCmd._updateColor()}}}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_changeProtectedChild:function(t){var e=t._renderCmd,i=e._dirtyFlag,n=cc.Node._dirtyFlags;if(this._dirtyFlag&n.colorDirty)i|=n.colorDirty;if(this._dirtyFlag&n.opacityDirty)i|=n.opacityDirty;var r=i&n.colorDirty,s=i&n.opacityDirty;if(r)e._updateDisplayColor(this._displayedColor);if(s)e._updateDisplayOpacity(this._displayedOpacity);if(r||s)e._updateColor()}};cc.ProtectedNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._cachedParent=null;this._cacheDirty=false};var t=cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t);t.constructor=cc.ProtectedNode.CanvasRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;var i,n;var r=e._children,s;var a=e._children,o=e._protectedChildren;var c=a.length,l=o.length;this._syncStatus(t);e.sortAllChildren();e.sortAllProtectedChildren();var h;for(i=0;i<c;i++){s=r[i];if(s._localZOrder<0)s.visit(this);else break}for(n=0;n<l;n++){h=o[n];if(h&&h._localZOrder<0){this._changeProtectedChild(h);h.visit(this)}else break}cc.renderer.pushRenderCommand(this);for(;i<c;i++)r[i]&&r[i].visit(this);for(;n<l;n++){h=o[n];if(!h)continue;this._changeProtectedChild(h);h.visit(this)}this._dirtyFlag=0;this._cacheDirty=false};t.transform=function(t,e){var i=this._node;if(i._changePosition)i._changePosition();var n=i.getNodeToParentTransform(),r=this._worldTransform;if(t){var s=t._worldTransform;r.a=n.a*s.a+n.b*s.c;r.b=n.a*s.b+n.b*s.d;r.c=n.c*s.a+n.d*s.c;r.d=n.c*s.b+n.d*s.d;r.tx=s.a*n.tx+s.c*n.ty+s.tx;r.ty=s.d*n.ty+s.ty+s.b*n.tx}else{r.a=n.a;r.b=n.b;r.c=n.c;r.d=n.d;r.tx=n.tx;r.ty=n.ty}var a,o,c=i._children;if(e&&c&&c.length!==0){for(a=0,o=c.length;a<o;a++){c[a]._renderCmd.transform(this,e)}}c=i._protectedChildren;if(e&&c&&c.length!==0){for(a=0,o=c.length;a<o;a++){c[a]._renderCmd.transform(this,e)}}}})();(function(){if(!cc.Node.WebGLRenderCmd)return;cc.ProtectedNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,t);t.constructor=cc.ProtectedNode.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;var i,n,r=cc.current_stack;r.stack.push(r.top);this._syncStatus(t);r.top=this._stackMatrix;var s=e.grid;if(s&&s._active)s.beforeDraw();var a=e._children,o=e._protectedChildren;var c=a.length,l=o.length;e.sortAllChildren();e.sortAllProtectedChildren();var h;for(i=0;i<c;i++){if(a[i]&&a[i]._localZOrder<0)a[i].visit(this);else break}for(n=0;n<l;n++){h=o[n];if(h&&h._localZOrder<0){this._changeProtectedChild(h);h.visit(this)}else break}cc.renderer.pushRenderCommand(this);for(;i<c;i++){a[i]&&a[i].visit(this)}for(;n<l;n++){h=o[n];if(!h)continue;this._changeProtectedChild(h);h.visit(this)}if(s&&s._active)s.afterDraw(e);this._dirtyFlag=0;r.top=r.stack.pop()};t.transform=function(t,e){var i=this._node;var n=this._transform4x4,r=this._stackMatrix,s=t?t._stackMatrix:cc.current_stack.top;var a=i.getNodeToParentTransform();if(i._changePosition)i._changePosition();var o=n.mat;o[0]=a.a;o[4]=a.c;o[12]=a.tx;o[1]=a.b;o[5]=a.d;o[13]=a.ty;o[14]=i._vertexZ;cc.kmMat4Multiply(r,s,n);if(i._camera!==null&&!(i.grid!==null&&i.grid.isActive())){var c=this._anchorPointInPoints.x,l=this._anchorPointInPoints.y;var h=c!==0||l!==0;if(h){if(!cc.SPRITEBATCHNODE_RENDER_SUBPIXEL){c=0|c;l=0|l}var u=cc.math.Matrix4.createByTranslation(c,l,0,n);r.multiply(h);i._camera._locateForRenderer(r);u=cc.math.Matrix4.createByTranslation(-c,-l,0,u);r.multiply(u);n.identity()}else{i._camera._locateForRenderer(r)}}var d,_,f=i._children;if(e&&f&&f.length!==0){for(d=0,_=f.length;d<_;d++){f[d]._renderCmd.transform(this,e)}}f=i._protectedChildren;if(e&&f&&f.length!==0){for(d=0,_=f.length;d<_;d++){f[d]._renderCmd.transform(this,e)}}}})();var ccui=ccui||{};ccui.Class=ccui.Class||cc.Class;ccui.Class.extend=ccui.Class.extend||cc.Class.extend;ccui.Node=ccui.Node||cc.Node;ccui.Node.extend=ccui.Node.extend||cc.Node.extend;ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode;ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend;ccui.cocosGUIVersion="CocosGUI v1.0.0.0";ccui._FocusNavigationController=cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:false,_keyboardEventPriority:1,enableFocusNavigation:function(t){if(this._enableFocusNavigation===t)return;this._enableFocusNavigation=t;if(t)this._addKeyboardEventListener();else this._removeKeyboardEventListener()},_setFirstFocsuedWidget:function(t){this._firstFocusedWidget=t},_onKeyPressed:function(t,e){if(this._enableFocusNavigation&&this._firstFocusedWidget){if(t===cc.KEY.dpadDown){this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)}if(t===cc.KEY.dpadUp){this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)}if(t===cc.KEY.dpadLeft){this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)}if(t===cc.KEY.dpadRight){this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)}}},_addKeyboardEventListener:function(){if(!this._keyboardListener){this._keyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)});cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority)}},_removeKeyboardEventListener:function(){if(this._keyboardListener){cc.eventManager.removeEventListener(this._keyboardListener);this._keyboardListener=null}}});ccui.__LAYOUT_COMPONENT_NAME="__ui_layout";ccui.Widget=ccui.ProtectedNode.extend({_enabled:true,_bright:true,_touchEnabled:false,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:false,_focusEnabled:true,_ignoreSize:false,_affectByClipping:false,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:false,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:false,_flippedY:false,_opacity:255,_highlight:false,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:true,_unifySize:false,_callbackName:null,_callbackType:null,_usingLayoutComponent:false,_inViewRect:true,ctor:function(){cc.ProtectedNode.prototype.ctor.call(this);this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE;this._touchBeganPosition=cc.p(0,0);this._touchMovePosition=cc.p(0,0);this._touchEndPosition=cc.p(0,0);this._widgetType=ccui.Widget.TYPE_WIDGET;this._customSize=cc.size(0,0);this._layoutParameterDictionary={};this._sizeType=ccui.Widget.SIZE_ABSOLUTE;this._sizePercent=cc.p(0,0);this._positionType=ccui.Widget.POSITION_ABSOLUTE;this._positionPercent=cc.p(0,0);this._nodes=[];this._layoutParameterType=ccui.LayoutParameter.NONE;this.init()},init:function(){if(cc.ProtectedNode.prototype.init.call(this)){this._layoutParameterDictionary={};this._initRenderer();this.setBright(true);this.onFocusChanged=this.onFocusChange.bind(this);this.onNextFocusedWidget=null;this.setAnchorPoint(cc.p(.5,.5));this.ignoreContentAdaptWithSize(true);return true}return false},onEnter:function(){var t=this._touchListener;if(t&&!t._isRegistered()&&this._touchEnabled)cc.eventManager.addListener(t,this);if(!this._usingLayoutComponent)this.updateSizeAndPosition();cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate();cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);if(null==t){t=new ccui.LayoutComponent;this.addComponent(t)}return t},getWidgetParent:function(){var t=this.getParent();if(t instanceof ccui.Widget)return t;return null},_updateContentSizeWithTextureSize:function(t){if(this._unifySize){this.setContentSize(t);return}this.setContentSize(this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);if(t==null)return true;if(t&&!t.isEnabled())return false;return t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){if(this._touchListener)this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){if(this._touchListener){return this._touchListener.isSwallowTouches()}return false},_getAncensterWidget:function(t){if(null==t)return null;var e=t.getParent();if(null==e)return null;if(e instanceof ccui.Widget)return e;else return this._getAncensterWidget(e.getParent())},_isAncestorsVisible:function(t){if(null==t)return true;var e=t.getParent();if(e&&!e.isVisible())return false;return this._isAncestorsVisible(e)},_cleanupWidget:function(){this._eventDispatcher.removeEventListener(this._touchListener);this._touchEnabled=false;this._touchListener=null;if(ccui.Widget._focusedWidget===this){ccui.Widget._focusedWidget=null;ccui.Widget._focusNavigationController=null}},setEnabled:function(t){this._enabled=t},_initRenderer:function(){},setContentSize:function(t,e){var i=e===undefined?t.width:t;var n=e===undefined?t.height:e;cc.Node.prototype.setContentSize.call(this,i,n);this._customSize.width=i;this._customSize.height=n;if(this._unifySize){}else if(this._ignoreSize){this._contentSize=this.getVirtualRendererSize()}if(!this._usingLayoutComponent&&this._running){var r=this.getWidgetParent();var s=r?r.getContentSize():this._parent.getContentSize();this._sizePercent.x=s.width>0?i/s.width:0;this._sizePercent.y=s.height>0?n/s.height:0}this._onSizeChanged()},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t);this._customSize.width=t;if(this._unifySize){}else if(this._ignoreSize){this._contentSize=this.getVirtualRendererSize()}if(!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent();var i=e?e.width:this._parent.width;this._sizePercent.x=i>0?this._customSize.width/i:0}this._onSizeChanged()},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t);this._customSize.height=t;if(this._unifySize){}else if(this._ignoreSize){this._contentSize=this.getVirtualRendererSize()}if(!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent();var i=e?e.height:this._parent.height;this._sizePercent.y=i>0?this._customSize.height/i:0}this._onSizeChanged()},setSizePercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(true);e.setPercentContentSize(t);e.refreshLayout();return}this._sizePercent.x=t.x;this._sizePercent.y=t.y;var i=this._customSize.width,n=this._customSize.height;if(this._running){var r=this.getWidgetParent();if(r){i=r.width*t.x;n=r.height*t.y}else{i=this._parent.width*t.x;n=this._parent.height*t.y}}if(this._ignoreSize)this.setContentSize(this.getVirtualRendererSize());else this.setContentSize(i,n);this._customSize.width=i;this._customSize.height=n},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;if(this._running){var i=this.getWidgetParent();e=(i?i.width:this._parent.width)*t}if(this._ignoreSize)this._setWidth(this.getVirtualRendererSize().width);else this._setWidth(e);this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;if(this._running){var i=this.getWidgetParent();e=(i?i.height:this._parent.height)*t}if(this._ignoreSize)this._setHeight(this.getVirtualRendererSize().height);else this._setHeight(e);this._customSize.height=e},updateSizeAndPosition:function(t){if(!t){var e=this.getWidgetParent();if(e)t=e.getLayoutSize();else t=this._parent.getContentSize()}switch(this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:if(this._ignoreSize)this.setContentSize(this.getVirtualRendererSize());else this.setContentSize(this._customSize);this._sizePercent.x=t.width>0?this._customSize.width/t.width:0;this._sizePercent.y=t.height>0?this._customSize.height/t.height:0;break;case ccui.Widget.SIZE_PERCENT:var i=cc.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);if(this._ignoreSize)this.setContentSize(this.getVirtualRendererSize());else this.setContentSize(i);this._customSize.width=i.width;this._customSize.height=i.height;break;default:break}this._onSizeChanged();var n=this.getPosition();switch(this._positionType){case ccui.Widget.POSITION_ABSOLUTE:if(t.width<=0||t.height<=0){this._positionPercent.x=this._positionPercent.y=0}else{this._positionPercent.x=n.x/t.width;this._positionPercent.y=n.y/t.height}break;case ccui.Widget.POSITION_PERCENT:n=cc.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y);break;default:break}if(this._parent instanceof ccui.ImageView){var r=this._parent._imageRenderer;if(r&&!r._textureLoaded)return}this.setPosition(n)},setSizeType:function(t){this._sizeType=t;if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)}},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){if(this._unifySize){this.setContentSize(this._customSize);return}if(this._ignoreSize===t)return;this._ignoreSize=t;this.setContentSize(t?this.getVirtualRendererSize():this._customSize)},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._sizePercent=t.getPercentContentSize()}return this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent){var t=this.getChildren();for(var e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof ccui.Widget)n.updateSizeAndPosition()}}},setTouchEnabled:function(t){if(this._touchEnabled===t)return;this._touchEnabled=t;if(this._touchEnabled){if(!this._touchListener)this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)});cc.eventManager.addListener(this._touchListener,this)}else{cc.eventManager.removeListener(this._touchListener)}},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){if(t===this._highlight)return;this._highlight=t;if(this._bright){if(this._highlight)this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT);else this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)}else this._onPressStateChangedToDisabled()},isFocused:function(){return this._focused},setFocused:function(t){this._focused=t;if(t){ccui.Widget._focusedWidget=this;if(ccui.Widget._focusNavigationController)ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this)}},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(t)){var i=e instanceof ccui.Layout;if(this.isFocused()||i){var n=this.getParent();if(null===n||!(n instanceof ccui.Layout)){if(i)return e.findNextFocusedWidget(t,e);return e}else return n.findNextFocusedWidget(t,e)}else return e}else{var r=this.onNextFocusedWidget(t);this.dispatchFocusEvent(this,r);return r}},requestFocus:function(){if(this===ccui.Widget._focusedWidget)return;this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(t,e,i){var n=this.getWidgetParent();if(n)n.interceptTouchEvent(t,e,i)},onFocusChange:function(t,e){if(t)t.setFocused(false);if(e)e.setFocused(true)},dispatchFocusEvent:function(t,e){if(t&&!t.isFocused())t=ccui.Widget._focusedWidget;if(e!==t){if(e&&e.onFocusChanged)e.onFocusChanged(t,e);if(t&&e.onFocusChanged)t.onFocusChanged(t,e);cc.eventManager.dispatchEvent(new cc.EventFocus(t,e))}},setBright:function(t){this._bright=t;if(this._bright){this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE;this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)}else this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle===t)return;t=t||ccui.Widget.BRIGHT_STYLE_NORMAL;this._brightStyle=t;switch(this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed();break;default:break}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor());this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(t,e){this._hit=false;if(this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var i=t.getLocation();this._touchBeganPosition.x=i.x;this._touchBeganPosition.y=i.y;if(this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition))this._hit=true}if(!this._hit){return false}this.setHighlighted(true);if(this._propagateTouchEvents){this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,t)}this._pushDownEvent();return true},propagateTouchEvent:function(t,e,i){var n=this.getWidgetParent();if(n){n.interceptTouchEvent(t,e,i)}},onTouchMoved:function(t,e){var i=t.getLocation();this._touchMovePosition.x=i.x;this._touchMovePosition.y=i.y;this.setHighlighted(this.hitTest(i));if(this._propagateTouchEvents)this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,t);this._moveEvent()},onTouchEnded:function(t,e){var i=t.getLocation();this._touchEndPosition.x=i.x;this._touchEndPosition.y=i.y;if(this._propagateTouchEvents)this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,t);var n=this._highlight;this.setHighlighted(false);if(n)this._releaseUpEvent();else this._cancelUpEvent()},onTouchCancelled:function(t){this.setHighlighted(false);this._cancelUpEvent()},onTouchLongClicked:function(t){this.longClickEvent()},_pushDownEvent:function(){if(this._touchEventCallback)this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN);if(this._touchEventListener&&this._touchEventSelector)this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){if(this._touchEventCallback)this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED);if(this._touchEventListener&&this._touchEventSelector)this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){if(this._touchEventCallback)this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED);if(this._touchEventListener&&this._touchEventSelector)this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED);if(this._clickEventListener)this._clickEventListener(this)},_cancelUpEvent:function(){if(this._touchEventCallback)this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED);if(this._touchEventListener&&this._touchEventSelector)this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){if(e===undefined)this._touchEventCallback=t;else{this._touchEventSelector=t;this._touchEventListener=e}},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=false;var e=this.getParent();var i=null;while(e){if(e instanceof ccui.Layout){if(e.isClippingEnabled()){this._affectByClipping=true;i=e;break}}e=e.getParent()}if(!this._affectByClipping)return true;if(i){if(i.hitTest(t))return i.isClippingParentContainsPoint(t);return false}return true},checkChildInfo:function(t,e,i){var n=this.getWidgetParent();if(n)n.checkChildInfo(t,e,i)},setPosition:function(t,e){if(!this._usingLayoutComponent&&this._running){var i=this.getWidgetParent();if(i){var n=i.getContentSize();if(n.width<=0||n.height<=0){this._positionPercent.x=0;this._positionPercent.y=0}else{if(e===undefined){this._positionPercent.x=t.x/n.width;this._positionPercent.y=t.y/n.height}else{this._positionPercent.x=t/n.width;this._positionPercent.y=e/n.height}}}}cc.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){if(this._running){var e=this.getWidgetParent();if(e){var i=e.width;if(i<=0)this._positionPercent.x=0;else this._positionPercent.x=t/i}}cc.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){if(this._running){var e=this.getWidgetParent();if(e){var i=e.height;if(i<=0)this._positionPercent.y=0;else this._positionPercent.y=t/i}}cc.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x);e.setPositionPercentY(t.y);e.refreshLayout();return}else{this._setXPercent(t.x);this._setYPercent(t.y)}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setXPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x);e.refreshLayout();return}this._positionPercent.x=t},_setYPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentY(t.x);e.refreshLayout();return}this._positionPercent.y=t},getPositionPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX();this._positionPercent.y=t.getPositionPercentY()}return cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX();this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX();this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(t){this._positionType=t;if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();if(t===ccui.POSITION_ABSOLUTE){e.setPositionPercentXEnabled(false);e.setPositionPercentYEnabled(false)}else{e.setPositionPercentXEnabled(true);e.setPositionPercentYEnabled(true)}}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t;this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t;this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){if(!t)return;this._layoutParameterDictionary[t.getLayoutType()]=t;this._layoutParameterType=t.getLayoutType()},getLayoutParameter:function(t){t=t||this._layoutParameterType;return this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();t._copyProperties(this);t._copyClonedWidgetChildren(this);return t},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(t){var e=t.getChildren();for(var i=0;i<e.length;i++){var n=e[i];if(n instanceof ccui.Widget)this.addChild(n.clone())}},_copySpecialProperties:function(t){},_copyProperties:function(t){this.setEnabled(t.isEnabled());this.setVisible(t.isVisible());this.setBright(t.isBright());this.setTouchEnabled(t.isTouchEnabled());this.setLocalZOrder(t.getLocalZOrder());this.setTag(t.getTag());this.setName(t.getName());this.setActionTag(t.getActionTag());this._ignoreSize=t._ignoreSize;this.setContentSize(t._contentSize);this._customSize.width=t._customSize.width;this._customSize.height=t._customSize.height;this._copySpecialProperties(t);this._sizeType=t.getSizeType();this._sizePercent.x=t._sizePercent.x;this._sizePercent.y=t._sizePercent.y;this._positionType=t._positionType;this._positionPercent.x=t._positionPercent.x;this._positionPercent.y=t._positionPercent.y;this.setPosition(t.getPosition());this.setAnchorPoint(t.getAnchorPoint());this.setScaleX(t.getScaleX());this.setScaleY(t.getScaleY());this.setRotation(t.getRotation());this.setRotationX(t.getRotationX());this.setRotationY(t.getRotationY());this.setFlippedX(t.isFlippedX());this.setFlippedY(t.isFlippedY());this.setColor(t.getColor());this.setOpacity(t.getOpacity());this._touchEventCallback=t._touchEventCallback;this._touchEventListener=t._touchEventListener;this._touchEventSelector=t._touchEventSelector;
this._clickEventListener=t._clickEventListener;this._focused=t._focused;this._focusEnabled=t._focusEnabled;this._propagateTouchEvents=t._propagateTouchEvents;for(var e in t._layoutParameterDictionary){var i=t._layoutParameterDictionary[e];if(i)this.setLayoutParameter(i.clone())}this._onSizeChanged()},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},getLeftInParent:function(){cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead.");return this.getLeftBoundary()},getBottomInParent:function(){cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead.");return this.getBottomBoundary()},getRightInParent:function(){cc.log("getRightInParent is deprecated. Please use getRightBoundary instead.");return this.getRightBoundary()},getTopInParent:function(){cc.log("getTopInParent is deprecated. Please use getTopBoundary instead.");return this.getTopBoundary()},getTouchEndPos:function(){cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead.");return this.getTouchEndPosition()},getTouchMovePos:function(){cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead.");return this.getTouchMovePosition()},clippingParentAreaContainPoint:function(t){cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead.");this.isClippingParentContainsPoint(t)},getTouchStartPos:function(){cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead.");return this.getTouchBeganPosition()},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,i){if(t instanceof ccui.Widget){cc.log("Please use addChild to add a Widget.");return}cc.Node.prototype.addChild.call(this,t,e,i);this._nodes.push(t)},getNodeByTag:function(t){var e=this._nodes;for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.getTag()===t){return n}}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){cc.Node.prototype.removeChild.call(this,t,e);cc.arrayRemoveObject(this._nodes,t)},removeNodeByTag:function(t,e){var i=this.getChildByTag(t);if(!i)cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t);else this.removeChild(i,e)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];cc.Node.prototype.removeChild.call(this,e)}this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=true;var t=this._parent;while(t){if(t._doLayout){t._doLayoutDirty=true;break}else t=t._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){if(this._flippedX)t=t*-1;cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){if(this._flippedY)t=t*-1;cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){if(e===undefined)e=t;this.setScaleX(t);this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);if(this._flippedX)t=t*-1;return t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);if(this._flippedY)t=t*-1;return t},getScale:function(){if(this.getScaleX()!==this.getScaleY())cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return");return this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new ccui.Widget.WebGLRenderCmd(this);else return new ccui.Widget.CanvasRenderCmd(this)}});var _p=ccui.Widget.prototype;_p.xPercent;cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent);_p.yPercent;cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent);_p.widthPercent;cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent);_p.heightPercent;cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent);_p.widgetParent;cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent);_p.enabled;cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);_p.focused;cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused);_p.sizeType;cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType);_p.widgetType;cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType);_p.touchEnabled;cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled);_p.updateEnabled;cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled);_p.bright;cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright);_p.name;cc.defineGetterSetter(_p,"name",_p.getName,_p.setName);_p.actionTag;cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag);_p.opacity;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);_p=null;ccui.Widget.create=function(){return new ccui.Widget};ccui.Widget._focusedWidget=null;ccui.Widget._focusNavigationController=null;ccui.Widget.enableDpadNavigation=function(t){if(t){if(null==ccui.Widget._focusNavigationController){ccui.Widget._focusNavigationController=new ccui._FocusNavigationController;if(ccui.Widget._focusedWidget){ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)}}ccui.Widget._focusNavigationController.enableFocusNavigation(true)}else{if(ccui.Widget._focusNavigationController){ccui.Widget._focusNavigationController.enableFocusNavigation(false);ccui.Widget._focusNavigationController=null}}};ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget};ccui.Widget.BRIGHT_STYLE_NONE=-1;ccui.Widget.BRIGHT_STYLE_NORMAL=0;ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1;ccui.Widget.TYPE_WIDGET=0;ccui.Widget.TYPE_CONTAINER=1;ccui.Widget.LEFT=0;ccui.Widget.RIGHT=1;ccui.Widget.UP=2;ccui.Widget.DOWN=3;ccui.Widget.LOCAL_TEXTURE=0;ccui.Widget.PLIST_TEXTURE=1;ccui.Widget.TOUCH_BEGAN=0;ccui.Widget.TOUCH_MOVED=1;ccui.Widget.TOUCH_ENDED=2;ccui.Widget.TOUCH_CANCELED=3;ccui.Widget.SIZE_ABSOLUTE=0;ccui.Widget.SIZE_PERCENT=1;ccui.Widget.POSITION_ABSOLUTE=0;ccui.Widget.POSITION_PERCENT=1;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){ccui.Widget.CanvasRenderCmd=function(t){cc.ProtectedNode.CanvasRenderCmd.call(this,t);this._needDraw=false};var t=ccui.Widget.CanvasRenderCmd.prototype=Object.create(cc.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Widget.CanvasRenderCmd;t.visit=function(t){var e=this._node;if(e._visible){e._adaptRenderers();cc.ProtectedNode.CanvasRenderCmd.prototype.visit.call(this,t)}};t.transform=function(t,e){var i=this._node;if(i._visible){i._adaptRenderers();if(!this._usingLayoutComponent){var n=i.getWidgetParent();if(n){var r=n.getContentSize();if(r.width!==0&&r.height!==0){i._position.x=r.width*i._positionPercent.x;i._position.y=r.height*i._positionPercent.y}}}cc.ProtectedNode.CanvasRenderCmd.prototype.transform.call(this,t,e)}}}else{ccui.Widget.WebGLRenderCmd=function(t){cc.ProtectedNode.WebGLRenderCmd.call(this,t);this._needDraw=false};var t=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Widget.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(e._visible){e._adaptRenderers();cc.ProtectedNode.WebGLRenderCmd.prototype.visit.call(this,t)}};t.transform=function(t,e){var i=this._node;if(i._visible){i._adaptRenderers();if(!this._usingLayoutComponent){var n=i.getWidgetParent();if(n){var r=n.getContentSize();if(r.width!==0&&r.height!==0){i._position.x=r.width*i._positionPercent.x;i._position.y=r.height*i._positionPercent.y}}}cc.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e)}}}});ccui.Scale9Sprite=cc.Scale9Sprite=cc.Node.extend({_spriteRect:null,_capInsetsInternal:null,_positionsAreDirty:false,_scale9Image:null,_topLeft:null,_top:null,_topRight:null,_left:null,_centre:null,_right:null,_bottomLeft:null,_bottom:null,_bottomRight:null,_scale9Enabled:true,_brightState:0,_renderers:null,_opacityModifyRGB:false,_originalSize:null,_preferredSize:null,_opacity:0,_color:null,_capInsets:null,_insetLeft:0,_insetTop:0,_insetRight:0,_insetBottom:0,_spritesGenerated:false,_spriteFrameRotated:false,_textureLoaded:false,_className:"Scale9Sprite",_flippedX:false,_flippedY:false,textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},_updateCapInset:function(){var t,e=this._insetLeft,i=this._insetTop,n=this._insetRight;var r=this._spriteRect,s=this._insetBottom;if(e===0&&i===0&&n===0&&s===0){t=cc.rect(0,0,0,0)}else{t=this._spriteFrameRotated?cc.rect(s,e,r.width-n-e,r.height-i-s):cc.rect(e,i,r.width-e-n,r.height-i-s)}this.setCapInsets(t)},_updatePositions:function(){if(!(this._topLeft&&this._topRight&&this._bottomRight&&this._bottomLeft&&this._centre)){return}var t=this._contentSize;var e=this._topLeft,i=this._topRight,n=this._bottomRight,r=this._bottomLeft;var s=this._left,a=this._right,o=this._top,c=this._bottom;var l=this._centre,h=this._centre.getContentSize();var u=e.getContentSize();var d=r.getContentSize();var _=t.width-u.width-i.getContentSize().width;var f=t.height-u.height-n.getContentSize().height;var p=_/h.width;var m=f/h.height;var g=h.width*p;var v=h.height*m;var y=d.width;var T=d.height;var C=cc.p(this._offset.x*p,this._offset.y*m);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var S=Math.round(g);if(g!==S){g=S;p=g/h.width}var x=Math.round(v);if(v!==x){v=x;m=v/h.height}}l.setScaleX(p);l.setScaleY(m);r.setAnchorPoint(1,1);r.setPosition(y,T);n.setAnchorPoint(0,1);n.setPosition(y+g,T);e.setAnchorPoint(1,0);e.setPosition(y,T+v);i.setAnchorPoint(0,0);i.setPosition(y+g,T+v);s.setAnchorPoint(1,.5);s.setPosition(y,T+v/2+C.y);s.setScaleY(m);a.setAnchorPoint(0,.5);a.setPosition(y+g,T+v/2+C.y);a.setScaleY(m);o.setAnchorPoint(.5,0);o.setPosition(y+g/2+C.x,T+v);o.setScaleX(p);c.setAnchorPoint(.5,1);c.setPosition(y+g/2+C.x,T);c.setScaleX(p);l.setAnchorPoint(.5,.5);l.setPosition(y+g/2+C.x,T+v/2+C.y);l.setScaleX(p);l.setScaleY(m)},ctor:function(t,e,i){cc.Node.prototype.ctor.call(this);this._spriteRect=cc.rect(0,0,0,0);this._capInsetsInternal=cc.rect(0,0,0,0);this._originalSize=cc.size(0,0);this._preferredSize=cc.size(0,0);this._capInsets=cc.rect(0,0,0,0);this._renderers=[];if(t!=undefined){if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t,e);else{var n=cc.spriteFrameCache.getSpriteFrame(t);if(n!=null)this.initWithSpriteFrame(n,e);else this.initWithFile(t,e,i)}}else{this.init()}},getSprite:function(){return this._scale9Image},getOriginalSize:function(){return cc.size(this._originalSize)},getPreferredSize:function(){return cc.size(this._preferredSize)},_getPreferredWidth:function(){return this._preferredSize.width},_getPreferredHeight:function(){return this._preferredSize.height},setPreferredSize:function(t){this.setContentSize(t);this._preferredSize=t;if(this._positionsAreDirty){this._updatePositions();this._positionsAreDirty=false;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)}},_setPreferredWidth:function(t){this._setWidth(t);this._preferredSize.width=t},_setPreferredHeight:function(t){this._setHeight(t);this._preferredSize.height=t},setOpacity:function(t){cc.Node.prototype.setOpacity.call(this,t);if(this._scale9Enabled){var e=this._renderers;for(var i=0;i<e.length;i++)e[i].setOpacity(t)}else if(this._scale9Image)this._scale9Image.setOpacity(t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},setColor:function(t){cc.Node.prototype.setColor.call(this,t);if(this._scale9Enabled){var e=this._renderers;for(var i=0;i<e.length;i++){var n=e[i];if(n)n.setColor(t)}}else if(this._scale9Image)this._scale9Image.setColor(t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},getCapInsets:function(){return cc.rect(this._capInsets)},setCapInsets:function(t){var e=this._contentSize;var i=e.width,n=e.height;this.updateWithSprite(this._scale9Image,this._spriteRect,this._spriteFrameRotated,this._offset,this._originalSize,t);this._insetLeft=t.x;this._insetTop=t.y;this._insetRight=this._originalSize.width-this._insetLeft-t.width;this._insetBottom=this._originalSize.height-this._insetTop-t.height;this.setContentSize(i,n)},getInsetLeft:function(){return this._insetLeft},setInsetLeft:function(t){this._insetLeft=t;this._updateCapInset()},getInsetTop:function(){return this._insetTop},setInsetTop:function(t){this._insetTop=t;this._updateCapInset()},getInsetRight:function(){return this._insetRight},setInsetRight:function(t){this._insetRight=t;this._updateCapInset()},getInsetBottom:function(){return this._insetBottom},setInsetBottom:function(t){this._insetBottom=t;this._updateCapInset()},setContentSize:function(t,e){cc.Node.prototype.setContentSize.call(this,t,e);this._positionsAreDirty=true},setAnchorPoint:function(t,e){cc.Node.prototype.setAnchorPoint.call(this,t,e);if(!this._scale9Enabled){if(this._scale9Image){this._scale9Image.setAnchorPoint(t,e);this._positionsAreDirty=true}}},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t);this._positionsAreDirty=true},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t);this._positionsAreDirty=true},init:function(){return this.initWithBatchNode(null,cc.rect(0,0,0,0),false,cc.rect(0,0,0,0))},initWithBatchNode:function(t,e,i,n){if(n===undefined){n=i;i=false}if(t)this.updateWithBatchNode(t,e,i,n);this.setCascadeColorEnabled(true);this.setCascadeOpacityEnabled(true);this.setAnchorPoint(.5,.5);this._positionsAreDirty=true;return true},initWithFile:function(t,e,i){if(t instanceof cc.Rect){t=arguments[1];i=arguments[0];e=cc.rect(0,0,0,0)}else{e=e||cc.rect(0,0,0,0);i=i||cc.rect(0,0,0,0)}if(!t)throw new Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");var n=cc.textureCache.getTextureForKey(t);if(!n){n=cc.textureCache.addImage(t)}var r=n.isLoaded();this._textureLoaded=r;if(!r){n.addEventListener("load",function(t){var e=this._preferredSize,i=e.width!==0&&e.height!==0;if(i)e=cc.size(e.width,e.height);var n=t.getContentSize();this.updateWithBatchNode(this._scale9Image,cc.rect(0,0,n.width,n.height),false,this._capInsets);if(i)this.setPreferredSize(e);this._positionsAreDirty=true;this.setNodeDirty();this.dispatchEvent("load")},this)}return this.initWithBatchNode(new cc.SpriteBatchNode(t,9),e,false,i)},initWithSpriteFrame:function(t,e){if(!t||!t.getTexture())throw new Error("ccui.Scale9Sprite.initWithSpriteFrame(): spriteFrame should be non-null and its texture should be non-null");e=e||cc.rect(0,0,0,0);var i=t.textureLoaded();this._textureLoaded=i;if(!i){t.addEventListener("load",function(t){var e=this._preferredSize,i=e.width!==0&&e.height!==0;if(i)e=cc.size(e.width,e.height);this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets);if(i)this.setPreferredSize(e);this._positionsAreDirty=true;this.setNodeDirty();this.dispatchEvent("load")},this)}var n=new cc.SpriteBatchNode(t.getTexture(),9);return this.initWithBatchNode(n,t.getRect(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&t.isRotated(),e)},initWithSpriteFrameName:function(t,e){if(!t)throw new Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");e=e||cc.rect(0,0,0,0);var i=cc.spriteFrameCache.getSpriteFrame(t);if(i==null){cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName");return false}return this.initWithSpriteFrame(i,e)},resizableSpriteWithCapInsets:function(t){var e=new ccui.Scale9Sprite;if(e&&e.initWithBatchNode(this._scale9Image,this._spriteRect,false,t))return e;return null},setOpacityModifyRGB:function(t){if(!this._scale9Image)return;this._opacityModifyRGB=t;var e=this._scale9Image.getChildren();if(e){for(var i=0,n=e.length;i<n;i++)e[i].setOpacityModifyRGB(t)}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},createSlicedSprites:function(){var t=this._originalSize.width,e=this._originalSize.height;var i=this._spriteRect;var n=Math.floor(this._offset.x+(t-i.width)/2);var r=Math.floor(this._offset.y+(e-i.height)/2);var s=i.x,a=i.y;var o=this._capInsetsInternal;var c=this._scale9Image;var l=c.getTexture();var h=this._spriteFrameRotated;var u=cc.rect(i.x,i.y,i.width,i.height);if(cc._rectEqualToZero(o))o=cc.rect(t/3,e/3,t/3,e/3);if(this._spriteFrameRotated){s-=r;a-=n}else{s-=n;a-=r}i=cc.rect(s,a,t,e);var d=o.x,_=o.width,f=i.width-(d+_),p=o.y,m=o.height,g=i.height-(p+m);var v=0,y=0;var T=cc.rect(v+.5|0,y+.5|0,d+.5|0,p+.5|0);var C=T;v+=d;var S=cc.rect(v+.5|0,y+.5|0,_+.5|0,p+.5|0);var x=S;v+=_;var E=cc.rect(v+.5|0,y+.5|0,f+.5|0,p+.5|0);var b=E;v=0;y=0;y+=p;var A=cc.rect(v+.5|0,y+.5|0,d+.5|0,m+.5|0);v+=d;var R=cc.rect(v+.5|0,y+.5|0,_+.5|0,m+.5|0);var P=R;v+=_;var w=cc.rect(v+.5|0,y+.5|0,f+.5|0,m+.5|0);v=0;y=0;y+=p;y+=m;var I=cc.rect(v+.5|0,y+.5|0,d+.5|0,g+.5|0);v+=d;var D=cc.rect(v+.5|0,y+.5|0,_+.5|0,g+.5|0);v+=_;var L=cc.rect(v+.5|0,y+.5|0,f+.5|0,g+.5|0);var O=L;var B=T;var F=R;var N=L;var M=P;var V=O;var k=I;var W=b;var G=C;var z=w;var U=A;var Y=D;var X=x;var H=cc.affineTransformMakeIdentity();if(!h){H=cc.affineTransformTranslate(H,u.x,u.y);B=cc.rectApplyAffineTransform(B,H);F=cc.rectApplyAffineTransform(F,H);N=cc.rectApplyAffineTransform(N,H);M=cc.rectApplyAffineTransform(M,H);V=cc.rectApplyAffineTransform(V,H);k=cc.rectApplyAffineTransform(k,H);W=cc.rectApplyAffineTransform(W,H);G=cc.rectApplyAffineTransform(G,H);z=cc.rectApplyAffineTransform(z,H);U=cc.rectApplyAffineTransform(U,H);Y=cc.rectApplyAffineTransform(Y,H);X=cc.rectApplyAffineTransform(X,H)}else{H=cc.affineTransformTranslate(H,u.height+u.x,u.y);H=cc.affineTransformRotate(H,1.57079633);T=cc.rectApplyAffineTransform(T,H);R=cc.rectApplyAffineTransform(R,H);L=cc.rectApplyAffineTransform(L,H);P=cc.rectApplyAffineTransform(P,H);O=cc.rectApplyAffineTransform(O,H);I=cc.rectApplyAffineTransform(I,H);b=cc.rectApplyAffineTransform(b,H);C=cc.rectApplyAffineTransform(C,H);w=cc.rectApplyAffineTransform(w,H);A=cc.rectApplyAffineTransform(A,H);D=cc.rectApplyAffineTransform(D,H);x=cc.rectApplyAffineTransform(x,H);B.x=T.x;F.x=R.x;N.x=L.x;M.x=P.x;V.x=O.x;k.x=I.x;W.x=b.x;G.x=C.x;z.x=w.x;U.x=A.x;Y.x=D.x;X.x=x.x;B.y=T.y;F.y=R.y;N.y=L.y;M.y=P.y;V.y=O.y;k.y=I.y;W.y=b.y;G.y=C.y;z.y=w.y;U.y=A.y;Y.y=D.y;X.y=x.y}if(!this._centre)this._centre=new cc.Sprite;this._centre.initWithTexture(l,M,h);if(M.width>0&&M.height>0)this._renderers.push(this._centre);if(!this._top)this._top=new cc.Sprite;this._top.initWithTexture(l,X,h);if(X.width>0&&X.height>0)this._renderers.push(this._top);if(!this._bottom)this._bottom=new cc.Sprite;this._bottom.initWithTexture(l,Y,h);if(Y.width>0&&Y.height>0)this._renderers.push(this._bottom);if(!this._left)this._left=new cc.Sprite;this._left.initWithTexture(l,U,h);if(U.width>0&&U.height>0)this._renderers.push(this._left);if(!this._right)this._right=new cc.Sprite;this._right.initWithTexture(l,z,h);if(z.width>0&&z.height>0)this._renderers.push(this._right);if(!this._topLeft)this._topLeft=new cc.Sprite;this._topLeft.initWithTexture(l,G,h);if(G.width>0&&G.height>0)this._renderers.push(this._topLeft);if(!this._topRight)this._topRight=new cc.Sprite;this._topRight.initWithTexture(l,W,h);if(W.width>0&&W.height>0)this._renderers.push(this._topRight);if(!this._bottomLeft)this._bottomLeft=new cc.Sprite;this._bottomLeft.initWithTexture(l,k,h);if(k.width>0&&k.height>0)this._renderers.push(this._bottomLeft);if(!this._bottomRight)this._bottomRight=new cc.Sprite;this._bottomRight.initWithTexture(l,V,h);if(V.width>0&&V.height>0)this._renderers.push(this._bottomRight)},updateWithSprite:function(t,e,i,n,r,s){var a=this.getOpacity();var o=this.getColor();this._renderers.length=0;if(t){if(!t.getSpriteFrame())return false;if(!this._scale9Image)this._scale9Image=t}if(!this._scale9Image)return false;var c=e;var l=r;var h=this._scale9Image.getTexture();var u=h&&h.isLoaded();this._textureLoaded=u;if(!u){h.addEventListener("load",function(a){this._positionsAreDirty=true;this.updateWithSprite(t,e,i,n,r,s);this.setVisible(true);this.setNodeDirty();this.dispatchEvent("load")},this);this.setVisible(false);return true}if(cc._rectEqualToZero(c)){var d=h.getContentSize();c=cc.rect(0,0,d.width,d.height)}if(l.width===0&&l.height===0)l=cc.size(c.width,c.height);this._capInsets=s;this._spriteRect=c;this._offset=n;this._spriteFrameRotated=i;this._originalSize=l;this._preferredSize=l;this._capInsetsInternal=s;if(this._scale9Enabled)this.createSlicedSprites();else this._scale9Image.initWithTexture(h,this._spriteRect,this._spriteFrameRotated);this.setState(this._brightState);this.setContentSize(l);if(this._spritesGenerated===true){this.setOpacity(a);this.setColor(o)}this._spritesGenerated=true;return true},updateWithBatchNode:function(t,e,i,n){var r=new cc.Sprite(t.getTexture());var s=cc.p(0,0);var a=cc.size(e.width,e.height);var o=t.getTexture();var c=o.isLoaded();this._textureLoaded=c;if(!c){o.addEventListener("load",function(r){this._positionsAreDirty=true;this.updateWithBatchNode(t,e,i,n);this.setVisible(true);this.setNodeDirty();this.dispatchEvent("load")},this);this.setVisible(false);return true}return this.updateWithSprite(r,e,i,s,a,n)},setSpriteFrame:function(t,e){if(!e)e=cc.rect();var i=new cc.Sprite(t.getTexture());var n=t.textureLoaded();this._textureLoaded=n;if(!n){t.addEventListener("load",function(t){var e=this._preferredSize,i=e.width!==0&&e.height!==0;if(i)e=cc.size(e.width,e.height);this.updateWithBatchNode(this._scale9Image,t.getRect(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&t.isRotated(),this._capInsets);if(i)this.setPreferredSize(e);this._positionsAreDirty=true;this.setNodeDirty();this.dispatchEvent("load")},this)}this.updateWithSprite(i,t.getRect(),t.isRotated(),t.getOffset(),t.getOriginalSize(),e);this._insetLeft=e.x;this._insetTop=e.y;this._insetRight=this._originalSize.width-this._insetLeft-e.width;this._insetBottom=this._originalSize.height-this._insetTop-e.height},setState:function(t){this._renderCmd.setState(t)},setScale9Enabled:function(t){if(this._scale9Enabled===t){return}this._scale9Enabled=t;this._renderers.length=0;cc.Node.transformDirty=true;if(this._scale9Enabled){if(this._scale9Image){this.updateWithSprite(this._scale9Image,this._spriteRect,this._spriteFrameRotated,this._offset,this._originalSize,this._capInsets)}}this._positionsAreDirty=true},_setRenderersPosition:function(){if(this._positionsAreDirty){this._updatePositions();this._adjustScale9ImagePosition();this._positionsAreDirty=false}},_adjustScale9ImagePosition:function(){var t=this._scale9Image;var e=this._contentSize;if(t){t.x=e.width*t.getAnchorPoint().x;t.y=e.height*t.getAnchorPoint().y}},_adjustScale9ImageScale:function(){var t=this._scale9Image;var e=this._contentSize;if(t){t.setScale(e.width/t.width,e.height/t.height)}},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t;this.setScaleX(e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t;this.setScaleY(e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},isFlippedY:function(){return this._flippedY},setScaleX:function(t){if(this._flippedX)t=t*-1;cc.Node.prototype.setScaleX.call(this,t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},setScaleY:function(t){if(this._flippedY)t=t*-1;cc.Node.prototype.setScaleY.call(this,t);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)},setScale:function(t,e){if(e===undefined)e=t;this.setScaleX(t);this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);if(this._flippedX)t=t*-1;return t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);if(this._flippedY)t=t*-1;return t},getScale:function(){if(this.getScaleX()!==this.getScaleY())cc.log("Scale9Sprite#scale. ScaleX != ScaleY. Don't know which one to return");return this.getScaleX()},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new ccui.Scale9Sprite.CanvasRenderCmd(this);else return new ccui.Scale9Sprite.WebGLRenderCmd(this)}});var _p=ccui.Scale9Sprite.prototype;cc.EventHelper.prototype.apply(_p);_p.preferredSize;cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize);_p.capInsets;cc.defineGetterSetter(_p,"capInsets",_p.getCapInsets,_p.setCapInsets);_p.insetLeft;cc.defineGetterSetter(_p,"insetLeft",_p.getInsetLeft,_p.setInsetLeft);_p.insetTop;cc.defineGetterSetter(_p,"insetTop",_p.getInsetTop,_p.setInsetTop);_p.insetRight;cc.defineGetterSetter(_p,"insetRight",_p.getInsetRight,_p.setInsetRight);_p.insetBottom;cc.defineGetterSetter(_p,"insetBottom",_p.getInsetBottom,_p.setInsetBottom);_p=null;ccui.Scale9Sprite.create=function(t,e,i){return new ccui.Scale9Sprite(t,e,i)};ccui.Scale9Sprite.createWithSpriteFrame=function(t,e){return new ccui.Scale9Sprite(t,e)};ccui.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new ccui.Scale9Sprite(t,e)};ccui.Scale9Sprite.POSITIONS_CENTRE=0;ccui.Scale9Sprite.POSITIONS_TOP=1;ccui.Scale9Sprite.POSITIONS_LEFT=2;ccui.Scale9Sprite.POSITIONS_RIGHT=3;ccui.Scale9Sprite.POSITIONS_BOTTOM=4;ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5;ccui.Scale9Sprite.POSITIONS_TOPLEFT=6;ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7;ccui.Scale9Sprite.state={NORMAL:0,GRAY:1};(function(){ccui.Scale9Sprite.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._cachedParent=null;this._cacheDirty=false;this._state=ccui.Scale9Sprite.state.NORMAL;var e=this._node;var i=this._cacheCanvas=document.createElement("canvas");i.width=1;i.height=1;this._cacheContext=new cc.CanvasContextWrapper(i.getContext("2d"));var n=this._cacheTexture=new cc.Texture2D;n.initWithElement(i);n.handleLoadedTexture();this._cacheSprite=new cc.Sprite(n);this._cacheSprite.setAnchorPoint(0,0);e.addChild(this._cacheSprite)};var t=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.CanvasRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;if(e._positionsAreDirty){e._updatePositions();e._positionsAreDirty=false}cc.Node.CanvasRenderCmd.prototype.visit.call(this,t)};t.transform=function(t){var e=this._node;cc.Node.CanvasRenderCmd.prototype.transform.call(this,t);if(e._positionsAreDirty){e._updatePositions();e._positionsAreDirty=false}var i=e._children;for(var n=0;n<i.length;n++){i[n].transform(this,true)}};t._updateDisplayColor=function(t){cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node;if(!e)return;var i=e._renderers;if(e._scale9Enabled){var n=i.length;for(var r=0;r<n;r++){var s=i[r];if(s){s._renderCmd._updateDisplayColor(t);s._renderCmd._updateColor()}else break}}else{if(e._scale9Image){e._scale9Image._renderCmd._updateDisplayColor(t);e._scale9Image._renderCmd._updateColor()}}};t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;cc.Node.RenderCmd.prototype.updateStatus.call(this);if(e&t.cacheDirty){this._cacheScale9Sprite();this._dirtyFlag=this._dirtyFlag&t.cacheDirty^this._dirtyFlag}};t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;cc.Node.RenderCmd.prototype._syncStatus.call(this,t);if(i&e.cacheDirty){this._cacheScale9Sprite();this._dirtyFlag=this._dirtyFlag&e.cacheDirty^this._dirtyFlag}};t._cacheScale9Sprite=function(){var t=this._node;if(!t._scale9Image)return;var e=cc.contentScaleFactor();var i=t._contentSize;var n=cc.size(i.width*e,i.height*e);var r=this._cacheCanvas,s=this._cacheContext,a=s.getContext();var o=false;if(r.width!==n.width||r.height!==n.height){r.width=n.width;r.height=n.height;o=true}cc.renderer._turnToCacheMode(t.__instanceId);if(t._scale9Enabled){var c=t._renderers;t._setRenderersPosition();var l=c.length;for(var h=0;h<l;h++){var u=c[h];if(u){var d=u._renderCmd;d.updateStatus();cc.renderer.pushRenderCommand(d)}else break}}else{var d=t._scale9Image._renderCmd;t._adjustScale9ImagePosition();t._adjustScale9ImageScale();d.updateStatus();cc.renderer.pushRenderCommand(t._scale9Image._renderCmd)}var _=t._scale9Image.getTexture();if(_&&this._state===ccui.Scale9Sprite.state.GRAY)_._switchToGray(true);a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,n.width,n.height);cc.renderer._renderingToCacheCanvas(s,t.__instanceId,e,e);cc.renderer._turnToNormalMode();if(_&&this._state===ccui.Scale9Sprite.state.GRAY)_._switchToGray(false);if(o)this._cacheSprite.setTextureRect(cc.rect(0,0,i.width,i.height));if(!this._cacheSprite.getParent())t.addChild(this._cacheSprite,-1)};t.setState=function(t){var e=this._node._scale9Image;if(!e)return;this._state=t;this.setDirtyFlag(cc.Node._dirtyFlags.cacheDirty)}})();(function(){if(!cc.Node.WebGLRenderCmd)return;ccui.Scale9Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._cachedParent=null;this._cacheDirty=false};var t=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;if(!e._scale9Image)return;if(e._positionsAreDirty){e._updatePositions();e._positionsAreDirty=false}t=t||this.getParentRenderCmd();if(e._parent&&e._parent._renderCmd)this._curLevel=e._parent._renderCmd._curLevel+1;this._syncStatus(t);if(e._scale9Enabled){var i=e._renderers;var n=i.length;for(var r=0;r<n;r++){var s=i[r];if(s){var a=s._renderCmd;a.visit(this)}else break}}else{e._adjustScale9ImageScale();e._adjustScale9ImagePosition();e._scale9Image._renderCmd.visit(this)}this._dirtyFlag=0;cc.Node.WebGLRenderCmd.prototype.visit.call(this,t)};t.transform=function(t,e){var i=this._node;cc.Node.WebGLRenderCmd.prototype.transform.call(this,t,e);if(i._positionsAreDirty){i._updatePositions();i._positionsAreDirty=false}if(i._scale9Enabled){var n=i._renderers;var r=n.length;for(var s=0;s<r;s++){var a=n[s];if(a){var o=a._renderCmd;o.transform(this,true)}else break}}else{i._adjustScale9ImageScale();i._adjustScale9ImagePosition();i._scale9Image._renderCmd.transform(this,true)}};t.setDirtyFlag=function(t,e){if(t===cc.Node._dirtyFlags.cacheDirty)t=cc.Node._dirtyFlags.transformDirty;cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e)};t._syncStatus=function(t){cc.Node.WebGLRenderCmd.prototype._syncStatus.call(this,t);this._updateDisplayColor(this._displayedColor);this._updateDisplayOpacity(this._displayedOpacity)};t._updateDisplayColor=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node;var i=e._scale9Image;t=this._displayedColor;if(e._scale9Enabled){var n=e._renderers;for(var r=0;r<n.length;r++){n[r]._renderCmd._updateDisplayColor(t);n[r]._renderCmd._updateColor()}}else{i._renderCmd._updateDisplayColor(t);i._renderCmd._updateColor()}};t._updateDisplayOpacity=function(t){cc.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=this._node;var i=e._scale9Image;t=this._displayedOpacity;if(e._scale9Enabled){var n=e._renderers;for(var r=0;r<n.length;r++){n[r]._renderCmd._updateDisplayOpacity(t);n[r]._renderCmd._updateColor()}}else{i._renderCmd._updateDisplayOpacity(t);i._renderCmd._updateColor()}};t.setState=function(t){var e=this._node._scale9Image;if(e==null)return;if(t===ccui.Scale9Sprite.state.NORMAL){e.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR))}else if(t===ccui.Scale9Sprite.state.GRAY){e.setShaderProgram(ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram())}};ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null;ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var t=ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;if(t)return t;t=new cc.GLProgram;t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment);t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);
t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);t.link();t.updateUniforms();ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=t;return t};ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment="precision lowp float;\n"+"varying vec4 v_fragmentColor; \n"+"varying vec2 v_texCoord; \n"+"void main() \n"+"{ \n"+"    vec4 c = texture2D(CC_Texture0, v_texCoord); \n"+"    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n"+"     gl_FragColor.w = c.w ; \n"+"}"})();ccui.Layout=ccui.Widget.extend({_clippingEnabled:false,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:true,_clippingRectDirty:true,_clippingType:null,_clippingStencil:null,_scissorRectDirty:false,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:false,__passFocusToChild:true,_isFocusPassing:false,_isInterceptTouch:false,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE;this._widgetType=ccui.Widget.TYPE_CONTAINER;this._clippingType=ccui.Layout.CLIPPING_STENCIL;this._colorType=ccui.Layout.BG_COLOR_NONE;ccui.Widget.prototype.ctor.call(this);this._backGroundImageCapInsets=cc.rect(0,0,0,0);this._color=cc.color(255,255,255,255);this._startColor=cc.color(255,255,255,255);this._endColor=cc.color(255,255,255,255);this._alongVector=cc.p(0,-1);this._backGroundImageTextureSize=cc.size(0,0);this._clippingRect=cc.rect(0,0,0,0);this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);if(this._clippingStencil)this._clippingStencil.onEnter();this._doLayoutDirty=true;this._clippingRectDirty=true},onExit:function(){ccui.Widget.prototype.onExit.call(this);if(this._clippingStencil)this._clippingStencil.onExit()},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(t,e){if(this._isFocusPassing||this.isFocused()){var i=this.getParent();this._isFocusPassing=false;if(this.__passFocusToChild){var n=this._passFocusToChild(t,e);if(n instanceof ccui.Layout&&i){i._isFocusPassing=true;return i.findNextFocusedWidget(t,this)}return n}if(null==i||!(i instanceof ccui.Layout))return this;i._isFocusPassing=true;return i.findNextFocusedWidget(t,this)}else if(e.isFocused()||e instanceof ccui.Layout){if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL){switch(t){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(t,e);break;case ccui.Widget.RIGHT:return this._getNextFocusedWidget(t,e);break;case ccui.Widget.DOWN:case ccui.Widget.UP:if(this._isLastWidgetInContainer(this,t)){if(this._isWidgetAncestorSupportLoopFocus(e,t))return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);return e}else{return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)}break;default:cc.assert(0,"Invalid Focus Direction");return e}}else if(this._layoutType===ccui.Layout.LINEAR_VERTICAL){switch(t){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:if(this._isLastWidgetInContainer(this,t)){if(this._isWidgetAncestorSupportLoopFocus(e,t))return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);return e}else return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);break;case ccui.Widget.DOWN:return this._getNextFocusedWidget(t,e);break;case ccui.Widget.UP:return this._getPreviousFocusedWidget(t,e);break;default:cc.assert(0,"Invalid Focus Direction");return e}}else{cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!");return e}}else return e},onPassFocusToChild:null,init:function(){if(ccui.Widget.prototype.init.call(this)){this.ignoreContentAdaptWithSize(false);this.setContentSize(cc.size(0,0));this.setAnchorPoint(0,0);this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this);return true}return false},addChild:function(t,e,i){if(t instanceof ccui.Widget){this._supplyTheLayoutParameterLackToChild(t)}ccui.Widget.prototype.addChild.call(this,t,e,i);this._doLayoutDirty=true},removeChild:function(t,e){ccui.Widget.prototype.removeChild.call(this,t,e);this._doLayoutDirty=true},removeAllChildren:function(t){ccui.Widget.prototype.removeAllChildren.call(this,t);this._doLayoutDirty=true},removeAllChildrenWithCleanup:function(t){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,t);this._doLayoutDirty=true},isClippingEnabled:function(){return this._clippingEnabled},visit:function(t){if(!this._visible)return;this._adaptRenderers();this._doLayout();if(this._clippingEnabled){switch(this._clippingType){case ccui.Layout.CLIPPING_STENCIL:this._renderCmd.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this._renderCmd.scissorClippingVisit(t);break;default:break}}else ccui.Widget.prototype.visit.call(this,t)},setClippingEnabled:function(t){if(t===this._clippingEnabled)return;this._clippingEnabled=t;switch(this._clippingType){case ccui.Layout.CLIPPING_STENCIL:if(t){this._clippingStencil=new cc.DrawNode;this._renderCmd.rebindStencilRendering(this._clippingStencil);if(this._running)this._clippingStencil.onEnter();this._setStencilClippingSize(this._contentSize)}else{if(this._running&&this._clippingStencil)this._clippingStencil.onExit();this._clippingStencil=null}break;default:break}},setClippingType:function(t){if(t===this._clippingType)return;if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&t===ccui.Layout.CLIPPING_SCISSOR){cc.log("Only supports STENCIL on canvas mode.");return}var e=this.isClippingEnabled();this.setClippingEnabled(false);this._clippingType=t;this.setClippingEnabled(e)},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){if(this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL){var e=[];e[0]=cc.p(0,0);e[1]=cc.p(t.width,0);e[2]=cc.p(t.width,t.height);e[3]=cc.p(0,t.height);var i=cc.color.GREEN;this._clippingStencil.clear();this._clippingStencil.drawPoly(e,4,i,0,i)}},_getClippingRect:function(){if(this._clippingRectDirty){var t=this.convertToWorldSpace(cc.p(0,0));var e=this.getNodeToWorldTransform();var i=this._contentSize.width*e.a;var n=this._contentSize.height*e.d;var r;var s=this;while(s){s=s.getParent();if(s&&s instanceof ccui.Layout&&s.isClippingEnabled()){this._clippingParent=s;break}}if(this._clippingParent){r=this._clippingParent._getClippingRect();var a=t.x-i*this._anchorPoint.x;var o=t.y-n*this._anchorPoint.y;var c=i;var l=n;var h=t.x-r.x;if(h<0){a=r.x;c+=h}var u=t.x+i-(r.x+r.width);if(u>0)c-=u;var d=t.y+n-(r.y+r.height);if(d>0)l-=d;var _=t.y-r.y;if(_<0){o=r.x;l+=_}if(c<0)c=0;if(l<0)l=0;this._clippingRect.x=a;this._clippingRect.y=o;this._clippingRect.width=c;this._clippingRect.height=l}else{this._clippingRect.x=t.x-i*this._anchorPoint.x;this._clippingRect.y=t.y-n*this._anchorPoint.y;this._clippingRect.width=i;this._clippingRect.height=n}this._clippingRectDirty=false}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t);this._doLayoutDirty=true;this._clippingRectDirty=true;if(this._backGroundImage){this._backGroundImage.setPosition(t.width*.5,t.height*.5);if(this._backGroundScale9Enabled&&this._backGroundImage instanceof ccui.Scale9Sprite)this._backGroundImage.setPreferredSize(t)}if(this._colorRender)this._colorRender.setContentSize(t);if(this._gradientRender)this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){if(this._backGroundScale9Enabled===t)return;this.removeProtectedChild(this._backGroundImage);this._backGroundImage=null;this._backGroundScale9Enabled=t;this._addBackGroundImage();this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType);this.setBackGroundImageCapInsets(this._backGroundImageCapInsets)},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;if(this._backGroundImage===null){this._addBackGroundImage();this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)}this._backGroundImageFileName=t;this._bgImageTexType=e;var i=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}if(this._backGroundScale9Enabled)i.setPreferredSize(this._contentSize);this._backGroundImageTextureSize=i.getContentSize();i.setPosition(this._contentSize.width*.5,this._contentSize.height*.5);this._updateBackGroundImageColor()},setBackGroundImageCapInsets:function(t){if(!t)return;var e=this._backGroundImageCapInsets;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height;if(this._backGroundScale9Enabled)this._backGroundImage.setCapInsets(t)},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(!t){return}switch(this._layoutType){case ccui.Layout.ABSOLUTE:break;case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR);if(!e)t.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:var e=t.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(!e)t.setLayoutParameter(new ccui.RelativeLayoutParameter);break;default:break}},_addBackGroundImage:function(){var t=this._contentSize;if(this._backGroundScale9Enabled){this._backGroundImage=new ccui.Scale9Sprite;this._backGroundImage.setPreferredSize(t)}else this._backGroundImage=new cc.Sprite;this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1);this._backGroundImage.setPosition(t.width*.5,t.height*.5)},removeBackGroundImage:function(){if(!this._backGroundImage)return;this.removeProtectedChild(this._backGroundImage);this._backGroundImage=null;this._backGroundImageFileName="";this._backGroundImageTextureSize.width=0;this._backGroundImageTextureSize.height=0},setBackGroundColorType:function(t){if(this._colorType===t)return;switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:if(this._colorRender){this.removeProtectedChild(this._colorRender);this._colorRender=null}if(this._gradientRender){this.removeProtectedChild(this._gradientRender);this._gradientRender=null}break;case ccui.Layout.BG_COLOR_SOLID:if(this._colorRender){this.removeProtectedChild(this._colorRender);this._colorRender=null}break;case ccui.Layout.BG_COLOR_GRADIENT:if(this._gradientRender){this.removeProtectedChild(this._gradientRender);this._gradientRender=null}break;default:break}this._colorType=t;switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new cc.LayerColor;this._colorRender.setContentSize(this._contentSize);this._colorRender.setOpacity(this._opacity);this._colorRender.setColor(this._color);this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new cc.LayerGradient(cc.color(255,0,0,255),cc.color(0,255,0,255));this._gradientRender.setContentSize(this._contentSize);this._gradientRender.setOpacity(this._opacity);this._gradientRender.setStartColor(this._startColor);this._gradientRender.setEndColor(this._endColor);this._gradientRender.setVector(this._alongVector);this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;default:break}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){if(!e){this._color.r=t.r;this._color.g=t.g;this._color.b=t.b;if(this._colorRender)this._colorRender.setColor(t)}else{this._startColor.r=t.r;this._startColor.g=t.g;this._startColor.b=t.b;if(this._gradientRender)this._gradientRender.setStartColor(t);this._endColor.r=e.r;this._endColor.g=e.g;this._endColor.b=e.b;if(this._gradientRender)this._gradientRender.setEndColor(e)}},getBackGroundColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return cc.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){this._opacity=t;switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t);break;default:break}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x;this._alongVector.y=t.y;if(this._gradientRender){this._gradientRender.setVector(t)}},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r;this._backGroundImageColor.g=t.g;this._backGroundImageColor.b=t.b;this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t;this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){if(this._backGroundImage)this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t;var e=this._children;var i=null;for(var n=0;n<e.length;n++){i=e[n];if(i instanceof ccui.Widget)this._supplyTheLayoutParameterLackToChild(i)}this._doLayoutDirty=true},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=true},_doLayout:function(){if(!this._doLayoutDirty)return;this.sortAllChildren();var t=ccui.getLayoutManager(this._layoutType);if(t)t._doLayout(this);this._doLayoutDirty=false},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){if(this._backGroundImage)this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){if(this._backGroundImage){this._backGroundImage.setColor(this._backGroundImageColor);this._backGroundImage.setOpacity(this._backGroundImageOpacity)}},_getLayoutAccumulatedSize:function(){var t=this.getChildren();var e=cc.size(0,0);var i=0,n;for(var r=0,s=t.length;r<s;r++){var a=t[r];if(null!==a&&a instanceof ccui.Layout){n=a._getLayoutAccumulatedSize();e.width+=n.width;e.height+=n.height}else{if(a instanceof ccui.Widget){i++;var o=a.getLayoutParameter().getMargin();n=a.getContentSize();e.width+=n.width+(o.right+o.left)*.5;e.height+=n.height+(o.top+o.bottom)*.5}}}var c=this.getLayoutType();if(c===ccui.Layout.LINEAR_HORIZONTAL)e.height=e.height-e.height/i*(i-1);if(c===ccui.Layout.LINEAR_VERTICAL)e.width=e.width-e.width/i*(i-1);return e},_findNearestChildWidgetIndex:function(t,e){if(e==null||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,n=this.getChildren();var r=n.length,s;var a=cc.FLT_MAX,o=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){s=this._getWorldCenterPoint(e);while(i<r){var c=n[i];if(c&&c instanceof ccui.Widget&&c.isFocusEnabled()){var l=c instanceof ccui.Layout?c._calculateNearestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(c),s));if(l<a){o=i;a=l}}i++}return o}cc.log("invalid focus direction!");return 0},_findFarthestChildWidgetIndex:function(t,e){if(e==null||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,n=this.getChildren();var r=n.length;var s=-cc.FLT_MAX,a=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){var o=this._getWorldCenterPoint(e);while(i<r){var c=n[i];if(c&&c instanceof ccui.Widget&&c.isFocusEnabled()){var l=c instanceof ccui.Layout?c._calculateFarthestDistance(e):cc.pLength(cc.pSub(this._getWorldCenterPoint(c),o));if(l>s){a=i;s=l}}i++}return a}cc.log("invalid focus direction!!!");return 0},_calculateNearestDistance:function(t){var e=cc.FLT_MAX;var i=this._getWorldCenterPoint(t);var n=this._children;for(var r=0,s=n.length;r<s;r++){var a=n[r],o;if(a instanceof ccui.Layout)o=a._calculateNearestDistance(t);else{if(a instanceof ccui.Widget&&a.isFocusEnabled())o=cc.pLength(cc.pSub(this._getWorldCenterPoint(a),i));else continue}if(o<e)e=o}return e},_calculateFarthestDistance:function(t){var e=-cc.FLT_MAX;var i=this._getWorldCenterPoint(t);var n=this._children;for(var r=0,s=n.length;r<s;r++){var a=n[r];var o;if(a instanceof ccui.Layout)o=a._calculateFarthestDistance(t);else{if(a instanceof ccui.Widget&&a.isFocusEnabled()){var c=this._getWorldCenterPoint(a);o=cc.pLength(cc.pSub(c,i))}else continue}if(o>e)e=o}return e},_findProperSearchingFunctor:function(t,e){if(e==null)return;var i=this._getWorldCenterPoint(e);var n=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());if(t===ccui.Widget.LEFT){this.onPassFocusToChild=i.x>n.x?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this)}else if(t===ccui.Widget.RIGHT){this.onPassFocusToChild=i.x>n.x?this._findFarthestChildWidgetIndex.bind(this):this._findNearestChildWidgetIndex.bind(this)}else if(t===ccui.Widget.DOWN){this.onPassFocusToChild=i.y>n.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this)}else if(t===ccui.Widget.UP){this.onPassFocusToChild=i.y<n.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this)}else cc.log("invalid direction!")},_findFirstNonLayoutWidget:function(){var t=this._children;for(var e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof ccui.Layout){var r=n._findFirstNonLayoutWidget();if(r)return r}else{if(n instanceof ccui.Widget)return n}}return null},_findFirstFocusEnabledWidgetIndex:function(){var t=0,e=this.getChildren();var i=e.length;while(t<i){var n=e[t];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return t;t++}return 0},_findFocusEnabledChildWidgetByIndex:function(t){var e=this._getChildWidgetByIndex(t);if(e){if(e.isFocusEnabled())return e;t=t+1;return this._findFocusEnabledChildWidgetByIndex(t)}return null},_getWorldCenterPoint:function(t){var e=t instanceof ccui.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(cc.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var i=null,n=this._children;var r=n.indexOf(e);r=r+1;if(r<n.length){i=this._getChildWidgetByIndex(r);if(i){if(i.isFocusEnabled()){if(i instanceof ccui.Layout){i._isFocusPassing=true;return i.findNextFocusedWidget(t,i)}else{this.dispatchFocusEvent(e,i);return i}}else return this._getNextFocusedWidget(t,i)}else return e}else{if(this._loopFocus){if(this._checkFocusEnabledChild()){r=0;i=this._getChildWidgetByIndex(r);if(i.isFocusEnabled()){if(i instanceof ccui.Layout){i._isFocusPassing=true;return i.findNextFocusedWidget(t,i)}else{this.dispatchFocusEvent(e,i);return i}}else return this._getNextFocusedWidget(t,i)}else return e instanceof ccui.Layout?e:ccui.Widget._focusedWidget}else{if(this._isLastWidgetInContainer(e,t)){if(this._isWidgetAncestorSupportLoopFocus(this,t))return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);return e instanceof ccui.Layout?e:ccui.Widget._focusedWidget}else return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)}}},_getPreviousFocusedWidget:function(t,e){var i=null,n=this._children;var r=n.indexOf(e);r=r-1;if(r>=0){i=this._getChildWidgetByIndex(r);if(i.isFocusEnabled()){if(i instanceof ccui.Layout){i._isFocusPassing=true;return i.findNextFocusedWidget(t,i)}this.dispatchFocusEvent(e,i);return i}else return this._getPreviousFocusedWidget(t,i)}else{if(this._loopFocus){if(this._checkFocusEnabledChild()){r=n.length-1;i=this._getChildWidgetByIndex(r);if(i.isFocusEnabled()){if(i instanceof ccui.Layout){i._isFocusPassing=true;return i.findNextFocusedWidget(t,i)}else{this.dispatchFocusEvent(e,i);return i}}else return this._getPreviousFocusedWidget(t,i)}else return e instanceof ccui.Layout?e:ccui.Widget._focusedWidget}else{if(this._isLastWidgetInContainer(e,t)){if(this._isWidgetAncestorSupportLoopFocus(this,t))return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);return e instanceof ccui.Layout?e:ccui.Widget._focusedWidget}else return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)}}},_getChildWidgetByIndex:function(t){var e=this._children;var i=e.length,n=0,r=t;while(t<i){var s=e[t];if(s&&s instanceof ccui.Widget)return s;n++;t++}var a=0;while(a<r){var o=e[a];if(o&&o instanceof ccui.Widget)return o;n++;a++}return null},_isLastWidgetInContainer:function(t,e){var i=t.getParent();if(i==null||!(i instanceof ccui.Layout))return true;var n=i.getChildren();var r=n.indexOf(t);if(i.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(e===ccui.Widget.LEFT){if(r===0)return this._isLastWidgetInContainer(i,e);else return false}if(e===ccui.Widget.RIGHT){if(r===n.length-1)return this._isLastWidgetInContainer(i,e);else return false}if(e===ccui.Widget.DOWN)return this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.UP)return this._isLastWidgetInContainer(i,e)}else if(i.getLayoutType()===ccui.Layout.LINEAR_VERTICAL){if(e===ccui.Widget.UP){if(r===0)return this._isLastWidgetInContainer(i,e);else return false}if(e===ccui.Widget.DOWN){if(r===n.length-1)return this._isLastWidgetInContainer(i,e);else return false}if(e===ccui.Widget.LEFT)return this._isLastWidgetInContainer(i,e);if(e===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(i,e)}else{cc.log("invalid layout Type");return false}},_isWidgetAncestorSupportLoopFocus:function(t,e){var i=t.getParent();if(i==null||!(i instanceof ccui.Layout))return false;if(i.isLoopFocus()){var n=i.getLayoutType();if(n===ccui.Layout.LINEAR_HORIZONTAL){if(e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT)return true;else return this._isWidgetAncestorSupportLoopFocus(i,e)}if(n===ccui.Layout.LINEAR_VERTICAL){if(e===ccui.Widget.DOWN||e===ccui.Widget.UP)return true;else return this._isWidgetAncestorSupportLoopFocus(i,e)}else{cc.assert(0,"invalid layout type");return false}}else return this._isWidgetAncestorSupportLoopFocus(i,e)},_passFocusToChild:function(t,e){if(this._checkFocusEnabledChild()){var i=ccui.Widget.getCurrentFocusedWidget();this._findProperSearchingFunctor(t,i);var n=this.onPassFocusToChild(t,i);var r=this._getChildWidgetByIndex(n);if(r instanceof ccui.Layout){r._isFocusPassing=true;return r.findNextFocusedWidget(t,r)}else{this.dispatchFocusEvent(e,r);return r}}else return this},_checkFocusEnabledChild:function(){var t=this._children;for(var e=0,i=t.length;e<i;e++){var n=t[e];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return true}return false},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(t){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){if(!(t instanceof ccui.Layout))return;this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled);this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType);this.setBackGroundImageCapInsets(t._backGroundImageCapInsets);this.setBackGroundColorType(t._colorType);this.setBackGroundColor(t._color);this.setBackGroundColor(t._startColor,t._endColor);this.setBackGroundColorOpacity(t._opacity);this.setBackGroundColorVector(t._alongVector);this.setLayoutType(t._layoutType);this.setClippingEnabled(t._clippingEnabled);this.setClippingType(t._clippingType);this._loopFocus=t._loopFocus;this.__passFocusToChild=t.__passFocusToChild;this._isInterceptTouch=t._isInterceptTouch},forceDoLayout:function(){this.requestDoLayout();this._doLayout()},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new ccui.Layout.WebGLRenderCmd(this);else return new ccui.Layout.CanvasRenderCmd(this)}});var _p=ccui.Layout.prototype;_p.clippingEnabled;cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled);_p.clippingType;cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType);_p.layoutType;cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType);_p=null;ccui.Layout.create=function(){return new ccui.Layout};ccui.Layout.BG_COLOR_NONE=0;ccui.Layout.BG_COLOR_SOLID=1;ccui.Layout.BG_COLOR_GRADIENT=2;ccui.Layout.ABSOLUTE=0;ccui.Layout.LINEAR_VERTICAL=1;ccui.Layout.LINEAR_HORIZONTAL=2;ccui.Layout.RELATIVE=3;ccui.Layout.CLIPPING_STENCIL=0;ccui.Layout.CLIPPING_SCISSOR=1;ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1;ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2;(function(){ccui.Layout.CanvasRenderCmd=function(t){ccui.ProtectedNode.CanvasRenderCmd.call(this,t);this._needDraw=false;this._clipElemType=false;this._locCache=null;this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._onRenderSaveCmd);this._rendererSaveCmdSprite=new cc.CustomRenderCmd(this,this._onRenderSaveSpriteCmd);this._rendererClipCmd=new cc.CustomRenderCmd(this,this._onRenderClipCmd);this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._onRenderRestoreCmd)};var t=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Layout.CanvasRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;e._adaptRenderers();e._doLayout();if(e._clippingEnabled){switch(e._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t);break;default:break}}else ccui.Widget.CanvasRenderCmd.prototype.visit.call(this,t)};t._onRenderSaveCmd=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();if(this._clipElemType){var s=r.canvas;this._locCache=ccui.Layout.CanvasRenderCmd._getSharedCache();this._locCache.width=s.width;this._locCache.height=s.height;var a=this._locCache.getContext("2d");a.drawImage(s,0,0)}else{n.save();n.save();n.setTransform(this._worldTransform,e,i)}};t._onRenderSaveSpriteCmd=function(t){var e=t||cc._renderContext;if(this._clipElemType){e.setCompositeOperation("destination-in")}};t._onRenderClipCmd=function(t){var e=t||cc._renderContext,i=e.getContext();if(!this._clipElemType){e.restore();i.clip()}};t._onRenderRestoreCmd=function(t){var e=t||cc._renderContext,i=e.getContext();if(this._clipElemType){i.save();i.setTransform(1,0,0,1,0,0);i.globalCompositeOperation="destination-over";i.drawImage(this._locCache,0,0);i.restore()}else{e.restore()}};t.rebindStencilRendering=function(t){t._renderCmd.rendering=this.__stencilDraw};t.__stencilDraw=function(t,e,i){var n=t||cc._renderContext,r=n.getContext(),s=this._buffer;for(var a=0,o=s.length;a<o;a++){var c=s[a],l=c.verts;var h=l[0];r.beginPath();r.moveTo(h.x*e,-h.y*i);for(var u=1,d=l.length;u<d;u++)r.lineTo(l[u].x*e,-l[u].y*i);r.closePath()}};t.stencilClippingVisit=t.scissorClippingVisit=function(t){var e=this._node;if(!e._clippingStencil||!e._clippingStencil.isVisible())return;this._clipElemType=e._stencil instanceof cc.Sprite;this._syncStatus(t);cc.renderer.pushRenderCommand(this._rendererSaveCmd);if(this._clipElemType){cc.ProtectedNode.prototype.visit.call(e,t);cc.renderer.pushRenderCommand(this._rendererSaveCmdSprite)}e._clippingStencil.visit(this);cc.renderer.pushRenderCommand(this._rendererClipCmd);if(!this._clipElemType){e.sortAllChildren();e.sortAllProtectedChildren();var i=e._children;var n=0,r=e._protectedChildren,s=0,a;var o=i.length,c=r.length;for(;s<o;s++){a=i[s];if(a&&a.getLocalZOrder()<0)a.visit(this);else break}for(;n<c;n++){a=r[n];if(a&&a.getLocalZOrder()<0)a.visit(this);else break}for(;s<o;s++)i[s].visit(this);for(;n<c;n++)r[n].visit(this);cc.renderer.pushRenderCommand(this._rendererRestoreCmd)}this._dirtyFlag=0};ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=document.createElement("canvas"))}})();(function(){if(!ccui.ProtectedNode.WebGLRenderCmd)return;ccui.Layout.WebGLRenderCmd=function(t){ccui.ProtectedNode.WebGLRenderCmd.call(this,t);this._needDraw=false;this._currentStencilEnabled=0;this._currentStencilWriteMask=0;this._currentStencilFunc=0;this._currentStencilRef=0;this._currentStencilValueMask=0;this._currentStencilFail=0;this._currentStencilPassDepthFail=0;this._currentStencilPassDepthPass=0;this._currentDepthWriteMask=false;this._mask_layer_le=0;this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil);this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil);this._afterVisitCmdStencil=new cc.CustomRenderCmd(this,this._onAfterVisitStencil);this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,this._onBeforeVisitScissor);this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor)};var t=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Layout.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;e._adaptRenderers();e._doLayout();if(e._clippingEnabled){switch(e._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t);break;default:break}}else ccui.Widget.WebGLRenderCmd.prototype.visit.call(this,t)};t._onBeforeVisitStencil=function(t){var e=t||cc._renderContext;ccui.Layout.WebGLRenderCmd._layer++;var i=1<<ccui.Layout.WebGLRenderCmd._layer;var n=i-1;this._mask_layer_le=i|n;this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST);this._currentStencilWriteMask=e.getParameter(e.STENCIL_WRITEMASK);this._currentStencilFunc=e.getParameter(e.STENCIL_FUNC);this._currentStencilRef=e.getParameter(e.STENCIL_REF);this._currentStencilValueMask=e.getParameter(e.STENCIL_VALUE_MASK);this._currentStencilFail=e.getParameter(e.STENCIL_FAIL);this._currentStencilPassDepthFail=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL);this._currentStencilPassDepthPass=e.getParameter(e.STENCIL_PASS_DEPTH_PASS);e.enable(e.STENCIL_TEST);e.stencilMask(i);this._currentDepthWriteMask=e.getParameter(e.DEPTH_WRITEMASK);e.depthMask(false);e.stencilFunc(e.NEVER,i,i);e.stencilOp(e.ZERO,e.KEEP,e.KEEP);this._drawFullScreenQuadClearStencil();e.stencilFunc(e.NEVER,i,i);e.stencilOp(e.REPLACE,e.KEEP,e.KEEP)};t._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(this._currentDepthWriteMask);e.stencilFunc(e.EQUAL,this._mask_layer_le,this._mask_layer_le);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)};t._onAfterVisitStencil=function(t){var e=t||cc._renderContext;e.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask);e.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass);e.stencilMask(this._currentStencilWriteMask);if(!this._currentStencilEnabled)e.disable(e.STENCIL_TEST);ccui.Layout.WebGLRenderCmd._layer--};t._onBeforeVisitScissor=function(t){var e=this._getClippingRect();var i=t||cc._renderContext;i.enable(i.SCISSOR_TEST);cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)};t._onAfterVisitScissor=function(t){var e=t||cc._renderContext;e.disable(e.SCISSOR_TEST)};t._drawFullScreenQuadClearStencil=function(){cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPushMatrix();cc.kmGLLoadIdentity();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPushMatrix();cc.kmGLLoadIdentity();cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255));cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPopMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPopMatrix()};t.rebindStencilRendering=function(t){};t.transform=function(t,e){var i=this._node;ccui.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e);if(i._clippingStencil)i._clippingStencil._renderCmd.transform(this,e);
};t.stencilClippingVisit=function(t){var e=this._node;if(!e._clippingStencil||!e._clippingStencil.isVisible())return;if(ccui.Layout.WebGLRenderCmd._layer+1===cc.stencilBits){ccui.Layout.WebGLRenderCmd._visit_once=true;if(ccui.Layout.WebGLRenderCmd._visit_once){cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs.");ccui.Layout.WebGLRenderCmd._visit_once=false}cc.Node.prototype.visit.call(e,t);return}cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var i=cc.current_stack;i.stack.push(i.top);this._syncStatus(t);this._dirtyFlag=0;i.top=this._stackMatrix;e._clippingStencil.visit(this);cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var n=0;var r=0;e.sortAllChildren();e.sortAllProtectedChildren();var s=e._children,a=e._protectedChildren;var o=s.length,c=a.length,l;for(;n<o;n++){l=s[n];if(l&&l.getLocalZOrder()<0)l.visit(this);else break}for(;r<c;r++){l=a[r];if(l&&l.getLocalZOrder()<0)l.visit(this);else break}for(;n<o;n++)s[n].visit(this);for(;r<c;r++)a[r].visit(this);cc.renderer.pushRenderCommand(this._afterVisitCmdStencil);i.top=i.stack.pop()};t.scissorClippingVisit=function(t){cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor);cc.ProtectedNode.prototype.visit.call(this._node,t);cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)};ccui.Layout.WebGLRenderCmd._layer=-1;ccui.Layout.WebGLRenderCmd._visit_once=null})();ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,i,n){if(t!==undefined&&e===undefined){this.left=t.left;this.top=t.top;this.right=t.right;this.bottom=t.bottom}if(n!==undefined){this.left=t;this.top=e;this.right=i;this.bottom=n}},setMargin:function(t,e,i,n){this.left=t;this.top=e;this.right=i;this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}});ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)};ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin;this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(t){if(cc.isObject(t)){this._margin.left=t.left;this._margin.top=t.top;this._margin.right=t.right;this._margin.bottom=t.bottom}else{this._margin.left=arguments[0];this._margin.top=arguments[1];this._margin.right=arguments[2];this._margin.bottom=arguments[3]}},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();t._copyProperties(this);return t},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom;this._margin.left=t._margin.left;this._margin.right=t._margin.right;this._margin.top=t._margin.top}});ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter};ccui.LayoutParameter.NONE=0;ccui.LayoutParameter.LINEAR=1;ccui.LayoutParameter.RELATIVE=2;ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this);this._linearGravity=ccui.LinearLayoutParameter.NONE;this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t);if(t instanceof ccui.LinearLayoutParameter)this.setGravity(t._linearGravity)}});ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter};ccui.LinearLayoutParameter.NONE=0;ccui.LinearLayoutParameter.LEFT=1;ccui.LinearLayoutParameter.TOP=2;ccui.LinearLayoutParameter.RIGHT=3;ccui.LinearLayoutParameter.BOTTOM=4;ccui.LinearLayoutParameter.CENTER_VERTICAL=5;ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6;ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:false,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this);this._relativeAlign=ccui.RelativeLayoutParameter.NONE;this._relativeWidgetName="";this._relativeLayoutName="";this._put=false;this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t);if(t instanceof ccui.RelativeLayoutParameter){this.setAlign(t._relativeAlign);this.setRelativeToWidgetName(t._relativeWidgetName);this.setRelativeName(t._relativeLayoutName)}}});ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter};ccui.RelativeLayoutParameter.NONE=0;ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1;ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3;ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4;ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5;ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7;ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8;ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9;ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10;ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11;ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18;ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19;ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20;ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21;ccui.LINEAR_GRAVITY_NONE=0;ccui.LINEAR_GRAVITY_LEFT=1;ccui.LINEAR_GRAVITY_TOP=2;ccui.LINEAR_GRAVITY_RIGHT=3;ccui.LINEAR_GRAVITY_BOTTOM=4;ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5;ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6;ccui.RELATIVE_ALIGN_NONE=0;ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1;ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3;ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4;ccui.RELATIVE_ALIGN_PARENT_CENTER=5;ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7;ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8;ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12;ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13;ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14;ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18;ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19;ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20;ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21;ccui.getLayoutManager=function(t){switch(t){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null};ccui.linearVerticalLayoutManager={_doLayout:function(t){var e=t._getLayoutContentSize();var i=t._getLayoutElements();var n=e.height;for(var r=0,s=i.length;r<s;r++){var a=i[r];if(a){var o=a.getLayoutParameter();if(o){var c=o.getGravity();var l=a.getAnchorPoint();var h=a.getContentSize();var u=l.x*h.width;var d=n-(1-l.y)*h.height;switch(c){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.LEFT:break;case ccui.LinearLayoutParameter.RIGHT:u=e.width-(1-l.x)*h.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:u=e.width/2-h.width*(.5-l.x);break;default:break}var _=o.getMargin();u+=_.left;d-=_.top;a.setPosition(u,d);n=a.getPositionY()-l.y*h.height-_.bottom}}}}};ccui.linearHorizontalLayoutManager={_doLayout:function(t){var e=t._getLayoutContentSize();var i=t._getLayoutElements();var n=0;for(var r=0,s=i.length;r<s;r++){var a=i[r];if(a){var o=a.getLayoutParameter();if(o){var c=o.getGravity();var l=a.getAnchorPoint();var h=a.getContentSize();var u=n+l.x*h.width;var d=e.height-(1-l.y)*h.height;switch(c){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.TOP:break;case ccui.LinearLayoutParameter.BOTTOM:d=l.y*h.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:d=e.height/2-h.height*(.5-l.y);break;default:break}var _=o.getMargin();u+=_.left;d-=_.top;a.setPosition(u,d);n=a.getRightBoundary()+_.right}}}}};ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(t){this._widgetChildren=this._getAllWidgets(t);var e=this._widgetChildren;while(this._unlayoutChildCount>0){for(var i=0,n=e.length;i<n;i++){this._widget=e[i];var r=this._widget.getLayoutParameter();if(r){if(r._put)continue;var s=this._calculateFinalPositionWithRelativeWidget(t);if(!s)continue;this._calculateFinalPositionWithRelativeAlign();this._widget.setPosition(this._finalPositionX,this._finalPositionY);r._put=true}}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(t){var e=t._getLayoutElements();var i=this._widgetChildren;i.length=0;for(var n=0,r=e.length;n<r;n++){var s=e[n];if(s){var a=s.getLayoutParameter();a._put=false;this._unlayoutChildCount++;i.push(s)}}return i},_getRelativeWidget:function(t){var e=null;var i=t.getLayoutParameter();var n=i.getRelativeToWidgetName();if(n&&n.length!==0){var r=this._widgetChildren;for(var s=0,a=r.length;s<a;s++){var o=r[s];if(o){var c=o.getLayoutParameter();if(c&&c.getRelativeName()===n){e=o;this._relativeWidgetLP=c;break}}}}return e},_calculateFinalPositionWithRelativeWidget:function(t){var e=this._widget;var i=e.getAnchorPoint();var n=e.getContentSize();this._finalPositionX=0;this._finalPositionY=0;var r=this._getRelativeWidget(e);var s=e.getLayoutParameter();var a=s.getAlign();var o=t._getLayoutContentSize();switch(a){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=i.x*n.width;this._finalPositionY=o.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=o.width*.5-n.width*(.5-i.x);this._finalPositionY=o.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=o.width-(1-i.x)*n.width;this._finalPositionY=o.height-(1-i.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=i.x*n.width;this._finalPositionY=o.height*.5-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=o.width*.5-n.width*(.5-i.x);this._finalPositionY=o.height*.5-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=o.width-(1-i.x)*n.width;this._finalPositionY=o.height*.5-n.height*(.5-i.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=i.x*n.width;this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=o.width*.5-n.width*(.5-i.x);this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=o.width-(1-i.x)*n.width;this._finalPositionY=i.y*n.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getTopBoundary()+i.y*n.height;this._finalPositionX=r.getLeftBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;var c=r.getContentSize();this._finalPositionY=r.getTopBoundary()+i.y*n.height;this._finalPositionX=r.getLeftBoundary()+c.width*.5+i.x*n.width-n.width*.5}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getTopBoundary()+i.y*n.height;this._finalPositionX=r.getRightBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getTopBoundary()-(1-i.y)*n.height;this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;var c=r.getContentSize();this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width;this._finalPositionY=r.getBottomBoundary()+c.height*.5+i.y*n.height-n.height*.5}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getBottomBoundary()+i.y*n.height;this._finalPositionX=r.getLeftBoundary()-(1-i.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getTopBoundary()-(1-i.y)*n.height;this._finalPositionX=r.getRightBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;var c=r.getContentSize();var l=r.getRightBoundary();this._finalPositionX=l+i.x*n.width;this._finalPositionY=r.getBottomBoundary()+c.height*.5+i.y*n.height-n.height*.5}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getBottomBoundary()+i.y*n.height;this._finalPositionX=r.getRightBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height;this._finalPositionX=r.getLeftBoundary()+i.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;var c=r.getContentSize();this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height;this._finalPositionX=r.getLeftBoundary()+c.width*.5+i.x*n.width-n.width*.5}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(r){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return false;this._finalPositionY=r.getBottomBoundary()-(1-i.y)*n.height;this._finalPositionX=r.getRightBoundary()-(1-i.x)*n.width}break;default:break}return true},_calculateFinalPositionWithRelativeAlign:function(){var t=this._widget.getLayoutParameter();var e=t.getMargin();var i=t.getAlign();switch(i){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=e.left;this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=e.right;this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=e.left;this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=e.right;this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=e.bottom;this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=e.bottom;this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=e.right;this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=e.right;this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=e.left;this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=e.left;this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=e.top;this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=e.top;this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=e.top;break;default:break}}};ccui.HBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this,t);if(t!==undefined)this.initWithSize(t);else this.init()},init:function(){if(ccui.Layout.prototype.init.call(this)){this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);return true}return false},initWithSize:function(t){if(this.init()){this.setContentSize(t);return true}return false}});ccui.HBox.create=function(t){return new ccui.HBox(t)};ccui.RelativeBox=ccui.Layout.extend({ctor:function(t){if(t)this.initWithSize(t);else this.init()},init:function(){if(ccui.Layout.prototype.init.call(this)){this.setLayoutType(ccui.Layout.RELATIVE);return true}return false},initWithSize:function(t){if(this.init()){this.setContentSize(t);return true}return false}});ccui.RelativeBox.create=function(t){return new ccui.RelativeBox(t)};ccui.VBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this,t);if(t!==undefined)this.initWithSize(t);else this.init()},init:function(){if(ccui.Layout.prototype.init.call(this)){this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);return true}return false},initWithSize:function(t){if(this.init()){this.setContentSize(t);return true}return false}});ccui.VBox.create=function(t){return new ccui.VBox(t)};ccui.helper={seekWidgetByTag:function(t,e){if(!t)return null;if(t.getTag()===e)return t;var i=t.getChildren();var n=i.length;for(var r=0;r<n;r++){var s=i[r];var a=ccui.helper.seekWidgetByTag(s,e);if(a!==null)return a}return null},seekWidgetByName:function(t,e){if(!t)return null;if(t.getName()===e)return t;var i=t.getChildren();var n=i.length;for(var r=0;r<n;r++){var s=i[r];var a=ccui.helper.seekWidgetByName(s,e);if(a!==null)return a}return null},seekWidgetByRelativeName:function(t,e){if(!t)return null;var i=t.getChildren();var n=i.length;for(var r=0;r<n;r++){var s=i[r];var a=s.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(a&&a.getRelativeName()===e)return s}return null},seekActionWidgetByActionTag:function(t,e){if(!t)return null;if(t.getActionTag()===e)return t;var i=t.getChildren();for(var n=0;n<i.length;n++){var r=i[n];var s=ccui.helper.seekActionWidgetByActionTag(r,e);if(s!==null)return s}return null},_activeLayout:true,doLayout:function(t){if(!this._activeLayout)return;var e=t.getChildren(),i;for(var n=0,r=e.length;n<r;n++){i=e[n];var s=i.getComponent(ccui.LayoutComponent.NAME);var a=i.getParent();if(null!=s&&null!==a&&s.refreshLayout)s.refreshLayout()}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var i=t.x,n=t.y;var r=t.width,s=t.height;if(e.width<r){i=0;r=0}if(e.height<s){n=0;s=0}return cc.rect(i,n,r,s)}};ccui.Button=ccui.Widget.extend({_buttonNormalRenderer:null,_buttonClickedRenderer:null,_buttonDisableRenderer:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:true,_scale9Enabled:false,_capInsetsNormal:null,_capInsetsPressed:null,_capInsetsDisabled:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,_pressedTextureSize:null,_disabledTextureSize:null,pressedActionEnabled:false,_titleColor:null,_normalTextureScaleXInSize:1,_normalTextureScaleYInSize:1,_pressedTextureScaleXInSize:1,_pressedTextureScaleYInSize:1,_zoomScale:.1,_normalTextureLoaded:false,_pressedTextureLoaded:false,_disabledTextureLoaded:false,_className:"Button",_normalTextureAdaptDirty:true,_pressedTextureAdaptDirty:true,_disabledTextureAdaptDirty:true,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,i,n){this._capInsetsNormal=cc.rect(0,0,0,0);this._capInsetsPressed=cc.rect(0,0,0,0);this._capInsetsDisabled=cc.rect(0,0,0,0);this._normalTextureSize=cc.size(0,0);this._pressedTextureSize=cc.size(0,0);this._disabledTextureSize=cc.size(0,0);this._titleColor=cc.color.WHITE;ccui.Widget.prototype.ctor.call(this);this.setTouchEnabled(true);this.init(t,e,i,n)},init:function(t,e,i,n){if(ccui.Widget.prototype.init.call(this)){if(t===undefined)return true;this.loadTextures(t,e,i,n)}return false},_initRenderer:function(){this._buttonNormalRenderer=new cc.Sprite;this._buttonClickedRenderer=new cc.Sprite;this._buttonDisableRenderer=new cc.Sprite;this._titleRenderer=new cc.LabelTTF("");this._titleRenderer.setAnchorPoint(.5,.5);this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1);this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1);this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1);this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){if(this._scale9Enabled===t)return;this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE;this._scale9Enabled=t;this.removeProtectedChild(this._buttonNormalRenderer);this.removeProtectedChild(this._buttonClickedRenderer);this.removeProtectedChild(this._buttonDisableRenderer);if(this._scale9Enabled){this._buttonNormalRenderer=new ccui.Scale9Sprite;this._buttonClickedRenderer=new ccui.Scale9Sprite;this._buttonDisableRenderer=new ccui.Scale9Sprite}else{this._buttonNormalRenderer=new cc.Sprite;this._buttonClickedRenderer=new cc.Sprite;this._buttonDisableRenderer=new cc.Sprite}this._buttonClickedRenderer.setVisible(false);this._buttonDisableRenderer.setVisible(false);this.loadTextureNormal(this._normalFileName,this._normalTexType);this.loadTexturePressed(this._clickedFileName,this._pressedTexType);this.loadTextureDisabled(this._disabledFileName,this._disabledTexType);this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1);this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1);this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1);if(this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(false);this._prevIgnoreSize=e}else{this.ignoreContentAdaptWithSize(this._prevIgnoreSize)}this.setCapInsetsNormalRenderer(this._capInsetsNormal);this.setCapInsetsPressedRenderer(this._capInsetsPressed);this.setCapInsetsDisabledRenderer(this._capInsetsDisabled);this.setBright(this._bright);this._normalTextureAdaptDirty=true;this._pressedTextureAdaptDirty=true;this._disabledTextureAdaptDirty=true},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){if(this._unifySize){this._updateContentSize();return}if(!this._scale9Enabled||this._scale9Enabled&&!t){ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t);this._prevIgnoreSize=t}},getVirtualRendererSize:function(){if(this._unifySize)return this._getNormalSize();if(!this._normalTextureLoaded&&this._titleRenderer.getString().length>0){return this._titleRenderer.getContentSize()}return cc.size(this._normalTextureSize)},loadTextures:function(t,e,i,n){this.loadTextureNormal(t,n);this.loadTexturePressed(e,n);this.loadTextureDisabled(i,n)},loadTextureNormal:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._normalFileName=t;this._normalTexType=e;var i=this;var n=this._buttonNormalRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){i.loadTextureNormal(i._normalFileName,i._normalTexType)})}switch(this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}this._normalTextureLoaded=n._textureLoaded;this._normalTextureSize=this._buttonNormalRenderer.getContentSize();this._updateChildrenDisplayedRGBA();if(this._unifySize){if(this._scale9Enabled){n.setCapInsets(this._capInsetsNormal);this._updateContentSizeWithTextureSize(this._getNormalSize())}}else this._updateContentSizeWithTextureSize(this._normalTextureSize);this._normalTextureAdaptDirty=true;this._findLayout()},loadTexturePressed:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._clickedFileName=t;this._pressedTexType=e;var i=this;var n=this._buttonClickedRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){i.loadTexturePressed(i._clickedFileName,i._pressedTexType)})}switch(this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}if(this._scale9Enabled)n.setCapInsets(this._capInsetsPressed);this._pressedTextureSize=this._buttonClickedRenderer.getContentSize();this._updateChildrenDisplayedRGBA();this._pressedTextureLoaded=true;this._pressedTextureAdaptDirty=true;this._findLayout()},loadTextureDisabled:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._disabledFileName=t;this._disabledTexType=e;var i=this;var n=this._buttonDisableRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){i.loadTextureDisabled(i._disabledFileName,i._disabledTexType)})}switch(this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}if(this._scale9Enabled)n.setCapInsets(this._capInsetsDisabled);this._disabledTextureSize=this._buttonDisableRenderer.getContentSize();this._updateChildrenDisplayedRGBA();this._disabledTextureLoaded=true;this._disabledTextureAdaptDirty=true;this._findLayout()},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t);this.setCapInsetsPressedRenderer(t);this.setCapInsetsDisabledRenderer(t)},setCapInsetsNormalRenderer:function(t){if(!t)return;var e=t.x,i=t.y;var n=t.width,r=t.height;if(this._normalTextureSize.width<n){e=0;n=0}if(this._normalTextureSize.height<r){i=0;r=0}var s=this._capInsetsNormal;s.x=e;s.y=i;s.width=n;s.height=r;if(!this._scale9Enabled)return;this._buttonNormalRenderer.setCapInsets(s)},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){if(!t||!this._scale9Enabled)return;var e=t.x,i=t.y;var n=t.width,r=t.height;if(this._pressedTextureSize.width<n){e=0;n=0}if(this._pressedTextureSize.height<r){i=0;r=0}var s=this._capInsetsPressed;s.x=e;s.y=i;s.width=n;s.height=r;this._buttonClickedRenderer.setCapInsets(s)},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsPressed)},setCapInsetsDisabledRenderer:function(t){if(!t||!this._scale9Enabled)return;var e=t.x,i=t.y;var n=t.width,r=t.height;if(this._disabledTextureSize.width<n){e=0;n=0}if(this._disabledTextureSize.height<r){i=0;r=0}var s=this._capInsetsDisabled;s.x=e;s.y=i;s.width=n;s.height=r;this._buttonDisableRenderer.setCapInsets(s)},getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsDisabled)},_onPressStateChangedToNormal:function(){this._buttonNormalRenderer.setVisible(true);this._buttonClickedRenderer.setVisible(false);this._buttonDisableRenderer.setVisible(false);if(this._scale9Enabled)this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.NORMAL);if(this._pressedTextureLoaded){if(this.pressedActionEnabled){this._buttonNormalRenderer.stopAllActions();this._buttonClickedRenderer.stopAllActions();this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize);this._titleRenderer.stopAllActions();if(this._unifySize){var t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(t)}else{this._titleRenderer.setScaleX(1);this._titleRenderer.setScaleY(1)}}}else{this._buttonNormalRenderer.stopAllActions();this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);this._titleRenderer.stopAllActions();if(this._scale9Enabled)this._buttonNormalRenderer.setColor(cc.color.WHITE);this._titleRenderer.setScaleX(1);this._titleRenderer.setScaleY(1)}},_onPressStateChangedToPressed:function(){var t=this._buttonNormalRenderer;if(this._scale9Enabled)t.setState(ccui.Scale9Sprite.state.NORMAL);if(this._pressedTextureLoaded){t.setVisible(false);this._buttonClickedRenderer.setVisible(true);this._buttonDisableRenderer.setVisible(false);if(this.pressedActionEnabled){t.stopAllActions();this._buttonClickedRenderer.stopAllActions();var e=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale);this._buttonClickedRenderer.runAction(e);t.setScale(this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale);this._titleRenderer.stopAllActions();this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale))}}else{t.setVisible(true);this._buttonClickedRenderer.setVisible(true);this._buttonDisableRenderer.setVisible(false);t.stopAllActions();t.setScale(this._normalTextureScaleXInSize+this._zoomScale,this._normalTextureScaleYInSize+this._zoomScale);this._titleRenderer.stopAllActions();this._titleRenderer.setScaleX(1+this._zoomScale);this._titleRenderer.setScaleY(1+this._zoomScale)}},_onPressStateChangedToDisabled:function(){if(!this._disabledTextureLoaded){if(this._normalTextureLoaded&&this._scale9Enabled)this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.GRAY)}else{this._buttonNormalRenderer.setVisible(false);this._buttonDisableRenderer.setVisible(true)}this._buttonClickedRenderer.setVisible(false);this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var t=this._getNormalSize();ccui.ProtectedNode.setContentSize(t)}this._onSizeChanged();return}if(this._ignoreSize)this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._updateTitleLocation();this._normalTextureAdaptDirty=true;this._pressedTextureAdaptDirty=true;this._disabledTextureAdaptDirty=true},getVirtualRenderer:function(){if(this._bright){switch(this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:return this._buttonNormalRenderer;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:return this._buttonClickedRenderer;default:return null}}else return this._buttonDisableRenderer},_normalTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize){
if(!this._scale9Enabled){this._buttonNormalRenderer.setScale(1);this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1}}else{if(this._scale9Enabled){this._buttonNormalRenderer.setPreferredSize(this._contentSize);this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1;this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize)}else{var t=this._normalTextureSize;if(t.width<=0||t.height<=0){this._buttonNormalRenderer.setScale(1);return}var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._buttonNormalRenderer.setScaleX(e);this._buttonNormalRenderer.setScaleY(i);this._normalTextureScaleXInSize=e;this._normalTextureScaleYInSize=i}}this._buttonNormalRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_pressedTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize){if(!this._scale9Enabled){this._buttonClickedRenderer.setScale(1);this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1}}else{if(this._scale9Enabled){this._buttonClickedRenderer.setPreferredSize(this._contentSize);this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1;this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)}else{var t=this._pressedTextureSize;if(t.width<=0||t.height<=0){this._buttonClickedRenderer.setScale(1);return}var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._buttonClickedRenderer.setScaleX(e);this._buttonClickedRenderer.setScaleY(i);this._pressedTextureScaleXInSize=e;this._pressedTextureScaleYInSize=i}}this._buttonClickedRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_disabledTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize){if(this._scale9Enabled)this._buttonDisableRenderer.setScale(1)}else{if(this._scale9Enabled){this._buttonDisableRenderer.setScale(1);this._buttonDisableRenderer.setPreferredSize(this._contentSize)}else{var t=this._disabledTextureSize;if(t.width<=0||t.height<=0){this._buttonDisableRenderer.setScale(1);return}var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._buttonDisableRenderer.setScaleX(e);this._buttonDisableRenderer.setScaleY(i)}}this._buttonDisableRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){if(this._normalTextureAdaptDirty){this._normalTextureScaleChangedWithSize();this._normalTextureAdaptDirty=false}if(this._pressedTextureAdaptDirty){this._pressedTextureScaleChangedWithSize();this._pressedTextureAdaptDirty=false}if(this._disabledTextureAdaptDirty){this._disabledTextureScaleChangedWithSize();this._disabledTextureAdaptDirty=false}},_updateTitleLocation:function(){this._titleRenderer.setPosition(this._contentSize.width*.5,this._contentSize.height*.5)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){if(t===this.getTitleText())return;this._titleRenderer.setString(t);if(this._ignoreSize){var e=this.getVirtualRendererSize();this.setContentSize(e)}else{this._titleRenderer._renderCmd._updateTTF()}},getTitleText:function(){return this._titleRenderer.getString()},setTitleColor:function(t){this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer._getFillStyle()},setTitleFontSize:function(t){this._titleRenderer.setFontSize(t);this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer.getFontSize()},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._titleRenderer.setFontName(t);this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer.getFontName()},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize;this.setScale9Enabled(t._scale9Enabled);this.loadTextureNormal(t._normalFileName,t._normalTexType);this.loadTexturePressed(t._clickedFileName,t._pressedTexType);this.loadTextureDisabled(t._disabledFileName,t._disabledTexType);this.setCapInsetsNormalRenderer(t._capInsetsNormal);this.setCapInsetsPressedRenderer(t._capInsetsPressed);this.setCapInsetsDisabledRenderer(t._capInsetsDisabled);this.setTitleText(t.getTitleText());this.setTitleFontName(t.getTitleFontName());this.setTitleFontSize(t.getTitleFontSize());this.setTitleColor(t.getTitleColor());this.setPressedActionEnabled(t.pressedActionEnabled);this.setZoomScale(t._zoomScale)},_getNormalSize:function(){var t;if(this._titleRenderer!==null)t=this._titleRenderer.getContentSize();var e;if(this._buttonNormalRenderer!==null)e=this._buttonNormalRenderer.getContentSize();var i=t.width>e.width?t.width:e.width;var n=t.height>e.height?t.height:e.height;return cc.size(i,n)}});var _p=ccui.Button.prototype;_p.titleText;cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText);_p.titleFont;cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont);_p.titleFontSize;cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize);_p.titleFontName;cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName);_p.titleColor;cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor);_p=null;ccui.Button.create=function(t,e,i,n){return new ccui.Button(t,e,i,n)};ccui.Button.NORMAL_RENDERER_ZORDER=-2;ccui.Button.PRESSED_RENDERER_ZORDER=-2;ccui.Button.DISABLED_RENDERER_ZORDER=-2;ccui.Button.TITLE_RENDERER_ZORDER=-1;ccui.Button.ZOOM_ACTION_TIME_STEP=.05;ccui.Button.SYSTEM=0;ccui.Button.TTF=1;ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:true,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:true,_backGroundSelectedBoxRendererAdaptDirty:true,_frontCrossRendererAdaptDirty:true,_backGroundBoxDisabledRendererAdaptDirty:true,_frontCrossDisabledRendererAdaptDirty:true,ctor:function(t,e,i,n,r,s){ccui.Widget.prototype.ctor.call(this);this.setTouchEnabled(true);var a=0;for(var o=0;o<arguments.length;o++){var c=typeof arguments[o];if(c==="string"){if(isNaN(arguments[o]-0))a++;else{s=arguments[o];arguments[o]=undefined}}else if(c==="number")a++}switch(a){case 2:s=i;i=e;e=undefined}s=s===undefined?0:s;this.init(t,e,i,n,r,s)},init:function(t,e,i,n,r,s){if(ccui.Widget.prototype.init.call(this)){this._isSelected=true;this.setSelected(false);this.loadTextures(t,e,i,n,r,s);return true}return false},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite;this._backGroundSelectedBoxRenderer=new cc.Sprite;this._frontCrossRenderer=new cc.Sprite;this._backGroundBoxDisabledRenderer=new cc.Sprite;this._frontCrossDisabledRenderer=new cc.Sprite;this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1);this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1);this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1);this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1);this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,i,n,r,s){t&&this.loadTextureBackGround(t,s);e&&this.loadTextureBackGroundSelected(e,s);i&&this.loadTextureFrontCross(i,s);n&&this.loadTextureBackGroundDisabled(n,s);r&&this.loadTextureFrontCrossDisabled(r,s)},loadTextureBackGround:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._backGroundFileName=t;this._backGroundTexType=e;var i=this._backGroundBoxRenderer;if(!i._textureLoaded){i.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize());this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this)}else{this._backGroundBoxRenderer.setContentSize(this._customSize)}switch(this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize());this._backGroundBoxRendererAdaptDirty=true;this._findLayout()},loadTextureBackGroundSelected:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._backGroundSelectedFileName=t;this._backGroundSelectedTexType=e;var i=this._backGroundSelectedBoxRenderer;if(!i._textureLoaded){i.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this)}switch(this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._backGroundSelectedBoxRendererAdaptDirty=true;this._findLayout()},loadTextureFrontCross:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._frontCrossFileName=t;this._frontCrossTexType=e;var i=this;var n=this._frontCrossRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this)}switch(this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._frontCrossRendererAdaptDirty=true;this._findLayout()},loadTextureBackGroundDisabled:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._backGroundDisabledFileName=t;this._backGroundDisabledTexType=e;var i=this;var n=this._backGroundBoxDisabledRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this)}switch(this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._backGroundBoxDisabledRendererAdaptDirty=true;this._findLayout()},loadTextureFrontCrossDisabled:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._frontCrossDisabledFileName=t;this._frontCrossDisabledTexType=e;var i=this;var n=this._frontCrossDisabledRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this)}switch(this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._frontCrossDisabledRendererAdaptDirty=true;this._findLayout()},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(true);this._backGroundSelectedBoxRenderer.setVisible(false);this._backGroundBoxDisabledRenderer.setVisible(false);this._frontCrossDisabledRenderer.setVisible(false);this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);if(this._isSelected){this._frontCrossRenderer.setVisible(true);this._frontCrossRendererAdaptDirty=true}},_onPressStateChangedToPressed:function(){if(!this._backGroundSelectedFileName){this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale);this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale)}else{this._backGroundBoxRenderer.setVisible(false);this._backGroundSelectedBoxRenderer.setVisible(true);this._backGroundBoxDisabledRenderer.setVisible(false);this._frontCrossDisabledRenderer.setVisible(false)}},_onPressStateChangedToDisabled:function(){if(this._backGroundDisabledFileName&&this._frontCrossDisabledFileName){this._backGroundBoxRenderer.setVisible(false);this._backGroundBoxDisabledRenderer.setVisible(true)}this._backGroundSelectedBoxRenderer.setVisible(false);this._frontCrossRenderer.setVisible(false);this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);if(this._isSelected){this._frontCrossDisabledRenderer.setVisible(true);this._frontCrossDisabledRendererAdaptDirty=true}},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){if(t===this._isSelected)return;this._isSelected=t;this._frontCrossRenderer.setVisible(this._isSelected)},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){if(this._checkBoxEventSelector){if(this._checkBoxEventListener)this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED);else this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED)}},_unSelectedEvent:function(){if(this._checkBoxEventSelector){if(this._checkBoxEventListener)this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED);else this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED)}},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this);if(this._isSelected){this.setSelected(false);this._unSelectedEvent()}else{this.setSelected(true);this._selectedEvent()}},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t;this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._backGroundBoxRendererAdaptDirty=true;this._backGroundSelectedBoxRendererAdaptDirty=true;this._frontCrossRendererAdaptDirty=true;this._backGroundBoxDisabledRendererAdaptDirty=true;this._frontCrossDisabledRendererAdaptDirty=true},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize){t.setScale(1);this._backgroundTextureScaleX=this._backgroundTextureScaleY=1}else{var i=t.getContentSize();if(i.width<=0||i.height<=0){t.setScale(1);this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;return}var n=e.width/i.width;var r=e.height/i.height;this._backgroundTextureScaleX=n;this._backgroundTextureScaleY=r;t.setScaleX(n);t.setScaleY(r)}t.setPosition(e.width*.5,e.height*.5)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0){t.setScale(1);return}var n=e.width/i.width;var r=e.height/i.height;t.setScaleX(n);t.setScaleY(r)}t.setPosition(e.width*.5,e.height*.5)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0){t.setScale(1);return}var n=e.width/i.width;var r=e.height/i.height;t.setScaleX(n);t.setScaleY(r)}t.setPosition(e.width*.5,e.height*.5)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0){t.setScale(1);return}var n=e.width/i.width;var r=e.height/i.height;t.setScaleX(n);t.setScaleY(r)}t.setPosition(e.width*.5,e.height*.5)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize){t.setScale(1)}else{var i=t.getContentSize();if(i.width<=0||i.height<=0){t.setScale(1);return}var n=e.width/i.width;var r=e.height/i.height;t.setScaleX(n);t.setScaleY(r)}t.setPosition(e.width*.5,e.height*.5)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(t){if(t instanceof ccui.CheckBox){this.loadTextureBackGround(t._backGroundFileName,t._backGroundTexType);this.loadTextureBackGroundSelected(t._backGroundSelectedFileName,t._backGroundSelectedTexType);this.loadTextureFrontCross(t._frontCrossFileName,t._frontCrossTexType);this.loadTextureBackGroundDisabled(t._backGroundDisabledFileName,t._backGroundDisabledTexType);this.loadTextureFrontCrossDisabled(t._frontCrossDisabledFileName,t._frontCrossDisabledTexType);this.setSelected(t._isSelected);this._checkBoxEventListener=t._checkBoxEventListener;this._checkBoxEventSelector=t._checkBoxEventSelector;this._ccEventCallback=t._ccEventCallback;this._zoomScale=t._zoomScale;this._backgroundTextureScaleX=t._backgroundTextureScaleX;this._backgroundTextureScaleY=t._backgroundTextureScaleY}},_adaptRenderers:function(){if(this._backGroundBoxRendererAdaptDirty){this._backGroundTextureScaleChangedWithSize();this._backGroundBoxRendererAdaptDirty=false}if(this._backGroundSelectedBoxRendererAdaptDirty){this._backGroundSelectedTextureScaleChangedWithSize();this._backGroundSelectedBoxRendererAdaptDirty=false}if(this._frontCrossRendererAdaptDirty){this._frontCrossTextureScaleChangedWithSize();this._frontCrossRendererAdaptDirty=false}if(this._backGroundBoxDisabledRendererAdaptDirty){this._backGroundDisabledTextureScaleChangedWithSize();this._backGroundBoxDisabledRendererAdaptDirty=false}if(this._frontCrossDisabledRendererAdaptDirty){this._frontCrossDisabledTextureScaleChangedWithSize();this._frontCrossDisabledRendererAdaptDirty=false}}});var _p=ccui.CheckBox.prototype;_p.selected;cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);_p=null;ccui.CheckBox.create=function(t,e,i,n,r,s){return new ccui.CheckBox(t,e,i,n,r,s)};ccui.CheckBox.EVENT_SELECTED=0;ccui.CheckBox.EVENT_UNSELECTED=1;ccui.CheckBox.BOX_RENDERER_ZORDER=-1;ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1;ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1;ccui.ImageView=ccui.Widget.extend({_scale9Enabled:false,_prevIgnoreSize:true,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:true,ctor:function(t,e){this._capInsets=cc.rect(0,0,0,0);this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height);ccui.Widget.prototype.ctor.call(this);e=e===undefined?0:e;this._init(t,e)},_init:function(t,e){if(t===undefined)this._imageTexType=ccui.Widget.LOCAL_TEXTURE;else this.loadTexture(t,e)},_initRenderer:function(){this._imageRenderer=new cc.Sprite;this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(t,e){if(!t){return}var i=this;e=e||ccui.Widget.LOCAL_TEXTURE;this._textureFile=t;this._imageTexType=e;var n=i._imageRenderer;if(!n._textureLoaded){n.addEventListener("load",function(){i.loadTexture(i._textureFile,i._imageTexType)})}switch(i._imageTexType){case ccui.Widget.LOCAL_TEXTURE:if(i._scale9Enabled){n.initWithFile(t);n.setCapInsets(i._capInsets)}else{n.initWithFile(t)}break;case ccui.Widget.PLIST_TEXTURE:if(i._scale9Enabled){n.initWithSpriteFrameName(t);n.setCapInsets(i._capInsets)}else{n.initWithSpriteFrameName(t)}break;default:break}i._imageTextureSize=n.getContentSize();this._updateChildrenDisplayedRGBA();i._updateContentSizeWithTextureSize(i._imageTextureSize);i._imageRendererAdaptDirty=true;i._findLayout()},setTextureRect:function(t){if(!this._scale9Enabled)this._imageRenderer.setTextureRect(t)},setScale9Enabled:function(t){if(this._scale9Enabled===t)return;this._scale9Enabled=t;this.removeProtectedChild(this._imageRenderer);this._imageRenderer=null;if(this._scale9Enabled){this._imageRenderer=new ccui.Scale9Sprite}else{this._imageRenderer=new cc.Sprite}this.loadTexture(this._textureFile,this._imageTexType);this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1);if(this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(false);this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets);this._imageRendererAdaptDirty=true},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){if(!this._scale9Enabled||this._scale9Enabled&&!t){ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t);this._prevIgnoreSize=t}},setCapInsets:function(t){if(!t)return;var e=this._capInsets;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height;if(!this._scale9Enabled)return;this._imageRenderer.setCapInsets(t)},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._imageRendererAdaptDirty=true},_adaptRenderers:function(){if(this._imageRendererAdaptDirty){this._imageTextureScaleChangedWithSize();this._imageRendererAdaptDirty=false}},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){if(this._ignoreSize){if(!this._scale9Enabled)this._imageRenderer.setScale(1)}else{if(this._scale9Enabled){this._imageRenderer.setPreferredSize(this._contentSize);this._imageRenderer.setScale(1)}else{var t=this._imageTextureSize;if(t.width<=0||t.height<=0){this._imageRenderer.setScale(1);return}this._imageRenderer.setScaleX(this._contentSize.width/t.width);this._imageRenderer.setScaleY(this._contentSize.height/t.height)}}this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(t){if(t instanceof ccui.ImageView){this._prevIgnoreSize=t._prevIgnoreSize;this.setScale9Enabled(t._scale9Enabled);this.loadTexture(t._textureFile,t._imageTexType);this.setCapInsets(t._capInsets)}},setContentSize:function(t,e){if(e!=null)t=cc.size(t,e);ccui.Widget.prototype.setContentSize.call(this,t);if(!this._scale9Enabled){var i=this._imageRenderer.getContentSize();this._imageRenderer.setScaleX(t.width/i.width);this._imageRenderer.setScaleY(t.height/i.height)}else{this._imageRenderer.setContentSize(t)}}});ccui.ImageView.create=function(t,e){return new ccui.ImageView(t,e)};ccui.ImageView.RENDERER_ZORDER=-1;ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:false,_prevIgnoreSize:true,_capInsets:null,_textureFile:"",_isTextureLoaded:false,_className:"LoadingBar",_barRendererAdaptDirty:true,ctor:function(t,e){this._direction=ccui.LoadingBar.TYPE_LEFT;this._barRendererTextureSize=cc.size(0,0);this._capInsets=cc.rect(0,0,0,0);ccui.Widget.prototype.ctor.call(this);if(t!==undefined)this.loadTexture(t);if(e!==undefined)this.setPercent(e)},_initRenderer:function(){this._barRenderer=new cc.Sprite;this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1);this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(t){if(this._direction===t)return;this._direction=t;switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,.5);this._barRenderer.setPosition(0,this._contentSize.height*.5);if(!this._scale9Enabled)this._barRenderer.setFlippedX(false);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,.5);this._barRenderer.setPosition(this._totalLength,this._contentSize.height*.5);if(!this._scale9Enabled)this._barRenderer.setFlippedX(true);break}},getDirection:function(){return this._direction},loadTexture:function(t,e){if(!t)return;e=e||ccui.Widget.LOCAL_TEXTURE;this._renderBarTexType=e;this._textureFile=t;var i=this._barRenderer;var n=this;if(!i._textureLoaded){i.addEventListener("load",function(){n.loadTexture(n._textureFile,n._renderBarTexType);n._setPercent(n._percent)})}switch(this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}var r=i.getContentSize();this._barRendererTextureSize.width=r.width;this._barRendererTextureSize.height=r.height;switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:i.setAnchorPoint(0,.5);if(!this._scale9Enabled)i.setFlippedX(false);break;case ccui.LoadingBar.TYPE_RIGHT:i.setAnchorPoint(1,.5);if(!this._scale9Enabled)i.setFlippedX(true);break}if(this._scale9Enabled)i.setCapInsets(this._capInsets);this._updateChildrenDisplayedRGBA();this._barRendererScaleChangedWithSize();this._updateContentSizeWithTextureSize(this._barRendererTextureSize);this._barRendererAdaptDirty=true;this._findLayout()},setScale9Enabled:function(t){if(this._scale9Enabled===t)return;this._scale9Enabled=t;this.removeProtectedChild(this._barRenderer);this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite;this.loadTexture(this._textureFile,this._renderBarTexType);this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1);if(this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(false);this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets);this.setPercent(this._percent);this._barRendererAdaptDirty=true},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(t){if(!t)return;var e=this._capInsets;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height;if(this._scale9Enabled)this._barRenderer.setCapInsets(t)},getCapInsets:function(){return cc.rect(this._capInsets)},setPercent:function(t){if(t>100)t=100;if(t<0)t=0;if(t===this._percent)return;this._percent=t;this._setPercent(t)},_setPercent:function(){var t,e,i,n;if(this._totalLength<=0)return;t=this._percent/100;if(this._scale9Enabled)this._setScale9Scale();else{i=this._barRenderer;n=this._barRendererTextureSize;e=i.getTextureRect();e.width=n.width*t;i.setTextureRect(cc.rect(e.x,e.y,n.width*t,n.height),i._rectRotated)}},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e);this._totalLength=e===undefined?t.width:t},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._barRendererAdaptDirty=true},_adaptRenderers:function(){if(this._barRendererAdaptDirty){this._barRendererScaleChangedWithSize();this._barRendererAdaptDirty=false}},ignoreContentAdaptWithSize:function(t){if(!this._scale9Enabled||this._scale9Enabled&&!t){ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t);this._prevIgnoreSize=t}},getVirtualRendererSize:function(){return cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var t=this._barRenderer,e=this._contentSize;if(this._unifySize){this._totalLength=this._contentSize.width;this.setPercent(this._percent)}else if(this._ignoreSize){if(!this._scale9Enabled){this._totalLength=this._barRendererTextureSize.width;t.setScale(1)}}else{this._totalLength=e.width;if(this._scale9Enabled){this._setScale9Scale();t.setScale(1)}else{var i=this._barRendererTextureSize;if(i.width<=0||i.height<=0){t.setScale(1);return}var n=e.width/i.width;var r=e.height/i.height;t.setScaleX(n);t.setScaleY(r)}}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:t.setPosition(0,e.height*.5);break;case ccui.LoadingBar.TYPE_RIGHT:t.setPosition(this._totalLength,e.height*.5);break;default:break}},_setScale9Scale:function(){var t=this._percent/100*this._totalLength;this._barRenderer.setPreferredSize(cc.size(t,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(t){if(t instanceof ccui.LoadingBar){this._prevIgnoreSize=t._prevIgnoreSize;this.setScale9Enabled(t._scale9Enabled);this.loadTexture(t._textureFile,t._renderBarTexType);this.setCapInsets(t._capInsets);this.setPercent(t._percent);this.setDirection(t._direction)}}});var _p=ccui.LoadingBar.prototype;_p.direction;cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);_p.percent;cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.LoadingBar.create=function(t,e){return new ccui.LoadingBar(t,e)};ccui.LoadingBar.TYPE_LEFT=0;ccui.LoadingBar.TYPE_RIGHT=1;ccui.LoadingBar.RENDERER_ZORDER=-1;ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:false,_prevIgnoreSize:true,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:false,_className:"Slider",_barRendererAdaptDirty:true,_progressBarRendererDirty:true,_unifySize:false,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(t,e,i){this._barTextureSize=cc.size(0,0);this._progressBarTextureSize=cc.size(0,0);this._capInsetsBarRenderer=cc.rect(0,0,0,0);this._capInsetsProgressBarRenderer=cc.rect(0,0,0,0);ccui.Widget.prototype.ctor.call(this);i=i==null?0:i;this.setTouchEnabled(true);t&&this.loadBarTexture(t,i);e&&this.loadSlidBallTextures(e,i)},init:function(){return ccui.Widget.prototype.init.call(this)},_initRenderer:function(){this._barRenderer=new cc.Sprite;this._progressBarRenderer=new cc.Sprite;this._progressBarRenderer.setAnchorPoint(0,.5);this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1);this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1);this._slidBallNormalRenderer=new cc.Sprite;this._slidBallPressedRenderer=new cc.Sprite;this._slidBallPressedRenderer.setVisible(false);this._slidBallDisabledRenderer=new cc.Sprite;this._slidBallDisabledRenderer.setVisible(false);this._slidBallRenderer=new cc.Node;this._slidBallRenderer.addChild(this._slidBallNormalRenderer);this._slidBallRenderer.addChild(this._slidBallPressedRenderer);this._slidBallRenderer.addChild(this._slidBallDisabledRenderer);this._slidBallRenderer.setCascadeColorEnabled(true);this._slidBallRenderer.setCascadeOpacityEnabled(true);this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(t,e){if(!t){return}e=e||ccui.Widget.LOCAL_TEXTURE;this._textureFile=t;this._barTexType=e;var i=this._barRenderer;
var n=this;if(!i._textureLoaded){i.addEventListener("load",function(){n.loadBarTexture(n._textureFile,n._barTexType)})}switch(this._barTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._barRendererAdaptDirty=true;this._progressBarRendererDirty=true;this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize());this._findLayout();this._barTextureSize=this._barRenderer.getContentSize()},loadProgressBarTexture:function(t,e){if(!t){return}e=e||ccui.Widget.LOCAL_TEXTURE;this._progressBarTextureFile=t;this._progressBarTexType=e;var i=this._progressBarRenderer;var n=this;if(!i._textureLoaded){i.addEventListener("load",function(){n.loadProgressBarTexture(n._progressBarTextureFile,n._progressBarTexType)})}switch(this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._progressBarRenderer.setAnchorPoint(cc.p(0,.5));var r=this._progressBarRenderer.getContentSize();this._progressBarTextureSize={width:r.width,height:r.height};this._progressBarRendererDirty=true;this._findLayout()},setScale9Enabled:function(t){if(this._scale9Enabled===t)return;this._scale9Enabled=t;this.removeProtectedChild(this._barRenderer,true);this.removeProtectedChild(this._progressBarRenderer,true);this._barRenderer=null;this._progressBarRenderer=null;if(this._scale9Enabled){this._barRenderer=new ccui.Scale9Sprite;this._progressBarRenderer=new ccui.Scale9Sprite}else{this._barRenderer=new cc.Sprite;this._progressBarRenderer=new cc.Sprite}this.loadBarTexture(this._textureFile,this._barTexType);this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType);this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1);this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1);if(this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(false);this._prevIgnoreSize=e}else{this.ignoreContentAdaptWithSize(this._prevIgnoreSize)}this.setCapInsetsBarRenderer(this._capInsetsBarRenderer);this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer);this._barRendererAdaptDirty=true;this._progressBarRendererDirty=true},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){if(!this._scale9Enabled||this._scale9Enabled&&!t){ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t);this._prevIgnoreSize=t}},setCapInsets:function(t){this.setCapInsetsBarRenderer(t);this.setCapInsetProgressBarRenderer(t)},setCapInsetsBarRenderer:function(t){if(!t)return;var e=this._capInsetsBarRenderer;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height;if(!this._scale9Enabled)return;this._barRenderer.setCapInsets(t)},getCapInsetsBarRenderer:function(){return cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(t){if(!t)return;var e=this._capInsetsProgressBarRenderer;e.x=t.x;e.y=t.y;e.width=t.width;e.height=t.height;if(!this._scale9Enabled)return;this._progressBarRenderer.setCapInsets(t)},getCapInsetsProgressBarRenderer:function(){return cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(t,e,i,n){this.loadSlidBallTextureNormal(t,n);this.loadSlidBallTexturePressed(e,n);this.loadSlidBallTextureDisabled(i,n)},loadSlidBallTextureNormal:function(t,e){if(!t){return}e=e||ccui.Widget.LOCAL_TEXTURE;this._slidBallNormalTextureFile=t;this._ballNTexType=e;var i=this;if(!this._slidBallNormalRenderer._textureLoaded){this._slidBallNormalRenderer.addEventListener("load",function(){i.loadSlidBallTextureNormal(i._slidBallNormalTextureFile,i._ballNTexType)})}switch(this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._findLayout()},loadSlidBallTexturePressed:function(t,e){if(!t){return}e=e||ccui.Widget.LOCAL_TEXTURE;this._slidBallPressedTextureFile=t;this._ballPTexType=e;var i=this;if(!this._slidBallPressedRenderer._textureLoaded){this._slidBallPressedRenderer.addEventListener("load",function(){i.loadSlidBallTexturePressed(i._slidBallPressedTextureFile,i._ballPTexType)})}switch(this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._findLayout()},loadSlidBallTextureDisabled:function(t,e){if(!t){return}e=e||ccui.Widget.LOCAL_TEXTURE;this._slidBallDisabledTextureFile=t;this._ballDTexType=e;var i=this;if(!this._slidBallDisabledRenderer._textureLoaded){this._slidBallDisabledRenderer.addEventListener("load",function(){i.loadSlidBallTextureDisabled(i._slidBallDisabledTextureFile,i._ballDTexType)})}switch(this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(t);break;default:break}this._updateChildrenDisplayedRGBA();this._findLayout()},setPercent:function(t){if(t>100)t=100;if(t<0)t=0;this._percent=t;var e=t/100;var i=this._barLength*e;this._slidBallRenderer.setPosition(i,this._contentSize.height/2);if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(cc.size(i,this._contentSize.height));else{var n=this._progressBarRenderer;var r=n.getTextureRect();n.setTextureRect(cc.rect(r.x,r.y,i/n._scaleX,r.height),n.isTextureRectRotated())}},hitTest:function(t){var e=this._slidBallNormalRenderer.convertToNodeSpace(t);var i=this._slidBallNormalRenderer.getContentSize();var n=cc.rect(0,0,i.width,i.height);return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height},onTouchBegan:function(t,e){var i=ccui.Widget.prototype.onTouchBegan.call(this,t,e);if(this._hit){var n=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(n.x));this._percentChangedEvent()}return i},onTouchMoved:function(t,e){var i=t.getLocation();var n=this.convertToNodeSpace(i);this.setPercent(this._getPercentWithBallPos(n.x));this._percentChangedEvent()},onTouchEnded:function(t,e){ccui.Widget.prototype.onTouchEnded.call(this,t,e)},onTouchCancelled:function(t,e){ccui.Widget.prototype.onTouchCancelled.call(this,t,e)},_getPercentWithBallPos:function(t){return t/this._barLength*100},addEventListenerSlider:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._sliderEventSelector=t;this._sliderEventListener=e},_percentChangedEvent:function(){if(this._sliderEventSelector){if(this._sliderEventListener)this._sliderEventSelector.call(this._sliderEventListener,this,ccui.Slider.EVENT_PERCENT_CHANGED);else this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._barRendererAdaptDirty=true;this._progressBarRendererDirty=true},_adaptRenderers:function(){if(this._barRendererAdaptDirty){this._barRendererScaleChangedWithSize();this._barRendererAdaptDirty=false}if(this._progressBarRendererDirty){this._progressBarRendererScaleChangedWithSize();this._progressBarRendererDirty=false}},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize){this._barLength=this._contentSize.width;this._barRenderer.setPreferredSize(this._contentSize)}else if(this._ignoreSize){this._barRenderer.setScale(1);this._barLength=this._contentSize.width}else{this._barLength=this._contentSize.width;if(this._scale9Enabled){this._barRenderer.setPreferredSize(this._contentSize);this._barRenderer.setScale(1)}else{var t=this._barTextureSize;if(t.width<=0||t.height<=0){this._barRenderer.setScale(1)}else{var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._barRenderer.setScaleX(e);this._barRenderer.setScaleY(i)}}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2);this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize){this._progressBarRenderer.setPreferredSize(this._contentSize)}else if(this._ignoreSize){if(!this._scale9Enabled){var t=this._progressBarTextureSize;var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e);this._progressBarRenderer.setScaleY(i)}}else{if(this._scale9Enabled){this._progressBarRenderer.setPreferredSize(this._contentSize);this._progressBarRenderer.setScale(1)}else{var t=this._progressBarTextureSize;if(t.width<=0||t.height<=0){this._progressBarRenderer.setScale(1);return}var e=this._contentSize.width/t.width;var i=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e);this._progressBarRenderer.setScaleY(i)}}this._progressBarRenderer.setPosition(0,this._contentSize.height/2);this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(true);this._slidBallPressedRenderer.setVisible(false);this._slidBallDisabledRenderer.setVisible(false);this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY)},_onPressStateChangedToPressed:function(){if(!this._slidBallPressedTextureFile){this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale)}else{this._slidBallNormalRenderer.setVisible(false);this._slidBallPressedRenderer.setVisible(true);this._slidBallDisabledRenderer.setVisible(false)}},_onPressStateChangedToDisabled:function(){if(this._slidBallDisabledTextureFile){this._slidBallNormalRenderer.setVisible(false);this._slidBallDisabledRenderer.setVisible(true)}this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY);this._slidBallPressedRenderer.setVisible(false)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize;this.setScale9Enabled(t._scale9Enabled);this.loadBarTexture(t._textureFile,t._barTexType);this.loadProgressBarTexture(t._progressBarTextureFile,t._progressBarTexType);this.loadSlidBallTextureNormal(t._slidBallNormalTextureFile,t._ballNTexType);this.loadSlidBallTexturePressed(t._slidBallPressedTextureFile,t._ballPTexType);this.loadSlidBallTextureDisabled(t._slidBallDisabledTextureFile,t._ballDTexType);this.setPercent(t.getPercent());this._sliderEventListener=t._sliderEventListener;this._sliderEventSelector=t._sliderEventSelector;this._zoomScale=t._zoomScale;this._ccEventCallback=t._ccEventCallback}});var _p=ccui.Slider.prototype;_p.percent;cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.Slider.create=function(t,e,i){return new ccui.Slider(t,e,i)};ccui.Slider.EVENT_PERCENT_CHANGED=0;ccui.Slider.BASEBAR_RENDERER_ZORDER=-3;ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2;ccui.Slider.BALL_RENDERER_ZORDER=-1;ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:false,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:.5,_labelRenderer:"",_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:true,ctor:function(t,e,i){this._type=ccui.Text.Type.SYSTEM;this._textAreaSize=cc.size(0,0);ccui.Widget.prototype.ctor.call(this);i!==undefined&&this.init(t,e,i)},init:function(t,e,i){if(ccui.Widget.prototype.init.call(this)){if(arguments.length>0){this.setFontName(e);this.setFontSize(i);this.setString(t)}else{this.setFontName(this._fontName)}return true}return false},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF;this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(t){cc.log("Please use the setString");this.setString(t)},setString:function(t){if(t===this._labelRenderer.getString())return;this._labelRenderer.setString(t);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getStringValue:function(){cc.log("Please use the getString");return this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._labelRenderer.setFontSize(t);this._fontSize=t;this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t;this._labelRenderer.setFontName(t);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getFontName:function(){return this._fontName},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);if(e){this._fontSize=parseInt(e[1]);this._fontName=e[2];this._labelRenderer._setFont(t);this._labelScaleChangedWithSize()}},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._labelRenderer.setDimensions(t);if(!this._ignoreSize){this._customSize=t}this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize());this._labelRendererAdaptDirty=true},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){if(!this._touchScaleChangeEnabled)return;this._labelRenderer.setScaleX(this._normalScaleValueX);this._labelRenderer.setScaleY(this._normalScaleValueY)},_onPressStateChangedToPressed:function(){if(!this._touchScaleChangeEnabled)return;this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset);this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset)},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelRendererAdaptDirty=true},_adaptRenderers:function(){if(this._labelRendererAdaptDirty){this._labelScaleChangedWithSize();this._labelRendererAdaptDirty=false}},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();if(!this._ignoreSize){this._labelRenderer.setDimensions(0,0);t=this._labelRenderer.getContentSize();this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)}return t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize){this._labelRenderer.setDimensions(0,0);this._labelRenderer.setScale(1);this._normalScaleValueX=this._normalScaleValueY=1}else{this._labelRenderer.setDimensions(cc.size(t.width,t.height));var e=this._labelRenderer.getContentSize();if(e.width<=0||e.height<=0){this._labelRenderer.setScale(1);return}var i=t.width/e.width;var n=t.height/e.height;this._labelRenderer.setScaleX(i);this._labelRenderer.setScaleY(n);this._normalScaleValueX=i;this._normalScaleValueY=n}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,i){this._labelRenderer.enableShadow(t,e,i)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){if(this._type===ccui.Text.Type.TTF)this._labelRenderer.enableGlow(t)},disableEffect:function(){if(this._labelRenderer.disableEffect)this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(t){if(t instanceof ccui.Text){this.setFontName(t._fontName);this.setFontSize(t.getFontSize());this.setString(t.getString());this.setTouchScaleChangeEnabled(t.touchScaleEnabled);this.setTextAreaSize(t._textAreaSize);this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment());this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment());this.setContentSize(t.getContentSize());this.setTextColor(t.getTextColor())}},_setBoundingWidth:function(t){this._textAreaSize.width=t;this._labelRenderer._setBoundingWidth(t);this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t;this._labelRenderer._setBoundingHeight(t);this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){cc.ProtectedNode.prototype.setColor.call(this,t);this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}});var _p=ccui.Text.prototype;_p.boundingWidth;cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth);_p.boundingHeight;cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight);_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.stringLength;cc.defineGetterSetter(_p,"stringLength",_p.getStringLength);_p.font;cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);_p.fontSize;cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);_p.textAlign;cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment);_p.verticalAlign;cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment);_p=null;ccui.Label=ccui.Text.create=function(t,e,i){return new ccui.Text(t,e,i)};ccui.Text.RENDERER_ZORDER=-1;ccui.Text.Type={SYSTEM:0,TTF:1};ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(t,e,i,n,r){ccui.Widget.prototype.ctor.call(this);r!==undefined&&this.setProperty(t,e,i,n,r)},_initRenderer:function(){this._labelAtlasRenderer=new cc.LabelAtlas;this._labelAtlasRenderer.setAnchorPoint(cc.p(.5,.5));this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,-1)},setProperty:function(t,e,i,n,r){this._stringValue=t;this._charMapFileName=e;this._itemWidth=i;this._itemHeight=n;this._startCharMap=r;this._labelAtlasRenderer.initWithString(t,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]);this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize());this._labelAtlasRendererAdaptDirty=true},setString:function(t){if(t===this._labelAtlasRenderer.getString())return;this._stringValue=t;this._labelAtlasRenderer.setString(t);this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize());this._labelAtlasRendererAdaptDirty=true},setStringValue:function(t){cc.log("Please use the setString");this.setString(t)},getStringValue:function(){cc.log("Please use the getString");return this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelAtlasRendererAdaptDirty=true},_adaptRenderers:function(){if(this._labelAtlasRendererAdaptDirty){this._labelAtlasScaleChangedWithSize();this._labelAtlasRendererAdaptDirty=false}},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var t=this._labelAtlasRenderer;if(this._ignoreSize){t.setScale(1)}else{var e=t.getContentSize();if(e.width<=0||e.height<=0){t.setScale(1);return}t.setScaleX(this._contentSize.width/e.width);t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(t){if(t){this.setProperty(t._stringValue,t._charMapFileName,t._itemWidth,t._itemHeight,t._startCharMap)}},_createCloneInstance:function(){return new ccui.TextAtlas}});var _p=ccui.TextAtlas.prototype;_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextAtlas.create=function(t,e,i,n,r){return new ccui.TextAtlas(t,e,i,n,r)};ccui.TextAtlas.RENDERER_ZORDER=-1;ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:false,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:true,ctor:function(t,e){ccui.Widget.prototype.ctor.call(this);if(e!=undefined){this.setFntFile(e);this.setString(t)}},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont;this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){if(!t)return;this._fntFileName=t;this._fntFileHasInit=true;this._labelBMFontRenderer.initWithString(this._stringValue,t);this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize());this._labelBMFontRendererAdaptDirty=true;var e=this;var i=e._labelBMFontRenderer;if(!i._textureLoaded){i.addEventListener("load",function(){e.setFntFile(e._fntFileName)})}},setText:function(t){cc.log("Please use the setString");this.setString(t)},setString:function(t){if(t===this._labelBMFontRenderer.getString())return;this._stringValue=t;this._labelBMFontRenderer.setString(t);if(!this._fntFileHasInit)return;this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize());this._labelBMFontRendererAdaptDirty=true},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelBMFontRendererAdaptDirty=true},_adaptRenderers:function(){if(this._labelBMFontRendererAdaptDirty){this._labelBMFontScaleChangedWithSize();this._labelBMFontRendererAdaptDirty=false}},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0){t.setScale(1);return}t.setScaleX(this._contentSize.width/e.width);t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName);this.setString(t._stringValue)}});var _p=ccui.TextBMFont.prototype;_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextBMFont.create=function(t,e){return new ccui.TextBMFont(t,e)};ccui.TextBMFont.RENDERER_ZORDER=-1;ccui._TextFieldRenderer=cc.TextFieldTTF.extend({_maxLengthEnabled:false,_maxLength:0,_passwordEnabled:false,_passwordStyleText:"",_attachWithIME:false,_detachWithIME:false,_insertText:false,_deleteBackward:false,_className:"_TextFieldRenderer",ctor:function(){cc.TextFieldTTF.prototype.ctor.call(this);this._maxLengthEnabled=false;this._maxLength=0;this._passwordEnabled=false;this._passwordStyleText="*";this._attachWithIME=false;this._detachWithIME=false;this._insertText=false;this._deleteBackward=false},onEnter:function(){cc.TextFieldTTF.prototype.onEnter.call(this);cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(t){this.setAttachWithIME(true);return false},onTextFieldInsertText:function(t,e,i){if(i===1&&e==="\n")return false;this.setInsertText(true);return this._maxLengthEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength},onTextFieldDeleteBackward:function(t,e,i){this.setDeleteBackward(true);return false},onTextFieldDetachWithIME:function(t){this.setDetachWithIME(true);return false},insertText:function(t,e){var i=t;if(t!=="\n"){if(this._maxLengthEnabled){var n=this.getString().length;if(n>=this._maxLength){if(this._passwordEnabled)this.setPasswordText(this.getString());return}}}cc.TextFieldTTF.prototype.insertText.call(this,i,e);if(this._passwordEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>0)this.setPasswordText(this.getString())},deleteBackward:function(){cc.TextFieldTTF.prototype.deleteBackward.call(this);if(cc.TextFieldTTF.prototype.getCharCount.call(this)>0&&this._passwordEnabled)this.setPasswordText(this._inputText)},openIME:function(){cc.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(t){this._maxLengthEnabled=t},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(t){this._maxLength=t},getMaxLength:function(){return this._maxLength},getCharCount:function(){return cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(t){this._passwordEnabled=t},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(t){if(t.length>1)return;var e=t.charCodeAt(0);if(e<33||e>126)return;this._passwordStyleText=t},setPasswordText:function(t){var e="";var i=t.length;var n=i;if(this._maxLengthEnabled&&i>this._maxLength)n=this._maxLength;for(var r=0;r<n;++r)e+=this._passwordStyleText;cc.LabelTTF.prototype.setString.call(this,e)},setAttachWithIME:function(t){this._attachWithIME=t},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(t){this._detachWithIME=t},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(t){this._insertText=t},getInsertText:function(){return this._insertText},setDeleteBackward:function(t){this._deleteBackward=t},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(t){return false}});ccui._TextFieldRenderer.create=function(t,e,i){var n=new ccui._TextFieldRenderer;if(n&&n.initWithString("",e,i)){if(t)n.setPlaceHolder(t);return n}return null};ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:false,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:true,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(t,e,i){ccui.Widget.prototype.ctor.call(this);if(e)this.setFontName(e);if(i)this.setFontSize(i);if(t)this.setPlaceHolder(t)},init:function(){if(ccui.Widget.prototype.init.call(this)){this.setTouchEnabled(true);return true}return false},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20);this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(t){this._touchWidth=t.width;this._touchHeight=t.height},setTouchAreaEnabled:function(t){this._useTouchArea=t},hitTest:function(t){if(this._useTouchArea){var e=this.convertToNodeSpace(t);var i=cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}else return ccui.Widget.prototype.hitTest.call(this,t)},getTouchSize:function(){return cc.size(this._touchWidth,this._touchHeight)},setText:function(t){cc.log("Please use the setString");this.setString(t)},setString:function(t){if(t==null)return;t=String(t);if(this.isMaxLengthEnabled())t=t.substr(0,this.getMaxLength());if(this.isPasswordEnabled()){this._textFieldRenderer.setPasswordText(t);this._textFieldRenderer.setString("");this._textFieldRenderer.insertText(t,t.length)}else this._textFieldRenderer.setString(t);this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},setPlaceHolder:function(t){this._textFieldRenderer.setPlaceHolder(t);this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(t){this._textFieldRenderer.setColorSpaceHolder(t)},setTextColor:function(t){this._textFieldRenderer.setTextColor(t)},setFontSize:function(t){this._textFieldRenderer.setFontSize(t);this._fontSize=t;this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(t){this._textFieldRenderer.setFontName(t);this._fontName=t;this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){cc.log("Please use the getString");return this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(t,e){var i=this;var n=ccui.Widget.prototype.onTouchBegan.call(i,t,e);if(i._hit){setTimeout(function(){i._textFieldRenderer.attachWithIME()},0)}else{setTimeout(function(){i._textFieldRenderer.detachWithIME()},0)}return n},setMaxLengthEnabled:function(t){this._textFieldRenderer.setMaxLengthEnabled(t)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(t){this._textFieldRenderer.setMaxLength(t);this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(t){this._textFieldRenderer.setPasswordEnabled(t)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(t){this._textFieldRenderer.setPasswordStyleText(t);this._passwordStyleText=t;this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(t){if(this.getDetachWithIME()){this._detachWithIMEEvent();this.setDetachWithIME(false)}if(this.getAttachWithIME()){this._attachWithIMEEvent();this.setAttachWithIME(false)}if(this.getInsertText()){this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize());this._insertTextEvent();this.setInsertText(false)}if(this.getDeleteBackward()){this._textFieldRendererAdaptDirty=true;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize());this._deleteBackwardEvent();this.setDeleteBackward(false)}},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(t){
this._textFieldRenderer.setAttachWithIME(t)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(t){this._textFieldRenderer.setDetachWithIME(t)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(t){this._textFieldRenderer.setInsertText(t)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(t){this._textFieldRenderer.setDeleteBackward(t)},_attachWithIMEEvent:function(){if(this._textFieldEventSelector){if(this._textFieldEventListener)this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME);else this._textFieldEventSelector(this,ccui.TextField.EVENT_ATTACH_WITH_IME)}if(this._ccEventCallback){this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)}},_detachWithIMEEvent:function(){if(this._textFieldEventSelector){if(this._textFieldEventListener)this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME);else this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){if(this._textFieldEventSelector){if(this._textFieldEventListener)this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT);else this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){if(this._textFieldEventSelector){if(this._textFieldEventListener)this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD);else this._textFieldEventSelector(this,ccui.TextField.EVENT_DELETE_BACKWARD)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._textFieldEventSelector=t;this._textFieldEventListener=e},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._textFieldRendererAdaptDirty=true},_adaptRenderers:function(){if(this._textFieldRendererAdaptDirty){this._textfieldRendererScaleChangedWithSize();this._textFieldRendererAdaptDirty=false}},_textfieldRendererScaleChangedWithSize:function(){if(!this._ignoreSize)this._textFieldRenderer.setDimensions(this._contentSize);this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var t=this._textFieldRenderer.getContentSize();if(!this._ignoreSize){this._textFieldRenderer.setDimensions(0,0);t=this._textFieldRenderer.getContentSize();this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)}return t},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(t){this.setString(t._textFieldRenderer.getString());this.setPlaceHolder(t.getString());this.setFontSize(t._textFieldRenderer.getFontSize());this.setFontName(t._textFieldRenderer.getFontName());this.setMaxLengthEnabled(t.isMaxLengthEnabled());this.setMaxLength(t.getMaxLength());this.setPasswordEnabled(t.isPasswordEnabled());this.setPasswordStyleText(t._passwordStyleText);this.setAttachWithIME(t.getAttachWithIME());this.setDetachWithIME(t.getDetachWithIME());this.setInsertText(t.getInsertText());this.setDeleteBackward(t.getDeleteBackward());this._ccEventCallback=t._ccEventCallback;this._textFieldEventListener=t._textFieldEventListener;this._textFieldEventSelector=t._textFieldEventSelector},setTextAreaSize:function(t){this.setContentSize(t)},setTextHorizontalAlignment:function(t){this._textFieldRenderer.setHorizontalAlignment(t)},setTextVerticalAlignment:function(t){this._textFieldRenderer.setVerticalAlignment(t)},_setFont:function(t){this._textFieldRenderer._setFont(t);this._textFieldRendererAdaptDirty=true},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}});ccui.TextField.create=function(t,e,i){return new ccui.TextField(t,e,i)};var _p=ccui.TextField.prototype;_p.string;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.placeHolder;cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);_p.font;cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);_p.fontSize;cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);_p.maxLengthEnabled;cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled);_p.maxLength;cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);_p.passwordEnabled;cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled);_p=null;ccui.TextField.EVENT_ATTACH_WITH_IME=0;ccui.TextField.EVENT_DETACH_WITH_IME=1;ccui.TextField.EVENT_INSERT_TEXT=2;ccui.TextField.EVENT_DELETE_BACKWARD=3;ccui.TextField.RENDERER_ZORDER=-1;ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(){this._type=0;this._tag=0;this._color=cc.color(255,255,255,255)},init:function(t,e,i){this._tag=t;this._color.r=e.r;this._color.g=e.g;this._color.b=e.b;this._opacity=i;if(i===undefined)this._color.a=e.a;else this._color.a=i}});ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(t,e,i,n,r,s){ccui.RichElement.prototype.ctor.call(this);this._type=ccui.RichElement.TEXT;this._text="";this._fontName="";this._fontSize=0;if(e&&e instanceof cc.FontDefinition)this.initWithStringAndTextDefinition(t,n,e,i);else s&&this.init(t,e,i,n,r,s)},init:function(t,e,i,n,r,s){ccui.RichElement.prototype.init.call(this,t,e,i);this._text=n;this._fontName=r;this._fontSize=s},initWithStringAndTextDefinition:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,i.fillStyle,n);this._fontDefinition=i;this._text=e;this._fontName=i.fontName;this._fontSize=i.fontSize}});ccui.RichElementText.create=function(t,e,i,n,r,s){return new ccui.RichElementText(t,e,i,n,r,s)};ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this);this._type=ccui.RichElement.IMAGE;this._filePath="";this._textureRect=cc.rect(0,0,0,0);this._textureType=0;n!==undefined&&this.init(t,e,i,n)},init:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,e,i);this._filePath=n}});ccui.RichElementImage.create=function(t,e,i,n){return new ccui.RichElementImage(t,e,i,n)};ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this);this._type=ccui.RichElement.CUSTOM;this._customNode=null;n!==undefined&&this.init(t,e,i,n)},init:function(t,e,i,n){ccui.RichElement.prototype.init.call(this,t,e,i);this._customNode=n}});ccui.RichElementCustomNode.create=function(t,e,i,n){return new ccui.RichElementCustomNode(t,e,i,n)};ccui.RichText=ccui.Widget.extend({_formatTextDirty:false,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:false,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this);this._formatTextDirty=false;this._richElements=[];this._elementRenders=[];this._leftSpaceWidth=0;this._verticalSpace=0;this._textHorizontalAlignment=cc.TEXT_ALIGNMENT_LEFT;this._textVerticalAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP},_initRenderer:function(){this._elementRenderersContainer=new cc.Node;this._elementRenderersContainer.setAnchorPoint(.5,.5);this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(t,e){this._richElements.splice(e,0,t);this._formatTextDirty=true},pushBackElement:function(t){this._richElements.push(t);this._formatTextDirty=true},removeElement:function(t){if(cc.isNumber(t))this._richElements.splice(t,1);else cc.arrayRemoveObject(this._richElements,t);this._formatTextDirty=true},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren();this._elementRenders.length=0;var t,e,i=this._richElements;if(this._ignoreSize){this._addNewLine();for(t=0;t<i.length;t++){e=i[t];var n=null;switch(e._type){case ccui.RichElement.TEXT:if(e._fontDefinition)n=new cc.LabelTTF(e._text,e._fontDefinition);else n=new cc.LabelTTF(e._text,e._fontName,e._fontSize);break;case ccui.RichElement.IMAGE:n=new cc.Sprite(e._filePath);break;case ccui.RichElement.CUSTOM:n=e._customNode;break;default:break}n.setColor(e._color);n.setOpacity(e._color.a);this._pushToContainer(n)}}else{this._addNewLine();for(t=0;t<i.length;t++){e=i[t];switch(e._type){case ccui.RichElement.TEXT:if(e._fontDefinition)this._handleTextRenderer(e._text,e._fontDefinition,e._fontDefinition.fontSize,e._fontDefinition.fillStyle);else this._handleTextRenderer(e._text,e._fontName,e._fontSize,e._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(e._filePath,e._color,e._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(e._customNode);break;default:break}}}this.formatRenderers();this._formatTextDirty=false}},_handleTextRenderer:function(t,e,i,n){if(t==="")return;if(t==="\n"){this._addNewLine();return}var r=e instanceof cc.FontDefinition?new cc.LabelTTF(t,e):new cc.LabelTTF(t,e,i);var s=r.getContentSize().width;this._leftSpaceWidth-=s;if(this._leftSpaceWidth<0){var a=-this._leftSpaceWidth/s;var o=t;var c=o.length;var l=c*(1-a);var h=o.substr(0,l);var u=o.substr(l,o.length-1);var d=l>0;if(this._lineBreakOnSpace){var _=h.lastIndexOf(" ");l=_===-1?l:_+1;u=o.substr(l,o.length-1);d=l>0&&u!==" "}if(d){var f=null;if(e instanceof cc.FontDefinition){f=new cc.LabelTTF(h.substr(0,l),e);f.setOpacity(e.fillStyle.a)}else{f=new cc.LabelTTF(h.substr(0,l),e,i);f.setColor(n);f.setOpacity(n.a)}this._pushToContainer(f)}this._addNewLine();this._handleTextRenderer(u,e,i,n)}else{if(e instanceof cc.FontDefinition){r.setOpacity(e.fillStyle.a)}else{r.setColor(n);r.setOpacity(n.a)}this._pushToContainer(r)}},_handleImageRenderer:function(t,e,i){var n=new cc.Sprite(t);this._handleCustomRenderer(n)},_handleCustomRenderer:function(t){var e=t.getContentSize();this._leftSpaceWidth-=e.width;if(this._leftSpaceWidth<0){this._addNewLine();this._pushToContainer(t);this._leftSpaceWidth-=e.width}else this._pushToContainer(t)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width;this._elementRenders.push([])},formatRenderers:function(){var t=0,e=this._elementRenderersContainer;var i=this._elementRenders;var n,r,s,a,o;var c,l;if(this._ignoreSize){var h=0;s=i[0];a=0;for(r=0;r<s.length;r++){o=s[r];o.setAnchorPoint(cc.p(0,0));o.setPosition(a,0);e.addChild(o,1,r);c=o.getLineHeight?o.getLineHeight():t;var u=o.getContentSize();h+=u.width;t=Math.max(Math.min(t,c),u.height);a+=u.width}if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT){l=0;if(this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT)l=this._contentSize.width-a;else if(this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER)l=(this._contentSize.width-a)/2;for(r=0;r<s.length;r++)s[r].x+=l}e.setContentSize(h,t)}else{var d=[];for(n=0;n<i.length;n++){s=i[n];var _=0;for(r=0;r<s.length;r++){o=s[r];c=o.getLineHeight?o.getLineHeight():o.getContentSize().height;_=Math.max(Math.min(o.getContentSize().height,c),_)}d[n]=_;t+=d[n]}var f=this._customSize.height;for(n=0;n<i.length;n++){s=i[n];a=0;f-=d[n]+this._verticalSpace;for(r=0;r<s.length;r++){o=s[r];o.setAnchorPoint(cc.p(0,0));o.setPosition(cc.p(a,f));e.addChild(o,1);a+=o.getContentSize().width}if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==cc.VERTICAL_TEXT_ALIGNMENT_TOP){l=0;if(this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT)l=this._contentSize.width-a;else if(this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER)l=(this._contentSize.width-a)/2;var p=0;if(this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM)p=this._customSize.height-t;else if(this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER)p=(this._customSize.height-t)/2;for(r=0;r<s.length;r++){o=s[r];o.x+=l;o.y-=p}}}e.setContentSize(this._contentSize)}var m=i.length;for(n=0;n<m;n++){i[n].length=0}this._elementRenders.length=0;this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize);this._updateContentSizeWithTextureSize(this._contentSize);e.setPosition(this._contentSize.width*.5,this._contentSize.height*.5)},_pushToContainer:function(t){if(this._elementRenders.length<=0)return;this._elementRenders[this._elementRenders.length-1].push(t)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(t){this._verticalSpace=t},setAnchorPoint:function(t){ccui.Widget.prototype.setAnchorPoint.call(this,t);this._elementRenderersContainer.setAnchorPoint(t)},_setAnchorX:function(t){ccui.Widget.prototype._setAnchorX.call(this,t);this._elementRenderersContainer._setAnchorX(t)},_setAnchorY:function(t){ccui.Widget.prototype._setAnchorY.call(this,t);this._elementRenderersContainer._setAnchorY(t)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(t){if(this._ignoreSize!==t){this._formatTextDirty=true;ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t)}},getContentSize:function(){this.formatText();return cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){this.formatText();return cc.Node.prototype._getWidth.call(this)},_getHeight:function(){this.formatText();return cc.Node.prototype._getHeight.call(this)},setContentSize:function(t,e){var i=e===undefined?t.width:t;var n=e===undefined?t.height:e;ccui.Widget.prototype.setContentSize.call(this,i,n);this._formatTextDirty=true},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(t){this._super(t);this._elementRenderersContainer.setCascadeOpacityEnabled(t)},setLineBreakOnSpace:function(t){this._lineBreakOnSpace=t;this._formatTextDirty=true;this.formatText()},setTextHorizontalAlignment:function(t){if(t!==this._textHorizontalAlignment){this._textHorizontalAlignment=t;this.formatText()}},setTextVerticalAlignment:function(t){if(t!==this._textVerticalAlignment){this._textVerticalAlignment=t;this.formatText()}}});ccui.RichText.create=function(){return new ccui.RichText};ccui.RichElement.TEXT=0;ccui.RichElement.IMAGE=1;ccui.RichElement.CUSTOM=2;ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,direction:null,_autoScrollDir:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_bounceTopBoundary:0,_bounceBottomBoundary:0,_bounceLeftBoundary:0,_bounceRightBoundary:0,_autoScroll:false,_autoScrollAddUpTime:0,_autoScrollOriginalSpeed:0,_autoScrollAcceleration:0,_isAutoScrollSpeedAttenuated:false,_needCheckAutoScrollDestination:false,_autoScrollDestination:null,_bePressed:false,_slidTime:0,_moveChildPoint:null,_childFocusCancelOffset:0,_leftBounceNeeded:false,_topBounceNeeded:false,_rightBounceNeeded:false,_bottomBounceNeeded:false,bounceEnabled:false,_bouncing:false,_bounceDir:null,_bounceOriginalSpeed:0,inertiaScrollEnabled:false,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this);this.direction=ccui.ScrollView.DIR_NONE;this._autoScrollDir=cc.p(0,0);this._autoScrollAcceleration=-1e3;this._autoScrollDestination=cc.p(0,0);this._slidTime=0;this._moveChildPoint=cc.p(0,0);this._childFocusCancelOffset=5;this._bounceDir=cc.p(0,0);this._bounceOriginalSpeed=0;this.inertiaScrollEnabled=true;this.setTouchEnabled(true)},init:function(){if(ccui.Layout.prototype.init.call(this)){this.setClippingEnabled(true);this._innerContainer.setTouchEnabled(false);return true}return false},onEnter:function(){ccui.Layout.prototype.onEnter.call(this);this.scheduleUpdate(true)},findNextFocusedWidget:function(t,e){if(this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){return this._innerContainer.findNextFocusedWidget(t,e)}else return ccui.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this);this._innerContainer=new ccui.Layout;this._innerContainer.setColor(cc.color(255,255,255));this._innerContainer.setOpacity(255);this._innerContainer.setCascadeColorEnabled(true);this._innerContainer.setCascadeOpacityEnabled(true);this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new ccui.ScrollView.WebGLRenderCmd(this);else return new ccui.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize;this._topBoundary=t.height;this._rightBoundary=t.width;var e=t.width/3;var i=t.height/3;this._bounceTopBoundary=t.height-i;this._bounceBottomBoundary=i;this._bounceLeftBoundary=e;this._bounceRightBoundary=t.width-e;var n=this._innerContainer.getContentSize();this._innerContainer.setContentSize(cc.size(Math.max(n.width,t.width),Math.max(n.height,t.height)));this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height)},setInnerContainerSize:function(t){var e=this._innerContainer,i=this._contentSize,n=i.width,r=i.height,s=e.getContentSize(),a=this._renderCmd,o,c;if(t.width<i.width)cc.log("Inner width <= ScrollView width, it will be force sized!");else n=t.width;if(t.height<i.height)cc.log("Inner height <= ScrollView height, it will be force sized!");else r=t.height;e.setContentSize(cc.size(n,r));switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:o=e.getContentSize();c=s.height-o.height;a.transform(a.getParentRenderCmd(),true);this._scrollChildren(0,c);break;case ccui.ScrollView.DIR_HORIZONTAL:if(e.getRightBoundary()<=i.width){o=e.getContentSize();c=s.width-o.width;a.transform(a.getParentRenderCmd(),true);this._scrollChildren(c,0)}break;case ccui.ScrollView.DIR_BOTH:o=e.getContentSize();var l=s.height-o.height;var h=e.getRightBoundary()<=i.width?s.width-o.width:0;a.transform(a.getParentRenderCmd(),true);this._scrollChildren(h,l);break;default:break}var u=e.getContentSize();var d=e.getPosition();var _=e.getAnchorPoint();if(e.getLeftBoundary()>0)e.setPosition(_.x*u.width,d.y);if(e.getRightBoundary()<i.width)e.setPosition(i.width-(1-_.x)*u.width,d.y);if(d.y>0)e.setPosition(d.x,_.y*u.height);if(e.getTopBoundary()<i.height)e.setPosition(d.x,i.height-(1-_.y)*u.height)},_setInnerWidth:function(t){var e=this._contentSize.width,i=e,n=this._innerContainer,r=n.width;if(t<e)cc.log("Inner width <= scrollview width, it will be force sized!");else i=t;n.width=i;switch(this.direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:if(n.getRightBoundary()<=e){var s=n.width;var a=r-s;this._scrollChildren(a,0)}break}var o=n.anchorX;if(n.getLeftBoundary()>0)n.x=o*i;if(n.getRightBoundary()<e)n.x=e-(1-o)*i},_setInnerHeight:function(t){var e=this._contentSize.height,i=e,n=this._innerContainer,r=n.height;if(t<e)cc.log("Inner height <= scrollview height, it will be force sized!");else i=t;n.height=i;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:var s=i;var a=r-s;this._scrollChildren(0,a);break}var o=n.anchorY;if(n.getLeftBoundary()>0)n.y=o*i;if(n.getRightBoundary()<e)n.y=e-(1-o)*i},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(t){if(!this._clippingEnabled)return true;var e=t._position,i=t._contentSize,n=t._anchorPoint,r=this._customSize,s=this._innerContainer._position,a=0,o=0;if((a=e.y-n.y*i.height)>=r.height-s.y||a+i.height<=-s.y||(o=e.x-n.x*i.width)>=r.width-s.x||o+i.width<=-s.x)return false;else return true},updateChildren:function(){var t,e,i;var n=this._innerContainer._children;for(e=0,i=n.length;e<i;e++){t=n[e];if(t._inViewRect===true&&this._isInContainer(t)===false)t._inViewRect=false;else if(t._inViewRect===false&&this._isInContainer(t)===true)t._inViewRect=true}},addChild:function(t,e,i){if(!t)return false;if(this._isInContainer(t)===false)t._inViewRect=false;e=e||t.getLocalZOrder();i=i||t.getTag();return this._innerContainer.addChild(t,e,i)},removeAllChildren:function(){this.removeAllChildrenWithCleanup(true)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_moveChildren:function(t,e){var i=this._innerContainer;this._moveChildPoint.x=i.x+t;this._moveChildPoint.y=i.y+e;this._innerContainer.setPosition(this._moveChildPoint);if(this._innerContainer._children.length!==0)this.updateChildren()},_autoScrollChildren:function(t){var e=this._autoScrollAddUpTime;this._autoScrollAddUpTime+=t;if(this._isAutoScrollSpeedAttenuated){var i=this._autoScrollOriginalSpeed+this._autoScrollAcceleration*this._autoScrollAddUpTime;if(i<=0){this._stopAutoScrollChildren();this._checkNeedBounce()}else{var n=e*2+t;var r=(this._autoScrollOriginalSpeed+this._autoScrollAcceleration*n*.5)*t;var s=r*this._autoScrollDir.x;var a=r*this._autoScrollDir.y;if(!this._scrollChildren(s,a)){this._stopAutoScrollChildren();this._checkNeedBounce()}}}else{if(this._needCheckAutoScrollDestination){var o=this._autoScrollDir.x*t*this._autoScrollOriginalSpeed;var c=this._autoScrollDir.y*t*this._autoScrollOriginalSpeed;var l=this._checkCustomScrollDestination(o,c);var h=this._scrollChildren(o,c);if(!l||!h){this._stopAutoScrollChildren();this._checkNeedBounce()}}else{if(!this._scrollChildren(this._autoScrollDir.x*t*this._autoScrollOriginalSpeed,this._autoScrollDir.y*t*this._autoScrollOriginalSpeed)){this._stopAutoScrollChildren();this._checkNeedBounce()}}}},_bounceChildren:function(t){var e=this._bounceOriginalSpeed;var i=this._bounceDir;if(e<=0)this._stopBounceChildren();if(!this._bounceScrollChildren(i.x*t*e,i.y*t*e))this._stopBounceChildren()},_checkNeedBounce:function(){if(!this.bounceEnabled)return false;this._checkBounceBoundary();var t=this._topBounceNeeded,e=this._bottomBounceNeeded,i=this._leftBounceNeeded,n=this._rightBounceNeeded;if(t||e||i||n){var r,s;var a=this._contentSize,o=this._innerContainer;if(t&&i){r=cc.pSub(cc.p(0,a.height),cc.p(o.getLeftBoundary(),o.getTopBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(t&&n){r=cc.pSub(cc.p(a.width,a.height),cc.p(o.getRightBoundary(),o.getTopBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(e&&i){r=cc.pSub(cc.p(0,0),cc.p(o.getLeftBoundary(),o.getBottomBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(e&&n){r=cc.pSub(cc.p(a.width,0),cc.p(o.getRightBoundary(),o.getBottomBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(t){r=cc.pSub(cc.p(0,a.height),cc.p(0,o.getTopBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(e){r=cc.pSub(cc.p(0,0),cc.p(0,o.getBottomBoundary()));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(i){r=cc.pSub(cc.p(0,0),cc.p(o.getLeftBoundary(),0));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}else if(n){r=cc.pSub(cc.p(a.width,0),cc.p(o.getRightBoundary(),0));s=cc.pLength(r)/.2;this._bounceDir=cc.pNormalize(r);this._startBounceChildren(s)}return true}return false},_checkBounceBoundary:function(){var t=this._innerContainer;var e=t.getBottomBoundary();if(e>this._bottomBoundary){this._scrollToBottomEvent();this._bottomBounceNeeded=true}else this._bottomBounceNeeded=false;var i=t.getTopBoundary();if(i<this._topBoundary){this._scrollToTopEvent();this._topBounceNeeded=true}else this._topBounceNeeded=false;var n=t.getRightBoundary();if(n<this._rightBoundary){this._scrollToRightEvent();this._rightBounceNeeded=true}else this._rightBounceNeeded=false;var r=t.getLeftBoundary();if(r>this._leftBoundary){this._scrollToLeftEvent();this._leftBounceNeeded=true}else this._leftBounceNeeded=false},_startBounceChildren:function(t){this._bounceOriginalSpeed=t;this._bouncing=true},_stopBounceChildren:function(){this._bouncing=false;this._bounceOriginalSpeed=0;this._leftBounceNeeded=false;this._rightBounceNeeded=false;this._topBounceNeeded=false;this._bottomBounceNeeded=false},_startAutoScrollChildrenWithOriginalSpeed:function(t,e,i,n){this._stopAutoScrollChildren();this._autoScrollDir.x=t.x;this._autoScrollDir.y=t.y;this._isAutoScrollSpeedAttenuated=i;this._autoScrollOriginalSpeed=e;this._autoScroll=true;this._autoScrollAcceleration=n},_startAutoScrollChildrenWithDestination:function(t,e,i){this._needCheckAutoScrollDestination=false;this._autoScrollDestination=t;var n=cc.pSub(t,this._innerContainer.getPosition());var r=cc.pNormalize(n);var s=0;var a=-1e3;var o=cc.pLength(n);if(i){a=-(2*o)/(e*e);s=2*o/e}else{this._needCheckAutoScrollDestination=true;s=o/e}this._startAutoScrollChildrenWithOriginalSpeed(r,s,i,a)},_jumpToDestination:function(t,e){if(t.x!==undefined){e=t.y;t=t.x}var i=t;var n=e;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:if(e<=0)n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height);break;case ccui.ScrollView.DIR_HORIZONTAL:if(t<=0)i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width);break;case ccui.ScrollView.DIR_BOTH:if(e<=0)n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height);if(t<=0)i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width);break;default:break}this._innerContainer.setPosition(i,n)},_stopAutoScrollChildren:function(){this._autoScroll=false;this._autoScrollOriginalSpeed=0;this._autoScrollAddUpTime=0},_bounceScrollChildren:function(t,e){var i=true;var n,r,s,a,o;var c=this._innerContainer;if(t>0&&e>0){n=t;r=e;s=c.getRightBoundary();if(s+n>=this._rightBoundary){n=this._rightBoundary-s;this._bounceRightEvent();i=false}a=c.getTopBoundary();if(a+e>=this._topBoundary){r=this._topBoundary-a;this._bounceTopEvent();i=false}this._moveChildren(n,r)}else if(t<0&&e>0){n=t;r=e;l=c.getLeftBoundary();if(l+n<=this._leftBoundary){n=this._leftBoundary-l;this._bounceLeftEvent();i=false}a=c.getTopBoundary();if(a+e>=this._topBoundary){r=this._topBoundary-a;this._bounceTopEvent();i=false}this._moveChildren(n,r)}else if(t<0&&e<0){n=t;r=e;var l=c.getLeftBoundary();if(l+n<=this._leftBoundary){n=this._leftBoundary-l;this._bounceLeftEvent();i=false}o=c.getBottomBoundary();if(o+e<=this._bottomBoundary){r=this._bottomBoundary-o;this._bounceBottomEvent();i=false}this._moveChildren(n,r)}else if(t>0&&e<0){n=t;r=e;s=c.getRightBoundary();if(s+n>=this._rightBoundary){n=this._rightBoundary-s;this._bounceRightEvent();i=false}o=c.getBottomBoundary();if(o+e<=this._bottomBoundary){r=this._bottomBoundary-o;this._bounceBottomEvent();i=false}this._moveChildren(n,r)}else if(t===0&&e>0){r=e;a=c.getTopBoundary();if(a+e>=this._topBoundary){r=this._topBoundary-a;this._bounceTopEvent();i=false}this._moveChildren(0,r)}else if(t===0&&e<0){r=e;o=c.getBottomBoundary();if(o+e<=this._bottomBoundary){r=this._bottomBoundary-o;this._bounceBottomEvent();i=false}this._moveChildren(0,r)}else if(t>0&&e===0){n=t;s=c.getRightBoundary();if(s+n>=this._rightBoundary){n=this._rightBoundary-s;this._bounceRightEvent();i=false}this._moveChildren(n,0)}else if(t<0&&e===0){n=t;var h=c.getLeftBoundary();if(h+n<=this._leftBoundary){n=this._leftBoundary-h;this._bounceLeftEvent();i=false}this._moveChildren(n,0)}return i},_checkCustomScrollDestination:function(t,e){var i=true;var n,r,s,a;var o=this._innerContainer,c=this._autoScrollDestination;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:if(this._autoScrollDir.y>0){n=o.getBottomBoundary();if(n+e>=c.y){e=c.y-n;i=false}}else{n=o.getBottomBoundary();if(n+e<=c.y){e=c.y-n;i=false}}break;case ccui.ScrollView.DIR_HORIZONTAL:if(this._autoScrollDir.x>0){r=o.getLeftBoundary();if(r+t>=c.x){t=c.x-r;i=false}}else{r=o.getLeftBoundary();if(r+t<=c.x){t=c.x-r;i=false}}break;case ccui.ScrollView.DIR_BOTH:if(t>0&&e>0){r=o.getLeftBoundary();if(r+t>=c.x){t=c.x-r;i=false}n=o.getBottomBoundary();if(n+e>=c.y){e=c.y-n;i=false}}else if(t<0&&e>0){s=o.getRightBoundary();if(s+t<=c.x){t=c.x-s;i=false}n=o.getBottomBoundary();if(n+e>=c.y){e=c.y-n;i=false}}else if(t<0&&e<0){s=o.getRightBoundary();if(s+t<=c.x){t=c.x-s;i=false}a=o.getTopBoundary();if(a+e<=c.y){e=c.y-a;i=false}}else if(t>0&&e<0){r=o.getLeftBoundary();if(r+t>=c.x){t=c.x-r;i=false}a=o.getTopBoundary();if(a+e<=c.y){e=c.y-a;i=false}}else if(t===0&&e>0){n=o.getBottomBoundary();if(n+e>=c.y){e=c.y-n;i=false}}else if(t<0&&e===0){s=o.getRightBoundary();if(s+t<=c.x){t=c.x-s;i=false}}else if(t===0&&e<0){a=o.getTopBoundary();if(a+e<=c.y){e=c.y-a;i=false}}else if(t>0&&e===0){r=o.getLeftBoundary();if(r+t>=c.x){t=c.x-r;i=false}}break;default:break}return i},_scrollChildren:function(t,e){var i=true;this._scrollingEvent();switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:i=this._scrollChildrenVertical(t,e);break;case ccui.ScrollView.DIR_HORIZONTAL:i=this._scrollChildrenHorizontal(t,e);break;case ccui.ScrollView.DIR_BOTH:i=this._scrollChildrenBoth(t,e);break;default:break}return i},_scrollChildrenVertical:function(t,e){var i=e;var n=true;var r,s,a=this._innerContainer;if(this.bounceEnabled){r=a.getBottomBoundary();if(r+e>=this._bounceBottomBoundary){i=this._bounceBottomBoundary-r;this._scrollToBottomEvent();n=false}s=a.getTopBoundary();if(s+e<=this._bounceTopBoundary){i=this._bounceTopBoundary-s;this._scrollToTopEvent();n=false}}else{r=a.getBottomBoundary();if(r+e>=this._bottomBoundary){i=this._bottomBoundary-r;this._scrollToBottomEvent();n=false}s=a.getTopBoundary();if(s+e<=this._topBoundary){i=this._topBoundary-s;this._scrollToTopEvent();n=false}}this._moveChildren(0,i);return n},_scrollChildrenHorizontal:function(t,e){var i=true;var n=t;var r,s,a=this._innerContainer;if(this.bounceEnabled){r=a.getRightBoundary();if(r+t<=this._bounceRightBoundary){n=this._bounceRightBoundary-r;this._scrollToRightEvent();i=false}s=a.getLeftBoundary();if(s+t>=this._bounceLeftBoundary){n=this._bounceLeftBoundary-s;this._scrollToLeftEvent();i=false}}else{r=a.getRightBoundary();if(r+t<=this._rightBoundary){n=this._rightBoundary-r;this._scrollToRightEvent();i=false}s=a.getLeftBoundary();if(s+t>=this._leftBoundary){n=this._leftBoundary-s;this._scrollToLeftEvent();i=false}}this._moveChildren(n,0);return i},_scrollChildrenBoth:function(t,e){var i=true;var n=t;var r=e;var s,a,o,c;var l=this._innerContainer;if(this.bounceEnabled){if(t>0&&e>0){s=l.getLeftBoundary();if(s+t>=this._bounceLeftBoundary){n=this._bounceLeftBoundary-s;this._scrollToLeftEvent();i=false}a=l.getBottomBoundary();if(a+e>=this._bounceBottomBoundary){r=this._bounceBottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e>0){o=l.getRightBoundary();if(o+t<=this._bounceRightBoundary){n=this._bounceRightBoundary-o;this._scrollToRightEvent();i=false}a=l.getBottomBoundary();if(a+e>=this._bounceBottomBoundary){r=this._bounceBottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e<0){o=l.getRightBoundary();if(o+t<=this._bounceRightBoundary){n=this._bounceRightBoundary-o;this._scrollToRightEvent();i=false;
}c=l.getTopBoundary();if(c+e<=this._bounceTopBoundary){r=this._bounceTopBoundary-c;this._scrollToTopEvent();i=false}}else if(t>0&&e<0){s=l.getLeftBoundary();if(s+t>=this._bounceLeftBoundary){n=this._bounceLeftBoundary-s;this._scrollToLeftEvent();i=false}c=l.getTopBoundary();if(c+e<=this._bounceTopBoundary){r=this._bounceTopBoundary-c;this._scrollToTopEvent();i=false}}else if(t===0&&e>0){a=l.getBottomBoundary();if(a+e>=this._bounceBottomBoundary){r=this._bounceBottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e===0){o=l.getRightBoundary();if(o+t<=this._bounceRightBoundary){n=this._bounceRightBoundary-o;this._scrollToRightEvent();i=false}}else if(t===0&&e<0){c=l.getTopBoundary();if(c+e<=this._bounceTopBoundary){r=this._bounceTopBoundary-c;this._scrollToTopEvent();i=false}}else if(t>0&&e===0){s=l.getLeftBoundary();if(s+t>=this._bounceLeftBoundary){n=this._bounceLeftBoundary-s;this._scrollToLeftEvent();i=false}}}else{if(t>0&&e>0){s=l.getLeftBoundary();if(s+t>=this._leftBoundary){n=this._leftBoundary-s;this._scrollToLeftEvent();i=false}a=l.getBottomBoundary();if(a+e>=this._bottomBoundary){r=this._bottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e>0){o=l.getRightBoundary();if(o+t<=this._rightBoundary){n=this._rightBoundary-o;this._scrollToRightEvent();i=false}a=l.getBottomBoundary();if(a+e>=this._bottomBoundary){r=this._bottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e<0){o=l.getRightBoundary();if(o+t<=this._rightBoundary){n=this._rightBoundary-o;this._scrollToRightEvent();i=false}c=l.getTopBoundary();if(c+e<=this._topBoundary){r=this._topBoundary-c;this._scrollToTopEvent();i=false}}else if(t>0&&e<0){s=l.getLeftBoundary();if(s+t>=this._leftBoundary){n=this._leftBoundary-s;this._scrollToLeftEvent();i=false}c=this._innerContainer.getTopBoundary();if(c+e<=this._topBoundary){r=this._topBoundary-c;this._scrollToTopEvent();i=false}}else if(t===0&&e>0){a=this._innerContainer.getBottomBoundary();if(a+e>=this._bottomBoundary){r=this._bottomBoundary-a;this._scrollToBottomEvent();i=false}}else if(t<0&&e===0){o=this._innerContainer.getRightBoundary();if(o+t<=this._rightBoundary){n=this._rightBoundary-o;this._scrollToRightEvent();i=false}}else if(t===0&&e<0){c=this._innerContainer.getTopBoundary();if(c+e<=this._topBoundary){r=this._topBoundary-c;this._scrollToTopEvent();i=false}}else if(t>0&&e===0){s=this._innerContainer.getLeftBoundary();if(s+t>=this._leftBoundary){n=this._leftBoundary-s;this._scrollToLeftEvent();i=false}}}this._moveChildren(n,r);return i},scrollToBottom:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._startAutoScrollChildrenWithDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}var i=this._innerContainer.getContentSize();this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-i.width,this._contentSize.height-i.height),t,e)},scrollToBottomLeft:function(t,e){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._startAutoScrollChildrenWithDestination(cc.p(0,0),t,e)},scrollToBottomRight:function(t,e){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._startAutoScrollChildrenWithDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,i){var n=this._contentSize.height-this._innerContainer.getContentSize().height;var r=-n;this._startAutoScrollChildrenWithDestination(cc.p(this._innerContainer.getPositionX(),n+t*r/100),e,i)},scrollToPercentHorizontal:function(t,e,i){var n=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(cc.p(-(t*n/100),this._innerContainer.getPositionY()),e,i)},scrollToPercentBothDirection:function(t,e,i){if(this.direction!==ccui.ScrollView.DIR_BOTH)return;var n=this._contentSize.height-this._innerContainer.getContentSize().height;var r=-n;var s=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(cc.p(-(t.x*s/100),n+t.y*r/100),e,i)},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}var t=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height)},jumpToBottomLeft:function(){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._jumpToDestination(0,0)},jumpToBottomRight:function(){if(this.direction!==ccui.ScrollView.DIR_BOTH){cc.log("Scroll direction is not both!");return}this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height;var i=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*i/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-(t*e/100),this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){if(this.direction!==ccui.ScrollView.DIR_BOTH)return;var e=this._innerContainer.getContentSize();var i=this._contentSize.height-e.height;var n=-i;var r=e.width-this._contentSize.width;this._jumpToDestination(-(t.x*r/100),i+t.y*n/100)},_startRecordSlidAction:function(){if(this._autoScroll)this._stopAutoScrollChildren();if(this._bouncing)this._stopBounceChildren();this._slidTime=0},_endRecordSlidAction:function(){if(!this._checkNeedBounce()&&this.inertiaScrollEnabled){if(this._slidTime<=.016)return;var t=0,e;var i=this.convertToNodeSpace(this._touchEndPosition);var n=this.convertToNodeSpace(this._touchBeganPosition);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:t=i.y-n.y;e=t<0?ccui.ScrollView.SCROLLDIR_DOWN:ccui.ScrollView.SCROLLDIR_UP;break;case ccui.ScrollView.DIR_HORIZONTAL:t=i.x-n.x;e=t<0?ccui.ScrollView.SCROLLDIR_LEFT:ccui.ScrollView.SCROLLDIR_RIGHT;break;case ccui.ScrollView.DIR_BOTH:var r=cc.pSub(i,n);t=cc.pLength(r);e=cc.pNormalize(r);break;default:e=cc.p(0,0);break}var s=Math.min(Math.abs(t)/this._slidTime,ccui.ScrollView.AUTO_SCROLL_MAX_SPEED);this._startAutoScrollChildrenWithOriginalSpeed(e,s,true,-1e3);this._slidTime=0}},_handlePressLogic:function(t){this._startRecordSlidAction();this._bePressed=true},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),i=this.convertToNodeSpace(t.getPreviousLocation());var n=cc.pSub(e,i);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._scrollChildren(0,n.y);break;case ccui.ScrollView.DIR_HORIZONTAL:this._scrollChildren(n.x,0);break;case ccui.ScrollView.DIR_BOTH:this._scrollChildren(n.x,n.y);break;default:break}},_handleReleaseLogic:function(t){this._endRecordSlidAction();this._bePressed=false},onTouchBegan:function(t,e){var i=ccui.Layout.prototype.onTouchBegan.call(this,t,e);if(!this._isInterceptTouch){if(this._hit)this._handlePressLogic(t)}return i},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e);if(!this._isInterceptTouch)this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e);if(!this._isInterceptTouch)this._handleReleaseLogic(t);this._isInterceptTouch=false},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e);if(!this._isInterceptTouch)this.handleReleaseLogic(t);this._isInterceptTouch=false},update:function(t){if(this._autoScroll)this._autoScrollChildren(t);if(this._bouncing)this._bounceChildren(t);this._recordSlidTime(t)},_recordSlidTime:function(t){if(this._bePressed)this._slidTime+=t},interceptTouchEvent:function(t,e,i){if(!this._touchEnabled){ccui.Layout.prototype.interceptTouchEvent.call(this,t,e,i);return}var n=i.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=true;this._touchBeganPosition.x=n.x;this._touchBeganPosition.y=n.y;this._handlePressLogic(i);break;case ccui.Widget.TOUCH_MOVED:var r=cc.pLength(cc.pSub(e.getTouchBeganPosition(),n));this._touchMovePosition.x=n.x;this._touchMovePosition.y=n.y;if(r>this._childFocusCancelOffset){e.setHighlighted(false);this._handleMoveLogic(i)}break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=n.x;this._touchEndPosition.y=n.y;this._handleReleaseLogic(i);if(e.isSwallowTouches())this._isInterceptTouch=false;break}},_scrollToTopEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_TOP);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_TOP)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_TOP)},_scrollToBottomEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM)},_scrollToLeftEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_LEFT)},_scrollToRightEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT)},_scrollingEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_SCROLLING);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_SCROLLING)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_SCROLLING)},_bounceTopEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_TOP);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_TOP)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_TOP)},_bounceBottomEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_BOTTOM)},_bounceLeftEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_LEFT);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_LEFT)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_LEFT)},_bounceRightEvent:function(){if(this._scrollViewEventSelector){if(this._scrollViewEventListener)this._scrollViewEventSelector.call(this._scrollViewEventListener,this,ccui.ScrollView.EVENT_BOUNCE_RIGHT);else this._scrollViewEventSelector(this,ccui.ScrollView.EVENT_BOUNCE_RIGHT)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.ScrollView.EVENT_BOUNCE_RIGHT)},addEventListenerScrollView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._scrollViewEventSelector=t;this._scrollViewEventListener=e},setDirection:function(t){this.direction=t},getDirection:function(){return this.direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){if(!this._doLayoutDirty)return;this._doLayoutDirty=false},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(t){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){if(t instanceof ccui.ScrollView){ccui.Layout.prototype._copySpecialProperties.call(this,t);this.setInnerContainerSize(t.getInnerContainerSize());this.setDirection(t.direction);this.setBounceEnabled(t.bounceEnabled);this.setInertiaScrollEnabled(t.inertiaScrollEnabled);this._scrollViewEventListener=t._scrollViewEventListener;this._scrollViewEventSelector=t._scrollViewEventSelector;this._ccEventCallback=t._ccEventCallback}},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,i){this._innerContainer.addNode(t,e,i)}});var _p=ccui.ScrollView.prototype;_p.innerWidth;cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth);_p.innerHeight;cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight);_p=null;ccui.ScrollView.create=function(){return new ccui.ScrollView};ccui.ScrollView.DIR_NONE=0;ccui.ScrollView.DIR_VERTICAL=1;ccui.ScrollView.DIR_HORIZONTAL=2;ccui.ScrollView.DIR_BOTH=3;ccui.ScrollView.EVENT_SCROLL_TO_TOP=0;ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1;ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2;ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3;ccui.ScrollView.EVENT_SCROLLING=4;ccui.ScrollView.EVENT_BOUNCE_TOP=5;ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6;ccui.ScrollView.EVENT_BOUNCE_LEFT=7;ccui.ScrollView.EVENT_BOUNCE_RIGHT=8;ccui.ScrollView.AUTO_SCROLL_MAX_SPEED=1e3;ccui.ScrollView.SCROLLDIR_UP=cc.p(0,1);ccui.ScrollView.SCROLLDIR_DOWN=cc.p(0,-1);ccui.ScrollView.SCROLLDIR_LEFT=cc.p(-1,0);ccui.ScrollView.SCROLLDIR_RIGHT=cc.p(1,0);(function(){if(!ccui.ProtectedNode.CanvasRenderCmd)return;ccui.ScrollView.CanvasRenderCmd=function(t){ccui.Layout.CanvasRenderCmd.call(this,t);this._needDraw=true;this._dirty=false};var t=ccui.ScrollView.CanvasRenderCmd.prototype=Object.create(ccui.Layout.CanvasRenderCmd.prototype);t.constructor=ccui.ScrollView.CanvasRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;var i=e.__instanceId;cc.renderer.pushRenderCommand(this);cc.renderer._turnToCacheMode(i);ccui.Layout.CanvasRenderCmd.prototype.visit.call(this,t);this._dirtyFlag=0;cc.renderer._turnToNormalMode()};t.rendering=function(t){var e=this._node.__instanceId;var i=cc.renderer._cacheToCanvasCmds[e],n,r,s=cc.view.getScaleX(),a=cc.view.getScaleY();var o=t||cc._renderContext;o.computeRealOffsetY();for(n=0,r=i.length;n<r;n++){var c=i[n]._node;if(c instanceof ccui.ScrollView)continue;if(c&&c._parent&&c._parent._inViewRect===false)continue;i[n].rendering(o,s,a)}}})();ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:true,_listViewEventListener:null,_listViewEventSelector:null,ctor:function(){ccui.ScrollView.prototype.ctor.call(this);this._items=[];this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL;this.setTouchEnabled(true);this.init()},init:function(){if(ccui.ScrollView.prototype.init.call(this)){this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);return true}return false},setItemModel:function(t){if(!t){cc.log("Can't set a null to item model!");return}this._model=t},_updateInnerContainerSize:function(){var t=this._items,e,i;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:e=t.length;var n=(e-1)*this._itemsMargin;for(i=0;i<e;i++){n+=t[i].getContentSize().height}this.setInnerContainerSize(cc.size(this._contentSize.width,n));break;case ccui.ScrollView.DIR_HORIZONTAL:e=t.length;var r=(e-1)*this._itemsMargin;for(i=0;i<e;i++){r+=t[i].getContentSize().width}this.setInnerContainerSize(cc.size(r,this._contentSize.height));break;default:break}},_remedyLayoutParameter:function(t){cc.assert(null!=t,"ListView Item can't be nil!");var e=t.getLayoutParameter();var i=true;if(!e){e=new ccui.LinearLayoutParameter;i=false}var n=this.getIndex(t);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(e,n);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(e,n);break;default:break}if(!i)t.setLayoutParameter(e)},_remedyVerticalLayoutParameter:function(t,e){cc.assert(null!=t,"Layout parameter can't be nil!");switch(this._gravity){case ccui.ListView.GRAVITY_LEFT:t.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:t.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL);break;default:break}if(0===e)t.setMargin(ccui.MarginZero());else t.setMargin(new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(t,e){cc.assert(null!=t,"Layout parameter can't be nil!");switch(this._gravity){case ccui.ListView.GRAVITY_TOP:t.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:t.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL);break;default:break}if(0===e)t.setMargin(ccui.MarginZero());else t.setMargin(new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(this._model==null)return;var t=this._model.clone();this._remedyLayoutParameter(t);this.addChild(t);this._refreshViewDirty=true},insertDefaultItem:function(t){if(this._model==null)return;var e=this._model.clone();this._items.splice(t,0,e);ccui.ScrollView.prototype.addChild.call(this,e);this._remedyLayoutParameter(e);this._refreshViewDirty=true},pushBackCustomItem:function(t){this._remedyLayoutParameter(t);this.addChild(t);this._refreshViewDirty=true},addChild:function(t,e,i){if(t){e=e||t.getLocalZOrder();i=i||t.getName();ccui.ScrollView.prototype.addChild.call(this,t,e,i);if(t instanceof ccui.Widget)this._items.push(t)}},removeChild:function(t,e){if(t){var i=this._items.indexOf(t);if(i>-1)this._items.splice(i,1);ccui.ScrollView.prototype.removeChild.call(this,t,e)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(true)},removeAllChildrenWithCleanup:function(t){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,t);this._items=[]},insertCustomItem:function(t,e){this._items.splice(e,0,t);ccui.ScrollView.prototype.addChild.call(this,t);this._remedyLayoutParameter(t);this._refreshViewDirty=true},removeItem:function(t){var e=this.getItem(t);if(e==null)return;this.removeChild(e,true);this._refreshViewDirty=true},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(t){if(t<0||t>=this._items.length)return null;return this._items[t]},getItems:function(){return this._items},getIndex:function(t){if(t==null)return-1;return this._items.indexOf(t)},setGravity:function(t){if(this._gravity===t)return;this._gravity=t;this._refreshViewDirty=true},setItemsMargin:function(t){if(this._itemsMargin===t)return;this._itemsMargin=t;this._refreshViewDirty=true},getItemsMargin:function(){return this._itemsMargin},setDirection:function(t){switch(t){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:return;default:return;break}ccui.ScrollView.prototype.setDirection.call(this,t)},requestRefreshView:function(){this._refreshViewDirty=true},refreshView:function(){var t=this._items;for(var e=0;e<t.length;e++){var i=t[e];i.setLocalZOrder(e);this._remedyLayoutParameter(i)}this._updateInnerContainerSize()},doLayout:function(){this._doLayout()},_doLayout:function(){ccui.Layout.prototype._doLayout.call(this);if(this._refreshViewDirty){this.refreshView();this._refreshViewDirty=false}},addEventListenerListView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._listViewEventListener=e;this._listViewEventSelector=t},_selectedItemEvent:function(t){var e=t===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END;if(this._listViewEventSelector){if(this._listViewEventListener)this._listViewEventSelector.call(this._listViewEventListener,this,e);else this._listViewEventSelector(this,e)}if(this._ccEventCallback)this._ccEventCallback(this,e)},interceptTouchEvent:function(t,e,i){ccui.ScrollView.prototype.interceptTouchEvent.call(this,t,e,i);if(!this._touchEnabled){return}if(t!==ccui.Widget.TOUCH_MOVED){var n=e;while(n){if(n&&n.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(n);break}n=n.getParent()}if(e.isHighlighted())this._selectedItemEvent(t)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this);this._refreshViewDirty=true},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(t){var e=t.getItems();for(var i=0;i<e.length;i++){var n=e[i];this.pushBackCustomItem(n.clone())}},_copySpecialProperties:function(t){if(t instanceof ccui.ListView){ccui.ScrollView.prototype._copySpecialProperties.call(this,t);this.setItemModel(t._model);this.setItemsMargin(t._itemsMargin);this.setGravity(t._gravity);this._listViewEventListener=t._listViewEventListener;this._listViewEventSelector=t._listViewEventSelector}},forceDoLayout:function(){if(this._refreshViewDirty){this.refreshView();this._refreshViewDirty=false}this._innerContainer.forceDoLayout()}});ccui.ListView.create=function(){return new ccui.ListView};ccui.ListView.EVENT_SELECTED_ITEM=0;ccui.ListView.ON_SELECTED_ITEM_START=0;ccui.ListView.ON_SELECTED_ITEM_END=1;ccui.ListView.GRAVITY_LEFT=0;ccui.ListView.GRAVITY_RIGHT=1;ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2;ccui.ListView.GRAVITY_TOP=3;ccui.ListView.GRAVITY_BOTTOM=4;ccui.ListView.GRAVITY_CENTER_VERTICAL=5;ccui.PageView=ccui.Layout.extend({_curPageIdx:0,_pages:null,_touchMoveDirection:null,_touchStartLocation:0,_touchMoveStartLocation:0,_movePagePoint:null,_leftBoundaryChild:null,_rightBoundaryChild:null,_leftBoundary:0,_rightBoundary:0,_isAutoScrolling:false,_autoScrollDistance:0,_autoScrollSpeed:0,_autoScrollDirection:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_customScrollThreshold:0,_usingCustomScrollThreshold:false,ctor:function(){ccui.Layout.prototype.ctor.call(this);this._pages=[];this._touchMoveDirection=ccui.PageView.TOUCH_DIR_LEFT;this._movePagePoint=null;this._leftBoundaryChild=null;this._rightBoundaryChild=null;this._childFocusCancelOffset=5;this._pageViewEventListener=null;this._pageViewEventSelector=null;this.setTouchEnabled(true)},init:function(){if(ccui.Layout.prototype.init.call(this)){this.setClippingEnabled(true);return true}return false},onEnter:function(){ccui.Layout.prototype.onEnter.call(this);this.scheduleUpdate(true)},addWidgetToPage:function(t,e,i){if(!t||e<0)return;var n=this._getPageCount();if(e<0||e>=n){if(i){if(e>n)cc.log("pageIdx is %d, it will be added as page id [%d]",e,n);var r=this._createPage();r.addChild(t);this.addPage(r)}}else{var s=this._pages[e];if(s)s.addChild(t)}},_createPage:function(){var t=new ccui.Layout;t.setContentSize(this.getContentSize());return t},addPage:function(t){if(!t||this._pages.indexOf(t)!==-1)return;this.addChild(t);this._pages.push(t);this._doLayoutDirty=true},insertPage:function(t,e){if(e<0||!t||this._pages.indexOf(t)!==-1)return;var i=this._getPageCount();if(e>=i)this.addPage(t);else{this._pages[e]=t;this.addChild(t)}this._doLayoutDirty=true},removePage:function(t){if(!t)return;this.removeChild(t);var e=this._pages.indexOf(t);if(e>-1)this._pages.splice(e,1);this._doLayoutDirty=true},removePageAtIndex:function(t){if(t<0||t>=this._pages.length)return;var e=this._pages[t];if(e)this.removePage(e)},removeAllPages:function(){var t=this._pages;for(var e=0,i=t.length;e<i;e++)this.removeChild(t[e]);this._pages.length=0},_updateBoundaryPages:function(){var t=this._pages;if(t.length<=0){this._leftBoundaryChild=null;this._rightBoundaryChild=null;return}this._leftBoundaryChild=t[0];this._rightBoundaryChild=t[t.length-1]},_getPageCount:function(){return this._pages.length},_getPositionXByIndex:function(t){return this.getContentSize().width*(t-this._curPageIdx)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);this._rightBoundary=this.getContentSize().width;this._doLayoutDirty=true},_updateAllPagesSize:function(){var t=this.getContentSize();var e=this._pages;for(var i=0,n=e.length;i<n;i++)e[i].setContentSize(t)},_updateAllPagesPosition:function(){var t=this._getPageCount();if(t<=0){this._curPageIdx=0;return}if(this._curPageIdx>=t)this._curPageIdx=t-1;var e=this.getContentSize().width;var i=this._pages;for(var n=0;n<t;n++)i[n].setPosition(cc.p((n-this._curPageIdx)*e,0))},scrollToPage:function(t){if(t<0||t>=this._pages.length)return;this._curPageIdx=t;var e=this._pages[t];this._autoScrollDistance=-e.getPosition().x;this._autoScrollSpeed=Math.abs(this._autoScrollDistance)/.2;this._autoScrollDirection=this._autoScrollDistance>0?ccui.PageView.DIRECTION_RIGHT:ccui.PageView.DIRECTION_LEFT;this._isAutoScrolling=true},update:function(t){if(this._isAutoScrolling)this._autoScroll(t)},setLayoutType:function(t){},getLayoutType:function(){return ccui.Layout.ABSOLUTE},_autoScroll:function(t){var e;switch(this._autoScrollDirection){case ccui.PageView.DIRECTION_LEFT:e=this._autoScrollSpeed*t;if(this._autoScrollDistance+e>=0){e=-this._autoScrollDistance;this._autoScrollDistance=0;this._isAutoScrolling=false}else this._autoScrollDistance+=e;this._scrollPages(-e);if(!this._isAutoScrolling)this._pageTurningEvent();break;break;case ccui.PageView.DIRECTION_RIGHT:e=this._autoScrollSpeed*t;if(this._autoScrollDistance-e<=0){e=this._autoScrollDistance;this._autoScrollDistance=0;this._isAutoScrolling=false}else this._autoScrollDistance-=e;this._scrollPages(e);if(!this._isAutoScrolling)this._pageTurningEvent();break;default:break}},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e);if(!this._isInterceptTouch)this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e);if(!this._isInterceptTouch)this._handleReleaseLogic(t);this._isInterceptTouch=false},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e);if(!this._isInterceptTouch)this._handleReleaseLogic(t);this._isInterceptTouch=false},_doLayout:function(){if(!this._doLayoutDirty)return;this._updateAllPagesPosition();this._updateAllPagesSize();this._updateBoundaryPages();this._doLayoutDirty=false},_movePages:function(t){var e=this._pages;var i=e.length;for(var n=0;n<i;n++){var r=e[n];r.setPositionX(r.getPositionX()+t)}},_scrollPages:function(t){if(this._pages.length<=0)return false;if(!this._leftBoundaryChild||!this._rightBoundaryChild)return false;var e=t;switch(this._touchMoveDirection){case ccui.PageView.TOUCH_DIR_LEFT:var i=this._rightBoundaryChild.getRightBoundary();if(i+t<=this._rightBoundary){e=this._rightBoundary-i;this._movePages(e);return false}break;case ccui.PageView.TOUCH_DIR_RIGHT:var n=this._leftBoundaryChild.getLeftBoundary();if(n+t>=this._leftBoundary){e=this._leftBoundary-n;this._movePages(e);return false}break;default:break}this._movePages(e);return true},_handleMoveLogic:function(t){var e=t.getLocation().x-t.getPreviousLocation().x;if(e<0)this._touchMoveDirection=ccui.PageView.TOUCH_DIR_LEFT;else if(e>0)this._touchMoveDirection=ccui.PageView.TOUCH_DIR_RIGHT;this._scrollPages(e)},setCustomScrollThreshold:function(t){cc.assert(t>0,"Invalid threshold!");this._customScrollThreshold=t;this.setUsingCustomScrollThreshold(true)},getCustomScrollThreshold:function(){return this._customScrollThreshold},setUsingCustomScrollThreshold:function(t){this._usingCustomScrollThreshold=t},isUsingCustomScrollThreshold:function(){return this._usingCustomScrollThreshold},_handleReleaseLogic:function(t){if(this._pages.length<=0)return;var e=this._pages[this._curPageIdx];if(e){var i=e.getPosition();var n=this._pages.length;var r=i.x;var s=this.getSize().width;if(!this._usingCustomScrollThreshold)this._customScrollThreshold=s/2;var a=this._customScrollThreshold;if(r<=-a){if(this._curPageIdx>=n-1)this._scrollPages(-r);else this.scrollToPage(this._curPageIdx+1)}else if(r>=a){if(this._curPageIdx<=0)this._scrollPages(-r);else this.scrollToPage(this._curPageIdx-1)}else this.scrollToPage(this._curPageIdx)}},interceptTouchEvent:function(t,e,i){if(!this._touchEnabled){ccui.Layout.prototype.interceptTouchEvent.call(this,t,e,i);return}var n=i.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._touchBeganPosition.x=n.x;this._touchBeganPosition.y=n.y;this._isInterceptTouch=true;break;case ccui.Widget.TOUCH_MOVED:this._touchMovePosition.x=n.x;this._touchMovePosition.y=n.y;var r=0;r=Math.abs(e.getTouchBeganPosition().x-n.x);if(r>this._childFocusCancelOffset){e.setHighlighted(false);this._handleMoveLogic(i)}break;case ccui.Widget.TOUCH_ENDED:case ccui.Widget.TOUCH_CANCELED:this._touchEndPosition.x=n.x;this._touchEndPosition.y=n.y;this._handleReleaseLogic(i);if(e.isSwallowTouches())this._isInterceptTouch=false;break}},_pageTurningEvent:function(){if(this._pageViewEventSelector){if(this._pageViewEventListener)this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING);else this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING)}if(this._ccEventCallback)this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._pageViewEventSelector=t;this._pageViewEventListener=e},getCurPageIndex:function(){
return this._curPageIdx},getPages:function(){return this._pages},getPage:function(t){if(t<0||t>=this._pages.length)return null;return this._pages[t]},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(t){var e=t.getPages();for(var i=0;i<e.length;i++){var n=e[i];this.addPage(n.clone())}},_copySpecialProperties:function(t){ccui.Layout.prototype._copySpecialProperties.call(this,t);this._ccEventCallback=t._ccEventCallback;this._pageViewEventListener=t._pageViewEventListener;this._pageViewEventSelector=t._pageViewEventSelector;this._usingCustomScrollThreshold=t._usingCustomScrollThreshold;this._customScrollThreshold=t._customScrollThreshold}});ccui.PageView.create=function(){return new ccui.PageView};ccui.PageView.EVENT_TURNING=0;ccui.PageView.TOUCH_DIR_LEFT=0;ccui.PageView.TOUCH_DIR_RIGHT=1;ccui.PageView.DIRECTION_LEFT=0;ccui.PageView.DIRECTION_RIGHT=1;ccui.VideoPlayer=ccui.Widget.extend({_played:false,_playing:false,_stopped:true,ctor:function(t){ccui.Widget.prototype.ctor.call(this);this._EventList={};if(t)this.setURL(t)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){var t=this,e=this._renderCmd._video;if(e){this._played=true;e.pause();if(this._stopped!==false||this._playing!==false||this._played!==true)e.currentTime=0;if(ccui.VideoPlayer._polyfill.autoplayAfterOperation){setTimeout(function(){e.play();t._playing=true;t._stopped=false},20)}else{e.play();this._playing=true;this._stopped=false}}},pause:function(){var t=this._renderCmd._video;if(t&&this._playing===true&&this._stopped===false){t.pause();this._playing=false}},resume:function(){if(this._stopped===false&&this._playing===false&&this._played===true){this.play()}},stop:function(){var t=this,e=this._renderCmd._video;if(e){e.pause();e.currentTime=0;this._playing=false;this._stopped=true}setTimeout(function(){t._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(t){var e=this._renderCmd._video;if(e){e.currentTime=t;if(ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()){setTimeout(function(){e.play()},20)}}},isPlaying:function(){if(ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing){setTimeout(function(){video.play()},20)}return this._playing},setKeepAspectRatioEnabled:function(t){cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return false},setFullScreenEnabled:function(t){var e=this._renderCmd._video;if(e){if(t)cc.screen.requestFullScreen(e);else cc.screen.exitFullScreen(e)}},isFullScreenEnabled:function(){cc.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];if(e)e.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(t)for(var e=0;e<t.length;e++)t[e].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e);if(e===undefined){e=t.height;t=t.width}this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom();this.stopAllActions();this.unscheduleAllCallbacks()},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);var t=ccui.VideoPlayer.elements;if(t.indexOf(this)===-1)t.push(this)},onExit:function(){ccui.Widget.prototype.onExit.call(this);var t=ccui.VideoPlayer.elements;var e=t.indexOf(this);if(e!==-1)t.splice(e,1)}});ccui.VideoPlayer.elements=[];ccui.VideoPlayer.pauseElements=[];cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){var t=ccui.VideoPlayer.elements;for(var e,i=0;i<t.length;i++){e=t[i];if(t[i]._playing){e.pause();ccui.VideoPlayer.pauseElements.push(e)}}});cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){var t=ccui.VideoPlayer.pauseElements;var e=t.pop();while(e){e.play();e=t.pop()}});ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"};(function(t){t._polyfill={devicePixelRatio:false,event:"canplay",canPlayType:[]};(function(){var e=document.createElement("video");if(e.canPlayType("video/ogg")){t._polyfill.canPlayType.push(".ogg");t._polyfill.canPlayType.push(".ogv")}if(e.canPlayType("video/mp4"))t._polyfill.canPlayType.push(".mp4");if(e.canPlayType("video/webm"))t._polyfill.canPlayType.push(".webm")})();if(cc.sys.OS_IOS===cc.sys.os){t._polyfill.devicePixelRatio=true;t._polyfill.event="progress"}if(cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX){t._polyfill.autoplayAfterOperation=true}var e=document.createElement("style");e.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}"+".cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}"+".cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}";document.head.appendChild(e)})(ccui.VideoPlayer);(function(t){ccui.VideoPlayer.RenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._listener=null;this._url="";this.initStyle()};var e=ccui.VideoPlayer.RenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);e.constructor=ccui.VideoPlayer.RenderCmd;e.visit=function(){var t=this,e=cc.container,i=cc.eventManager;if(this._node._visible){e.appendChild(this._video);if(this._listener===null)this._listener=cc.eventManager.addCustomListener(cc.game.EVENT_RESIZE,function(){t.resize()})}else{var n=false;if("contains"in e){n=e.contains(this._video)}else{n=e.compareDocumentPosition(this._video)%16}if(n)e.removeChild(this._video);i.removeListener(this._listener);this._listener=null}this.updateStatus()};e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled();var e=cc.Node._dirtyFlags,i=this._dirtyFlag;if(i&e.transformDirty){this.transform(this.getParentRenderCmd(),true);this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY);this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag}if(i&e.orderDirty){this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag}};e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;if(e._parent&&e._visible)this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY);else{i.removeListener(this._listener);this._listener=null}};e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio){var s=window.devicePixelRatio;i=i/s;n=n/s}if(this._loaded===false)return;var a=r._contentSize.width,o=r._contentSize.height;var c=e.a*i,l=e.b,h=e.c,u=e.d*n,d=e.tx*i-a/2+a*r._scaleX/2*i,_=e.ty*n-o/2+o*r._scaleY/2*n;var f="matrix("+c+","+l+","+h+","+u+","+d+","+-_+")";this._video.style["transform"]=f;this._video.style["-webkit-transform"]=f};e.updateURL=function(e){var i,n,r,s,a;var o=this._node;if(this._url==e)return;this._url=e;if(cc.loader.resPath&&!/^http/.test(e))e=cc.path.join(cc.loader.resPath,e);r=false;s=cc.container;if("contains"in s){r=s.contains(this._video)}else{r=s.compareDocumentPosition(this._video)%16}if(r)s.removeChild(this._video);this._video=document.createElement("video");n=this._video;this.bindEvent();var c=this;var l=function(){if(c._loaded==true)return;c._loaded=true;c.changeSize();c.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);n.removeEventListener(t.event,l);n.currentTime=0;n.style["visibility"]="visible";n.play();if(!o._played){n.pause();n.currentTime=0}};n.addEventListener(t.event,l);n.preload="metadata";n.style["visibility"]="hidden";this._loaded=false;o._played=false;o._playing=false;o._stopped=true;this.initStyle();this.visit();i=document.createElement("source");i.src=e;n.appendChild(i);a=cc.path.extname(e);for(var h=0;h<t.canPlayType.length;h++){if(a!==t.canPlayType[h]){i=document.createElement("source");i.src=e.replace(a,t.canPlayType[h]);n.appendChild(i)}}};e.bindEvent=function(){var t=this,e=this._node,i=this._video;i.addEventListener("ended",function(){e._renderCmd.updateMatrix(t._worldTransform,cc.view._scaleX,cc.view._scaleY);e._playing=false;e._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)});i.addEventListener("play",function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)});i.addEventListener("pause",function(){e._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)})};e.initStyle=function(){if(!this._video)return;var t=this._video;t.style.position="absolute";t.style.bottom="0px";t.style.left="0px";t.className="cocosVideo"};e.changeSize=function(t,e){var i=this._node._contentSize;t=t||i.width;e=e||i.height;var n=this._video;if(n){if(t!==0)n.width=t;if(e!==0)n.height=e}};e.removeDom=function(){var t=this._video;if(t){var e=false;if("contains"in cc.container){e=cc.container.contains(t)}else{e=cc.container.compareDocumentPosition(t)%16}if(e)cc.container.removeChild(t)}}})(ccui.VideoPlayer._polyfill);ccui.WebView=ccui.Widget.extend({ctor:function(t){ccui.Widget.prototype.ctor.call(this);this._EventList={};if(t)this.loadURL(t)},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t);this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){cc.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)e.location.reload()}},canGoBack:function(){cc.log("Web does not support query history");return true},canGoForward:function(){cc.log("Web does not support query history");return true},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)e.history.back.call(e)}}catch(i){cc.log(i)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)e.history.forward.call(e)}}catch(i){cc.log(i)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){var i=e.contentWindow;try{i.eval(t);this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(n){console.error(n)}}},setScalesPageToFit:function(){cc.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];if(e)e.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e);if(e===undefined){e=t.height;t=t.width}this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom();this.stopAllActions();this.unscheduleAllCallbacks()}});ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"};(function(){var t=ccui.WebView._polyfill={devicePixelRatio:false,enableDiv:false};if(cc.sys.os===cc.sys.OS_IOS)t.enableDiv=true;if(cc.sys.isMobile){if(cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX){t.enableBG=true}}else{if(cc.sys.browserType===cc.sys.BROWSER_TYPE_IE){t.closeHistory=true}}})();(function(t){ccui.WebView.RenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._div=null;this._iframe=null;if(t.enableDiv){this._div=document.createElement("div");this._div.style["-webkit-overflow"]="auto";this._div.style["-webkit-overflow-scrolling"]="touch";this._iframe=document.createElement("iframe");this._div.appendChild(this._iframe)}else{this._div=this._iframe=document.createElement("iframe")}if(t.enableBG)this._div.style["background"]="#FFF";this._iframe.addEventListener("load",function(){e._dispatchEvent(ccui.WebView.EventType.LOADED)});this._iframe.addEventListener("error",function(){e._dispatchEvent(ccui.WebView.EventType.ERROR)});this._div.style["background"]="#FFF";this._div.style.height="200px";this._div.style.width="300px";this._div.style.overflow="scroll";this._listener=null;this.initStyle()};var e=ccui.WebView.RenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);e.constructor=ccui.WebView.RenderCmd;e.updateStatus=function(){t.devicePixelRatio=cc.view.isRetinaEnabled();var e=cc.Node._dirtyFlags,i=this._dirtyFlag;if(i&e.transformDirty){this.transform(this.getParentRenderCmd(),true);this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY);this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag}if(i&e.orderDirty){this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag}};e.visit=function(){var t=this,e=cc.container,i=cc.eventManager;if(this._node._visible){e.appendChild(this._div);if(this._listener===null)this._listener=i.addCustomListener(cc.game.EVENT_RESIZE,function(){t.resize()})}else{var n=false;if("contains"in e){n=e.contains(this._div)}else{n=e.compareDocumentPosition(this._div)%16}if(n)e.removeChild(this._div);var r=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();i._removeListenerInVector(r,this._listener);this._listener=null}this.updateStatus();this.resize(cc.view)};e.resize=function(t){t=t||cc.view;var e=this._node,i=cc.eventManager;if(e._parent&&e._visible)this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY);else{var n=i._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();i._removeListenerInVector(n,this._listener);this._listener=null}};e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio&&i!==1&&i!==1){var s=window.devicePixelRatio;i=i/s;n=n/s}if(this._loaded===false)return;var a=r._contentSize.width,o=r._contentSize.height;var c=e.a*i,l=e.b,h=e.c,u=e.d*n,d=e.tx*i-a/2+a*r._scaleX/2*i,_=e.ty*n-o/2+o*r._scaleY/2*n;var f="matrix("+c+","+l+","+h+","+u+","+d+","+-_+")";this._div.style["transform"]=f;this._div.style["-webkit-transform"]=f};e.initStyle=function(){if(!this._div)return;var t=this._div;t.style.position="absolute";t.style.bottom="0px";t.style.left="0px"};e.updateURL=function(t){var e=this._iframe;e.src=t;var i=this;var n=function(){i._loaded=true;e.removeEventListener("load",n)};e.addEventListener("load",n)};e.changeSize=function(t,e){var i=this._div;if(i){i.style["width"]=t+"px";i.style["height"]=e+"px"}};e.removeDom=function(){var t=this._div;if(t){var e=false;if("contains"in cc.container){e=cc.container.contains(t)}else{e=cc.container.compareDocumentPosition(t)%16}if(e)cc.container.removeChild(t)}}})(ccui.WebView._polyfill);(function(){if(!ccui.ProtectedNode.WebGLRenderCmd)return;ccui.ScrollView.WebGLRenderCmd=function(t){ccui.Layout.WebGLRenderCmd.call(this,t);this._needDraw=true;this._dirty=false};var t=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype);t.constructor=ccui.ScrollView.WebGLRenderCmd;t.visit=function(t){var e=this._node;if(!e._visible)return;var i=this._node.__instanceId;cc.renderer.pushRenderCommand(this);cc.renderer._turnToCacheMode(i);ccui.Layout.WebGLRenderCmd.prototype.visit.call(this,t);e.updateChildren();this._dirtyFlag=0;cc.renderer._turnToNormalMode()};t.rendering=function(t){var e=this._node.__instanceId;var i=cc.renderer._cacheToBufferCmds[e],n,r;var s=t||cc._renderContext;for(n=0,r=i.length;n<r;n++){var a=i[n]._node;if(a instanceof ccui.ScrollView)continue;if(a&&a._parent&&a._parent._inViewRect===false)continue;i[n].rendering(s)}}})();cc.Component=cc.Class.extend({_owner:null,_name:"",_enabled:true,ctor:function(){this._owner=null;this._name="";this._enabled=true},init:function(){return true},onEnter:function(){},onExit:function(){},update:function(t){},serialize:function(t){},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},getName:function(){return this._name},setName:function(t){this._name=t},setOwner:function(t){this._owner=t},getOwner:function(){return this._owner}});cc.Component.create=function(){return new cc.Component};ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3};ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3};ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2};ccui.LayoutComponent=cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:false,_positionPercentX:0,_usingPositionPercentY:false,_positionPercentY:0,_usingStretchWidth:false,_usingStretchHeight:false,_percentWidth:0,_usingPercentWidth:false,_percentHeight:0,_usingPercentHeight:false,_actived:true,_isPercentOnly:false,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){var t=true;if(!cc.Component.prototype.init.call(this)){return false}return t},getPercentContentSize:function(){return cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(t){this.setPercentWidth(t.x);this.setPercentHeight(t.y)},setUsingPercentContentSize:function(t){this._usingPercentWidth=this._usingPercentHeight=t},SetActiveEnable:function(t){this._actived=t},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(t,e){var i=this._owner.getBoundingBox();this._owner.setAnchorPoint(t,e);var n=this._owner.getBoundingBox();var r=i.x-n.x,s=i.y-n.y;var a=this._owner.getPosition();a.x+=r;a.y+=s;this.setPosition(a)},getPosition:function(){return this._owner.getPosition()},setPosition:function(t,e){var i=this._getOwnerParent(),n;if(i!=null){if(e===undefined){n=t.x;e=t.y}else n=t;var r=i.getContentSize();if(r.width!==0)this._positionPercentX=n/r.width;else{this._positionPercentX=0;if(this._usingPositionPercentX)n=0}if(r.height!==0)this._positionPercentY=e/r.height;else{this._positionPercentY=0;if(this._usingPositionPercentY)e=0}this._owner.setPosition(n,e);this._refreshHorizontalMargin();this._refreshVerticalMargin()}else this._owner.setPosition(t,e)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(t){this._usingPositionPercentX=t;if(this._usingPositionPercentX)this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(t){this._positionPercentX=t;var e=this._getOwnerParent();if(e!==null){this._owner.setPositionX(e.width*this._positionPercentX);this._refreshHorizontalMargin()}},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(t){this._usingPositionPercentY=t;if(this._usingPositionPercentY)this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(t){this._positionPercentY=t;var e=this._getOwnerParent();if(e!==null){this._owner.setPositionY(e.height*this._positionPercentY);this._refreshVerticalMargin()}},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(t){this._horizontalEdge=t;if(this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE)this._usingPositionPercentX=false;var e=this._getOwnerParent();if(e!==null){var i=this._owner.getPosition();var n=e.getContentSize();if(n.width!==0)this._positionPercentX=i.x/n.width;else{this._positionPercentX=0;i.x=0;if(this._usingPositionPercentX)this._owner.setPosition(i)}this._refreshHorizontalMargin()}},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(t){this._verticalEdge=t;if(this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE)this._usingPositionPercentY=false;var e=this._getOwnerParent();if(e!==null){var i=this._owner.getPosition();var n=e.getContentSize();if(n.height!==0)this._positionPercentY=i.y/n.height;else{this._positionPercentY=0;i.y=0;if(this._usingPositionPercentY)this._owner.setPosition(i)}this._refreshVerticalMargin()}},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(t){this._leftMargin=t},getRightMargin:function(){return this._rightMargin},setRightMargin:function(t){this._rightMargin=t},getTopMargin:function(){return this._topMargin},setTopMargin:function(t){this._topMargin=t},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(t){this._bottomMargin=t},getSize:function(){return this.getOwner().getContentSize()},setSize:function(t){var e=this._getOwnerParent();if(e!==null){var i=t,n=e.getContentSize();if(n.width!==0)this._percentWidth=i.width/n.width;else{this._percentWidth=0;if(this._usingPercentWidth)i.width=0}if(n.height!==0)this._percentHeight=i.height/n.height;else{this._percentHeight=0;if(this._usingPercentHeight)i.height=0}this._owner.setContentSize(i);this._refreshHorizontalMargin();this._refreshVerticalMargin()}else this._owner.setContentSize(t)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(t){this._usingPercentWidth=t;if(this._usingPercentWidth)this._usingStretchWidth=false},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(t){var e=this._owner.getContentSize();e.width=t;var i=this._getOwnerParent();if(i!==null){var n=i.getContentSize();if(n.width!==0)this._percentWidth=e.width/n.width;else{this._percentWidth=0;if(this._usingPercentWidth)e.width=0}this._owner.setContentSize(e);this._refreshHorizontalMargin()}else this._owner.setContentSize(e)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(t){this._percentWidth=t;var e=this._getOwnerParent();if(e!==null){var i=this._owner.getContentSize();i.width=e.width*this._percentWidth;this._owner.setContentSize(i);this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(t){this._usingPercentHeight=t;if(this._usingPercentHeight)this._usingStretchHeight=false},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(t){var e=this._owner.getContentSize();e.height=t;var i=this._getOwnerParent();if(i!==null){var n=i.getContentSize();if(n.height!==0)this._percentHeight=e.height/n.height;else{this._percentHeight=0;if(this._usingPercentHeight)e.height=0}this._owner.setContentSize(e);this._refreshVerticalMargin()}else this._owner.setContentSize(e)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(t){this._percentHeight=t;var e=this._getOwnerParent();if(e!==null){var i=this._owner.getContentSize();i.height=e.height*this._percentHeight;this._owner.setContentSize(i);this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(t){this._usingStretchWidth=t;if(this._usingStretchWidth)this._usingPercentWidth=false},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(t){this._usingStretchHeight=t;if(this._usingStretchHeight)this._usingPercentHeight=false},setPercentOnlyEnabled:function(t){this._isPercentOnly=t},setActiveEnabled:function(t){this._actived=t},refreshLayout:function(){if(!this._actived)return;var t=this._getOwnerParent();if(t===null)return;var e=t.getContentSize(),i=this._owner;var n=i.getAnchorPoint(),r=i.getContentSize();var s=i.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:if(this._usingStretchWidth&&!this._isPercentOnly){r.width=e.width*this._percentWidth;s.x=this._leftMargin+n.x*r.width}else{if(this._usingPositionPercentX)s.x=e.width*this._positionPercentX;if(this._usingPercentWidth)r.width=e.width*this._percentWidth}break;case ccui.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;if(this._usingPercentWidth||this._usingStretchWidth)r.width=e.width*this._percentWidth;s.x=this._leftMargin+n.x*r.width;break;case ccui.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;if(this._usingPercentWidth||this._usingStretchWidth)r.width=e.width*this._percentWidth;s.x=e.width-(this._rightMargin+(1-n.x)*r.width);break;case ccui.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;if(this._usingStretchWidth){r.width=e.width-this._leftMargin-this._rightMargin;if(r.width<0)r.width=0;s.x=this._leftMargin+n.x*r.width}else{if(this._usingPercentWidth)r.width=e.width*this._percentWidth;s.x=e.width*this._positionPercentX}break;default:break}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:if(this._usingStretchHeight&&!this._isPercentOnly){r.height=e.height*this._percentHeight;s.y=this._bottomMargin+n.y*r.height}else{if(this._usingPositionPercentY)s.y=e.height*this._positionPercentY;if(this._usingPercentHeight)r.height=e.height*this._percentHeight}break;case ccui.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;if(this._usingPercentHeight||this._usingStretchHeight)r.height=e.height*this._percentHeight;s.y=this._bottomMargin+n.y*r.height;break;case ccui.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;if(this._usingPercentHeight||this._usingStretchHeight)r.height=e.height*this._percentHeight;s.y=e.height-(this._topMargin+(1-n.y)*r.height);break;case ccui.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;if(this._usingStretchHeight){r.height=e.height-this._topMargin-this._bottomMargin;if(r.height<0)r.height=0;s.y=this._bottomMargin+n.y*r.height}else{if(this._usingPercentHeight)r.height=e.height*this._percentHeight;s.y=e.height*this._positionPercentY}break;default:break}i.setPosition(s);i.setContentSize(r);if(i instanceof ccui.PageView){i.forceDoLayout();var a=i.getPages();for(var o=0;o<a.length;o++){ccui.helper.doLayout(a[o])}}else{ccui.helper.doLayout(i)}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var t=this._getOwnerParent();if(t===null)return;var e=this._owner.getPosition(),i=this._owner.getAnchorPoint();var n=this._owner.getContentSize(),r=t.getContentSize();this._leftMargin=e.x-i.x*n.width;this._rightMargin=r.width-(e.x+(1-i.x)*n.width)},_refreshVerticalMargin:function(){var t=this._getOwnerParent();if(t===null)return;var e=this._owner.getPosition(),i=this._owner.getAnchorPoint();var n=this._owner.getContentSize(),r=t.getContentSize();this._bottomMargin=e.y-i.y*n.height;this._topMargin=r.height-(e.y+(1-i.y)*n.height)}});ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3};ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3};ccui.LayoutComponent.NAME="__ui_layout";ccui.LayoutComponent.bindLayoutComponent=function(t){var e=t.getComponent(ccui.LayoutComponent.NAME);if(e!==undefined)return e;e=new ccui.LayoutComponent;if(e&&e.init()){t.addComponent(e);return e}return null};cc.ComponentContainer=cc.Class.extend({_components:null,_owner:null,ctor:function(t){this._components=null;this._owner=t},getComponent:function(t){if(!t)throw new Error("cc.ComponentContainer.getComponent(): name should be non-null");t=t.trim();if(!this._components){this._components={}}return this._components[t]},add:function(t){if(!t)throw new Error("cc.ComponentContainer.add(): component should be non-null");if(t.getOwner()){cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again");return false}if(this._components==null){this._components={};this._owner.scheduleUpdate()}var e=this._components[t.getName()];if(e){cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again");return false}t.setOwner(this._owner);this._components[t.getName()]=t;t.onEnter();return true},remove:function(t){if(!t)throw new Error("cc.ComponentContainer.remove(): name should be non-null");if(!this._components)return false;if(t instanceof cc.Component)return this._removeByComponent(t);else{t=t.trim();return this._removeByComponent(this._components[t])}},_removeByComponent:function(t){if(!t)return false;t.onExit();t.setOwner(null);delete this._components[t.getName()];return true},removeAll:function(){if(!this._components)return;var t=this._components;for(var e in t){var i=t[e];i.onExit();i.setOwner(null);delete t[e]}this._owner.unscheduleUpdate();this._components=null},_alloc:function(){this._components={}},visit:function(t){if(!this._components)return;var e=this._components;for(var i in e)e[i].update(t)},isEmpty:function(){if(!this._components)return true;return this._components.length===0}});var ccs=ccs||{};ccs.Class=ccs.Class||cc.Class;ccs.Class.extend=ccs.Class.extend||cc.Class.extend;ccs.Node=ccs.Node||cc.Node;ccs.Node.extend=ccs.Node.extend||cc.Node.extend;ccs.Sprite=ccs.Sprite||cc.Sprite;ccs.Sprite.extend=ccs.Sprite.extend||cc.Sprite.extend;ccs.Component=ccs.Component||cc.Component;ccs.Component.extend=ccs.Component.extend||cc.Component.extend;ccs.cocostudioVersion="v1.3.0.0";ccs.VERSION_COMBINED=.3;ccs.VERSION_CHANGE_ROTATION_RANGE=1;ccs.VERSION_COLOR_READING=1.1;ccs.MAX_VERTEXZ_VALUE=5e6;ccs.ARMATURE_MAX_CHILD=50;ccs.ARMATURE_MAX_ZORDER=100;ccs.ARMATURE_MAX_COUNT=ccs.MAX_VERTEXZ_VALUE/ccs.ARMATURE_MAX_CHILD/ccs.ARMATURE_MAX_ZORDER;ccs.AUTO_ADD_SPRITE_FRAME_NAME_PREFIX=false;ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT=false;ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX=false;ccs.armatureVersion=function(){return"v1.1.0.0"};ccs.CONST_VERSION="version";ccs.CONST_VERSION_2_0=2;ccs.CONST_VERSION_COMBINED=.3;ccs.CONST_ARMATURES="armatures";ccs.CONST_ARMATURE="armature";ccs.CONST_BONE="b";ccs.CONST_DISPLAY="d";ccs.CONST_ANIMATIONS="animations";ccs.CONST_ANIMATION="animation";ccs.CONST_MOVEMENT="mov";ccs.CONST_FRAME="f";ccs.CONST_TEXTURE_ATLAS="TextureAtlas";ccs.CONST_SUB_TEXTURE="SubTexture";ccs.CONST_SKELETON="skeleton";ccs.CONST_A_NAME="name";ccs.CONST_A_DURATION="dr";ccs.CONST_A_FRAME_INDEX="fi";ccs.CONST_A_DURATION_TO="to";ccs.CONST_A_DURATION_TWEEN="drTW";ccs.CONST_A_LOOP="lp";ccs.CONST_A_MOVEMENT_SCALE="sc";ccs.CONST_A_MOVEMENT_DELAY="dl";ccs.CONST_A_DISPLAY_INDEX="dI";ccs.CONST_A_PLIST="plist";ccs.CONST_A_PARENT="parent";ccs.CONST_A_SKEW_X="kX";ccs.CONST_A_SKEW_Y="kY";ccs.CONST_A_SCALE_X="cX";ccs.CONST_A_SCALE_Y="cY";ccs.CONST_A_Z="z";ccs.CONST_A_EVENT="evt";ccs.CONST_A_SOUND="sd";ccs.CONST_A_SOUND_EFFECT="sdE";ccs.CONST_A_TWEEN_EASING="twE";ccs.CONST_A_EASING_PARAM="twEP";ccs.CONST_A_TWEEN_ROTATE="twR";ccs.CONST_A_IS_ARMATURE="isArmature";ccs.CONST_A_DISPLAY_TYPE="displayType";ccs.CONST_A_MOVEMENT="mov";ccs.CONST_A_X="x";ccs.CONST_A_Y="y";ccs.CONST_A_COCOS2DX_X="cocos2d_x";ccs.CONST_A_COCOS2DX_Y="cocos2d_y";ccs.CONST_A_WIDTH="width";ccs.CONST_A_HEIGHT="height";ccs.CONST_A_PIVOT_X="pX";ccs.CONST_A_PIVOT_Y="pY";ccs.CONST_A_COCOS2D_PIVOT_X="cocos2d_pX";ccs.CONST_A_COCOS2D_PIVOT_Y="cocos2d_pY";ccs.CONST_A_BLEND_TYPE="bd";ccs.CONST_A_BLEND_SRC="bd_src";ccs.CONST_A_BLEND_DST="bd_dst";ccs.CONST_A_ALPHA="a";ccs.CONST_A_RED="r";ccs.CONST_A_GREEN="g";ccs.CONST_A_BLUE="b";ccs.CONST_A_ALPHA_OFFSET="aM";ccs.CONST_A_RED_OFFSET="rM";ccs.CONST_A_GREEN_OFFSET="gM";ccs.CONST_A_BLUE_OFFSET="bM";ccs.CONST_A_COLOR_TRANSFORM="colorTransform";ccs.CONST_A_TWEEN_FRAME="tweenFrame";ccs.CONST_CONTOUR="con";ccs.CONST_CONTOUR_VERTEX="con_vt";ccs.CONST_FL_NAN="NaN";ccs.CONST_FRAME_DATA="frame_data";ccs.CONST_MOVEMENT_BONE_DATA="mov_bone_data";ccs.CONST_MOVEMENT_DATA="mov_data";ccs.CONST_ANIMATION_DATA="animation_data";ccs.CONST_DISPLAY_DATA="display_data";ccs.CONST_SKIN_DATA="skin_data";ccs.CONST_BONE_DATA="bone_data";ccs.CONST_ARMATURE_DATA="armature_data";ccs.CONST_CONTOUR_DATA="contour_data";ccs.CONST_TEXTURE_DATA="texture_data";ccs.CONST_VERTEX_POINT="vertex";ccs.CONST_COLOR_INFO="color";ccs.CONST_CONFIG_FILE_PATH="config_file_path";ccs.CONST_CONTENT_SCALE="content_scale";ccs.DataInfo=function(){this.asyncStruct=null;this.configFileQueue=[];this.contentScale=1;this.filename="";this.baseFilePath="";this.flashToolVersion=0;this.cocoStudioVersion=0};ccs.dataReaderHelper={ConfigType:{DragonBone_XML:0,CocoStudio_JSON:1,CocoStudio_Binary:2},_configFileList:[],_flashToolVersion:ccs.CONST_VERSION_2_0,_positionReadScale:1,_asyncRefCount:0,_asyncRefTotalCount:0,_dataQueue:null,setPositionReadScale:function(t){this._positionReadScale=t},getPositionReadScale:function(){return this._positionReadScale;
},addDataFromFile:function(t){if(this._configFileList.indexOf(t)!==-1)return;this._configFileList.push(t);var e=this._initBaseFilePath(t);var i=cc.path.extname(t).toLowerCase();var n=new ccs.DataInfo;n.filename=t;n.basefilePath=e;if(i===".xml")ccs.dataReaderHelper.addDataFromXML(t,n);else if(i===".json"||i===".exportjson")ccs.dataReaderHelper.addDataFromJson(t,n);else if(i===".csb")ccs.dataReaderHelper.addDataFromBinaryCache(t,n)},addDataFromFileAsync:function(t,e,i,n,r){if(this._configFileList.indexOf(i)!==-1){if(r&&n){if(this._asyncRefTotalCount===0&&this._asyncRefCount===0)this._asyncCallBack(n,r,1);else this._asyncCallBack(n,r,(this._asyncRefTotalCount-this._asyncRefCount)/this._asyncRefTotalCount)}return}this._asyncRefTotalCount++;this._asyncRefCount++;var s=this;var a=function(){s.addDataFromFile(i);s._asyncRefCount--;s._asyncCallBack(n,r,(s._asyncRefTotalCount-s._asyncRefCount)/s._asyncRefTotalCount)};cc.director.getScheduler().schedule(a,this,.1,false,0,false,"armatrueDataHelper")},removeConfigFile:function(t){var e=this._configFileList;var i=e.length;var n=e[i];for(var r=0;r<i;r++){if(e[r]===t)n=r}if(n!==e[i])cc.arrayRemoveObject(e,t)},addDataFromCache:function(t,e){if(!t){cc.log("XML error  or  XML is empty.");return}e.flashToolVersion=parseFloat(t.getAttribute(ccs.CONST_VERSION));var i=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ARMATURES+" >  "+ccs.CONST_ARMATURE+"");var n=ccs.armatureDataManager,r;for(r=0;r<i.length;r++){var s=this.decodeArmature(i[r],e);n.addArmatureData(s.name,s,e.filename)}var a=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ANIMATIONS+" >  "+ccs.CONST_ANIMATION+"");for(r=0;r<a.length;r++){var o=this.decodeAnimation(a[r],e);n.addAnimationData(o.name,o,e.filename)}var c=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_TEXTURE_ATLAS+" >  "+ccs.CONST_SUB_TEXTURE+"");for(r=0;r<c.length;r++){var l=this.decodeTexture(c[r],e);n.addTextureData(l.name,l,e.filename)}},decodeArmature:function(t,e){var i=new ccs.ArmatureData;i.init();i.name=t.getAttribute(ccs.CONST_A_NAME);var n=t.querySelectorAll(ccs.CONST_ARMATURE+" > "+ccs.CONST_BONE);for(var r=0;r<n.length;r++){var s=n[r];var a=s.getAttribute(ccs.CONST_A_PARENT);var o=null;if(a){for(var c=0;c<n.length;c++){o=n[c];if(a==n[c].getAttribute(ccs.CONST_A_NAME)){break}}}var l=this.decodeBone(s,o,e);i.addBoneData(l)}return i},decodeArmatureFromJSON:function(t,e){var i=new ccs.ArmatureData;i.init();var n=t[ccs.CONST_A_NAME];if(n){i.name=n}e.cocoStudioVersion=i.dataVersion=t[ccs.CONST_VERSION]||.1;var r=t[ccs.CONST_BONE_DATA];for(var s=0;s<r.length;s++){var a=this.decodeBoneFromJson(r[s],e);i.addBoneData(a)}return i},decodeBone:function(t,e,i){var n=new ccs.BoneData;n.init();n.name=t.getAttribute(ccs.CONST_A_NAME);n.parentName=t.getAttribute(ccs.CONST_A_PARENT)||"";n.zOrder=parseInt(t.getAttribute(ccs.CONST_A_Z))||0;var r=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_DISPLAY);for(var s=0;s<r.length;s++){var a=r[s];var o=this.decodeBoneDisplay(a,i);n.addDisplayData(o)}return n},decodeBoneFromJson:function(t,e){var i=new ccs.BoneData;i.init();this.decodeNodeFromJson(i,t,e);i.name=t[ccs.CONST_A_NAME]||"";i.parentName=t[ccs.CONST_A_PARENT]||"";var n=t[ccs.CONST_DISPLAY_DATA]||[];for(var r=0;r<n.length;r++){var s=this.decodeBoneDisplayFromJson(n[r],e);i.addDisplayData(s)}return i},decodeBoneDisplay:function(t,e){var i=parseFloat(t.getAttribute(ccs.CONST_A_IS_ARMATURE))||0;var n=null;if(i===1){n=new ccs.ArmatureDisplayData;n.displayType=ccs.DISPLAY_TYPE_ARMATURE}else{n=new ccs.SpriteDisplayData;n.displayType=ccs.DISPLAY_TYPE_SPRITE}var r=t.getAttribute(ccs.CONST_A_NAME)||"";if(r){n.displayName=r}return n},decodeBoneDisplayFromJson:function(t,e){var i=t[ccs.CONST_A_DISPLAY_TYPE]||ccs.DISPLAY_TYPE_SPRITE;var n=null;switch(i){case ccs.DISPLAY_TYPE_SPRITE:n=new ccs.SpriteDisplayData;var r=t[ccs.CONST_A_NAME];if(r!=null){n.displayName=r}var s=t[ccs.CONST_SKIN_DATA]||[];var a=s[0];if(a){var o=n.skinData;o.x=a[ccs.CONST_A_X]*this._positionReadScale;o.y=a[ccs.CONST_A_Y]*this._positionReadScale;o.scaleX=a[ccs.CONST_A_SCALE_X]==null?1:a[ccs.CONST_A_SCALE_X];o.scaleY=a[ccs.CONST_A_SCALE_Y]==null?1:a[ccs.CONST_A_SCALE_Y];o.skewX=a[ccs.CONST_A_SKEW_X]==null?1:a[ccs.CONST_A_SKEW_X];o.skewY=a[ccs.CONST_A_SKEW_Y]==null?1:a[ccs.CONST_A_SKEW_Y];o.x*=e.contentScale;o.y*=e.contentScale}break;case ccs.DISPLAY_TYPE_ARMATURE:n=new ccs.ArmatureDisplayData;var r=t[ccs.CONST_A_NAME];if(r!=null){n.displayName=t[ccs.CONST_A_NAME]}break;case ccs.DISPLAY_TYPE_PARTICLE:n=new ccs.ParticleDisplayData;var c=t[ccs.CONST_A_PLIST];if(c!=null){if(e.asyncStruct){n.displayName=e.asyncStruct.basefilePath+c}else{n.displayName=e.basefilePath+c}}break;default:n=new ccs.SpriteDisplayData;break}n.displayType=i;return n},decodeAnimation:function(t,e){var i=new ccs.AnimationData;var n=t.getAttribute(ccs.CONST_A_NAME);var r=ccs.armatureDataManager.getArmatureData(n);i.name=n;var s=t.querySelectorAll(ccs.CONST_ANIMATION+" > "+ccs.CONST_MOVEMENT);var a=null;for(var o=0;o<s.length;o++){a=s[o];var c=this.decodeMovement(a,r,e);i.addMovement(c)}return i},decodeAnimationFromJson:function(t,e){var i=new ccs.AnimationData;var n=t[ccs.CONST_A_NAME];if(n){i.name=t[ccs.CONST_A_NAME]}var r=t[ccs.CONST_MOVEMENT_DATA]||[];for(var s=0;s<r.length;s++){var a=this.decodeMovementFromJson(r[s],e);i.addMovement(a)}return i},decodeMovement:function(t,e,i){var n=new ccs.MovementData;n.name=t.getAttribute(ccs.CONST_A_NAME);var r,s,a,o,c=0;r=t.getAttribute(ccs.CONST_A_DURATION);n.duration=r==null?0:parseFloat(r);s=t.getAttribute(ccs.CONST_A_DURATION_TO);n.durationTo=s==null?0:parseFloat(s);a=t.getAttribute(ccs.CONST_A_DURATION_TWEEN);n.durationTween=a==null?0:parseFloat(a);o=t.getAttribute(ccs.CONST_A_LOOP);n.loop=o?Boolean(parseFloat(o)):true;var l=t.getAttribute(ccs.CONST_A_TWEEN_EASING);if(l){if(l!=ccs.CONST_FL_NAN){c=l==null?0:parseFloat(l);n.tweenEasing=c===2?ccs.TweenType.SINE_EASEINOUT:c}else n.tweenEasing=ccs.TweenType.LINEAR}var h=t.querySelectorAll(ccs.CONST_MOVEMENT+" > "+ccs.CONST_BONE);var u=null;for(var d=0;d<h.length;d++){u=h[d];var _=u.getAttribute(ccs.CONST_A_NAME);if(n.getMovementBoneData(_))continue;var f=e.getBoneData(_);var p=f.parentName;var m=null;if(p!==""){for(var g=0;g<h.length;g++){m=h[g];if(p===m.getAttribute(ccs.CONST_A_NAME))break}}var v=this.decodeMovementBone(u,m,f,i);n.addMovementBoneData(v)}return n},decodeMovementFromJson:function(t,e){var i=new ccs.MovementData;i.loop=t[ccs.CONST_A_LOOP]==null?false:t[ccs.CONST_A_LOOP];i.durationTween=t[ccs.CONST_A_DURATION_TWEEN]||0;i.durationTo=t[ccs.CONST_A_DURATION_TO]||0;i.duration=t[ccs.CONST_A_DURATION]||0;if(t[ccs.CONST_A_DURATION]==null){i.scale=1}else{i.scale=t[ccs.CONST_A_MOVEMENT_SCALE]==null?1:t[ccs.CONST_A_MOVEMENT_SCALE]}i.tweenEasing=t[ccs.CONST_A_TWEEN_EASING]==null?ccs.TweenType.LINEAR:t[ccs.CONST_A_TWEEN_EASING];var n=t[ccs.CONST_A_NAME];if(n)i.name=n;var r=t[ccs.CONST_MOVEMENT_BONE_DATA]||[];for(var s=0;s<r.length;s++){var a=this.decodeMovementBoneFromJson(r[s],e);i.addMovementBoneData(a)}return i},decodeMovementBone:function(t,e,i,n){var r=new ccs.MovementBoneData;r.init();var s,a;if(t){s=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_SCALE))||0;r.scale=s;a=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_DELAY))||0;if(a>0)a-=1;r.delay=a}var o=0,c=0,l=0;var h=null,u=[];if(e!=null){var d=e.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME);for(var _=0;_<d.length;_++)u.push(d[_]);o=u.length}r.name=t.getAttribute(ccs.CONST_A_NAME);var f=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME);var p=0,m=0;for(var g=0;g<f.length;g++){var v=f[g];if(e){while(p<o&&(h?m<c||m>=c+l:true)){h=u[p];c+=l;l=parseFloat(h.getAttribute(ccs.CONST_A_DURATION));p++}}var y=this.decodeFrame(v,h,i,n);r.addFrameData(y);y.frameID=m;m+=y.duration;r.duration=m}var T=r.frameList,C=Math.PI;for(var _=T.length-1;_>=0;_--){if(_>0){var S=T[_].skewX-T[_-1].skewX;var x=T[_].skewY-T[_-1].skewY;if(S<-C||S>C){T[_-1].skewX=S<0?T[_-1].skewX-2*C:T[_-1].skewX+2*C}if(x<-C||x>C){T[_-1].skewY=x<0?T[_-1].skewY-2*C:T[_-1].skewY+2*C}}}var E=new ccs.FrameData;E.copy(r.frameList[r.frameList.length-1]);E.frameID=r.duration;r.addFrameData(E);return r},decodeMovementBoneFromJson:function(t,e){var i=new ccs.MovementBoneData;i.init();i.delay=t[ccs.CONST_A_MOVEMENT_DELAY]||0;var n=t[ccs.CONST_A_NAME];if(n)i.name=n;var r=t[ccs.CONST_FRAME_DATA]||[];var s=r.length;for(var a=0;a<s;a++){var o=t[ccs.CONST_FRAME_DATA][a];var c=this.decodeFrameFromJson(o,e);i.addFrameData(c);if(e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED){c.frameID=i.duration;i.duration+=c.duration}}if(e.cocoStudioVersion<ccs.VERSION_CHANGE_ROTATION_RANGE){var l=i.frameList;var h=Math.PI;for(var a=l.length-1;a>=0;a--){if(a>0){var u=l[a].skewX-l[a-1].skewX;var d=l[a].skewY-l[a-1].skewY;if(u<-h||u>h){l[a-1].skewX=u<0?l[a-1].skewX-2*h:l[a-1].skewX+2*h}if(d<-h||d>h){l[a-1].skewY=d<0?l[a-1].skewY-2*h:l[a-1].skewY+2*h}}}}if(e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED){if(i.frameList.length>0){var c=new ccs.FrameData;c.copy(i.frameList[i.frameList.length-1]);i.addFrameData(c);c.frameID=i.duration}}return i},decodeFrame:function(t,e,i,n){var r=0,s=0,a=0,o=0,c=0,l=0,h=0;var u=0,d=0,_=0,f=0,p=0;var m=new ccs.FrameData;m.strMovement=t.getAttribute(ccs.CONST_A_MOVEMENT)||"";m.movement=m.strMovement;m.strEvent=t.getAttribute(ccs.CONST_A_EVENT)||"";m.event=m.strEvent;m.strSound=t.getAttribute(ccs.CONST_A_SOUND)||"";m.sound=m.strSound;m.strSoundEffect=t.getAttribute(ccs.CONST_A_SOUND_EFFECT)||"";m.soundEffect=m.strSoundEffect;var g=t.getAttribute(ccs.CONST_A_TWEEN_FRAME);m.isTween=!(g!=undefined&&g==="false");if(n.flashToolVersion>=ccs.CONST_VERSION_2_0){r=t.getAttribute(ccs.CONST_A_COCOS2DX_X);if(r){m.x=parseFloat(r);m.x*=this._positionReadScale}s=t.getAttribute(ccs.CONST_A_COCOS2DX_Y);if(s){m.y=-parseFloat(s);m.y*=this._positionReadScale}}else{r=t.getAttribute(ccs.CONST_A_X);if(r){m.x=parseFloat(r);m.x*=this._positionReadScale}s=t.getAttribute(ccs.CONST_A_Y);if(s){m.y=-parseFloat(s);m.y*=this._positionReadScale}}a=t.getAttribute(ccs.CONST_A_SCALE_X);if(a!=null)m.scaleX=parseFloat(a);o=t.getAttribute(ccs.CONST_A_SCALE_Y);if(o!=null)m.scaleY=parseFloat(o);c=t.getAttribute(ccs.CONST_A_SKEW_X);if(c!=null)m.skewX=cc.degreesToRadians(parseFloat(c));l=t.getAttribute(ccs.CONST_A_SKEW_Y);if(l!=null)m.skewY=cc.degreesToRadians(-parseFloat(l));u=t.getAttribute(ccs.CONST_A_DURATION);if(u!=null)m.duration=parseFloat(u);d=t.getAttribute(ccs.CONST_A_DISPLAY_INDEX);if(d!=null)m.displayIndex=parseFloat(d);_=t.getAttribute(ccs.CONST_A_Z);if(_!=null)m.zOrder=parseInt(_);h=t.getAttribute(ccs.CONST_A_TWEEN_ROTATE);if(h!=null)m.tweenRotate=parseFloat(h);p=t.getAttribute(ccs.CONST_A_BLEND_TYPE);if(p!=null){var v=m.blendFunc;switch(p){case ccs.BLEND_TYPE_NORMAL:v.src=cc.BLEND_SRC;v.dst=cc.BLEND_DST;break;case ccs.BLEND_TYPE_ADD:v.src=cc.SRC_ALPHA;v.dst=cc.ONE;break;case ccs.BLEND_TYPE_MULTIPLY:v.src=cc.DST_COLOR;v.dst=cc.ONE_MINUS_SRC_ALPHA;break;case ccs.BLEND_TYPE_SCREEN:v.src=cc.ONE;v.dst=cc.ONE_MINUS_DST_COLOR;break;default:m.blendFunc.src=cc.BLEND_SRC;m.blendFunc.dst=cc.BLEND_DST;break}}var y=t.querySelectorAll(ccs.CONST_FRAME+" > "+ccs.CONST_A_COLOR_TRANSFORM);if(y&&y.length>0){y=y[0];var T,C,S,x;var E,b,A,R;T=parseFloat(y.getAttribute(ccs.CONST_A_ALPHA))||0;C=parseFloat(y.getAttribute(ccs.CONST_A_RED))||0;S=parseFloat(y.getAttribute(ccs.CONST_A_GREEN))||0;x=parseFloat(y.getAttribute(ccs.CONST_A_BLUE))||0;E=parseFloat(y.getAttribute(ccs.CONST_A_ALPHA_OFFSET))||0;b=parseFloat(y.getAttribute(ccs.CONST_A_RED_OFFSET))||0;A=parseFloat(y.getAttribute(ccs.CONST_A_GREEN_OFFSET))||0;R=parseFloat(y.getAttribute(ccs.CONST_A_BLUE_OFFSET))||0;m.a=2.55*E+T;m.r=2.55*b+C;m.g=2.55*A+S;m.b=2.55*R+x;m.isUseColorInfo=true}var P=t.getAttribute(ccs.CONST_A_TWEEN_EASING);if(P!=null){if(P!=ccs.CONST_FL_NAN){f=t.getAttribute(ccs.CONST_A_TWEEN_EASING);if(f)m.tweenEasing=f===2?ccs.TweenType.SINE_EASEINOUT:f}else m.tweenEasing=ccs.TweenType.LINEAR}if(e){var w=new ccs.BaseData;if(n.flashToolVersion>=ccs.CONST_VERSION_2_0){w.x=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_X));w.y=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_Y))}else{w.x=parseFloat(e.getAttribute(ccs.CONST_A_X));w.y=parseFloat(e.getAttribute(ccs.CONST_A_Y))}w.skewX=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_X));w.skewY=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_Y));w.y=-w.y;w.skewX=cc.degreesToRadians(w.skewX);w.skewY=cc.degreesToRadians(-w.skewY);ccs.TransformHelp.transformFromParent(m,w)}return m},decodeFrameFromJson:function(t,e){var i=new ccs.FrameData;this.decodeNodeFromJson(i,t,e);i.tweenEasing=t[ccs.CONST_A_TWEEN_EASING]||ccs.TweenType.LINEAR;i.displayIndex=t[ccs.CONST_A_DISPLAY_INDEX];var n=t[ccs.CONST_A_BLEND_SRC]==null?cc.BLEND_SRC:t[ccs.CONST_A_BLEND_SRC];var r=t[ccs.CONST_A_BLEND_DST]==null?cc.BLEND_DST:t[ccs.CONST_A_BLEND_DST];i.blendFunc.src=n;i.blendFunc.dst=r;i.isTween=t[ccs.CONST_A_TWEEN_FRAME]==null?true:t[ccs.CONST_A_TWEEN_FRAME];var s=t[ccs.CONST_A_EVENT];if(s!=null){i.strEvent=s;i.event=s}if(e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED)i.duration=t[ccs.CONST_A_DURATION]==null?1:t[ccs.CONST_A_DURATION];else i.frameID=t[ccs.CONST_A_FRAME_INDEX];var a=t[ccs.CONST_A_EASING_PARAM]||[];for(var o=0;o<a.length;o++){i.easingParams[o]=a[o]}return i},decodeTexture:function(t,e){var i=new ccs.TextureData;i.init();if(t.getAttribute(ccs.CONST_A_NAME)){i.name=t.getAttribute(ccs.CONST_A_NAME)}var n,r;if(e.flashToolVersion>=ccs.CONST_VERSION_2_0){n=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_X))||0;r=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_Y))||0}else{n=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_X))||0;r=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_Y))||0}var s=parseFloat(t.getAttribute(ccs.CONST_A_WIDTH))||0;var a=parseFloat(t.getAttribute(ccs.CONST_A_HEIGHT))||0;var o=n/s;var c=(a-r)/a;i.pivotX=o;i.pivotY=c;var l=t.querySelectorAll(ccs.CONST_SUB_TEXTURE+" > "+ccs.CONST_CONTOUR);for(var h=0;h<l.length;h++){i.addContourData(this.decodeContour(l[h],e))}return i},decodeTextureFromJson:function(t){var e=new ccs.TextureData;e.init();var i=t[ccs.CONST_A_NAME];if(i!=null)e.name=i;e.width=t[ccs.CONST_A_WIDTH]||0;e.height=t[ccs.CONST_A_HEIGHT]||0;e.pivotX=t[ccs.CONST_A_PIVOT_X]||0;e.pivotY=t[ccs.CONST_A_PIVOT_Y]||0;var n=t[ccs.CONST_CONTOUR_DATA]||[];for(var r=0;r<n.length;r++){e.contourDataList.push(this.decodeContourFromJson(n[r]))}return e},decodeContour:function(t,e){var i=new ccs.ContourData;i.init();var n=t.querySelectorAll(ccs.CONST_CONTOUR+" > "+ccs.CONST_CONTOUR_VERTEX);var r;for(var s=0;s<n.length;s++){r=n[s];var a=cc.p(0,0);a.x=parseFloat(r.getAttribute(ccs.CONST_A_X))||0;a.y=parseFloat(r.getAttribute(ccs.CONST_A_Y))||0;a.y=-a.y;i.vertexList.push(a)}return i},decodeContourFromJson:function(t){var e=new ccs.ContourData;e.init();var i=t[ccs.CONST_VERTEX_POINT]||[];var n=i.length;for(var r=0;r<n;r++){var s=i[r];var a=cc.p(0,0);a.x=s[ccs.CONST_A_X]||0;a.y=s[ccs.CONST_A_Y]||0;e.vertexList.push(a)}return e},addDataFromJsonCache:function(t,e){e.contentScale=t[ccs.CONST_CONTENT_SCALE]==null?1:t[ccs.CONST_CONTENT_SCALE];var i=t[ccs.CONST_ARMATURE_DATA]||[],n;var r;for(n=0;n<i.length;n++){r=this.decodeArmatureFromJSON(i[n],e);ccs.armatureDataManager.addArmatureData(r.name,r,e.filename)}var s=t[ccs.CONST_ANIMATION_DATA]||[];var a;for(n=0;n<s.length;n++){a=this.decodeAnimationFromJson(s[n],e);ccs.armatureDataManager.addAnimationData(a.name,a,e.filename)}var o=t[ccs.CONST_TEXTURE_DATA]||[];var c;for(n=0;n<o.length;n++){c=this.decodeTextureFromJson(o[n],e);ccs.armatureDataManager.addTextureData(c.name,c,e.filename)}var l=e.asyncStruct==null?ccs.armatureDataManager.isAutoLoadSpriteFile():e.asyncStruct.autoLoadSpriteFile;if(l){var h=t[ccs.CONST_CONFIG_FILE_PATH]||[];var u,d,_,f;for(n=0;n<h.length;n++){u=h[n];d=u.lastIndexOf(".");u=u.substring(0,d);_=e.basefilePath+u+".plist";f=e.basefilePath+u+".png";ccs.armatureDataManager.addSpriteFrameFromFile(_,f,e.filename)}}r=null;a=null},decodeNodeFromJson:function(t,e,i){t.x=e[ccs.CONST_A_X]*this._positionReadScale;t.y=e[ccs.CONST_A_Y]*this._positionReadScale;t.x*=i.contentScale;t.y*=i.contentScale;t.zOrder=e[ccs.CONST_A_Z];t.skewX=e[ccs.CONST_A_SKEW_X]||0;t.skewY=e[ccs.CONST_A_SKEW_Y]||0;t.scaleX=e[ccs.CONST_A_SCALE_X]==null?1:e[ccs.CONST_A_SCALE_X];t.scaleY=e[ccs.CONST_A_SCALE_Y]==null?1:e[ccs.CONST_A_SCALE_Y];var n;if(i.cocoStudioVersion<ccs.VERSION_COLOR_READING){n=e[0];if(n){t.a=n[ccs.CONST_A_ALPHA]==null?255:n[ccs.CONST_A_ALPHA];t.r=n[ccs.CONST_A_RED]==null?255:n[ccs.CONST_A_RED];t.g=n[ccs.CONST_A_GREEN]==null?255:n[ccs.CONST_A_GREEN];t.b=n[ccs.CONST_A_BLUE]==null?255:n[ccs.CONST_A_BLUE];t.isUseColorInfo=true}}else{n=e[ccs.CONST_COLOR_INFO]||null;if(n){t.a=n[ccs.CONST_A_ALPHA]==null?255:n[ccs.CONST_A_ALPHA];t.r=n[ccs.CONST_A_RED]==null?255:n[ccs.CONST_A_RED];t.g=n[ccs.CONST_A_GREEN]==null?255:n[ccs.CONST_A_GREEN];t.b=n[ccs.CONST_A_BLUE]==null?255:n[ccs.CONST_A_BLUE];t.isUseColorInfo=true}}},clear:function(){this._configFileList=[];this._asyncRefCount=0;this._asyncRefTotalCount=0},_asyncCallBack:function(t,e,i){if(t&&cc.isFunction(t))t.call(e,i);if(e&&t&&typeof t==="string")e[t](i)},_initBaseFilePath:function(t){var e=t;var i=e.lastIndexOf("/");if(i>-1)e=e.substr(0,i+1);else e="";return e},addDataFromXML:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);var n=cc.saxParser.parse(i);var r=n.documentElement;if(r)this.addDataFromCache(r,e)},addDataFromJson:function(t,e){var i=cc.loader.getRes(t);this.addDataFromJsonCache(i,e)}};ccs.spriteFrameCacheHelper={_textureAtlasDic:{},_imagePaths:[],addSpriteFrameFromFile:function(t,e){cc.spriteFrameCache.addSpriteFrames(t,e)},getTextureAtlasWithTexture:function(t){return null;var e=t.getName();var i=this._textureAtlasDic[e];if(i==null){i=new cc.TextureAtlas(t,20);this._textureAtlasDic[e]=i}return i},clear:function(){this._textureAtlasDic={};this._imagePaths=[]}};ccs.TransformHelp=ccs.TransformHelp||ccs.Class.extend({});ccs.TransformHelp.helpMatrix1=cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpMatrix2=cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpPoint1=cc.p(0,0);ccs.TransformHelp.helpPoint2=cc.p(0,0);ccs.TransformHelp.helpParentNode={};ccs.TransformHelp.transformFromParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1);this.nodeToMatrix(e,this.helpMatrix2);this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformToParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1);this.nodeToMatrix(e,this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformFromParentWithoutScale=function(t,e){for(var i in e){this.helpParentNode[i]=e[i]}this.helpParentNode.scaleX=1;this.helpParentNode.scaleY=1;this.nodeToMatrix(t,this.helpMatrix1);this.nodeToMatrix(this.helpParentNode,this.helpMatrix2);this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformToParentWithoutScale=function(t,e){for(var i in e){this.helpParentNode[i]=e[i]}this.helpParentNode.scaleX=1;this.helpParentNode.scaleY=1;this.nodeToMatrix(t,this.helpMatrix1);this.nodeToMatrix(this.helpParentNode,this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.nodeToMatrix=function(t,e){if(t.skewX===-t.skewY){var i=Math.sin(t.skewX);var n=Math.cos(t.skewX);e.a=t.scaleX*n;e.b=t.scaleX*-i;e.c=t.scaleY*i;e.d=t.scaleY*n}else{e.a=t.scaleX*Math.cos(t.skewY);e.b=t.scaleX*Math.sin(t.skewY);e.c=t.scaleY*Math.sin(t.skewX);e.d=t.scaleY*Math.cos(t.skewX)}e.tx=t.x;e.ty=t.y};ccs.TransformHelp.matrixToNode=function(t,e){this.helpPoint1.x=0;this.helpPoint1.y=1;this.helpPoint1=cc.pointApplyAffineTransform(this.helpPoint1,t);this.helpPoint1.x-=t.tx;this.helpPoint1.y-=t.ty;this.helpPoint2.x=1;this.helpPoint2.y=0;this.helpPoint2=cc.pointApplyAffineTransform(this.helpPoint2,t);this.helpPoint2.x-=t.tx;this.helpPoint2.y-=t.ty;e.skewX=-(Math.atan2(this.helpPoint1.y,this.helpPoint1.x)-1.5707964);e.skewY=Math.atan2(this.helpPoint2.y,this.helpPoint2.x);e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b);e.scaleY=Math.sqrt(t.c*t.c+t.d*t.d);e.x=t.tx;e.y=t.ty};ccs.TransformHelp.nodeConcat=function(t,e){t.x+=e.x;t.y+=e.y;t.skewX+=e.skewX;t.skewY+=e.skewY;t.scaleX+=e.scaleX;t.scaleY+=e.scaleY};ccs.TransformHelp.nodeSub=function(t,e){t.x-=e.x;t.y-=e.y;t.skewX-=e.skewX;t.skewY-=e.skewY;t.scaleX-=e.scaleX;t.scaleY-=e.scaleY};ccs.TweenType={CUSTOM_EASING:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e4};ccs.TweenFunction=ccs.TweenFunction||ccs.Class.extend({});ccs.DOUBLE_PI=ccs.M_PI_X_2=Math.PI*2;ccs.HALF_PI=ccs.M_PI_2=Math.PI/2;ccs.M_PI=Math.PI;ccs.TweenFunction.tweenTo=function(t,e,i){var n=0;switch(e){case ccs.TweenType.CUSTOM_EASING:n=this.customEase(t,i);break;case ccs.TweenType.LINEAR:n=this.linear(t);break;case ccs.TweenType.SINE_EASEIN:n=this.sineEaseIn(t);break;case ccs.TweenType.SINE_EASEOUT:n=this.sineEaseOut(t);break;case ccs.TweenType.SINE_EASEINOUT:n=this.sineEaseInOut(t);break;case ccs.TweenType.QUAD_EASEIN:n=this.quadEaseIn(t);break;case ccs.TweenType.QUAD_EASEOUT:n=this.quadEaseOut(t);break;case ccs.TweenType.QUAD_EASEINOUT:n=this.quadEaseInOut(t);break;case ccs.TweenType.CUBIC_EASEIN:n=this.cubicEaseIn(t);break;case ccs.TweenType.CUBIC_EASEOUT:n=this.cubicEaseOut(t);break;case ccs.TweenType.CUBIC_EASEINOUT:n=this.cubicEaseInOut(t);break;case ccs.TweenType.QUART_EASEIN:n=this.quartEaseIn(t);break;case ccs.TweenType.QUART_EASEOUT:n=this.quartEaseOut(t);break;case ccs.TweenType.QUART_EASEINOUT:n=this.quartEaseInOut(t);break;case ccs.TweenType.QUINT_EASEIN:n=this.quintEaseIn(t);break;case ccs.TweenType.QUINT_EASEOUT:n=this.quintEaseOut(t);break;case ccs.TweenType.QUINT_EASEINOUT:n=this.quintEaseInOut(t);break;case ccs.TweenType.EXPO_EASEIN:n=this.expoEaseIn(t);break;case ccs.TweenType.EXPO_EASEOUT:n=this.expoEaseOut(t);break;case ccs.TweenType.EXPO_EASEINOUT:n=this.expoEaseInOut(t);break;case ccs.TweenType.CIRC_EASEIN:n=this.circEaseIn(t);break;case ccs.TweenType.CIRC_EASEOUT:n=this.circEaseOut(t);break;case ccs.TweenType.CIRC_EASEINOUT:n=this.circEaseInOut(t);break;case ccs.TweenType.ELASTIC_EASEIN:var r=.3;if(null!=i&&i.length>0){r=i[0]}n=this.elasticEaseIn(t,r);break;case ccs.TweenType.ELASTIC_EASEOUT:var r=.3;if(null!=i&&i.length>0){r=i[0]}n=this.elasticEaseOut(t,r);break;case ccs.TweenType.ELASTIC_EASEINOUT:var r=.3;if(null!=i&&i.length>0){r=i[0]}n=this.elasticEaseInOut(t,r);break;case ccs.TweenType.BACK_EASEIN:n=this.backEaseIn(t);break;case ccs.TweenType.BACK_EASEOUT:n=this.backEaseOut(t);break;case ccs.TweenType.BACK_EASEINOUT:n=this.backEaseInOut(t);break;case ccs.TweenType.BOUNCE_EASEIN:n=this.bounceEaseIn(t);break;case ccs.TweenType.BOUNCE_EASEOUT:n=this.bounceEaseOut(t);break;case ccs.TweenType.BOUNCE_EASEINOUT:n=this.bounceEaseInOut(t);break;default:n=this.sineEaseInOut(t);break}return n};ccs.TweenFunction.linear=function(t){return t};ccs.TweenFunction.sineEaseIn=function(t){return-1*Math.cos(t*ccs.HALF_PI)+1};ccs.TweenFunction.sineEaseOut=function(t){return Math.sin(t*ccs.HALF_PI)};ccs.TweenFunction.sineEaseInOut=function(t){return-.5*(Math.cos(ccs.M_PI*t)-1)};ccs.TweenFunction.quadEaseIn=function(t){return t*t};ccs.TweenFunction.quadEaseOut=function(t){return-1*t*(t-2)};ccs.TweenFunction.quadEaseInOut=function(t){t=t*2;if(t<1)return.5*t*t;--t;return-.5*(t*(t-2)-1)};ccs.TweenFunction.cubicEaseIn=function(t){return t*t*t};ccs.TweenFunction.cubicEaseOut=function(t){t-=1;return t*t*t+1};ccs.TweenFunction.cubicEaseInOut=function(t){t=t*2;if(t<1)return.5*t*t*t;t-=2;return.5*(t*t*t+2)};ccs.TweenFunction.quartEaseIn=function(t){return t*t*t*t};ccs.TweenFunction.quartEaseOut=function(t){t-=1;return-(t*t*t*t-1)};ccs.TweenFunction.quartEaseInOut=function(t){t=t*2;if(t<1)return.5*t*t*t*t;t-=2;return-.5*(t*t*t*t-2)};ccs.TweenFunction.quintEaseIn=function(t){return t*t*t*t*t};ccs.TweenFunction.quintEaseOut=function(t){t-=1;return t*t*t*t*t+1};ccs.TweenFunction.quintEaseInOut=function(t){t=t*2;if(t<1)return.5*t*t*t*t*t;t-=2;return.5*(t*t*t*t*t+2)};ccs.TweenFunction.expoEaseIn=function(t){return t===0?0:Math.pow(2,10*(t-1))-.001};ccs.TweenFunction.expoEaseOut=function(t){return t===1?1:-Math.pow(2,-10*t)+1};ccs.TweenFunction.expoEaseInOut=function(t){t/=.5;if(t<1){t=.5*Math.pow(2,10*(t-1))}else{t=.5*(-Math.pow(2,-10*(t-1))+2)}return t};ccs.TweenFunction.circEaseIn=function(t){return-1*(Math.sqrt(1-t*t)-1)};ccs.TweenFunction.circEaseOut=function(t){t=t-1;return Math.sqrt(1-t*t)};ccs.TweenFunction.circEaseInOut=function(t){t=t*2;if(t<1)return-.5*(Math.sqrt(1-t*t)-1);t-=2;return.5*(Math.sqrt(1-t*t)+1)};ccs.TweenFunction.elasticEaseIn=function(t,e){var i=.3;if(e.length>0){i=e[0]}var n=0;if(t===0||t===1){n=t}else{var r=i/4;t=t-1;n=-Math.pow(2,10*t)*Math.sin((t-r)*ccs.DOUBLE_PI/i)}return n};ccs.TweenFunction.elasticEaseOut=function(t,e){var i=.3;if(e.length>0){i=e[0]}var n=0;if(t===0||t===1){n=t}else{var r=i/4;n=Math.pow(2,-10*t)*Math.sin((t-r)*ccs.DOUBLE_PI/i)+1}return n};ccs.TweenFunction.elasticEaseInOut=function(t,e){var i=.3;if(e.length>0){i=e[0]}var n=0;if(t===0||t===1){n=t}else{t=t*2;if(!i){i=.3*1.5}var r=i/4;t=t-1;if(t<0){n=-.5*Math.pow(2,10*t)*Math.sin((t-r)*ccs.DOUBLE_PI/i)}else{n=Math.pow(2,-10*t)*Math.sin((t-r)*ccs.DOUBLE_PI/i)*.5+1}}return n};ccs.TweenFunction.backEaseIn=function(t){var e=1.70158;return t*t*((e+1)*t-e)};ccs.TweenFunction.backEaseOut=function(t){var e=1.70158;t=t-1;return t*t*((e+1)*t+e)+1};ccs.TweenFunction.backEaseInOut=function(t){var e=1.70158*1.525;t=t*2;if(t<1){return t*t*((e+1)*t-e)/2}else{t=t-2;return t*t*((e+1)*t+e)/2+1}};ccs.bounceTime=function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){t-=1.5/2.75;return 7.5625*t*t+.75}else if(t<2.5/2.75){t-=2.25/2.75;return 7.5625*t*t+.9375}t-=2.625/2.75;return 7.5625*t*t+.984375};ccs.TweenFunction.bounceEaseIn=function(t){return 1-ccs.bounceTime(1-t)};ccs.TweenFunction.bounceEaseOut=function(t){return ccs.bounceTime(t)};ccs.TweenFunction.bounceEaseInOut=function(t){var e=0;if(t<.5){t=t*2;e=(1-ccs.bounceTime(1-t))*.5}else{e=ccs.bounceTime(t*2-1)*.5+.5}return e};ccs.TweenFunction.customEase=function(t,e){if(e.length>0){var i=1-t;return e[1]*i*i*i+3*e[3]*t*i*i+3*e[5]*t*t*i+e[7]*t*t*t}return t};ccs.TweenFunction.easeIn=function(t,e){return Math.pow(t,e)};ccs.TweenFunction.easeOut=function(t,e){return Math.pow(t,1/e)};ccs.TweenFunction.easeInOut=function(t,e){t*=2;if(t<1){return.5*Math.pow(t,e)}else{return 1-.5*Math.pow(2-t,e)}};ccs.TweenFunction.quadraticIn=function(t){return Math.pow(t,2)};ccs.TweenFunction.quadraticOut=function(t){return-t*(t-2)};ccs.TweenFunction.bezieratFunction=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n};var ENABLE_PHYSICS_DETECT=false;ccs.fmodf=function(t,e){while(t>e){t-=e}return t};var CC_SAFE_RELEASE=function(t){if(t&&t.release){t.release()}};ccs.isSpriteContainPoint=function(t,e,i){var n=t.convertToNodeSpace(e);if(i){i.x=n.x;i.y=n.y}var r=t.getContentSize();return cc.rectContainsPoint(cc.rect(0,0,r.width,r.height),n)};ccs.SPRITE_CONTAIN_POINT=ccs.isSpriteContainPoint;ccs.SPRITE_CONTAIN_POINT_WITH_RETURN=ccs.isSpriteContainPoint;ccs.extBezierTo=function(t,e,i,n,r){var s=cc.p(0,0);if(n&&!r){s.x=Math.pow(1-t,2)*e.x+2*t*(1-t)*i.x+Math.pow(t,2)*n.x;s.y=Math.pow(1-t,2)*e.y+2*t*(1-t)*i.y+Math.pow(t,2)*n.y}if(r){s.x=e.x*Math.pow(1-t,3)+3*t*i.x*Math.pow(1-t,2)+3*n.x*Math.pow(t,2)*(1-t)+r.x*Math.pow(t,3);s.y=e.y*Math.pow(1-t,3)+3*t*i.y*Math.pow(1-t,2)+3*n.y*Math.pow(t,2)*(1-t)+r.y*Math.pow(t,3)}return s};ccs.extCircleTo=function(t,e,i,n,r){var s=cc.p(0,0);s.x=e.x+i*Math.cos(n+r*t);s.y=e.y+i*Math.sin(n+r*t);return s};ccs.RelativeData=function(){this.plistFiles=[];this.armatures=[];this.animations=[];this.textures=[]};ccs.armatureDataManager={_animationDatas:{},_armatureDatas:{},_textureDatas:{},_autoLoadSpriteFile:false,_relativeDatas:{},s_sharedArmatureDataManager:null,removeArmatureFileInfo:function(t){var e=this.getRelativeData(t);if(e){var i,n;for(i=0;i<e.armatures.length;i++){n=e.armatures[i];this.removeArmatureData(n)}for(i=0;i<e.animations.length;i++){n=e.animations[i];this.removeAnimationData(n)}for(i=0;i<e.textures.length;i++){n=e.textures[i];this.removeTextureData(n)}for(i=0;i<e.plistFiles.length;i++){n=e.plistFiles[i];cc.spriteFrameCache.removeSpriteFramesFromFile(n)}delete this._relativeDatas[t];ccs.dataReaderHelper.removeConfigFile(t)}},addArmatureData:function(t,e,i){var n=this.getRelativeData(i);if(n){n.armatures.push(t)}this._armatureDatas[t]=e},getArmatureData:function(t){var e=null;if(this._armatureDatas){e=this._armatureDatas[t]}return e},removeArmatureData:function(t){if(this._armatureDatas[t])delete this._armatureDatas[t]},addAnimationData:function(t,e,i){var n=this.getRelativeData(i);if(n)n.animations.push(t);this._animationDatas[t]=e},getAnimationData:function(t){var e=null;if(this._animationDatas[t]){e=this._animationDatas[t]}return e},removeAnimationData:function(t){if(this._animationDatas[t])delete this._animationDatas[t]},addTextureData:function(t,e,i){var n=this.getRelativeData(i);if(n){n.textures.push(t)}this._textureDatas[t]=e},getTextureData:function(t){var e=null;if(this._textureDatas){e=this._textureDatas[t]}return e},removeTextureData:function(t){if(this._textureDatas[t])delete this._textureDatas[t]},addArmatureFileInfo:function(){var t,e,i;switch(arguments.length){case 1:i=arguments[0];this.addRelativeData(i);this._autoLoadSpriteFile=true;ccs.dataReaderHelper.addDataFromFile(i);break;case 3:t=arguments[0];e=arguments[1];i=arguments[2];this.addRelativeData(i);this._autoLoadSpriteFile=false;ccs.dataReaderHelper.addDataFromFile(i);this.addSpriteFrameFromFile(e,t)}},addArmatureFileInfoAsync:function(){var t,e,i,n,r;switch(arguments.length){case 3:i=arguments[0];n=arguments[2];r=arguments[1];this.addRelativeData(i);this._autoLoadSpriteFile=true;ccs.dataReaderHelper.addDataFromFileAsync("","",i,r,n);break;case 5:t=arguments[0];e=arguments[1];i=arguments[2];n=arguments[4];r=arguments[3];this.addRelativeData(i);this._autoLoadSpriteFile=false;ccs.dataReaderHelper.addDataFromFileAsync(t,e,i,r,n);this.addSpriteFrameFromFile(e,t)}},addSpriteFrameFromFile:function(t,e,i){var n=this.getRelativeData(i);if(n)n.plistFiles.push(t);ccs.spriteFrameCacheHelper.addSpriteFrameFromFile(t,e)},isAutoLoadSpriteFile:function(){return this._autoLoadSpriteFile},getArmatureDatas:function(){return this._armatureDatas},getAnimationDatas:function(){return this._animationDatas},getTextureDatas:function(){return this._textureDatas},addRelativeData:function(t){if(!this._relativeDatas[t])this._relativeDatas[t]=new ccs.RelativeData},getRelativeData:function(t){return this._relativeDatas[t]},clear:function(){this._animationDatas={};this._armatureDatas={};this._textureDatas={};ccs.spriteFrameCacheHelper.clear();ccs.dataReaderHelper.clear()}};ccs.BLEND_TYPE_NORMAL=0;ccs.BLEND_TYPE_LAYER=1;ccs.BLEND_TYPE_DARKEN=2;ccs.BLEND_TYPE_MULTIPLY=3;ccs.BLEND_TYPE_LIGHTEN=4;ccs.BLEND_TYPE_SCREEN=5;ccs.BLEND_TYPE_OVERLAY=6;ccs.BLEND_TYPE_HIGHLIGHT=7;ccs.BLEND_TYPE_ADD=8;ccs.BLEND_TYPE_SUBTRACT=9;ccs.BLEND_TYPE_DIFFERENCE=10;ccs.BLEND_TYPE_INVERT=11;ccs.BLEND_TYPE_ALPHA=12;ccs.BLEND_TYPE_ERASE=13;ccs.DISPLAY_TYPE_SPRITE=0;ccs.DISPLAY_TYPE_ARMATURE=1;ccs.DISPLAY_TYPE_PARTICLE=2;ccs.DISPLAY_TYPE_MAX=3;
ccs.BaseData=ccs.Class.extend({x:0,y:0,zOrder:0,skewX:0,skewY:0,scaleX:1,scaleY:1,tweenRotate:0,isUseColorInfo:false,r:255,g:255,b:255,a:255,ctor:function(){this.x=0;this.y=0;this.zOrder=0;this.skewX=0;this.skewY=0;this.scaleX=1;this.scaleY=1;this.tweenRotate=0;this.isUseColorInfo=false;this.r=255;this.g=255;this.b=255;this.a=255},copy:function(t){this.x=t.x;this.y=t.y;this.zOrder=t.zOrder;this.scaleX=t.scaleX;this.scaleY=t.scaleY;this.skewX=t.skewX;this.skewY=t.skewY;this.tweenRotate=t.tweenRotate;this.isUseColorInfo=t.isUseColorInfo;this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a},setColor:function(t){this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a},getColor:function(){return cc.color(this.r,this.g,this.b,this.a)},subtract:function(t,e,i){this.x=e.x-t.x;this.y=e.y-t.y;this.scaleX=e.scaleX-t.scaleX;this.scaleY=e.scaleY-t.scaleY;this.skewX=e.skewX-t.skewX;this.skewY=e.skewY-t.skewY;if(this.isUseColorInfo||t.isUseColorInfo||e.isUseColorInfo){this.a=e.a-t.a;this.r=e.r-t.r;this.g=e.g-t.g;this.b=e.b-t.b;this.isUseColorInfo=true}else{this.a=this.r=this.g=this.b=0;this.isUseColorInfo=false}if(i){if(this.skewX>ccs.M_PI)this.skewX-=ccs.DOUBLE_PI;if(this.skewX<-ccs.M_PI)this.skewX+=ccs.DOUBLE_PI;if(this.skewY>ccs.M_PI)this.skewY-=ccs.DOUBLE_PI;if(this.skewY<-ccs.M_PI)this.skewY+=ccs.DOUBLE_PI}if(e.tweenRotate){this.skewX+=e.tweenRotate*ccs.PI*2;this.skewY-=e.tweenRotate*ccs.PI*2}}});ccs.DisplayData=ccs.Class.extend({displayType:ccs.DISPLAY_TYPE_MAX,displayName:"",ctor:function(){this.displayType=ccs.DISPLAY_TYPE_MAX},changeDisplayToTexture:function(t){var e=t;var i=e.lastIndexOf(".");if(i!==-1)e=e.substring(0,i);return e},copy:function(t){this.displayName=t.displayName;this.displayType=t.displayType}});ccs.SpriteDisplayData=ccs.DisplayData.extend({skinData:null,ctor:function(){this.skinData=new ccs.BaseData;this.displayType=ccs.DISPLAY_TYPE_SPRITE},copy:function(t){ccs.DisplayData.prototype.copy.call(this,t);this.skinData=t.skinData}});ccs.ArmatureDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayName="";this.displayType=ccs.DISPLAY_TYPE_ARMATURE}});ccs.ParticleDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayType=ccs.DISPLAY_TYPE_PARTICLE}});ccs.BoneData=ccs.BaseData.extend({displayDataList:null,name:"",parentName:"",boneDataTransform:null,ctor:function(){this.displayDataList=[];this.name="";this.parentName="";this.boneDataTransform=null},init:function(){this.displayDataList.length=0;return true},addDisplayData:function(t){this.displayDataList.push(t)},getDisplayData:function(t){return this.displayDataList[t]}});ccs.ArmatureData=ccs.Class.extend({boneDataDic:null,name:"",dataVersion:.1,ctor:function(){this.boneDataDic={};this.name="";this.dataVersion=.1},init:function(){return true},addBoneData:function(t){this.boneDataDic[t.name]=t},getBoneDataDic:function(){return this.boneDataDic},getBoneData:function(t){return this.boneDataDic[t]}});ccs.FrameData=ccs.BaseData.extend({duration:0,tweenEasing:0,easingParamNumber:0,easingParams:null,displayIndex:-1,movement:"",event:"",sound:"",soundEffect:"",blendFunc:null,frameID:0,isTween:true,ctor:function(){ccs.BaseData.prototype.ctor.call(this);this.duration=1;this.tweenEasing=ccs.TweenType.LINEAR;this.easingParamNumber=0;this.easingParams=[];this.displayIndex=0;this.movement="";this.event="";this.sound="";this.soundEffect="";this.blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this.frameID=0;this.isTween=true},copy:function(t){ccs.BaseData.prototype.copy.call(this,t);this.duration=t.duration;this.displayIndex=t.displayIndex;this.tweenEasing=t.tweenEasing;this.easingParamNumber=t.easingParamNumber;if(this.easingParamNumber!==0){this.easingParams.length=0;for(var e=0;e<this.easingParamNumber;e++){this.easingParams[e]=t.easingParams[e]}}this.blendFunc=t.blendFunc;this.isTween=t.isTween}});ccs.MovementBoneData=ccs.Class.extend({delay:0,scale:1,duration:0,frameList:null,name:"",ctor:function(){this.delay=0;this.scale=1;this.duration=0;this.frameList=[];this.name=""},init:function(){return true},addFrameData:function(t){this.frameList.push(t)},getFrameData:function(t){return this.frameList[t]}});ccs.MovementData=function(){this.name="";this.duration=0;this.scale=1;this.durationTo=0;this.durationTween=0;this.loop=true;this.tweenEasing=ccs.TweenType.LINEAR;this.movBoneDataDic={}};ccs.MovementData.prototype.addMovementBoneData=function(t){this.movBoneDataDic[t.name]=t};ccs.MovementData.prototype.getMovementBoneData=function(t){return this.movBoneDataDic[t]};ccs.AnimationData=function(){this.movementDataDic={};this.movementNames=[];this.name=""};ccs.AnimationData.prototype.addMovement=function(t){this.movementDataDic[t.name]=t;this.movementNames.push(t.name)};ccs.AnimationData.prototype.getMovement=function(t){return this.movementDataDic[t]};ccs.AnimationData.prototype.getMovementCount=function(){return Object.keys(this.movementDataDic).length};ccs.ContourVertex2=function(t,e){this.x=t||0;this.y=e||0};ccs.ContourData=function(){this.vertexList=[]};ccs.ContourData.prototype.init=function(){this.vertexList.length=0;return true};ccs.ContourData.prototype.addVertex=function(t){this.vertexList.push(t)};ccs.TextureData=function(){this.height=0;this.width=0;this.pivotX=.5;this.pivotY=.5;this.name="";this.contourDataList=[]};ccs.TextureData.prototype.init=function(){this.contourDataList.length=0};ccs.TextureData.prototype.addContourData=function(t){this.contourDataList.push(t)};ccs.TextureData.prototype.getContourData=function(t){return this.contourDataList[t]};ccs.DecorativeDisplay=ccs.Class.extend({_display:null,_colliderDetector:null,_displayData:null,ctor:function(){this._display=null;this._colliderDetector=null;this._displayData=null},init:function(){return true},setDisplay:function(t){if(t._parent){t._parent.removeChild(t);delete t._parent}this._display=t},getDisplay:function(){return this._display},setColliderDetector:function(t){this._colliderDetector=t},getColliderDetector:function(){return this._colliderDetector},setDisplayData:function(t){this._displayData=t},getDisplayData:function(){return this._displayData},release:function(){this._display=null;this._displayData=null;this._colliderDetector=null}});ccs.DecorativeDisplay.create=function(){return new ccs.DecorativeDisplay};ccs.displayFactory={addDisplay:function(t,e,i){switch(i.displayType){case ccs.DISPLAY_TYPE_SPRITE:this.addSpriteDisplay(t,e,i);break;case ccs.DISPLAY_TYPE_PARTICLE:this.addParticleDisplay(t,e,i);break;case ccs.DISPLAY_TYPE_ARMATURE:this.addArmatureDisplay(t,e,i);break;default:break}},createDisplay:function(t,e){switch(e.getDisplayData().displayType){case ccs.DISPLAY_TYPE_SPRITE:this.createSpriteDisplay(t,e);break;case ccs.DISPLAY_TYPE_PARTICLE:this.createParticleDisplay(t,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.createArmatureDisplay(t,e);break;default:break}},_helpTransform:{a:1,b:0,c:0,d:1,tx:0,ty:0},updateDisplay:function(t,e,i){var n=t.getDisplayRenderNode();if(!n)return;switch(t.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(i)n.updateArmatureTransform();break;case ccs.DISPLAY_TYPE_PARTICLE:this.updateParticleDisplay(t,n,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.updateArmatureDisplay(t,n,e);break;default:var r=t.getNodeToArmatureTransform();n.setAdditionalTransform(r);break}if(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){if(i){var s=t.getDisplayManager().getCurrentDecorativeDisplay();var a=s.getColliderDetector();if(a){var o=s.getDisplay();var c=o.getNodeToParentTransform();var l=this._helpTransform;l.a=c.a;l.b=c.b;l.c=c.c;l.d=c.d;l.tx=c.tx;l.ty=c.ty;var h=cc.pointApplyAffineTransform(o.getAnchorPointInPoints(),l);l.tx=h.x;l.ty=h.y;var u=cc.affineTransformConcat(l,t.getArmature().getNodeToParentTransform());a.updateTransform(u)}}}},addSpriteDisplay:function(t,e,i){var n=new ccs.SpriteDisplayData;n.copy(i);e.setDisplayData(n);this.createSpriteDisplay(t,e)},createSpriteDisplay:function(t,e){var i=null;var n=e.getDisplayData();var r=n.displayName;var s=r.lastIndexOf(".");if(s!==-1)r=r.substring(0,s);if(r==="")i=new ccs.Skin;else i=new ccs.Skin("#"+r+".png");e.setDisplay(i);i.setBone(t);this.initSpriteDisplay(t,e,n.displayName,i);var a=t.getArmature();if(a){if(a.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED)i.setSkinData(n.skinData);else i.setSkinData(t.boneData)}},initSpriteDisplay:function(t,e,i,n){var r=i;var s=r.lastIndexOf(".");if(s!==-1)r=r.substring(0,s);var a=ccs.armatureDataManager.getTextureData(r);if(a){n.setAnchorPoint(cc.p(a.pivotX,a.pivotY))}if(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){if(a&&a.contourDataList.length>0){var o=new ccs.ColliderDetector(t);o.addContourDataList(a.contourDataList);e.setColliderDetector(o)}}},addArmatureDisplay:function(t,e,i){var n=new ccs.ArmatureDisplayData;n.copy(i);e.setDisplayData(n);this.createArmatureDisplay(t,e)},createArmatureDisplay:function(t,e){var i=e.getDisplayData();var n=new ccs.Armature(i.displayName,t);e.setDisplay(n)},updateArmatureDisplay:function(t,e,i){if(e){e.sortAllChildren();e.update(i)}},addParticleDisplay:function(t,e,i){var n=new ccs.ParticleDisplayData;n.copy(i);e.setDisplayData(n);this.createParticleDisplay(t,e)},createParticleDisplay:function(t,e){var i=e.getDisplayData();var n=new cc.ParticleSystem(i.displayName);n.removeFromParent();n.cleanup();var r=t.getArmature();if(r)n.setParent(t.getArmature());e.setDisplay(n)},updateParticleDisplay:function(t,e,i){var n=new ccs.BaseData;ccs.TransformHelp.matrixToNode(t.nodeToArmatureTransform(),n);e.setPosition(n.x,n.y);e.setScaleX(n.scaleX);e.setScaleY(n.scaleY);e.update(i)}};ccs.DisplayManager=ccs.Class.extend({_decoDisplayList:null,_currentDecoDisplay:null,_displayRenderNode:null,_displayIndex:null,_forceChangeDisplay:false,_bone:null,_visible:true,_displayType:null,ctor:function(t){this._decoDisplayList=[];this._currentDecoDisplay=null;this._displayRenderNode=null;this._displayIndex=null;this._forceChangeDisplay=false;this._bone=null;this._visible=true;this._displayType=ccs.DISPLAY_TYPE_MAX;t&&ccs.DisplayManager.prototype.init.call(this,t)},init:function(t){this._bone=t;this.initDisplayList(t.getBoneData());return true},addDisplay:function(t,e){var i,n=this._decoDisplayList;if(e>=0&&e<n.length)i=n[e];else{i=new ccs.DecorativeDisplay;n.push(i)}if(t instanceof ccs.DisplayData){ccs.displayFactory.addDisplay(this._bone,i,t);if(e===this._displayIndex){this._displayIndex=-1;this.changeDisplayWithIndex(e,false)}return}var r=null;if(t instanceof ccs.Skin){t.setBone(this._bone);r=new ccs.SpriteDisplayData;ccs.displayFactory.initSpriteDisplay(this._bone,i,t.getDisplayName(),t);var s=i.getDisplayData();if(s instanceof ccs.SpriteDisplayData){t.setSkinData(s.skinData);r.skinData=s.skinData}else{var a=false;for(var o=n.length-2;o>=0;o--){var c=n[o];var l=c.getDisplayData();if(l instanceof ccs.SpriteDisplayData){a=true;t.setSkinData(l.skinData);r.skinData=l.skinData;break}}if(!a)t.setSkinData(new ccs.BaseData)}}else if(t instanceof cc.ParticleSystem){r=new ccs.ParticleDisplayData;t.removeFromParent();t.cleanup();var h=this._bone.getArmature();if(h)t.setParent(h)}else if(t instanceof ccs.Armature){r=new ccs.ArmatureDisplayData;r.displayName=t.getName();t.setParentBone(this._bone)}else r=new ccs.DisplayData;i.setDisplay(t);i.setDisplayData(r);if(e===this._displayIndex){this._displayIndex=-1;this.changeDisplayWithIndex(e,false)}},_addDisplayOther:function(t,e){var i=null;if(e instanceof ccs.Skin){var n=e;n.setBone(this._bone);i=new ccs.SpriteDisplayData;i.displayName=n.getDisplayName();ccs.displayFactory.initSpriteDisplay(this._bone,t,n.getDisplayName(),n);var r=t.getDisplayData();if(r instanceof ccs.SpriteDisplayData)n.setSkinData(r.skinData);else{var s=false;for(var a=this._decoDisplayList.length-2;a>=0;a--){var o=this._decoDisplayList[a];var c=o.getDisplayData();if(c){s=true;n.setSkinData(c.skinData);i.skinData=c.skinData;break}}if(!s){n.setSkinData(new ccs.BaseData)}n.setSkinData(new ccs.BaseData)}}else if(e instanceof cc.ParticleSystem){i=new ccs.ParticleDisplayData;i.displayName=e._plistFile}else if(e instanceof ccs.Armature){i=new ccs.ArmatureDisplayData;i.displayName=e.getName();e.setParentBone(this._bone)}else{i=new ccs.DisplayData}t.setDisplay(e);t.setDisplayData(i)},removeDisplay:function(t){this._decoDisplayList.splice(t,1);if(t===this._displayIndex){this.setCurrentDecorativeDisplay(null);this._displayIndex=-1}},getDecorativeDisplayList:function(){return this._decoDisplayList},changeDisplayWithIndex:function(t,e){if(t>=this._decoDisplayList.length){cc.log("the index value is out of range");return}this._forceChangeDisplay=e;if(this._displayIndex===t)return;this._displayIndex=t;if(t<0){if(this._displayRenderNode){this._displayRenderNode.removeFromParent(true);this.setCurrentDecorativeDisplay(null)}return}this.setCurrentDecorativeDisplay(this._decoDisplayList[t])},changeDisplayWithName:function(t,e){var i=this._decoDisplayList;for(var n=0;n<i.length;n++){if(i[n].getDisplayData().displayName===t){this.changeDisplayWithIndex(n,e);break}}},setCurrentDecorativeDisplay:function(t){var e=this._currentDecoDisplay;if(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){if(e&&e.getColliderDetector())e.getColliderDetector().setActive(false)}this._currentDecoDisplay=t;e=this._currentDecoDisplay;if(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){if(e&&e.getColliderDetector())e.getColliderDetector().setActive(true)}var i=!e?null:e.getDisplay();var n=this._displayRenderNode,r=this._bone;if(n){if(n instanceof ccs.Armature)r.setChildArmature(null);n.removeFromParent(true)}this._displayRenderNode=i;if(i){if(i instanceof ccs.Armature){this._bone.setChildArmature(i);i.setParentBone(this._bone)}else if(i instanceof cc.ParticleSystem){if(i instanceof ccs.Armature){r.setChildArmature(i);i.setParentBone(r)}else if(i instanceof cc.ParticleSystem)i.resetSystem()}i.setColor(r.getDisplayedColor());i.setOpacity(r.getDisplayedOpacity());this._displayRenderNode.setVisible(this._visible);this._displayType=this._currentDecoDisplay.getDisplayData().displayType}else this._displayType=ccs.DISPLAY_TYPE_MAX;cc.renderer.childrenOrderDirty=true},getDisplayRenderNode:function(){return this._displayRenderNode},getDisplayRenderNodeType:function(){return this._displayType},getCurrentDisplayIndex:function(){return this._displayIndex},getCurrentDecorativeDisplay:function(){return this._currentDecoDisplay},getDecorativeDisplayByIndex:function(t){return this._decoDisplayList[t]},initDisplayList:function(t){this._decoDisplayList.length=0;if(!t)return;var e=t.displayDataList,i=this._decoDisplayList,n=this._bone;for(var r=0;r<e.length;r++){var s=e[r];var a=new ccs.DecorativeDisplay;a.setDisplayData(s);ccs.displayFactory.createDisplay(n,a);i.push(a)}},containPoint:function(t,e){if(!this._visible||this._displayIndex<0)return false;if(e!==undefined)t=cc.p(t,e);if(this._currentDecoDisplay.getDisplayData().displayType===ccs.DISPLAY_TYPE_SPRITE){var i=this._currentDecoDisplay.getDisplay();i=i.getChildByTag(0);return ccs.SPRITE_CONTAIN_POINT_WITH_RETURN(i,t)}return false},setVisible:function(t){if(!this._displayRenderNode)return;this._visible=t;this._displayRenderNode.setVisible(t)},isVisible:function(){return this._visible},getContentSize:function(){if(!this._displayRenderNode)return cc.size(0,0);return this._displayRenderNode.getContentSize()},getBoundingBox:function(){if(!this._displayRenderNode)return cc.rect(0,0,0,0);return this._displayRenderNode.getBoundingBox()},getAnchorPoint:function(){if(!this._displayRenderNode)return cc.p(0,0);return this._displayRenderNode.getAnchorPoint()},getAnchorPointInPoints:function(){if(!this._displayRenderNode)return cc.p(0,0);return this._displayRenderNode.getAnchorPointInPoints()},getForceChangeDisplay:function(){return this._forceChangeDisplay},release:function(){this._decoDisplayList=null;if(this._displayRenderNode){this._displayRenderNode.removeFromParent(true);this._displayRenderNode=null}}});ccs.DisplayManager.create=function(t){return new ccs.DisplayManager(t)};ccs.Skin=ccs.Sprite.extend({_skinData:null,bone:null,_skinTransform:null,_displayName:"",_armature:null,_className:"Skin",ctor:function(t,e){cc.Sprite.prototype.ctor.call(this);this._skinData=null;this.bone=null;this._displayName="";this._skinTransform=cc.affineTransformIdentity();this._armature=null;if(t==null||t===""){ccs.Skin.prototype.init.call(this)}else{if(t[0]==="#"){ccs.Skin.prototype.initWithSpriteFrameName.call(this,t.substr(1))}else{ccs.Skin.prototype.initWithFile.call(this,t,e)}}},initWithSpriteFrameName:function(t){if(t==="")return false;var e=cc.spriteFrameCache.getSpriteFrame(t);var i=true;if(e)this.initWithSpriteFrame(e);else{cc.log("Can't find CCSpriteFrame with %s. Please check your .plist file",t);i=false}this._displayName=t;return i},initWithFile:function(t,e){var i=e?cc.Sprite.prototype.initWithFile.call(this,t,e):cc.Sprite.prototype.initWithFile.call(this,t);this._displayName=t;return i},setSkinData:function(t){this._skinData=t;this.setScaleX(t.scaleX);this.setScaleY(t.scaleY);this.setRotationX(cc.radiansToDegrees(t.skewX));this.setRotationY(cc.radiansToDegrees(-t.skewY));this.setPosition(t.x,t.y);var e=this.getNodeToParentTransform?this.getNodeToParentTransform():this.nodeToParentTransform();var i=this._skinTransform;i.a=e.a;i.b=e.b;i.c=e.c;i.d=e.d;i.tx=e.tx;i.ty=e.ty;this.updateArmatureTransform()},getSkinData:function(){return this._skinData},updateArmatureTransform:function(){this._renderCmd.updateArmatureTransform()},getNodeToWorldTransform:function(){return this._renderCmd.getNodeToWorldTransform()},getNodeToWorldTransformAR:function(){return this._renderCmd.getNodeToWorldTransformAR()},setBone:function(t){this.bone=t;var e=this.bone.getArmature();if(e)this._armature=e},getBone:function(){return this.bone},getDisplayName:function(){return this._displayName},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new ccs.Skin.CanvasRenderCmd(this);else return new ccs.Skin.WebGLRenderCmd(this)}});var _p=ccs.Skin.prototype;_p.skinData;cc.defineGetterSetter(_p,"skinData",_p.getSkinData,_p.setSkinData);_p.displayName;cc.defineGetterSetter(_p,"displayName",_p.getDisplayName);_p=null;ccs.Skin.create=function(t,e){return new ccs.Skin(t,e)};ccs.Skin.createWithSpriteFrameName=function(t){return new ccs.Skin("#"+t)};(function(){ccs.Skin.RenderCmd={updateArmatureTransform:function(){var t=this._node;this._transform=cc.affineTransformConcat(t._skinTransform,t.bone.getNodeToArmatureTransform());this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._transform,this._node.bone.getArmature().getNodeToWorldTransform())},getNodeToWorldTransformAR:function(){var t=this._transform,e=this._node;this._anchorPointInPoints=cc.pointApplyAffineTransform(this._anchorPointInPoints,t);t.tx=this._anchorPointInPoints.x;t.ty=this._anchorPointInPoints.y;return cc.affineTransformConcat(t,e.bone.getArmature().getNodeToWorldTransform())}};ccs.Skin.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t);this._needDraw=true};var t=ccs.Skin.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,t);t.constructor=ccs.Skin.CanvasRenderCmd})();ccs.ANIMATION_TYPE_SINGLE_FRAME=-4;ccs.ANIMATION_TYPE_NO_LOOP=-3;ccs.ANIMATION_TYPE_TO_LOOP_FRONT=-2;ccs.ANIMATION_TYPE_TO_LOOP_BACK=-1;ccs.ANIMATION_TYPE_LOOP_FRONT=0;ccs.ANIMATION_TYPE_LOOP_BACK=1;ccs.ANIMATION_TYPE_MAX=2;ccs.ProcessBase=ccs.Class.extend({_processScale:1,_isComplete:true,_isPause:true,_isPlaying:false,_currentPercent:0,_rawDuration:0,_loopType:0,_tweenEasing:0,animationInternal:null,_currentFrame:0,_durationTween:0,_nextFrameIndex:0,_curFrameIndex:null,_isLoopBack:false,ctor:function(){this._processScale=1;this._isComplete=true;this._isPause=true;this._isPlaying=false;this._currentFrame=0;this._currentPercent=0;this._durationTween=0;this._rawDuration=0;this._loopType=ccs.ANIMATION_TYPE_LOOP_BACK;this._tweenEasing=ccs.TweenType.LINEAR;this.animationInternal=1/60;this._curFrameIndex=0;this._durationTween=0;this._isLoopBack=false},pause:function(){this._isPause=true;this._isPlaying=false},resume:function(){this._isPause=false;this._isPlaying=true},stop:function(){this._isComplete=true;this._isPlaying=false},play:function(t,e,i,n){this._isComplete=false;this._isPause=false;this._isPlaying=true;this._currentFrame=0;this._nextFrameIndex=t;this._tweenEasing=n},update:function(t){if(this._isComplete||this._isPause)return;if(this._rawDuration<=0||t>1)return;var e=this._nextFrameIndex===undefined?0:this._nextFrameIndex;var i=this._currentFrame;if(e<=0){this._currentPercent=1;i=0}else{i+=this._processScale*(t/this.animationInternal);this._currentPercent=i/e;i=ccs.fmodf(i,e)}this._currentFrame=i;this.updateHandler()},gotoFrame:function(t){var e=this._loopType;if(e===ccs.ANIMATION_TYPE_NO_LOOP)e=ccs.ANIMATION_TYPE_MAX;else if(e===ccs.ANIMATION_TYPE_TO_LOOP_FRONT)e=ccs.ANIMATION_TYPE_LOOP_FRONT;this._loopType=e;this._curFrameIndex=t;this._nextFrameIndex=this._durationTween},getCurrentFrameIndex:function(){this._curFrameIndex=(this._rawDuration-1)*this._currentPercent;return this._curFrameIndex},updateHandler:function(){},isPause:function(){return this._isPause},isComplete:function(){return this._isComplete},getCurrentPercent:function(){return this._currentPercent},getRawDuration:function(){return this._rawDuration},getLoop:function(){return this._loopType},getTweenEasing:function(){return this._tweenEasing},getAnimationInternal:function(){return this.animationInternal},setAnimationInternal:function(t){this.animationInternal=t},getProcessScale:function(){return this._processScale},setProcessScale:function(t){this._processScale=t},isPlaying:function(){return this._isPlaying}});var _p=ccs.ProcessBase.prototype;_p.currentFrameIndex;cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex);_p.paused;cc.defineGetterSetter(_p,"paused",_p.isPause);_p.completed;cc.defineGetterSetter(_p,"completed",_p.isComplete);_p.currentPercent;cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent);_p.rawDuration;cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration);_p.loop;cc.defineGetterSetter(_p,"loop",_p.getLoop);_p.tweenEasing;cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing);_p.playing;cc.defineGetterSetter(_p,"playing",_p.isPlaying);_p=null;ccs.MovementEventType={start:0,complete:1,loopComplete:2};ccs.AnimationEvent=ccs.Class.extend({_arguments:null,_callFunc:null,_selectorTarget:null,ctor:function(t,e,i){this._data=i;this._callFunc=t;this._selectorTarget=e},call:function(){if(this._callFunc)this._callFunc.apply(this._selectorTarget,this._arguments)},setArguments:function(t){this._arguments=t}});ccs.MovementEvent=function(){this.armature=null;this.movementType=ccs.MovementEventType.start;this.movementID=""};ccs.FrameEvent=function(){this.bone=null;this.frameEventName="";this.originFrameIndex=0;this.currentFrameIndex=0};ccs.ArmatureAnimation=ccs.ProcessBase.extend({_animationData:null,_movementData:null,_armature:null,_movementID:"",_toIndex:0,_tweenList:null,_speedScale:1,_ignoreFrameEvent:false,_frameEventQueue:null,_movementEventQueue:null,_movementList:null,_onMovementList:false,_movementListLoop:false,_movementIndex:0,_movementListDurationTo:-1,_movementEventCallFunc:null,_frameEventCallFunc:null,_movementEventTarget:null,_frameEventTarget:null,_movementEventListener:null,_frameEventListener:null,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this);this._tweenList=[];this._movementList=[];this._frameEventQueue=[];this._movementEventQueue=[];this._armature=null;t&&ccs.ArmatureAnimation.prototype.init.call(this,t)},init:function(t){this._armature=t;this._tweenList.length=0;return true},pause:function(){var t=this._tweenList;for(var e=0;e<t.length;e++)t[e].pause();ccs.ProcessBase.prototype.pause.call(this)},resume:function(){var t=this._tweenList;for(var e=0;e<t.length;e++)t[e].resume();ccs.ProcessBase.prototype.resume.call(this)},stop:function(){var t=this._tweenList;for(var e=0;e<t.length;e++)t[e].stop();t.length=0;ccs.ProcessBase.prototype.stop.call(this)},setAnimationScale:function(t){this.setSpeedScale(t)},getAnimationScale:function(){return this.getSpeedScale()},setSpeedScale:function(t){if(t===this._speedScale)return;this._speedScale=t;this._processScale=!this._movementData?this._speedScale:this._speedScale*this._movementData.scale;var e=this._armature.getBoneDic();for(var i in e){var n=e[i];n.getTween().setProcessScale(this._processScale);if(n.getChildArmature())n.getChildArmature().getAnimation().setSpeedScale(this._processScale)}},getSpeedScale:function(){return this._speedScale},play:function(t,e,i){cc.assert(this._animationData,"this.animationData can not be null");this._movementData=this._animationData.getMovement(t);cc.assert(this._movementData,"this._movementData can not be null");e=e===undefined?-1:e;i=i===undefined?-1:i;this._rawDuration=this._movementData.duration;this._movementID=t;this._processScale=this._speedScale*this._movementData.scale;e=e===-1?this._movementData.durationTo:e;var n=this._movementData.durationTween===0?this._rawDuration:this._movementData.durationTween;var r=this._movementData.tweenEasing;i=i<0?this._movementData.loop:i;this._onMovementList=false;ccs.ProcessBase.prototype.play.call(this,e,n,i,r);if(this._rawDuration===0)this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME;else{this._loopType=i?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP;this._durationTween=n}this._tweenList.length=0;var s,a=this._armature.getBoneDic();for(var o in a){var c=a[o];s=this._movementData.movBoneDataDic[c.getName()];var l=c.getTween();if(s&&s.frameList.length>0){this._tweenList.push(l);s.duration=this._movementData.duration;l.play(s,e,n,i,r);l.setProcessScale(this._processScale);if(c.getChildArmature())c.getChildArmature().getAnimation().setSpeedScale(this._processScale)}else{if(!c.isIgnoreMovementBoneData()){c.getDisplayManager().changeDisplayWithIndex(-1,false);l.stop()}}}this._armature.update(0)},playByIndex:function(t,e,i,n,r){cc.log("playByIndex is deprecated. Use playWithIndex instead.");this.playWithIndex(t,e,n)},playWithIndex:function(t,e,i){var n=this._animationData.movementNames;cc.assert(t>-1&&t<n.length);var r=n[t];this.play(r,e,i)},playWithNames:function(t,e,i){e=e===undefined?-1:e;i=i===undefined?true:i;this._movementListLoop=i;this._movementListDurationTo=e;this._onMovementList=true;this._movementIndex=0;if(t instanceof Array)this._movementList=t;else this._movementList.length=0;this.updateMovementList()},playWithIndexes:function(t,e,i){e=e===undefined?-1:e;i=i===undefined?true:i;this._movementList.length=0;this._movementListLoop=i;this._movementListDurationTo=e;this._onMovementList=true;this._movementIndex=0;var n=this._animationData.movementNames;for(var r=0;r<t.length;r++){var s=n[t[r]];this._movementList.push(s)}this.updateMovementList()},gotoAndPlay:function(t){if(!this._movementData||t<0||t>=this._movementData.duration){cc.log("Please ensure you have played a movement, and the frameIndex is in the range.");return}var e=this._ignoreFrameEvent;this._ignoreFrameEvent=true;this._isPlaying=true;this._isComplete=this._isPause=false;ccs.ProcessBase.prototype.gotoFrame.call(this,t);this._currentPercent=this._curFrameIndex/(this._movementData.duration-1);this._currentFrame=this._nextFrameIndex*this._currentPercent;var i=this._tweenList;for(var n=0;n<i.length;n++)i[n].gotoAndPlay(t);this._armature.update(0);this._ignoreFrameEvent=e},gotoAndPause:function(t){this.gotoAndPlay(t);this.pause()},getMovementCount:function(){return this._animationData.getMovementCount()},update:function(t){ccs.ProcessBase.prototype.update.call(this,t);var e=this._tweenList;for(var i=0;i<e.length;i++)e[i].update(t);var n=this._frameEventQueue,r;while(n.length>0){r=n.shift();this._ignoreFrameEvent=true;if(this._frameEventCallFunc)this._frameEventCallFunc.call(this._frameEventTarget,r.bone,r.frameEventName,r.originFrameIndex,r.currentFrameIndex);if(this._frameEventListener)this._frameEventListener(r.bone,r.frameEventName,r.originFrameIndex,r.currentFrameIndex);this._ignoreFrameEvent=false}var s=this._movementEventQueue;while(s.length>0){r=s.shift();if(this._movementEventCallFunc)this._movementEventCallFunc.call(this._movementEventTarget,r.armature,r.movementType,r.movementID);if(this._movementEventListener)this._movementEventListener(r.armature,r.movementType,r.movementID)}},updateHandler:function(){var t=this._currentPercent;if(t>=1){switch(this._loopType){case ccs.ANIMATION_TYPE_NO_LOOP:this._loopType=ccs.ANIMATION_TYPE_MAX;this._currentFrame=(t-1)*this._nextFrameIndex;t=this._currentFrame/this._durationTween;if(t<1){this._nextFrameIndex=this._durationTween;this.movementEvent(this._armature,ccs.MovementEventType.start,this._movementID);break}break;case ccs.ANIMATION_TYPE_MAX:case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1;this._isComplete=true;this._isPlaying=false;this.movementEvent(this._armature,ccs.MovementEventType.complete,this._movementID);this.updateMovementList();break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:this._loopType=ccs.ANIMATION_TYPE_LOOP_FRONT;t=ccs.fmodf(t,1);this._currentFrame=this._nextFrameIndex===0?0:ccs.fmodf(this._currentFrame,this._nextFrameIndex);this._nextFrameIndex=this._durationTween>0?this._durationTween:1;this.movementEvent(this,ccs.MovementEventType.start,this._movementID);break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex);this._toIndex=0;this.movementEvent(this._armature,ccs.MovementEventType.loopComplete,this._movementID);break}this._currentPercent=t}},getCurrentMovementID:function(){if(this._isComplete)return"";return this._movementID},setMovementEventCallFunc:function(t,e){if(arguments.length===1){this._movementEventListener=t}else if(arguments.length===2){this._movementEventTarget=e;this._movementEventCallFunc=t}},setFrameEventCallFunc:function(t,e){if(arguments.length===1){this._frameEventListener=t}else if(arguments.length===2){this._frameEventTarget=e;this._frameEventCallFunc=t}},setUserObject:function(t){this._userObject=t},frameEvent:function(t,e,i,n){if(this._frameEventTarget&&this._frameEventCallFunc||this._frameEventListener){var r=new ccs.FrameEvent;r.bone=t;r.frameEventName=e;r.originFrameIndex=i;r.currentFrameIndex=n;this._frameEventQueue.push(r)}},movementEvent:function(t,e,i){if(this._movementEventTarget&&this._movementEventCallFunc||this._movementEventListener){var n=new ccs.MovementEvent;n.armature=t;n.movementType=e;n.movementID=i;this._movementEventQueue.push(n)}},updateMovementList:function(){if(this._onMovementList){var t,e=this._movementList;if(this._movementListLoop){t=e[this._movementIndex];this.play(t,t.durationTo,0);this._movementIndex++;if(this._movementIndex>=e.length)this._movementIndex=0}else{if(this._movementIndex<e.length){t=e[this._movementIndex];this.play(t,t.durationTo,0);this._movementIndex++}else this._onMovementList=false}this._onMovementList=true}},setAnimationData:function(t){if(this._animationData!==t)this._animationData=t},getAnimationData:function(){return this._animationData},getUserObject:function(){return this._userObject},isIgnoreFrameEvent:function(){return this._ignoreFrameEvent}});var _p=ccs.ArmatureAnimation.prototype;_p.speedScale;cc.defineGetterSetter(_p,"speedScale",_p.getSpeedScale,_p.setSpeedScale);_p.animationScale;cc.defineGetterSetter(_p,"animationScale",_p.getAnimationScale,_p.setAnimationScale);_p=null;ccs.ArmatureAnimation.create=function(t){return new ccs.ArmatureAnimation(t)};ccs.Tween=ccs.ProcessBase.extend({_tweenData:null,_to:null,_from:null,_between:null,_movementBoneData:null,_bone:null,_frameTweenEasing:0,_betweenDuration:0,_totalDuration:0,_toIndex:0,_fromIndex:0,_animation:null,_passLastFrame:false,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this);this._frameTweenEasing=ccs.TweenType.LINEAR;ccs.Tween.prototype.init.call(this,t)},init:function(t){this._from=new ccs.FrameData;
this._between=new ccs.FrameData;this._bone=t;this._tweenData=this._bone.getTweenData();this._tweenData.displayIndex=-1;this._animation=this._bone!==null&&this._bone.getArmature()!==null?this._bone.getArmature().getAnimation():null;return true},play:function(t,e,i,n,r){ccs.ProcessBase.prototype.play.call(this,e,i,n,r);this._loopType=n?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP;this._totalDuration=0;this._betweenDuration=0;this._fromIndex=this._toIndex=0;var s=t!==this._movementBoneData;this.setMovementBoneData(t);this._rawDuration=this._movementBoneData.duration;var a=this._movementBoneData.getFrameData(0);this._tweenData.displayIndex=a.displayIndex;if(this._bone.getArmature().getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED){ccs.TransformHelp.nodeSub(this._tweenData,this._bone.getBoneData());this._tweenData.scaleX+=1;this._tweenData.scaleY+=1}if(this._rawDuration===0){this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME;if(e===0)this.setBetween(a,a);else this.setBetween(this._tweenData,a);this._frameTweenEasing=ccs.TweenType.LINEAR}else if(this._movementBoneData.frameList.length>1){this._durationTween=i*this._movementBoneData.scale;if(n&&this._movementBoneData.delay!==0)this.setBetween(this._tweenData,this.tweenNodeTo(this.updateFrameData(1-this._movementBoneData.delay),this._between));else{if(!s||e===0)this.setBetween(a,a);else this.setBetween(this._tweenData,a)}}this.tweenNodeTo(0)},gotoAndPlay:function(t){ccs.ProcessBase.prototype.gotoFrame.call(this,t);this._totalDuration=0;this._betweenDuration=0;this._fromIndex=this._toIndex=0;this._isPlaying=true;this._isComplete=this._isPause=false;this._currentPercent=this._curFrameIndex/(this._rawDuration-1);this._currentFrame=this._nextFrameIndex*this._currentPercent},gotoAndPause:function(t){this.gotoAndPlay(t);this.pause()},updateHandler:function(){var t=this._currentPercent==null?1:this._currentPercent;var e=this._loopType;if(t>=1){switch(e){case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1;this._isComplete=true;this._isPlaying=false;break;case ccs.ANIMATION_TYPE_NO_LOOP:e=ccs.ANIMATION_TYPE_MAX;if(this._durationTween<=0)t=1;else t=(t-1)*this._nextFrameIndex/this._durationTween;if(t>=1){t=1;this._isComplete=true;this._isPlaying=false;break}else{this._nextFrameIndex=this._durationTween;this._currentFrame=t*this._nextFrameIndex;this._totalDuration=0;this._betweenDuration=0;this._fromIndex=this._toIndex=0;break}case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:e=ccs.ANIMATION_TYPE_LOOP_FRONT;this._nextFrameIndex=this._durationTween>0?this._durationTween:1;if(this._movementBoneData.delay!==0){this._currentFrame=(1-this._movementBoneData.delay)*this._nextFrameIndex;t=this._currentFrame/this._nextFrameIndex}else{t=0;this._currentFrame=0}this._totalDuration=0;this._betweenDuration=0;this._fromIndex=this._toIndex=0;break;case ccs.ANIMATION_TYPE_MAX:t=1;this._isComplete=true;this._isPlaying=false;break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex);break}}if(t<1&&e<ccs.ANIMATION_TYPE_TO_LOOP_BACK)t=Math.sin(t*cc.PI/2);this._currentPercent=t;this._loopType=e;if(e>ccs.ANIMATION_TYPE_TO_LOOP_BACK)t=this.updateFrameData(t);if(this._frameTweenEasing!==ccs.TweenType.TWEEN_EASING_MAX)this.tweenNodeTo(t)},setBetween:function(t,e,i){if(i===undefined)i=true;do{if(t.displayIndex<0&&e.displayIndex>=0){this._from.copy(e);this._between.subtract(e,e,i);break}if(e.displayIndex<0&&t.displayIndex>=0){this._from.copy(t);this._between.subtract(e,e,i);break}this._from.copy(t);this._between.subtract(t,e,i)}while(0);if(!t.isTween){this._tweenData.copy(t);this._tweenData.isTween=true}this.arriveKeyFrame(t)},arriveKeyFrame:function(t){if(t){var e=this._bone;var i=e.getDisplayManager();var n=t.displayIndex;if(!i.getForceChangeDisplay())i.changeDisplayWithIndex(n,false);this._tweenData.zOrder=t.zOrder;e.updateZOrder();this._bone.setBlendFunc(t.blendFunc);var r=e.getChildArmature();if(r){if(t.movement!=="")r.getAnimation().play(t.movement)}}},tweenNodeTo:function(t,e){if(!e)e=this._tweenData;var i=this._from;var n=this._between;if(!i.isTween)t=0;e.x=i.x+t*n.x;e.y=i.y+t*n.y;e.scaleX=i.scaleX+t*n.scaleX;e.scaleY=i.scaleY+t*n.scaleY;e.skewX=i.skewX+t*n.skewX;e.skewY=i.skewY+t*n.skewY;this._bone.setTransformDirty(true);if(e&&n.isUseColorInfo)this.tweenColorTo(t,e);return e},tweenColorTo:function(t,e){var i=this._from;var n=this._between;e.a=i.a+t*n.a;e.r=i.r+t*n.r;e.g=i.g+t*n.g;e.b=i.b+t*n.b;this._bone.updateColor()},updateFrameData:function(t){if(t>1&&this._movementBoneData.delay!==0)t=ccs.fmodf(t,1);var e=(this._rawDuration-1)*t;var i,n;var r=this._totalDuration,s=this._betweenDuration,a=this._toIndex;if(e<r||e>=r+s){var o=this._movementBoneData.frameList;var c=o.length;if(e<o[0].frameID){i=n=o[0];this.setBetween(i,n);return this._currentPercent}if(e>=o[c-1].frameID){if(this._passLastFrame){i=n=o[c-1];this.setBetween(i,n);return this._currentPercent}this._passLastFrame=true}else this._passLastFrame=false;do{this._fromIndex=a;i=o[this._fromIndex];r=i.frameID;a=this._fromIndex+1;if(a>=c)a=0;n=o[a];if(i.strEvent&&!this._animation.isIgnoreFrameEvent())this._animation.frameEvent(this._bone,i.strEvent,i.frameID,e);if(e===i.frameID||this._passLastFrame&&this._fromIndex===c-1)break}while(e<i.frameID||e>=n.frameID);s=n.frameID-i.frameID;this._frameTweenEasing=i.tweenEasing;this.setBetween(i,n,false);this._totalDuration=r;this._betweenDuration=s;this._toIndex=a}t=s===0?0:(e-this._totalDuration)/this._betweenDuration;var l=this._frameTweenEasing!==ccs.TweenType.LINEAR?this._frameTweenEasing:this._tweenEasing;if(l!==ccs.TweenType.TWEEN_EASING_MAX&&l!==ccs.TweenType.LINEAR&&!this._passLastFrame){t=ccs.TweenFunction.tweenTo(t,l,this._from.easingParams)}return t},setAnimation:function(t){this._animation=t},getAnimation:function(){return this._animation},setMovementBoneData:function(t){this._movementBoneData=t}});var _p=ccs.Tween.prototype;_p.animation;cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation);_p=null;ccs.Tween.create=function(t){return new ccs.Tween(t)};ccs.PT_RATIO=32;ccs.ColliderFilter=ccs.Class.extend({_collisionType:0,_group:0,_categoryBits:0,_groupIndex:0,_maskBits:0,ctor:function(t,e){this._collisionType=t||0;this._group=e||0},updateShape:function(t){if(t instanceof cp.Shape){t.collision_type=this._collisionType;t.group=this._group}else if(t instanceof Box2D.b2FilterData){var e=new Box2D.b2FilterData;e.categoryBits=this._categoryBits;e.groupIndex=this._groupIndex;e.maskBits=this._maskBits;t.SetFilterData(e)}}});ccs.ColliderBody=ccs.Class.extend({shape:null,coutourData:null,colliderFilter:null,_calculatedVertexList:null,ctor:function(t){this.shape=null;this.coutourData=t;this.colliderFilter=new ccs.ColliderFilter;if(ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){this._calculatedVertexList=[]}},getContourData:function(){return this.coutourData},setColliderFilter:function(t){this.colliderFilter=t},getCalculatedVertexList:function(){return this._calculatedVertexList},setB2Fixture:function(t){this._fixture=t},getB2Fixture:function(){return this._fixture},setShape:function(t){this.shape=t},getShape:function(){return this.shape},setContourData:function(t){this.coutourData=t},getColliderFilter:function(){return this.colliderFilter}});ccs.ColliderDetector=ccs.Class.extend({_colliderBodyList:null,_bone:null,_body:null,_active:false,_filter:null,helpPoint:cc.p(0,0),ctor:function(t){this._colliderBodyList=[];this._bone=null;this._body=null;this._active=false;this._filter=null;ccs.ColliderDetector.prototype.init.call(this,t)},init:function(t){this._colliderBodyList.length=0;if(t)this._bone=t;this._filter=new ccs.ColliderFilter;return true},addContourData:function(t){var e=new ccs.ColliderBody(t);this._colliderBodyList.push(e);if(ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var i=e.getCalculatedVertexList();var n=t.vertexList;for(var r=0;r<n.length;r++){var s=new ccs.ContourVertex2(0,0);i.push(s)}}},addContourDataList:function(t){for(var e=0;e<t.length;e++){this.addContourData(t[e])}},removeContourData:function(t){var e=[],i,n=this._colliderBodyList;for(i=0;i<n.length;i++){var r=n[i];if(r&&r.getContourData()===t)e.push(r)}for(i=0;i<e.length;i++)cc.arrayRemoveObject(n,e[i])},removeAll:function(){this._colliderBodyList.length=0},setActive:function(t){if(this._active===t)return;this._active=t;var e=this._body;var i;if(e){var n=null;if(this._active){for(var r=0;r<this._colliderBodyList.length;r++){n=this._colliderBodyList[r];i=n.getShape();e.space.addShape(i)}}else{for(var r=0;r<this._colliderBodyList.length;r++){n=this._colliderBodyList[r];i=n.getShape();e.space.removeShape(i)}}}},getActive:function(){return this._active},getColliderBodyList:function(){return this._colliderBodyList},setColliderFilter:function(t){this._filter=t;var e=this._colliderBodyList;for(var i=0;i<e.length;i++){var n=e[i];n.setColliderFilter(t);if(n.getShape())n.getColliderFilter().updateShape(n.getShape())}},getColliderFilter:function(){return this._filter},updateTransform:function(t){if(!this._active)return;var e=null;var i=this._body;var n=this.helpPoint;for(var r=0;r<this._colliderBodyList.length;r++){e=this._colliderBodyList[r];var s=e.getContourData();var a=null;if(i){a=e.getShape()}var o=s.vertexList;var c=e.getCalculatedVertexList();for(var l=0;l<o.length;l++){n.x=o[l].x;n.y=o[l].y;n=cc.pointApplyAffineTransform(n,t);if(ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var h=cc.p(0,0);h.x=n.x;h.y=n.y;c[l]=h}if(a){a.verts[l*2]=n.x;a.verts[l*2+1]=n.y}}if(a){for(var l=0;l<o.length;l++){var u=a.verts[(l+1)%a.verts.length];var d=cp.v.normalize(cp.v.perp(cp.v.sub(u,a.verts[l])));if(a.planes){a.planes[l].n=d;a.planes[l].d=cp.v.dot(d,a.verts[l])}}}}},setBody:function(t){this._body=t;var e,i=this._colliderBodyList;for(var n=0;n<i.length;n++){e=i[n];var r=e.getContourData(),s=[];var a=r.vertexList;for(var o=0;o<a.length;o++){var c=a[o];s.push(c.x);s.push(c.y)}var l=new cp.PolyShape(this._body,s,cp.vzero);l.sensor=true;l.data=this._bone;if(this._active)this._body.space.addShape(l);e.setShape(l);e.getColliderFilter().updateShape(l)}},getBody:function(){return this._body}});var _p=ccs.ColliderDetector.prototype;_p.colliderFilter;cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);_p.active;cc.defineGetterSetter(_p,"active",_p.getActive,_p.setActive);_p.body;cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);_p=null;ccs.ColliderDetector.create=function(t){return new ccs.ColliderDetector(t)};ccs.Armature=ccs.Node.extend({animation:null,armatureData:null,batchNode:null,_textureAtlas:null,_parentBone:null,_boneDic:null,_topBoneList:null,_armatureIndexDic:null,_offsetPoint:null,version:0,_armatureTransformDirty:true,_body:null,_blendFunc:null,_className:"Armature",ctor:function(t,e){cc.Node.prototype.ctor.call(this);this._name="";this._topBoneList=[];this._armatureIndexDic={};this._offsetPoint=cc.p(0,0);this._armatureTransformDirty=true;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};t&&ccs.Armature.prototype.init.call(this,t,e)},init:function(t,e){cc.Node.prototype.init.call(this);if(e)this._parentBone=e;this.removeAllChildren();this.animation=new ccs.ArmatureAnimation;this.animation.init(this);this._boneDic={};this._topBoneList.length=0;var i=ccs.armatureDataManager;var n;if(t!==""){n=i.getAnimationData(t);cc.assert(n,"AnimationData not exist!");this.animation.setAnimationData(n);var r=i.getArmatureData(t);cc.assert(r,"ArmatureData not exist!");this.armatureData=r;var s=r.getBoneDataDic();for(var a in s){var o=this.createBone(String(a));do{var c=n.getMovement(n.movementNames[0]);if(!c)break;var l=c.getMovementBoneData(o.getName());if(!l||l.frameList.length<=0)break;var h=l.getFrameData(0);if(!h)break;o.getTweenData().copy(h);o.changeDisplayWithIndex(h.displayIndex,false)}while(0)}this.update(0);this.updateOffsetPoint()}else{t="new_armature";this.armatureData=new ccs.ArmatureData;this.armatureData.name=t;n=new ccs.AnimationData;n.name=t;i.addArmatureData(t,this.armatureData);i.addAnimationData(t,n);this.animation.setAnimationData(n)}this._renderCmd.initShaderCache();this.setCascadeOpacityEnabled(true);this.setCascadeColorEnabled(true);return true},addChild:function(t,e,i){if(t instanceof ccui.Widget){cc.log("Armature doesn't support to add Widget as its child, it will be fix soon.");return}cc.Node.prototype.addChild.call(this,t,e,i)},createBone:function(t){var e=this.getBone(t);if(e)return e;var i=this.armatureData.getBoneData(t);var n=i.parentName;var r=null;if(n){this.createBone(n);r=new ccs.Bone(t);this.addBone(r,n)}else{r=new ccs.Bone(t);this.addBone(r,"")}r.setBoneData(i);r.getDisplayManager().changeDisplayWithIndex(-1,false);return r},addBone:function(t,e){cc.assert(t,"Argument must be non-nil");var i=this._boneDic;if(t.getName())cc.assert(!i[t.getName()],"bone already added. It can't be added again");if(e){var n=i[e];if(n)n.addChildBone(t);else this._topBoneList.push(t)}else this._topBoneList.push(t);t.setArmature(this);i[t.getName()]=t;this.addChild(t)},removeBone:function(t,e){cc.assert(t,"bone must be added to the bone dictionary!");t.setArmature(null);t.removeFromParent(e);cc.arrayRemoveObject(this._topBoneList,t);delete this._boneDic[t.getName()];this.removeChild(t,true)},getBone:function(t){return this._boneDic[t]},changeBoneParent:function(t,e){cc.assert(t,"bone must be added to the bone dictionary!");var i=t.getParentBone();if(i){cc.arrayRemoveObject(i.getChildren(),t);t.setParentBone(null)}if(e){var n=this._boneDic[e];if(n){n.addChildBone(t);cc.arrayRemoveObject(this._topBoneList,t)}else this._topBoneList.push(t)}},getBoneDic:function(){return this._boneDic},updateOffsetPoint:function(){var t=this.getBoundingBox();this.setContentSize(t);var e=this._offsetPoint;e.x=-t.x;e.y=-t.y;if(t.width!==0&&t.height!==0)this.setAnchorPoint(e.x/t.width,e.y/t.height)},getOffsetPoints:function(){return{x:this._offsetPoint.x,y:this._offsetPoint.y}},setAnimation:function(t){this.animation=t},getAnimation:function(){return this.animation},getArmatureTransformDirty:function(){return this._armatureTransformDirty},update:function(t){this.animation.update(t);var e=this._topBoneList;for(var i=0;i<e.length;i++)e[i].update(t);this._armatureTransformDirty=false},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.scheduleUpdate()},onExit:function(){cc.Node.prototype.onExit.call(this);this.unscheduleUpdate()},getBoundingBox:function(){var t,e,i,n=0;var r=true;var s=cc.rect(0,0,0,0),a=this._children;var o=a.length;for(var c=0;c<o;c++){var l=a[c];if(l){var h=l.getDisplayManager().getBoundingBox();if(h.x===0&&h.y===0&&h.width===0&&h.height===0)continue;if(r){t=h.x;e=h.y;i=h.x+h.width;n=h.y+h.height;r=false}else{t=h.x<s.x?h.x:s.x;e=h.y<s.y?h.y:s.y;i=h.x+h.width>s.x+s.width?h.x+h.width:s.x+s.width;n=h.y+h.height>s.y+s.height?h.y+h.height:s.y+s.height}s.x=t;s.y=e;s.width=i-t;s.height=n-e}}return cc.rectApplyAffineTransform(s,this.getNodeToParentTransform())},getBoneAtPoint:function(t,e){var i=this._children;for(var n=i.length-1;n>=0;n--){var r=i[n];if(r instanceof ccs.Bone&&r.getDisplayManager().containPoint(t,e))return r}return null},setParentBone:function(t){this._parentBone=t;var e=this._boneDic;for(var i in e){e[i].setArmature(this)}},getParentBone:function(){return this._parentBone},drawContour:function(){cc._drawingUtil.setDrawColor(255,255,255,255);cc._drawingUtil.setLineWidth(1);var t=this._boneDic;for(var e in t){var i=t[e];var n=i.getColliderDetector();if(!n)continue;var r=n.getColliderBodyList();for(var s=0;s<r.length;s++){var a=r[s];var o=a.getCalculatedVertexList();cc._drawingUtil.drawPoly(o,o.length,true)}}},setBody:function(t){if(this._body===t)return;this._body=t;this._body.data=this;var e,i,n=this._children;for(var r=0;r<n.length;r++){e=n[r];if(e instanceof ccs.Bone){var s=e.getDisplayManager().getDecorativeDisplayList();for(var a=0;a<s.length;a++){i=s[a];var o=i.getColliderDetector();if(o)o.setBody(this._body)}}}},getShapeList:function(){if(this._body)return this._body.shapeList;return null},getBody:function(){return this._body},setBlendFunc:function(t,e){if(e===undefined){this._blendFunc.src=t.src;this._blendFunc.dst=t.dst}else{this._blendFunc.src=t;this._blendFunc.dst=e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setColliderFilter:function(t){var e=this._boneDic;for(var i in e)e[i].setColliderFilter(t)},getArmatureData:function(){return this.armatureData},setArmatureData:function(t){this.armatureData=t},getBatchNode:function(){return this.batchNode},setBatchNode:function(t){this.batchNode=t},getVersion:function(){return this.version},setVersion:function(t){this.version=t},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new ccs.Armature.CanvasRenderCmd(this);else return new ccs.Armature.WebGLRenderCmd(this)}});var _p=ccs.Armature.prototype;_p.parentBone;cc.defineGetterSetter(_p,"parentBone",_p.getParentBone,_p.setParentBone);_p.body;cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);_p.colliderFilter;cc.defineGetterSetter(_p,"colliderFilter",null,_p.setColliderFilter);_p=null;ccs.Armature.create=function(t,e){return new ccs.Armature(t,e)};(function(){ccs.Armature.RenderCmd={_updateAnchorPointInPoint:function(){var t=this._node;var e=t._contentSize,i=t._anchorPoint,n=t._offsetPoint;this._anchorPointInPoints.x=e.width*i.x-n.x;this._anchorPointInPoints.y=e.height*i.y-n.y;this._realAnchorPointInPoints.x=e.width*i.x;this._realAnchorPointInPoints.y=e.height*i.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getAnchorPointInPoints:function(){return cc.p(this._realAnchorPointInPoints)}}})();(function(){ccs.Armature.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true;this._realAnchorPointInPoints=new cc.Point(0,0);this._startRenderCmd=new cc.CustomRenderCmd(this,this._startCmdCallback);this._RestoreRenderCmd=new cc.CustomRenderCmd(this,this._RestoreCmdCallback)};var t=ccs.Armature.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,t);t.constructor=ccs.Armature.CanvasRenderCmd;t._startCmdCallback=function(t,e,i){var n=this._node,r=n._parent;this.transform(r?r._renderCmd:null);var s=t||cc._renderContext;s.save();s._switchToArmatureMode(true,this._worldTransform,e,i)};t.transform=function(t,e){ccs.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node._children;for(var n=0,r=i.length;n<r;n++){var s=i[n];if(s&&s.getDisplayRenderNode){var a=s.getDisplayRenderNode();if(a&&a._renderCmd){var o=a._renderCmd;o.transform(null);var c=s._renderCmd._displayedColor,l=s._renderCmd._displayedOpacity;var h=cc.Node._dirtyFlags,u=o._dirtyFlag;var d=u&h.colorDirty,_=u&h.opacityDirty;if(d)o._updateDisplayColor(c);if(_)o._updateDisplayOpacity(l)}}}};t._RestoreCmdCallback=function(t){this._cacheDirty=false;t._switchToArmatureMode(false);t.restore()};t.initShaderCache=function(){};t.setShaderProgram=function(){};t.updateChildPosition=function(t,e){cc.renderer.pushRenderCommand(e._renderCmd)};t.rendering=function(t,e,i){var n=this._node;var r=n._children;var s=cc.BlendFunc.ALPHA_PREMULTIPLIED,a=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED;for(var o=0,c=r.length;o<c;o++){var l=r[o];if(l&&l.getDisplayRenderNode){var h=l.getDisplayRenderNode();if(null===h)continue;switch(l.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(h instanceof ccs.Skin)this.updateChildPosition(t,h,l,s,a);break;case ccs.DISPLAY_TYPE_ARMATURE:h._renderCmd.rendering(t,e,i);break;default:h.visit(this);break}}else if(l instanceof cc.Node){this._visitNormalChild(l)}}};t._visitNormalChild=function(t){if(t==null)return;var e=t._renderCmd;if(!t._visible)return;e._curLevel=this._curLevel+1;var i,n=t._children,r;e._syncStatus(this);e.transform(null);var s=n.length;if(s>0){t.sortAllChildren();for(i=0;i<s;i++){r=n[i];if(r._localZOrder<0)r._renderCmd.visit(e);else break}cc.renderer.pushRenderCommand(e);for(;i<s;i++)n[i]._renderCmd.visit(e)}else{cc.renderer.pushRenderCommand(e)}this._dirtyFlag=0};t.visit=function(t){var e=this._node;if(!e._visible)return;this.updateStatus(t);e.sortAllChildren();cc.renderer.pushRenderCommand(this._startRenderCmd);this.rendering();cc.renderer.pushRenderCommand(this._RestoreRenderCmd);this._cacheDirty=false}})();ccs.Bone=ccs.Node.extend({_boneData:null,_armature:null,_childArmature:null,_displayManager:null,ignoreMovementBoneData:false,_tween:null,_tweenData:null,_parentBone:null,_boneTransformDirty:false,_worldTransform:null,_blendFunc:null,blendDirty:false,_worldInfo:null,_armatureParentBone:null,_dataVersion:0,_className:"Bone",ctor:function(t){cc.Node.prototype.ctor.call(this);this._tweenData=null;this._parentBone=null;this._armature=null;this._childArmature=null;this._boneData=null;this._tween=null;this._displayManager=null;this.ignoreMovementBoneData=false;this._worldTransform=cc.affineTransformMake(1,0,0,1,0,0);this._boneTransformDirty=true;this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this.blendDirty=false;this._worldInfo=null;this._armatureParentBone=null;this._dataVersion=0;ccs.Bone.prototype.init.call(this,t)},init:function(t){if(t)this._name=t;this._tweenData=new ccs.FrameData;this._tween=new ccs.Tween(this);this._displayManager=new ccs.DisplayManager(this);this._worldInfo=new ccs.BaseData;this._boneData=new ccs.BaseData;return true},setBoneData:function(t){cc.assert(t,"_boneData must not be null");if(this._boneData!==t)this._boneData=t;this.setName(this._boneData.name);this._localZOrder=this._boneData.zOrder;this._displayManager.initDisplayList(t)},getBoneData:function(){return this._boneData},setArmature:function(t){this._armature=t;if(t){this._tween.setAnimation(this._armature.getAnimation());this._dataVersion=this._armature.getArmatureData().dataVersion;this._armatureParentBone=this._armature.getParentBone()}else this._armatureParentBone=null},getArmature:function(){return this._armature},update:function(t){if(this._parentBone)this._boneTransformDirty=this._boneTransformDirty||this._parentBone.isTransformDirty();if(this._armatureParentBone&&!this._boneTransformDirty)this._boneTransformDirty=this._armatureParentBone.isTransformDirty();if(this._boneTransformDirty){var e=this._tweenData;if(this._dataVersion>=ccs.CONST_VERSION_COMBINED){ccs.TransformHelp.nodeConcat(e,this._boneData);e.scaleX-=1;e.scaleY-=1}var i=this._worldInfo;i.copy(e);i.x=e.x+this._position.x;i.y=e.y+this._position.y;i.scaleX=e.scaleX*this._scaleX;i.scaleY=e.scaleY*this._scaleY;i.skewX=e.skewX+this._skewX+cc.degreesToRadians(this._rotationX);i.skewY=e.skewY+this._skewY-cc.degreesToRadians(this._rotationY);if(this._parentBone)this._applyParentTransform(this._parentBone);else{if(this._armatureParentBone)this._applyParentTransform(this._armatureParentBone)}ccs.TransformHelp.nodeToMatrix(i,this._worldTransform);if(this._armatureParentBone)this._worldTransform=cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToParentTransform())}ccs.displayFactory.updateDisplay(this,t,this._boneTransformDirty||this._armature.getArmatureTransformDirty());for(var n=0;n<this._children.length;n++){var r=this._children[n];r.update(t)}this._boneTransformDirty=false},_applyParentTransform:function(t){var e=this._worldInfo;var i=t._worldTransform;var n=t._worldInfo;var r=e.x;var s=e.y;e.x=r*i.a+s*i.c+n.x;e.y=r*i.b+s*i.d+n.y;e.scaleX=e.scaleX*n.scaleX;e.scaleY=e.scaleY*n.scaleY;e.skewX=e.skewX+n.skewX;e.skewY=e.skewY+n.skewY},setBlendFunc:function(t,e){var i=this._blendFunc,n,r;if(e===undefined){n=t.src;r=t.dst}else{n=t;r=e}if(i.src!==n||i.dst!==r){i.src=n;i.dst=r;this.blendDirty=true}},updateColor:function(){var t=this._displayManager.getDisplayRenderNode();if(t!==null){var e=this._renderCmd;t.setColor(cc.color(e._displayedColor.r*this._tweenData.r/255,e._displayedColor.g*this._tweenData.g/255,e._displayedColor.b*this._tweenData.b/255));t.setOpacity(e._displayedOpacity*this._tweenData.a/255)}},updateZOrder:function(){if(this._armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED){this.setLocalZOrder(this._tweenData.zOrder+this._boneData.zOrder)}else{this.setLocalZOrder(this._tweenData.zOrder)}},addChildBone:function(t){cc.assert(t,"Argument must be non-nil");cc.assert(!t.parentBone,"child already added. It can't be added again");if(this._children.indexOf(t)<0){this._children.push(t);t.setParentBone(this)}},removeChildBone:function(t,e){if(this._children.length>0&&this._children.getIndex(t)!==-1){if(e){var i=t._children;for(var n=0;n<i.length;n++){var r=i[n];t.removeChildBone(r,e)}}t.setParentBone(null);t.getDisplayManager().setCurrentDecorativeDisplay(null);cc.arrayRemoveObject(this._children,t)}},removeFromParent:function(t){if(this._parentBone)this._parentBone.removeChildBone(this,t)},setParentBone:function(t){this._parentBone=t},getParentBone:function(){return this._parentBone},setChildArmature:function(t){if(this._childArmature!==t){if(t==null&&this._childArmature)this._childArmature.setParentBone(null);this._childArmature=t}},getChildArmature:function(){return this._childArmature},getTween:function(){return this._tween},setLocalZOrder:function(t){if(this._localZOrder!==t)cc.Node.prototype.setLocalZOrder.call(this,t)},getNodeToArmatureTransform:function(){return this._worldTransform},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToWorldTransform())},getDisplayRenderNode:function(){return this._displayManager.getDisplayRenderNode()},getDisplayRenderNodeType:function(){return this._displayManager.getDisplayRenderNodeType()},addDisplay:function(t,e){e=e||0;return this._displayManager.addDisplay(t,e)},removeDisplay:function(t){this._displayManager.removeDisplay(t)},changeDisplayByIndex:function(t,e){cc.log("changeDisplayByIndex is deprecated. Use changeDisplayWithIndex instead.");this.changeDisplayWithIndex(t,e)},changeDisplayByName:function(t,e){cc.log("changeDisplayByName is deprecated. Use changeDisplayWithName instead.");this.changeDisplayWithName(t,e)},changeDisplayWithIndex:function(t,e){this._displayManager.changeDisplayWithIndex(t,e)},changeDisplayWithName:function(t,e){this._displayManager.changeDisplayWithName(t,e)},getColliderDetector:function(){var t=this._displayManager.getCurrentDecorativeDisplay();if(t){var e=t.getColliderDetector();if(e)return e}return null},setColliderFilter:function(t){var e=this._displayManager.getDecorativeDisplayList();for(var i=0;i<e.length;i++){var n=e[i];var r=n.getColliderDetector();if(r)r.setColliderFilter(t)}},getColliderFilter:function(){var t=this.displayManager.getCurrentDecorativeDisplay();if(t){var e=t.getColliderDetector();if(e)return e.getColliderFilter()}return null},setTransformDirty:function(t){this._boneTransformDirty=t},isTransformDirty:function(){return this._boneTransformDirty},getDisplayManager:function(){return this._displayManager},setIgnoreMovementBoneData:function(t){this._ignoreMovementBoneData=t},isIgnoreMovementBoneData:function(){return this._ignoreMovementBoneData},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setBlendDirty:function(t){this._blendDirty=t},isBlendDirty:function(){return this._blendDirty},getTweenData:function(){return this._tweenData},getWorldInfo:function(){return this._worldInfo},getChildrenBone:function(){return this._children},nodeToArmatureTransform:function(){return this.getNodeToArmatureTransform()},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getColliderBodyList:function(){var t=this.getColliderDetector();if(t)return t.getColliderBodyList();return null},getIgnoreMovementBoneData:function(){return this.isIgnoreMovementBoneData()},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new ccs.Bone.CanvasRenderCmd(this);else return new ccs.Bone.WebGLRenderCmd(this)}});var _p=ccs.Bone.prototype;_p.boneData;cc.defineGetterSetter(_p,"boneData",_p.getBoneData,_p.setBoneData);_p.armature;cc.defineGetterSetter(_p,"armature",_p.getArmature,_p.setArmature);_p.childArmature;cc.defineGetterSetter(_p,"childArmature",_p.getChildArmature,_p.setChildArmature);_p.childrenBone;cc.defineGetterSetter(_p,"childrenBone",_p.getChildrenBone);_p.tween;cc.defineGetterSetter(_p,"tween",_p.getTween);_p.tweenData;cc.defineGetterSetter(_p,"tweenData",_p.getTweenData);_p.colliderFilter;cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);_p=null;ccs.Bone.create=function(t){return new ccs.Bone(t)};ccs.Bone.RenderCmd={_updateColor:function(){var t=this._node;var e=t._displayManager.getDisplayRenderNode();if(e!==null){var i=e._renderCmd;e.setColor(cc.color(t._tweenData.r,t._tweenData.g,t._tweenData.g));e.setOpacity(t._tweenData.a);i._syncDisplayColor(this._displayedColor);i._syncDisplayOpacity(this._displayedOpacity);i._updateColor()}}};(function(){ccs.Bone.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=false};var t=ccs.Bone.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,t);t.constructor=ccs.Bone.CanvasRenderCmd})();(function(){if(!cc.Node.WebGLRenderCmd)return;ccs.Bone.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=false};var t=ccs.Bone.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,t);t.constructor=ccs.Bone.WebGLRenderCmd})();ccs.FRAME_TYPE_MOVE=0;ccs.FRAME_TYPE_SCALE=1;ccs.FRAME_TYPE_ROTATE=2;ccs.FRAME_TYPE_TINT=3;ccs.FRAME_TYPE_FADE=4;ccs.FRAME_TYPE_MAX=5;ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e3};ccs.ActionFrame=ccs.Class.extend({frameType:0,easingType:0,frameIndex:0,_Parameter:null,time:0,ctor:function(){this.frameType=0;this.easingType=ccs.FrameEaseType.LINEAR;this.frameIndex=0;this.time=0},getAction:function(t,e){cc.log("Need a definition of <getAction> for ActionFrame");return null},_getEasingAction:function(t){if(t===null){console.error("Action cannot be null!");return null}var e;switch(this.easingType){case ccs.FrameEaseType.CUSTOM:break;case ccs.FrameEaseType.LINEAR:e=t;break;case ccs.FrameEaseType.SINE_EASEIN:e=t.easing(cc.easeSineIn());break;case ccs.FrameEaseType.SINE_EASEOUT:e=t.easing(cc.easeSineOut());break;case ccs.FrameEaseType.SINE_EASEINOUT:e=t.easing(cc.easeSineInOut());break;case ccs.FrameEaseType.QUAD_EASEIN:e=t.easing(cc.easeQuadraticActionIn());break;case ccs.FrameEaseType.QUAD_EASEOUT:e=t.easing(cc.easeQuadraticActionOut());break;case ccs.FrameEaseType.QUAD_EASEINOUT:e=t.easing(cc.easeQuadraticActionInOut());break;case ccs.FrameEaseType.CUBIC_EASEIN:e=t.easing(cc.easeCubicActionIn());break;case ccs.FrameEaseType.CUBIC_EASEOUT:e=t.easing(cc.easeCubicActionOut());break;case ccs.FrameEaseType.CUBIC_EASEINOUT:e=t.easing(cc.easeCubicActionInOut());break;case ccs.FrameEaseType.QUART_EASEIN:e=t.easing(cc.easeQuarticActionIn());break;case ccs.FrameEaseType.QUART_EASEOUT:e=t.easing(cc.easeQuarticActionOut());break;case ccs.FrameEaseType.QUART_EASEINOUT:e=t.easing(cc.easeQuarticActionInOut());break;case ccs.FrameEaseType.QUINT_EASEIN:e=t.easing(cc.easeQuinticActionIn());break;case ccs.FrameEaseType.QUINT_EASEOUT:e=t.easing(cc.easeQuinticActionOut());break;case ccs.FrameEaseType.QUINT_EASEINOUT:e=t.easing(cc.easeQuinticActionInOut());break;case ccs.FrameEaseType.EXPO_EASEIN:e=t.easing(cc.easeExponentialIn());break;case ccs.FrameEaseType.EXPO_EASEOUT:e=t.easing(cc.easeExponentialOut());break;case ccs.FrameEaseType.EXPO_EASEINOUT:e=t.easing(cc.easeExponentialInOut());break;case ccs.FrameEaseType.CIRC_EASEIN:e=t.easing(cc.easeCircleActionIn());break;
case ccs.FrameEaseType.CIRC_EASEOUT:e=t.easing(cc.easeCircleActionOut());break;case ccs.FrameEaseType.CIRC_EASEINOUT:e=t.easing(cc.easeCircleActionInOut());break;case ccs.FrameEaseType.ELASTIC_EASEIN:e=t.easing(cc.easeElasticIn());break;case ccs.FrameEaseType.ELASTIC_EASEOUT:e=t.easing(cc.easeElasticOut());break;case ccs.FrameEaseType.ELASTIC_EASEINOUT:e=t.easing(cc.easeElasticInOut());break;case ccs.FrameEaseType.BACK_EASEIN:e=t.easing(cc.easeBackIn());break;case ccs.FrameEaseType.BACK_EASEOUT:e=t.easing(cc.easeBackOut());break;case ccs.FrameEaseType.BACK_EASEINOUT:e=t.easing(cc.easeBackInOut());break;case ccs.FrameEaseType.BOUNCE_EASEIN:e=t.easing(cc.easeBounceIn());break;case ccs.FrameEaseType.BOUNCE_EASEOUT:e=t.easing(cc.easeBounceOut());break;case ccs.FrameEaseType.BOUNCE_EASEINOUT:e=t.easing(cc.easeBounceInOut());break}return e},setEasingParameter:function(t){this._Parameter=[];for(var e=0;e<t.length;e++)this._Parameter.push(t[e])},setEasingType:function(t){this.easingType=t}});ccs.ActionMoveFrame=ccs.ActionFrame.extend({_position:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._position=cc.p(0,0);this.frameType=ccs.FRAME_TYPE_MOVE},setPosition:function(t,e){if(e===undefined){this._position.x=t.x;this._position.y=t.y}else{this._position.x=t;this._position.y=e}},getPosition:function(){return this._position},getAction:function(t){return this._getEasingAction(cc.moveTo(t,this._position))}});ccs.ActionScaleFrame=ccs.ActionFrame.extend({_scaleX:1,_scaleY:1,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._scaleX=1;this._scaleY=1;this.frameType=ccs.FRAME_TYPE_SCALE},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY},getAction:function(t){return this._getEasingAction(cc.scaleTo(t,this._scaleX,this._scaleY))}});ccs.ActionRotationFrame=ccs.ActionFrame.extend({_rotation:0,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._rotation=0;this.frameType=ccs.FRAME_TYPE_ROTATE},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation},getAction:function(t,e){if(e===undefined)return this._getEasingAction(cc.rotateTo(t,this._rotation));else{if(!(e instanceof cc.ActionRotationFrame))return this.getAction(t);else{var i=this._rotation-e._rotation;return this._getEasingAction(cc.rotateBy(t,i))}}}});ccs.ActionFadeFrame=ccs.ActionFrame.extend({_opacity:255,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._opacity=255;this.frameType=ccs.FRAME_TYPE_FADE},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},getAction:function(t){return this._getEasingAction(cc.fadeTo(t,this._opacity))}});ccs.ActionTintFrame=ccs.ActionFrame.extend({_color:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._color=cc.color(255,255,255,255);this.frameType=ccs.FRAME_TYPE_TINT},setColor:function(t){var e=this._color;e.r=t.r;e.g=t.g;e.b=t.b},getColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getAction:function(t){return this._getEasingAction(cc.tintTo(t,this._color.r,this._color.g,this._color.b))}});ccs.actionManager={_actionDic:{},initWithDictionary:function(t,e,i){var n=t;var r=n.lastIndexOf("/");var s=n.substr(r+1,n.length);var a=e["actionlist"];var o=[];for(var c=0;c<a.length;c++){var l=new ccs.ActionObject;var h=a[c];l.initWithDictionary(h,i);o.push(l)}this._actionDic[s]=o},getActionByName:function(t,e){var i=t;var n=i.lastIndexOf("/");var r=i.substr(n+1,i.length);var s=this._actionDic[r];if(!s)return null;for(var a=0;a<s.length;a++){var o=s[a];if(e===o.getName())return o}return null},playActionByName:function(t,e,i){var n=this.getActionByName(t,e);if(n)n.play(i)},stopActionByName:function(t,e){var i=this.getActionByName(t,e);if(i)i.stop()},releaseActions:function(){this._actionDic={}},clear:function(){this._actionDic={}}};ccs.ActionNode=ccs.Class.extend({_currentFrameIndex:0,_destFrameIndex:0,_unitTime:0,_actionTag:0,_object:null,_actionSpawn:null,_action:null,_frameArray:null,_frameArrayNum:0,ctor:function(){this._currentFrameIndex=0;this._destFrameIndex=0;this._unitTime=.1;this._actionTag=0;this._object=null;this._actionSpawn=null;this._action=null;this._frameArray=[];this._frameArrayNum=ccs.FRAME_TYPE_MAX;for(var t=0;t<this._frameArrayNum;t++)this._frameArray.push([])},initWithDictionary:function(t,e){this.setActionTag(t["ActionTag"]);var i=t["actionframelist"];var n=ccui.helper.seekActionWidgetByActionTag(e,t["ActionTag"]);var r=n instanceof ccui.Widget&&!(n instanceof ccui.Layout);for(var s=0;s<i.length;s++){var a=i[s];var o=a["frameid"];var c=a["tweenType"];if(c==null)c=0;var l=a["tweenParameter"];var h=[];for(var u=0;u<l;u++){var d=a["tweenParameter"][u];h.push(d)}var _,f;if(a["positionx"]!==undefined){var p=a["positionx"];var m=a["positiony"];if(r&&n.parent){var g=n.parent.getAnchorPointInPoints();p+=g.x;m+=g.y}_=new ccs.ActionMoveFrame;_.frameIndex=o;_.setEasingType(c);_.setEasingParameter(h);_.setPosition(p,m);f=this._frameArray[ccs.FRAME_TYPE_MOVE];f.push(_)}if(a["scalex"]!==undefined){var v=a["scalex"];var y=a["scaley"];_=new ccs.ActionScaleFrame;_.frameIndex=o;_.setEasingType(c);_.setEasingParameter(h);_.setScaleX(v);_.setScaleY(y);f=this._frameArray[ccs.FRAME_TYPE_SCALE];f.push(_)}if(a["rotation"]!==undefined){var T=a["rotation"];_=new ccs.ActionRotationFrame;_.frameIndex=o;_.setEasingType(c);_.setEasingParameter(h);_.setRotation(T);f=this._frameArray[ccs.FRAME_TYPE_ROTATE];f.push(_)}if(a["opacity"]!==undefined){var C=a["opacity"];_=new ccs.ActionFadeFrame;_.frameIndex=o;_.setEasingType(c);_.setEasingParameter(h);_.setOpacity(C);f=this._frameArray[ccs.FRAME_TYPE_FADE];f.push(_)}if(a["colorr"]!==undefined){var S=a["colorr"];var x=a["colorg"];var E=a["colorb"];_=new ccs.ActionTintFrame;_.frameIndex=o;_.setEasingType(c);_.setEasingParameter(h);_.setColor(cc.color(S,x,E));f=this._frameArray[ccs.FRAME_TYPE_TINT];f.push(_)}a=null}this._initActionNodeFromRoot(e)},_initActionNodeFromRoot:function(t){if(t instanceof ccui.Widget){var e=ccui.helper.seekActionWidgetByActionTag(t,this.getActionTag());if(e)this.setObject(e)}},setUnitTime:function(t){this._unitTime=t;this._refreshActionProperty()},getUnitTime:function(){return this._unitTime},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setObject:function(t){this._object=t},getObject:function(){return this._object},getActionNode:function(){if(this._object instanceof cc.Node)return this._object;return null},insertFrame:function(t,e){if(e==null)return;var i=e.frameType;var n=this._frameArray[i];n.splice(t,0,e)},addFrame:function(t){if(!t)return;var e=t.frameType;var i=this._frameArray[e];i.push(t)},deleteFrame:function(t){if(t==null)return;var e=t.frameType;var i=this._frameArray[e];cc.arrayRemoveObject(i,t)},clearAllFrame:function(){for(var t=0;t<this._frameArrayNum;t++)this._frameArray[t].length=0},_refreshActionProperty:function(){if(this._object===null)return null;var t=[];for(var e=0;e<this._frameArrayNum;e++){var i=this._frameArray[e];if(i.length<=0)continue;var n=[];for(var r=0;r<i.length;r++){var s=i[r];var a=null;if(r!==0){var o=i[r-1];var c=(s.frameIndex-o.frameIndex)*this.getUnitTime();a=s.getAction(c)}else{a=s.getAction(0)}if(a)n.push(a)}if(n){var l=cc.sequence(n);if(l!==null)t.push(l)}}this._action=null;this._actionSpawn=cc.spawn(t);return this._actionSpawn},playAction:function(t){if(this._object===null||this._actionSpawn===null)return;if(t)this._action=cc.sequence(this._actionSpawn,t);else this._action=cc.sequence(this._actionSpawn);this._runAction()},_runAction:function(){var t=this.getActionNode();if(t!==null&&this._action!==null)t.runAction(this._action)},stopAction:function(){var t=this.getActionNode();if(t!==null&&this._action!==null){if(!this._action.isDone())t.stopAction(this._action)}},getFirstFrameIndex:function(){var t=99999;var e=false,i=this._frameArray;for(var n=0,r=this._frameArrayNum;n<r;n++){var s=i[n];if(s.length<=0)continue;e=true;var a=s[0].frameIndex;t=t>a?a:t}if(!e)t=0;return t},getLastFrameIndex:function(){var t=-1;var e=false,i=this._frameArray;for(var n=0,r=this._frameArrayNum;n<r;n++){var s=i[n];if(s.length<=0)continue;e=true;var a=s[s.length-1];var o=a.frameIndex;t=t<o?o:t}if(!e)t=0;return t},updateActionToTimeLine:function(t){var e=false;var i=this.getUnitTime();for(var n=0;n<this._frameArrayNum;n++){var r=this._frameArray[n];if(r===null)continue;for(var s=0;s<r.length;s++){var a=r[s];if(a.frameIndex*i===t){this._easingToFrame(1,1,a);e=true;break}else if(a.frameIndex*i>t){if(s===0){this._easingToFrame(1,1,a);e=false}else{var o=r[s-1];var c=(a.frameIndex-o.frameIndex)*i;var l=t-o.frameIndex*i;this._easingToFrame(c,1,o);this._easingToFrame(c,l/c,a);e=true}break}}}return e},_easingToFrame:function(t,e,i){var n=i.getAction(t);var r=this.getActionNode();if(n==null||r==null)return;n.startWithTarget(r);n.update(e)},isActionDoneOnce:function(){if(this._action===null)return true;return this._action.isDone()}});ccs.ActionObject=ccs.Class.extend({_actionNodeList:null,_name:"",_loop:false,_pause:false,_playing:false,_unitTime:0,_currentTime:0,_scheduler:null,_callback:null,_fTotalTime:0,ctor:function(){this._actionNodeList=[];this._name="";this._loop=false;this._pause=false;this._playing=false;this._unitTime=.1;this._currentTime=0;this._fTotalTime=0;this._scheduler=cc.director.getScheduler()},setName:function(t){this._name=t},getName:function(){return this._name},setLoop:function(t){this._loop=t},getLoop:function(){return this._loop},setUnitTime:function(t){this._unitTime=t;var e=this._actionNodeList.length;for(var i=0;i<e;i++){var n=this._actionNodeList[i];n.setUnitTime(this._unitTime)}},getUnitTime:function(){return this._unitTime},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(t){this._currentTime=t},getTotalTime:function(){return this._fTotalTime},isPlaying:function(){return this._playing},initWithDictionary:function(t,e){this.setName(t["name"]);this.setLoop(t["loop"]);this.setUnitTime(t["unittime"]);var i=t["actionnodelist"];var n=0;for(var r=0;r<i.length;r++){var s=new ccs.ActionNode;var a=i[r];s.initWithDictionary(a,e);s.setUnitTime(this.getUnitTime());this._actionNodeList.push(s);var o=s.getLastFrameIndex()-s.getFirstFrameIndex();if(o>n){n=o}}this._fTotalTime=n*this._unitTime},addActionNode:function(t){if(!t)return;this._actionNodeList.push(t);t.setUnitTime(this._unitTime)},removeActionNode:function(t){if(t==null)return;cc.arrayRemoveObject(this._actionNodeList,t)},play:function(t){this.stop();this.updateToFrameByTime(0);var e=this._actionNodeList;var i=e.length;for(var n=0;n<i;n++){e[n].playAction(t)}if(this._loop)this._scheduler.schedule(this.simulationActionUpdate,this,0,cc.REPEAT_FOREVER,0,false,this.__instanceId+"");if(t!==undefined)this._callback=t},pause:function(){this._pause=true;this._playing=false},stop:function(){var t=this._actionNodeList;for(var e=0;e<t.length;e++)t[e].stopAction();this._scheduler.unschedule(this.simulationActionUpdate,this);this._pause=false;this._playing=false},updateToFrameByTime:function(t){this._currentTime=t;for(var e=0;e<this._actionNodeList.length;e++){var i=this._actionNodeList[e];i.updateActionToTimeLine(t)}},simulationActionUpdate:function(t){var e=true,i=this._actionNodeList;for(var n=0,r=i.length;n<r;n++){if(!i[n].isActionDoneOnce()){e=false;break}}if(e){if(this._callback!==null)this._callback.execute();if(this._loop)this.play();else{this._playing=false;this._scheduler.unschedule(this.simulationActionUpdate,this)}}}});ccs.ComAttribute=ccs.Component.extend({_jsonDict:null,_filePath:"",ctor:function(){cc.Component.prototype.ctor.call(this);this._jsonDict={};this._filePath="";this._name="CCComAttribute";ccs.ComAttribute.prototype.init.call(this)},init:function(){this._jsonDict={};return true},setInt:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setDouble:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setFloat:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setBool:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setString:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setObject:function(t,e){if(!t){cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},getInt:function(t){var e=this._jsonDict[t];return parseInt(e||0)},getDouble:function(t){var e=this._jsonDict[t];return parseFloat(e||0)},getFloat:function(t){var e=this._jsonDict[t];return parseFloat(e||0)},getBool:function(t){var e=this._jsonDict[t];return Boolean(e||false)},getString:function(t){var e=this._jsonDict[t];return e||""},getObject:function(t){return this._jsonDict[t]},parse:function(t){this._jsonDict=cc.loader.getRes(t)}});ccs.ComAttribute.create=function(){return new ccs.ComAttribute};ccs.ComAudio=ccs.Component.extend({_filePath:"",_loop:false,ctor:function(){cc.Component.prototype.ctor.call(this);this._name="Audio";ccs.ComAudio.prototype.init.call(this)},init:function(){return true},onExit:function(){this.stopBackgroundMusic(true);this.stopAllEffects()},end:function(){cc.audioEngine.end()},preloadBackgroundMusic:function(t){cc.loader.load(t)},playBackgroundMusic:function(t,e){if(t){cc.audioEngine.playMusic(t,e)}else{cc.audioEngine.playMusic(this._filePath,this._loop)}},stopBackgroundMusic:function(t){cc.audioEngine.stopMusic(t)},pauseBackgroundMusic:function(){cc.audioEngine.pauseMusic()},resumeBackgroundMusic:function(){cc.audioEngine.resumeMusic()},rewindBackgroundMusic:function(){cc.audioEngine.rewindMusic()},willPlayBackgroundMusic:function(){return cc.audioEngine.willPlayMusic()},isBackgroundMusicPlaying:function(){return cc.audioEngine.isMusicPlaying()},getBackgroundMusicVolume:function(){return cc.audioEngine.getMusicVolume()},setBackgroundMusicVolume:function(t){cc.audioEngine.setMusicVolume(t)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()},setEffectsVolume:function(t){cc.audioEngine.setEffectsVolume(t)},playEffect:function(t,e){if(t)return cc.audioEngine.playEffect(t,e);else return cc.audioEngine.playEffect(this._filePath,this._loop)},pauseEffect:function(t){cc.audioEngine.pauseEffect(t)},pauseAllEffects:function(){cc.audioEngine.pauseAllEffects()},resumeEffect:function(t){cc.audioEngine.resumeEffect(t)},resumeAllEffects:function(){cc.audioEngine.resumeAllEffects()},stopEffect:function(t){cc.audioEngine.stopEffect(t)},stopAllEffects:function(){cc.audioEngine.stopAllEffects()},preloadEffect:function(t){cc.loader.getRes(t);this.setFile(t);this.setLoop(false)},unloadEffect:function(t){cc.audioEngine.unloadEffect(t)},setFile:function(t){this._filePath=t},setLoop:function(t){this._loop=t},getFile:function(){return this._filePath},isLoop:function(){return this._loop}});ccs.ComAudio.create=function(){return new ccs.ComAudio};ccs.ComController=ccs.Component.extend({ctor:function(){cc.Component.prototype.ctor.call(this);this._name="ComController";ccs.ComController.prototype.init.call(this)},onEnter:function(){if(this._owner!==null)this._owner.scheduleUpdate()},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t}});ccs.ComController.create=function(){return new ccs.ComController};ccs.ComRender=ccs.Component.extend({_render:null,ctor:function(t,e){cc.Component.prototype.ctor.call(this);this._render=t;this._name=e;this.isRenderer=true;ccs.ComRender.prototype.init.call(this)},onEnter:function(){if(this._owner)this._owner.addChild(this._render)},onExit:function(){if(this._owner){this._owner.removeChild(this._render,true);this._render=null}},getNode:function(){return this._render},setNode:function(t){this._render=t}});ccs.ComRender.create=function(t,e){return new ccs.ComRender(t,e)};ccs.objectFactory={_typeMap:{},createObject:function(t){var e=null;var i=this._typeMap[t];if(i){if(cc.isFunction(i._fun))e=new i._fun;else e=i._fun}return e},registerType:function(t){this._typeMap[t._className]=t},createGUI:function(t){var e=null;if(t==="Panel")t="Layout";else if(t==="TextArea")t="Label";else if(t==="TextButton")t="Button";var i=this._typeMap[t];if(i&&i._fun)e=i._fun;return e},removeAll:function(){this._typeMap={}}};ccs.TInfo=ccs.Class.extend({_className:"",_fun:null,ctor:function(t,e){if(e){this._className=t;this._fun=e}else{this._className=t._className;this._fun=t._fun}ccs.objectFactory.registerType(this)}});ccs.sendEvent=function(t){var e=ccs.triggerManager.get(t);if(e==null)return;for(var i=0;i<e.length;i++){var n=e[i];if(n!=null&&n.detect())n.done()}};ccs.registerTriggerClass=function(t,e){new ccs.TInfo(t,e)};ccs.triggerManager={_eventTriggers:{},_triggerObjs:{},_movementDispatches:[],parse:function(t){for(var e=0;e<t.length;++e){var i=t[e];var n=new ccs.TriggerObj;n.serialize(i);var r=n.getEvents();for(var s=0;s<r.length;s++){var a=r[s];this.add(a,n)}this._triggerObjs[n.getId()]=n}},get:function(t){return this._eventTriggers[t]},getTriggerObj:function(t){return this._triggerObjs[t]},add:function(t,e){var i=this._eventTriggers[t];if(!i)i=[];if(i.indexOf(e)===-1){i.push(e);this._eventTriggers[t]=i}},removeAll:function(){for(var t in this._eventTriggers){var e=this._eventTriggers[t];for(var i=0;i<e.length;i++){var n=e[i];n.removeAll()}}this._eventTriggers={}},remove:function(t,e){if(e)return this._removeObj(t,e);var i=false;do{var n=this._eventTriggers[t];if(!n)break;for(var r=0;r<n.length;r++){var s=n[r];if(s)s.removeAll()}delete this._eventTriggers[t];i=true}while(0);return i},_removeObj:function(t,e){var i=false;do{var n=this._eventTriggers[t];if(!n)break;for(var r=0;r<n.length;r++){var s=n[r];if(s&&s==e){s.removeAll();n.splice(r,1);break}}i=true}while(0);return i},removeTriggerObj:function(t){var e=this.getTriggerObj(t);if(!e)return false;var i=e.getEvents();for(var n=0;n<i.length;n++){var r=i[n];this.remove(r,e)}return true},isEmpty:function(){return!this._eventTriggers||this._eventTriggers.length<=0},addArmatureMovementCallBack:function(t,e,i){if(t==null||i==null||e==null)return;var n,r=false;for(var s=0;s<this._movementDispatches.length;s++){n=this._movementDispatches[s];if(n&&n[0]===t){n.addAnimationEventCallBack(e,i);r=true}}if(!r){var a=new ccs.ArmatureMovementDispatcher;t.getAnimation().setMovementEventCallFunc(a.animationEvent,a);a.addAnimationEventCallBack(e,i);this._movementDispatches.push([t,a])}},removeArmatureMovementCallBack:function(t,e,i){if(t==null||e==null||i==null)return;var n;for(var r=0;r<this._movementDispatches.length;r++){n=this._movementDispatches[r];if(n&&n[0]===t)n.removeAnimationEventCallBack(i,e)}},removeArmatureAllMovementCallBack:function(t){if(t==null)return;var e;for(var i=0;i<this._movementDispatches.length;i++){e=this._movementDispatches[i];if(e&&e[0]===t){this._movementDispatches.splice(i,1);break}}},removeAllArmatureMovementCallBack:function(){this._movementDispatches.length=0},version:function(){return"1.2.0.0"}};ccs.ArmatureMovementDispatcher=ccs.Class.extend({_mapEventAnimation:null,ctor:function(){this._mapEventAnimation=[]},animationEvent:function(t,e,i){var n,r,s;for(var a=0;a<this._mapEventAnimation.length;a++){n=this._mapEventAnimation[a];r=n[0];s=n[1];if(s)s.call(r,t,e,i)}},addAnimationEventCallBack:function(t,e){this._mapEventAnimation.push([e,t])},removeAnimationEventCallBack:function(t,e){var i;for(var n=0;n<this._mapEventAnimation.length;n++){i=this._mapEventAnimation[n];if(i[0]===e){this._mapEventAnimation.splice(n,1)}}}});ccs.BaseTriggerCondition=ccs.Class.extend({ctor:function(){},init:function(){return true},detect:function(){return true},serialize:function(t){},removeAll:function(){}});ccs.BaseTriggerAction=ccs.Class.extend({ctor:function(){},init:function(){return true},done:function(){},serialize:function(t){},removeAll:function(){}});ccs.TriggerObj=ccs.Class.extend({_cons:null,_acts:null,_id:0,_enable:true,_vInt:null,ctor:function(){this._id=0;this._enable=true;ccs.TriggerObj.prototype.init.call(this)},init:function(){this._cons=[];this._acts=[];this._vInt=[];return true},detect:function(){if(!this._enable||this._cons.length===0){return true}var t=true;var e=null;for(var i=0;i<this._cons.length;i++){e=this._cons[i];if(e&&e.detect)t=t&&e.detect()}return t},done:function(){if(!this._enable||this._acts.length===0)return;var t;for(var e=0;e<this._acts.length;e++){t=this._acts[e];if(t&&t.done)t.done()}},removeAll:function(){var t=null;for(var e=0;e<this._cons.length;e++){t=this._cons[e];if(t)t.removeAll()}this._cons=[];for(var e=0;e<this._acts.length;e++){t=this._acts[e];if(t)t.removeAll()}this._acts=[]},serialize:function(t){this._id=t["id"]||0;var e=t["conditions"]||[];for(var i=0;i<e.length;i++){var n=e[i];var r=n["classname"];var s=ccs.objectFactory.createObject(r);if(!s){cc.log("class named classname("+r+") can not implement!");continue}s.serialize(n);s.init();this._cons.push(s)}var a=t["actions"]||[];for(var i=0;i<a.length;i++){var n=a[i];var r=n["classname"];var o=ccs.objectFactory.createObject(r);if(!o){cc.log("class named classname("+r+") can not implement!");continue}o.serialize(n);o.init();this._acts.push(o)}var c=t["events"]||[];for(var i=0;i<c.length;i++){var n=c[i];var l=n["id"];if(l<0){continue}this._vInt.push(l)}},getId:function(){return this._id},setEnable:function(t){this._enable=t},getEvents:function(){return this._vInt}});ccs.TriggerObj.create=function(){return new ccs.TriggerObj};ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(t){this._init(t)},_init:function(t){this._actionTag=t;return true},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag}});ccs.AnimationInfo=function(t,e,i){this.name=t;this.startIndex=e;this.endIndex=i};ccs.ComExtensionData=ccs.Component.extend({_customProperty:null,_timelineData:null,_name:"ComExtensionData",ctor:function(){this._customProperty="";this._timelineData=new ccs.ActionTimelineData(0);return true},setActionTag:function(t){this._timelineData.setActionTag(t)},getActionTag:function(){return this._timelineData.getActionTag()},setCustomProperty:function(t){this._customProperty=t},getCustomProperty:function(){return this._customProperty}});ccs.ComExtensionData.create=function(){return new ccs.ComExtensionData};ccs.ActionTimelineData.create=function(t){return new ccs.ActionTimelineData(t)};ccs.ActionTimeline=cc.Action.extend({_timelineMap:null,_timelineList:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:false,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){cc.Action.prototype.ctor.call(this);this._timelineMap={};this._timelineList=[];this._animationInfos={};this.init()},_gotoFrame:function(t){var e=this._timelineList.length;for(var i=0;i<e;i++){this._timelineList[i]._gotoFrame(t)}},_stepToFrame:function(t){var e=this._timelineList.length;for(var i=0;i<e;i++){this._timelineList[i]._stepToFrame(t)}},_emitFrameEvent:function(t){if(this._frameEventListener){this._frameEventListener(t)}},init:function(){return true},gotoFrameAndPlay:function(t,e,i,n){var r=0,s=arguments.length;var a=[],o;for(r;r<s;r++){if(typeof arguments[r]==="boolean"){o=arguments[r]}else{a.push(arguments[r])}}t=a[0];e=a[1]!==undefined?a[1]:this._duration;i=a[2]||t;n=o!=null?o:true;this._startFrame=t;this._endFrame=e;this._currentFrame=i;this._loop=n;this._time=this._currentFrame*this._frameInternal;this.resume();this._gotoFrame(this._currentFrame)},gotoFrameAndPause:function(t){this._startFrame=this._currentFrame=t;this._time=this._currentFrame*this._frameInternal;this.pause();this._gotoFrame(this._currentFrame)},pause:function(){this._playing=false},resume:function(){this._playing=true},isPlaying:function(){return this._playing},setTimeSpeed:function(t){this._timeSpeed=t},getTimeSpeed:function(){return this._timeSpeed},setDuration:function(t){this._duration=t},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(t){if(t>=this._startFrame&&t<=this._endFrame){this._currentFrame=t;this._time=this._currentFrame*this._frameInternal}else{cc.log("frame index is not between start frame and end frame")}},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(t){var e=t.getActionTag();if(!this._timelineMap[e]){this._timelineMap[e]=[]}if(this._timelineMap[e].indexOf(t)===-1){this._timelineList.push(t);this._timelineMap[e].push(t);t.setActionTimeline(this)}},removeTimeline:function(t){var e=t.getActionTag();if(this._timelineMap[e]){if(this._timelineMap[e].some(function(e){if(e===t)return true})){cc.arrayRemoveObject(this._timelineMap[e],t);cc.arrayRemoveObject(this._timelineList,t);t.setActionTimeline(null)}}},getTimelines:function(){return this._timelineList},setFrameEventCallFunc:function(t){this._frameEventListener=t},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var t=new ccs.ActionTimeline;t.setDuration(this._duration);t.setTimeSpeed(this._timeSpeed);for(var e in this._timelineMap){var i=this._timelineMap[e];for(var n in i){var r=i[n];var s=r.clone();t.addTimeline(s)}}return t},reverse:function(){return null},step:function(t){if(!this._playing||this._timelineMap.length===0||this._duration===0){return}this._time+=t*this._timeSpeed;var e=this._time-this._endFrame*this._frameInternal;if(e<this._frameInternal){this._currentFrame=Math.floor(this._time/this._frameInternal);this._stepToFrame(this._currentFrame);if(e>=0&&this._lastFrameListener)this._lastFrameListener()}else{this._playing=this._loop;if(!this._playing){this._time=this._endFrame*this._frameInternal;if(this._currentFrame!=this._endFrame){this._currentFrame=this._endFrame;this._stepToFrame(this._currentFrame);if(this._lastFrameListener)this._lastFrameListener()}}else this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop)}},_foreachNodeDescendant:function(t,e){e(t);var i=t.getChildren();for(var n=0;n<i.length;n++){var r=i[n];this._foreachNodeDescendant(r,e)}},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t);var e=this;var i=function(t){var i=t.getComponent("ComExtensionData");if(i){var n=i.getActionTag();if(e._timelineMap[n]){var r=e._timelineMap[n];for(var s=0;s<r.length;s++){var a=r[s];a.setNode(t)}}}};this._foreachNodeDescendant(t,i)},isDone:function(){return false},play:function(t,e){var i=this._animationInfos[t];if(!i)return cc.log("Can't find animation info for %s",t);this.gotoFrameAndPlay(i.startIndex,i.endIndex,e)},addAnimationInfo:function(t){this._animationInfos[t.name]=t},removeAnimationInfo:function(t){delete this._animationInfos[t]},isAnimationInfoExists:function(t){return this._animationInfos[t]},getAnimationInfo:function(t){return this._animationInfos[t]},setLastFrameCallFunc:function(t){this._lastFrameListener=t},clearLastFrameCallFunc:function(){this._lastFrameListener=null}});ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline};ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0;this._tween=true;this._timeline=null;this._node=null;this._enterWhenPassed=false;this._easingParam=[]},_emitEvent:function(){if(this._timeline){this._timeline.getActionTimeline()._emitFrameEvent(this)}},_cloneProperty:function(t){this._frameIndex=t.getFrameIndex();this._tween=t.isTween();this._tweenType=t.getTweenType();this.setEasingParams(t.getEasingParams())},setFrameIndex:function(t){this._frameIndex=t},getFrameIndex:function(){return this._frameIndex},setTimeline:function(t){this._timeline=t},getTimeline:function(t){return this._timeline},setNode:function(t){this._node=t},getNode:function(){return this._node},setTween:function(t){this._tween=t},isTween:function(){return this._tween},onEnter:function(t){},apply:function(t){if(!this._tween)return;if(this._tweenType!==ccs.FrameEaseType.TWEEN_EASING_MAX&&this._tweenType!==ccs.FrameEaseType.LINEAR)t=this.tweenPercent(t);this._onApply(t)},_onApply:function(t){},clone:function(){},tweenPercent:function(t){var e=ccs.Frame.tweenToMap[this._tweenType];if(e)return e(t,this._easingParam);else return t},setEasingParams:function(t){if(t){this._easingParam.length=0;for(var e=0;e<t.length;e++)this._easingParam[e]=t[e]}},getEasingParams:function(){return this._easingParam},setTweenType:function(t){this._tweenType=t},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}});ccs.Frame.tweenToMap={"-1":function(t,e){if(e){var i=1-t;return e[1]*i*i*i+3*e[3]*t*i*i+3*e[5]*t*t*i+e[7]*t*t*t}return t},1:cc._easeSineInObj.easing,2:cc._easeSineOutObj.easing,3:cc._easeSineInOutObj.easing,4:cc._easeQuadraticActionIn.easing,5:cc._easeQuadraticActionOut.easing,6:cc._easeQuadraticActionInOut.easing,7:cc._easeCubicActionIn.easing,8:cc._easeCubicActionOut.easing,9:cc._easeCubicActionInOut.easing,10:cc._easeCubicActionIn.easing,11:cc._easeCubicActionOut.easing,12:cc._easeCubicActionInOut.easing,13:cc._easeQuinticActionIn.easing,14:cc._easeQuinticActionOut.easing,15:cc._easeQuinticActionInOut.easing,16:cc._easeExponentialInObj.easing,17:cc._easeExponentialOutObj.easing,18:cc._easeExponentialInOutObj.easing,19:cc._easeCircleActionIn.easing,20:cc._easeCircleActionOut.easing,21:cc._easeCircleActionInOut.easing,22:function(t,e){var i=.3;e!=null&&(i=e[0]);return cc.easeElasticIn(i).easing(t)},23:function(t,e){var i=.3;e!=null&&(i=e[0]);return cc.easeElasticOut(i).easing(t)},24:function(t,e){var i=.3;e!=null&&(i=e[0]);return cc.easeElasticInOut(i).easing(t)},25:cc._easeBackInObj.easing,26:cc._easeBackOutObj.easing,27:cc._easeBackInOutObj.easing,28:cc._easeBounceInObj.easing,29:cc._easeBounceOutObj.easing,30:cc._easeBounceInOutObj.easing};ccs.VisibleFrame=ccs.Frame.extend({_visible:true,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._visible=true},onEnter:function(t){if(this._node)this._node.setVisible(this._visible)},clone:function(){var t=new ccs.VisibleFrame;t.setVisible(this._visible);t._cloneProperty(this);return t},setVisible:function(t){this._visible=t},isVisible:function(){return this._visible}});ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame};ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._textureName=""},setNode:function(t){ccs.Frame.prototype.setNode.call(this,t);this._sprite=t},onEnter:function(t){if(this._sprite){var e=this._sprite.getBlendFunc();var i=cc.spriteFrameCache._spriteFrames[this._textureName];if(i!=null)this._sprite.setSpriteFrame(i);else this._sprite.setTexture(this._textureName);if(this._sprite.getBlendFunc()!==e)this._sprite.setBlendFunc(e)}},clone:function(){var t=new ccs.TextureFrame;t.setTextureName(this._textureName);t._cloneProperty(this);return t},setTextureName:function(t){this._textureName=t},getTextureName:function(){return this._textureName}});ccs.TextureFrame.create=function(){return new ccs.TextureFrame};ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._rotation=0},onEnter:function(t){if(!this._node)return;this._node.setRotation(this._rotation);if(this._tween){this._betwennRotation=t._rotation-this._rotation}},_onApply:function(t){if(this._betwennRotation!==0){var e=this._rotation+t*this._betwennRotation;this._node.setRotation(e)}},clone:function(){var t=new ccs.RotationFrame;t.setRotation(this._rotation);t._cloneProperty(this);return t},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation}});ccs.RotationFrame.create=function(){return new ccs.RotationFrame};ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._skewX=0;this._skewY=0},onEnter:function(t){if(!this._node)return;this._node.setSkewX(this._skewX);this._node.setSkewY(this._skewY);
if(this._tween){this._betweenSkewX=t._skewX-this._skewX;this._betweenSkewY=t._skewY-this._skewY}},_onApply:function(t){if(this._betweenSkewX!==0||this._betweenSkewY!==0){var e=this._skewX+t*this._betweenSkewX;var i=this._skewY+t*this._betweenSkewY;this._node.setSkewX(e);this._node.setSkewY(i)}},clone:function(){var t=new ccs.SkewFrame;t.setSkewX(this._skewX);t.setSkewY(this._skewY);t._cloneProperty(this);return t},setSkewX:function(t){this._skewX=t},getSkewX:function(){return this._skewX},setSkewY:function(t){this._skewY=t},getSkewY:function(){return this._skewY}});ccs.SkewFrame.create=function(){return new ccs.SkewFrame};ccs.RotationSkewFrame=ccs.SkewFrame.extend({onEnter:function(t){if(!this._node)return;this._node.setRotationX(this._skewX);this._node.setRotationY(this._skewY);if(this._tween){this._betweenSkewX=t._skewX-this._skewX;this._betweenSkewY=t._skewY-this._skewY}},_onApply:function(t){if(this._node&&(this._betweenSkewX!==0||this._betweenSkewY!==0)){var e=this._skewX+t*this._betweenSkewX;var i=this._skewY+t*this._betweenSkewY;this._node.setRotationX(e);this._node.setRotationY(i)}},clone:function(){var t=new ccs.RotationSkewFrame;t.setSkewX(this._skewX);t.setSkewY(this._skewY);t._cloneProperty(this);return t}});ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame};ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._position=cc.p(0,0)},onEnter:function(t){if(!this._node)return;this._node.setPosition(this._position);if(this._tween){this._betweenX=t._position.x-this._position.x;this._betweenY=t._position.y-this._position.y}},_onApply:function(t){if(this._node&&(this._betweenX!==0||this._betweenY!==0)){var e=cc.p(0,0);e.x=this._position.x+this._betweenX*t;e.y=this._position.y+this._betweenY*t;this._node.setPosition(e)}},clone:function(){var t=new ccs.PositionFrame;t.setPosition(this._position);t._cloneProperty(this);return t},setPosition:function(t){this._position=t},getPosition:function(){return this._position},setX:function(t){this._position.x=t},getX:function(){return this._position.x},setY:function(t){this._position.y=t},getY:function(){return this._position.y}});ccs.PositionFrame.create=function(){return new ccs.PositionFrame};ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._scaleX=1;this._scaleY=1},onEnter:function(t){if(!this._node)return;this._node.setScaleX(this._scaleX);this._node.setScaleY(this._scaleY);if(this._tween){this._betweenScaleX=t._scaleX-this._scaleX;this._betweenScaleY=t._scaleY-this._scaleY}},_onApply:function(t){if(this._node&&(this._betweenScaleX!==0||this._betweenScaleY!==0)){var e=this._scaleX+this._betweenScaleX*t;var i=this._scaleY+this._betweenScaleY*t;this._node.setScaleX(e);this._node.setScaleY(i)}},clone:function(){var t=new ccs.ScaleFrame;t.setScaleX(this._scaleX);t.setScaleY(this._scaleY);t._cloneProperty(this);return t},setScale:function(t){this._scaleX=t;this._scaleY=t},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY}});ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame};ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._anchorPoint=cc.p(0,0)},onEnter:function(t){if(this._node)this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var t=new ccs.AnchorPointFrame;t.setAnchorPoint(this._anchorPoint);t._cloneProperty(this);return t},setAnchorPoint:function(t){this._anchorPoint=t},getAnchorPoint:function(){return this._anchorPoint}});ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame};ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2};ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this);this._enterWithName=false;this._innerActionType=ccs.InnerActionType.LoopAction;this._startFrameIndex=0},onEnter:function(t){if(!this._node)return;var e=this._node.getActionByTag(this._node.getTag());if(!e)return;if(ccs.InnerActionType.SingleFrame===this._innerActionType){e.gotoFrameAndPause(this._singleFrameIndex);return}var i=this._startFrameIndex;var n=this._endFrameIndex;if(this._enterWithName){if(this._animationName==="-- ALL --"){i=0;n=e.getDuration()}else if(e.isAnimationInfoExists(this._animationName)){var r=e.getAnimationInfo(this._animationName);i=r.startIndex;n=r.endIndex}else{cc.log("Animation %s not exists!",this._animationName)}}var s=this._timeline.getActionTimeline().getDuration();var a=s-this._frameIndex-n+i;if(a<0){n+=a}if(ccs.InnerActionType.NoLoopAction===this._innerActionType){e.gotoFrameAndPlay(i,n,false)}else if(ccs.InnerActionType.LoopAction===this._innerActionType){e.gotoFrameAndPlay(i,n,true)}},setAnimationName:function(t){this._animationName=t},setSingleFrameIndex:function(t){this._singleFrameIndex=t},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(t){this._enterWithName=t},getEnterWithName:function(){return this._enterWithName},clone:function(){var t=new ccs.InnerActionFrame;t.setInnerActionType(this._innerActionType);t.setStartFrameIndex(this._startFrameIndex);t.setEnterWithName(this._enterWithName);t.setAnimationName(this._animationName);t.setSingleFrameIndex(this._singleFrameIndex);t._cloneProperty(this);return t},setInnerActionType:function(t){this._innerActionType=t},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(t){this._startFrameIndex=t},getStartFrameIndex:function(){return this._startFrameIndex}});ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame};ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._color=cc.color(255,255,255)},onEnter:function(t){if(!this._node)return;this._node.setColor(this._color);if(this._tween){var e=t._color;this._betweenRed=e.r-this._color.r;this._betweenGreen=e.g-this._color.g;this._betweenBlue=e.b-this._color.b}},_onApply:function(t){if(this._node&&this._tween&&(this._betweenAlpha!==0||this._betweenRed!==0||this._betweenGreen!==0||this._betweenBlue!==0)){var e=cc.color(255,255,255);e.r=this._color.r+this._betweenRed*t;e.g=this._color.g+this._betweenGreen*t;e.b=this._color.b+this._betweenBlue*t;this._node.setColor(e);if(this._alpha!==null){var i=this._alpha+this._betweenAlpha*t;this._node.setOpacity(i)}}},clone:function(){var t=new ccs.ColorFrame;t.setColor(this._color);t._cloneProperty(this);return t},setColor:function(t){this._color=t},getColor:function(){return this._color}});ccs.ColorFrame.create=function(){return new ccs.ColorFrame};ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._alpha=255},onEnter:function(t){if(!this._node)return;this._node.setOpacity(this._alpha);if(this._tween){this._betweenAlpha=t._alpha-this._alpha}},_onApply:function(t){if(!this._node)return;var e=this._alpha+this._betweenAlpha*t;this._node.setOpacity(e)},setAlpha:function(t){this._alpha=t},getAlpha:function(){return this._alpha},clone:function(){var t=new ccs.AlphaFrame;t.setAlpha(this._alpha);t._cloneProperty(this);return t}});ccs.EventFrame=ccs.Frame.extend({_event:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._event="";this._enterWhenPassed=true},onEnter:function(t){this._emitEvent()},clone:function(){var t=new ccs.EventFrame;t.setEvent(this._event);t._cloneProperty(this);return t},setEvent:function(t){this._event=t},getEvent:function(){return this._event}});ccs.EventFrame.create=function(){return new ccs.EventFrame};ccs.ZOrderFrame=ccs.Frame.extend({_zorder:0,onEnter:function(t){if(this._node)this._node.setLocalZOrder(this._zorder)},clone:function(){var t=new ccs.ZOrderFrame;t.setZOrder(this._zorder);t._cloneProperty(this);return t},setZOrder:function(t){this._zorder=t},getZOrder:function(){return this._zorder}});ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame};ccs.BlendFuncFrame=ccs.Frame.extend({ctor:function(){this._super();this._blendFunc=null},onEnter:function(t,e){if(this._node&&this._blendFunc)this._node.setBlendFunc(this._blendFunc)},clone:function(){var t=new ccs.BlendFuncFrame;t.setBlendFunc(this._blendFunc);t._cloneProperty(this);return t},setBlendFunc:function(t){if(t&&t.src&&t.dst)this._blendFunc=t},getBlendFunc:function(){return this._blendFunc}});ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame};ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[];this._currentKeyFrame=null;this._currentKeyFrameIndex=0;this._fromIndex=0;this._toIndex=0;this._betweenDuration=0;this._actionTag=0;this._ActionTimeline=null;this._node=null},_gotoFrame:function(t){if(this._frames.length===0)return;this._binarySearchKeyFrame(t);this._apply(t)},_stepToFrame:function(t){if(this._frames.length===0)return;this._updateCurrentKeyFrame(t);this._apply(t)},getFrames:function(){return this._frames},addFrame:function(t){this._frames.push(t);t.setTimeline(this)},insertFrame:function(t,e){this._frames.splice(e,0,t);t.setTimeline(this)},removeFrame:function(t){cc.arrayRemoveObject(this._frames,t);t.setTimeline(null)},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setNode:function(t){for(var e=0;e<this._frames.length;e++){var i=this._frames[e];i.setNode(t)}},getNode:function(){return this._node},setActionTimeline:function(t){this._ActionTimeline=t},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var t=new ccs.Timeline;t._actionTag=this._actionTag;for(var e=0;e<this._frames.length;e++){var i=this._frames[e];var n=i.clone();t.addFrame(n)}return t},_apply:function(t){if(this._currentKeyFrame){var e=this._betweenDuration<=0?0:(t-this._currentKeyFrameIndex)/this._betweenDuration;this._currentKeyFrame.apply(e)}},_binarySearchKeyFrame:function(t){var e=null;var i=null;var n=this._frames.length;var r=false;do{if(t<this._frames[0].getFrameIndex()){if(this._currentKeyFrameIndex>=this._frames[0].getFrameIndex())r=true;this._fromIndex=0;this._toIndex=0;e=i=this._frames[0];this._currentKeyFrameIndex=0;this._betweenDuration=this._frames[0].getFrameIndex();break}else if(t>=this._frames[n-1].getFrameIndex()){this._fromIndex=n-1;this._toIndex=0;e=i=this._frames[n-1];this._currentKeyFrameIndex=this._frames[n-1].getFrameIndex();this._betweenDuration=0;break}var s=-1;var a=0,o=n-1,c=0;while(a<=o){c=Math.ceil((a+o)/2);if(t>=this._frames[c].getFrameIndex()&&t<this._frames[c+1].getFrameIndex()){s=c;break}if(this._frames[c].getFrameIndex()>t)o=c-1;else a=c+1}this._fromIndex=s;if(n>1)this._toIndex=s+1|0;else this._toIndex=s|0;e=this._frames[this._fromIndex];i=this._frames[this._toIndex];e=this._frames[s];i=this._frames[s+1];if(s===0&&this._currentKeyFrameIndex<e.getFrameIndex())r=true;this._currentKeyFrameIndex=e.getFrameIndex();this._betweenDuration=i.getFrameIndex()-e.getFrameIndex()}while(0);if(r||this._currentKeyFrame!=e){this._currentKeyFrame=e;this._currentKeyFrame.onEnter(i)}},_updateCurrentKeyFrame:function(t){if(t>60)var e=0;if(t<this._currentKeyFrameIndex||t>=this._currentKeyFrameIndex+this._betweenDuration){var i=null;var n=null;do{var r=this._frames.length;if(t<this._frames[0].getFrameIndex()){i=n=this._frames[0];this._currentKeyFrameIndex=0;this._betweenDuration=this._frames[0].getFrameIndex();break}else if(t>=this._frames[r-1].getFrameIndex()){var s=this._frames[r-1].getFrameIndex();if(this._currentKeyFrameIndex>=s)return;t=s}do{this._fromIndex=this._toIndex;i=this._frames[this._fromIndex];this._currentKeyFrameIndex=i.getFrameIndex();this._toIndex=this._fromIndex+1;if(this._toIndex>=r){this._toIndex=0}n=this._frames[this._toIndex];if(t===i.getFrameIndex())break;if(t>i.getFrameIndex()&&t<n.getFrameIndex())break;if(i.isEnterWhenPassed())i.onEnter(n)}while(true);this._betweenDuration=n.getFrameIndex()-i.getFrameIndex()}while(0);this._currentKeyFrame=i;this._currentKeyFrame.onEnter(n)}}});ccs.Timeline.create=function(){return new ccs.Timeline};ccs.SkinNode=function(){var t=cc.Node;var e={};var i=t.extend(e);i.create=function(){};return i}();ccs.BoneNode=function(){var t=cc.Node;var e=ccs.SkinNode;var i=cc.BlendFunc;var n={p:cc.p,size:cc.size,rect:cc.rect};var r={log:cc.log,assert:cc.assert};var s=t.extend({_customCommand:null,_blendFunc:null,_rackColor:null,_rackLength:null,_rackWidth:null,_childBones:null,_boneSkins:null,_rootSkeleton:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,ctor:function(e){t.prototype.ctor.call(this);if(this._squareVertices===null)this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this._rackColor=cc.color.WHITE;this._blendFunc=i.ALPHA_NON_PREMULTIPLIED;this._childBones=[];this._boneSkins=[];this._rackLength=e===undefined?50:e;this._rackWidth=20;this._updateVertices()},addSkin:function(e,i,n){var s=this._boneSkins;r.assert(e!=null,"Argument must be non-nil");if(n){for(var a=0;a<s.length;a++){s[a].setVisible(false)}}t.prototype.addChild.call(this,e);this._boneSkins.push(e);e.setVisible(i)},getChildBones:function(){return this._childBones},getSkins:function(){return this._boneSkins},displaySkin:function(t,e){var i=this._boneSkins;var n,r;if(typeof t==="string"){for(r=0;r<i.length;r++){n=i[r];if(t==n.getName()){n.setVisible(true)}else if(e){n.setVisible(false)}}}else{for(r=0;r<i.length;r++){n=i[r];if(n==t){n.setVisible(true)}else if(e){n.setVisible(false)}}}},getVisibleSkins:function(){var t=[];var e=this._boneSkins;for(var i,n=0;n<e.length;n++){i=e[n];if(i.isVisible()){t.push(i)}}return t},getRootSkeletonNode:function(){return this._rootSkeleton},getAllSubBones:function(){var t=[];var e=[];var i=this._childBones;for(var n=0;n<i.length;n++){e.push(i[n])}while(e.length>0){var r=e.pop();t.push(r);var s=r.getChildBones();for(var a=0;a<s;a++){e.push(s[a])}}return t},getAllSubSkins:function(){var t=this.getAllSubBones();var e=[];for(var i=0;i<t.length;i++){var n=t[i].getSkins();for(var r=0;r<n.length;r++){e.push(n[i])}}return e},addChild:function(e,i,n){t.prototype.addChild.call(this,e,i,n);this._addToChildrenListHelper(e)},removeChild:function(e,i){if(this._children.indexOf(e)!==-1){t.prototype.removeChild.call(this,e,i);this._removeFromChildrenListHelper(e)}},setBlendFunc:function(t){var e=this._blendFunc;if(t&&e.src!==t.src&&e.dst!==t.dst){this._blendFunc=t;var i=this._boneSkins;for(var n,r=0;r<i.length;r++){n=i[r];n.setBlendFunc(t)}}},getBlendFunc:function(){return this._blendFunc},setDebugDrawLength:function(t){this._rackLength=t;this._updateVertices()},getDebugDrawLength:function(){return this._rackLength},setDebugDrawWidth:function(t){this._rackWidth=t;this._updateVertices()},getDebugDrawWidth:function(){return this._rackWidth},setDebugDrawEnabled:function(t){var e=this._renderCmd;if(e._debug===t)return;e._debug=t;cc.renderer.childrenOrderDirty=true;if(this._visible&&null!=this._rootSkeleton){this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}},isDebugDrawEnabled:function(){return this._renderCmd._debug},setDebugDrawColor:function(t){this._rackColor=t},getDebugDrawColor:function(){return this._rackColor},getVisibleSkinsRect:function(){var t,e,i,r=0;t=e=i=r;var s=true;var a=n.rect(0,0,0,0);if(this._renderCmd._debug&&this._rootSkeleton!=null&&this._rootSkeleton._renderCmd._debug){i=this._rackWidth;r=this._rackLength;s=false}var o=this._boneSkins;for(var c,l=0;l<o.length;l++){c=o[l];var h=c.getBoundingBox();if(!c.isVisible()||h.x===0&&h.y===0&&h.width===0&&h.height===0)continue;if(s){t=cc.rectGetMinX(h);e=cc.rectGetMinY(h);i=cc.rectGetMaxX(h);r=cc.rectGetMaxY(h);s=false}else{t=Math.min(cc.rectGetMinX(h),t);e=Math.min(cc.rectGetMinY(h),e);i=Math.max(cc.rectGetMaxX(h),i);r=Math.max(cc.rectGetMaxY(h),r)}a.setRect(t,e,i-t,r-e)}return a},getBoundingBox:function(){var t=this.getVisibleSkinsRect();return cc.rectApplyAffineTransform(t,this.getNodeToParentAffineTransform())},batchBoneDrawToSkeleton:function(t){},setLocalZOrder:function(e){t.prototype.setLocalZOrder.call(this,e);if(this._rootSkeleton!=null)this._rootSkeleton._subBonesOrderDirty=true},setName:function(e){var i=this._rootSkeleton;var n=this.getName();t.prototype.setName.call(this,e);if(i!=null){var r=i._subBonesMap[n];var s=i._subBonesMap[e];if(r&&!s){delete i._subBonesMap[r];i._subBonesMap[e]=r}}},setContentSize:function(e){t.prototype.setContentSize.call(this,e);this._updateVertices()},setAnchorPoint:function(e){t.prototype.setAnchorPoint.call(this,e);this._updateVertices()},setVisible:function(e){if(this._visible==e)return;t.prototype.setVisible.call(this,e);if(this._rootSkeleton!=null){this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}},_addToChildrenListHelper:function(t){if(t instanceof s){this._addToBoneList(t)}else{this._addToSkinList(t)}},_removeFromChildrenListHelper:function(t){if(t instanceof s){this._removeFromBoneList(t)}else{if(t instanceof e)this._removeFromSkinList(skin)}},_removeFromBoneList:function(t){if(this._rootSkeleton!=null&&t instanceof ccs.SkeletonNode&&t._rootSkeleton===this._rootSkeleton){t._rootSkeleton=null;var e=t.getAllSubBones();e.push(t);for(var i,n=0;n<e.length;n++){i=e[n];i._rootSkeleton=null;delete this._rootSkeleton._subBonesMap[i.getName()];this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}}else{this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}cc.arrayRemoveObject(this._childBones,t)},_setRootSkeleton:function(t){this._rootSkeleton=t;var e=this.getAllSubBones();for(var i=0;i<e.length;i++){this._addToBoneList(e[i])}},_addToBoneList:function(t){if(this._childBones.indexOf(t)===-1)this._childBones.push(t);if(this._rootSkeleton!=null){var i=t;if(!(i instanceof e)&&!t._rootSkeleton){var n=t.getAllSubBones();n.push(t);for(var r,s=0;s<n.length;s++){r=n[s];r._setRootSkeleton(this._rootSkeleton);var a=r.getName();if(!this._rootSkeleton._subBonesMap[a]){this._rootSkeleton._subBonesMap[r.getName()]=r;this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}else{cc.log("already has a bone named %s in skeleton %s",a,this._rootSkeleton.getName());this._rootSkeleton._subBonesDirty=true;this._rootSkeleton._subBonesOrderDirty=true}}}}},_visitSkins:function(){var t=this._renderCmd;if(!this._visible)return;var e=t.getParentRenderCmd();if(e)t._curLevel=e._curLevel+1;var i,n=this._boneSkins,r;t._syncStatus(e);var s=n.length;if(s>0){this.sortAllChildren();for(i=0;i<s;i++){r=n[i];if(r._localZOrder<0)r._renderCmd.visit(t);else break}for(;i<s;i++)n[i]._renderCmd.visit(t)}t._dirtyFlag=0},_addToSkinList:function(t){this._boneSkins.push(t);if(t.getBlendFunc){var e=t.getBlendFunc();if(this._blendFunc.src!==e.src&&this._blendFunc.dst!==e.dst)t.setBlendFunc(this._blendFunc)}},_removeFromSkinList:function(t){cc.arrayRemoveObject(this._boneSkins,t)},sortAllChildren:function(){this._sortArray(this._childBones);this._sortArray(this._boneSkins);t.prototype.sortAllChildren.call(this)},_sortArray:function(t){if(!t)return;var e=t.length,i,n,r;for(i=1;i<e;i++){r=t[i];n=i-1;while(n>=0){if(r._localZOrder<t[n]._localZOrder){t[n+1]=t[n]}else if(r._localZOrder===t[n]._localZOrder&&r.arrivalOrder<t[n].arrivalOrder){t[n+1]=t[n]}else{break}n--}t[n+1]=r}},_updateVertices:function(){var t=this._squareVertices,e=this._renderCmd._anchorPointInPoints;if(this._rackLength!=t[2].x-e.x||t[3].y!=this._rackWidth/2-e.y){t[1].x=t[1].y=t[3].y=0;t[0].x=t[2].x=this._rackLength*.1;t[2].y=this._rackWidth*.5;t[0].y=-t[2].y;t[3].x=this._rackLength;for(var i=0;i<t.length;i++){t[i].x+=e.x;t[i].y+=e.y}this._renderCmd.updateDebugPoint(t)}},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new a(this);else return new o(this)}});s.create=function(t,e){return new ccui.BoneNode(t,e)};var a=function(){var e=function(e){t.CanvasRenderCmd.call(this,e);this._debug=false;this._color=cc.color.WHITE;this._drawNode=new cc.DrawNode};var i=e.prototype=Object.create(t.CanvasRenderCmd.prototype);i.constructor=e;i.visit=function(t){var e=this._node;e._visit&&e._visit(t)};i.updateDebugPoint=function(t){this._drawNode.clear();this._drawNode.drawPoly(t,this._color,0,this._color)};i.transform=function(e,i){var n=this._node._rootSkeleton;t.CanvasRenderCmd.prototype.transform.call(this,e,i);if(n&&n._renderCmd._debug){this._drawNode._renderCmd.transform(this)}};return e}();var o=function(){var e=function(e){t.WebGLRenderCmd.call(this,e);this._debug=false;this._color=cc.color.WHITE;this._drawNode=new cc.DrawNode};var i=e.prototype=Object.create(t.WebGLRenderCmd.prototype);i.constructor=e;i.visit=function(t){var e=this._node;e._visit&&e._visit(t)};i.updateDebugPoint=function(t){this._drawNode.clear();this._drawNode.drawPoly(t,this._color,0,this._color)};i.transform=function(e,i){var n=this._node._rootSkeleton;t.WebGLRenderCmd.prototype.transform.call(this,e,i);if(n&&n._renderCmd._debug){this._drawNode._renderCmd.transform(this)}};return e}();return s}();ccs.SkeletonNode=function(){var t=ccs.BoneNode;var e={p:cc.p,size:cc.size,rect:cc.rect};var i=t.extend({_subBonesMap:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,_skinGroupMap:null,_sortedAllBonesDirty:false,_sortedAllBones:null,_batchedBoneVetices:null,_batchedBoneColors:null,_batchedVeticesCount:null,_batchBoneCommand:null,_subOrderedAllBones:null,ctor:function(){this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this._rootSkeleton=this;t.prototype.ctor.call(this);this._subBonesMap={};this._subOrderedAllBones=[];this._skinGroupMap={};this._rackLength=this._rackWidth=20;this._updateVertices()},getBoneNode:function(t){var e=this._subBonesMap[t];if(e)return e;return null},getAllSubBonesMap:function(){return this._subBonesMap},changeSkins:function(t){if(typeof t==="object"){var e;for(var i in t){e=t[i];var n=this.getBoneNode(i);if(null!==n)n.displaySkin(e,true)}}else{var r=this._suitMap[t];if(r)this.changeSkins(r,true)}},addSkinGroup:function(t,e){this._skinGroupMap[t]=e},getBoundingBox:function(){var t,e,i,n=0;t=e=i=n;var r=this.getVisibleSkinsRect();var s=true;if(r.x!==0||r.y!==0||r.width!==0||r.height!==0){t=cc.rectGetMinX(r);e=cc.rectGetMinY(r);i=cc.rectGetMaxX(r);n=cc.rectGetMaxY(r);s=false}var a=this.getAllSubBones();for(var o,c=0;c<a.length;c++){o=a[c];var l=cc.rectApplyAffineTransform(o.getVisibleSkinsRect(),o.getNodeToParentTransform(o.getRootSkeletonNode()));if(l.x===0&&l.y===0&&l.width===0&&l.height===0)continue;if(s){t=cc.rectGetMinX(l);e=cc.rectGetMinY(l);i=cc.rectGetMaxX(l);n=cc.rectGetMaxY(l);s=false}else{t=Math.min(cc.rectGetMinX(l),t);e=Math.min(cc.rectGetMinY(l),e);i=Math.max(cc.rectGetMaxX(l),i);n=Math.max(cc.rectGetMaxY(l),n)}}r.x=t;r.y=e;r.width=i-t;r.height=n-e;return cc.rectApplyAffineTransform(r,this.getNodeToParentTransform())},_visit:function(t){if(!this._visible)return;var e=this._renderCmd;t=t||e.getParentRenderCmd();e._syncStatus(t);var i,n;if(this._children.length!==0){for(i=0;i<this._children.length;i++){n=this._children[i];n._renderCmd.visit(e)}}this._checkSubBonesDirty();var r=this._subOrderedAllBones,s,a;for(i=0;i<r.length;i++){s=r[i];s._visitSkins()}if(e._debug)for(i=0;i<r.length;i++){a=r[i]._renderCmd;cc.renderer.pushRenderCommand(a._drawNode._renderCmd)}this._dirtyFlag=0},_checkSubBonesDirty:function(){if(this._subBonesDirty){this._updateOrderedAllbones();this._subBonesDirty=false}if(this._subBonesOrderDirty){this._sortOrderedAllBones();this._subBonesOrderDirty=false}},_updateOrderedAllbones:function(){this._subOrderedAllBones.length=0;var t=[];var e=this._childBones;for(var i,n=0;n<e.length;n++){i=e[n];if(i.isVisible())t.push(i)}while(t.length>0){var r=t.pop();var s=r._renderCmd;s._syncStatus(s.getParentRenderCmd());this._subOrderedAllBones.push(r);var a=r.getChildBones();for(var o,n=0;n<a.length;n++){o=a[n];if(o.isVisible())t.push(o)}}},_sortOrderedAllBones:function(){this._sortArray(this._subOrderedAllBones)},_updateVertices:function(){var t=this._squareVertices,e=this._renderCmd._anchorPointInPoints;if(this._rackLength!=t[6].x-e.x||this._rackWidth!=t[3].y-e.y){var i=this._rackLength*.5;var n=this._rackWidth*.5;var r=i*.25;var s=n*.25;t[5].y=t[2].y=t[1].y=t[6].y=t[0].x=t[4].x=t[7].x=t[3].x=0;t[5].x=-i;t[0].y=-n;t[6].x=i;t[3].y=n;t[1].x=r;t[7].y=s;t[2].x=-r;t[4].y=-s;for(var a=0;a<t.length;a++){t[a].x+=e.x;t[a].y+=e.y}}},_updateAllDrawBones:function(){this._subDrawBones={};for(var t in this._subBonesMap){var e=this._subBonesMap[t];if(e.isVisible()&&e.isDebugDrawEnabled())this._subDrawBones.push(e)}this._sortArray(this._sortedAllBones);this._subDrawBones=false}});i.create=function(){return new i};return i}();ccs._load=function(){var t=function(t,n,r){var a=cc.loader.getRes(t);if(!a)return cc.log("%s does not exist",t);var o=i(t).toLocaleLowerCase();if(o!=="json"&&o!=="exportjson")return cc.log("%s load error, must be json file",t);var c;if(!n){if(a["widgetTree"])c=e["ccui"];else if(a["nodeTree"])c=e["timeline"];else if(a["Content"]&&a["Content"]["Content"])c=e["timeline"];else if(a["gameobjects"])c=e["scene"]}else{c=e[n]}if(!c){cc.log("Can't find the parser : %s",t);return new cc.Node}var l=a["version"]||a["Version"];if(!l&&a["armature_data"]){cc.warn("%s is armature. please use:",t);cc.warn("    ccs.armatureDataManager.addArmatureFileInfoAsync(%s);",t);cc.warn("    var armature = new ccs.Armature('name');");return new cc.Node}var h=s(c,l);if(!h){cc.log("Can't find the parser : %s",t);return new cc.Node}return h.parse(t,a,r)||null};var e={ccui:{},timeline:{},action:{},scene:{}};t.registerParser=function(t,i,n){if(!t||!i||!n)return cc.log("register parser error");if(!e[t])e[t]={};e[t][i]=n};t.getParser=function(t,i){if(t&&i)return e[t]?e[t][i]:undefined;if(t)return e[t];return e};var i=function(t){var e=t.match(n);return e&&e[1]?e[1]:null};var n=/\.([^\.]+)$/;var r=/([^\.](\.\*)?)*$/;var s=function(t,e){if(t[e])return t[e];else if(e==="*")return null;else return s(t,e.replace(r,"*"))};return t}();ccs._parser=cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(t){var e=t.match(this._dirnameReg);return e&&e[0]?e[0]:""},getClass:function(t){return t["classname"]},getNodeJson:function(t){return t["widgetTree"]},parse:function(t,e,i){i=i||this._dirname(t);this.pretreatment(e,i);var n=this.parseNode(this.getNodeJson(e),i,t);n&&this.deferred(e,i,n,t);return n},pretreatment:function(t,e,i){},deferred:function(t,e,i,n){},parseNode:function(t,e){var i=this.parsers[this.getClass(t)];var n=null;if(i)n=i.call(this,t,e);else cc.log("Can't find the parser : %s",this.getClass(t));return n},registerParser:function(t,e){this.parsers[t]=e}});ccs.load=function(t,e){var i={node:null,action:null};i.node=ccs._load(t,null,e);i.action=ccs._load(t,"action",e);if(i.action&&i.action.tag===-1&&i.node)i.action.tag=i.node.tag;return i};ccs.load.validate={};ccs.loadWithVisibleSize=function(t,e){var i=ccs.load(t,e);var n=cc.director.getVisibleSize();if(i.node&&n){i.node.setContentSize(n.width,n.height);ccui.helper.doLayout(i.node)}return i};ccs.actionTimelineCache={createAction:function(t){return ccs._load(t,"action")}};ccs.csLoader={createNode:function(t){return ccs._load(t)}};cc.loader.register(["json"],{load:function(t,e,i,n){cc.loader.loadJson(t,function(t,i){var r=cc.path;if(i&&i["Content"]&&i["Content"]["Content"]["UsedResources"]){var s=i["Content"]["Content"]["UsedResources"],a=r.dirname(e),o=[],c,l;for(var h=0;h<s.length;h++){c=r.join(a,s[h]);l=r._normalize(c);if(!ccs.load.validate[l]){ccs.load.validate[l]=true;o.push(l)}}cc.loader.load(o,function(){n(t,i)})}else{n(t,i)}})}});(function(t,e){var i=e.extend({getNodeJson:function(t){return t["action"]},parseNode:function(t,e,i){if(!t)return null;var n=this,r=new ccs.ActionTimeline;r.setDuration(t["duration"]);r.setTimeSpeed(t["speed"]||1);var s=t["timelines"];s.forEach(function(t){var i=n.parsers[t["frameType"]];var s;if(i)s=i.call(n,t,e);else cc.log("parser does not exist : %s",t["frameType"]);if(s)r.addTimeline(s);if(t["frameType"]==="ColorFrame"){r.addTimeline(n.parsers["AlphaFrame"].call(n,t,e))}});return r}});var n=new i;var r=[{name:"PositionFrame",handle:function(t){var e=new ccs.PositionFrame;var i=t["x"];var n=t["y"];e.setPosition(cc.p(i,n));return e}},{name:"VisibleFrame",handle:function(t){var e=new ccs.VisibleFrame;var i=t["value"];e.setVisible(i);return e}},{name:"ScaleFrame",handle:function(t){var e=new ccs.ScaleFrame;var i=t["x"];var n=t["y"];e.setScaleX(i);e.setScaleY(n);return e}},{name:"RotationFrame",handle:function(t){var e=new ccs.RotationFrame;var i=t["rotation"];e.setRotation(i);return e}},{name:"SkewFrame",handle:function(t){var e=new ccs.SkewFrame;var i=t["x"];var n=t["y"];e.setSkewX(i);e.setSkewY(n);return e}},{name:"RotationSkewFrame",handle:function(t){var e=new ccs.RotationSkewFrame;var i=t["x"];var n=t["y"];e.setSkewX(i);e.setSkewY(n);return e}},{name:"AnchorFrame",handle:function(t){var e=new ccs.AnchorPointFrame;var i=t["x"];var n=t["y"];e.setAnchorPoint(cc.p(i,n));return e}},{name:"InnerActionFrame",handle:function(t){var e=new ccs.InnerActionFrame;var i=t["innerActionType"];var n=t["startFrame"];e.setInnerActionType(i);e.setStartFrameIndex(n);return e}},{name:"ColorFrame",handle:function(t){var e=new ccs.ColorFrame;var i=t["red"];var n=t["green"];var r=t["blue"];e.setColor(cc.color(i,n,r));var s=new ccs.AlphaFrame;var a=t["alpha"];s.setAlpha(a);return e}},{name:"AlphaFrame",handle:function(t){var e=new ccs.AlphaFrame;var i=t["alpha"];e.setAlpha(i);return e}},{name:"TextureFrame",handle:function(t){var e=new ccs.TextureFrame;var i=t["value"];if(i!=null){var n=i;var r=cc.spriteFrameCache.getSpriteFrame(n);if(r==null){var s=ccs.csLoader.getJsonPath();n=s+i}e.setTextureName(n)}return e}},{name:"EventFrame",handle:function(t){var e=new ccs.EventFrame;var i=t["value"];if(i!=null)e.setEvent(i);return e}},{name:"ZOrderFrame",handle:function(t){var e=new ccs.ZOrderFrame;var i=t["value"];e.setZOrder(i);return e}}];r.forEach(function(t){n.registerParser(t.name,function(e,i){var n=new ccs.Timeline;n.setActionTag(e["actionTag"]);var r=e["frames"];if(r&&r.length){r.forEach(function(e){var i=t.handle(e);i.setFrameIndex(e["frameIndex"]);i.setTween(e["tween"]);n.addFrame(i)})}return n})});t.registerParser("action","0.*",n);t.registerParser("action","1.*",n)})(ccs._load,ccs._parser);(function(t,e){var i=e.extend({getNodeJson:function(t){return t["Content"]["Content"]["Animation"]},parseNode:function(t,e,i){if(!t)return null;var n=this,r=new ccs.ActionTimeline;r.setDuration(t["Duration"]);r.setTimeSpeed(t["Speed"]||1);var s=t["Timelines"];s.forEach(function(t){var i=n.parsers[t["Property"]];var s;if(i)s=i.call(n,t,e);else cc.log("parser does not exist : %s",t["Property"]);if(s)r.addTimeline(s)});return r},deferred:function(t,e,i,n){var r=t["Content"]["Content"]["AnimationList"];var s=r?r.length:0;for(var a=0;a<s;a++){var o=r[a];var c={name:null,startIndex:null,endIndex:null};c.name=o["Name"];c.startIndex=o["StartIndex"];c.endIndex=o["EndIndex"];i.addAnimationInfo(c)}}});var n=new i;var r=[{name:"Position",handle:function(t){var e=new ccs.PositionFrame;var i=t["X"];var n=t["Y"];e.setPosition(cc.p(i,n));return e}},{name:"VisibleForFrame",handle:function(t){var e=new ccs.VisibleFrame;var i=t["Value"];e.setVisible(i);return e}},{name:"Scale",handle:function(t){var e=new ccs.ScaleFrame;var i=t["X"];var n=t["Y"];e.setScaleX(i);e.setScaleY(n);return e}},{name:"Rotation",handle:function(t){var e=new ccs.RotationFrame;var i=t["Rotation"]||t["Value"]||0;e.setRotation(i);return e}},{name:"Skew",handle:function(t){var e=new ccs.SkewFrame;
var i=t["X"];var n=t["Y"];e.setSkewX(i);e.setSkewY(n);return e}},{name:"RotationSkew",handle:function(t){var e=new ccs.RotationSkewFrame;var i=t["X"];var n=t["Y"];e.setSkewX(i);e.setSkewY(n);return e}},{name:"Anchor",handle:function(t){var e=new ccs.AnchorPointFrame;var i=t["X"];var n=t["Y"];e.setAnchorPoint(cc.p(i,n));return e}},{name:"AnchorPoint",handle:function(t){var e=new ccs.AnchorPointFrame;var i=t["X"];var n=t["Y"];e.setAnchorPoint(cc.p(i,n));return e}},{name:"InnerAction",handle:function(t){var e=new ccs.InnerActionFrame;var i=t["InnerActionType"];var n=t["StartFrame"];e.setInnerActionType(i);e.setStartFrameIndex(n);return e}},{name:"CColor",handle:function(t){var e=new ccs.ColorFrame;var i=t["Color"];if(!i)i={};i["R"]=i["R"]===undefined?255:i["R"];i["G"]=i["G"]===undefined?255:i["G"];i["B"]=i["B"]===undefined?255:i["B"];e.setColor(cc.color(i["R"],i["G"],i["B"]));return e}},{name:"Alpha",handle:function(t){var e=new ccs.AlphaFrame;var i=t["Value"];e.setAlpha(i);return e}},{name:"FileData",handle:function(t,e){var i,n,r,s,a;i=new ccs.TextureFrame;n=t["TextureFile"];if(n!=null){r=n["Plist"];s=n["Path"];a=cc.spriteFrameCache.getSpriteFrame(s);if(!a&&r){if(cc.loader.getRes(e+r)){cc.spriteFrameCache.addSpriteFrames(e+r);a=cc.spriteFrameCache.getSpriteFrame(s)}else{cc.log("%s need to be preloaded",e+r)}}if(a==null){s=e+s}i.setTextureName(s)}return i}},{name:"FrameEvent",handle:function(t){var e=new ccs.EventFrame;var i=t["Value"];if(i!=null)e.setEvent(i);return e}},{name:"ZOrder",handle:function(t){var e=new ccs.ZOrderFrame;var i=t["Value"];e.setZOrder(i);return e}},{name:"ActionValue",handle:function(t){var e=new ccs.InnerActionFrame;var i=t["InnerActionType"];var n=t["CurrentAniamtionName"];var r=t["SingleFrameIndex"];var s=t["FrameIndex"];if(s!==undefined)e.setFrameIndex(s);e.setInnerActionType(ccs.InnerActionType[i]);e.setSingleFrameIndex(r);e.setEnterWithName(true);if(n)e.setAnimationName(n);return e}},{name:"BlendFunc",handle:function(t){var e=new ccs.BlendFuncFrame;var i=t["BlendFunc"];if(i&&i["Src"]!==undefined&&i["Dst"]!==undefined)e.setBlendFunc(new cc.BlendFunc(i["Src"],i["Dst"]));return e}}];var s=function(t,e){var i=e["Type"];t.setTweenType(i);var n=e["Points"];var r=[];if(n){n.forEach(function(t){r.push(t["X"]);r.push(t["Y"])});t.setEasingParams(r)}};r.forEach(function(t){n.registerParser(t.name,function(e,i){var n=new ccs.Timeline;n.setActionTag(e["ActionTag"]);var r=e["Frames"];if(r&&r.length){r.forEach(function(e){var r=t.handle(e,i);r.setFrameIndex(e["FrameIndex"]);var a=e["Tween"]!=null?e["Tween"]:true;r.setTween(a);var o=e["EasingData"];if(o)s(r,o);n.addFrame(r)})}return n})});t.registerParser("action","*",n)})(ccs._load,ccs._parser);(function(t,e){var i=e.extend({getNodeJson:function(t){return t},parseNode:function(t,e){var i=this.parsers[this.getClass(t)];var n=null;if(i)n=i.call(this,t,e);else cc.log("Can't find the parser : %s",this.getClass(t));return n},deferred:function(t,e,i,n){ccs.triggerManager.parse(t["Triggers"]||[]);if(ccs.sceneReader)ccs.sceneReader._node=i},setPropertyFromJsonDict:function(t,e){var i=cc.isUndefined(e["x"])?0:e["x"];var n=cc.isUndefined(e["y"])?0:e["y"];t.setPosition(i,n);var r=Boolean(cc.isUndefined(e["visible"])?1:e["visible"]);t.setVisible(r);var s=cc.isUndefined(e["objecttag"])?-1:e["objecttag"];t.setTag(s);var a=cc.isUndefined(e["zorder"])?0:e["zorder"];t.setLocalZOrder(a);var o=cc.isUndefined(e["scalex"])?1:e["scalex"];var c=cc.isUndefined(e["scaley"])?1:e["scaley"];t.setScaleX(o);t.setScaleY(c);var l=cc.isUndefined(e["rotation"])?0:e["rotation"];t.setRotation(l);var h=e["name"]||"";t.setName(h)}});var n=new i;n.parseChild=function(t,e,i){for(var n=0;n<e.length;n++){var r,s=e[n];if(s)r=this.parseNode(s,i);if(r)t.addChild(r)}};var r={CCSprite:function(t,e,i){var n=new cc.Sprite;a(e["fileData"],i,function(t,e){if(e===0)n.setTexture(t);else if(e===1){var i=cc.spriteFrameCache.getSpriteFrame(t);n.setSpriteFrame(i)}});var r=new ccs.ComRender(n,"CCSprite");t.addComponent(r);return r},CCTMXTiledMap:function(t,e,i){var n=null;a(e["fileData"],i,function(t,e){if(e===0)n=new cc.TMXTiledMap(t)});var r=new ccs.ComRender(n,"CCTMXTiledMap");t.addComponent(r);return r},CCParticleSystemQuad:function(t,e,i){var n=null;a(e["fileData"],i,function(t,e){if(e===0)n=new cc.ParticleSystem(t);else cc.log("unknown resourcetype on CCParticleSystemQuad!");n.setPosition(0,0)});var r=new ccs.ComRender(n,"CCParticleSystemQuad");t.addComponent(r);return r},CCArmature:function(t,e,i){var n=null;a(e["fileData"],i,function(t,e){if(e===0){var i=cc.loader.getRes(t);if(!i)cc.log("Please load the resource [%s] first!",t);var r=i["armature_data"];var s=r[0];var a=s["name"];ccs.armatureDataManager.addArmatureFileInfo(t);n=new ccs.Armature(a)}});if(n){var r=new ccs.ComRender(n,"CCArmature");t.addComponent(r);var s=e["selectedactionname"];if(s&&n.getAnimation())n.getAnimation().play(s);return r}},CCComAudio:function(t,e,i){var n=null;a(e["fileData"],i,function(i,r){if(r===0){n=new ccs.ComAudio;n.preloadEffect(i);var s=e["name"];if(s)n.setName(s);t.addComponent(n)}})},CCComAttribute:function(t,e,i){var n=null;a(e["fileData"],i,function(e,i){if(i===0){n=new ccs.ComAttribute;if(e!=="")n.parse(e);t.addComponent(n)}else cc.log("unknown resourcetype on CCComAttribute!")});return n},CCBackgroundAudio:function(t,e,i){var n=null;a(e["fileData"],i,function(i,r){if(r===0){n=new ccs.ComAudio;n.preloadBackgroundMusic(i);n.setFile(i);var s=Boolean(e["loop"]||0);n.setLoop(s);var a=e["name"];if(a)n.setName(a);t.addComponent(n);n.playBackgroundMusic(i,s)}})},GUIComponent:function(t,e,i){var n=null;a(e["fileData"],i,function(t,e){n=ccs._load(t,"ccui")});var r=new ccs.ComRender(n,"GUIComponent");t.addComponent(r);return r},CCScene:function(){}};var s={};var a=function(t,e,i){if(t!=null){var n=t["path"];var r=t["resourceType"];var a=t["plist"];if(!n)return;if(a){if(cc.loader.getRes(e+a)){s[e+a]=true;cc.spriteFrameCache.addSpriteFrames(e+a)}else{if(!s[e+a])cc.log("%s need to be preloaded",e+a)}}if(r!==0)i(n,r);else i(e+n,r)}};n.parseComponents=function(t,e,i){if(!t||!e)return;e.forEach(function(e){var n=r[e["classname"]];var s=null;if(n)s=n(t,e,i);else cc.log("Can't find the component parser : %s",e["classname"]);var a=e["name"];if(s&&a){s.setName(a)}})};n.registerParser("CCNode",function(t,e){var i=new cc.Node;this.setPropertyFromJsonDict(i,t);this.parseChild.call(this,i,t["gameobjects"],e);this.parseComponents(i,t["components"],e);var n=t["CanvasSize"];if(n)i.setContentSize(cc.size(n["_width"],n["_height"]));return i});t.registerParser("scene","*",n)})(ccs._load,ccs._parser);(function(t,e){var i={};var n=e.extend({getNodeJson:function(t){return t["nodeTree"]},addSpriteFrame:function(t,e,n){if(!t||!e||t.length!==e.length)return;for(var r=0;r<t.length;r++){var s=n+t[r];if(!cc.loader.getRes(s)&&!i[s])cc.log("%s need to be preloaded",s);else i[s]=true;cc.spriteFrameCache.addSpriteFrames(s,n+e[r])}},pretreatment:function(t,e,i){this.addSpriteFrame(t["textures"],t["texturesPng"],e)}});var r=new n;r.generalAttributes=function(t,e){var i=e["width"]!=null?e["width"]:0;var n=e["height"]!=null?e["height"]:0;var r=e["x"]!=null?e["x"]:0;var s=e["y"]!=null?e["y"]:0;var a=e["scaleX"]!=null?e["scaleX"]:1;var o=e["scaleY"]!=null?e["scaleY"]:1;var c=e["rotation"]!=null?e["rotation"]:0;var l=e["rotationSkewX"]!=null?e["rotationSkewX"]:0;var h=e["rotationSkewY"]!=null?e["rotationSkewY"]:0;var u=e["skewX"]!=null?e["skewX"]:0;var d=e["skewY"]!=null?e["skewY"]:0;var _=e["anchorPointX"]!=null?e["anchorPointX"]:.5;var f=e["anchorPointY"]!=null?e["anchorPointY"]:.5;var p=e["opacity"]!=null?e["opacity"]:255;var m=e["colorR"]!=null?e["colorR"]:255;var g=e["colorG"]!=null?e["colorG"]:255;var v=e["colorB"]!=null?e["colorB"]:255;var y=e["colorR"]!=null?e["colorR"]:0;var T=e["tag"]!=null?e["tag"]:0;var C=e["actionTag"]!=null?e["actionTag"]:0;var S=e["visible"]!=null?e["visible"]:true;if(r!=0||s!=0)t.setPosition(cc.p(r,s));if(a!=1)t.setScaleX(a);if(o!=1)t.setScaleY(o);if(c!=0)t.setRotation(c);if(l!=0)t.setRotationX(l);if(h!=0)t.setRotationY(h);if(u!=0)t.setSkewX(u);if(d!=0)t.setSkewY(d);if(_!=.5||f!=.5)t.setAnchorPoint(cc.p(_,f));if(i!=0||n!=0)t.setContentSize(cc.size(i,n));if(y!=0)t.setLocalZOrder(y);if(S!=true)t.setVisible(S);if(p!=255){t.setOpacity(p)}if(m!=255||g!=255||v!=255){t.setColor(cc.color(m,g,v))}t.setTag(T);t.setUserObject(new ccs.ActionTimelineData(C))};r.parseComponent=function(t,e){if(!e)return;for(var i=0;i<e.length;++i){var n=e[i];var r=this.loadComponent(n);if(r){t.addComponent(r)}}};r.parseChild=function(t,e,i,n){var r=i["children"];for(var s=0;s<r.length;s++){var a=this.parseNode(r[s],n);if(a){if(e instanceof ccui.PageView){if(a instanceof ccui.Layout)e.addPage(a)}else{if(e instanceof ccui.ListView){if(a instanceof ccui.Widget)e.pushBackCustomItem(a)}else{if(!(e instanceof ccui.Layout)&&a instanceof ccui.Widget){if(a.getPositionType()===ccui.Widget.POSITION_PERCENT){var o=a.getPositionPercent();var c=e.getAnchorPoint();a.setPositionPercent(cc.p(o.x+c.x,o.y+c.y))}var l=e.getAnchorPointInPoints();a.setPosition(cc.p(a.getPositionX()+l.x,a.getPositionY()+l.y))}e.addChild(a)}}}}};r.initNode=function(t){var e=new cc.Node;this.generalAttributes(e,t);return e};r.initSubGraph=function(t){var e=t["fileName"];var i;if(e&&""!==e){i=this.createNode(e)}else{i=new ccs.Node}this.generalAttributes(i,t);return i};r.initSprite=function(t,e){var i=t["fileName"];var n;if(i!=null){var r=cc.spriteFrameCache.getSpriteFrame(i);if(!r){i=e+i;n=new ccs.Sprite(i)}else{n=ccs.Sprite.createWithSpriteFrame(r)}if(!n){n=new cc.Sprite;cc.log("filePath is empty. Create a sprite with no texture")}}else{n=new ccs.Sprite}this.generalAttributes(n,t);var s=t["flipX"];var a=t["flipY"];if(s!=false)n.setFlippedX(s);if(a!=false)n.setFlippedY(a);return n};r.initParticle=function(t,e){var i=t["plistFile"];var n=t["tmxFile"];var r=new cc.ParticleSystemQuad(i);r.setTotalParticles(n);this.generalAttributes(r,t);return r};r.initTMXTiledMap=function(t,e){var i=t["tmxFile"];var n=t["tmxString"];var r=t["resourcePath"];var s=null;if(i&&""!==i){s=new cc.TMXTiledMap(i)}else if(n&&""!==n&&r&&""!==r){s=new cc.TMXTiledMap(n,r)}return s};var s=t.getParser("ccui")["*"];r.initWidget=function(t,e){var i=t["classname"];var n=s.parsers[i];if(!n)return cc.log("%s parser is not found",i);var r=n.call(s,t,e);if(r){var a=t["rotationSkewX"];var o=t["rotationSkewY"];var c=t["skewX"];var l=t["skewY"];if(a!=0)r.setRotationX(a);if(o!=0)r.setRotationY(o);if(c!=0)r.setSkewX(c);if(l!=0)r.setSkewY(l);var h=t["actionTag"];r.setUserObject(new ccs.ActionTimelineData(h))}return r};var a=[{name:"Node",handle:r.initNode},{name:"SubGraph",handle:r.initSubGraph},{name:"Sprite",handle:r.initSprite},{name:"Particle",handle:r.initParticle},{name:"TMXTiledMap",handle:r.initTMXTiledMap},{name:"Widget",handle:r.initWidget},{name:"Panel",handle:r.initWidget},{name:"Button",handle:r.initWidget},{name:"CheckBox",handle:r.initWidget},{name:"ImageView",handle:r.initWidget},{name:"LabelAtlas",handle:r.initWidget},{name:"LabelBMFont",handle:r.initWidget},{name:"Label",handle:r.initWidget},{name:"ListView",handle:r.initWidget},{name:"LoadingBar",handle:r.initWidget},{name:"PageView",handle:r.initWidget},{name:"ScrollView",handle:r.initWidget},{name:"Slider",handle:r.initWidget},{name:"TextField",handle:r.initWidget}];a.forEach(function(t){r.registerParser(t.name,function(e,i,n){var r=t.handle.call(this,e["options"]);this.parseComponent(r,e["components"]);this.parseChild(i,r,e,n);return r})});t.registerParser("timeline","0.*",r);t.registerParser("timeline","1.*",r)})(ccs._load,ccs._parser);(function(t,e){var i=false;var n=e.extend({parse:function(t,e,i){var n;if(i!==undefined)n=i;else n=this._dirname(t);this.pretreatment(e,n,t);var r=this.parseNode(this.getNodeJson(e),n);this.deferred(e,n,r,t);return r},getNodeJson:function(t){var e=t["Content"];if(e["ObjectData"])return e["ObjectData"];return e["Content"]["ObjectData"]},getClass:function(t){return t["ctype"]}});var r=new n;var s=function(t,e){if(t===undefined)return e;else return t};r.generalAttributes=function(t,e){if(e["Name"]!=null)t.setName(e["Name"]);var i=e["Position"];if(i!=null&&(i["X"]!=null||i["Y"]!=null))t.setPosition(cc.p(i["X"]||0,i["Y"]||0));var n=e["Scale"];if(n!=null){if(n["ScaleX"]!=null)t.setScaleX(n["ScaleX"]);if(n["ScaleY"]!=null)t.setScaleY(n["ScaleY"])}var r=e["RotationSkewX"];if(r!=null)t.setRotationX(r);var a=e["RotationSkewY"];if(e["RotationSkewY"]!=null)t.setRotationY(a);var c=e["AnchorPoint"];if(c!=null){if(c["ScaleX"]==null)c["ScaleX"]=0;if(c["ScaleY"]==null)c["ScaleY"]=0;if(c["ScaleX"]!=.5||c["ScaleY"]!=.5)t.setAnchorPoint(cc.p(c["ScaleX"],c["ScaleY"]))}if(e["ZOrder"]!=null)t.setLocalZOrder(e["ZOrder"]);var l=s(e["VisibleForFrame"],true);t.setVisible(l);var h=e["Size"];if(h)f(t,h);if(e["Alpha"]!=null)t.setOpacity(e["Alpha"]);t.setTag(e["Tag"]||0);var u=e["ActionTag"]||0;var d=new ccs.ComExtensionData;var _=e["UserData"];if(_!==undefined)d.setCustomProperty(_);d.setActionTag(u);if(t.getComponent("ComExtensionData"))t.removeComponent("ComExtensionData");t.addComponent(d);t.setCascadeColorEnabled(true);t.setCascadeOpacityEnabled(true);o(t,e)};r.parseChild=function(t,e,i){if(!t||!e)return;for(var n=0;n<e.length;n++){var r=this.parseNode(e[n],i);if(r){if(t instanceof ccui.PageView){if(r instanceof ccui.Layout)t.addPage(r)}else{if(t instanceof ccui.ListView){if(r instanceof ccui.Widget)t.pushBackCustomItem(r)}else{if(!(t instanceof ccui.Layout)&&r instanceof ccui.Widget){if(r.getPositionType()===ccui.Widget.POSITION_PERCENT){var s=r.getPositionPercent();var a=t.getAnchorPoint();r.setPositionPercent(cc.p(s.x+a.x,s.y+a.y))}}t.addChild(r)}}}}};r.initSingleNode=function(t){var e=new cc.Node;this.generalAttributes(e,t);var i=t["CColor"];if(i!=null)e.setColor(_(i));return e};r.initSprite=function(t,e){var i=new cc.Sprite;d(t["FileData"],e,function(t,e){if(e===0)i.setTexture(t);else if(e===1){var n=cc.spriteFrameCache.getSpriteFrame(t);if(n)i.setSpriteFrame(n)}});var n=t["BlendFunc"];if(t["BlendFunc"]){var r=cc.BlendFunc.ALPHA_PREMULTIPLIED;if(n["Src"]!==undefined)r.src=n["Src"];if(n["Dst"]!==undefined)r.dst=n["Dst"];i.setBlendFunc(r)}if(t["FlipX"])i.setFlippedX(true);if(t["FlipY"])i.setFlippedY(true);this.generalAttributes(i,t);var s=t["CColor"];if(s!=null)i.setColor(_(s));return i};r.initParticle=function(t,e){var i,n=this;d(t["FileData"],e,function(e,r){if(!cc.loader.getRes(e))cc.log("%s need to be preloaded",e);i=new cc.ParticleSystem(e);n.generalAttributes(i,t);i.setPositionType(cc.ParticleSystem.TYPE_GROUPED);!cc.sys.isNative&&i.setDrawMode(cc.ParticleSystem.TEXTURE_MODE);var s=t["BlendFunc"];if(t["BlendFunc"]){var a=cc.BlendFunc.ALPHA_PREMULTIPLIED;if(s["Src"]!==undefined)a.src=s["Src"];if(s["Dst"]!==undefined)a.dst=s["Dst"];i.setBlendFunc(a)}});return i};r.widgetAttributes=function(t,e,i){t.setCascadeColorEnabled(true);t.setCascadeOpacityEnabled(true);t.setUnifySizeEnabled(false);t.ignoreContentAdaptWithSize(false);!i&&f(t,e["Size"]);var n=e["Name"];if(n)t.setName(n);var r=e["ActionTag"]||0;t.setActionTag(r);var c=new ccs.ComExtensionData;var l=e["UserData"];if(l!==undefined)c.setCustomProperty(l);c.setActionTag(r);if(t.getComponent("ComExtensionData"))t.removeComponent("ComExtensionData");t.addComponent(c);var h=e["RotationSkewX"];if(h)t.setRotationX(h);var u=e["RotationSkewY"];if(u)t.setRotationY(u);var d=e["FlipX"];if(d)t.setFlippedX(true);var p=e["FlipY"];if(p)t.setFlippedY(true);var m=e["zOrder"];if(m!=null)t.setLocalZOrder(m);var g=s(e["VisibleForFrame"],true);t.setVisible(g);var v=e["Alpha"];if(v!=null)t.setOpacity(v);t.setTag(e["Tag"]||0);var y=e["TouchEnable"]||false;t.setTouchEnabled(y);var T=e["CallBackType"];if(T!=null)t.setCallbackType(T);var C=e["CallBackName"];if(C)t.setCallbackName(C);var S=e["Position"];if(S!=null)t.setPosition(S["X"]||0,S["Y"]||0);var x=e["Scale"];if(x!=null){var E=s(x["ScaleX"],1);var b=s(x["ScaleY"],1);t.setScaleX(E);t.setScaleY(b)}var A=e["AnchorPoint"];if(A!=null)t.setAnchorPoint(A["ScaleX"]||0,A["ScaleY"]||0);var R=e["CColor"];if(R!=null)t.setColor(_(R));o(t,e);a(t,e)};var a=function(t,e){var i=e["CallBackType"];var n=e["CallBackName"];var r=function(e){if(typeof t[n]==="function")t[n](e)};if(i==="Click"){t.addClickEventListener(r)}else if(i==="Touch"){t.addTouchEventListener(r)}else if(i==="Event"){t.addCCSEventListener(r)}};var o=function(t,e){var i=ccui.LayoutComponent.bindLayoutComponent(t);if(!i)return;var n=e["PositionPercentXEnable"]||e["PositionPercentXEnabled"]||false;var r=e["PositionPercentYEnable"]||e["PositionPercentYEnabled"]||false;var s=0,a=0,o=e["PrePosition"];if(o!=null){s=o["X"]||0;a=o["Y"]||0}var c=e["PercentWidthEnable"]||e["PercentWidthEnabled"]||false;var l=e["PercentHeightEnable"]||e["PercentHeightEnabled"]||false;var h=0,u=0,d=e["PreSize"];if(o!=null){h=d["X"]||0;u=d["Y"]||0}var _=e["StretchWidthEnable"]||false;var f=e["StretchHeightEnable"]||false;var p=e["HorizontalEdge"];var m=e["VerticalEdge"];var g=e["LeftMargin"]||0;var v=e["RightMargin"]||0;var y=e["TopMargin"]||0;var T=e["BottomMargin"]||0;i.setPositionPercentXEnabled(n);i.setPositionPercentYEnabled(r);i.setPositionPercentX(s);i.setPositionPercentY(a);i.setPercentWidthEnabled(c);i.setPercentHeightEnabled(l);i.setPercentWidth(h);i.setPercentHeight(u);i.setPercentWidthEnabled(c||l);i.setStretchWidthEnabled(_);i.setStretchHeightEnabled(f);var C=ccui.LayoutComponent.horizontalEdge.NONE;if(p==="LeftEdge"){C=ccui.LayoutComponent.horizontalEdge.LEFT}else if(p==="RightEdge"){C=ccui.LayoutComponent.horizontalEdge.RIGHT}else if(p==="BothEdge"){C=ccui.LayoutComponent.horizontalEdge.CENTER}i.setHorizontalEdge(C);var S=ccui.LayoutComponent.verticalEdge.NONE;if(m==="TopEdge"){S=ccui.LayoutComponent.verticalEdge.TOP}else if(m==="BottomEdge"){S=ccui.LayoutComponent.verticalEdge.BOTTOM}else if(m==="BothEdge"){S=ccui.LayoutComponent.verticalEdge.CENTER}i.setVerticalEdge(S);i.setTopMargin(y);i.setBottomMargin(T);i.setLeftMargin(g);i.setRightMargin(v);i.setVerticalEdge(S);i.setTopMargin(y);i.setBottomMargin(T);i.setLeftMargin(g);i.setRightMargin(v)};var c=function(t,e,i,n){if(t.getBackGroundColorType()===2){i=i||{};n=n||{};t.setBackGroundColor(_(i),_(n))}else{e=e||{};t.setBackGroundColor(_(e))}};var l=function(t,e){var i=e["ScaleX"]||0;var n=e["ScaleY"]||0;t.setBackGroundColorVector(cc.p(i,n))};r.initPanel=function(t,e){var i=new ccui.Layout;this.widgetAttributes(i,t);var n=t["ClipAble"]||false;if(n!=null)i.setClippingEnabled(n);var r=s(t["ComboBoxIndex"],0);i.setBackGroundColorType(r);var a=s(t["BackColorAlpha"],255);if(a!=null)i.setBackGroundColorOpacity(a);var o=t["Scale9Enable"];if(o!=null)i.setBackGroundImageScale9Enabled(o);var h=s(t["Alpha"],255);i.setOpacity(h);d(t["FileData"],e,function(t,e){i.setBackGroundImage(t,e)});if(o){var u=t["Scale9OriginX"]||0;var _=t["Scale9OriginY"]||0;var p=t["Scale9Width"]||0;var m=t["Scale9Height"]||0;i.setBackGroundImageCapInsets(cc.rect(u,_,p,m));f(i,t["Size"])}else{if(!i.isIgnoreContentAdaptWithSize()){f(i,t["Size"])}}c(i,t["SingleColor"],t["FirstColor"],t["EndColor"]);l(i,t["ColorVector"]);return i};r.initText=function(t,e){var i=new ccui.Text;var n=t["TouchScaleChangeAble"];if(n!=null)i.setTouchScaleChangeEnabled(n);var r=t["LabelText"];if(r!=null)i.setString(r);var a=t["FontSize"];if(a!=null)i.setFontSize(a);var o=t["FontName"];if(o!=null)i.setFontName(o);var c=t["AreaWidth"];var l=t["areaHeight"];if(c&&l)i.setTextAreaSize(cc.size(c,l));var h=t["HorizontalAlignmentType"]||"HT_Left";switch(h){case"HT_Right":h=2;break;case"HT_Center":h=1;break;case"HT_Left":default:h=0}i.setTextHorizontalAlignment(h);var u=t["VerticalAlignmentType"]||"VT_Top";switch(u){case"VT_Bottom":u=2;break;case"VT_Center":u=1;break;case"VT_Top":default:u=0}i.setTextVerticalAlignment(u);var d=t["FontResource"];if(d!=null){var f=d["Path"];if(f!=null){if(cc.sys.isNative){o=cc.path.join(cc.loader.resPath,e,f)}else{o=f.match(/([^\/]+)\.(\S+)/);o=o?o[1]:""}i.setFontName(o)}}if(t["OutlineEnabled"]&&t["OutlineColor"]&&i.enableOutline)i.enableOutline(_(t["OutlineColor"]),s(t["OutlineSize"],1));if(t["ShadowEnabled"]&&t["ShadowColor"]&&i.enableShadow)i.enableShadow(_(t["ShadowColor"]),cc.size(s(t["ShadowOffsetX"],2),s(t["ShadowOffsetY"],-2)),t["ShadowBlurRadius"]||0);var p=t["IsCustomSize"];if(p!=null)i.ignoreContentAdaptWithSize(!p);i.setUnifySizeEnabled(false);var m=t["CColor"];t["CColor"]=null;i.setTextColor(_(m));this.widgetAttributes(i,t,i.isIgnoreContentAdaptWithSize());t["CColor"]=m;return i};r.initButton=function(t,e){var i=new ccui.Button;d(t["NormalFileData"],e,function(t,e){i.loadTextureNormal(t,e)});d(t["PressedFileData"],e,function(t,e){i.loadTexturePressed(t,e)});d(t["DisabledFileData"],e,function(t,e){i.loadTextureDisabled(t,e)});var n=s(t["Scale9Enable"],false);if(n){i.setScale9Enabled(n)}var r=t["ButtonText"];if(r!=null)i.setTitleText(r);var a=t["FontSize"];if(a!=null)i.setTitleFontSize(a);var o=t["FontName"];if(o!=null)i.setTitleFontName(o);var c=t["TextColor"];if(c!=null)i.setTitleColor(_(c));var l=s(t["DisplayState"],true);i.setBright(l);i.setEnabled(l);var h=t["FontResource"];if(h!=null){var u=h["Path"];if(u!=null){if(cc.sys.isNative){o=cc.path.join(cc.loader.resPath,e,u)}else{o=u.match(/([^\/]+)\.(\S+)/);o=o?o[1]:""}i.setTitleFontName(o)}}var p=i.getTitleRenderer();if(p&&t["ShadowEnabled"]&&t["ShadowColor"]&&p.enableShadow){p.enableShadow(_(t["ShadowColor"]),cc.size(s(t["ShadowOffsetX"],2),s(t["ShadowOffsetY"],-2)),t["ShadowBlurRadius"]||0)}if(p&&t["OutlineEnabled"]&&t["OutlineColor"]&&p.enableStroke)p.enableStroke(_(t["OutlineColor"]),s(t["OutlineSize"],1));this.widgetAttributes(i,t);if(n){i.setUnifySizeEnabled(false);i.ignoreContentAdaptWithSize(false);var m=cc.rect(t["Scale9OriginX"]||0,t["Scale9OriginY"]||0,t["Scale9Width"]||0,t["Scale9Height"]||0);i.setCapInsets(m)}f(i,t["Size"]);return i};r.initCheckBox=function(t,e){var i=new ccui.CheckBox;this.widgetAttributes(i,t);var n=[{name:"NormalBackFileData",handle:i.loadTextureBackGround},{name:"PressedBackFileData",handle:i.loadTextureBackGroundSelected},{name:"NodeNormalFileData",handle:i.loadTextureFrontCross},{name:"DisableBackFileData",handle:i.loadTextureBackGroundDisabled},{name:"NodeDisableFileData",handle:i.loadTextureFrontCrossDisabled}];n.forEach(function(n){d(t[n.name],e,function(t,e){n.handle.call(i,t,e)})});var r=s(t["CheckedState"],false);i.setSelected(r);var a=s(t["DisplayState"],true);i.setBright(a);i.setEnabled(a);return i};r.initScrollView=function(t,e){var i=new ccui.ScrollView;this.widgetAttributes(i,t);d(t["FileData"],e,function(t,e){i.setBackGroundImage(t,e)});var n=t["ClipAble"]||false;i.setClippingEnabled(n);var r=s(t["ComboBoxIndex"],0);i.setBackGroundColorType(r);var a=t["BackColorAlpha"];if(a!=null)i.setBackGroundColorOpacity(a);var o=t["Scale9Enable"];if(o){i.setBackGroundImageScale9Enabled(true);var h=t["Scale9OriginX"]||0;var u=t["Scale9OriginY"]||0;var _=t["Scale9Width"]||0;var p=t["Scale9Height"]||0;i.setBackGroundImageCapInsets(cc.rect(h,u,_,p));f(i,t["Size"])}else if(!i.isIgnoreContentAdaptWithSize()){f(i,t["Size"])}c(i,t["SingleColor"],t["FirstColor"],t["EndColor"]);l(i,t["ColorVector"]);var m=t["InnerNodeSize"];var g=cc.size(m["Width"]||0,m["Height"]||0);i.setInnerContainerSize(g);var v=0;if(t["ScrollDirectionType"]==="Vertical")v=1;if(t["ScrollDirectionType"]==="Horizontal")v=2;if(t["ScrollDirectionType"]==="Vertical_Horizontal")v=3;i.setDirection(v);var y=s(t["IsBounceEnabled"],false);i.setBounceEnabled(y);return i};r.initImageView=function(t,e){var i=new ccui.ImageView;d(t["FileData"],e,function(t,e){i.loadTexture(t,e)});d(t["ImageFileData"],e,function(t,e){i.loadTexture(t,e)});var n=t["Scale9Enable"];if(n){i.setScale9Enabled(true);i.setUnifySizeEnabled(false);i.ignoreContentAdaptWithSize(false);var r=t["Scale9OriginX"]||0;var s=t["Scale9OriginY"]||0;var a=t["Scale9Width"]||0;var o=t["Scale9Height"]||0;i.setCapInsets(cc.rect(r,s,a,o))}else f(i,t["Size"]);this.widgetAttributes(i,t);return i};r.initLoadingBar=function(t,e){var i=new ccui.LoadingBar;this.widgetAttributes(i,t);d(t["ImageFileData"],e,function(t,e){i.loadTexture(t,e)});var n=t["ProgressType"]==="Right_To_Left"?1:0;i.setDirection(n);var r=s(t["ProgressInfo"],80);if(r!=null)i.setPercent(r);return i};r.initSlider=function(t,e){var i=new ccui.Slider;var n=cc.loader;this.widgetAttributes(i,t);var r=[{name:"BackGroundData",handle:i.loadBarTexture},{name:"BallNormalData",handle:i.loadSlidBallTextureNormal},{name:"BallPressedData",handle:i.loadSlidBallTexturePressed},{name:"BallDisabledData",handle:i.loadSlidBallTextureDisabled},{name:"ProgressBarData",handle:i.loadProgressBarTexture}];r.forEach(function(r){d(t[r.name],e,function(t,e){if(e===0&&!n.getRes(t))cc.log("%s need to be preloaded",t);r.handle.call(i,t,e)})});var a=t["PercentInfo"]||0;i.setPercent(a);var o=s(t["DisplayState"],true);i.setBright(o);i.setEnabled(o);return i};r.initPageView=function(t,e){var i=new ccui.PageView;this.widgetAttributes(i,t);d(t["FileData"],e,function(t,e){i.setBackGroundImage(t,e)});var n=t["ClipAble"]||false;i.setClippingEnabled(n);var r=t["Scale9Enable"];if(r){i.setBackGroundImageScale9Enabled(true);var a=t["Scale9OriginX"]||0;var o=t["Scale9OriginY"]||0;var h=t["Scale9Width"]||0;var u=t["Scale9Height"]||0;i.setBackGroundImageCapInsets(cc.rect(a,o,h,u))}var _=s(t["ComboBoxIndex"],0);i.setBackGroundColorType(_);c(i,t["SingleColor"],t["FirstColor"],t["EndColor"]);l(i,t["ColorVector"]);var p=t["BackColorAlpha"];if(p!=null)i.setBackGroundColorOpacity(p);f(i,t["Size"]);return i};r.initListView=function(t,e){var i=new ccui.ListView;this.widgetAttributes(i,t);d(t["FileData"],e,function(t,e){i.setBackGroundImage(t,e)});var n=t["ClipAble"]||false;i.setClippingEnabled(n);var r=s(t["ComboBoxIndex"],0);i.setBackGroundColorType(r);var a=s(t["BackColorAlpha"],255);var o=t["Scale9Enable"];if(o){i.setBackGroundImageScale9Enabled(true);var h=t["Scale9OriginX"]||0;var u=t["Scale9OriginY"]||0;var _=t["Scale9Width"]||0;var p=t["Scale9Height"]||0;i.setBackGroundImageCapInsets(cc.rect(h,u,_,p))}var m=s(t["DirectionType"],ccui.ListView.DIR_HORIZONTAL);var g=s(t["VerticalType"],"Align_Left");var v=s(t["HorizontalType"],"Align_Top");if(!m){i.setDirection(ccui.ScrollView.DIR_HORIZONTAL);if(g==="Align_Bottom")i.setGravity(ccui.ListView.GRAVITY_BOTTOM);else if(g==="Align_VerticalCenter")i.setGravity(ccui.ListView.GRAVITY_CENTER_VERTICAL);else i.setGravity(ccui.ListView.GRAVITY_TOP)}else if(m==="Vertical"){i.setDirection(ccui.ScrollView.DIR_VERTICAL);if(v==="")i.setGravity(ccui.ListView.GRAVITY_LEFT);else if(v==="Align_Right")i.setGravity(ccui.ListView.GRAVITY_RIGHT);else if(v==="Align_HorizontalCenter")i.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL)}var y=s(t["IsBounceEnabled"],false);i.setBounceEnabled(y);var T=t["ItemMargin"]||0;i.setItemsMargin(T);var C=t["InnerNodeSize"];if(C!=null)i.setInnerContainerSize(cc.size(C["Widget"]||0,C["Height"]||0));c(i,t["SingleColor"],t["FirstColor"],t["EndColor"]);l(i,t["ColorVector"]);if(a!=null)i.setBackGroundColorOpacity(a);f(i,t["Size"]);return i};r.initTextAtlas=function(t,e){var i=new ccui.TextAtlas;var n=t["LabelText"];var r=t["CharWidth"];var s=t["CharHeight"];var a=t["StartChar"];d(t["LabelAtlasFileImage_CNB"],e,function(t,e){if(!cc.loader.getRes(t))cc.log("%s need to be preloaded",t);if(e===0){i.setProperty(n,t,r,s,a)}});this.widgetAttributes(i,t);return i};r.initTextBMFont=function(t,e){var i=new ccui.TextBMFont;this.widgetAttributes(i,t);var n=t["LabelText"];i.setString(n);d(t["LabelBMFontFile_CNB"],e,function(t,e){if(!cc.loader.getRes(t))cc.log("%s need to be pre loaded",t);i.setFntFile(t)});i.ignoreContentAdaptWithSize(true);return i};r.initTextField=function(t,e){var i=new ccui.TextField;var n=t["PasswordEnable"];if(n){i.setPasswordEnabled(true);var r=t["PasswordStyleText"]||"*";i.setPasswordStyleText(r)}var s=t["PlaceHolderText"];if(s!=null)i.setPlaceHolder(s);var a=t["FontSize"];if(a!=null)i.setFontSize(a);var o=t["FontName"];if(o!=null)i.setFontName(o);var c=t["MaxLengthEnable"];if(c){i.setMaxLengthEnabled(true);var l=t["MaxLengthText"]||0;i.setMaxLength(l)}this.widgetAttributes(i,t);var h=t["LabelText"];if(h!=null)i.setString(h);var u=t["FontResource"];if(u!=null){var d=u["Path"];if(d!=null){if(cc.sys.isNative){o=cc.path.join(cc.loader.resPath,e,d)}else{o=d.match(/([^\/]+)\.(\S+)/);o=o?o[1]:""}i.setFontName(o)}}i.setUnifySizeEnabled(false);i.ignoreContentAdaptWithSize(false);var p=t["CColor"];if(p!=null)i.setTextColor(_(p));if(!i.isIgnoreContentAdaptWithSize()){f(i,t["Size"]);if(cc.sys.isNative)i.getVirtualRenderer().setLineBreakWithoutSpace(true)}return i};r.initSimpleAudio=function(t,e){var i=new ccs.ComAudio;var n=t["Loop"]||false;i.setLoop(n);d(t["FileData"],e,function(t,e){i.setFile(t)})};r.initGameMap=function(t,e){var i=null;d(t["FileData"],e,function(e,n){if(n===0)i=new cc.TMXTiledMap(e);r.generalAttributes(i,t)});return i};r.initProjectNode=function(t,e){var i=t["FileData"];if(i!=null&&i["Path"]){var n=e+i["Path"];if(cc.loader.getRes(n)){var s=ccs.load(n,e);r.generalAttributes(s.node,t);if(s.action&&s.node){s.action.tag=s.node.tag;var a=t["InnerActionSpeed"];if(a!==undefined)s.action.setTimeSpeed(a);s.node.runAction(s.action);s.action.gotoFrameAndPause(0)}return s.node}else cc.log("%s need to be preloaded",n)}};var h=function(t){if(!t)return"";var e=t.match(/([^\/]+)\.[^\/]+$/);if(e&&e[1])return e[1];else return""};r.initArmature=function(t,e){var i=new ccs.Armature;var n=t["IsLoop"];var s=t["IsAutoPlay"];var a=t["CurrentAnimationName"];d(t["FileData"],e,function(t,e){var r,o;var c=cc.loader.getRes(t);if(!c)cc.log("%s need to be preloaded",t);else{r=c["config_file_path"];o=c["config_png_path"];r.forEach(function(t,e){if(o[e])cc.spriteFrameCache.addSpriteFrames(t,o[e])})}ccs.armatureDataManager.addArmatureFileInfo(t);i.init(h(t));if(s)i.getAnimation().play(a,-1,n);else{i.getAnimation().play(a);i.getAnimation().gotoAndPause(0)}});delete t["AnchorPoint"];delete t["Size"];r.generalAttributes(i,t);i.setColor(_(t["CColor"]));return i};r.initBoneNode=function(t,e){var i=new ccs.BoneNode;var n=t["Length"];if(n!==undefined)i.setDebugDrawLength(n);var s=t["BlendFunc"];if(s&&s["Src"]!==undefined&&s["Dst"]!==undefined)i.setBlendFunc(new cc.BlendFunc(s["Src"],s["Dst"]));r.generalAttributes(i,t);var a=t["CColor"];if(a&&(a["R"]!==undefined||a["G"]!==undefined||a["B"]!==undefined))i.setColor(_(a));return i};r.initSkeletonNode=function(t){var e=new ccs.SkeletonNode;r.generalAttributes(e,t);var i=t["CColor"];if(i&&(i["R"]!==undefined||i["G"]!==undefined||i["B"]!==undefined))e.setColor(_(i));return e};var u={};var d=function(t,e,i){if(t!=null){var n=t["Path"];var r;if(t["Type"]==="Default"||t["Type"]==="Normal")r=0;else r=1;var s=t["Plist"];if(s){if(cc.loader.getRes(e+s)){u[e+s]=true;cc.spriteFrameCache.addSpriteFrames(e+s)}else{if(!u[e+s]&&!cc.spriteFrameCache.getSpriteFrame(n))cc.log("%s need to be preloaded",e+s)}}if(r!==0){if(cc.spriteFrameCache.getSpriteFrame(n))i(n,r);else cc.log("failed to get spriteFrame: %s",n)}else i(e+n,r)}};var _=function(t){if(!t)return;var e=t["R"]!=null?t["R"]:255;var i=t["G"]!=null?t["G"]:255;var n=t["B"]!=null?t["B"]:255;var r=t["A"]!=null?t["A"]:255;return cc.color(e,i,n,r)};var f=function(t,e){var i=e["X"]||0;var n=e["Y"]||0;if(e)t.setContentSize(cc.size(i,n))};var p=[{name:"SingleNodeObjectData",handle:r.initSingleNode},{name:"NodeObjectData",handle:r.initSingleNode},{name:"LayerObjectData",handle:r.initSingleNode},{name:"GameNodeObjectData",handle:r.initSingleNode},{name:"GameLayerObjectData",handle:r.initSingleNode},{name:"SpriteObjectData",handle:r.initSprite},{name:"ParticleObjectData",handle:r.initParticle},{name:"PanelObjectData",handle:r.initPanel},{name:"TextObjectData",handle:r.initText},{name:"ButtonObjectData",handle:r.initButton},{name:"CheckBoxObjectData",handle:r.initCheckBox},{name:"ScrollViewObjectData",handle:r.initScrollView},{name:"ImageViewObjectData",handle:r.initImageView},{name:"LoadingBarObjectData",handle:r.initLoadingBar},{name:"SliderObjectData",handle:r.initSlider},{name:"PageViewObjectData",
handle:r.initPageView},{name:"ListViewObjectData",handle:r.initListView},{name:"TextAtlasObjectData",handle:r.initTextAtlas},{name:"TextBMFontObjectData",handle:r.initTextBMFont},{name:"TextFieldObjectData",handle:r.initTextField},{name:"SimpleAudioObjectData",handle:r.initSimpleAudio},{name:"GameMapObjectData",handle:r.initGameMap},{name:"ProjectNodeObjectData",handle:r.initProjectNode},{name:"ArmatureNodeObjectData",handle:r.initArmature},{name:"BoneNodeObjectData",handle:r.initBoneNode},{name:"SkeletonNodeObjectData",handle:r.initSkeletonNode}];p.forEach(function(t){r.registerParser(t.name,function(e,n){var r=t.handle.call(this,e,n);this.parseChild(r,e["Children"],n);i&&r&&(r.__parserName=t.name);return r})});t.registerParser("timeline","*",r)})(ccs._load,ccs._parser);(function(t,e){var i=e.extend({addSpriteFrame:function(t,e){if(!t)return;for(var i=0;i<t.length;i++){cc.spriteFrameCache.addSpriteFrames(e+t[i])}},pretreatment:function(t,e){this.addSpriteFrame(t["textures"],e)},deferred:function(t,e,i,n){if(i){ccs.actionManager.initWithDictionary(n,t["animation"],i);i.setContentSize(cc.size(t["designWidth"],t["designHeight"]))}}});var n=new i;n.generalAttributes=function(t,e){var i=e["ignoreSize"];if(i!=null)t.ignoreContentAdaptWithSize(i);if(e["sizeType"]){t.setSizeType(e["sizeType"])}if(e["positionType"]){t.setPositionType(e["positionType"])}t.setSizePercent(cc.p(e["sizePercentX"],e["sizePercentY"]));t.setPositionPercent(cc.p(e["positionPercentX"],e["positionPercentY"]));var n=0,r=0;var s=e["adaptScreen"];if(s){var a=cc.director.getWinSize();n=a.width;r=a.height}else{n=e["width"];r=e["height"]}t.setContentSize(n,r);t.setTag(e["tag"]);t.setActionTag(e["actiontag"]);t.setTouchEnabled(e["touchAble"]);var o=e["name"];var c=o?o:"default";t.setName(c);var l=e["x"];var h=e["y"];t.setPosition(l,h);var u=e["scaleX"]!=null?e["scaleX"]:1;t.setScaleX(u);var d=e["scaleY"]!=null?e["scaleY"]:1;t.setScaleY(d);var _=e["rotation"]||0;t.setRotation(_);var f=e["visible"]||false;if(f!=null)t.setVisible(f);t.setLocalZOrder(e["ZOrder"]);var p=e["layoutParameter"];if(p!=null){var m=e["layoutParameter"];var g=m["type"];var v=null;switch(g){case 0:break;case 1:v=new ccui.LinearLayoutParameter;var y=m["gravity"];v.setGravity(y);break;case 2:v=new ccui.RelativeLayoutParameter;var T=v;var C=m["relativeName"];T.setRelativeName(C);var S=m["relativeToName"];T.setRelativeToWidgetName(S);var x=m["align"];T.setAlign(x);break;default:break}if(v!=null){var E=m["marginLeft"]||0;var b=m["marginTop"]||0;var A=m["marginRight"]||0;var R=m["marginDown"]||0;v.setMargin(E,b,A,R);t.setLayoutParameter(v)}}};n.colorAttributes=function(t,e){var i=e["opacity"];if(i!=null)t.setOpacity(i);var n=e["colorR"];var r=e["colorG"];var s=e["colorB"];t.setColor(cc.color(n==null?255:n,r==null?255:r,s==null?255:s));t.setFlippedX(e["flipX"]);t.setFlippedY(e["flipY"])};n.anchorPointAttributes=function(t,e){var i=e["anchorPointX"];var n;if(i!=null)n=e["anchorPointX"];else n=t.getAnchorPoint().x;var r=e["anchorPointY"];var s;if(r!=null)s=e["anchorPointY"];else s=t.getAnchorPoint().y;if(i!=null||r!=null)t.setAnchorPoint(cc.p(n,s))};n.parseChild=function(t,e,i){var n=e["children"];for(var r=0;r<n.length;r++){var s=this.parseNode(n[r],i);if(s){if(t instanceof ccui.PageView)t.addPage(s);else{if(t instanceof ccui.ListView){t.pushBackCustomItem(s)}else{if(!(t instanceof ccui.Layout)){if(s.getPositionType()===ccui.Widget.POSITION_PERCENT){var a=s.getPositionPercent();var o=t.getAnchorPoint();s.setPositionPercent(cc.p(a.x+o.x,a.y+o.y))}var c=t.getAnchorPointInPoints();s.setPosition(cc.p(s.getPositionX()+c.x,s.getPositionY()+c.y))}t.addChild(s)}}}}};var r=function(t,e,i,n){if(i){if(e===0)n(t+i,e);else n(i,e)}};n.LayoutAttributes=function(t,e,i){var n=0,s=0;var a=e["adaptScreen"];if(a){var o=cc.director.getWinSize();n=o.width;s=o.height}else{n=e["width"];s=e["height"]}t.setSize(cc.size(n,s));t.setClippingEnabled(e["clipAble"]);var c=e["backGroundScale9Enable"];t.setBackGroundImageScale9Enabled(c);var l=e["bgColorR"];var h=e["bgColorG"];var u=e["bgColorB"];var d=e["bgStartColorR"];var _=e["bgStartColorG"];var f=e["bgStartColorB"];var p=e["bgEndColorR"];var m=e["bgEndColorG"];var g=e["bgEndColorB"];var v=e["vectorX"];var y=e["vectorY"];t.setBackGroundColorVector(cc.p(v,y));var T=e["bgColorOpacity"];var C=e["colorType"];t.setBackGroundColorType(C);t.setBackGroundColor(cc.color(d,_,f),cc.color(p,m,g));t.setBackGroundColor(cc.color(l,h,u));t.setBackGroundColorOpacity(T);var S=e["backGroundImageData"];if(S){r(i,S["resourceType"],S["path"],function(e,i){t.setBackGroundImage(e,i)})}if(c){var x=e["capInsetsX"];var E=e["capInsetsY"];var b=e["capInsetsWidth"];var A=e["capInsetsHeight"];t.setBackGroundImageCapInsets(cc.rect(x,E,b,A))}if(e["layoutType"]){t.setLayoutType(e["layoutType"])}};n.ButtonAttributes=function(t,e,i){var n=t;var s=e["scale9Enable"];n.setScale9Enabled(s);var a=e["normalData"];r(i,a["resourceType"],a["path"],function(t,e){n.loadTextureNormal(t,e)});var o=e["pressedData"];r(i,o["resourceType"],o["path"],function(t,e){n.loadTexturePressed(t,e)});var c=e["disabledData"];r(i,c["resourceType"],c["path"],function(t,e){n.loadTextureDisabled(t,e)});if(s){var l=e["capInsetsX"];var h=e["capInsetsY"];var u=e["capInsetsWidth"];var d=e["capInsetsHeight"];n.setCapInsets(cc.rect(l,h,u,d));var _=e["scale9Width"];var f=e["scale9Height"];if(_!=null&&f!=null)n.setSize(cc.size(_,f))}var p=e["text"];if(p!=null)n.setTitleText(p);var m=e["textColorR"];var g=e["textColorG"];var v=e["textColorB"];var y=m!==null?e["textColorR"]:255;var T=g!==null?e["textColorG"]:255;var C=v!==null?e["textColorB"]:255;n.setTitleColor(cc.color(y,T,C));var S=e["fontSize"];if(S!=null)n.setTitleFontSize(e["fontSize"]);var x=e["fontName"];if(x)n.setTitleFontName(e["fontName"])};n.CheckBoxAttributes=function(t,e,i){var n=e["backGroundBoxData"];r(i,n["resourceType"],n["path"],function(e,i){t.loadTextureBackGround(e,i)});var s=e["backGroundBoxSelectedData"];r(i,s["resourceType"]||n["resourceType"],s["path"]||n["path"],function(e,i){t.loadTextureBackGroundSelected(e,i)});var a=e["frontCrossData"];r(i,a["resourceType"],a["path"],function(e,i){t.loadTextureFrontCross(e,i)});var o=e["backGroundBoxDisabledData"];r(i,o["resourceType"]||a["resourceType"],o["path"]||a["path"],function(e,i){t.loadTextureBackGroundDisabled(e,i)});var c=e["frontCrossDisabledData"];r(i,c["resourceType"],c["path"],function(e,i){t.loadTextureFrontCrossDisabled(e,i)});if(e["selectedState"])t.setSelected(e["selectedState"])};n.ImageViewAttributes=function(t,e,i){var n=e["fileNameData"];r(i,n["resourceType"],n["path"],function(e,i){t.loadTexture(e,i)});var s=e["scale9Enable"];var a=false;if(s){a=e["scale9Enable"]}t.setScale9Enabled(a);if(a){var o=e["scale9Width"];var c=e["scale9Height"];if(o&&c){var l=e["scale9Width"];var h=e["scale9Height"];t.setSize(cc.size(l,h))}var u=e["capInsetsX"];var d=e["capInsetsY"];var _=e["capInsetsWidth"];var f=e["capInsetsHeight"];t.setCapInsets(cc.rect(u,d,_,f))}};n.TextAtlasAttributes=function(t,e,i){var n=e["stringValue"];var r=e["charMapFileData"];var s=e["itemWidth"];var a=e["itemHeight"];var o=e["startCharMap"];if(n!=null&&r&&s!=null&&a!=null&&o!=null){var c=e["charMapFileData"];var l=c["resourceType"];switch(l){case 0:var h=i;var u=c["path"];var d=h+u;t.setProperty(n,d,s,a,o);break;case 1:cc.log("Wrong res type of LabelAtlas!");break;default:break}}};n.TextBMFontAttributes=function(t,e,i){var n=e["fileNameData"];var r=n["resourceType"];switch(r){case 0:var s=i;var a=n["path"];var o=s+a;t.setFntFile(o);break;case 1:cc.log("Wrong res type of LabelAtlas!");break;default:break}var c=e["text"];t.setString(c)};var s=/\.ttf$/;n.TextAttributes=function(t,e,i){var n=e["touchScaleEnable"];t.setTouchScaleChangeEnabled(n);var r=e["text"];t.setString(r);var a=e["fontSize"];if(a!=null){t.setFontSize(e["fontSize"])}var o=e["fontName"];if(o!=null){if(cc.sys.isNative){if(s.test(o)){t.setFontName(cc.path.join(cc.loader.resPath,i,o))}else{t.setFontName(o)}}else{t.setFontName(o.replace(s,""))}}var c=e["areaWidth"];var l=e["areaHeight"];if(c!=null&&l!=null){var h=cc.size(e["areaWidth"],e["areaHeight"]);t.setTextAreaSize(h)}var u=e["hAlignment"];if(u!=null){t.setTextHorizontalAlignment(e["hAlignment"])}var d=e["vAlignment"];if(d!=null){t.setTextVerticalAlignment(e["vAlignment"])}};n.ListViewAttributes=function(t,e,i){n.ScrollViewAttributes(t,e,i);var r=e["direction"];t.setDirection(r);var s=e["gravity"];t.setGravity(s);var a=e["itemMargin"];t.setItemsMargin(a)};n.LoadingBarAttributes=function(t,e,i){var n=e["textureData"];r(i,n["resourceType"],n["path"],function(e,i){t.loadTexture(e,i)});var s=e["scale9Enable"];t.setScale9Enabled(s);if(s){var a=e["capInsetsX"];var o=e["capInsetsY"];var c=e["capInsetsWidth"];var l=e["capInsetsHeight"];t.setCapInsets(cc.rect(a,o,c,l));var h=e["width"];var u=e["height"];t.setSize(cc.size(h,u))}t.setDirection(e["direction"]);t.setPercent(e["percent"])};n.PageViewAttributes=n.LayoutAttributes;n.ScrollViewAttributes=function(t,e,i){n.LayoutAttributes(t,e,i);var r=e["innerWidth"]!=null?e["innerWidth"]:200;var s=e["innerHeight"]!=null?e["innerHeight"]:200;t.setInnerContainerSize(cc.size(r,s));var a=e["direction"]!=null?e["direction"]:1;t.setDirection(a);t.setBounceEnabled(e["bounceEnable"])};n.SliderAttributes=function(t,e,i){var n=t;var s=e["scale9Enable"];n.setScale9Enabled(s);var a=e["barFileName"];var o=e["length"];var c=e["barFileNameData"];var l=c["resourceType"];var h=c["path"];if(a!=null){if(s){r(i,l,h,function(t,e){n.loadBarTexture(t,e)});n.setSize(cc.size(o,n.getContentSize().height))}}else{r(i,l,h,function(t,e){n.loadBarTexture(t,e)})}var u=e["ballNormalData"];r(i,u["resourceType"],u["path"],function(t,e){n.loadSlidBallTextureNormal(t,e)});var d=e["ballPressedData"];r(i,d["resourceType"]||u["resourceType"],d["path"]||u["path"],function(t,e){n.loadSlidBallTexturePressed(t,e)});var _=e["ballDisabledData"];r(i,_["resourceType"],_["path"],function(t,e){n.loadSlidBallTextureDisabled(t,e)});var f=e["progressBarData"];r(i,f["resourceType"],f["path"],function(t,e){n.loadProgressBarTexture(t,e)})};n.TextFieldAttributes=function(t,e,i){var n=e["placeHolder"];if(n)t.setPlaceHolder(n);t.setString(e["text"]||"");var r=e["fontSize1"];if(r)t.setFontSize(r);var a=e["fontName"];if(a!=null){if(cc.sys.isNative){if(s.test(a)){t.setFontName(cc.path.join(cc.loader.resPath,i,a))}else{t.setFontName(a)}}else{t.setFontName(a.replace(s,""))}}var o=e["touchSizeWidth"];var c=e["touchSizeHeight"];if(o!=null&&c!=null)t.setTouchSize(o,c);var l=e["width"];var h=e["height"];if(l>0||h>0){}var u=e["maxLengthEnable"];t.setMaxLengthEnabled(u);if(u){var d=e["maxLength"];t.setMaxLength(d)}var _=e["passwordEnable"];t.setPasswordEnabled(_);if(_)t.setPasswordStyleText(e["passwordStyleText"]);var f=e["areaWidth"];var p=e["areaHeight"];if(f&&p){var m=cc.size(f,p);t.setTextAreaSize(m)}var g=e["hAlignment"];if(g)t.setTextHorizontalAlignment(g);var v=e["vAlignment"];if(v)t.setTextVerticalAlignment(v);var y=e["colorR"];var T=e["colorG"];var C=e["colorB"];if(y!==undefined&&T!==undefined&&C!==undefined){t.setTextColor(cc.color(y,T,C))}};var a=[{name:"Panel",object:ccui.Layout,handle:n.LayoutAttributes},{name:"Button",object:ccui.Button,handle:n.ButtonAttributes},{name:"CheckBox",object:ccui.CheckBox,handle:n.CheckBoxAttributes},{name:"ImageView",object:ccui.ImageView,handle:n.ImageViewAttributes},{name:"LabelAtlas",object:ccui.TextAtlas,handle:n.TextAtlasAttributes},{name:"LabelBMFont",object:ccui.TextBMFont,handle:n.TextBMFontAttributes},{name:"Label",object:ccui.Text,handle:n.TextAttributes},{name:"ListView",object:ccui.ListView,handle:n.ListViewAttributes},{name:"LoadingBar",object:ccui.LoadingBar,handle:n.LoadingBarAttributes},{name:"PageView",object:ccui.PageView,handle:n.PageViewAttributes},{name:"ScrollView",object:ccui.ScrollView,handle:n.ScrollViewAttributes},{name:"Slider",object:ccui.Slider,handle:n.SliderAttributes},{name:"TextField",object:ccui.TextField,handle:n.TextFieldAttributes}];a.forEach(function(t){n.registerParser(t.name,function(e,i){var r=new t.object;var s=e["options"];n.generalAttributes(r,s);t.handle(r,s,i);n.colorAttributes(r,s);n.anchorPointAttributes(r,s);n.parseChild.call(this,r,e,i);return r})});t.registerParser("ccui","*",n)})(ccs._load,ccs._parser);(function(){ccs.uiReader={_fileDesignSizes:{},widgetFromJsonFile:function(t){var e=cc.loader.getRes(t);if(e)this._fileDesignSizes[t]=cc.size(e["designWidth"]||0,e["designHeight"]||0);var i=e["Version"]||e["version"];var n=ccs.uiReader.getVersionInteger(i);if(!i||n>=1700){cc.warn("Not supported file types, Please try use the ccs.load");return null}return ccs._load(t,"ccui")},registerTypeAndCallBack:function(t,e,i,n){var r=ccs._load.getParser("ccui")["*"];var s=n.bind(i);r.registerParser(t,function(n,r){var a=new e;var o=n["options"];i.setPropsFromJsonDictionary&&i.setPropsFromJsonDictionary(a,o);this.generalAttributes(a,o);var c=o["customProperty"];if(c)c=JSON.parse(c);else c={};s(t,a,c);this.colorAttributes(a,o);this.anchorPointAttributes(a,o);this.parseChild.call(this,a,n,r);return a})},getVersionInteger:function(t){if(!t||typeof t!=="string")return 0;var e=t.split(".");if(e.length!==4)return 0;var i=0;e.forEach(function(t,e){i+=t*Math.pow(10,3-e)});return i},storeFileDesignSize:function(t,e){this._fileDesignSizes[t]=e},getFileDesignSize:function(t){return this._fileDesignSizes[t]},getFilePath:function(){return this._filePath},setFilePath:function(t){this._filePath=t},getParseObjectMap:function(){return ccs._load.getParser("ccui")["*"]["parsers"]},getParseCallBackMap:function(){return ccs._load.getParser("ccui")["*"]["parsers"]},clear:function(){}};var t=ccs._load.getParser("ccui")["*"];ccs.imageViewReader={setPropsFromJsonDictionary:t.ImageViewAttributes};ccs.buttonReader={setPropsFromJsonDictionary:t.ButtonAttributes};ccs.checkBoxReader={setPropsFromJsonDictionary:t.CheckBoxAttributes};ccs.labelAtlasReader={setPropsFromJsonDictionary:t.TextAtlasAttributes};ccs.labelBMFontReader={setPropsFromJsonDictionary:t.TextBMFontAttributes};ccs.labelReader={setPropsFromJsonDictionary:t.TextAttributes};ccs.layoutReader={setPropsFromJsonDictionary:t.LayoutAttributes};ccs.listViewReader={setPropsFromJsonDictionary:t.ListViewAttributes};ccs.loadingBarReader={setPropsFromJsonDictionary:t.LoadingBarAttributes};ccs.pageViewReader={setPropsFromJsonDictionary:t.PageViewAttributes};ccs.scrollViewReader={setPropsFromJsonDictionary:t.ScrollViewAttributes};ccs.sliderReader={setPropsFromJsonDictionary:t.SliderAttributes};ccs.textFieldReader={setPropsFromJsonDictionary:t.TextFieldAttributes}})();(function(){ccs.sceneReader={_node:null,createNodeWithSceneFile:function(t){var e=ccs._load(t,"scene");this._node=e;return e},getNodeByTag:function(t){if(this._node==null)return null;if(this._node.getTag()===t)return this._node;return this._nodeByTag(this._node,t)},_nodeByTag:function(t,e){if(t==null)return null;var i=null;var n=t.getChildren();for(var r=0;r<n.length;r++){var s=n[r];if(s&&s.getTag()===e){i=s;break}else{i=this._nodeByTag(s,e);if(i)break}}return i},version:function(){return"*"},setTarget:function(){},clear:function(){ccs.triggerManager.removeAll();cc.audioEngine.end()}}})();(function(){ccs.Skin.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t)};var t=ccs.Skin.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,t);t.constructor=ccs.Skin.WebGLRenderCmd;t.updateTransform=function(){var t=this._node;var e=this._quad;if(!t._visible)e.br.vertices=e.tl.vertices=e.tr.vertices=e.bl.vertices={x:0,y:0,z:0};else{var i=this.getNodeToParentTransform();var n=t._rect;var r=t._offsetPosition.x,s=t._offsetPosition.y;var a=r+n.width,o=s+n.height;var c=i.tx,l=i.ty;var h=i.a,u=i.b;var d=i.d,_=-i.c;var f=r*h-s*_+c;var p=r*u+s*d+l;var m=a*h-s*_+c;var g=a*u+s*d+l;var v=a*h-o*_+c;var y=a*u+o*d+l;var T=r*h-o*_+c;var C=r*u+o*d+l;var S=t._vertexZ;if(!cc.SPRITEBATCHNODE_RENDER_SUBPIXEL){f=0|f;p=0|p;m=0|m;g=0|g;v=0|v;y=0|y;T=0|T;C=0|C}this.SET_VERTEX3F(e.bl.vertices,f,p,S);this.SET_VERTEX3F(e.br.vertices,m,g,S);this.SET_VERTEX3F(e.tl.vertices,T,C,S);this.SET_VERTEX3F(e.tr.vertices,v,y,S)}if(t.textureAtlas)t.textureAtlas.updateQuad(e,t.textureAtlas.getTotalQuads());this._quadDirty=true};t.SET_VERTEX3F=function(t,e,i,n){t.x=e;t.y=i;t.z=n};t.rendering=function(t){var e=this._node;if(!e._textureLoaded)return;var i=t||cc._renderContext,n=e._texture;if(n&&n._textureLoaded){this._shaderProgram.use();this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);cc.glBindTexture2DN(0,n);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);i.bindBuffer(i.ARRAY_BUFFER,this._quadWebBuffer);if(this._quadDirty){i.bufferData(i.ARRAY_BUFFER,this._quad.arrayBuffer,i.DYNAMIC_DRAW);this._quadDirty=false}i.vertexAttribPointer(0,3,i.FLOAT,false,24,0);i.vertexAttribPointer(1,4,i.UNSIGNED_BYTE,true,24,12);i.vertexAttribPointer(2,2,i.FLOAT,false,24,16);i.drawArrays(i.TRIANGLE_STRIP,0,4)}cc.g_NumberOfDraws++;if(cc.SPRITE_DEBUG_DRAW===0&&!e._showNode)return;if(cc.SPRITE_DEBUG_DRAW===1||e._showNode){var r=this._quad;var s=[cc.p(r.tl.vertices.x,r.tl.vertices.y),cc.p(r.bl.vertices.x,r.bl.vertices.y),cc.p(r.br.vertices.x,r.br.vertices.y),cc.p(r.tr.vertices.x,r.tr.vertices.y)];cc._drawingUtil.drawPoly(s,4,true)}else if(cc.SPRITE_DEBUG_DRAW===2){var a=e.getTextureRect();var o=e.getOffsetPosition();var c=[cc.p(o.x,o.y),cc.p(o.x+a.width,o.y),cc.p(o.x+a.width,o.y+a.height),cc.p(o.x,o.y+a.height)];cc._drawingUtil.drawPoly(c,4,true)}}})();(function(){ccs.Armature.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this._realAnchorPointInPoints=new cc.Point(0,0)};var t=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,t);t.constructor=ccs.Armature.WebGLRenderCmd;t.rendering=function(t,e){var i=this._node;if(!e){cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPushMatrix();cc.kmGLLoadMatrix(this._stackMatrix)}var n=i._children;var r=cc.BlendFunc.ALPHA_PREMULTIPLIED,s=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED;for(var a=0,o=n.length;a<o;a++){var c=n[a];if(c&&c.getDisplayRenderNode){var l=c.getDisplayRenderNode();if(null===l)continue;l.setShaderProgram(this._shaderProgram);switch(c.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(l instanceof ccs.Skin){this._updateColorAndOpacity(l._renderCmd,c);l.updateTransform();var h=c.getBlendFunc();if(h.src!==r.src||h.dst!==r.dst)l.setBlendFunc(c.getBlendFunc());else{if(i._blendFunc.src===r.src&&i._blendFunc.dst===r.dst&&!l.getTexture().hasPremultipliedAlpha())l.setBlendFunc(s);else l.setBlendFunc(i._blendFunc)}l._renderCmd.rendering(t)}break;case ccs.DISPLAY_TYPE_ARMATURE:l._renderCmd.rendering(t,true);break;default:l._renderCmd.transform();l._renderCmd.rendering(t);break}}else if(c instanceof cc.Node){c.setShaderProgram(this._shaderProgram);c._renderCmd.transform();if(c._renderCmd.rendering)c._renderCmd.rendering(t)}}if(!e)cc.kmGLPopMatrix()};t.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};t.setShaderProgram=function(t){this._shaderProgram=t};t._updateColorAndOpacity=function(t,e){var i=e._renderCmd._displayedColor,n=e._renderCmd._displayedOpacity;var r=cc.Node._dirtyFlags,s=t._dirtyFlag;var a=s&r.colorDirty,o=s&r.opacityDirty;if(a)t._updateDisplayColor(i);if(o)t._updateDisplayOpacity(n);if(a||o)t._updateColor()};t.updateChildPosition=function(t,e,i,n,r){var s=this._node;e.updateTransform();var a=i.getBlendFunc();if(a.src!==n.src||a.dst!==n.dst)e.setBlendFunc(i.getBlendFunc());else{if(s._blendFunc.src===n.src&&node_blendFunc.dst===n.dst&&!e.getTexture().hasPremultipliedAlpha())e.setBlendFunc(r);else e.setBlendFunc(s._blendFunc)}e.rendering(t)};t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;var i=e&t.colorDirty,n=e&t.opacityDirty;if(i)this._updateDisplayColor();if(n)this._updateDisplayOpacity();if(i||n)this._updateColor();if(e&t.orderDirty)this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag;this.transform(this.getParentRenderCmd(),true)};t.visit=function(t){var e=this._node;if(!e._visible)return;var i=cc.current_stack;i.stack.push(i.top);this.updateStatus(t);i.top=this._stackMatrix;e.sortAllChildren();cc.renderer.pushRenderCommand(this);this._dirtyFlag=0;i.top=i.stack.pop()}})();cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=t._running===undefined?false:!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=t.constructor.prototype.__pid;if(!e){var i={writable:true,enumerable:false,configurable:true};i.value=ClassManager.getNewID();Object.defineProperty(t.constructor.prototype,"__pid",i)}if(!this._pool[e]){this._pool[e]=[]}t.retain&&t.retain();t.unuse&&t.unuse();this._pool[e].push(t)},hasObject:function(t){var e=t.prototype.__pid;var i=this._pool[e];if(!i||i.length===0){return false}return true},removeObject:function(t){var e=t.constructor.prototype.__pid;if(e){var i=this._pool[e];if(i){for(var n=0;n<i.length;n++){if(t===i[n]){t.release&&t.release();i.splice(n,1)}}}}},getFromPool:function(t){if(this.hasObject(t)){var e=t.prototype.__pid;var i=this._pool[e];var n=Array.prototype.slice.call(arguments);n.shift();var r=i.pop();r.reuse&&r.reuse.apply(r,n);cc.sys.isNative&&r.release&&this._autoRelease(r);return r}},drainAllPools:function(){for(var t in this._pool){for(var e=0;e<this._pool[t].length;e++){var i=this._pool[t][e];i.release&&i.release()}}this._pool={}}};(function(){if(cc===undefined){return}var PluginManager=function(){};PluginManager.prototype={constructor:PluginManager,getInstance:function(){return this},loadPlugin:function(t){},unloadPlugin:function(t){}};var PluginAssembly=function(){};PluginAssembly.prototype={constructor:PluginAssembly,setDebugMode:function(t){},startSession:function(t){},setCaptureUncaughtException:function(t){},callFuncWithParam:function(t){if(typeof this[t]==="function"){return this[t].apply(this,Array.prototype.splice.call(arguments,1))}else{cc.log("function is not define")}},callStringFuncWithParam:function(t){this.callFuncWithParam.apply(arguments)},getPluginName:function(){return this._name},getPluginVersion:function(){return this._version}};PluginAssembly.extend=function(name,porp){var p,prototype={};for(p in PluginAssembly.prototype){prototype[p]=PluginAssembly.prototype[p]}for(p in porp){prototype[p]=porp[p]}var tmp=eval("(function "+name+"Plugin(){})");prototype.constructor=tmp;tmp.prototype=prototype;return tmp};var Param=function(t,e){var i=plugin.PluginParam.ParamType,n;switch(t){case i.TypeInt:n=parseInt(e);break;case i.TypeFloat:n=parseFloat(e);break;case i.TypeBool:n=Boolean(e);break;case i.TypeString:n=String(e);break;case i.TypeStringMap:n=e;break;default:n=e}return n};Param.ParamType={TypeInt:1,TypeFloat:2,TypeBool:3,TypeString:4,TypeStringMap:5};Param.AdsResultCode={AdsReceived:0,FullScreenViewShown:1,FullScreenViewDismissed:2,PointsSpendSucceed:3,PointsSpendFailed:4,NetworkError:5,UnknownError:6};Param.PayResultCode={PaySuccess:0,PayFail:1,PayCancel:2,PayTimeOut:3};Param.ShareResultCode={ShareSuccess:0,ShareFail:1,ShareCancel:2,ShareTimeOut:3};var PluginList={};var Plugin={extend:function(t,e){var i=cc.game.config&&cc.game.config.plugin||{};PluginList[t]=new(PluginAssembly.extend(t,e));typeof PluginList[t].ctor==="function"&&PluginList[t].ctor(i[t])},PluginList:PluginList,PluginParam:Param,PluginManager:new PluginManager};window.plugin=Plugin})();(function(){var t={_ignoreBodyRotation:false,_body:null,_PTMRatio:32,_rotation:1,ctor:function(t,e){cc.Sprite.prototype.ctor.call(this);if(t===undefined){cc.PhysicsSprite.prototype.init.call(this)}else if(cc.isString(t)){if(t[0]==="#"){var i=t.substr(1,t.length-1);var n=cc.spriteFrameCache.getSpriteFrame(i);this.initWithSpriteFrame(n)}else{this.init(t,e)}}else if(cc.isObject(t)){if(t instanceof cc.Texture2D){this.initWithTexture(t,e)}else if(t instanceof cc.SpriteFrame){this.initWithSpriteFrame(t)}}},setBody:function(t){this._body=t},getBody:function(){return this._body},setPTMRatio:function(t){this._PTMRatio=t},getPTMRatio:function(){return this._PTMRatio},getPosition:function(){var t=this._body.GetPosition();var e=this._PTMRatio;return cc.p(t.x*e,t.y*e)},setPosition:function(t){var e=this._body.GetAngle();var i=this._PTMRatio;this._body.setTransform(Box2D.b2Vec2(t.x/i,t.y/i),e);this.setNodeDirty()},getRotation:function(){return this._ignoreBodyRotation?cc.radiansToDegrees(this._rotationRadians):cc.radiansToDegrees(this._body.GetAngle())},setRotation:function(t){if(this._ignoreBodyRotation){this._rotation=t}else{var e=this._body;var i=e.GetPosition();e.SetTransform(i,cc.degreesToRadians(t))}this.setNodeDirty()},_syncPosition:function(){var t=this._body.GetPosition();this._position.x=t.x*this._PTMRatio;this._position.y=t.y*this._PTMRatio;this._rotationRadians=this._rotation*(Math.PI/180)},_syncRotation:function(){this._rotationRadians=this._body.GetAngle()},visit:function(){if(this._body&&this._PTMRatio){this._syncPosition();if(!this._ignoreBodyRotation)this._syncRotation()}else{cc.log("PhysicsSprite body or PTIMRatio was not set")}this._super()},setIgnoreBodyRotation:function(t){this._ignoreBodyRotation=t}};var e={_ignoreBodyRotation:false,_body:null,_rotation:1,ctor:function(t,e){cc.Sprite.prototype.ctor.call(this);if(t===undefined){cc.PhysicsSprite.prototype.init.call(this)}else if(cc.isString(t)){if(t[0]==="#"){var i=t.substr(1,t.length-1);var n=cc.spriteFrameCache.getSpriteFrame(i);this.initWithSpriteFrame(n)}else{this.init(t,e)}}else if(cc.isObject(t)){if(t instanceof cc.Texture2D){this.initWithTexture(t,e)}else if(t instanceof cc.SpriteFrame){this.initWithSpriteFrame(t)}}cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){cc.renderer.pushRenderCommand(this._renderCmd);cc.Sprite.prototype.visit.call(this)},setBody:function(t){this._body=t},getBody:function(){return this._body},getPosition:function(){var t=this._body;return{x:t.p.x,y:t.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(t,e){if(e===undefined){this._body.p.x=t.x;this._body.p.y=t.y}else{this._body.p.x=t;this._body.p.y=e}},setPositionX:function(t){this._body.p.x=t},setPositionY:function(t){this._body.p.y=t},_syncPosition:function(){var t=this._position,e=this._body;if(t.x!==e.p.x||t.y!==e.p.y){cc.Sprite.prototype.setPosition.call(this,e.p.x,e.p.y)}},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-cc.radiansToDegrees(this._body.a)},setRotation:function(t){if(this._ignoreBodyRotation){cc.Sprite.prototype.setRotation.call(this,t)}else{this._body.a=-cc.degreesToRadians(t)}},_syncRotation:function(){if(this._rotationX!==-cc.radiansToDegrees(this._body.a)){cc.Sprite.prototype.setRotation.call(this,-cc.radiansToDegrees(this._body.a))}},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(t){this._ignoreBodyRotation=t},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.PhysicsSprite.CanvasRenderCmd(this);else return new cc.PhysicsSprite.WebGLRenderCmd(this)}};cc.PhysicsSprite=cc.Sprite.extend(e);cc.PhysicsSprite._className="PhysicsSprite";var i=cc.PhysicsSprite.prototype;i.body;cc.defineGetterSetter(i,"body",i.getBody,i.setBody);i.dirty;cc.defineGetterSetter(i,"dirty",i.isDirty,i.setDirty);cc.PhysicsSprite.create=function(t,e){return new cc.PhysicsSprite(t,e)};cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create;cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create})();(function(){cc.PhysicsSprite.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t);this._needDraw=true};var t=cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsSprite.CanvasRenderCmd;t.rendering=function(t,e,i){var n=this._node;n._syncPosition();if(!n._ignoreBodyRotation)n._syncRotation();this.transform(this.getParentRenderCmd());cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,t,e,i)};t.getNodeToParentTransform=function(){var t=this._node;var e=this._transform;var i=t._body,n=t._scaleX,r=t._scaleY,s=this._anchorPointInPoints;e.tx=i.p.x;e.ty=i.p.y;var a=-i.a;var o=1,c=0;if(a&&!t._ignoreBodyRotation){o=Math.cos(a);c=Math.sin(a)}e.a=e.d=o;e.b=-c;e.c=c;if(n!==1||r!==1){e.a*=n;e.c*=n;e.b*=r;e.d*=r}e.tx+=o*-s.x*n+-c*s.y*r;e.ty-=c*-s.x*n+o*s.y*r;if(this._ignoreAnchorPointForPosition){e.tx+=s.x;e.ty+=s.y}return this._transform}})();cc.__convertVerts=function(t){var e=[];for(var i=0;i<t.length/2;i++){e[i]={x:t[i*2],y:t[i*2+1]}}return e};cc.ColorForBody=function(t){if(t.isRogue()||t.isSleeping()){return cc.color(128,128,128,128)}else if(t.nodeIdleTime>t.space.sleepTimeThreshold){return cc.color(84,84,84,128)}else{return cc.color(255,0,0,128)}};cc.DrawShape=function(t,e){var i=t.body;var n=cc.ColorForBody(i);switch(t.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),n);this.drawSegment(t.tc,cp.v.add(t.tc,cp.v.mult(i.rot,t.r)),1,n);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),n);break;case cp.PolyShape.prototype.collisionCode:var r=cc.color(n.r,n.g,n.b,cc.lerp(n.a,255,.5));this.drawPoly(cc.__convertVerts(t.tVerts),n,1,r);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()");break}};cc.DrawConstraint=function(t,e){var i=t.a;var n=t.b;var r,s;if(t instanceof cp.PinJoint){r=i.local2World(t.anchr1);s=n.local2World(t.anchr2);this.drawDot(r,3,cc.CONSTRAINT_COLOR);this.drawDot(s,3,cc.CONSTRAINT_COLOR);this.drawSegment(r,s,1,cc.CONSTRAINT_COLOR)}else if(t instanceof cp.SlideJoint){r=i.local2World(t.anchr1);s=n.local2World(t.anchr2);this.drawDot(r,3,cc.CONSTRAINT_COLOR);this.drawDot(s,3,cc.CONSTRAINT_COLOR);this.drawSegment(r,s,1,cc.CONSTRAINT_COLOR)}else if(t instanceof cp.PivotJoint){r=i.local2World(t.anchr1);s=n.local2World(t.anchr2);this.drawDot(r,3,cc.CONSTRAINT_COLOR);this.drawDot(s,3,cc.CONSTRAINT_COLOR)}else if(t instanceof cp.GrooveJoint){r=i.local2World(t.grv_a);s=i.local2World(t.grv_b);var a=n.local2World(t.anchr2);this.drawDot(a,3,cc.CONSTRAINT_COLOR);this.drawSegment(r,s,1,cc.CONSTRAINT_COLOR)}else if(t instanceof cp.DampedSpring){}else{}};cc.CONSTRAINT_COLOR=cc.color(0,255,0,128);cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){cc.DrawNode.prototype.ctor.call(this);this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(t){if(!this._space)return;this._space.eachShape(cc.DrawShape.bind(this));this._space.eachConstraint(cc.DrawConstraint.bind(this));cc.DrawNode.prototype.draw.call(this);this.clear()},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new cc.PhysicsDebugNode.CanvasRenderCmd(this);else return new cc.PhysicsDebugNode.WebGLRenderCmd(this)}});cc.PhysicsDebugNode.create=function(t){return new cc.PhysicsDebugNode(t)};(function(){cc.PhysicsDebugNode.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._buffer=t._buffer;this._needDraw=true};var t=cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=cc.PhysicsDebugNode.CanvasRenderCmd;t.rendering=function(t,e,i){var n=this._node;if(!n._space)return;n._space.eachShape(cc.DrawShape.bind(n));n._space.eachConstraint(cc.DrawConstraint.bind(n));cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,t,e,i);n.clear()};t._drawDot=cc.DrawNode.CanvasRenderCmd.prototype._drawDot;t._drawSegment=cc.DrawNode.CanvasRenderCmd.prototype._drawSegment;t._drawPoly=cc.DrawNode.CanvasRenderCmd.prototype._drawPoly})();(function(){cc.PhysicsDebugNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true};cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);
cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=cc.PhysicsDebugNode.WebGLRenderCmd;cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(!e._space)return;e._space.eachShape(cc.DrawShape.bind(e));e._space.eachConstraint(cc.DrawConstraint.bind(e));cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);e._render();e.clear()}})();(function(){cc.PhysicsSprite.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t);this._needDraw=true};var t=cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);t.constructor=cc.PhysicsSprite.WebGLRenderCmd;t.rendering=function(t){var e=this._node;e._syncPosition();if(!e._ignoreBodyRotation)e._syncRotation();this.transform(this.getParentRenderCmd(),true);cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this,t)};t.getNodeToParentTransform=function(){var t=this._node;var e=t._body,i=this._anchorPointInPoints,n=t._scaleX,r=t._scaleY;var s=e.p.x;var a=e.p.y;if(this._ignoreAnchorPointForPosition){s+=i.x;a+=i.y}var o=e.a,c=1,l=0;if(o&&!t._ignoreBodyRotation){c=Math.cos(o);l=Math.sin(o)}if(!cc._rectEqualToZero(i)){s+=c*-i.x*n+-l*-i.y*r;a+=l*-i.x*n+c*-i.y*r}this._transform=cc.affineTransformMake(c*n,l*n,-l*r,c*r,s,a);return this._transform};t.updateTransform=function(){var t=this._node;var e=t.isDirty();if(e){var i=t._renderCmd;i&&i.setDirtyRecursively(true)}cc.Sprite.WebGLRenderCmd.prototype.updateTransform.call(this)}})();!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.io=t()}}(function(){var t,e,i;return function n(t,e,i){function r(a,o){if(!e[a]){if(!t[a]){var c=typeof require=="function"&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=e[a]={exports:{}};t[a][0].call(l.exports,function(e){var i=t[a][1][e];return r(i?i:e)},l,l.exports,n,t,e,i)}return e[a].exports}var s=typeof require=="function"&&require;for(var a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,i){e.exports=t("./lib/")},{"./lib/":2}],2:[function(t,e,i){var n=t("./url");var r=t("socket.io-parser");var s=t("./manager");var a=t("debug")("socket.io-client");e.exports=i=c;var o=i.managers={};function c(t,e){if(typeof t=="object"){e=t;t=undefined}e=e||{};var i=n(t);var r=i.source;var c=i.id;var l;if(e.forceNew||e["force new connection"]||false===e.multiplex){a("ignoring socket cache for %s",r);l=s(r,e)}else{if(!o[c]){a("new io instance for %s",r);o[c]=s(r,e)}l=o[c]}return l.socket(i.path)}i.protocol=r.protocol;i.connect=c;i.Manager=t("./manager");i.Socket=t("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(t,e,i){var n=t("./url");var r=t("engine.io-client");var s=t("./socket");var a=t("component-emitter");var o=t("socket.io-parser");var c=t("./on");var l=t("component-bind");var h=t("object-component");var u=t("debug")("socket.io-client:manager");var d=t("indexof");var _=t("backo2");e.exports=f;function f(t,e){if(!(this instanceof f))return new f(t,e);if(t&&"object"==typeof t){e=t;t=undefined}e=e||{};e.path=e.path||"/socket.io";this.nsps={};this.subs=[];this.opts=e;this.reconnection(e.reconnection!==false);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1e3);this.reconnectionDelayMax(e.reconnectionDelayMax||5e3);this.randomizationFactor(e.randomizationFactor||.5);this.backoff=new _({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2e4:e.timeout);this.readyState="closed";this.uri=t;this.connected=[];this.encoding=false;this.packetBuffer=[];this.encoder=new o.Encoder;this.decoder=new o.Decoder;this.autoConnect=e.autoConnect!==false;if(this.autoConnect)this.open()}f.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps){this.nsps[t].emit.apply(this.nsps[t],arguments)}};f.prototype.updateSocketIds=function(){for(var t in this.nsps){this.nsps[t].id=this.engine.id}};a(f.prototype);f.prototype.reconnection=function(t){if(!arguments.length)return this._reconnection;this._reconnection=!!t;return this};f.prototype.reconnectionAttempts=function(t){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=t;return this};f.prototype.reconnectionDelay=function(t){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=t;this.backoff&&this.backoff.setMin(t);return this};f.prototype.randomizationFactor=function(t){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=t;this.backoff&&this.backoff.setJitter(t);return this};f.prototype.reconnectionDelayMax=function(t){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=t;this.backoff&&this.backoff.setMax(t);return this};f.prototype.timeout=function(t){if(!arguments.length)return this._timeout;this._timeout=t;return this};f.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};f.prototype.open=f.prototype.connect=function(t){u("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;u("opening %s",this.uri);this.engine=r(this.uri,this.opts);var e=this.engine;var i=this;this.readyState="opening";this.skipReconnect=false;var n=c(e,"open",function(){i.onopen();t&&t()});var s=c(e,"error",function(e){u("connect_error");i.cleanup();i.readyState="closed";i.emitAll("connect_error",e);if(t){var n=new Error("Connection error");n.data=e;t(n)}else{i.maybeReconnectOnOpen()}});if(false!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var o=setTimeout(function(){u("connect attempt timed out after %d",a);n.destroy();e.close();e.emit("error","timeout");i.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(o)}})}this.subs.push(n);this.subs.push(s);return this};f.prototype.onopen=function(){u("open");this.cleanup();this.readyState="open";this.emit("open");var t=this.engine;this.subs.push(c(t,"data",l(this,"ondata")));this.subs.push(c(this.decoder,"decoded",l(this,"ondecoded")));this.subs.push(c(t,"error",l(this,"onerror")));this.subs.push(c(t,"close",l(this,"onclose")))};f.prototype.ondata=function(t){this.decoder.add(t)};f.prototype.ondecoded=function(t){this.emit("packet",t)};f.prototype.onerror=function(t){u("error",t);this.emitAll("error",t)};f.prototype.socket=function(t){var e=this.nsps[t];if(!e){e=new s(this,t);this.nsps[t]=e;var i=this;e.on("connect",function(){e.id=i.engine.id;if(!~d(i.connected,e)){i.connected.push(e)}})}return e};f.prototype.destroy=function(t){var e=d(this.connected,t);if(~e)this.connected.splice(e,1);if(this.connected.length)return;this.close()};f.prototype.packet=function(t){u("writing packet %j",t);var e=this;if(!e.encoding){e.encoding=true;this.encoder.encode(t,function(t){for(var i=0;i<t.length;i++){e.engine.write(t[i])}e.encoding=false;e.processPacketQueue()})}else{e.packetBuffer.push(t)}};f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}};f.prototype.cleanup=function(){var t;while(t=this.subs.shift())t.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};f.prototype.close=f.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};f.prototype.onclose=function(t){u("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",t);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts){u("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var e=this.backoff.duration();u("will wait %dms before reconnect attempt",e);this.reconnecting=true;var i=setTimeout(function(){if(t.skipReconnect)return;u("attempting reconnect");t.emitAll("reconnect_attempt",t.backoff.attempts);t.emitAll("reconnecting",t.backoff.attempts);if(t.skipReconnect)return;t.open(function(e){if(e){u("reconnect attempt error");t.reconnecting=false;t.reconnect();t.emitAll("reconnect_error",e.data)}else{u("reconnect success");t.onreconnect()}})},e);this.subs.push({destroy:function(){clearTimeout(i)}})}};f.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",t)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(t,e,i){e.exports=n;function n(t,e,i){t.on(e,i);return{destroy:function(){t.removeListener(e,i)}}}},{}],5:[function(t,e,i){var n=t("socket.io-parser");var r=t("component-emitter");var s=t("to-array");var a=t("./on");var o=t("component-bind");var c=t("debug")("socket.io-client:socket");var l=t("has-binary");e.exports=i=d;var h={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var u=r.prototype.emit;function d(t,e){this.io=t;this.nsp=e;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}r(d.prototype);d.prototype.subEvents=function(){if(this.subs)return;var t=this.io;this.subs=[a(t,"open",o(this,"onopen")),a(t,"packet",o(this,"onpacket")),a(t,"close",o(this,"onclose"))]};d.prototype.open=d.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};d.prototype.send=function(){var t=s(arguments);t.unshift("message");this.emit.apply(this,t);return this};d.prototype.emit=function(t){if(h.hasOwnProperty(t)){u.apply(this,arguments);return this}var e=s(arguments);var i=n.EVENT;if(l(e)){i=n.BINARY_EVENT}var r={type:i,data:e};if("function"==typeof e[e.length-1]){c("emitting packet with ack id %d",this.ids);this.acks[this.ids]=e.pop();r.id=this.ids++}if(this.connected){this.packet(r)}else{this.sendBuffer.push(r)}return this};d.prototype.packet=function(t){t.nsp=this.nsp;this.io.packet(t)};d.prototype.onopen=function(){c("transport is open - connecting");if("/"!=this.nsp){this.packet({type:n.CONNECT})}};d.prototype.onclose=function(t){c("close (%s)",t);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",t)};d.prototype.onpacket=function(t){if(t.nsp!=this.nsp)return;switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:this.onevent(t);break;case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:this.onack(t);break;case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data);break}};d.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e);if(null!=t.id){c("attaching ack callback to event");e.push(this.ack(t.id))}if(this.connected){u.apply(this,e)}else{this.receiveBuffer.push(e)}};d.prototype.ack=function(t){var e=this;var i=false;return function(){if(i)return;i=true;var r=s(arguments);c("sending ack %j",r);var a=l(r)?n.BINARY_ACK:n.ACK;e.packet({type:a,id:t,data:r})}};d.prototype.onack=function(t){c("calling ack %s with %j",t.id,t.data);var e=this.acks[t.id];e.apply(this,t.data);delete this.acks[t.id]};d.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++){u.apply(this,this.receiveBuffer[t])}this.receiveBuffer=[];for(t=0;t<this.sendBuffer.length;t++){this.packet(this.sendBuffer[t])}this.sendBuffer=[]};d.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++){this.subs[t].destroy()}this.subs=null}this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){if(this.connected){c("performing disconnect (%s)",this.nsp);this.packet({type:n.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(t,e,i){(function(i){var n=t("parseuri");var r=t("debug")("socket.io-client:url");e.exports=s;function s(t,e){var s=t;var e=e||i.location;if(null==t)t=e.protocol+"//"+e.host;if("string"==typeof t){if("/"==t.charAt(0)){if("/"==t.charAt(1)){t=e.protocol+t}else{t=e.hostname+t}}if(!/^(https?|wss?):\/\//.test(t)){r("protocol-less url %s",t);if("undefined"!=typeof e){t=e.protocol+"//"+t}else{t="https://"+t}}r("parse %s",t);s=n(t)}if(!s.port){if(/^(http|ws)$/.test(s.protocol)){s.port="80"}else if(/^(http|ws)s$/.test(s.protocol)){s.port="443"}}s.path=s.path||"/";s.id=s.protocol+"://"+s.host+":"+s.port;s.href=s.protocol+"://"+s.host+(e&&e.port==s.port?"":":"+s.port);return s}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(t,e,i){e.exports=n;function n(t){t=t||{};this.ms=t.min||100;this.max=t.max||1e4;this.factor=t.factor||2;this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0;this.attempts=0}n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random();var i=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-i:t+i}return Math.min(t,this.max)|0};n.prototype.reset=function(){this.attempts=0};n.prototype.setMin=function(t){this.ms=t};n.prototype.setMax=function(t){this.max=t};n.prototype.setJitter=function(t){this.jitter=t}},{}],8:[function(t,e,i){var n=[].slice;e.exports=function(t,e){if("string"==typeof e)e=t[e];if("function"!=typeof e)throw new Error("bind() requires a function");var i=n.call(arguments,2);return function(){return e.apply(t,i.concat(n.call(arguments)))}}},{}],9:[function(t,e,i){e.exports=n;function n(t){if(t)return r(t)}function r(t){for(var e in n.prototype){t[e]=n.prototype[e]}return t}n.prototype.on=n.prototype.addEventListener=function(t,e){this._callbacks=this._callbacks||{};(this._callbacks[t]=this._callbacks[t]||[]).push(e);return this};n.prototype.once=function(t,e){var i=this;this._callbacks=this._callbacks||{};function n(){i.off(t,n);e.apply(this,arguments)}n.fn=e;this.on(t,n);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var i=this._callbacks[t];if(!i)return this;if(1==arguments.length){delete this._callbacks[t];return this}var n;for(var r=0;r<i.length;r++){n=i[r];if(n===e||n.fn===e){i.splice(r,1);break}}return this};n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks[t];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n){i[n].apply(this,e)}}return this};n.prototype.listeners=function(t){this._callbacks=this._callbacks||{};return this._callbacks[t]||[]};n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],10:[function(t,e,i){e.exports=n;function n(t){if(!n.enabled(t))return function(){};return function(e){e=r(e);var i=new Date;var s=i-(n[t]||i);n[t]=i;e=t+" "+e+" +"+n.humanize(s);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}n.names=[];n.skips=[];n.enable=function(t){try{localStorage.debug=t}catch(e){}var i=(t||"").split(/[\s,]+/),r=i.length;for(var s=0;s<r;s++){t=i[s].replace("*",".*?");if(t[0]==="-"){n.skips.push(new RegExp("^"+t.substr(1)+"$"))}else{n.names.push(new RegExp("^"+t+"$"))}}};n.disable=function(){n.enable("")};n.humanize=function(t){var e=1e3,i=60*1e3,n=60*i;if(t>=n)return(t/n).toFixed(1)+"h";if(t>=i)return(t/i).toFixed(1)+"m";if(t>=e)return(t/e|0)+"s";return t+"ms"};n.enabled=function(t){for(var e=0,i=n.skips.length;e<i;e++){if(n.skips[e].test(t)){return false}}for(var e=0,i=n.names.length;e<i;e++){if(n.names[e].test(t)){return true}}return false};function r(t){if(t instanceof Error)return t.stack||t.message;return t}try{if(window.localStorage)n.enable(localStorage.debug)}catch(s){}},{}],11:[function(t,e,i){e.exports=t("./lib/")},{"./lib/":12}],12:[function(t,e,i){e.exports=t("./socket");e.exports.parser=t("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(t,e,i){(function(i){var n=t("./transports");var r=t("component-emitter");var s=t("debug")("engine.io-client:socket");var a=t("indexof");var o=t("engine.io-parser");var c=t("parseuri");var l=t("parsejson");var h=t("parseqs");e.exports=d;function u(){}function d(t,e){if(!(this instanceof d))return new d(t,e);e=e||{};if(t&&"object"==typeof t){e=t;t=null}if(t){t=c(t);e.host=t.host;e.secure=t.protocol=="https"||t.protocol=="wss";e.port=t.port;if(t.query)e.query=t.query}this.secure=null!=e.secure?e.secure:i.location&&"https:"==location.protocol;if(e.host){var n=e.host.split(":");e.hostname=n.shift();if(n.length){e.port=n.pop()}else if(!e.port){e.port=this.secure?"443":"80"}}this.agent=e.agent||false;this.hostname=e.hostname||(i.location?location.hostname:"localhost");this.port=e.port||(i.location&&location.port?location.port:this.secure?443:80);this.query=e.query||{};if("string"==typeof this.query)this.query=h.decode(this.query);this.upgrade=false!==e.upgrade;this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!e.forceJSONP;this.jsonp=false!==e.jsonp;this.forceBase64=!!e.forceBase64;this.enablesXDR=!!e.enablesXDR;this.timestampParam=e.timestampParam||"t";this.timestampRequests=e.timestampRequests;this.transports=e.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=e.policyPort||843;this.rememberUpgrade=e.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=e.onlyBinaryUpgrades;this.pfx=e.pfx||null;this.key=e.key||null;this.passphrase=e.passphrase||null;this.cert=e.cert||null;this.ca=e.ca||null;this.ciphers=e.ciphers||null;this.rejectUnauthorized=e.rejectUnauthorized||null;this.open()}d.priorWebsocketSuccess=false;r(d.prototype);d.protocol=o.protocol;d.Socket=d;d.Transport=t("./transport");d.transports=t("./transports");d.parser=t("engine.io-parser");d.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=_(this.query);e.EIO=o.protocol;e.transport=t;if(this.id)e.sid=this.id;var i=new n[t]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return i};function _(t){var e={};for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}return e}d.prototype.open=function(){var t;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){t="websocket"}else if(0==this.transports.length){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}else{t=this.transports[0]}this.readyState="opening";var t;try{t=this.createTransport(t)}catch(i){this.transports.shift();this.open();return}t.open();this.setTransport(t)};d.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;if(this.transport){s("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=t;t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})};d.prototype.probe=function(t){s('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),i=false,n=this;d.priorWebsocketSuccess=false;function r(){if(n.onlyBinaryUpgrades){var r=!this.supportsBinary&&n.transport.supportsBinary;i=i||r}if(i)return;s('probe transport "%s" opened',t);e.send([{type:"ping",data:"probe"}]);e.once("packet",function(r){if(i)return;if("pong"==r.type&&"probe"==r.data){s('probe transport "%s" pong',t);n.upgrading=true;n.emit("upgrading",e);if(!e)return;d.priorWebsocketSuccess="websocket"==e.name;s('pausing current transport "%s"',n.transport.name);n.transport.pause(function(){if(i)return;if("closed"==n.readyState)return;s("changing transport and sending upgrade packet");u();n.setTransport(e);e.send([{type:"upgrade"}]);n.emit("upgrade",e);e=null;n.upgrading=false;n.flush()})}else{s('probe transport "%s" failed',t);var a=new Error("probe error");a.transport=e.name;n.emit("upgradeError",a)}})}function a(){if(i)return;i=true;u();e.close();e=null}function o(i){var r=new Error("probe error: "+i);r.transport=e.name;a();s('probe transport "%s" failed because of error: %s',t,i);n.emit("upgradeError",r)}function c(){o("transport closed")}function l(){o("socket closed")}function h(t){if(e&&t.name!=e.name){s('"%s" works - aborting "%s"',t.name,e.name);a()}}function u(){e.removeListener("open",r);e.removeListener("error",o);e.removeListener("close",c);n.removeListener("close",l);n.removeListener("upgrading",h)}e.once("open",r);e.once("error",o);e.once("close",c);this.once("close",l);this.once("upgrading",h);e.open()};d.prototype.onOpen=function(){s("socket open");this.readyState="open";d.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++){this.probe(this.upgrades[t])}}};d.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState){s('socket receive: type "%s", data "%s"',t.type,t.data);this.emit("packet",t);this.emit("heartbeat");switch(t.type){case"open":this.onHandshake(l(t.data));break;case"pong":this.setPing();break;case"error":var e=new Error("server error");e.code=t.data;this.emit("error",e);break;case"message":this.emit("data",t.data);this.emit("message",t.data);break}}else{s('packet received with socket readyState "%s"',this.readyState)}};d.prototype.onHandshake=function(t){this.emit("handshake",t);this.id=t.sid;this.transport.query.sid=t.sid;this.upgrades=this.filterUpgrades(t.upgrades);this.pingInterval=t.pingInterval;this.pingTimeout=t.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};d.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if("closed"==e.readyState)return;e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)};d.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer);t.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout);t.ping();t.onHeartbeat(t.pingTimeout)},t.pingInterval)};d.prototype.ping=function(){this.sendPacket("ping")};d.prototype.onDrain=function(){for(var t=0;t<this.prevBufferLen;t++){if(this.callbackBuffer[t]){this.callbackBuffer[t]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};d.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){s("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};d.prototype.write=d.prototype.send=function(t,e){this.sendPacket("message",t,e);return this};d.prototype.sendPacket=function(t,e,i){if("closing"==this.readyState||"closed"==this.readyState){return}var n={type:t,data:e};this.emit("packetCreate",n);this.writeBuffer.push(n);this.callbackBuffer.push(i);this.flush()};d.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var t=this;function e(){t.onClose("forced close");s("socket closing - telling transport to close");t.transport.close()}function i(){t.removeListener("upgrade",i);t.removeListener("upgradeError",i);e()}function n(){t.once("upgrade",i);t.once("upgradeError",i)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){n()}else{e()}})}else if(this.upgrading){n()}else{e()}}return this};d.prototype.onError=function(t){s("socket error %j",t);d.priorWebsocketSuccess=false;this.emit("error",t);this.onClose("transport error",t)};d.prototype.onClose=function(t,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){s('socket close with reason: "%s"',t);var i=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){i.writeBuffer=[];i.callbackBuffer=[];i.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",t,e)}};d.prototype.filterUpgrades=function(t){var e=[];for(var i=0,n=t.length;i<n;i++){if(~a(this.transports,t[i]))e.push(t[i])}return e}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(t,e,i){var n=t("engine.io-parser");var r=t("component-emitter");e.exports=s;function s(t){this.path=t.path;this.hostname=t.hostname;this.port=t.port;this.secure=t.secure;this.query=t.query;this.timestampParam=t.timestampParam;this.timestampRequests=t.timestampRequests;this.readyState="";this.agent=t.agent||false;this.socket=t.socket;this.enablesXDR=t.enablesXDR;this.pfx=t.pfx;this.key=t.key;this.passphrase=t.passphrase;this.cert=t.cert;this.ca=t.ca;this.ciphers=t.ciphers;this.rejectUnauthorized=t.rejectUnauthorized}r(s.prototype);s.timestamps=0;s.prototype.onError=function(t,e){var i=new Error(t);i.type="TransportError";i.description=e;this.emit("error",i);return this};s.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};s.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};s.prototype.send=function(t){if("open"==this.readyState){this.write(t)}else{throw new Error("Transport not open")}};s.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};s.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)};s.prototype.onPacket=function(t){this.emit("packet",t)};s.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(t,e,i){(function(e){var n=t("xmlhttprequest");var r=t("./polling-xhr");var s=t("./polling-jsonp");var a=t("./websocket");i.polling=o;i.websocket=a;function o(t){var i;var a=false;var o=false;var c=false!==t.jsonp;if(e.location){var l="https:"==location.protocol;var h=location.port;if(!h){h=l?443:80}a=t.hostname!=location.hostname||h!=t.port;o=t.secure!=l}t.xdomain=a;t.xscheme=o;i=new n(t);if("open"in i&&!t.forceJSONP){return new r(t)}else{if(!c)throw new Error("JSONP disabled");return new s(t)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(t,e,i){(function(i){var n=t("./polling");var r=t("component-inherit");e.exports=h;var s=/\n/g;var a=/\\n/g;var o;var c=0;function l(){}function h(t){n.call(this,t);this.query=this.query||{};if(!o){if(!i.___eio)i.___eio=[];o=i.___eio}this.index=o.length;var e=this;o.push(function(t){e.onData(t)});this.query.j=this.index;if(i.document&&i.addEventListener){i.addEventListener("beforeunload",function(){if(e.script)e.script.onerror=l},false)}}r(h,n);h.prototype.supportsBinary=false;h.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}n.prototype.doClose.call(this)};h.prototype.doPoll=function(){var t=this;var e=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}e.async=true;e.src=this.uri();e.onerror=function(e){t.onError("jsonp poll error",e)};var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i);this.script=e;var n="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(n){setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t);document.body.removeChild(t)},100)}};h.prototype.doWrite=function(t,e){var i=this;if(!this.form){var n=document.createElement("form");var r=document.createElement("textarea");var o=this.iframeId="eio_iframe_"+this.index;var c;n.className="socketio";n.style.position="absolute";n.style.top="-1000px";n.style.left="-1000px";n.target=o;n.method="POST";n.setAttribute("accept-charset","utf-8");r.name="d";n.appendChild(r);document.body.appendChild(n);this.form=n;this.area=r}this.form.action=this.uri();function l(){h();e()}function h(){if(i.iframe){try{i.form.removeChild(i.iframe)}catch(t){i.onError("jsonp polling iframe removal error",t)}}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';c=document.createElement(e)}catch(t){c=document.createElement("iframe");c.name=i.iframeId;c.src="javascript:0"}c.id=i.iframeId;i.form.appendChild(c);i.iframe=c}h();t=t.replace(a,"\\\n");this.area.value=t.replace(s,"\\n");try{this.form.submit()}catch(u){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(i.iframe.readyState=="complete"){l()}}}else{this.iframe.onload=l}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(t,e,i){(function(i){var n=t("xmlhttprequest");var r=t("./polling");var s=t("component-emitter");var a=t("component-inherit");var o=t("debug")("engine.io-client:polling-xhr");e.exports=l;e.exports.Request=h;function c(){}function l(t){r.call(this,t);if(i.location){var e="https:"==location.protocol;var n=location.port;if(!n){n=e?443:80}this.xd=t.hostname!=i.location.hostname||n!=t.port;this.xs=t.secure!=e}}a(l,r);l.prototype.supportsBinary=true;l.prototype.request=function(t){t=t||{};t.uri=this.uri();t.xd=this.xd;t.xs=this.xs;t.agent=this.agent||false;t.supportsBinary=this.supportsBinary;t.enablesXDR=this.enablesXDR;t.pfx=this.pfx;t.key=this.key;t.passphrase=this.passphrase;t.cert=this.cert;t.ca=this.ca;t.ciphers=this.ciphers;t.rejectUnauthorized=this.rejectUnauthorized;return new h(t)};l.prototype.doWrite=function(t,e){var i=typeof t!=="string"&&t!==undefined;var n=this.request({method:"POST",data:t,isBinary:i});var r=this;n.on("success",e);n.on("error",function(t){r.onError("xhr post error",t)});this.sendXhr=n};l.prototype.doPoll=function(){o("xhr poll");var t=this.request();var e=this;t.on("data",function(t){e.onData(t)});t.on("error",function(t){e.onError("xhr poll error",t)});this.pollXhr=t};function h(t){this.method=t.method||"GET";this.uri=t.uri;this.xd=!!t.xd;this.xs=!!t.xs;this.async=false!==t.async;this.data=undefined!=t.data?t.data:null;this.agent=t.agent;this.isBinary=t.isBinary;this.supportsBinary=t.supportsBinary;this.enablesXDR=t.enablesXDR;this.pfx=t.pfx;
this.key=t.key;this.passphrase=t.passphrase;this.cert=t.cert;this.ca=t.ca;this.ciphers=t.ciphers;this.rejectUnauthorized=t.rejectUnauthorized;this.create()}s(h.prototype);h.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx;t.key=this.key;t.passphrase=this.passphrase;t.cert=this.cert;t.ca=this.ca;t.ciphers=this.ciphers;t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(t);var r=this;try{o("xhr open %s: %s",this.method,this.uri);e.open(this.method,this.uri,this.async);if(this.supportsBinary){e.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){e.setRequestHeader("Content-type","application/octet-stream")}else{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(s){}}if("withCredentials"in e){e.withCredentials=true}if(this.hasXDR()){e.onload=function(){r.onLoad()};e.onerror=function(){r.onError(e.responseText)}}else{e.onreadystatechange=function(){if(4!=e.readyState)return;if(200==e.status||1223==e.status){r.onLoad()}else{setTimeout(function(){r.onError(e.status)},0)}}}o("xhr data %s",this.data);e.send(this.data)}catch(s){setTimeout(function(){r.onError(s)},0);return}if(i.document){this.index=h.requestsCount++;h.requests[this.index]=this}};h.prototype.onSuccess=function(){this.emit("success");this.cleanup()};h.prototype.onData=function(t){this.emit("data",t);this.onSuccess()};h.prototype.onError=function(t){this.emit("error",t);this.cleanup(true)};h.prototype.cleanup=function(t){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=c}else{this.xhr.onreadystatechange=c}if(t){try{this.xhr.abort()}catch(e){}}if(i.document){delete h.requests[this.index]}this.xhr=null};h.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(i){}if(e==="application/octet-stream"){t=this.xhr.response}else{if(!this.supportsBinary){t=this.xhr.responseText}else{t="ok"}}}catch(i){this.onError(i)}if(null!=t){this.onData(t)}};h.prototype.hasXDR=function(){return"undefined"!==typeof i.XDomainRequest&&!this.xs&&this.enablesXDR};h.prototype.abort=function(){this.cleanup()};if(i.document){h.requestsCount=0;h.requests={};if(i.attachEvent){i.attachEvent("onunload",u)}else if(i.addEventListener){i.addEventListener("beforeunload",u,false)}}function u(){for(var t in h.requests){if(h.requests.hasOwnProperty(t)){h.requests[t].abort()}}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(t,e,i){var n=t("../transport");var r=t("parseqs");var s=t("engine.io-parser");var a=t("component-inherit");var o=t("debug")("engine.io-client:polling");e.exports=l;var c=function(){var e=t("xmlhttprequest");var i=new e({xdomain:false});return null!=i.responseType}();function l(t){var e=t&&t.forceBase64;if(!c||e){this.supportsBinary=false}n.call(this,t)}a(l,n);l.prototype.name="polling";l.prototype.doOpen=function(){this.poll()};l.prototype.pause=function(t){var e=0;var i=this;this.readyState="pausing";function n(){o("paused");i.readyState="paused";t()}if(this.polling||!this.writable){var r=0;if(this.polling){o("we are currently polling - waiting to pause");r++;this.once("pollComplete",function(){o("pre-pause polling complete");--r||n()})}if(!this.writable){o("we are currently writing - waiting to pause");r++;this.once("drain",function(){o("pre-pause writing complete");--r||n()})}}else{n()}};l.prototype.poll=function(){o("polling");this.polling=true;this.doPoll();this.emit("poll")};l.prototype.onData=function(t){var e=this;o("polling got data %s",t);var i=function(t,i,n){if("opening"==e.readyState){e.onOpen()}if("close"==t.type){e.onClose();return false}e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,i);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{o('ignoring poll - transport state "%s"',this.readyState)}}};l.prototype.doClose=function(){var t=this;function e(){o("writing close packet");t.write([{type:"close"}])}if("open"==this.readyState){o("transport open - closing");e()}else{o("transport not open - deferring close");this.once("open",e)}};l.prototype.write=function(t){var e=this;this.writable=false;var i=function(){e.writable=true;e.emit("drain")};var e=this;s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,i)})};l.prototype.uri=function(){var t=this.query||{};var e=this.secure?"https":"http";var i="";if(false!==this.timestampRequests){t[this.timestampParam]=+new Date+"-"+n.timestamps++}if(!this.supportsBinary&&!t.sid){t.b64=1}t=r.encode(t);if(this.port&&("https"==e&&this.port!=443||"http"==e&&this.port!=80)){i=":"+this.port}if(t.length){t="?"+t}return e+"://"+this.hostname+i+this.path+t}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(t,e,i){var n=t("../transport");var r=t("engine.io-parser");var s=t("parseqs");var a=t("component-inherit");var o=t("debug")("engine.io-client:websocket");var c=t("ws");e.exports=l;function l(t){var e=t&&t.forceBase64;if(e){this.supportsBinary=false}n.call(this,t)}a(l,n);l.prototype.name="websocket";l.prototype.supportsBinary=true;l.prototype.doOpen=function(){if(!this.check()){return}var t=this;var e=this.uri();var i=void 0;var n={agent:this.agent};n.pfx=this.pfx;n.key=this.key;n.passphrase=this.passphrase;n.cert=this.cert;n.ca=this.ca;n.ciphers=this.ciphers;n.rejectUnauthorized=this.rejectUnauthorized;this.ws=new c(e,i,n);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};l.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()};this.ws.onclose=function(){t.onClose()};this.ws.onmessage=function(e){t.onData(e.data)};this.ws.onerror=function(e){t.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){l.prototype.onData=function(t){var e=this;setTimeout(function(){n.prototype.onData.call(e,t)},0)}}l.prototype.write=function(t){var e=this;this.writable=false;for(var i=0,n=t.length;i<n;i++){r.encodePacket(t[i],this.supportsBinary,function(t){try{e.ws.send(t)}catch(i){o("websocket closed before onclose event")}})}function s(){e.writable=true;e.emit("drain")}setTimeout(s,0)};l.prototype.onClose=function(){n.prototype.onClose.call(this)};l.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};l.prototype.uri=function(){var t=this.query||{};var e=this.secure?"wss":"ws";var i="";if(this.port&&("wss"==e&&this.port!=443||"ws"==e&&this.port!=80)){i=":"+this.port}if(this.timestampRequests){t[this.timestampParam]=+new Date}if(!this.supportsBinary){t.b64=1}t=s.encode(t);if(t.length){t="?"+t}return e+"://"+this.hostname+i+this.path+t};l.prototype.check=function(){return!!c&&!("__initialize"in c&&this.name===l.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(t,e,i){var n=t("has-cors");e.exports=function(t){var e=t.xdomain;var i=t.xscheme;var r=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||n)){return new XMLHttpRequest}}catch(s){}try{if("undefined"!=typeof XDomainRequest&&!i&&r){return new XDomainRequest}}catch(s){}if(!e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(s){}}}},{"has-cors":40}],21:[function(t,e,i){e.exports=function(t,e){var i=function(){};i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=t}},{}],22:[function(t,e,i){i=e.exports=t("./debug");i.log=s;i.formatArgs=r;i.save=a;i.load=o;i.useColors=n;i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}i.formatters.j=function(t){return JSON.stringify(t)};function r(){var t=arguments;var e=this.useColors;t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+i.humanize(this.diff);if(!e)return t;var n="color: "+this.color;t=[t[0],n,"color: inherit"].concat(Array.prototype.slice.call(t,1));var r=0;var s=0;t[0].replace(/%[a-z%]/g,function(t){if("%"===t)return;r++;if("%c"===t){s=r}});t.splice(s,0,n);return t}function s(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{if(null==t){localStorage.removeItem("debug")}else{localStorage.debug=t}}catch(e){}}function o(){var t;try{t=localStorage.debug}catch(e){}return t}i.enable(o())},{"./debug":23}],23:[function(t,e,i){i=e.exports=a;i.coerce=h;i.disable=c;i.enable=o;i.enabled=l;i.humanize=t("ms");i.names=[];i.skips=[];i.formatters={};var n=0;var r;function s(){return i.colors[n++%i.colors.length]}function a(t){function e(){}e.enabled=false;function n(){var t=n;var e=+new Date;var a=e-(r||e);t.diff=a;t.prev=r;t.curr=e;r=e;if(null==t.useColors)t.useColors=i.useColors();if(null==t.color&&t.useColors)t.color=s();var o=Array.prototype.slice.call(arguments);o[0]=i.coerce(o[0]);if("string"!==typeof o[0]){o=["%o"].concat(o)}var c=0;o[0]=o[0].replace(/%([a-z%])/g,function(e,n){if(e==="%")return e;c++;var r=i.formatters[n];if("function"===typeof r){var s=o[c];e=r.call(t,s);o.splice(c,1);c--}return e});if("function"===typeof i.formatArgs){o=i.formatArgs.apply(t,o)}var l=n.log||i.log||console.log.bind(console);l.apply(t,o)}n.enabled=true;var a=i.enabled(t)?n:e;a.namespace=t;return a}function o(t){i.save(t);var e=(t||"").split(/[\s,]+/);var n=e.length;for(var r=0;r<n;r++){if(!e[r])continue;t=e[r].replace(/\*/g,".*?");if(t[0]==="-"){i.skips.push(new RegExp("^"+t.substr(1)+"$"))}else{i.names.push(new RegExp("^"+t+"$"))}}}function c(){i.enable("")}function l(t){var e,n;for(e=0,n=i.skips.length;e<n;e++){if(i.skips[e].test(t)){return false}}for(e=0,n=i.names.length;e<n;e++){if(i.names[e].test(t)){return true}}return false}function h(t){if(t instanceof Error)return t.stack||t.message;return t}},{ms:24}],24:[function(t,e,i){var n=1e3;var r=n*60;var s=r*60;var a=s*24;var o=a*365.25;e.exports=function(t,e){e=e||{};if("string"==typeof t)return c(t);return e.long?h(t):l(t)};function c(t){var e=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(t);if(!e)return;var i=parseFloat(e[1]);var c=(e[2]||"ms").toLowerCase();switch(c){case"years":case"year":case"y":return i*o;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"h":return i*s;case"minutes":case"minute":case"m":return i*r;case"seconds":case"second":case"s":return i*n;case"ms":return i}}function l(t){if(t>=a)return Math.round(t/a)+"d";if(t>=s)return Math.round(t/s)+"h";if(t>=r)return Math.round(t/r)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}function h(t){return u(t,a,"day")||u(t,s,"hour")||u(t,r,"minute")||u(t,n,"second")||t+" ms"}function u(t,e,i){if(t<e)return;if(t<e*1.5)return Math.floor(t/e)+" "+i;return Math.ceil(t/e)+" "+i+"s"}},{}],25:[function(t,e,i){(function(e){var n=t("./keys");var r=t("has-binary");var s=t("arraybuffer.slice");var a=t("base64-arraybuffer");var o=t("after");var c=t("utf8");var l=navigator.userAgent.match(/Android/i);var h=/PhantomJS/i.test(navigator.userAgent);var u=l||h;i.protocol=3;var d=i.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var _=n(d);var f={type:"error",data:"parser error"};var p=t("blob");i.encodePacket=function(t,i,n,r){if("function"==typeof i){r=i;i=false}if("function"==typeof n){r=n;n=null}var s=t.data===undefined?undefined:t.data.buffer||t.data;if(e.ArrayBuffer&&s instanceof ArrayBuffer){return g(t,i,r)}else if(p&&s instanceof e.Blob){return y(t,i,r)}if(s&&s.base64){return m(t,r)}var a=d[t.type];if(undefined!==t.data){a+=n?c.encode(String(t.data)):String(t.data)}return r(""+a)};function m(t,e){var n="b"+i.packets[t.type]+t.data.data;return e(n)}function g(t,e,n){if(!e){return i.encodeBase64Packet(t,n)}var r=t.data;var s=new Uint8Array(r);var a=new Uint8Array(1+r.byteLength);a[0]=d[t.type];for(var o=0;o<s.length;o++){a[o+1]=s[o]}return n(a.buffer)}function v(t,e,n){if(!e){return i.encodeBase64Packet(t,n)}var r=new FileReader;r.onload=function(){t.data=r.result;i.encodePacket(t,e,true,n)};return r.readAsArrayBuffer(t.data)}function y(t,e,n){if(!e){return i.encodeBase64Packet(t,n)}if(u){return v(t,e,n)}var r=new Uint8Array(1);r[0]=d[t.type];var s=new p([r.buffer,t.data]);return n(s)}i.encodeBase64Packet=function(t,n){var r="b"+i.packets[t.type];if(p&&t.data instanceof p){var s=new FileReader;s.onload=function(){var t=s.result.split(",")[1];n(r+t)};return s.readAsDataURL(t.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(o){var c=new Uint8Array(t.data);var l=new Array(c.length);for(var h=0;h<c.length;h++){l[h]=c[h]}a=String.fromCharCode.apply(null,l)}r+=e.btoa(a);return n(r)};i.decodePacket=function(t,e,n){if(typeof t=="string"||t===undefined){if(t.charAt(0)=="b"){return i.decodeBase64Packet(t.substr(1),e)}if(n){try{t=c.decode(t)}catch(r){return f}}var a=t.charAt(0);if(Number(a)!=a||!_[a]){return f}if(t.length>1){return{type:_[a],data:t.substring(1)}}else{return{type:_[a]}}}var o=new Uint8Array(t);var a=o[0];var l=s(t,1);if(p&&e==="blob"){l=new p([l])}return{type:_[a],data:l}};i.decodeBase64Packet=function(t,i){var n=_[t.charAt(0)];if(!e.ArrayBuffer){return{type:n,data:{base64:true,data:t.substr(1)}}}var r=a.decode(t.substr(1));if(i==="blob"&&p){r=new p([r])}return{type:n,data:r}};i.encodePayload=function(t,e,n){if(typeof e=="function"){n=e;e=null}var s=r(t);if(e&&s){if(p&&!u){return i.encodePayloadAsBlob(t,n)}return i.encodePayloadAsArrayBuffer(t,n)}if(!t.length){return n("0:")}function a(t){return t.length+":"+t}function o(t,n){i.encodePacket(t,!s?false:e,true,function(t){n(null,a(t))})}T(t,o,function(t,e){return n(e.join(""))})};function T(t,e,i){var n=new Array(t.length);var r=o(t.length,i);var s=function(t,i,r){e(i,function(e,i){n[t]=i;r(e,n)})};for(var a=0;a<t.length;a++){s(a,t[a],r)}}i.decodePayload=function(t,e,n){if(typeof t!="string"){return i.decodePayloadAsBinary(t,e,n)}if(typeof e==="function"){n=e;e=null}var r;if(t==""){return n(f,0,1)}var s="",a,o;for(var c=0,l=t.length;c<l;c++){var h=t.charAt(c);if(":"!=h){s+=h}else{if(""==s||s!=(a=Number(s))){return n(f,0,1)}o=t.substr(c+1,a);if(s!=o.length){return n(f,0,1)}if(o.length){r=i.decodePacket(o,e,true);if(f.type==r.type&&f.data==r.data){return n(f,0,1)}var u=n(r,c+a,l);if(false===u)return}c+=a;s=""}}if(s!=""){return n(f,0,1)}};i.encodePayloadAsArrayBuffer=function(t,e){if(!t.length){return e(new ArrayBuffer(0))}function n(t,e){i.encodePacket(t,true,true,function(t){return e(null,t)})}T(t,n,function(t,i){var n=i.reduce(function(t,e){var i;if(typeof e==="string"){i=e.length}else{i=e.byteLength}return t+i.toString().length+i+2},0);var r=new Uint8Array(n);var s=0;i.forEach(function(t){var e=typeof t==="string";var i=t;if(e){var n=new Uint8Array(t.length);for(var a=0;a<t.length;a++){n[a]=t.charCodeAt(a)}i=n.buffer}if(e){r[s++]=0}else{r[s++]=1}var o=i.byteLength.toString();for(var a=0;a<o.length;a++){r[s++]=parseInt(o[a])}r[s++]=255;var n=new Uint8Array(i);for(var a=0;a<n.length;a++){r[s++]=n[a]}});return e(r.buffer)})};i.encodePayloadAsBlob=function(t,e){function n(t,e){i.encodePacket(t,true,true,function(t){var i=new Uint8Array(1);i[0]=1;if(typeof t==="string"){var n=new Uint8Array(t.length);for(var r=0;r<t.length;r++){n[r]=t.charCodeAt(r)}t=n.buffer;i[0]=0}var s=t instanceof ArrayBuffer?t.byteLength:t.size;var a=s.toString();var o=new Uint8Array(a.length+1);for(var r=0;r<a.length;r++){o[r]=parseInt(a[r])}o[a.length]=255;if(p){var c=new p([i.buffer,o.buffer,t]);e(null,c)}})}T(t,n,function(t,i){return e(new p(i))})};i.decodePayloadAsBinary=function(t,e,n){if(typeof e==="function"){n=e;e=null}var r=t;var a=[];var o=false;while(r.byteLength>0){var c=new Uint8Array(r);var l=c[0]===0;var h="";for(var u=1;;u++){if(c[u]==255)break;if(h.length>310){o=true;break}h+=c[u]}if(o)return n(f,0,1);r=s(r,2+h.length);h=parseInt(h);var d=s(r,0,h);if(l){try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(_){var p=new Uint8Array(d);d="";for(var u=0;u<p.length;u++){d+=String.fromCharCode(p[u])}}}a.push(d);r=s(r,h)}var m=a.length;a.forEach(function(t,r){n(i.decodePacket(t,e,true),r,m)})}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(t,e,i){e.exports=Object.keys||function n(t){var e=[];var i=Object.prototype.hasOwnProperty;for(var n in t){if(i.call(t,n)){e.push(n)}}return e}},{}],27:[function(t,e,i){e.exports=n;function n(t,e,i){var n=false;i=i||r;s.count=t;return t===0?e():s;function s(t,r){if(s.count<=0){throw new Error("after called too many times")}--s.count;if(t){n=true;e(t);e=i}else if(s.count===0&&!n){e(null,r)}}}function r(){}},{}],28:[function(t,e,i){e.exports=function(t,e,i){var n=t.byteLength;e=e||0;i=i||n;if(t.slice){return t.slice(e,i)}if(e<0){e+=n}if(i<0){i+=n}if(i>n){i=n}if(e>=n||e>=i||n===0){return new ArrayBuffer(0)}var r=new Uint8Array(t);var s=new Uint8Array(i-e);for(var a=e,o=0;a<i;a++,o++){s[o]=r[a]}return s.buffer}},{}],29:[function(t,e,i){(function(t){"use strict";i.encode=function(e){var i=new Uint8Array(e),n,r=i.length,s="";for(n=0;n<r;n+=3){s+=t[i[n]>>2];s+=t[(i[n]&3)<<4|i[n+1]>>4];s+=t[(i[n+1]&15)<<2|i[n+2]>>6];s+=t[i[n+2]&63]}if(r%3===2){s=s.substring(0,s.length-1)+"="}else if(r%3===1){s=s.substring(0,s.length-2)+"=="}return s};i.decode=function(e){var i=e.length*.75,n=e.length,r,s=0,a,o,c,l;if(e[e.length-1]==="="){i--;if(e[e.length-2]==="="){i--}}var h=new ArrayBuffer(i),u=new Uint8Array(h);for(r=0;r<n;r+=4){a=t.indexOf(e[r]);o=t.indexOf(e[r+1]);c=t.indexOf(e[r+2]);l=t.indexOf(e[r+3]);u[s++]=a<<2|o>>4;u[s++]=(o&15)<<4|c>>2;u[s++]=(c&3)<<6|l&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(t,e,i){(function(t){var i=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder;var n=function(){try{var t=new Blob(["hi"]);return t.size==2}catch(e){return false}}();var r=i&&i.prototype.append&&i.prototype.getBlob;function s(t,e){e=e||{};var n=new i;for(var r=0;r<t.length;r++){n.append(t[r])}return e.type?n.getBlob(e.type):n.getBlob()}e.exports=function(){if(n){return t.Blob}else if(r){return s}else{return undefined}}()}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(t,e,i){(function(i){var n=t("isarray");e.exports=r;function r(t){function e(t){if(!t)return false;if(i.Buffer&&i.Buffer.isBuffer(t)||i.ArrayBuffer&&t instanceof ArrayBuffer||i.Blob&&t instanceof Blob||i.File&&t instanceof File){return true}if(n(t)){for(var r=0;r<t.length;r++){if(e(t[r])){return true}}}else if(t&&"object"==typeof t){if(t.toJSON){t=t.toJSON()}for(var s in t){if(t.hasOwnProperty(s)&&e(t[s])){return true}}}return false}return e(t)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:32}],32:[function(t,e,i){e.exports=Array.isArray||function(t){return Object.prototype.toString.call(t)=="[object Array]"}},{}],33:[function(e,i,n){(function(e){(function(r){var s=typeof n=="object"&&n;var a=typeof i=="object"&&i&&i.exports==s&&i;var o=typeof e=="object"&&e;if(o.global===o||o.window===o){r=o}var c=String.fromCharCode;function l(t){var e=[];var i=0;var n=t.length;var r;var s;while(i<n){r=t.charCodeAt(i++);if(r>=55296&&r<=56319&&i<n){s=t.charCodeAt(i++);if((s&64512)==56320){e.push(((r&1023)<<10)+(s&1023)+65536)}else{e.push(r);i--}}else{e.push(r)}}return e}function h(t){var e=t.length;var i=-1;var n;var r="";while(++i<e){n=t[i];if(n>65535){n-=65536;r+=c(n>>>10&1023|55296);n=56320|n&1023}r+=c(n)}return r}function u(t,e){return c(t>>e&63|128)}function d(t){if((t&4294967168)==0){return c(t)}var e="";if((t&4294965248)==0){e=c(t>>6&31|192)}else if((t&4294901760)==0){e=c(t>>12&15|224);e+=u(t,6)}else if((t&4292870144)==0){e=c(t>>18&7|240);e+=u(t,12);e+=u(t,6)}e+=c(t&63|128);return e}function _(t){var e=l(t);var i=e.length;var n=-1;var r;var s="";while(++n<i){r=e[n];s+=d(r)}return s}function f(){if(v>=g){throw Error("Invalid byte index")}var t=m[v]&255;v++;if((t&192)==128){return t&63}throw Error("Invalid continuation byte")}function p(){var t;var e;var i;var n;var r;if(v>g){throw Error("Invalid byte index")}if(v==g){return false}t=m[v]&255;v++;if((t&128)==0){return t}if((t&224)==192){var e=f();r=(t&31)<<6|e;if(r>=128){return r}else{throw Error("Invalid continuation byte")}}if((t&240)==224){e=f();i=f();r=(t&15)<<12|e<<6|i;if(r>=2048){return r}else{throw Error("Invalid continuation byte")}}if((t&248)==240){e=f();i=f();n=f();r=(t&15)<<18|e<<12|i<<6|n;if(r>=65536&&r<=1114111){return r}}throw Error("Invalid UTF-8 detected")}var m;var g;var v;function y(t){m=l(t);g=m.length;v=0;var e=[];var i;while((i=p())!==false){e.push(i)}return h(e)}var T={version:"2.0.0",encode:_,decode:y};if(typeof t=="function"&&typeof t.amd=="object"&&t.amd){t(function(){return T})}else if(s&&!s.nodeType){if(a){a.exports=T}else{var C={};var S=C.hasOwnProperty;for(var x in T){S.call(T,x)&&(s[x]=T[x])}}}else{r.utf8=T}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],34:[function(t,e,i){(function(t){var i=/^[\],:{}\s]*$/;var n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var s=/(?:^|:|,)(?:\s*\[)+/g;var a=/^\s+/;var o=/\s+$/;e.exports=function c(e){if("string"!=typeof e||!e){return null}e=e.replace(a,"").replace(o,"");if(t.JSON&&JSON.parse){return JSON.parse(e)}if(i.test(e.replace(n,"@").replace(r,"]").replace(s,""))){return new Function("return "+e)()}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(t,e,i){i.encode=function(t){var e="";for(var i in t){if(t.hasOwnProperty(i)){if(e.length)e+="&";e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i])}}return e};i.decode=function(t){var e={};var i=t.split("&");for(var n=0,r=i.length;n<r;n++){var s=i[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},{}],36:[function(t,e,i){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function s(t){var e=t,i=t.indexOf("["),s=t.indexOf("]");if(i!=-1&&s!=-1){t=t.substring(0,i)+t.substring(i,s).replace(/:/g,";")+t.substring(s,t.length)}var a=n.exec(t||""),o={},c=14;while(c--){o[r[c]]=a[c]||""}if(i!=-1&&s!=-1){o.source=e;o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":");o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":");o.ipv6uri=true}return o}},{}],37:[function(t,e,i){var n=function(){return this}();var r=n.WebSocket||n.MozWebSocket;e.exports=r?s:null;function s(t,e,i){var n;if(e){n=new r(t,e)}else{n=new r(t)}return n}if(r)s.prototype=r.prototype},{}],38:[function(t,e,i){(function(i){var n=t("isarray");e.exports=r;function r(t){function e(t){if(!t)return false;if(i.Buffer&&i.Buffer.isBuffer(t)||i.ArrayBuffer&&t instanceof ArrayBuffer||i.Blob&&t instanceof Blob||i.File&&t instanceof File){return true}if(n(t)){for(var r=0;r<t.length;r++){if(e(t[r])){return true}}}else if(t&&"object"==typeof t){if(t.toJSON){t=t.toJSON()}for(var s in t){if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s])){return true}}}return false}return e(t)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:39}],39:[function(t,e,i){e.exports=t(32)},{}],40:[function(t,e,i){var n=t("global");try{e.exports="XMLHttpRequest"in n&&"withCredentials"in new n.XMLHttpRequest}catch(r){e.exports=false}},{global:41}],41:[function(t,e,i){e.exports=function(){return this}()},{}],42:[function(t,e,i){var n=[].indexOf;e.exports=function(t,e){if(n)return t.indexOf(e);for(var i=0;i<t.length;++i){if(t[i]===e)return i}return-1}},{}],43:[function(t,e,i){var n=Object.prototype.hasOwnProperty;i.keys=Object.keys||function(t){var e=[];for(var i in t){if(n.call(t,i)){e.push(i)}}return e};i.values=function(t){var e=[];for(var i in t){if(n.call(t,i)){e.push(t[i])}}return e};i.merge=function(t,e){for(var i in e){if(n.call(e,i)){t[i]=e[i]}}return t};i.length=function(t){return i.keys(t).length};i.isEmpty=function(t){return 0==i.length(t)}},{}],44:[function(t,e,i){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function s(t){var e=n.exec(t||""),i={},s=14;while(s--){i[r[s]]=e[s]||""}return i}},{}],45:[function(t,e,i){(function(e){var n=t("isarray");var r=t("./is-buffer");i.deconstructPacket=function(t){var e=[];var i=t.data;function s(t){if(!t)return t;if(r(t)){var i={_placeholder:true,num:e.length};e.push(t);return i}else if(n(t)){var a=new Array(t.length);for(var o=0;o<t.length;o++){a[o]=s(t[o])}return a}else if("object"==typeof t&&!(t instanceof Date)){var a={};for(var c in t){a[c]=s(t[c])}return a}return t}var a=t;a.data=s(i);a.attachments=e.length;return{packet:a,buffers:e}};i.reconstructPacket=function(t,e){var i=0;function r(t){if(t&&t._placeholder){var i=e[t.num];return i}else if(n(t)){for(var s=0;s<t.length;s++){t[s]=r(t[s])}return t}else if(t&&"object"==typeof t){for(var a in t){t[a]=r(t[a])}return t}return t}t.data=r(t.data);t.attachments=undefined;return t};i.removeBlobs=function(t,i){function s(t,c,l){if(!t)return t;if(e.Blob&&t instanceof Blob||e.File&&t instanceof File){a++;var h=new FileReader;h.onload=function(){if(l){l[c]=this.result}else{o=this.result}if(!--a){i(o)}};h.readAsArrayBuffer(t)}else if(n(t)){for(var u=0;u<t.length;u++){s(t[u],u,t)}}else if(t&&"object"==typeof t&&!r(t)){for(var d in t){s(t[d],d,t)}}}var a=0;var o=t;s(o);if(!a){i(o)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(t,e,i){var n=t("debug")("socket.io-parser");var r=t("json3");var s=t("isarray");var a=t("component-emitter");var o=t("./binary");var c=t("./is-buffer");i.protocol=4;i.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];i.CONNECT=0;i.DISCONNECT=1;i.EVENT=2;i.ACK=3;i.ERROR=4;i.BINARY_EVENT=5;i.BINARY_ACK=6;i.Encoder=l;i.Decoder=d;function l(){}l.prototype.encode=function(t,e){n("encoding packet %j",t);if(i.BINARY_EVENT==t.type||i.BINARY_ACK==t.type){u(t,e)}else{var r=h(t);e([r])}};function h(t){var e="";var s=false;e+=t.type;if(i.BINARY_EVENT==t.type||i.BINARY_ACK==t.type){e+=t.attachments;e+="-"}if(t.nsp&&"/"!=t.nsp){s=true;e+=t.nsp}if(null!=t.id){if(s){e+=",";s=false}e+=t.id}if(null!=t.data){if(s)e+=",";e+=r.stringify(t.data)}n("encoded %j as %s",t,e);return e}function u(t,e){function i(t){var i=o.deconstructPacket(t);var n=h(i.packet);var r=i.buffers;r.unshift(n);e(r)}o.removeBlobs(t,i)}function d(){this.reconstructor=null}a(d.prototype);d.prototype.add=function(t){var e;if("string"==typeof t){e=_(t);if(i.BINARY_EVENT==e.type||i.BINARY_ACK==e.type){this.reconstructor=new f(e);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",e)}}else{this.emit("decoded",e)}}else if(c(t)||t.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{e=this.reconstructor.takeBinaryData(t);if(e){this.reconstructor=null;this.emit("decoded",e)}}}else{throw new Error("Unknown type: "+t)}};function _(t){var e={};var s=0;e.type=Number(t.charAt(0));if(null==i.types[e.type])return p();if(i.BINARY_EVENT==e.type||i.BINARY_ACK==e.type){var a="";while(t.charAt(++s)!="-"){a+=t.charAt(s);if(s==t.length)break}if(a!=Number(a)||t.charAt(s)!="-"){throw new Error("Illegal attachments")}e.attachments=Number(a)}if("/"==t.charAt(s+1)){e.nsp="";while(++s){var o=t.charAt(s);if(","==o)break;e.nsp+=o;if(s==t.length)break}}else{e.nsp="/"}var c=t.charAt(s+1);if(""!==c&&Number(c)==c){e.id="";while(++s){var o=t.charAt(s);if(null==o||Number(o)!=o){--s;break}e.id+=t.charAt(s);if(s==t.length)break}e.id=Number(e.id)}if(t.charAt(++s)){try{e.data=r.parse(t.substr(s))}catch(l){return p()}}n("decoded %s as %j",t,e);return e}d.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function f(t){this.reconPack=t;this.buffers=[]}f.prototype.takeBinaryData=function(t){this.buffers.push(t);if(this.buffers.length==this.reconPack.attachments){var e=o.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return e}return null};f.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function p(t){return{type:i.ERROR,data:"parser error"}}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(t,e,i){(function(t){e.exports=i;function i(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],48:[function(t,e,i){e.exports=t(32)},{}],49:[function(e,i,n){(function(e){var i={}.toString,r,s,a;var o=typeof t==="function"&&t.amd;var c=typeof JSON=="object"&&JSON;var l=typeof n=="object"&&n&&!n.nodeType&&n;if(l&&c){l.stringify=c.stringify;l.parse=c.parse}else{l=e.JSON=c||{}}var h=new Date(-0xc782b5b800cec);try{h=h.getUTCFullYear()==-109252&&h.getUTCMonth()===0&&h.getUTCDate()===1&&h.getUTCHours()==10&&h.getUTCMinutes()==37&&h.getUTCSeconds()==6&&h.getUTCMilliseconds()==708}catch(u){}function d(t){if(d[t]!==a){return d[t]}var e;if(t=="bug-string-char-index"){e="a"[0]!="a"}else if(t=="json"){e=d("json-stringify")&&d("json-parse")}else{var n,r='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(t=="json-stringify"){var s=l.stringify,o=typeof s=="function"&&h;if(o){(n=function(){return 1}).toJSON=n;try{o=s(0)==="0"&&s(new Number)==="0"&&s(new String)=='""'&&s(i)===a&&s(a)===a&&s()===a&&s(n)==="1"&&s([n])=="[1]"&&s([a])=="[null]"&&s(null)=="null"&&s([a,i,null])=="[null,null,null]"&&s({a:[n,true,false,null,"\x00\b\n\f\r	"]})==r&&s(null,n)==="1"&&s([1,2],null,1)=="[\n 1,\n 2\n]"&&s(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&s(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&s(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&s(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(c){o=false}}e=o}if(t=="json-parse"){var u=l.parse;if(typeof u=="function"){try{if(u("0")===0&&!u(false)){n=u(r);var _=n["a"].length==5&&n["a"][0]===1;if(_){try{_=!u('"	"')}catch(c){}if(_){try{_=u("01")!==1}catch(c){}}if(_){try{_=u("1.")!==1}catch(c){}}}}}catch(c){_=false}}e=_}}return d[t]=!!e}if(!d("json")){var _="[object Function]";var f="[object Date]";var p="[object Number]";var m="[object String]";var g="[object Array]";var v="[object Boolean]";var y=d("bug-string-char-index");if(!h){var T=Math.floor;var C=[0,31,59,90,120,151,181,212,243,273,304,334];var S=function(t,e){return C[e]+365*(t-1970)+T((t-1969+(e=+(e>1)))/4)-T((t-1901+e)/100)+T((t-1601+e)/400)}}if(!(r={}.hasOwnProperty)){r=function(t){var e={},n;if((e.__proto__=null,e.__proto__={toString:1},e).toString!=i){r=function(t){var e=this.__proto__,i=t in(this.__proto__=null,this);this.__proto__=e;return i}}else{n=e.constructor;r=function(t){var e=(this.constructor||n).prototype;return t in this&&!(t in e&&this[t]===e[t])}}e=null;return r.call(this,t)}}var x={"boolean":1,number:1,string:1,undefined:1};var E=function(t,e){var i=typeof t[e];return i=="object"?!!t[e]:!x[i];
};s=function(t,e){var n=0,a,o,c;(a=function(){this.valueOf=0}).prototype.valueOf=0;o=new a;for(c in o){if(r.call(o,c)){n++}}a=o=null;if(!n){o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];s=function(t,e){var n=i.call(t)==_,s,a;var c=!n&&typeof t.constructor!="function"&&E(t,"hasOwnProperty")?t.hasOwnProperty:r;for(s in t){if(!(n&&s=="prototype")&&c.call(t,s)){e(s)}}for(a=o.length;s=o[--a];c.call(t,s)&&e(s));}}else if(n==2){s=function(t,e){var n={},s=i.call(t)==_,a;for(a in t){if(!(s&&a=="prototype")&&!r.call(n,a)&&(n[a]=1)&&r.call(t,a)){e(a)}}}}else{s=function(t,e){var n=i.call(t)==_,s,a;for(s in t){if(!(n&&s=="prototype")&&r.call(t,s)&&!(a=s==="constructor")){e(s)}}if(a||r.call(t,s="constructor")){e(s)}}}return s(t,e)};if(!d("json-stringify")){var b={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var A="000000";var R=function(t,e){return(A+(e||0)).slice(-t)};var P="\\u00";var w=function(t){var e='"',i=0,n=t.length,r=n>10&&y,s;if(r){s=t.split("")}for(;i<n;i++){var a=t.charCodeAt(i);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=b[a];break;default:if(a<32){e+=P+R(2,a.toString(16));break}e+=r?s[i]:y?t.charAt(i):t[i]}}return e+'"'};var I=function(t,e,n,o,c,l,h){var u,d,_,y,C,x,E,b,A,P,D,L,O,B,F,N;try{u=e[t]}catch(M){}if(typeof u=="object"&&u){d=i.call(u);if(d==f&&!r.call(u,"toJSON")){if(u>-1/0&&u<1/0){if(S){C=T(u/864e5);for(_=T(C/365.2425)+1970-1;S(_+1,0)<=C;_++);for(y=T((C-S(_,0))/30.42);S(_,y+1)<=C;y++);C=1+C-S(_,y);x=(u%864e5+864e5)%864e5;E=T(x/36e5)%24;b=T(x/6e4)%60;A=T(x/1e3)%60;P=x%1e3}else{_=u.getUTCFullYear();y=u.getUTCMonth();C=u.getUTCDate();E=u.getUTCHours();b=u.getUTCMinutes();A=u.getUTCSeconds();P=u.getUTCMilliseconds()}u=(_<=0||_>=1e4?(_<0?"-":"+")+R(6,_<0?-_:_):R(4,_))+"-"+R(2,y+1)+"-"+R(2,C)+"T"+R(2,E)+":"+R(2,b)+":"+R(2,A)+"."+R(3,P)+"Z"}else{u=null}}else if(typeof u.toJSON=="function"&&(d!=p&&d!=m&&d!=g||r.call(u,"toJSON"))){u=u.toJSON(t)}}if(n){u=n.call(e,t,u)}if(u===null){return"null"}d=i.call(u);if(d==v){return""+u}else if(d==p){return u>-1/0&&u<1/0?""+u:"null"}else if(d==m){return w(""+u)}if(typeof u=="object"){for(B=h.length;B--;){if(h[B]===u){throw TypeError()}}h.push(u);D=[];F=l;l+=c;if(d==g){for(O=0,B=u.length;O<B;O++){L=I(O,u,n,o,c,l,h);D.push(L===a?"null":L)}N=D.length?c?"[\n"+l+D.join(",\n"+l)+"\n"+F+"]":"["+D.join(",")+"]":"[]"}else{s(o||u,function(t){var e=I(t,u,n,o,c,l,h);if(e!==a){D.push(w(t)+":"+(c?" ":"")+e)}});N=D.length?c?"{\n"+l+D.join(",\n"+l)+"\n"+F+"}":"{"+D.join(",")+"}":"{}"}h.pop();return N}};l.stringify=function(t,e,n){var r,s,a,o;if(typeof e=="function"||typeof e=="object"&&e){if((o=i.call(e))==_){s=e}else if(o==g){a={};for(var c=0,l=e.length,h;c<l;h=e[c++],(o=i.call(h),o==m||o==p)&&(a[h]=1));}}if(n){if((o=i.call(n))==p){if((n-=n%1)>0){for(r="",n>10&&(n=10);r.length<n;r+=" ");}}else if(o==m){r=n.length<=10?n:n.slice(0,10)}}return I("",(h={},h[""]=t,h),s,a,r,"",[])}}if(!d("json-parse")){var D=String.fromCharCode;var L={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"};var O,B;var F=function(){O=B=null;throw SyntaxError()};var N=function(){var t=B,e=t.length,i,n,r,s,a;while(O<e){a=t.charCodeAt(O);switch(a){case 9:case 10:case 13:case 32:O++;break;case 123:case 125:case 91:case 93:case 58:case 44:i=y?t.charAt(O):t[O];O++;return i;case 34:for(i="@",O++;O<e;){a=t.charCodeAt(O);if(a<32){F()}else if(a==92){a=t.charCodeAt(++O);switch(a){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:i+=L[a];O++;break;case 117:n=++O;for(r=O+4;O<r;O++){a=t.charCodeAt(O);if(!(a>=48&&a<=57||a>=97&&a<=102||a>=65&&a<=70)){F()}}i+=D("0x"+t.slice(n,O));break;default:F()}}else{if(a==34){break}a=t.charCodeAt(O);n=O;while(a>=32&&a!=92&&a!=34){a=t.charCodeAt(++O)}i+=t.slice(n,O)}}if(t.charCodeAt(O)==34){O++;return i}F();default:n=O;if(a==45){s=true;a=t.charCodeAt(++O)}if(a>=48&&a<=57){if(a==48&&(a=t.charCodeAt(O+1),a>=48&&a<=57)){F()}s=false;for(;O<e&&(a=t.charCodeAt(O),a>=48&&a<=57);O++);if(t.charCodeAt(O)==46){r=++O;for(;r<e&&(a=t.charCodeAt(r),a>=48&&a<=57);r++);if(r==O){F()}O=r}a=t.charCodeAt(O);if(a==101||a==69){a=t.charCodeAt(++O);if(a==43||a==45){O++}for(r=O;r<e&&(a=t.charCodeAt(r),a>=48&&a<=57);r++);if(r==O){F()}O=r}return+t.slice(n,O)}if(s){F()}if(t.slice(O,O+4)=="true"){O+=4;return true}else if(t.slice(O,O+5)=="false"){O+=5;return false}else if(t.slice(O,O+4)=="null"){O+=4;return null}F()}}return"$"};var M=function(t){var e,i;if(t=="$"){F()}if(typeof t=="string"){if((y?t.charAt(0):t[0])=="@"){return t.slice(1)}if(t=="["){e=[];for(;;i||(i=true)){t=N();if(t=="]"){break}if(i){if(t==","){t=N();if(t=="]"){F()}}else{F()}}if(t==","){F()}e.push(M(t))}return e}else if(t=="{"){e={};for(;;i||(i=true)){t=N();if(t=="}"){break}if(i){if(t==","){t=N();if(t=="}"){F()}}else{F()}}if(t==","||typeof t!="string"||(y?t.charAt(0):t[0])!="@"||N()!=":"){F()}e[t.slice(1)]=M(N())}return e}F()}return t};var V=function(t,e,i){var n=k(t,e,i);if(n===a){delete t[e]}else{t[e]=n}};var k=function(t,e,n){var r=t[e],a;if(typeof r=="object"&&r){if(i.call(r)==g){for(a=r.length;a--;){V(r,a,n)}}else{s(r,function(t){V(r,t,n)})}}return n.call(t,e,r)};l.parse=function(t,e){var n,r;O=0;B=""+t;n=M(N());if(N()!="$"){F()}O=B=null;return e&&i.call(e)==_?k((r={},r[""]=n,r),"",e):n}}}if(o){t(function(){return l})}})(this)},{}],50:[function(t,e,i){e.exports=n;function n(t,e){var i=[];e=e||0;for(var n=e||0;n<t.length;n++){i[n-e]=t[n]}return i}},{}]},{},[1])(1)});var gaf=gaf||{};gaf.COMPRESSION_NONE=4669766;gaf.COMPRESSION_ZIP=4669763;gaf.IDNONE=4294967295;gaf.FIRST_FRAME_INDEX=0;gaf.EFFECT_DROP_SHADOW=0;gaf.EFFECT_BLUR=1;gaf.EFFECT_GLOW=2;gaf.EFFECT_COLOR_MATRIX=6;gaf.ACTION_STOP=0;gaf.ACTION_PLAY=1;gaf.ACTION_GO_TO_AND_STOP=2;gaf.ACTION_GO_TO_AND_PLAY=3;gaf.ACTION_DISPATCH_EVENT=4;gaf.PI_FRAME=0;gaf.PI_EVENT_TYPE=0;gaf.TYPE_TEXTURE=0;gaf.TYPE_TEXT_FIELD=1;gaf.TYPE_TIME_LINE=2;gaf.UNIFORM_BLUR_TEXEL_OFFSET="u_step";gaf.UNIFORM_GLOW_TEXEL_OFFSET="u_step";gaf.UNIFORM_GLOW_COLOR="u_glowColor";gaf.UNIFORM_ALPHA_TINT_MULT="colorTransformMult";gaf.UNIFORM_ALPHA_TINT_OFFSET="colorTransformOffsets";gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY="colorMatrix";gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX="colorMatrix2";var gaf=gaf||{};gaf._tmp=gaf._tmp||{};gaf._initialized=false;gaf.CCGAFLoader=function(){this.load=function(t,e,i,n){if(!gaf._initialized){gaf._setup()}var r=new gaf.Loader;r.LoadFile(t,function(t){n(null,t)})}};gaf._setup=function(){gaf._setupShaders();gaf._initialized=true};cc.loader.register(".gaf",new gaf.CCGAFLoader);gaf.CGAffineTransformCocosFormatFromFlashFormat=function(t){var e={};e.a=t.a;e.b=-t.b;e.c=-t.c;e.d=t.d;e.tx=t.tx;e.ty=-t.ty;return e};gaf._AssetPreload=function(){this["0"]=this.End;this["1"]=this.Atlases;this["2"]=this.AnimationMasks;this["3"]=this.AnimationObjects;this["4"]=this.AnimationFrames;this["5"]=this.NamedParts;this["6"]=this.Sequences;this["7"]=this.TextFields;this["8"]=this.Atlases;this["9"]=this.Stage;this["10"]=this.AnimationObjects;this["11"]=this.AnimationMasks;this["12"]=this.AnimationFrames;this["13"]=this.TimeLine};gaf._AssetPreload.prototype.End=function(t,e,i){if(i){i.getFps=function(){return t.getSceneFps()}}};gaf._AssetPreload.prototype.Tag=function(t,e,i){this[e.tagId].call(this,t,e.content,i)};gaf._AssetPreload.prototype.Tags=function(t,e,i){var n=this;e.forEach(function(e){n.Tag(t,e,i)})};gaf._AssetPreload.prototype.AtlasCreateFrames=function(t,e,i){t.forEach(function(t){var n=e._atlases[t.atlasId];var r=cc.rect(t.origin.x,t.origin.y,t.size.x,t.size.y);var s=new cc.SpriteFrame(n,r);s._gafAnchor={x:0-(0-t.pivot.x/t.size.x),y:0+(1-t.pivot.y/t.size.y)};i[t.elementAtlasId]=s})};gaf._AssetPreload.prototype.Atlases=function(t,e,i){var n=t._atlasScales[e.scale]=t._atlasScales[e.scale]||[];var r=cc.Director._getInstance().getContentScaleFactor();e.atlases.forEach(function(i){var s=i.id;var a=function(){gaf._AssetPreload.AtlasCreateFrames(e.elements,t,n)};var o="";i.sources.forEach(function(t){if(t.csf===r){o=t.source}});cc.assert(o,"GAF Error. Texture for current CSF not found. Reconvert animation with correct parameters.");if(t._textureLoadDelegate){o=t._textureLoadDelegate(o)}var c=false;var l=t._getSearchPaths(o);for(var h=0,u=l.length;h<u;++h){var d=l[h];var _=cc.textureCache.getTextureForKey(d);if(_&&_.isLoaded()){_.handleLoadedTexture(true);c=true;t._atlases[s]=_;a();break}}if(!c){var f=function(e){e.handleLoadedTexture(true);t._onAtlasLoaded(s,e)};var p=function(){cc.log("GAF Error. Couldn't find `"+o+"` required by `"+t.getGAFFileName()+"`")};if(!t._atlasesToLoad.hasOwnProperty(s)){gaf._AtlasLoader.loadArray(l,f,p);t._atlasesToLoad[s]={}}t._onLoadTasks.push(a)}})};gaf._AssetPreload.prototype.AnimationObjects=function(t,e,i){e.forEach(function(e){e.type=e.type===undefined?gaf.TYPE_TEXTURE:e.type;i._objects.push(e.objectId);t._objects[e.objectId]=e})};gaf._AssetPreload.prototype.convertTint=function(t,e){if(!t)return null;return{mult:{r:t.redMultiplier*255,g:t.greenMultiplier*255,b:t.blueMultiplier*255,a:e*255},offset:{r:t.redOffset*255,g:t.greenOffset*255,b:t.blueOffset*255,a:t.alphaOffset*255}}};gaf._AssetPreload.prototype.convertState=function(t){return{hasColorTransform:t.hasColorTransform,hasMask:t.hasMask,hasEffect:t.hasEffect,objectIdRef:t.objectIdRef,depth:t.depth,alpha:t.alpha*255,matrix:gaf.CGAffineTransformCocosFormatFromFlashFormat(t.matrix),colorTransform:this.convertTint(t.colorTransform,t.alpha),effect:t.effect,maskObjectIdRef:t.maskObjectIdRef}};gaf._AssetPreload.prototype.AnimationFrames=function(t,e,i){var n=this;cc.assert(i,"Error. Time Line should not be null.");var r={};var s=[];var a={};for(var o=0,c=e.length;o<c;++o){var l=e[o];if(l.state){l.state.forEach(function(t){if(t.alpha!==0){r[t.objectIdRef]=n.convertState(t)}else{r[t.objectIdRef]=null}})}var h=[];for(var u in r){if(r.hasOwnProperty(u)&&r[u]){h.push(r[u])}}a=l;s[l.frame-1]={states:h,actions:l.actions||null}}i.getFrames=function(){return s}};gaf._AssetPreload.prototype.NamedParts=function(t,e,i){var n={};e.forEach(function(t){n[t.name]=t.objectId});i.getNamedParts=function(){return n}};gaf._AssetPreload.prototype.Sequences=function(t,e,i){var n={};e.forEach(function(t){n[t.id]={start:t.start-1,end:t.end}});i.getSequences=function(){return n}};gaf._AssetPreload.prototype.TextFields=function(t,e,i){debugger};gaf._AssetPreload.prototype.Stage=function(t,e,i){t._sceneFps=e.fps;t._sceneColor=e.color;t._sceneWidth=e.width;t._sceneHeight=e.height};gaf._AssetPreload.prototype.AnimationMasks=function(t,e,i){e.forEach(function(e){e.type=e.type===undefined?gaf.TYPE_TEXTURE:e.type;i._objects.push(e.objectId);t._masks[e.objectId]=e})};gaf._AssetPreload.prototype.TimeLine=function(t,e,i){var n=new gaf._TimeLineProto(t,e.animationFrameCount,e.boundingBox,e.pivotPoint,e.id,e.linkageName);t._pushTimeLine(n);this.Tags(t,e.tags,n)};gaf._AssetPreload=new gaf._AssetPreload;var gaf=gaf||{};gaf.Asset=cc.Class.extend({_className:"GAFAsset",_header:null,_timeLines:null,_textFields:null,_protos:null,_objects:null,_masks:null,_rootTimeLine:null,_textureLoadDelegate:null,_sceneFps:60,_sceneWidth:0,_sceneHeight:0,_sceneColor:0,_gafData:null,_desiredAtlasScale:1,_usedAtlasScale:0,_atlases:null,_onLoadTasks:null,_atlasScales:null,_textureLoaded:false,_atlasesToLoad:null,_gafName:null,initWithGAFFile:function(t,e){var i=this;this._textureLoadDelegate=e;this._gafName=t;var n=cc.loader.getRes(t);if(!n){cc.loader.load(t,function(t,e){if(!t){i._init(e[0])}})}else{return this._init(n)}return false},initWithGAFBundle:function(t,e,i){cc.assert(false,"initWithGAFBundle is not yet implemented");return false},setRootTimelineWithName:function(t){for(var e=0,i=this._timeLines.length;e<i;++e){var n=this._timeLines[e];if(n&&n.getLinkageName()===t){this._setRootTimeline(n);return}}},isAssetVersionPlayable:function(){return true},desiredAtlasScale:function(){return this._desiredAtlasScale},setDesiredAtlasScale:function(t){this._desiredAtlasScale=t;for(var e in this._atlasScales)if(this._atlasScales.hasOwnProperty(e)){if(this._usedAtlasScale===0||Math.abs(this._usedAtlasScale-t)>Math.abs(e-t)){this._usedAtlasScale=e}}},createObject:function(){return this._instantiateGaf(this._gafData)},createObjectAndRun:function(t){cc.assert(arguments.length===1,"GAFAsset::createObjectAndRun should have one param");var e=this._instantiateGaf(this._gafData);e.setLooped(t,true);e.start();return e},setTextureLoadDelegate:function(t){debugger},getSceneFps:function(){return this._sceneFps},getSceneWidth:function(){debugger},getSceneHeight:function(){debugger},getSceneColor:function(){debugger},setSceneFps:function(t){this._sceneFps=t},setSceneWidth:function(t){debugger},setSceneHeight:function(t){debugger},setSceneColor:function(t){debugger},getHeader:function(){return this._header},getGAFFileName:function(){return this._gafName},ctor:function(){this._header={};this._timeLines=[];this._textFields=[];this._objects=[];this._masks=[];this._protos=[];this._atlases={};this._onLoadTasks=[];this._atlasScales={};this._atlasesToLoad={};if(arguments.length>0)this.initWithGAFFile.apply(this,arguments)},_getProtos:function(){return this._protos},_setRootTimeline:function(t){this._rootTimeLine=t;this._header.pivot=t.getPivot();this._header.frameSize=t.getRect()},_setHeader:function(t){for(var e in t){if(t.hasOwnProperty(e)){this._header[e]=t[e]}}},_getMajorVerison:function(){return this._header.versionMajor},_init:function(t){var e=this;this._gafData=t;this._setHeader(t.header);this._timeLinesToLink=[];if(this._getMajorVerison()<4){this._pushTimeLine(new gaf._TimeLineProto(this,this._header.framesCount,this._header.frameSize,this._header.pivot))}gaf._AssetPreload.Tags(this,t.tags,this._rootTimeLine);this._objects.forEach(function(t){switch(t.type){case gaf.TYPE_TEXTURE:if(!e._protos[t.objectId]){e._protos[t.objectId]=new gaf._SpriteProto(e,e._atlasScales,t.elementAtlasIdRef)}break;case gaf.TYPE_TIME_LINE:e._protos[t.objectId]=e._timeLines[t.elementAtlasIdRef];break;case gaf.TYPE_TEXT_FIELD:e._protos[t.objectId]=e._textFields[t.elementAtlasIdRef];break;default:cc.log("Unknown object type: "+t.type);break}});this._masks.forEach(function(t){if(e._protos[t.objectId]){return}var i=null;switch(t.type){case gaf.TYPE_TEXTURE:i=new gaf._SpriteProto(e,e._atlasScales,t.elementAtlasIdRef);break;case gaf.TYPE_TIME_LINE:i=e._timeLines[t.elementAtlasIdRef];break;case gaf.TYPE_TEXT_FIELD:i=e._textFields[t.elementAtlasIdRef];break}e._protos[t.objectId]=new gaf._MaskProto(e,i,t.elementAtlasIdRef)});this.setDesiredAtlasScale(this._desiredAtlasScale);if(Object.keys(this._atlasesToLoad).length===0){this._textureLoaded=true;this.dispatchEvent("load")}},_pushTimeLine:function(t){this._timeLines[t.getId()]=t;if(t.getId()===0){this._setRootTimeline(t)}},_instantiateGaf:function(){var t=null;t=this._rootTimeLine._gafConstruct();return t},_onAtlasLoaded:function(t,e){this._atlases[t]=e;delete this._atlasesToLoad[t];if(Object.keys(this._atlasesToLoad).length===0){this._onLoadTasks.forEach(function(t){t()});this._onLoadTasks.length=0;this._textureLoaded=true;this.dispatchEvent("load")}},isLoaded:function(){return this._textureLoaded},_getSearchPaths:function(t){var e=this.getGAFFileName().split("/");e[e.length-1]=t;var i=e.join("/");return[t,i]}});gaf.Asset.create=function(t,e){return new gaf.Asset(t,e)};gaf.Asset.createWithBundle=function(t,e,i){var n=new gaf.Asset;n.initWithGAFBundle(t,e,i);return n};cc.EventHelper.prototype.apply(gaf.Asset.prototype);var gaf=gaf||{};gaf._stateHasCtx=function(t){if(t.hasColorTransform&&(t.colorTransform.offset.r>0||t.colorTransform.offset.g>0||t.colorTransform.offset.b>0||t.colorTransform.offset.a>0)){return true}if(t.hasEffect){for(var e=0,i=t.effect.length;e<i;++e){if(t.effect[e].type===gaf.EFFECT_COLOR_MATRIX)return true}}return false};gaf.Object=cc.Node.extend({_asset:null,_className:"GAFObject",_id:gaf.IDNONE,_gafproto:null,_parentTimeLine:null,_lastVisibleInFrame:0,_filterStack:null,_cascadeColorMult:null,_cascadeColorOffset:null,_needsCtx:false,_usedAtlasScale:1,ctor:function(t){if(arguments.length==1){this._usedAtlasScale=t}this._super();this._cascadeColorMult=cc.color(255,255,255,255);this._cascadeColorOffset=cc.color(0,0,0,0);this._filterStack=[]},setAnimationStartedNextLoopDelegate:function(t){},setAnimationFinishedPlayDelegate:function(t){},setLooped:function(t){},getBoundingBoxForCurrentFrame:function(){return null},setFps:function(t){},getObjectByName:function(t){return null},clearSequence:function(){},getIsAnimationRunning:function(){return false},getSequences:function(){return[]},gotoAndStop:function(t){},getStartFrame:function(t){return gaf.IDNONE},setFramePlayedDelegate:function(t){},getCurrentFrameIndex:function(){return gaf.IDNONE},getTotalFrameCount:function(){return 0},start:function(){},stop:function(){},isVisibleInCurrentFrame:function(){return!(this._parentTimeLine&&this._parentTimeLine.getCurrentFrameIndex()+1!=this._lastVisibleInFrame)},isDone:function(){return true},playSequence:function(t,e,i){return false},isReversed:function(){return false},setSequenceDelegate:function(t){},setFrame:function(t){return false},setControlDelegate:function(t){},getEndFrame:function(t){return gaf.IDNONE},pauseAnimation:function(){},gotoAndPlay:function(t){},isLooped:function(){return false},resumeAnimation:function(){},setReversed:function(t){},hasSequences:function(){return false},getFps:function(){return 60},setLocator:function(t){},setExternalTransform:function(t){if(!cc.affineTransformEqualToTransform(this._additionalTransform,t)){this.setAdditionalTransform(t)}},getExternalTransform:function(){return this._additionalTransform},setAnimationRunning:function(){},_enableTick:function(t){},_resetState:function(){},_updateVisibility:function(t,e){var i=t.hasColorTransform?t.colorTransform.offset.a:0;this.setOpacity(t.alpha+i)},isVisible:function(){return this.getOpacity()>0},visit:function(t){if(this.isVisibleInCurrentFrame()){this._super(t)}},_getFilters:function(){return null},_processAnimation:function(){},_applyState:function(t,e){this._applyStateSuper(t,e)},_applyStateSuper:function(t,e){this._needsCtx=e._needsCtx;this._filterStack.length=0;this._parentTimeLine=e;if(this._usedAtlasScale!=1){var i=cc.clone(t.matrix);i.tx*=this._usedAtlasScale;i.ty*=this._usedAtlasScale;this.setExternalTransform(i)}else{this.setExternalTransform(t.matrix)}if(t.hasEffect){this._filterStack=this._filterStack.concat(t.effect);this._needsCtx=true}if(e._filterStack&&e._filterStack.length>0){this._filterStack=this._filterStack.concat(e._filterStack)}if(this._filterStack.length>0&&this._filterStack[0].type===gaf.EFFECT_COLOR_MATRIX){this._needsCtx=true}if(t.hasColorTransform){this._cascadeColorMult.r=t.colorTransform.mult.r*e._cascadeColorMult.r/255;this._cascadeColorMult.g=t.colorTransform.mult.g*e._cascadeColorMult.g/255;this._cascadeColorMult.b=t.colorTransform.mult.b*e._cascadeColorMult.b/255;this._cascadeColorMult.a=t.colorTransform.mult.a*e._cascadeColorMult.a/255;this._cascadeColorOffset.r=t.colorTransform.offset.r+e._cascadeColorOffset.r;this._cascadeColorOffset.g=t.colorTransform.offset.g+e._cascadeColorOffset.g;this._cascadeColorOffset.b=t.colorTransform.offset.b+e._cascadeColorOffset.b;this._cascadeColorOffset.a=t.colorTransform.offset.a+e._cascadeColorOffset.a}else{this._cascadeColorMult.r=e._cascadeColorMult.r;this._cascadeColorMult.g=e._cascadeColorMult.g;this._cascadeColorMult.b=e._cascadeColorMult.b;this._cascadeColorMult.a=t.alpha*(e._cascadeColorMult.a/255);this._cascadeColorOffset.r=e._cascadeColorOffset.r;this._cascadeColorOffset.g=e._cascadeColorOffset.g;this._cascadeColorOffset.b=e._cascadeColorOffset.b;this._cascadeColorOffset.a=e._cascadeColorOffset.a}if(this._cascadeColorOffset.r>0||this._cascadeColorOffset.g>0||this._cascadeColorOffset.b>0||this._cascadeColorOffset.a>0){this._needsCtx=true}},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this);this._renderCmd._visit=this._renderCmd.visit;var t=this;this._renderCmd.visit=function(e){if(t.isVisibleInCurrentFrame()){this._visit(e)}}},_getNode:function(){return this},setAnchorPoint:function(t,e){if(e===undefined){this._super(t.x,t.y-1)}else{this._super(t,e-1)}}});gaf.Object._createNullObject=function(){var t=new gaf.Object;t.isVisible=function(){return true};return t};gaf.TimeLine=gaf.Object.extend({_className:"GAFTimeLine",_objects:null,_container:null,_animationStartedNextLoopDelegate:null,_animationFinishedPlayDelegate:null,_framePlayedDelegate:null,_sequenceDelegate:null,_fps:60,_frameTime:1/60,_currentSequenceStart:gaf.FIRST_FRAME_INDEX,_currentSequenceEnd:gaf.FIRST_FRAME_INDEX,_totalFrameCount:0,_isRunning:false,_isLooped:false,_isReversed:false,_timeDelta:0,_animationsSelectorScheduled:false,_currentFrame:gaf.FIRST_FRAME_INDEX,setAnimationStartedNextLoopDelegate:function(t){this._animationStartedNextLoopDelegate=t},setAnimationFinishedPlayDelegate:function(t){this._animationFinishedPlayDelegate=t},setLooped:function(t,e){this._isLooped=t;if(e){this._objects.forEach(function(i){i.setLooped(t,e)})}},getBoundingBoxForCurrentFrame:function(){var t=null;var e=true;this._objects.forEach(function(i){if(i.isVisibleInCurrentFrame()&&i.isVisible()){var n=i.getBoundingBoxForCurrentFrame();if(!n){n=i.getBoundingBox()}if(e){e=false;t=n}else{t=cc.rectUnion(t,n)}}});return cc._rectApplyAffineTransformIn(t,this._container.getNodeToParentTransform())},setFps:function(t){cc.assert(t!==0,"Error! Fps is set to zero.");this._fps=t;this._frameTime=1/t},getObjectByName:function(t){var e=t.split(".");var i=null;var n=-1;var r=this;var s={};try{e.forEach(function(t){var e=r._gafproto.getNamedParts();if(e.hasOwnProperty(t)){n=e[t]}else{s.lastElement=t;throw s}i=r._objects[n];r=i})}catch(a){if(a!==s){throw a}cc.log("Sequence incorrect: `"+t+"` At: `"+s.lastElement+"`");return null}return i},clearSequence:function(){this._currentSequenceStart=gaf.FIRST_FRAME_INDEX;this._currentSequenceEnd=this._gafproto.getTotalFrames()},getIsAnimationRunning:function(){return this._isRunning},gotoAndStop:function(t){var e=0;if(typeof t==="string"){e=this.getStartFrame(t)}else{e=t}if(this.setFrame(e)){this.setAnimationRunning(false,false);return true}return false},gotoAndPlay:function(t){var e=0;if(typeof t==="string"){e=this.getStartFrame(t)}else{e=t}if(this.setFrame(e)){this.setAnimationRunning(true,false);return true}return false},getStartFrame:function(t){var e=this._gafproto.getSequences()[t];if(e){return e.start}return gaf.IDNONE},getEndFrame:function(t){var e=this._gafproto.getSequences()[t];if(e){return e.end}return gaf.IDNONE},setFramePlayedDelegate:function(t){this._framePlayedDelegate=t},getCurrentFrameIndex:function(){return this._showingFrame},getTotalFrameCount:function(){return this._gafproto.getTotalFrames()},start:function(){this._enableTick(true);if(!this._isRunning){this._currentFrame=gaf.FIRST_FRAME_INDEX;this.setAnimationRunning(true,true)}},stop:function(){this._enableTick(false);if(this._isRunning){this._currentFrame=gaf.FIRST_FRAME_INDEX;this.setAnimationRunning(false,true)}},isDone:function(){if(this._isLooped){return false}else{if(!this._isReversed){return this._currentFrame>this._totalFrameCount}else{return this._currentFrame<gaf.FIRST_FRAME_INDEX-1}}},getSequences:function(){return this._gafproto.getSequences()},playSequence:function(t,e){var i=this.getStartFrame(t);var n=this.getEndFrame(t);if(gaf.IDNONE===i||gaf.IDNONE===n){return false}this._currentSequenceStart=i;this._currentSequenceEnd=n;if(this._currentFrame<this._currentSequenceStart||this._currentFrame>this._currentSequenceEnd){this._currentFrame=this._currentSequenceStart}else{this._currentFrame=this._currentSequenceStart}this.setLooped(e,false);this.resumeAnimation();return true},isReversed:function(){return this._isReversed},setSequenceDelegate:function(t){this._sequenceDelegate=t},setFrame:function(t){if(t>=gaf.FIRST_FRAME_INDEX&&t<this._totalFrameCount){this._showingFrame=t;this._currentFrame=t;this._processAnimation();return true}return false},pauseAnimation:function(){if(this._isRunning){this.setAnimationRunning(false,false)}},isLooped:function(){return this._isLooped},resumeAnimation:function(){if(!this._isRunning){this.setAnimationRunning(true,false)}},setReversed:function(t){this._isReversed=t},hasSequences:function(){return this._gafproto.getSequences().length>0},getFps:function(){return this._fps},ctor:function(t,e){this._super(e);this._objects=[];cc.assert(t,"Error! Missing mandatory parameter.");this._gafproto=t},setExternalTransform:function(t){if(!cc.affineTransformEqualToTransform(this._container._additionalTransform,t)){this._container.setAdditionalTransform(t)}},_init:function(){this.setContentSize(this._gafproto.getBoundingBox());this._currentSequenceEnd=this._gafproto.getTotalFrames();this._totalFrameCount=this._currentSequenceEnd;this.setFps(this._gafproto.getFps());this._container=new cc.Node;this.addChild(this._container);var t=this;var e=this._gafproto.getAsset();this._gafproto.getObjects().forEach(function(i){var n=e._getProtos()[i];cc.assert(n,"Error. GAF proto for type: "+i.type+" and reference id: "+i+" not found.");t._objects[i]=n._gafConstruct()})},_enableTick:function(t){if(!this._animationsSelectorScheduled&&t){this.schedule(this._processAnimations);this._animationsSelectorScheduled=true}else if(this._animationsSelectorScheduled&&!t){this.unschedule(this._processAnimations);this._animationsSelectorScheduled=false}},_processAnimations:function(t){this._timeDelta+=t;while(this._timeDelta>=this._frameTime){this._timeDelta-=this._frameTime;this._step()}},_step:function(){this._showingFrame=this._currentFrame;if(!this.getIsAnimationRunning()){this._processAnimation();return}if(this._sequenceDelegate){var t;if(!this._isReversed){t=this._getSequenceByLastFrame(this._currentFrame)}else{t=this._getSequenceByFirstFrame(this._currentFrame+1)}if(t){this._sequenceDelegate(this,t)}}if(this._isCurrentFrameLastInSequence()){if(this._isLooped){if(this._animationStartedNextLoopDelegate)this._animationStartedNextLoopDelegate(this)}else{this.setAnimationRunning(false,false);if(this._animationFinishedPlayDelegate)this._animationFinishedPlayDelegate(this)}}this._processAnimation();this._currentFrame=this._nextFrame()},_isCurrentFrameLastInSequence:function(){if(this._isReversed)return this._currentFrame==this._currentSequenceStart;return this._currentFrame==this._currentSequenceEnd-1},_nextFrame:function(){if(this._isCurrentFrameLastInSequence()){if(!this._isLooped)return this._currentFrame;if(this._isReversed)return this._currentSequenceEnd-1;else return this._currentSequenceStart}return this._currentFrame+(this._isReversed?-1:1)},_processAnimation:function(){this._realizeFrame(this._container,this._currentFrame);if(this._framePlayedDelegate){this._framePlayedDelegate(this,this._currentFrame)}},_realizeFrame:function(t,e){var i=this;var n=i._objects;var r=i._gafproto.getFrames();if(e>r.length){return}var s=r[e];if(!s){return}var a=s.states;for(var o=0,c=a.length;o<c;++o){var l=a[o];var h=n[l.objectIdRef];if(!h){return}if(l.alpha<0){h._resetState()}h._updateVisibility(l,i);if(!h.isVisible()){continue}h._applyState(l,i);var u=t;if(l.hasMask){u=n[l.maskObjectIdRef]._getNode();cc.assert(u,"Error! Mask not found.")}h._lastVisibleInFrame=1+e;gaf.TimeLine.rearrangeSubobject(u,h,l.depth);if(h._step){h._step()}}},setAnimationRunning:function(t,e){this._isRunning=t;if(e){this._objects.forEach(function(i){if(i&&i.setAnimationRunning){i.setAnimationRunning(t,e)}})}},_getSequenceByLastFrame:function(){var t=this._gafproto.getSequences();for(var e in t){if(t.hasOwnProperty(e)){if(t[e].end===frame+1){return e}}}return""},_resetState:function(){this._super();this._currentFrame=this._currentSequenceStart},_getSequenceByFirstFrame:function(){var t=this._gafproto.getSequences();for(var e in t){if(t.hasOwnProperty(e)){if(t[e].start===frame){return e}}}return""}});gaf.TimeLine.rearrangeSubobject=function(t,e,i){var n=e.getParent();if(n!==t){e.removeFromParent(false);t.addChild(e,i)}else{e.setLocalZOrder(i)}};gaf.TextField=gaf.Object.extend({_className:"GAFTextField"});gaf.Sprite=gaf.Object.extend({_className:"GAFSprite",_hasCtx:false,_hasFilter:false,ctor:function(t,e){this._super(e);cc.assert(t,"Error! Missing mandatory parameter.");this._gafproto=t},_init:function(){var t=this._gafproto.getFrame();cc.assert(t instanceof cc.SpriteFrame,"Error. Wrong object type.");this._sprite=new cc.Sprite;this._sprite._renderCmd=this._gafCreateRenderCmd(this._sprite);this._sprite.initWithSpriteFrame(t);this._sprite.setAnchorPoint(this._gafproto.getAnchor());this.addChild(this._sprite);this._sprite.setOpacityModifyRGB(true);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)this._sprite.setBlendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)},_applyState:function(t,e){this._applyStateSuper(t,e);if(this._needsCtx){if(!this._hasCtx){this._enableCtx();this._hasCtx=true}this._applyCtxState(t)}else{if(this._hasCtx){this._disableCtx();this._hasCtx=false}if(!cc.colorEqual(this._sprite._realColor,this._cascadeColorMult)){this._sprite.setColor(this._cascadeColorMult)}if(this._sprite.getOpacity()!=this._cascadeColorMult.a){this._sprite.setOpacity(this._cascadeColorMult.a)}}},_enableCtx:function(){this._sprite._renderCmd._enableCtx()},_disableCtx:function(){this._sprite._renderCmd._disableCtx()},_applyCtxState:function(t){this._sprite._renderCmd._applyCtxState(this)},getBoundingBoxForCurrentFrame:function(){var t=this._sprite.getBoundingBox();return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},_gafCreateRenderCmd:function(t){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new gaf.Sprite.CanvasRenderCmd(t);else return new gaf.Sprite.WebGLRenderCmd(t)}});gaf.Mask=gaf.Object.extend({_className:"GAFMask",_clippingNode:null,ctor:function(t){this._super();cc.assert(t,"Error! Missing mandatory parameter.");this._gafproto=t},_init:function(){var t=this._gafproto.getMaskNodeProto();cc.assert(t,"Error. Mask node for id ref "+this._gafproto.getIdRef()+" not found.");this._maskNode=t._gafConstruct();this._clippingNode=cc.ClippingNode.create(this._maskNode);this._clippingNode.setAlphaThreshold(.5);this.addChild(this._clippingNode)},setExternalTransform:function(t){if(!cc.affineTransformEqualToTransform(this._maskNode._additionalTransform,t)){this._maskNode.setAdditionalTransform(t)}},_getNode:function(){return this._clippingNode}});(function(){gaf.Sprite.CanvasRenderCmd=function(t){cc.Sprite.CanvasRenderCmd.call(this,t);this._hasTintMult=false;this._hasTintOffset=false;this._hasCtx=false;this._tintMult=cc.color(255,255,255,255);this._tintOffset=cc.color(0,0,0,0);this._textureDirty=false};var t=gaf.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);t.constructor=gaf.Sprite.CanvasRenderCmd;t._disableCtx=function(){this._hasTintOffset=false;this._hasCtx=false;this._textureDirty=true;this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);this._tintMult=cc.color(255,255,255,255);this._tintOffset=cc.color(0,0,0,0)};t._enableCtx=function(){};t._applyCtxState=function(t){var e=t._cascadeColorMult;var i=t._cascadeColorOffset;var n=e.a;if(this._node.getOpacity()!=n){this._node.setOpacity(n)}var r=!cc.colorEqual(this._tintMult,e);if(r){this._node.setColor(e);this._tintMult=e;this._hasTintMult=e.r!==255||e.g!==255||e.b!==255}var s=this._tintOffset.r!=i.r||this._tintOffset.g!=i.g||this._tintOffset.b!=i.b||this._tintOffset.a!=i.a;if(s){this._tintOffset=i;this._hasTintOffset=i.r!==0||i.g!==0||i.b!==0||i.a!==0}this._textureDirty=r||s;if(this._textureDirty){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)}this._hasCtx=t._filterStack.length>0&&t._filterStack[0].type===gaf.EFFECT_COLOR_MATRIX};t.rendering=function(t,e,i){var n=this._node;var r=this._textureCoord,s=this._displayedOpacity/255;if(n._texture&&(r.width===0||r.height===0||!n._texture._textureLoaded)||s===0)return;var a=t||cc._renderContext,o=a.getContext();var c=n._offsetPosition.x,l=n._rect.height,h=n._rect.width,u=-n._offsetPosition.y-l,d;a.setTransform(this._worldTransform,e,i);a.setCompositeOperation(this._blendFuncStr);
a.setGlobalAlpha(s);if(n._flippedX||n._flippedY)a.save();if(n._flippedX){c=-c-h;o.scale(-1,1)}if(n._flippedY){u=n._offsetPosition.y;o.scale(1,-1)}d=n._texture._htmlElementObj;if(this._colorized){o.drawImage(d,0,0,r.width,r.height,c*e,u*i,h*e,l*i)}else{o.drawImage(d,r.renderX,r.renderY,r.width,r.height,c*e,u*i,h*e,l*i)}if(n._flippedX||n._flippedY)a.restore();cc.g_NumberOfDraws++};if(cc.sys._supportCanvasNewBlendModes){t._updateColor=function(){var t=this._displayedColor,e=this._node;this._hasTintMult|=t.r!==255||t.g!==255||t.b!==255;if(this._textureDirty){this._textureDirty=false;if(this._colorized){this._colorized=false;e.texture=this._originalTexture}}else{return}var i,n=e._texture,r=this._textureCoord;if(this._hasTintMult){if(n&&r.validRect&&this._originalTexture){i=n.getHtmlElementObj();if(!i)return;this._colorized=true;if(this._hasTintOffset||this._hasCtx)t=this._tintMult;i=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,t,r);n=new cc.Texture2D;n.initWithElement(i);n.handleLoadedTexture();e.texture=n}}n=e._texture;if(this._hasTintOffset){var s=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj());if(n&&r.validRect&&this._originalTexture){i=n.getHtmlElementObj();if(!i)return;if(this._colorized)var a=cc.rect(0,0,r.width,r.height);else a=r;i=this._gafGenerateTintImage(e.texture._htmlElementObj,a,s,this._tintOffset,r);n=new cc.Texture2D;n.initWithElement(i);n.handleLoadedTexture();e.texture=n;this._colorized=true}}};t._gafGenerateTintImage=function(t,e,i,n,r,s){if(!r)r=cc.rect(0,0,t.width,t.height);var a=Math.min(r.width,i[0].width);var o=Math.min(r.height,i[0].height);var c=s,l;if(!c){c=document.createElement("canvas");c.width=a;c.height=o;l=c.getContext("2d")}else{l=c.getContext("2d");l.clearRect(0,0,a,o)}l.save();l.globalCompositeOperation="source-over";l.drawImage(i[2],r.x,r.y,a,o,0,0,a,o);l.globalCompositeOperation="source-in";l.fillStyle="rgba("+Math.round(n.r)+","+Math.round(n.g)+","+Math.round(n.b)+",1)";l.fillRect(0,0,a,o);l.globalCompositeOperation="lighter";l.drawImage(t,e.x,e.y,a,o,0,0,a,o);l.restore();return c}}})();gaf._TimeLineProto=function(t,e,i,n,r,s){r=typeof r!="undefined"?r:0;s=s||"";this._objects=[];this.getTotalFrames=function(){return e};this.getBoundingBox=function(){return i};this.getId=function(){return r};this.getLinkageName=function(){return s};this.getPivot=function(){return n};this.getRect=function(){return i};this.getNamedParts=function(){return{}};this.getSequences=function(){return{}};this.getFrames=function(){return[]};this.getFps=function(){return 60};this.getObjects=function(){return this._objects};this.getAsset=function(){return t};this._gafConstruct=function(){var t=this.getAsset()._usedAtlasScale;var e=new gaf.TimeLine(this,t);e._init();return e}};gaf._SpriteProto=function(t,e,i){this.getFrames=function(){return e};this.getIdRef=function(){return i};this.getAsset=function(){return t};this._gafConstruct=function(){var t=this.getAsset()._usedAtlasScale;var e=new gaf.Sprite(this,t);e._init();return e}};gaf._SpriteProto.prototype.getFrame=function(){var t=this.getAsset()._usedAtlasScale;cc.assert(t,"Error. Atlas scale zero.");var e=this.getFrames()[t];cc.assert(e,"Error. No frames found for used scale `"+t+"`");return e[this.getIdRef()]};gaf._SpriteProto.prototype.getAnchor=function(){return this.getFrame()._gafAnchor};gaf._MaskProto=function(t,e,i){this.getIdRef=function(){return i};this.getMaskNodeProto=function(){return e};this._gafConstruct=function(){var t=new gaf.Mask(this);t._init();return t}};gaf.ReadSingleTag=function(t){var e=t.Ushort();var i=gaf.Tags[e];var n={};if(typeof i==="undefined"){console.log("GAF. Non implemented tag detected.");gaf.Tags.Default.parse(t,e)}else{n=i.parse(t,e)}return n};gaf.ReadTags=function(t){var e=[];try{do{var i=gaf.ReadSingleTag(t);e.push(i)}while(i.tagId!=0)}catch(n){if(n instanceof Error&&n.message=="GAF format error"){console.log("GAF format error:\n"+n.stack)}else{console.log(n.stack);throw n}}return e};gaf.Tag=function(){this.Default=Object.create(gaf.Tag.base);this["0"]=Object.create(gaf.Tag.End);this["1"]=Object.create(gaf.Tag.DefineAtlas);this["2"]=Object.create(gaf.Tag.DefineAnimationMasks);this["3"]=Object.create(gaf.Tag.DefineAnimationObjects);this["4"]=Object.create(gaf.Tag.DefineAnimationFrames);this["5"]=Object.create(gaf.Tag.DefineNamedParts);this["6"]=Object.create(gaf.Tag.DefineSequences);this["7"]=Object.create(gaf.Tag.DefineTextFields);this["8"]=Object.create(gaf.Tag.DefineAtlas2);this["9"]=Object.create(gaf.Tag.DefineStage);this["10"]=Object.create(gaf.Tag.DefineAnimationObjects2);this["11"]=Object.create(gaf.Tag.DefineAnimationMasks2);this["12"]=Object.create(gaf.Tag.DefineAnimationFrames2);this["13"]=Object.create(gaf.Tag.DefineTimeline)};gaf.Tag.base=function(){};gaf.Tag.base.parse=function(t,e){var i=t.Uint();t.startNestedBuffer(i);var n=this.doParse(t);t.endNestedBuffer();n.tagName=this.tagName;n.tagId=e;return n};gaf.Tag.base.doParse=function(t){return{}};gaf.Tag.End=Object.create(gaf.Tag.base);gaf.Tag.End.tagName="TagEnd";gaf.Tag.DefineAtlas=Object.create(gaf.Tag.base);gaf.Tag.DefineAtlas.tagName="TagDefineAtlas";gaf.Tag.DefineAtlas.doParse=function(t){var e=t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint")));return{content:e()}};gaf.Tag.DefineAnimationMasks=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationMasks.tagName="TagDefineAnimationMasks";gaf.Tag.DefineAnimationMasks.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint"));var i={content:e()};debugger;return i};gaf.Tag.DefineAnimationObjects=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationObjects.tagName="TagDefineAnimationObjects";gaf.Tag.DefineAnimationObjects.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint"));return{content:e()}};gaf.Tag.DefineAnimationFrames=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationFrames.tagName="TagDefineAnimationFrames";gaf.Tag.DefineAnimationFrames.doParse=function(t){var e=t.array("Uint",t.fields("frame","Uint","state",t.array("Uint",t.fields("hasColorTransform","Ubyte","hasMask","Ubyte","hasEffect","Ubyte","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,t.fields("maskObjectIdRef","Uint"))))));return{content:e()}};gaf.Tag.DefineNamedParts=Object.create(gaf.Tag.base);gaf.Tag.DefineNamedParts.tagName="TagDefineNamedParts";gaf.Tag.DefineNamedParts.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","name","String"));return{content:e()}};gaf.Tag.DefineSequences=Object.create(gaf.Tag.base);gaf.Tag.DefineSequences.tagName="TagDefineSequences";gaf.Tag.DefineSequences.doParse=function(t){var e=t.array("Uint",t.fields("id","String","start","Ushort","end","Ushort"));return{content:e()}};gaf.Tag.DefineTextFields=Object.create(gaf.Tag.base);gaf.Tag.DefineTextFields.tagName="TagDefineTextFields";gaf.Tag.DefineTextFields.doParse=function(t){var e=t.array("Uint",t.fields("id","Uint","pivot","Point","end","Ushort","width","Float","height","Float","text","String","embedFonts","Boolean","multiline","Boolean","wordWrap","Boolean","hasRestrict","Boolean","restrict",t.condition("hasRestrict",1,function(){return t["String"]}),"editable","Boolean","selectable","Boolean","displayAsPassword","Boolean","maxChars","Uint","align","Uint","blockIndent","Uint","bold","Boolean","bullet","Boolean","color","color","font","String","indent","Uint","italic","Boolean","kerning","Boolean","leading","Uint","leftMargin","Uint","letterSpacing","Float","rightMargin","Uint","size","Uint","tabStops",t.array("Uint",t.fields("value","Uint")),"target","string","underline","Boolean","url","String"));return{content:e()}};gaf.Tag.DefineAtlas2=Object.create(gaf.Tag.base);gaf.Tag.DefineAtlas2.tagName="TagDefineAtlas2";gaf.Tag.DefineAtlas2.doParse=function(t){var e=t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint","hasScale9Grid","Boolean","scale9GridRect",t.condition("hasScale9Grid",1,function(){return t.Rect()}))));return{content:e()}};gaf.Tag.DefineStage=Object.create(gaf.Tag.base);gaf.Tag.DefineStage.tagName="TagDefineStage";gaf.Tag.DefineStage.doParse=function(t){var e=t.fields("fps","Ubyte","color","color","width","Ushort","height","Ushort");return{content:e()}};gaf.Tag.DefineAnimationObjects2=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationObjects2.tagName="TagDefineAnimationObjects2";gaf.Tag.DefineAnimationObjects2.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"));return{content:e()}};gaf.Tag.DefineAnimationMasks2=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationMasks2.tagName="TagDefineAnimationMasks2";gaf.Tag.DefineAnimationMasks2.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"));return{content:e()}};gaf.Tag.DefineAnimationFrames2=Object.create(gaf.Tag.base);gaf.Tag.DefineAnimationFrames2.tagName="TagDefineAnimationFrames2";gaf.Tag.DefineAnimationFrames2.doParse=function(t){var e=t.array("Uint",t.fields("frame","Uint","hasChangesInDisplayList","Boolean","hasActions","Boolean","state",t.condition("hasChangesInDisplayList",1,t.array("Uint",t.fields("hasColorTransform","Boolean","hasMask","Boolean","hasEffect","Boolean","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,function(){return t.Uint()})))),"actions",t.condition("hasActions",1,t.array("Uint",t.fields("type","Uint","scope","String","params",gaf.Tag._readActionArguments(t))))));return{content:e()}};gaf.Tag.DefineTimeline=Object.create(gaf.Tag.base);gaf.Tag.DefineTimeline.tagName="TagDefineTimeline";gaf.Tag.DefineTimeline.doParse=function(t){var e=t.fields("id","Uint","animationFrameCount","Uint","boundingBox","Rect","pivotPoint","Point","hasLinkage","Boolean","linkageName",t.condition("hasLinkage",1,function(){return t.String()}));var i={content:e()};i.content.tags=gaf.ReadTags(t);return i};gaf.Tag._readActionArguments=function(t){return function(){var e=t.Uint();var i=[];t.startNestedBuffer(e);while(t.maxOffset()<t.tell()){i.push(t.String())}t.endNestedBuffer();return i}};gaf.Tag._readFilter=function(t){return t.fields("type","Uint","dropShadow",t.condition("type",gaf.EFFECT_DROP_SHADOW,t.fields("color","color","blurX","Float","blurY","Float","angle","Float","distance","Float","strength","Float","inner","Boolean","knockout","Boolean")),"blur",t.condition("type",gaf.EFFECT_BLUR,t.fields("blurX","Float","blurY","Float")),"glow",t.condition("type",gaf.EFFECT_GLOW,t.fields("color","color","blurX","Float","blurY","Float","strength","Float","inner","Boolean","knockout","Boolean")),"colorMatrix",t.condition("type",gaf.EFFECT_COLOR_MATRIX,t.fields("rr","Float","gr","Float","br","Float","ar","Float","r","Float","rg","Float","gg","Float","bg","Float","ag","Float","g","Float","rb","Float","gb","Float","bb","Float","ab","Float","b","Float","ra","Float","ga","Float","ba","Float","aa","Float","a","Float")))};gaf.Tags=new gaf.Tag;var gaf=gaf||{};gaf.Loader=function(){var t=function(t,e){e.compression=t.Uint();e.versionMajor=t.Ubyte();e.versionMinor=t.Ubyte();e.fileLength=t.Uint()};var e=function(t,e){e.framesCount=t.Ushort();e.frameSize=t.Rect();e.pivot=t.Point()};var i=function(t,e){var i=t.Uint();e.scaleValues=[];for(var n=0;n<i;++n){e.scaleValues.push(t.Float())}var r=t.Uint();e.csfValues=[];for(var n=0;n<r;++n){e.csfValues.push(t.Float())}};this.LoadFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,true);var n=this;i.responseType="arraybuffer";i.onload=function(t){var r=new gaf.DataReader(i.response);var s=n.LoadStream(r);if(e)e(s)};i.send()};this.LoadStream=function(n){var r={};t(n,r);if(r.compression==gaf.COMPRESSION_NONE){}else if(r.compression==gaf.COMPRESSION_ZIP){var s=n.dataRaw.slice(n.tell());var a=new window.Zlib.Inflate(new Uint8Array(s));var o=a.decompress();n=new gaf.DataReader(o.buffer)}else{throw new Error("GAF syntax error.")}if(r.versionMajor<4){e(n,r)}else{i(n,r)}var c=gaf.ReadTags(n);return{header:r,tags:c}}};gaf.DataReader=function(t){this.dataRaw=t;this.buf=new DataView(t);this.offset=[0]};gaf.DataReader.prototype.constructor=gaf.DataReader;gaf.DataReader.prototype.newOffset=function(t){this.offset[this.offset.length-1]+=t;if(this.getOffset()>this.maxOffset()){throw new Error("GAF format error")}return this.offset[this.offset.length-1]-t};gaf.DataReader.prototype.maxOffset=function(){if(this.offset.length==1){return this.buf.byteLength}else{return this.offset[this.offset.length-2]}};gaf.DataReader.prototype.getOffset=function(t){return this.offset[this.offset.length-1]};gaf.DataReader.prototype.Ubyte=function(){return this.buf.getUint8(this.newOffset(1))};gaf.DataReader.prototype.Boolean=function(){var t=this.buf.getUint8(this.newOffset(1));if(t>1){throw new Error("GAF format error")}return t};gaf.DataReader.prototype.Uint=function(){return this.buf.getUint32(this.newOffset(4),true)};gaf.DataReader.prototype.Int=function(){return this.buf.getInt32(this.newOffset(4),true)};gaf.DataReader.prototype.color=function(){return{b:this.Ubyte(),g:this.Ubyte(),r:this.Ubyte(),a:this.Ubyte()}};gaf.DataReader.prototype.Ushort=function(){return this.buf.getUint16(this.newOffset(2),true)};gaf.DataReader.prototype.Float=function(){return this.buf.getFloat32(this.newOffset(4),true)};gaf.DataReader.prototype.String=function(){var t=this.Ushort();var e=this.newOffset(t);var i=this.getOffset();try{var n=this.dataRaw.slice(e,i)}catch(r){if(r.message=="Object doesn't support property or method 'slice'"){n=[];for(var s=e;s<i;++s)n.push(this.buf.getUint8(s))}else{throw r}}return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(n))))};gaf.DataReader.prototype.startNestedBuffer=function(t){this.offset.push(this.offset[this.offset.length-1]);this.offset[this.offset.length-2]+=t};gaf.DataReader.prototype.endNestedBuffer=function(){if(this.offset.length==1)throw new Error("No nested buffer available");this.offset.pop()};gaf.DataReader.prototype.Point=function(){return{x:this.Float(),y:this.Float()}};gaf.DataReader.prototype.Rect=function(){return{x:this.Float(),y:this.Float(),width:this.Float(),height:this.Float()}};gaf.DataReader.prototype.Matrix=function(){return{a:this.Float(),b:this.Float(),c:this.Float(),d:this.Float(),tx:this.Float(),ty:this.Float()}};gaf.DataReader.prototype.seek=function(t){this.offset[this.offset.length-1]=t};gaf.DataReader.prototype.tell=function(){return this.offset[this.offset.length-1]};gaf.DataReader.prototype.fields=function(){var t=this;var e=arguments;return function(){arguments.callee.result={};var i=0;if(e.length%2){throw new Error("Number of arguments is not even")}while(i<e.length){var n=e[i++];var r=e[i++];if(typeof r==="function"){arguments.callee.result[n]=r()}else if(r in t&&typeof t[r]==="function"){arguments.callee.result[n]=t[r].call(t)}else{throw new Error("Object DataReader has no function `"+r+"`")}}return arguments.callee.result}};gaf.DataReader.prototype.condition=function(t,e,i){var n=arguments;return function(){if(n.length!=3){throw new Error("Condition function")}var t=arguments.callee.caller;if(!("result"in t)){throw new Error("Condition function caller has no key `result`")}var e=t.result;var i=n[0];var r=n[1];var s=n[2];var a=null;if(typeof r==="function"){a=function(){return r(e[i])}}else{a=function(){return r==e[i]}}if(a()){return s()}else{return null}}};gaf.DataReader.prototype.array=function(){var t=this;var e=arguments;return function(){arguments.callee.result=[];var i=t[e[0]].call(t);for(var n=0;n<i;++n){var r=e[1].call();arguments.callee.result.push(r)}return arguments.callee.result}};gaf.SHADER_GAUSSIAN_BLUR_FRAG="varying mediump vec2 v_texCoord;\n"+"uniform mediump vec2 u_step;\n"+"void main()\n"+"{ \n"+"    mediump vec4 sum = vec4(0.0);                                      \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   \n"+"    gl_FragColor = sum;                                                \n"+"} \n";gaf.SHADER_GLOW_FRAG="varying mediump vec2 v_texCoord;\n"+"uniform mediump vec2 u_step;\n"+"uniform mediump vec4 u_glowColor;\n"+"void main()\n"+"{ \n"+"    mediump vec4 sum = vec4(0.0);                                      \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   \n"+"    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   \n"+"    gl_FragColor = sum * u_glowColor;                                  \n"+"} \n";gaf.SHADER_COLOR_MATRIX_FRAG="varying mediump vec2 v_texCoord;\n"+"varying mediump vec4 v_fragmentColor;\n"+"uniform mediump vec4 colorTransformMult;\n"+"uniform mediump vec4 colorTransformOffsets;\n"+"uniform mediump mat4 colorMatrix;\n"+"uniform mediump vec4 colorMatrix2;\n"+"void main()\n"+"{ \n"+"    vec4 texColor = texture2D(CC_Texture0, v_texCoord);                          \n"+"    const float kMinimalAlphaAllowed = 1.0e-8;                                   \n"+"    if (texColor.a > kMinimalAlphaAllowed)                                       \n"+"    {                                                                            \n"+"        texColor = vec4(texColor.rgb / texColor.a, texColor.a);                  \n"+"        vec4 ctxColor = texColor * colorTransformMult + colorTransformOffsets;   \n"+"        vec4 adjustColor = colorMatrix * ctxColor + colorMatrix2;                \n"+"        adjustColor *= v_fragmentColor;                                          \n"+"        texColor = vec4(adjustColor.rgb * adjustColor.a, adjustColor.a);         \n"+"    }                                                                            \n"+"    gl_FragColor = texColor;                                                     \n"+"}\n";gaf._glShaderInit=function(){gaf._Uniforms={ColorTransformMult:-1,ColorTransformOffset:-1,ColorMatrixBody:-1,ColorMatrixAppendix:-1,BlurTexelOffset:-1,GlowTexelOffset:-1,GlowColor:-1};gaf._shaderCreate=function(t,e){var i=new cc.GLProgram;var n=i.initWithVertexShaderByteArray(e,t);cc.assert(n,"Shader init error");i.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);i.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);i.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);n=i.link();cc.assert(n,"Shader linking error");i.updateUniforms();return i};gaf._shaderCreateAlpha=function(){var t=gaf._shaderCreate(gaf.SHADER_COLOR_MATRIX_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);gaf._Uniforms.ColorTransformMult=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_TINT_MULT);gaf._Uniforms.ColorTransformOffset=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_TINT_OFFSET);gaf._Uniforms.ColorMatrixBody=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY);gaf._Uniforms.ColorMatrixAppendix=t.getUniformLocationForName(gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX);return t};gaf._shaderCreateBlur=function(){var t=gaf._shaderCreate(gaf.SHADER_GAUSSIAN_BLUR_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);gaf._Uniforms.BlurTexelOffset=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_BLUR_TEXEL_OFFSET);return t};gaf._shaderCreateGlow=function(){var t=gaf._shaderCreate(gaf.SHADER_GLOW_FRAG,cc.SHADER_POSITION_TEXTURE_COLOR_VERT);gaf._Uniforms.GlowTexelOffset=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_GLOW_TEXEL_OFFSET);gaf._Uniforms.GlowColor=t._glContext.getUniformLocation(t._programObj,gaf.UNIFORM_GLOW_COLOR);return t};gaf._Shaders={Alpha:gaf._shaderCreateAlpha(),Blur:gaf._shaderCreateBlur(),Glow:gaf._shaderCreateGlow()}};gaf._setupShaders=function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){gaf._glShaderInit()}else{delete gaf._glShaderInit}};gaf._AtlasLoader={};gaf._AtlasLoader.execute=function(t,e,i){t()?e():i()};gaf._AtlasLoader.checkAtlas=function(t){return function(){return t&&typeof t!=="string"&&t.isLoaded()}};gaf._AtlasLoader.load=function(t,e,i){cc.textureCache.addImage(t,function(t){gaf._AtlasLoader.execute(gaf._AtlasLoader.checkAtlas(t),function(){e(t)},i)})};gaf._AtlasLoader.loadFront=function(t,e,i){return function(){if(t.length>0){gaf._AtlasLoader.load(t[0],e,gaf._AtlasLoader.loadFront(t.slice(1),e,i))}else i()}};gaf._AtlasLoader.loadArray=function(t,e,i){gaf._AtlasLoader.loadFront(t,e,i)()};var Box2D={};(function(t,e){if(!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(t,e,i){if(i.get instanceof Function)t.__defineGetter__(e,i.get);if(i.set instanceof Function)t.__defineSetter__(e,i.set)}}function i(){}t.inherit=function(t,e){var n=t;i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=n};t.generateCallback=function n(t,e){return function(){e.apply(t,arguments)}};t.NVector=function r(t){if(t===e)t=0;var i=new Array(t||0);for(var n=0;n<t;++n)i[n]=0;return i};t.is=function s(t,i){if(t===null)return false;if(i instanceof Function&&t instanceof i)return true;if(t.constructor.__implements!=e&&t.constructor.__implements[i])return true;return false};t.parseUInt=function(t){return Math.abs(parseInt(t))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function i(){i.b2BoundValues.apply(this,arguments);if(this.constructor===i)this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=i;function n(){n.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=n;function r(){r.b2ContactID.apply(this,arguments);if(this.constructor===r)this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=r;function s(){s.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=s;function a(){a.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=a;function o(){o.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=o;function c(){c.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=c;function l(){l.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=l;function h(){h.b2DynamicTree.apply(this,arguments);if(this.constructor===h)this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=h;function u(){u.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=u;function d(){d.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=d;function _(){_.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=_;function f(){f.b2Manifold.apply(this,arguments);if(this.constructor===f)this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=f;function p(){p.b2ManifoldPoint.apply(this,arguments);if(this.constructor===p)this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=p;function m(){m.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=m;function g(){g.b2RayCastInput.apply(this,arguments);if(this.constructor===g)this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=g;function v(){v.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=v;function y(){y.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=y;function T(){T.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=T;function C(){C.b2Simplex.apply(this,arguments);if(this.constructor===C)this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=C;function S(){S.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=S;function x(){x.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=x;function E(){E.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=E;function b(){b.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=b;function A(){A.b2WorldManifold.apply(this,arguments);if(this.constructor===A)this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=A;function R(){R.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=R;function P(){P.Features.apply(this,arguments)}Box2D.Collision.Features=P;function w(){w.b2CircleShape.apply(this,arguments);if(this.constructor===w)this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=w;function I(){I.b2EdgeChainDef.apply(this,arguments);if(this.constructor===I)this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=I;function D(){D.b2EdgeShape.apply(this,arguments);if(this.constructor===D)this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=D;function L(){L.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=L;function O(){O.b2PolygonShape.apply(this,arguments);if(this.constructor===O)this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=O;function B(){B.b2Shape.apply(this,arguments);if(this.constructor===B)this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=B;Box2D.Common.b2internal="Box2D.Common.b2internal";function F(){F.b2Color.apply(this,arguments);if(this.constructor===F)this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=F;function N(){N.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=N;function M(){M.b2Mat22.apply(this,arguments);if(this.constructor===M)this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=M;function V(){V.b2Mat33.apply(this,arguments);if(this.constructor===V)this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=V;function k(){k.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=k;function W(){W.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=W;function G(){G.b2Transform.apply(this,arguments);if(this.constructor===G)this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=G;function z(){z.b2Vec2.apply(this,arguments);if(this.constructor===z)this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=z;function U(){U.b2Vec3.apply(this,arguments);if(this.constructor===U)this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=U;function Y(){Y.b2Body.apply(this,arguments);if(this.constructor===Y)this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=Y;function X(){X.b2BodyDef.apply(this,arguments);if(this.constructor===X)this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=X;function H(){H.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=H;function j(){j.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=j;function q(){q.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=q;function J(){J.b2ContactManager.apply(this,arguments);if(this.constructor===J)this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=J;function Z(){Z.b2DebugDraw.apply(this,arguments);if(this.constructor===Z)this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=Z;function K(){K.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=K;function Q(){Q.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=Q;function $(){$.b2Fixture.apply(this,arguments);if(this.constructor===$)this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=$;function tt(){tt.b2FixtureDef.apply(this,arguments);if(this.constructor===tt)this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=tt;function et(){et.b2Island.apply(this,arguments);if(this.constructor===et)this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=et;function it(){it.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=it;function nt(){nt.b2World.apply(this,arguments);if(this.constructor===nt)this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=nt;function rt(){rt.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=rt;function st(){st.b2Contact.apply(this,arguments);if(this.constructor===st)this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=st;function at(){at.b2ContactConstraint.apply(this,arguments);if(this.constructor===at)this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=at;function ot(){ot.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ot;function ct(){ct.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=ct;function lt(){lt.b2ContactFactory.apply(this,arguments);if(this.constructor===lt)this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=lt;function ht(){ht.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=ht;function ut(){ut.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=ut;function dt(){dt.b2ContactSolver.apply(this,arguments);if(this.constructor===dt)this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=dt;function _t(){_t.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=_t;function ft(){ft.b2NullContact.apply(this,arguments);if(this.constructor===ft)this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=ft;function pt(){pt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=pt;
function mt(){mt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=mt;function gt(){gt.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=gt;function vt(){vt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===vt)this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=vt;function yt(){yt.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=yt;function Tt(){Tt.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=Tt;function Ct(){Ct.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=Ct;function St(){St.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=St;function xt(){xt.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=xt;function Et(){Et.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Et;function bt(){bt.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=bt;function At(){At.b2DistanceJoint.apply(this,arguments);if(this.constructor===At)this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=At;function Rt(){Rt.b2DistanceJointDef.apply(this,arguments);if(this.constructor===Rt)this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=Rt;function Pt(){Pt.b2FrictionJoint.apply(this,arguments);if(this.constructor===Pt)this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=Pt;function wt(){wt.b2FrictionJointDef.apply(this,arguments);if(this.constructor===wt)this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=wt;function It(){It.b2GearJoint.apply(this,arguments);if(this.constructor===It)this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=It;function Dt(){Dt.b2GearJointDef.apply(this,arguments);if(this.constructor===Dt)this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=Dt;function Lt(){Lt.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Lt;function Ot(){Ot.b2Joint.apply(this,arguments);if(this.constructor===Ot)this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=Ot;function Bt(){Bt.b2JointDef.apply(this,arguments);if(this.constructor===Bt)this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Bt;function Ft(){Ft.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=Ft;function Nt(){Nt.b2LineJoint.apply(this,arguments);if(this.constructor===Nt)this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=Nt;function Mt(){Mt.b2LineJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=Mt;function Vt(){Vt.b2MouseJoint.apply(this,arguments);if(this.constructor===Vt)this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Vt;function kt(){kt.b2MouseJointDef.apply(this,arguments);if(this.constructor===kt)this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=kt;function Wt(){Wt.b2PrismaticJoint.apply(this,arguments);if(this.constructor===Wt)this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=Wt;function Gt(){Gt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===Gt)this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=Gt;function zt(){zt.b2PulleyJoint.apply(this,arguments);if(this.constructor===zt)this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=zt;function Ut(){Ut.b2PulleyJointDef.apply(this,arguments);if(this.constructor===Ut)this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=Ut;function Yt(){Yt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Yt)this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Yt;function Xt(){Xt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Xt)this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=Xt;function Ht(){Ht.b2WeldJoint.apply(this,arguments);if(this.constructor===Ht)this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=Ht;function jt(){jt.b2WeldJointDef.apply(this,arguments);if(this.constructor===jt)this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=jt})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.b2Color,o=Box2D.Common.b2internal,c=Box2D.Common.b2Settings,l=Box2D.Common.Math.b2Mat22,h=Box2D.Common.Math.b2Mat33,u=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,_=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,p=Box2D.Common.Math.b2Vec3,m=Box2D.Collision.b2AABB,g=Box2D.Collision.b2Bound,v=Box2D.Collision.b2BoundValues,y=Box2D.Collision.b2Collision,T=Box2D.Collision.b2ContactID,C=Box2D.Collision.b2ContactPoint,S=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,E=Box2D.Collision.b2DistanceOutput,b=Box2D.Collision.b2DistanceProxy,A=Box2D.Collision.b2DynamicTree,R=Box2D.Collision.b2DynamicTreeBroadPhase,P=Box2D.Collision.b2DynamicTreeNode,w=Box2D.Collision.b2DynamicTreePair,I=Box2D.Collision.b2Manifold,D=Box2D.Collision.b2ManifoldPoint,L=Box2D.Collision.b2Point,O=Box2D.Collision.b2RayCastInput,B=Box2D.Collision.b2RayCastOutput,F=Box2D.Collision.b2Segment,N=Box2D.Collision.b2SeparationFunction,M=Box2D.Collision.b2Simplex,V=Box2D.Collision.b2SimplexCache,k=Box2D.Collision.b2SimplexVertex,W=Box2D.Collision.b2TimeOfImpact,G=Box2D.Collision.b2TOIInput,z=Box2D.Collision.b2WorldManifold,U=Box2D.Collision.ClipVertex,Y=Box2D.Collision.Features,X=Box2D.Collision.IBroadPhase;m.b2AABB=function(){this.lowerBound=new f;this.upperBound=new f};m.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;var i=t>=0&&e>=0;i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return i};m.prototype.GetCenter=function(){return new f((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};m.prototype.GetExtents=function(){return new f((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};m.prototype.Contains=function(t){var e=true;e=e&&this.lowerBound.x<=t.lowerBound.x;e=e&&this.lowerBound.y<=t.lowerBound.y;e=e&&t.upperBound.x<=this.upperBound.x;e=e&&t.upperBound.y<=this.upperBound.y;return e};m.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE;var n=Number.MAX_VALUE;var r=e.p1.x;var s=e.p1.y;var a=e.p2.x-e.p1.x;var o=e.p2.y-e.p1.y;var c=Math.abs(a);var l=Math.abs(o);var h=t.normal;var u=0;var d=0;var _=0;var f=0;var p=0;{if(c<Number.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{u=1/a;d=(this.lowerBound.x-r)*u;_=(this.upperBound.x-r)*u;p=-1;if(d>_){f=d;d=_;_=f;p=1}if(d>i){h.x=p;h.y=0;i=d}n=Math.min(n,_);if(i>n)return false}}{if(l<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return false}else{u=1/o;d=(this.lowerBound.y-s)*u;_=(this.upperBound.y-s)*u;p=-1;if(d>_){f=d;d=_;_=f;p=1}if(d>i){h.y=p;h.x=0;i=d}n=Math.min(n,_);if(i>n)return false}}t.fraction=i;return true};m.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var n=this.lowerBound.x-t.upperBound.x;var r=this.lowerBound.y-t.upperBound.y;if(e>0||i>0)return false;if(n>0||r>0)return false;return true};m.Combine=function(t,e){var i=new m;i.Combine(t,e);return i};m.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)};g.b2Bound=function(){};g.prototype.IsLower=function(){return(this.value&1)==0};g.prototype.IsUpper=function(){return(this.value&1)==1};g.prototype.Swap=function(t){var e=this.value;var i=this.proxy;var n=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=e;t.proxy=i;t.stabbingCount=n};v.b2BoundValues=function(){};v.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};y.b2Collision=function(){};y.ClipSegmentToLine=function(t,e,i,n){if(n===undefined)n=0;var r;var s=0;r=e[0];var a=r.v;r=e[1];var o=r.v;var c=i.x*a.x+i.y*a.y-n;var l=i.x*o.x+i.y*o.y-n;if(c<=0)t[s++].Set(e[0]);if(l<=0)t[s++].Set(e[1]);if(c*l<0){var h=c/(c-l);r=t[s];var u=r.v;u.x=a.x+h*(o.x-a.x);u.y=a.y+h*(o.y-a.y);r=t[s];var d;if(c>0){d=e[0];r.id=d.id}else{d=e[1];r.id=d.id}++s}return s};y.EdgeSeparation=function(t,e,i,n,r){if(i===undefined)i=0;var s=parseInt(t.m_vertexCount);var a=t.m_vertices;var o=t.m_normals;var c=parseInt(n.m_vertexCount);var l=n.m_vertices;var h;var u;h=e.R;u=o[i];var d=h.col1.x*u.x+h.col2.x*u.y;var _=h.col1.y*u.x+h.col2.y*u.y;h=r.R;var f=h.col1.x*d+h.col1.y*_;var p=h.col2.x*d+h.col2.y*_;var m=0;var g=Number.MAX_VALUE;for(var v=0;v<c;++v){u=l[v];var y=u.x*f+u.y*p;if(y<g){g=y;m=v}}u=a[i];h=e.R;var T=e.position.x+(h.col1.x*u.x+h.col2.x*u.y);var C=e.position.y+(h.col1.y*u.x+h.col2.y*u.y);u=l[m];h=r.R;var S=r.position.x+(h.col1.x*u.x+h.col2.x*u.y);var x=r.position.y+(h.col1.y*u.x+h.col2.y*u.y);S-=T;x-=C;var E=S*d+x*_;return E};y.FindMaxSeparation=function(t,e,i,n,r){var s=parseInt(e.m_vertexCount);var a=e.m_normals;var o;var c;c=r.R;o=n.m_centroid;var l=r.position.x+(c.col1.x*o.x+c.col2.x*o.y);var h=r.position.y+(c.col1.y*o.x+c.col2.y*o.y);c=i.R;o=e.m_centroid;l-=i.position.x+(c.col1.x*o.x+c.col2.x*o.y);h-=i.position.y+(c.col1.y*o.x+c.col2.y*o.y);var u=l*i.R.col1.x+h*i.R.col1.y;var d=l*i.R.col2.x+h*i.R.col2.y;var _=0;var f=-Number.MAX_VALUE;for(var p=0;p<s;++p){o=a[p];var m=o.x*u+o.y*d;if(m>f){f=m;_=p}}var g=y.EdgeSeparation(e,i,_,n,r);var v=parseInt(_-1>=0?_-1:s-1);var T=y.EdgeSeparation(e,i,v,n,r);var C=parseInt(_+1<s?_+1:0);var S=y.EdgeSeparation(e,i,C,n,r);var x=0;var E=0;var b=0;if(T>g&&T>S){b=-1;x=v;E=T}else if(S>g){b=1;x=C;E=S}else{t[0]=_;return g}while(true){if(b==-1)_=x-1>=0?x-1:s-1;else _=x+1<s?x+1:0;g=y.EdgeSeparation(e,i,_,n,r);if(g>E){x=_;E=g}else{break}}t[0]=x;return E};y.FindIncidentEdge=function(t,e,i,n,r,s){if(n===undefined)n=0;var a=parseInt(e.m_vertexCount);var o=e.m_normals;var c=parseInt(r.m_vertexCount);var l=r.m_vertices;var h=r.m_normals;var u;var d;u=i.R;d=o[n];var _=u.col1.x*d.x+u.col2.x*d.y;var f=u.col1.y*d.x+u.col2.y*d.y;u=s.R;var p=u.col1.x*_+u.col1.y*f;f=u.col2.x*_+u.col2.y*f;_=p;var m=0;var g=Number.MAX_VALUE;for(var v=0;v<c;++v){d=h[v];var y=_*d.x+f*d.y;if(y<g){g=y;m=v}}var T;var C=parseInt(m);var S=parseInt(C+1<c?C+1:0);T=t[0];d=l[C];u=s.R;T.v.x=s.position.x+(u.col1.x*d.x+u.col2.x*d.y);T.v.y=s.position.y+(u.col1.y*d.x+u.col2.y*d.y);T.id.features.referenceEdge=n;T.id.features.incidentEdge=C;T.id.features.incidentVertex=0;T=t[1];d=l[S];u=s.R;T.v.x=s.position.x+(u.col1.x*d.x+u.col2.x*d.y);T.v.y=s.position.y+(u.col1.y*d.x+u.col2.y*d.y);T.id.features.referenceEdge=n;T.id.features.incidentEdge=S;T.id.features.incidentVertex=1};y.MakeClipPointVector=function(){var t=new Vector(2);t[0]=new U;t[1]=new U;return t};y.CollidePolygons=function(t,e,i,n,r){var s;t.m_pointCount=0;var a=e.m_radius+n.m_radius;var o=0;y.s_edgeAO[0]=o;var l=y.FindMaxSeparation(y.s_edgeAO,e,i,n,r);o=y.s_edgeAO[0];if(l>a)return;var h=0;y.s_edgeBO[0]=h;var u=y.FindMaxSeparation(y.s_edgeBO,n,r,e,i);h=y.s_edgeBO[0];if(u>a)return;var d;var _;var f;var p;var m=0;var g=0;var v=.98;var T=.001;var C;if(u>v*l+T){d=n;_=e;f=r;p=i;m=h;t.m_type=I.e_faceB;g=1}else{d=e;_=n;f=i;p=r;m=o;t.m_type=I.e_faceA;g=0}var S=y.s_incidentEdge;y.FindIncidentEdge(S,d,f,m,_,p);var x=parseInt(d.m_vertexCount);var E=d.m_vertices;var b=E[m];var A;if(m+1<x){A=E[parseInt(m+1)]}else{A=E[0]}var R=y.s_localTangent;R.Set(A.x-b.x,A.y-b.y);R.Normalize();var P=y.s_localNormal;P.x=R.y;P.y=-R.x;var w=y.s_planePoint;w.Set(.5*(b.x+A.x),.5*(b.y+A.y));var D=y.s_tangent;C=f.R;D.x=C.col1.x*R.x+C.col2.x*R.y;D.y=C.col1.y*R.x+C.col2.y*R.y;var L=y.s_tangent2;L.x=-D.x;L.y=-D.y;var O=y.s_normal;O.x=D.y;O.y=-D.x;var B=y.s_v11;var F=y.s_v12;B.x=f.position.x+(C.col1.x*b.x+C.col2.x*b.y);B.y=f.position.y+(C.col1.y*b.x+C.col2.y*b.y);F.x=f.position.x+(C.col1.x*A.x+C.col2.x*A.y);F.y=f.position.y+(C.col1.y*A.x+C.col2.y*A.y);var N=O.x*B.x+O.y*B.y;var M=-D.x*B.x-D.y*B.y+a;var V=D.x*F.x+D.y*F.y+a;var k=y.s_clipPoints1;var W=y.s_clipPoints2;var G=0;G=y.ClipSegmentToLine(k,S,L,M);if(G<2)return;G=y.ClipSegmentToLine(W,k,D,V);if(G<2)return;t.m_localPlaneNormal.SetV(P);t.m_localPoint.SetV(w);var z=0;for(var U=0;U<c.b2_maxManifoldPoints;++U){s=W[U];var Y=O.x*s.v.x+O.y*s.v.y-N;if(Y<=a){var X=t.m_points[z];C=p.R;var H=s.v.x-p.position.x;var j=s.v.y-p.position.y;X.m_localPoint.x=H*C.col1.x+j*C.col1.y;X.m_localPoint.y=H*C.col2.x+j*C.col2.y;X.m_id.Set(s.id);X.m_id.features.flip=g;++z}}t.m_pointCount=z};y.CollideCircles=function(t,e,i,n,r){t.m_pointCount=0;var s;var a;s=i.R;a=e.m_p;var o=i.position.x+(s.col1.x*a.x+s.col2.x*a.y);var c=i.position.y+(s.col1.y*a.x+s.col2.y*a.y);s=r.R;a=n.m_p;var l=r.position.x+(s.col1.x*a.x+s.col2.x*a.y);var h=r.position.y+(s.col1.y*a.x+s.col2.y*a.y);var u=l-o;var d=h-c;var _=u*u+d*d;var f=e.m_radius+n.m_radius;if(_>f*f){return}t.m_type=I.e_circles;t.m_localPoint.SetV(e.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0};y.CollidePolygonAndCircle=function(t,e,i,n,r){t.m_pointCount=0;var s;var a=0;var o=0;var c=0;var l=0;var h;var u;u=r.R;h=n.m_p;var d=r.position.x+(u.col1.x*h.x+u.col2.x*h.y);var _=r.position.y+(u.col1.y*h.x+u.col2.y*h.y);a=d-i.position.x;o=_-i.position.y;u=i.R;var f=a*u.col1.x+o*u.col1.y;var p=a*u.col2.x+o*u.col2.y;var m=0;var g=0;var v=-Number.MAX_VALUE;var y=e.m_radius+n.m_radius;var T=parseInt(e.m_vertexCount);var C=e.m_vertices;var S=e.m_normals;for(var x=0;x<T;++x){h=C[x];a=f-h.x;o=p-h.y;h=S[x];var E=h.x*a+h.y*o;if(E>y){return}if(E>v){v=E;g=x}}var b=parseInt(g);var A=parseInt(b+1<T?b+1:0);var R=C[b];var P=C[A];if(v<Number.MIN_VALUE){t.m_pointCount=1;t.m_type=I.e_faceA;t.m_localPlaneNormal.SetV(S[g]);t.m_localPoint.x=.5*(R.x+P.x);t.m_localPoint.y=.5*(R.y+P.y);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0;return}var w=(f-R.x)*(P.x-R.x)+(p-R.y)*(P.y-R.y);var D=(f-P.x)*(R.x-P.x)+(p-P.y)*(R.y-P.y);if(w<=0){if((f-R.x)*(f-R.x)+(p-R.y)*(p-R.y)>y*y)return;t.m_pointCount=1;t.m_type=I.e_faceA;t.m_localPlaneNormal.x=f-R.x;t.m_localPlaneNormal.y=p-R.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(R);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else if(D<=0){if((f-P.x)*(f-P.x)+(p-P.y)*(p-P.y)>y*y)return;t.m_pointCount=1;t.m_type=I.e_faceA;t.m_localPlaneNormal.x=f-P.x;t.m_localPlaneNormal.y=p-P.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(P);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else{var L=.5*(R.x+P.x);var O=.5*(R.y+P.y);v=(f-L)*S[b].x+(p-O)*S[b].y;if(v>y)return;t.m_pointCount=1;t.m_type=I.e_faceA;t.m_localPlaneNormal.x=S[b].x;t.m_localPlaneNormal.y=S[b].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(L,O);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}};y.TestOverlap=function(t,e){var i=e.lowerBound;var n=t.upperBound;var r=i.x-n.x;var s=i.y-n.y;i=t.lowerBound;n=e.upperBound;var a=i.x-n.x;var o=i.y-n.y;if(r>0||s>0)return false;if(a>0||o>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=y.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=y.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=y.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new f;Box2D.Collision.b2Collision.s_localNormal=new f;Box2D.Collision.b2Collision.s_planePoint=new f;Box2D.Collision.b2Collision.s_normal=new f;Box2D.Collision.b2Collision.s_tangent=new f;Box2D.Collision.b2Collision.s_tangent2=new f;Box2D.Collision.b2Collision.s_v11=new f;Box2D.Collision.b2Collision.s_v12=new f;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new f;Box2D.Collision.b2Collision.b2_nullFeature=255});T.b2ContactID=function(){this.features=new Y};T.prototype.b2ContactID=function(){this.features._m_id=this};T.prototype.Set=function(t){this.key=t._key};T.prototype.Copy=function(){var t=new T;t.key=this.key;return t};Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._key=t;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});C.b2ContactPoint=function(){this.position=new f;this.velocity=new f;this.normal=new f;this.id=new T};S.b2Distance=function(){};S.Distance=function(t,e,i){++S.b2_gjkCalls;var n=i.proxyA;var r=i.proxyB;var s=i.transformA;var a=i.transformB;var o=S.s_simplex;o.ReadCache(e,n,s,r,a);var l=o.m_vertices;var h=20;var d=S.s_saveA;var _=S.s_saveB;var p=0;var m=o.GetClosestPoint();var g=m.LengthSquared();var v=g;var y=0;var T;var C=0;while(C<h){p=o.m_count;for(y=0;y<p;y++){d[y]=l[y].indexA;_[y]=l[y].indexB}switch(o.m_count){case 1:break;case 2:o.Solve2();break;case 3:o.Solve3();break;default:c.b2Assert(false)}if(o.m_count==3){break}T=o.GetClosestPoint();v=T.LengthSquared();if(v>g){}g=v;var x=o.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}var E=l[o.m_count];E.indexA=n.GetSupport(u.MulTMV(s.R,x.GetNegative()));E.wA=u.MulX(s,n.GetVertex(E.indexA));E.indexB=r.GetSupport(u.MulTMV(a.R,x));E.wB=u.MulX(a,r.GetVertex(E.indexB));E.w=u.SubtractVV(E.wB,E.wA);++C;++S.b2_gjkIters;var b=false;for(y=0;y<p;y++){if(E.indexA==d[y]&&E.indexB==_[y]){b=true;break}}if(b){break}++o.m_count}S.b2_gjkMaxIters=u.Max(S.b2_gjkMaxIters,C);o.GetWitnessPoints(t.pointA,t.pointB);t.distance=u.SubtractVV(t.pointA,t.pointB).Length();t.iterations=C;o.WriteCache(e);if(i.useRadii){var A=n.m_radius;var R=r.m_radius;if(t.distance>A+R&&t.distance>Number.MIN_VALUE){t.distance-=A+R;var P=u.SubtractVV(t.pointB,t.pointA);P.Normalize();t.pointA.x+=A*P.x;t.pointA.y+=A*P.y;t.pointB.x-=R*P.x;t.pointB.y-=R*P.y}else{T=new f;T.x=.5*(t.pointA.x+t.pointB.x);T.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=T.x;t.pointA.y=t.pointB.y=T.y;t.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new M;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});x.b2DistanceInput=function(){};E.b2DistanceOutput=function(){this.pointA=new f;this.pointB=new f};b.b2DistanceProxy=function(){};b.prototype.Set=function(e){switch(e.GetType()){case s.e_circleShape:{var i=e instanceof t?e:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=i.m_p;this.m_count=1;this.m_radius=i.m_radius}break;case s.e_polygonShape:{var n=e instanceof r?e:null;this.m_vertices=n.m_vertices;this.m_count=n.m_vertexCount;this.m_radius=n.m_radius}break;default:c.b2Assert(false)}};b.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};b.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};b.prototype.GetVertexCount=function(){return this.m_count};b.prototype.GetVertex=function(t){if(t===undefined)t=0;c.b2Assert(0<=t&&t<this.m_count);return this.m_vertices[t]};A.b2DynamicTree=function(){};A.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};A.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();var n=c.b2_aabbExtension;var r=c.b2_aabbExtension;i.aabb.lowerBound.x=t.lowerBound.x-n;i.aabb.lowerBound.y=t.lowerBound.y-r;i.aabb.upperBound.x=t.upperBound.x+n;i.aabb.upperBound.y=t.upperBound.y+r;i.userData=e;this.InsertLeaf(i);return i};A.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};A.prototype.MoveProxy=function(t,e,i){c.b2Assert(t.IsLeaf());if(t.aabb.Contains(e)){return false}this.RemoveLeaf(t);var n=c.b2_aabbExtension+c.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var r=c.b2_aabbExtension+c.b2_aabbMultiplier*(i.y>0?i.y:-i.y);t.aabb.lowerBound.x=e.lowerBound.x-n;t.aabb.lowerBound.y=e.lowerBound.y-r;t.aabb.upperBound.x=e.upperBound.x+n;t.aabb.upperBound.y=e.upperBound.y+r;this.InsertLeaf(t);return true};A.prototype.Rebalance=function(t){if(t===undefined)t=0;if(this.m_root==null)return;for(var e=0;e<t;e++){var i=this.m_root;var n=0;while(i.IsLeaf()==false){i=this.m_path>>n&1?i.child2:i.child1;n=n+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};A.prototype.GetFatAABB=function(t){return t.aabb};A.prototype.GetUserData=function(t){return t.userData};A.prototype.Query=function(t,e){if(this.m_root==null)return;var i=new Vector;var n=0;i[n++]=this.m_root;while(n>0){var r=i[--n];if(r.aabb.TestOverlap(e)){if(r.IsLeaf()){var s=t(r);if(!s)return}else{i[n++]=r.child1;i[n++]=r.child2}}}};A.prototype.RayCast=function(t,e){if(this.m_root==null)return;var i=e.p1;var n=e.p2;var r=u.SubtractVV(i,n);r.Normalize();var s=u.CrossFV(1,r);var a=u.AbsV(s);var o=e.maxFraction;var c=new m;var l=0;var h=0;{l=i.x+o*(n.x-i.x);h=i.y+o*(n.y-i.y);c.lowerBound.x=Math.min(i.x,l);c.lowerBound.y=Math.min(i.y,h);c.upperBound.x=Math.max(i.x,l);c.upperBound.y=Math.max(i.y,h)}var d=new Vector;var _=0;d[_++]=this.m_root;while(_>0){var f=d[--_];if(f.aabb.TestOverlap(c)==false){continue}var p=f.aabb.GetCenter();var g=f.aabb.GetExtents();var v=Math.abs(s.x*(i.x-p.x)+s.y*(i.y-p.y))-a.x*g.x-a.y*g.y;if(v>0)continue;if(f.IsLeaf()){var y=new O;y.p1=e.p1;y.p2=e.p2;y.maxFraction=e.maxFraction;o=t(y,f);if(o==0)return;if(o>0){l=i.x+o*(n.x-i.x);h=i.y+o*(n.y-i.y);c.lowerBound.x=Math.min(i.x,l);c.lowerBound.y=Math.min(i.y,h);c.upperBound.x=Math.max(i.x,l);c.upperBound.y=Math.max(i.y,h)}}else{d[_++]=f.child1;d[_++]=f.child2}}};A.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new P};A.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};A.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(this.m_root==null){this.m_root=t;this.m_root.parent=null;return}var e=t.aabb.GetCenter();var i=this.m_root;if(i.IsLeaf()==false){do{var n=i.child1;var r=i.child2;var s=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);var a=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y);if(s<a){i=n}else{i=r}}while(i.IsLeaf()==false)}var o=i.parent;var c=this.AllocateNode();c.parent=o;c.userData=null;c.aabb.Combine(t.aabb,i.aabb);if(o){if(i.parent.child1==i){o.child1=c}else{o.child2=c}c.child1=i;c.child2=t;i.parent=c;t.parent=c;do{if(o.aabb.Contains(c.aabb))break;o.aabb.Combine(o.child1.aabb,o.child2.aabb);c=o;o=o.parent}while(o)}else{c.child1=i;c.child2=t;i.parent=c;t.parent=c;this.m_root=c}};A.prototype.RemoveLeaf=function(t){if(t==this.m_root){this.m_root=null;return}var e=t.parent;var i=e.parent;var n;if(e.child1==t){n=e.child2}else{n=e.child1}if(i){if(i.child1==e){i.child1=n}else{i.child2=n}n.parent=i;this.FreeNode(e);while(i){var r=i.aabb;i.aabb=m.Combine(i.child1.aabb,i.child2.aabb);if(r.Contains(i.aabb))break;i=i.parent}}else{this.m_root=n;n.parent=null;this.FreeNode(e)}};R.b2DynamicTreeBroadPhase=function(){this.m_tree=new A;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};R.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);++this.m_proxyCount;this.BufferMove(i);return i};R.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};R.prototype.MoveProxy=function(t,e,i){var n=this.m_tree.MoveProxy(t,e,i);if(n){this.BufferMove(t)}};R.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t);var n=this.m_tree.GetFatAABB(e);return i.TestOverlap(n)};R.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};R.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};R.prototype.GetProxyCount=function(){return this.m_proxyCount};R.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i=0,n;for(i=0;i<e.m_moveBuffer.length;++i){n=e.m_moveBuffer[i];function r(t){if(t==n)return true;if(e.m_pairCount==e.m_pairBuffer.length){e.m_pairBuffer[e.m_pairCount]=new w}var i=e.m_pairBuffer[e.m_pairCount];i.proxyA=t<n?t:n;i.proxyB=t>=n?t:n;++e.m_pairCount;return true}var s=e.m_tree.GetFatAABB(n);e.m_tree.Query(r,s)}e.m_moveBuffer.length=0;for(var i=0;i<e.m_pairCount;){var a=e.m_pairBuffer[i];var o=e.m_tree.GetUserData(a.proxyA);var c=e.m_tree.GetUserData(a.proxyB);t(o,c);++i;while(i<e.m_pairCount){var l=e.m_pairBuffer[i];if(l.proxyA!=a.proxyA||l.proxyB!=a.proxyB){break}++i}}};R.prototype.Query=function(t,e){this.m_tree.Query(t,e)};R.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)};R.prototype.Validate=function(){};R.prototype.Rebalance=function(t){if(t===undefined)t=0;this.m_tree.Rebalance(t)};R.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};R.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)};R.prototype.ComparePairs=function(t,e){return 0};R.__implements={};R.__implements[X]=true;P.b2DynamicTreeNode=function(){this.aabb=new m};P.prototype.IsLeaf=function(){return this.child1==null};w.b2DynamicTreePair=function(){};I.b2Manifold=function(){this.m_pointCount=0};I.prototype.b2Manifold=function(){this.m_points=new Vector(c.b2_maxManifoldPoints);for(var t=0;t<c.b2_maxManifoldPoints;t++){this.m_points[t]=new D}this.m_localPlaneNormal=new f;this.m_localPoint=new f};I.prototype.Reset=function(){for(var t=0;t<c.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof D?this.m_points[t]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};I.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<c.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof D?this.m_points[e]:null).Set(t.m_points[e])}this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};I.prototype.Copy=function(){var t=new I;t.Set(this);return t};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});D.b2ManifoldPoint=function(){this.m_localPoint=new f;this.m_id=new T};D.prototype.b2ManifoldPoint=function(){this.Reset()};D.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};D.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};L.b2Point=function(){this.p=new f};L.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;return this.p};L.prototype.GetFirstVertex=function(t){return this.p};O.b2RayCastInput=function(){this.p1=new f;this.p2=new f};O.prototype.b2RayCastInput=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=1;if(t)this.p1.SetV(t);if(e)this.p2.SetV(e);this.maxFraction=i};B.b2RayCastOutput=function(){this.normal=new f};F.b2Segment=function(){this.p1=new f;this.p2=new f};F.prototype.TestSegment=function(t,e,i,n){if(n===undefined)n=0;var r=i.p1;var s=i.p2.x-r.x;var a=i.p2.y-r.y;var o=this.p2.x-this.p1.x;var c=this.p2.y-this.p1.y;var l=c;var h=-o;var u=100*Number.MIN_VALUE;var d=-(s*l+a*h);if(d>u){var _=r.x-this.p1.x;var f=r.y-this.p1.y;var p=_*l+f*h;if(0<=p&&p<=n*d){var m=-s*f+a*_;if(-u*d<=m&&m<=d*(1+u)){p/=d;var g=Math.sqrt(l*l+h*h);l/=g;h/=g;t[0]=p;e.Set(l,h);return true}}}return false};F.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};F.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x;var i=this.p2.y-this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*n;this.p2.y=this.p1.y+i*n};F.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x;var i=-this.p2.y+this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*n;this.p1.y=this.p2.y+i*n};N.b2SeparationFunction=function(){this.m_localPoint=new f;this.m_axis=new f};N.prototype.Initialize=function(t,e,i,n,r){this.m_proxyA=e;this.m_proxyB=n;var s=parseInt(t.count);c.b2Assert(0<s&&s<3);var a;var o;var l;var h;var d;var _;var p=0;var m=0;var g=0;var v=0;var y=0;var T=0;var C;var S;var x=0;var E=0;if(s==1){this.m_type=N.e_points;a=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyB.GetVertex(t.indexB[0]);S=a;C=i.R;p=i.position.x+(C.col1.x*S.x+C.col2.x*S.y);m=i.position.y+(C.col1.y*S.x+C.col2.y*S.y);S=h;C=r.R;g=r.position.x+(C.col1.x*S.x+C.col2.x*S.y);v=r.position.y+(C.col1.y*S.x+C.col2.y*S.y);this.m_axis.x=g-p;this.m_axis.y=v-m;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=N.e_faceA;o=this.m_proxyA.GetVertex(t.indexA[0]);l=this.m_proxyA.GetVertex(t.indexA[1]);h=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(o.x+l.x);this.m_localPoint.y=.5*(o.y+l.y);this.m_axis=u.CrossVF(u.SubtractVV(l,o),1);this.m_axis.Normalize();S=this.m_axis;C=i.R;y=C.col1.x*S.x+C.col2.x*S.y;T=C.col1.y*S.x+C.col2.y*S.y;S=this.m_localPoint;C=i.R;p=i.position.x+(C.col1.x*S.x+C.col2.x*S.y);m=i.position.y+(C.col1.y*S.x+C.col2.y*S.y);S=h;C=r.R;g=r.position.x+(C.col1.x*S.x+C.col2.x*S.y);v=r.position.y+(C.col1.y*S.x+C.col2.y*S.y);x=(g-p)*y+(v-m)*T;if(x<0){this.m_axis.NegativeSelf()}}else if(t.indexA[0]==t.indexA[0]){this.m_type=N.e_faceB;d=this.m_proxyB.GetVertex(t.indexB[0]);_=this.m_proxyB.GetVertex(t.indexB[1]);a=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(d.x+_.x);this.m_localPoint.y=.5*(d.y+_.y);this.m_axis=u.CrossVF(u.SubtractVV(_,d),1);this.m_axis.Normalize();S=this.m_axis;C=r.R;y=C.col1.x*S.x+C.col2.x*S.y;T=C.col1.y*S.x+C.col2.y*S.y;S=this.m_localPoint;C=r.R;g=r.position.x+(C.col1.x*S.x+C.col2.x*S.y);v=r.position.y+(C.col1.y*S.x+C.col2.y*S.y);S=a;C=i.R;p=i.position.x+(C.col1.x*S.x+C.col2.x*S.y);m=i.position.y+(C.col1.y*S.x+C.col2.y*S.y);x=(p-g)*y+(m-v)*T;if(x<0){this.m_axis.NegativeSelf()}}else{o=this.m_proxyA.GetVertex(t.indexA[0]);l=this.m_proxyA.GetVertex(t.indexA[1]);d=this.m_proxyB.GetVertex(t.indexB[0]);_=this.m_proxyB.GetVertex(t.indexB[1]);var b=u.MulX(i,a);var A=u.MulMV(i.R,u.SubtractVV(l,o));var R=u.MulX(r,h);var P=u.MulMV(r.R,u.SubtractVV(_,d));var w=A.x*A.x+A.y*A.y;var I=P.x*P.x+P.y*P.y;var D=u.SubtractVV(P,A);var L=A.x*D.x+A.y*D.y;var O=P.x*D.x+P.y*D.y;var B=A.x*P.x+A.y*P.y;var F=w*I-B*B;x=0;if(F!=0){x=u.Clamp((B*O-L*I)/F,0,1)}var M=(B*x+O)/I;if(M<0){M=0;x=u.Clamp((B-L)/w,0,1)}a=new f;a.x=o.x+x*(l.x-o.x);a.y=o.y+x*(l.y-o.y);h=new f;h.x=d.x+x*(_.x-d.x);h.y=d.y+x*(_.y-d.y);if(x==0||x==1){this.m_type=N.e_faceB;
this.m_axis=u.CrossVF(u.SubtractVV(_,d),1);this.m_axis.Normalize();this.m_localPoint=h;S=this.m_axis;C=r.R;y=C.col1.x*S.x+C.col2.x*S.y;T=C.col1.y*S.x+C.col2.y*S.y;S=this.m_localPoint;C=r.R;g=r.position.x+(C.col1.x*S.x+C.col2.x*S.y);v=r.position.y+(C.col1.y*S.x+C.col2.y*S.y);S=a;C=i.R;p=i.position.x+(C.col1.x*S.x+C.col2.x*S.y);m=i.position.y+(C.col1.y*S.x+C.col2.y*S.y);E=(p-g)*y+(m-v)*T;if(x<0){this.m_axis.NegativeSelf()}}else{this.m_type=N.e_faceA;this.m_axis=u.CrossVF(u.SubtractVV(l,o),1);this.m_localPoint=a;S=this.m_axis;C=i.R;y=C.col1.x*S.x+C.col2.x*S.y;T=C.col1.y*S.x+C.col2.y*S.y;S=this.m_localPoint;C=i.R;p=i.position.x+(C.col1.x*S.x+C.col2.x*S.y);m=i.position.y+(C.col1.y*S.x+C.col2.y*S.y);S=h;C=r.R;g=r.position.x+(C.col1.x*S.x+C.col2.x*S.y);v=r.position.y+(C.col1.y*S.x+C.col2.y*S.y);E=(g-p)*y+(v-m)*T;if(x<0){this.m_axis.NegativeSelf()}}}};N.prototype.Evaluate=function(t,e){var i;var n;var r;var s;var a;var o;var l=0;var h;switch(this.m_type){case N.e_points:{i=u.MulTMV(t.R,this.m_axis);n=u.MulTMV(e.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(i);s=this.m_proxyB.GetSupportVertex(n);a=u.MulX(t,r);o=u.MulX(e,s);l=(o.x-a.x)*this.m_axis.x+(o.y-a.y)*this.m_axis.y;return l}case N.e_faceA:{h=u.MulMV(t.R,this.m_axis);a=u.MulX(t,this.m_localPoint);n=u.MulTMV(e.R,h.GetNegative());s=this.m_proxyB.GetSupportVertex(n);o=u.MulX(e,s);l=(o.x-a.x)*h.x+(o.y-a.y)*h.y;return l}case N.e_faceB:{h=u.MulMV(e.R,this.m_axis);o=u.MulX(e,this.m_localPoint);i=u.MulTMV(t.R,h.GetNegative());r=this.m_proxyA.GetSupportVertex(i);a=u.MulX(t,r);l=(a.x-o.x)*h.x+(a.y-o.y)*h.y;return l}default:c.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});M.b2Simplex=function(){this.m_v1=new k;this.m_v2=new k;this.m_v3=new k;this.m_vertices=new Vector(3)};M.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};M.prototype.ReadCache=function(t,e,i,n,r){c.b2Assert(0<=t.count&&t.count<=3);var s;var a;this.m_count=t.count;var o=this.m_vertices;for(var l=0;l<this.m_count;l++){var h=o[l];h.indexA=t.indexA[l];h.indexB=t.indexB[l];s=e.GetVertex(h.indexA);a=n.GetVertex(h.indexB);h.wA=u.MulX(i,s);h.wB=u.MulX(r,a);h.w=u.SubtractVV(h.wB,h.wA);h.a=0}if(this.m_count>1){var d=t.metric;var _=this.GetMetric();if(_<.5*d||2*d<_||_<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){h=o[0];h.indexA=0;h.indexB=0;s=e.GetVertex(0);a=n.GetVertex(0);h.wA=u.MulX(i,s);h.wB=u.MulX(r,a);h.w=u.SubtractVV(h.wB,h.wA);this.m_count=1}};M.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);var e=this.m_vertices;for(var i=0;i<this.m_count;i++){t.indexA[i]=Box2D.parseUInt(e[i].indexA);t.indexB[i]=Box2D.parseUInt(e[i].indexB)}};M.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var t=u.SubtractVV(this.m_v2.w,this.m_v1.w);var e=u.CrossVV(t,this.m_v1.w.GetNegative());if(e>0){return u.CrossFV(1,t)}else{return u.CrossVF(t,1)}}default:c.b2Assert(false);return new f}};M.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:c.b2Assert(false);return new f;case 1:return this.m_v1.w;case 2:return new f(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:c.b2Assert(false);return new f}};M.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:c.b2Assert(false);break;case 1:t.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:c.b2Assert(false);break}};M.prototype.GetMetric=function(){switch(this.m_count){case 0:c.b2Assert(false);return 0;case 1:return 0;case 2:return u.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return u.CrossVV(u.SubtractVV(this.m_v2.w,this.m_v1.w),u.SubtractVV(this.m_v3.w,this.m_v1.w));default:c.b2Assert(false);return 0}};M.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=u.SubtractVV(e,t);var n=-(t.x*i.x+t.y*i.y);if(n<=0){this.m_v1.a=1;this.m_count=1;return}var r=e.x*i.x+e.y*i.y;if(r<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var s=1/(r+n);this.m_v1.a=r*s;this.m_v2.a=n*s;this.m_count=2};M.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var n=u.SubtractVV(e,t);var r=u.Dot(t,n);var s=u.Dot(e,n);var a=s;var o=-r;var c=u.SubtractVV(i,t);var l=u.Dot(t,c);var h=u.Dot(i,c);var d=h;var _=-l;var f=u.SubtractVV(i,e);var p=u.Dot(e,f);var m=u.Dot(i,f);var g=m;var v=-p;var y=u.CrossVV(n,c);var T=y*u.CrossVV(e,i);var C=y*u.CrossVV(i,t);var S=y*u.CrossVV(t,e);if(o<=0&&_<=0){this.m_v1.a=1;this.m_count=1;return}if(a>0&&o>0&&S<=0){var x=1/(a+o);this.m_v1.a=a*x;this.m_v2.a=o*x;this.m_count=2;return}if(d>0&&_>0&&C<=0){var E=1/(d+_);this.m_v1.a=d*E;this.m_v3.a=_*E;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(a<=0&&v<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(d<=0&&g<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(g>0&&v>0&&T<=0){var b=1/(g+v);this.m_v2.a=g*b;this.m_v3.a=v*b;this.m_count=2;this.m_v1.Set(this.m_v3);return}var A=1/(T+C+S);this.m_v1.a=T*A;this.m_v2.a=C*A;this.m_v3.a=S*A;this.m_count=3};V.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};k.b2SimplexVertex=function(){};k.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};W.b2TimeOfImpact=function(){};W.TimeOfImpact=function(t){++W.b2_toiCalls;var e=t.proxyA;var i=t.proxyB;var n=t.sweepA;var r=t.sweepB;c.b2Assert(n.t0==r.t0);c.b2Assert(1-n.t0>Number.MIN_VALUE);var s=e.m_radius+i.m_radius;var a=t.tolerance;var o=0;var l=1e3;var h=0;var d=0;W.s_cache.count=0;W.s_distanceInput.useRadii=false;for(;;){n.GetTransform(W.s_xfA,o);r.GetTransform(W.s_xfB,o);W.s_distanceInput.proxyA=e;W.s_distanceInput.proxyB=i;W.s_distanceInput.transformA=W.s_xfA;W.s_distanceInput.transformB=W.s_xfB;S.Distance(W.s_distanceOutput,W.s_cache,W.s_distanceInput);if(W.s_distanceOutput.distance<=0){o=1;break}W.s_fcn.Initialize(W.s_cache,e,W.s_xfA,i,W.s_xfB);var _=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(_<=0){o=1;break}if(h==0){if(_>s){d=u.Max(s-a,.75*s)}else{d=u.Max(_-a,.02*s)}}if(_-d<.5*a){if(h==0){o=1;break}break}var f=o;{var p=o;var m=1;var g=_;n.GetTransform(W.s_xfA,m);r.GetTransform(W.s_xfB,m);var v=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(v>=d){o=1;break}var y=0;for(;;){var T=0;if(y&1){T=p+(d-g)*(m-p)/(v-g)}else{T=.5*(p+m)}n.GetTransform(W.s_xfA,T);r.GetTransform(W.s_xfB,T);var C=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(u.Abs(C-d)<.025*a){f=T;break}if(C>d){p=T;g=C}else{m=T;v=C}++y;++W.b2_toiRootIters;if(y==50){break}}W.b2_toiMaxRootIters=u.Max(W.b2_toiMaxRootIters,y)}if(f<(1+100*Number.MIN_VALUE)*o){break}o=f;h++;++W.b2_toiIters;if(h==l){break}}W.b2_toiMaxIters=u.Max(W.b2_toiMaxIters,h);return o};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new V;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new x;Box2D.Collision.b2TimeOfImpact.s_xfA=new _;Box2D.Collision.b2TimeOfImpact.s_xfB=new _;Box2D.Collision.b2TimeOfImpact.s_fcn=new N;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new E});G.b2TOIInput=function(){this.proxyA=new b;this.proxyB=new b;this.sweepA=new d;this.sweepB=new d};z.b2WorldManifold=function(){this.m_normal=new f};z.prototype.b2WorldManifold=function(){this.m_points=new Vector(c.b2_maxManifoldPoints);for(var t=0;t<c.b2_maxManifoldPoints;t++){this.m_points[t]=new f}};z.prototype.Initialize=function(t,e,i,n,r){if(i===undefined)i=0;if(r===undefined)r=0;if(t.m_pointCount==0){return}var s=0;var a;var o;var c=0;var l=0;var h=0;var u=0;var d=0;var _=0;switch(t.m_type){case I.e_circles:{o=e.R;a=t.m_localPoint;var f=e.position.x+o.col1.x*a.x+o.col2.x*a.y;var p=e.position.y+o.col1.y*a.x+o.col2.y*a.y;o=n.R;a=t.m_points[0].m_localPoint;var m=n.position.x+o.col1.x*a.x+o.col2.x*a.y;var g=n.position.y+o.col1.y*a.x+o.col2.y*a.y;var v=m-f;var y=g-p;var T=v*v+y*y;if(T>Number.MIN_VALUE*Number.MIN_VALUE){var C=Math.sqrt(T);this.m_normal.x=v/C;this.m_normal.y=y/C}else{this.m_normal.x=1;this.m_normal.y=0}var S=f+i*this.m_normal.x;var x=p+i*this.m_normal.y;var E=m-r*this.m_normal.x;var b=g-r*this.m_normal.y;this.m_points[0].x=.5*(S+E);this.m_points[0].y=.5*(x+b)}break;case I.e_faceA:{o=e.R;a=t.m_localPlaneNormal;c=o.col1.x*a.x+o.col2.x*a.y;l=o.col1.y*a.x+o.col2.y*a.y;o=e.R;a=t.m_localPoint;h=e.position.x+o.col1.x*a.x+o.col2.x*a.y;u=e.position.y+o.col1.y*a.x+o.col2.y*a.y;this.m_normal.x=c;this.m_normal.y=l;for(s=0;s<t.m_pointCount;s++){o=n.R;a=t.m_points[s].m_localPoint;d=n.position.x+o.col1.x*a.x+o.col2.x*a.y;_=n.position.y+o.col1.y*a.x+o.col2.y*a.y;this.m_points[s].x=d+.5*(i-(d-h)*c-(_-u)*l-r)*c;this.m_points[s].y=_+.5*(i-(d-h)*c-(_-u)*l-r)*l}}break;case I.e_faceB:{o=n.R;a=t.m_localPlaneNormal;c=o.col1.x*a.x+o.col2.x*a.y;l=o.col1.y*a.x+o.col2.y*a.y;o=n.R;a=t.m_localPoint;h=n.position.x+o.col1.x*a.x+o.col2.x*a.y;u=n.position.y+o.col1.y*a.x+o.col2.y*a.y;this.m_normal.x=-c;this.m_normal.y=-l;for(s=0;s<t.m_pointCount;s++){o=e.R;a=t.m_points[s].m_localPoint;d=e.position.x+o.col1.x*a.x+o.col2.x*a.y;_=e.position.y+o.col1.y*a.x+o.col2.y*a.y;this.m_points[s].x=d+.5*(r-(d-h)*c-(_-u)*l-i)*c;this.m_points[s].y=_+.5*(r-(d-h)*c-(_-u)*l-i)*l}}break}};U.ClipVertex=function(){this.v=new f;this.id=new T};U.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};Y.Features=function(){};Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._referenceEdge=t;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentEdge=t;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentVertex=t;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._flip=t;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,s=Box2D.Collision.Shapes.b2EdgeShape,a=Box2D.Collision.Shapes.b2MassData,o=Box2D.Collision.Shapes.b2PolygonShape,c=Box2D.Collision.Shapes.b2Shape,l=Box2D.Common.Math.b2Mat22,h=Box2D.Common.Math.b2Mat33,u=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,_=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,p=Box2D.Common.Math.b2Vec3,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,y=Box2D.Dynamics.b2ContactImpulse,T=Box2D.Dynamics.b2ContactListener,C=Box2D.Dynamics.b2ContactManager,S=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,E=Box2D.Dynamics.b2FilterData,b=Box2D.Dynamics.b2Fixture,A=Box2D.Dynamics.b2FixtureDef,R=Box2D.Dynamics.b2Island,P=Box2D.Dynamics.b2TimeStep,w=Box2D.Dynamics.b2World,I=Box2D.Collision.b2AABB,D=Box2D.Collision.b2Bound,L=Box2D.Collision.b2BoundValues,O=Box2D.Collision.b2Collision,B=Box2D.Collision.b2ContactID,F=Box2D.Collision.b2ContactPoint,N=Box2D.Collision.b2Distance,M=Box2D.Collision.b2DistanceInput,V=Box2D.Collision.b2DistanceOutput,k=Box2D.Collision.b2DistanceProxy,W=Box2D.Collision.b2DynamicTree,G=Box2D.Collision.b2DynamicTreeBroadPhase,z=Box2D.Collision.b2DynamicTreeNode,U=Box2D.Collision.b2DynamicTreePair,Y=Box2D.Collision.b2Manifold,X=Box2D.Collision.b2ManifoldPoint,H=Box2D.Collision.b2Point,j=Box2D.Collision.b2RayCastInput,q=Box2D.Collision.b2RayCastOutput,J=Box2D.Collision.b2Segment,Z=Box2D.Collision.b2SeparationFunction,K=Box2D.Collision.b2Simplex,Q=Box2D.Collision.b2SimplexCache,$=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision.b2TimeOfImpact,et=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,nt=Box2D.Collision.ClipVertex,rt=Box2D.Collision.Features,st=Box2D.Collision.IBroadPhase;Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new f};n.prototype.Copy=function(){var t=new n;t.Set(this);return t};n.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,n)){var e=t instanceof n?t:null;this.m_p.SetV(e.m_p)}};n.prototype.TestPoint=function(t,e){var i=t.R;var n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);n=e.x-n;r=e.y-r;return n*n+r*r<=this.m_radius*this.m_radius};n.prototype.RayCast=function(t,e,i){var n=i.R;var r=i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var s=i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);var a=e.p1.x-r;var o=e.p1.y-s;var c=a*a+o*o-this.m_radius*this.m_radius;var l=e.p2.x-e.p1.x;var h=e.p2.y-e.p1.y;var u=a*l+o*h;var d=l*l+h*h;var _=u*u-d*c;if(_<0||d<Number.MIN_VALUE){return false}var f=-(u+Math.sqrt(_));if(0<=f&&f<=e.maxFraction*d){f/=d;t.fraction=f;t.normal.x=a+f*l;t.normal.y=o+f*h;t.normal.Normalize();return true}return false};n.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(n-this.m_radius,r-this.m_radius);t.upperBound.Set(n+this.m_radius,r+this.m_radius)};n.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=e*i.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};n.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=u.MulX(i,this.m_p);var s=-(u.Dot(t,r)-e);if(s<-this.m_radius+Number.MIN_VALUE){return 0}if(s>this.m_radius){n.SetV(r);return Math.PI*this.m_radius*this.m_radius}var a=this.m_radius*this.m_radius;var o=s*s;var c=a*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(a-o);var l=-2/3*Math.pow(a-o,1.5)/c;n.x=r.x+t.x*l;n.y=r.y+t.y*l;return c};n.prototype.GetLocalPosition=function(){return this.m_p};n.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};n.prototype.GetRadius=function(){return this.m_radius};n.prototype.SetRadius=function(t){if(t===undefined)t=0;this.m_radius=t};n.prototype.b2CircleShape=function(t){if(t===undefined)t=0;this.__super.b2Shape.call(this);this.m_type=c.e_circleShape;this.m_radius=t};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new f;this.m_v1=new f;this.m_v2=new f;this.m_coreV1=new f;this.m_coreV2=new f;this.m_normal=new f;this.m_direction=new f;this.m_cornerDir1=new f;this.m_cornerDir2=new f};s.prototype.TestPoint=function(t,e){return false};s.prototype.RayCast=function(t,e,i){var n;var r=e.p2.x-e.p1.x;var s=e.p2.y-e.p1.y;n=i.R;var a=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y);var o=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y);var c=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-o;var l=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-a);var h=100*Number.MIN_VALUE;var u=-(r*c+s*l);if(u>h){var d=e.p1.x-a;var _=e.p1.y-o;var f=d*c+_*l;if(0<=f&&f<=e.maxFraction*u){var p=-r*_+s*d;if(-h*u<=p&&p<=u*(1+h)){f/=u;t.fraction=f;var m=Math.sqrt(c*c+l*l);t.normal.x=c/m;t.normal.y=l/m;return true}}}return false};s.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y);var r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y);var s=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);var a=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(n<s){t.lowerBound.x=n;t.upperBound.x=s}else{t.lowerBound.x=s;t.upperBound.x=n}if(r<a){t.lowerBound.y=r;t.upperBound.y=a}else{t.lowerBound.y=a;t.upperBound.y=r}};s.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=0;t.center.SetV(this.m_v1);t.I=0};s.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=new f(t.x*e,t.y*e);var s=u.MulX(i,this.m_v1);var a=u.MulX(i,this.m_v2);var o=u.Dot(t,s)-e;var c=u.Dot(t,a)-e;if(o>0){if(c>0){return 0}else{s.x=-c/(o-c)*s.x+o/(o-c)*a.x;s.y=-c/(o-c)*s.y+o/(o-c)*a.y}}else{if(c>0){a.x=-c/(o-c)*s.x+o/(o-c)*a.x;a.y=-c/(o-c)*s.y+o/(o-c)*a.y}else{}}n.x=(r.x+s.x+a.x)/3;n.y=(r.y+s.y+a.y)/3;return.5*((s.x-r.x)*(a.y-r.y)-(s.y-r.y)*(a.x-r.x))};s.prototype.GetLength=function(){return this.m_length};s.prototype.GetVertex1=function(){return this.m_v1};s.prototype.GetVertex2=function(){return this.m_v2};s.prototype.GetCoreVertex1=function(){return this.m_coreV1};s.prototype.GetCoreVertex2=function(){return this.m_coreV2};s.prototype.GetNormalVector=function(){return this.m_normal};s.prototype.GetDirectionVector=function(){return this.m_direction};s.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};s.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};s.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};s.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};s.prototype.GetFirstVertex=function(t){var e=t.R;return new f(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))};s.prototype.GetNextEdge=function(){return this.m_nextEdge};s.prototype.GetPrevEdge=function(){return this.m_prevEdge};s.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=t.R;var r=t.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y);var s=t.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y);var a=t.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y);var o=t.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y);if(r*e+s*i>a*e+o*i){this.s_supportVec.x=r;this.s_supportVec.y=s}else{this.s_supportVec.x=a;this.s_supportVec.y=o}return this.s_supportVec};s.prototype.b2EdgeShape=function(t,e){this.__super.b2Shape.call(this);this.m_type=c.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=t;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};s.prototype.SetPrevEdge=function(t,e,i,n){this.m_prevEdge=t;this.m_coreV1=e;this.m_cornerDir1=i;this.m_cornerConvex1=n};s.prototype.SetNextEdge=function(t,e,i,n){this.m_nextEdge=t;this.m_coreV2=e;this.m_cornerDir2=i;this.m_cornerConvex2=n};a.b2MassData=function(){this.mass=0;this.center=new f(0,0);this.I=0};Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape);o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;o.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};o.prototype.Copy=function(){var t=new o;t.Set(this);return t};o.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,o)){var e=t instanceof o?t:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++){this.m_vertices[i].SetV(e.m_vertices[i]);this.m_normals[i].SetV(e.m_normals[i])}}};o.prototype.SetAsArray=function(t,e){if(e===undefined)e=0;var i=new Vector;var n=0,r;for(n=0;n<t.length;++n){r=t[n];i.push(r)}this.SetAsVector(i,e)};o.AsArray=function(t,e){if(e===undefined)e=0;var i=new o;i.SetAsArray(t,e);return i};o.prototype.SetAsVector=function(t,e){if(e===undefined)e=0;if(e==0)e=t.length;i.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);var n=0;for(n=0;n<this.m_vertexCount;n++){this.m_vertices[n].SetV(t[n])}for(n=0;n<this.m_vertexCount;++n){var r=parseInt(n);var s=parseInt(n+1<this.m_vertexCount?n+1:0);var a=u.SubtractVV(this.m_vertices[s],this.m_vertices[r]);i.b2Assert(a.LengthSquared()>Number.MIN_VALUE);this.m_normals[n].SetV(u.CrossVF(a,1));this.m_normals[n].Normalize()}this.m_centroid=o.ComputeCentroid(this.m_vertices,this.m_vertexCount)};o.AsVector=function(t,e){if(e===undefined)e=0;var i=new o;i.SetAsVector(t,e);return i};o.prototype.SetAsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};o.AsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=new o;i.SetAsBox(t,e);return i};o.prototype.SetAsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;var r=new _;r.position=i;r.R.Set(n);for(var s=0;s<this.m_vertexCount;++s){this.m_vertices[s]=u.MulX(r,this.m_vertices[s]);this.m_normals[s]=u.MulMV(r.R,this.m_normals[s])}};o.AsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;var r=new o;r.SetAsOrientedBox(t,e,i,n);return r};o.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(e);this.m_centroid.x=.5*(t.x+e.x);this.m_centroid.y=.5*(t.y+e.y);this.m_normals[0]=u.CrossVF(u.SubtractVV(e,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};o.AsEdge=function(t,e){var i=new o;i.SetAsEdge(t,e);return i};o.prototype.TestPoint=function(t,e){var i;var n=t.R;var r=e.x-t.position.x;var s=e.y-t.position.y;var a=r*n.col1.x+s*n.col1.y;var o=r*n.col2.x+s*n.col2.y;for(var c=0;c<this.m_vertexCount;++c){i=this.m_vertices[c];r=a-i.x;s=o-i.y;i=this.m_normals[c];var l=i.x*r+i.y*s;if(l>0){return false}}return true};o.prototype.RayCast=function(t,e,i){var n=0;var r=e.maxFraction;var s=0;var a=0;var o;var c;s=e.p1.x-i.position.x;a=e.p1.y-i.position.y;o=i.R;var l=s*o.col1.x+a*o.col1.y;var h=s*o.col2.x+a*o.col2.y;s=e.p2.x-i.position.x;a=e.p2.y-i.position.y;o=i.R;var u=s*o.col1.x+a*o.col1.y;var d=s*o.col2.x+a*o.col2.y;var _=u-l;var f=d-h;var p=parseInt(-1);for(var m=0;m<this.m_vertexCount;++m){c=this.m_vertices[m];s=c.x-l;a=c.y-h;c=this.m_normals[m];var g=c.x*s+c.y*a;var v=c.x*_+c.y*f;if(v==0){if(g<0){return false}}else{if(v<0&&g<n*v){n=g/v;p=m}else if(v>0&&g<r*v){r=g/v}}if(r<n-Number.MIN_VALUE){return false}}if(p>=0){t.fraction=n;o=i.R;c=this.m_normals[p];t.normal.x=o.col1.x*c.x+o.col2.x*c.y;t.normal.y=o.col1.y*c.x+o.col2.y*c.y;return true}return false};o.prototype.ComputeAABB=function(t,e){var i=e.R;var n=this.m_vertices[0];var r=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var s=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);var a=r;var o=s;for(var c=1;c<this.m_vertexCount;++c){n=this.m_vertices[c];var l=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var h=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);r=r<l?r:l;s=s<h?s:h;a=a>l?a:l;o=o>h?o:h}t.lowerBound.x=r-this.m_radius;t.lowerBound.y=s-this.m_radius;t.upperBound.x=a+this.m_radius;t.upperBound.y=o+this.m_radius};o.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;if(this.m_vertexCount==2){t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0;return}var i=0;var n=0;var r=0;var s=0;var a=0;var o=0;var c=1/3;for(var l=0;l<this.m_vertexCount;++l){var h=this.m_vertices[l];var u=l+1<this.m_vertexCount?this.m_vertices[parseInt(l+1)]:this.m_vertices[0];var d=h.x-a;var _=h.y-o;var f=u.x-a;var p=u.y-o;var m=d*p-_*f;var g=.5*m;r+=g;i+=g*c*(a+h.x+u.x);n+=g*c*(o+h.y+u.y);var v=a;var y=o;var T=d;var C=_;var S=f;var x=p;var E=c*(.25*(T*T+S*T+S*S)+(v*T+v*S))+.5*v*v;var b=c*(.25*(C*C+x*C+x*x)+(y*C+y*x))+.5*y*y;s+=m*(E+b)}t.mass=e*r;i*=1/r;n*=1/r;t.center.Set(i,n);t.I=e*s};o.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=u.MulTMV(i.R,t);var s=e-u.Dot(t,i.position);var o=new Vector_a2j_Number;var c=0;var l=parseInt(-1);var h=parseInt(-1);var d=false;var _=0;for(_=0;_<this.m_vertexCount;++_){o[_]=u.Dot(r,this.m_vertices[_])-s;var p=o[_]<-Number.MIN_VALUE;if(_>0){if(p){if(!d){l=_-1;c++}}else{if(d){h=_-1;c++}}}d=p}switch(c){case 0:if(d){var m=new a;this.ComputeMass(m,1);n.SetV(u.MulX(i,m.center));return m.mass}else{return 0}break;case 1:if(l==-1){l=this.m_vertexCount-1}else{h=this.m_vertexCount-1}break}var g=parseInt((l+1)%this.m_vertexCount);var v=parseInt((h+1)%this.m_vertexCount);var y=(0-o[l])/(o[g]-o[l]);var T=(0-o[h])/(o[v]-o[h]);var C=new f(this.m_vertices[l].x*(1-y)+this.m_vertices[g].x*y,this.m_vertices[l].y*(1-y)+this.m_vertices[g].y*y);var S=new f(this.m_vertices[h].x*(1-T)+this.m_vertices[v].x*T,this.m_vertices[h].y*(1-T)+this.m_vertices[v].y*T);var x=0;var E=new f;var b=this.m_vertices[g];var A;_=g;while(_!=v){_=(_+1)%this.m_vertexCount;if(_==v)A=S;else A=this.m_vertices[_];var R=.5*((b.x-C.x)*(A.y-C.y)-(b.y-C.y)*(A.x-C.x));x+=R;E.x+=R*(C.x+b.x+A.x)/3;E.y+=R*(C.y+b.y+A.y)/3;b=A}E.Multiply(1/x);n.SetV(u.MulX(i,E));return x};o.prototype.GetVertexCount=function(){return this.m_vertexCount};o.prototype.GetVertices=function(){return this.m_vertices};o.prototype.GetNormals=function(){return this.m_normals};o.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};o.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};o.prototype.Validate=function(){return false};o.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=c.e_polygonShape;this.m_centroid=new f;this.m_vertices=new Vector;this.m_normals=new Vector};o.prototype.Reserve=function(t){if(t===undefined)t=0;for(var e=parseInt(this.m_vertices.length);e<t;e++){this.m_vertices[e]=new f;this.m_normals[e]=new f}};o.ComputeCentroid=function(t,e){if(e===undefined)e=0;var i=new f;var n=0;var r=0;var s=0;var a=1/3;for(var o=0;o<e;++o){var c=t[o];var l=o+1<e?t[parseInt(o+1)]:t[0];var h=c.x-r;var u=c.y-s;var d=l.x-r;var _=l.y-s;var p=h*_-u*d;var m=.5*p;n+=m;i.x+=m*a*(r+c.x+l.x);i.y+=m*a*(s+c.y+l.y)}i.x*=1/n;i.y*=1/n;return i};o.ComputeOBB=function(t,e,i){if(i===undefined)i=0;var n=0;var r=new Vector(i+1);for(n=0;n<i;++n){r[n]=e[n]}r[i]=r[0];var s=Number.MAX_VALUE;for(n=1;n<=i;++n){var a=r[parseInt(n-1)];var o=r[n].x-a.x;var c=r[n].y-a.y;var l=Math.sqrt(o*o+c*c);o/=l;c/=l;var h=-c;var u=o;var d=Number.MAX_VALUE;var _=Number.MAX_VALUE;var f=-Number.MAX_VALUE;var p=-Number.MAX_VALUE;for(var m=0;m<i;++m){var g=r[m].x-a.x;var v=r[m].y-a.y;var y=o*g+c*v;var T=h*g+u*v;if(y<d)d=y;if(T<_)_=T;if(y>f)f=y;if(T>p)p=T}var C=(f-d)*(p-_);if(C<.95*s){s=C;t.R.col1.x=o;t.R.col1.y=c;t.R.col2.x=h;t.R.col2.y=u;var S=.5*(d+f);var x=.5*(_+p);var E=t.R;t.center.x=a.x+(E.col1.x*S+E.col2.x*x);t.center.y=a.y+(E.col1.y*S+E.col2.y*x);t.extents.x=.5*(f-d);t.extents.y=.5*(p-_)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new l});c.b2Shape=function(){};c.prototype.Copy=function(){return null};c.prototype.Set=function(t){this.m_radius=t.m_radius};c.prototype.GetType=function(){return this.m_type};c.prototype.TestPoint=function(t,e){return false};c.prototype.RayCast=function(t,e,i){return false};c.prototype.ComputeAABB=function(t,e){};c.prototype.ComputeMass=function(t,e){if(e===undefined)e=0};c.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;return 0};c.TestOverlap=function(t,e,i,n){var r=new M;r.proxyA=new k;r.proxyA.Set(t);r.proxyB=new k;r.proxyB.Set(i);r.transformA=e;r.transformB=n;r.useRadii=true;var s=new Q;s.count=0;var a=new V;N.Distance(a,s,r);return a.distance<10*Number.MIN_VALUE};c.prototype.b2Shape=function(){this.m_type=c.e_unknownShape;this.m_radius=i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*s.Clamp(t,0,1));this._g=Box2D.parseUInt(255*s.Clamp(e,0,1));this._b=Box2D.parseUInt(255*s.Clamp(i,0,1))};t.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*s.Clamp(t,0,1));this._g=Box2D.parseUInt(255*s.Clamp(e,0,1));this._b=Box2D.parseUInt(255*s.Clamp(i,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._r=Box2D.parseUInt(255*s.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._g=Box2D.parseUInt(255*s.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._b=Box2D.parseUInt(255*s.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,e){if(t===undefined)t=0;
if(e===undefined)e=0;return Math.sqrt(t*e)};i.b2MixRestitution=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};i.b2Assert=function(t){if(!t){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})})();(function(){var t=Box2D.Collision.b2AABB,e=Box2D.Common.b2Color,i=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,s=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,c=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;r.b2Mat22=function(){this.col1=new l;this.col2=new l};r.prototype.b2Mat22=function(){this.SetIdentity()};r.FromAngle=function(t){if(t===undefined)t=0;var e=new r;e.Set(t);return e};r.FromVV=function(t,e){var i=new r;i.SetVV(t,e);return i};r.prototype.Set=function(t){if(t===undefined)t=0;var e=Math.cos(t);var i=Math.sin(t);this.col1.x=e;this.col2.x=-i;this.col1.y=i;this.col2.y=e};r.prototype.SetVV=function(t,e){this.col1.SetV(t);this.col2.SetV(e)};r.prototype.Copy=function(){var t=new r;t.SetM(this);return t};r.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};r.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};r.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};r.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};r.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};r.prototype.GetInverse=function(t){var e=this.col1.x;var i=this.col2.x;var n=this.col1.y;var r=this.col2.y;var s=e*r-i*n;if(s!=0){s=1/s}t.col1.x=s*r;t.col2.x=-s*i;t.col1.y=-s*n;t.col2.y=s*e;return t};r.prototype.Solve=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var s=this.col1.y;var a=this.col2.y;var o=n*a-r*s;if(o!=0){o=1/o}t.x=o*(a*e-r*i);t.y=o*(n*i-s*e);return t};r.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};s.b2Mat33=function(){this.col1=new h;this.col2=new h;this.col3=new h};s.prototype.b2Mat33=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=null;if(!t&&!e&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)}};s.prototype.SetVVV=function(t,e,i){this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)};s.prototype.Copy=function(){return new s(this.col1,this.col2,this.col3)};s.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};s.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};s.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};s.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};s.prototype.Solve22=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var s=this.col1.y;var a=this.col2.y;var o=n*a-r*s;if(o!=0){o=1/o}t.x=o*(a*e-r*i);t.y=o*(n*i-s*e);return t};s.prototype.Solve33=function(t,e,i,n){if(e===undefined)e=0;if(i===undefined)i=0;if(n===undefined)n=0;var r=this.col1.x;var s=this.col1.y;var a=this.col1.z;var o=this.col2.x;var c=this.col2.y;var l=this.col2.z;var h=this.col3.x;var u=this.col3.y;var d=this.col3.z;var _=r*(c*d-l*u)+s*(l*h-o*d)+a*(o*u-c*h);if(_!=0){_=1/_}t.x=_*(e*(c*d-l*u)+i*(l*h-o*d)+n*(o*u-c*h));t.y=_*(r*(i*d-n*u)+s*(n*h-e*d)+a*(e*u-i*h));t.z=_*(r*(c*n-l*i)+s*(l*e-o*n)+a*(o*i-c*e));return t};a.b2Math=function(){};a.IsValid=function(t){if(t===undefined)t=0;return isFinite(t)};a.Dot=function(t,e){return t.x*e.x+t.y*e.y};a.CrossVV=function(t,e){return t.x*e.y-t.y*e.x};a.CrossVF=function(t,e){if(e===undefined)e=0;var i=new l(e*t.y,-e*t.x);return i};a.CrossFV=function(t,e){if(t===undefined)t=0;var i=new l(-t*e.y,t*e.x);return i};a.MulMV=function(t,e){var i=new l(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i};a.MulTMV=function(t,e){var i=new l(a.Dot(e,t.col1),a.Dot(e,t.col2));return i};a.MulX=function(t,e){var i=a.MulMV(t.R,e);i.x+=t.position.x;i.y+=t.position.y;return i};a.MulXT=function(t,e){var i=a.SubtractVV(e,t.position);var n=i.x*t.R.col1.x+i.y*t.R.col1.y;i.y=i.x*t.R.col2.x+i.y*t.R.col2.y;i.x=n;return i};a.AddVV=function(t,e){var i=new l(t.x+e.x,t.y+e.y);return i};a.SubtractVV=function(t,e){var i=new l(t.x-e.x,t.y-e.y);return i};a.Distance=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(i*i+n*n)};a.DistanceSquared=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return i*i+n*n};a.MulFV=function(t,e){if(t===undefined)t=0;var i=new l(t*e.x,t*e.y);return i};a.AddMM=function(t,e){var i=r.FromVV(a.AddVV(t.col1,e.col1),a.AddVV(t.col2,e.col2));return i};a.MulMM=function(t,e){var i=r.FromVV(a.MulMV(t,e.col1),a.MulMV(t,e.col2));return i};a.MulTMM=function(t,e){var i=new l(a.Dot(t.col1,e.col1),a.Dot(t.col2,e.col1));var n=new l(a.Dot(t.col1,e.col2),a.Dot(t.col2,e.col2));var s=r.FromVV(i,n);return s};a.Abs=function(t){if(t===undefined)t=0;return t>0?t:-t};a.AbsV=function(t){var e=new l(a.Abs(t.x),a.Abs(t.y));return e};a.AbsM=function(t){var e=r.FromVV(a.AbsV(t.col1),a.AbsV(t.col2));return e};a.Min=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t<e?t:e};a.MinV=function(t,e){var i=new l(a.Min(t.x,e.x),a.Min(t.y,e.y));return i};a.Max=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};a.MaxV=function(t,e){var i=new l(a.Max(t.x,e.x),a.Max(t.y,e.y));return i};a.Clamp=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;return t<e?e:t>i?i:t};a.ClampV=function(t,e,i){return a.MaxV(e,a.MinV(t,i))};a.Swap=function(t,e){var i=t[0];t[0]=e[0];e[0]=i};a.Random=function(){return Math.random()*2-1};a.RandomRange=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=Math.random();i=(e-t)*i+t;return i};a.NextPowerOfTwo=function(t){if(t===undefined)t=0;t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};a.IsPowerOfTwo=function(t){if(t===undefined)t=0;var e=t>0&&(t&t-1)==0;return e};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new l(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=r.FromVV(new l(1,0),new l(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new c(a.b2Vec2_zero,a.b2Mat22_identity)});o.b2Sweep=function(){this.localCenter=new l;this.c0=new l;this.c=new l};o.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};o.prototype.Copy=function(){var t=new o;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};o.prototype.GetTransform=function(t,e){if(e===undefined)e=0;t.position.x=(1-e)*this.c0.x+e*this.c.x;t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var n=t.R;t.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y;t.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y};o.prototype.Advance=function(t){if(t===undefined)t=0;if(this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=t}};c.b2Transform=function(){this.position=new l;this.R=new r};c.prototype.b2Transform=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;if(t){this.position.SetV(t);this.R.SetM(e)}};c.prototype.Initialize=function(t,e){this.position.SetV(t);this.R.SetM(e)};c.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};c.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};c.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};l.b2Vec2=function(){};l.prototype.b2Vec2=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};l.prototype.SetZero=function(){this.x=0;this.y=0};l.prototype.Set=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};l.prototype.SetV=function(t){this.x=t.x;this.y=t.y};l.prototype.GetNegative=function(){return new l(-this.x,-this.y)};l.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};l.Make=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return new l(t,e)};l.prototype.Copy=function(){return new l(this.x,this.y)};l.prototype.Add=function(t){this.x+=t.x;this.y+=t.y};l.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};l.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t};l.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y;this.y=t.col1.y*e+t.col2.y*this.y};l.prototype.MulTM=function(t){var e=a.Dot(this,t.col1);this.y=a.Dot(this,t.col2);this.x=e};l.prototype.CrossVF=function(t){if(t===undefined)t=0;var e=this.x;this.x=t*this.y;this.y=-t*e};l.prototype.CrossFV=function(t){if(t===undefined)t=0;var e=this.x;this.x=-t*this.y;this.y=t*e};l.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};l.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};l.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};l.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};l.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};l.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE){return 0}var e=1/t;this.x*=e;this.y*=e;return t};l.prototype.IsValid=function(){return a.IsValid(this.x)&&a.IsValid(this.y)};h.b2Vec3=function(){};h.prototype.b2Vec3=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};h.prototype.SetZero=function(){this.x=this.y=this.z=0};h.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};h.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};h.prototype.GetNegative=function(){return new h(-this.x,-this.y,-this.z)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};h.prototype.Copy=function(){return new h(this.x,this.y,this.z)};h.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};h.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};h.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t;this.z*=t}})();(function(){var t=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3,c=Box2D.Common.b2Color,l=Box2D.Common.b2internal,h=Box2D.Common.b2Settings,u=Box2D.Collision.b2AABB,d=Box2D.Collision.b2Bound,_=Box2D.Collision.b2BoundValues,f=Box2D.Collision.b2Collision,p=Box2D.Collision.b2ContactID,m=Box2D.Collision.b2ContactPoint,g=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,y=Box2D.Collision.b2DistanceOutput,T=Box2D.Collision.b2DistanceProxy,C=Box2D.Collision.b2DynamicTree,S=Box2D.Collision.b2DynamicTreeBroadPhase,x=Box2D.Collision.b2DynamicTreeNode,E=Box2D.Collision.b2DynamicTreePair,b=Box2D.Collision.b2Manifold,A=Box2D.Collision.b2ManifoldPoint,R=Box2D.Collision.b2Point,P=Box2D.Collision.b2RayCastInput,w=Box2D.Collision.b2RayCastOutput,I=Box2D.Collision.b2Segment,D=Box2D.Collision.b2SeparationFunction,L=Box2D.Collision.b2Simplex,O=Box2D.Collision.b2SimplexCache,B=Box2D.Collision.b2SimplexVertex,F=Box2D.Collision.b2TimeOfImpact,N=Box2D.Collision.b2TOIInput,M=Box2D.Collision.b2WorldManifold,V=Box2D.Collision.ClipVertex,k=Box2D.Collision.Features,W=Box2D.Collision.IBroadPhase,G=Box2D.Collision.Shapes.b2CircleShape,z=Box2D.Collision.Shapes.b2EdgeChainDef,U=Box2D.Collision.Shapes.b2EdgeShape,Y=Box2D.Collision.Shapes.b2MassData,X=Box2D.Collision.Shapes.b2PolygonShape,H=Box2D.Collision.Shapes.b2Shape,j=Box2D.Dynamics.b2Body,q=Box2D.Dynamics.b2BodyDef,J=Box2D.Dynamics.b2ContactFilter,Z=Box2D.Dynamics.b2ContactImpulse,K=Box2D.Dynamics.b2ContactListener,Q=Box2D.Dynamics.b2ContactManager,$=Box2D.Dynamics.b2DebugDraw,tt=Box2D.Dynamics.b2DestructionListener,et=Box2D.Dynamics.b2FilterData,it=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,st=Box2D.Dynamics.b2TimeStep,at=Box2D.Dynamics.b2World,ot=Box2D.Dynamics.Contacts.b2CircleContact,ct=Box2D.Dynamics.Contacts.b2Contact,lt=Box2D.Dynamics.Contacts.b2ContactConstraint,ht=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ut=Box2D.Dynamics.Contacts.b2ContactEdge,dt=Box2D.Dynamics.Contacts.b2ContactFactory,_t=Box2D.Dynamics.Contacts.b2ContactRegister,ft=Box2D.Dynamics.Contacts.b2ContactResult,pt=Box2D.Dynamics.Contacts.b2ContactSolver,mt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,gt=Box2D.Dynamics.Contacts.b2NullContact,vt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,yt=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Tt=Box2D.Dynamics.Contacts.b2PolygonContact,Ct=Box2D.Dynamics.Contacts.b2PositionSolverManifold,St=Box2D.Dynamics.Controllers.b2Controller,xt=Box2D.Dynamics.Joints.b2DistanceJoint,Et=Box2D.Dynamics.Joints.b2DistanceJointDef,bt=Box2D.Dynamics.Joints.b2FrictionJoint,At=Box2D.Dynamics.Joints.b2FrictionJointDef,Rt=Box2D.Dynamics.Joints.b2GearJoint,Pt=Box2D.Dynamics.Joints.b2GearJointDef,wt=Box2D.Dynamics.Joints.b2Jacobian,It=Box2D.Dynamics.Joints.b2Joint,Dt=Box2D.Dynamics.Joints.b2JointDef,Lt=Box2D.Dynamics.Joints.b2JointEdge,Ot=Box2D.Dynamics.Joints.b2LineJoint,Bt=Box2D.Dynamics.Joints.b2LineJointDef,Ft=Box2D.Dynamics.Joints.b2MouseJoint,Nt=Box2D.Dynamics.Joints.b2MouseJointDef,Mt=Box2D.Dynamics.Joints.b2PrismaticJoint,Vt=Box2D.Dynamics.Joints.b2PrismaticJointDef,kt=Box2D.Dynamics.Joints.b2PulleyJoint,Wt=Box2D.Dynamics.Joints.b2PulleyJointDef,Gt=Box2D.Dynamics.Joints.b2RevoluteJoint,zt=Box2D.Dynamics.Joints.b2RevoluteJointDef,Ut=Box2D.Dynamics.Joints.b2WeldJoint,Yt=Box2D.Dynamics.Joints.b2WeldJointDef;j.b2Body=function(){this.m_xf=new s;this.m_sweep=new r;this.m_linearVelocity=new a;this.m_force=new a};j.prototype.connectEdges=function(t,e,i){if(i===undefined)i=0;var r=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x);var s=Math.tan((r-i)*.5);var a=n.MulFV(s,e.GetDirectionVector());a=n.SubtractVV(a,e.GetNormalVector());a=n.MulFV(h.b2_toiSlop,a);a=n.AddVV(a,e.GetVertex1());var o=n.AddVV(t.GetDirectionVector(),e.GetDirectionVector());o.Normalize();var c=n.Dot(t.GetDirectionVector(),e.GetNormalVector())>0;t.SetNextEdge(e,a,o,c);e.SetPrevEdge(t,a,o,c);return r};j.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==true){return null}var e=new it;e.Create(this,this.m_xf,t);if(this.m_flags&j.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}e.m_next=this.m_fixtureList;this.m_fixtureList=e;++this.m_fixtureCount;e.m_body=this;if(e.m_density>0){this.ResetMassData()}this.m_world.m_flags|=at.e_newFixture;return e};j.prototype.CreateFixture2=function(t,e){if(e===undefined)e=0;var i=new nt;i.shape=t;i.density=e;return this.CreateFixture(i)};j.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()==true){return}var e=this.m_fixtureList;var i=null;var n=false;while(e!=null){if(e==t){if(i)i.m_next=t.m_next;else this.m_fixtureList=t.m_next;n=true;break}i=e;e=e.m_next}var r=this.m_contactList;while(r){var s=r.contact;r=r.next;var a=s.GetFixtureA();var o=s.GetFixtureB();if(t==a||t==o){this.m_world.m_contactManager.Destroy(s)}}if(this.m_flags&j.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(c)}else{}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()};j.prototype.SetPositionAndAngle=function(t,e){if(e===undefined)e=0;var i;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(e);this.m_xf.position.SetV(t);var n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y;this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;var s=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.Synchronize(s,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};j.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};j.prototype.GetTransform=function(){return this.m_xf};j.prototype.GetPosition=function(){return this.m_xf.position};j.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};j.prototype.GetAngle=function(){return this.m_sweep.a};j.prototype.SetAngle=function(t){if(t===undefined)t=0;this.SetPositionAndAngle(this.GetPosition(),t)};j.prototype.GetWorldCenter=function(){return this.m_sweep.c};j.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};j.prototype.SetLinearVelocity=function(t){if(this.m_type==j.b2_staticBody){return}this.m_linearVelocity.SetV(t)};j.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};j.prototype.SetAngularVelocity=function(t){if(t===undefined)t=0;if(this.m_type==j.b2_staticBody){return}this.m_angularVelocity=t};j.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};j.prototype.GetDefinition=function(){var t=new q;t.type=this.GetType();t.allowSleep=(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag;t.bullet=(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag;t.awake=(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};j.prototype.ApplyForce=function(t,e){if(this.m_type!=j.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x};j.prototype.ApplyTorque=function(t){if(t===undefined)t=0;if(this.m_type!=j.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=t};j.prototype.ApplyImpulse=function(t,e){if(this.m_type!=j.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)};j.prototype.Split=function(t){var e=this.GetLinearVelocity().Copy();var i=this.GetAngularVelocity();var r=this.GetWorldCenter();var s=this;var a=this.m_world.CreateBody(this.GetDefinition());var o;for(var c=s.m_fixtureList;c;){if(t(c)){var l=c.m_next;if(o){o.m_next=l}else{s.m_fixtureList=l}s.m_fixtureCount--;c.m_next=a.m_fixtureList;a.m_fixtureList=c;a.m_fixtureCount++;c.m_body=a;c=l}else{o=c;c=c.m_next}}s.ResetMassData();a.ResetMassData();var h=s.GetWorldCenter();var u=a.GetWorldCenter();var d=n.AddVV(e,n.CrossFV(i,n.SubtractVV(h,r)));var _=n.AddVV(e,n.CrossFV(i,n.SubtractVV(u,r)));s.SetLinearVelocity(d);a.SetLinearVelocity(_);s.SetAngularVelocity(i);a.SetAngularVelocity(i);s.SynchronizeFixtures();a.SynchronizeFixtures();return a};j.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--;e.m_next=this.m_fixtureList;this.m_fixtureList=e;this.m_fixtureCount++;e.m_body=r;e=i}n.m_fixtureCount=0;var n=this;var r=t;var s=n.GetWorldCenter();var a=r.GetWorldCenter();var o=n.GetLinearVelocity().Copy();var c=r.GetLinearVelocity().Copy();var l=n.GetAngularVelocity();var h=r.GetAngularVelocity();n.ResetMassData();this.SynchronizeFixtures()};j.prototype.GetMass=function(){return this.m_mass};j.prototype.GetInertia=function(){return this.m_I};j.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};j.prototype.SetMassData=function(t){h.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=j.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&j.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)};j.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==j.b2_staticBody||this.m_type==j.b2_kinematicBody){return}var t=a.Make(0,0);for(var e=this.m_fixtureList;e;e=e.m_next){if(e.m_density==0){continue}var i=e.GetMassData();this.m_mass+=i.mass;t.x+=i.center.x*i.mass;t.y+=i.center.y*i.mass;this.m_I+=i.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&j.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;h.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)};j.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return i};j.prototype.GetWorldVector=function(t){return n.MulMV(this.m_xf.R,t)};j.prototype.GetLocalPoint=function(t){return n.MulXT(this.m_xf,t)};j.prototype.GetLocalVector=function(t){return n.MulTMV(this.m_xf.R,t)};j.prototype.GetLinearVelocityFromWorldPoint=function(t){return new a(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};j.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return new a(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};j.prototype.GetLinearDamping=function(){return this.m_linearDamping};j.prototype.SetLinearDamping=function(t){if(t===undefined)t=0;this.m_linearDamping=t};j.prototype.GetAngularDamping=function(){return this.m_angularDamping};j.prototype.SetAngularDamping=function(t){if(t===undefined)t=0;this.m_angularDamping=t};j.prototype.SetType=function(t){if(t===undefined)t=0;if(this.m_type==t){return}this.m_type=t;this.ResetMassData();if(this.m_type==j.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var e=this.m_contactList;e;e=e.next){e.contact.FlagForFiltering()}};j.prototype.GetType=function(){return this.m_type};j.prototype.SetBullet=function(t){if(t){this.m_flags|=j.e_bulletFlag}else{this.m_flags&=~j.e_bulletFlag}};j.prototype.IsBullet=function(){return(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag};j.prototype.SetSleepingAllowed=function(t){if(t){this.m_flags|=j.e_allowSleepFlag}else{this.m_flags&=~j.e_allowSleepFlag;this.SetAwake(true)}};j.prototype.SetAwake=function(t){if(t){this.m_flags|=j.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~j.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};j.prototype.IsAwake=function(){return(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag};j.prototype.SetFixedRotation=function(t){if(t){this.m_flags|=j.e_fixedRotationFlag}else{this.m_flags&=~j.e_fixedRotationFlag}this.ResetMassData()};j.prototype.IsFixedRotation=function(){return(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag};j.prototype.SetActive=function(t){if(t==this.IsActive()){return}var e;var i;if(t){this.m_flags|=j.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.CreateProxy(e,this.m_xf)}}else{this.m_flags&=~j.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.DestroyProxy(e)}var n=this.m_contactList;while(n){var r=n;n=n.next;this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}};j.prototype.IsActive=function(){return(this.m_flags&j.e_activeFlag)==j.e_activeFlag};j.prototype.IsSleepingAllowed=function(){return(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag};j.prototype.GetFixtureList=function(){return this.m_fixtureList};j.prototype.GetJointList=function(){return this.m_jointList};j.prototype.GetControllerList=function(){return this.m_controllerList};j.prototype.GetContactList=function(){return this.m_contactList};j.prototype.GetNext=function(){return this.m_next};j.prototype.GetUserData=function(){return this.m_userData};j.prototype.SetUserData=function(t){this.m_userData=t};j.prototype.GetWorld=function(){return this.m_world};j.prototype.b2Body=function(t,e){this.m_flags=0;if(t.bullet){this.m_flags|=j.e_bulletFlag}if(t.fixedRotation){this.m_flags|=j.e_fixedRotationFlag}if(t.allowSleep){this.m_flags|=j.e_allowSleepFlag}if(t.awake){this.m_flags|=j.e_awakeFlag}if(t.active){this.m_flags|=j.e_activeFlag}this.m_world=e;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R;var n=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y;this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==j.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};j.prototype.SynchronizeFixtures=function(){var t=j.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R;var i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y);t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var n;var r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(r,t,this.m_xf)}};j.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)};j.prototype.ShouldCollide=function(t){if(this.m_type!=j.b2_dynamicBody&&t.m_type!=j.b2_dynamicBody){return false}for(var e=this.m_jointList;e;e=e.next){if(e.other==t)if(e.joint.m_collideConnected==false){return false}}return true};j.prototype.Advance=function(t){if(t===undefined)t=0;this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new s;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});q.b2BodyDef=function(){this.position=new a;this.linearVelocity=new a};q.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=j.b2_staticBody;this.active=true;this.inertiaScale=1};J.b2ContactFilter=function(){};J.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData();var n=e.GetFilterData();if(i.groupIndex==n.groupIndex&&i.groupIndex!=0){return i.groupIndex>0}var r=(i.maskBits&n.categoryBits)!=0&&(i.categoryBits&n.maskBits)!=0;return r};J.prototype.RayCollide=function(t,e){if(!t)return true;return this.ShouldCollide(t instanceof it?t:null,e)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new J});Z.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(h.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(h.b2_maxManifoldPoints)};K.b2ContactListener=function(){};K.prototype.BeginContact=function(t){};K.prototype.EndContact=function(t){};K.prototype.PreSolve=function(t,e){};K.prototype.PostSolve=function(t,e){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new K});Q.b2ContactManager=function(){};Q.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=J.b2_defaultFilter;this.m_contactListener=K.b2_defaultListener;this.m_contactFactory=new dt(this.m_allocator);this.m_broadPhase=new S};Q.prototype.AddPair=function(t,e){var i=t instanceof it?t:null;var n=e instanceof it?e:null;var r=i.GetBody();var s=n.GetBody();if(r==s)return;var a=s.GetContactList();while(a){if(a.other==r){var o=a.contact.GetFixtureA();var c=a.contact.GetFixtureB();if(o==i&&c==n)return;if(o==n&&c==i)return}a=a.next}if(s.ShouldCollide(r)==false){return}if(this.m_contactFilter.ShouldCollide(i,n)==false){return}var l=this.m_contactFactory.Create(i,n);i=l.GetFixtureA();n=l.GetFixtureB();r=i.m_body;s=n.m_body;l.m_prev=null;l.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=l}this.m_world.m_contactList=l;l.m_nodeA.contact=l;l.m_nodeA.other=s;l.m_nodeA.prev=null;l.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null){r.m_contactList.prev=l.m_nodeA}r.m_contactList=l.m_nodeA;l.m_nodeB.contact=l;l.m_nodeB.other=r;l.m_nodeB.prev=null;
l.m_nodeB.next=s.m_contactList;if(s.m_contactList!=null){s.m_contactList.prev=l.m_nodeB}s.m_contactList=l.m_nodeB;++this.m_world.m_contactCount;return};Q.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Q.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(t.IsTouching()){this.m_contactListener.EndContact(t)}if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_world.m_contactList){this.m_world.m_contactList=t.m_next}if(t.m_nodeA.prev){t.m_nodeA.prev.next=t.m_nodeA.next}if(t.m_nodeA.next){t.m_nodeA.next.prev=t.m_nodeA.prev}if(t.m_nodeA==n.m_contactList){n.m_contactList=t.m_nodeA.next}if(t.m_nodeB.prev){t.m_nodeB.prev.next=t.m_nodeB.next}if(t.m_nodeB.next){t.m_nodeB.next.prev=t.m_nodeB.prev}if(t.m_nodeB==r.m_contactList){r.m_contactList=t.m_nodeB.next}this.m_contactFactory.Destroy(t);--this.m_contactCount};Q.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(n.IsAwake()==false&&r.IsAwake()==false){t=t.GetNext();continue}if(t.m_flags&ct.e_filterFlag){if(r.ShouldCollide(n)==false){var s=t;t=s.GetNext();this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(e,i)==false){s=t;t=s.GetNext();this.Destroy(s);continue}t.m_flags&=~ct.e_filterFlag}var a=e.m_proxy;var o=i.m_proxy;var c=this.m_broadPhase.TestOverlap(a,o);if(c==false){s=t;t=s.GetNext();this.Destroy(s);continue}t.Update(this.m_contactListener);t=t.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new m});$.b2DebugDraw=function(){};$.prototype.b2DebugDraw=function(){};$.prototype.SetFlags=function(t){if(t===undefined)t=0};$.prototype.GetFlags=function(){};$.prototype.AppendFlags=function(t){if(t===undefined)t=0};$.prototype.ClearFlags=function(t){if(t===undefined)t=0};$.prototype.SetSprite=function(t){};$.prototype.GetSprite=function(){};$.prototype.SetDrawScale=function(t){if(t===undefined)t=0};$.prototype.GetDrawScale=function(){};$.prototype.SetLineThickness=function(t){if(t===undefined)t=0};$.prototype.GetLineThickness=function(){};$.prototype.SetAlpha=function(t){if(t===undefined)t=0};$.prototype.GetAlpha=function(){};$.prototype.SetFillAlpha=function(t){if(t===undefined)t=0};$.prototype.GetFillAlpha=function(){};$.prototype.SetXFormScale=function(t){if(t===undefined)t=0};$.prototype.GetXFormScale=function(){};$.prototype.DrawPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawCircle=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidCircle=function(t,e,i,n){if(e===undefined)e=0};$.prototype.DrawSegment=function(t,e,i){};$.prototype.DrawTransform=function(t){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});tt.b2DestructionListener=function(){};tt.prototype.SayGoodbyeJoint=function(t){};tt.prototype.SayGoodbyeFixture=function(t){};et.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};et.prototype.Copy=function(){var t=new et;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};it.b2Fixture=function(){this.m_filter=new et};it.prototype.GetType=function(){return this.m_shape.GetType()};it.prototype.GetShape=function(){return this.m_shape};it.prototype.SetSensor=function(t){if(this.m_isSensor==t)return;this.m_isSensor=t;if(this.m_body==null)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.SetSensor(n.IsSensor()||r.IsSensor());e=e.next}};it.prototype.IsSensor=function(){return this.m_isSensor};it.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(this.m_body)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.FlagForFiltering();e=e.next}};it.prototype.GetFilterData=function(){return this.m_filter.Copy()};it.prototype.GetBody=function(){return this.m_body};it.prototype.GetNext=function(){return this.m_next};it.prototype.GetUserData=function(){return this.m_userData};it.prototype.SetUserData=function(t){this.m_userData=t};it.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};it.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())};it.prototype.GetMassData=function(t){if(t===undefined)t=null;if(t==null){t=new Y}this.m_shape.ComputeMass(t,this.m_density);return t};it.prototype.SetDensity=function(t){if(t===undefined)t=0;this.m_density=t};it.prototype.GetDensity=function(){return this.m_density};it.prototype.GetFriction=function(){return this.m_friction};it.prototype.SetFriction=function(t){if(t===undefined)t=0;this.m_friction=t};it.prototype.GetRestitution=function(){return this.m_restitution};it.prototype.SetRestitution=function(t){if(t===undefined)t=0;this.m_restitution=t};it.prototype.GetAABB=function(){return this.m_aabb};it.prototype.b2Fixture=function(){this.m_aabb=new u;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};it.prototype.Create=function(t,e,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=t;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};it.prototype.Destroy=function(){this.m_shape=null};it.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e);this.m_proxy=t.CreateProxy(this.m_aabb,this)};it.prototype.DestroyProxy=function(t){if(this.m_proxy==null){return}t.DestroyProxy(this.m_proxy);this.m_proxy=null};it.prototype.Synchronize=function(t,e,i){if(!this.m_proxy)return;var r=new u;var s=new u;this.m_shape.ComputeAABB(r,e);this.m_shape.ComputeAABB(s,i);this.m_aabb.Combine(r,s);var a=n.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,a)};nt.b2FixtureDef=function(){this.filter=new et};nt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};rt.b2Island=function(){};rt.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};rt.prototype.Initialize=function(t,e,i,n,r,s){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;var a=0;this.m_bodyCapacity=t;this.m_contactCapacity=e;this.m_jointCapacity=i;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=n;this.m_listener=r;this.m_contactSolver=s;for(a=this.m_bodies.length;a<t;a++)this.m_bodies[a]=null;for(a=this.m_contacts.length;a<e;a++)this.m_contacts[a]=null;for(a=this.m_joints.length;a<i;a++)this.m_joints[a]=null};rt.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};rt.prototype.Solve=function(t,e,i){var r=0;var s=0;var a;var o;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()!=j.b2_dynamicBody)continue;a.m_linearVelocity.x+=t.dt*(e.x+a.m_invMass*a.m_force.x);a.m_linearVelocity.y+=t.dt*(e.y+a.m_invMass*a.m_force.y);a.m_angularVelocity+=t.dt*a.m_invI*a.m_torque;a.m_linearVelocity.Multiply(n.Clamp(1-t.dt*a.m_linearDamping,0,1));a.m_angularVelocity*=n.Clamp(1-t.dt*a.m_angularDamping,0,1)}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var c=this.m_contactSolver;c.InitVelocityConstraints(t);for(r=0;r<this.m_jointCount;++r){o=this.m_joints[r];o.InitVelocityConstraints(t)}for(r=0;r<t.velocityIterations;++r){for(s=0;s<this.m_jointCount;++s){o=this.m_joints[s];o.SolveVelocityConstraints(t)}c.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r){o=this.m_joints[r];o.FinalizeVelocityConstraints()}c.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==j.b2_staticBody)continue;var l=t.dt*a.m_linearVelocity.x;var u=t.dt*a.m_linearVelocity.y;if(l*l+u*u>h.b2_maxTranslationSquared){a.m_linearVelocity.Normalize();a.m_linearVelocity.x*=h.b2_maxTranslation*t.inv_dt;a.m_linearVelocity.y*=h.b2_maxTranslation*t.inv_dt}var d=t.dt*a.m_angularVelocity;if(d*d>h.b2_maxRotationSquared){if(a.m_angularVelocity<0){a.m_angularVelocity=-h.b2_maxRotation*t.inv_dt}else{a.m_angularVelocity=h.b2_maxRotation*t.inv_dt}}a.m_sweep.c0.SetV(a.m_sweep.c);a.m_sweep.a0=a.m_sweep.a;a.m_sweep.c.x+=t.dt*a.m_linearVelocity.x;a.m_sweep.c.y+=t.dt*a.m_linearVelocity.y;a.m_sweep.a+=t.dt*a.m_angularVelocity;a.SynchronizeTransform()}for(r=0;r<t.positionIterations;++r){var _=c.SolvePositionConstraints(h.b2_contactBaumgarte);var f=true;for(s=0;s<this.m_jointCount;++s){o=this.m_joints[s];var p=o.SolvePositionConstraints(h.b2_contactBaumgarte);f=f&&p}if(_&&f){break}}this.Report(c.m_constraints);if(i){var m=Number.MAX_VALUE;var g=h.b2_linearSleepTolerance*h.b2_linearSleepTolerance;var v=h.b2_angularSleepTolerance*h.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==j.b2_staticBody){continue}if((a.m_flags&j.e_allowSleepFlag)==0){a.m_sleepTime=0;m=0}if((a.m_flags&j.e_allowSleepFlag)==0||a.m_angularVelocity*a.m_angularVelocity>v||n.Dot(a.m_linearVelocity,a.m_linearVelocity)>g){a.m_sleepTime=0;m=0}else{a.m_sleepTime+=t.dt;m=n.Min(m,a.m_sleepTime)}}if(m>=h.b2_timeToSleep){for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];a.SetAwake(false)}}}};rt.prototype.SolveTOI=function(t){var e=0;var i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var n=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e){this.m_joints[e].InitVelocityConstraints(t)}for(e=0;e<t.velocityIterations;++e){n.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i){this.m_joints[i].SolveVelocityConstraints(t)}}for(e=0;e<this.m_bodyCount;++e){var r=this.m_bodies[e];if(r.GetType()==j.b2_staticBody)continue;var s=t.dt*r.m_linearVelocity.x;var a=t.dt*r.m_linearVelocity.y;if(s*s+a*a>h.b2_maxTranslationSquared){r.m_linearVelocity.Normalize();r.m_linearVelocity.x*=h.b2_maxTranslation*t.inv_dt;r.m_linearVelocity.y*=h.b2_maxTranslation*t.inv_dt}var o=t.dt*r.m_angularVelocity;if(o*o>h.b2_maxRotationSquared){if(r.m_angularVelocity<0){r.m_angularVelocity=-h.b2_maxRotation*t.inv_dt}else{r.m_angularVelocity=h.b2_maxRotation*t.inv_dt}}r.m_sweep.c0.SetV(r.m_sweep.c);r.m_sweep.a0=r.m_sweep.a;r.m_sweep.c.x+=t.dt*r.m_linearVelocity.x;r.m_sweep.c.y+=t.dt*r.m_linearVelocity.y;r.m_sweep.a+=t.dt*r.m_angularVelocity;r.SynchronizeTransform()}var c=.75;for(e=0;e<t.positionIterations;++e){var l=n.SolvePositionConstraints(c);var u=true;for(i=0;i<this.m_jointCount;++i){var d=this.m_joints[i].SolvePositionConstraints(h.b2_contactBaumgarte);u=u&&d}if(l&&u){break}}this.Report(n.m_constraints)};rt.prototype.Report=function(t){if(this.m_listener==null){return}for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];var n=t[e];for(var r=0;r<n.pointCount;++r){rt.s_impulse.normalImpulses[r]=n.points[r].normalImpulse;rt.s_impulse.tangentImpulses[r]=n.points[r].tangentImpulse}this.m_listener.PostSolve(i,rt.s_impulse)}};rt.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};rt.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};rt.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new Z});st.b2TimeStep=function(){};st.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};at.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Q;this.m_contactSolver=new pt;this.m_island=new rt};at.prototype.b2World=function(t,e){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;at.m_warmStarting=true;at.m_continuousPhysics=true;this.m_allowSleep=e;t.y=t.y;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var i=new q;this.m_groundBody=this.CreateBody(i)};at.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};at.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};at.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};at.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};at.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next){for(var n=i.m_fixtureList;n;n=n.m_next){n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}}};at.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};at.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};at.prototype.CreateBody=function(t){if(this.IsLocked()==true){return null}var e=new j(t,this);e.m_prev=null;e.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=e}this.m_bodyList=e;++this.m_bodyCount;return e};at.prototype.DestroyBody=function(t){if(this.IsLocked()==true){return}var e=t.m_jointList;while(e){var i=e;e=e.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(i.joint)}this.DestroyJoint(i.joint)}var n=t.m_controllerList;while(n){var r=n;n=n.nextController;r.controller.RemoveBody(t)}var s=t.m_contactList;while(s){var a=s;s=s.next;this.m_contactManager.Destroy(a.contact)}t.m_contactList=null;var o=t.m_fixtureList;while(o){var c=o;o=o.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(c)}c.DestroyProxy(this.m_contactManager.m_broadPhase);c.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_bodyList){this.m_bodyList=t.m_next}--this.m_bodyCount};at.prototype.CreateJoint=function(t){var e=It.Create(t,null);e.m_prev=null;e.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;++this.m_jointCount;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;e.m_edgeA.next=e.m_bodyA.m_jointList;if(e.m_bodyA.m_jointList)e.m_bodyA.m_jointList.prev=e.m_edgeA;e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;e.m_edgeB.next=e.m_bodyB.m_jointList;if(e.m_bodyB.m_jointList)e.m_bodyB.m_jointList.prev=e.m_edgeB;e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var n=t.bodyB;if(t.collideConnected==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}return e};at.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_jointList){this.m_jointList=t.m_next}var i=t.m_bodyA;var n=t.m_bodyB;i.SetAwake(true);n.SetAwake(true);if(t.m_edgeA.prev){t.m_edgeA.prev.next=t.m_edgeA.next}if(t.m_edgeA.next){t.m_edgeA.next.prev=t.m_edgeA.prev}if(t.m_edgeA==i.m_jointList){i.m_jointList=t.m_edgeA.next}t.m_edgeA.prev=null;t.m_edgeA.next=null;if(t.m_edgeB.prev){t.m_edgeB.prev.next=t.m_edgeB.next}if(t.m_edgeB.next){t.m_edgeB.next.prev=t.m_edgeB.prev}if(t.m_edgeB==n.m_jointList){n.m_jointList=t.m_edgeB.next}t.m_edgeB.prev=null;t.m_edgeB.next=null;It.Destroy(t,null);--this.m_jointCount;if(e==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}};at.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};at.prototype.RemoveController=function(t){if(t.m_prev)t.m_prev.m_next=t.m_next;if(t.m_next)t.m_next.m_prev=t.m_prev;if(this.m_controllerList==t)this.m_controllerList=t.m_next;this.m_controllerCount--};at.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=t;this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};at.prototype.DestroyController=function(t){t.Clear();if(t.m_next)t.m_next.m_prev=t.m_prev;if(t.m_prev)t.m_prev.m_next=t.m_next;if(t==this.m_controllerList)this.m_controllerList=t.m_next;--this.m_controllerCount};at.prototype.SetWarmStarting=function(t){at.m_warmStarting=t};at.prototype.SetContinuousPhysics=function(t){at.m_continuousPhysics=t};at.prototype.GetBodyCount=function(){return this.m_bodyCount};at.prototype.GetJointCount=function(){return this.m_jointCount};at.prototype.GetContactCount=function(){return this.m_contactCount};at.prototype.SetGravity=function(t){this.m_gravity=t};at.prototype.GetGravity=function(){return this.m_gravity};at.prototype.GetGroundBody=function(){return this.m_groundBody};at.prototype.Step=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;if(this.m_flags&at.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~at.e_newFixture}this.m_flags|=at.e_locked;var n=at.s_timestep2;n.dt=t;n.velocityIterations=e;n.positionIterations=i;if(t>0){n.inv_dt=1/t}else{n.inv_dt=0}n.dtRatio=this.m_inv_dt0*t;n.warmStarting=at.m_warmStarting;this.m_contactManager.Collide();if(n.dt>0){this.Solve(n)}if(at.m_continuousPhysics&&n.dt>0){this.SolveTOI(n)}if(n.dt>0){this.m_inv_dt0=n.inv_dt}this.m_flags&=~at.e_locked};at.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};at.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags();var e=0;var i;var n;var r;var s;var o;var l=new a;var h=new a;var d=new a;var _;var f=new u;var p=new u;var m=[new a,new a,new a,new a];var g=new c(0,0,0);if(t&$.e_shapeBit){for(i=this.m_bodyList;i;i=i.m_next){_=i.m_xf;for(n=i.GetFixtureList();n;n=n.m_next){r=n.GetShape();if(i.IsActive()==false){g.Set(.5,.5,.3);this.DrawShape(r,_,g)}else if(i.GetType()==j.b2_staticBody){g.Set(.5,.9,.5);this.DrawShape(r,_,g)}else if(i.GetType()==j.b2_kinematicBody){g.Set(.5,.5,.9);this.DrawShape(r,_,g)}else if(i.IsAwake()==false){g.Set(.6,.6,.6);this.DrawShape(r,_,g)}else{g.Set(.9,.7,.7);this.DrawShape(r,_,g)}}}}if(t&$.e_jointBit){for(s=this.m_jointList;s;s=s.m_next){this.DrawJoint(s)}}if(t&$.e_controllerBit){for(var v=this.m_controllerList;v;v=v.m_next){v.Draw(this.m_debugDraw)}}if(t&$.e_pairBit){g.Set(.3,.9,.9);for(var y=this.m_contactManager.m_contactList;y;y=y.GetNext()){var T=y.GetFixtureA();var C=y.GetFixtureB();var S=T.GetAABB().GetCenter();var x=C.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(S,x,g)}}if(t&$.e_aabbBit){o=this.m_contactManager.m_broadPhase;m=[new a,new a,new a,new a];for(i=this.m_bodyList;i;i=i.GetNext()){if(i.IsActive()==false){continue}for(n=i.GetFixtureList();n;n=n.GetNext()){var E=o.GetFatAABB(n.m_proxy);m[0].Set(E.lowerBound.x,E.lowerBound.y);m[1].Set(E.upperBound.x,E.lowerBound.y);m[2].Set(E.upperBound.x,E.upperBound.y);m[3].Set(E.lowerBound.x,E.upperBound.y);this.m_debugDraw.DrawPolygon(m,4,g)}}}if(t&$.e_centerOfMassBit){for(i=this.m_bodyList;i;i=i.m_next){_=at.s_xf;_.R=i.m_xf.R;_.position=i.GetWorldCenter();this.m_debugDraw.DrawTransform(_)}}};at.prototype.QueryAABB=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(e){return t(n.GetUserData(e))}n.Query(r,e)};at.prototype.QueryShape=function(t,e,i){var n=this;if(i===undefined)i=null;if(i==null){i=new s;i.SetIdentity()}var r=n.m_contactManager.m_broadPhase;function a(n){var s=r.GetUserData(n)instanceof it?r.GetUserData(n):null;if(H.TestOverlap(e,i,s.GetShape(),s.GetBody().GetTransform()))return t(s);return true}var o=new u;e.ComputeAABB(o,i);r.Query(a,o)};at.prototype.QueryPoint=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(i){var r=n.GetUserData(i)instanceof it?n.GetUserData(i):null;if(r.TestPoint(e))return t(r);return true}var s=new u;s.lowerBound.Set(e.x-h.b2_linearSlop,e.y-h.b2_linearSlop);s.upperBound.Set(e.x+h.b2_linearSlop,e.y+h.b2_linearSlop);n.Query(r,s)};at.prototype.RayCast=function(t,e,i){var n=this;var r=n.m_contactManager.m_broadPhase;var s=new w;function o(n,o){var c=r.GetUserData(o);var l=c instanceof it?c:null;var h=l.RayCast(s,n);if(h){var u=s.fraction;var d=new a((1-u)*e.x+u*i.x,(1-u)*e.y+u*i.y);return t(l,d,s.normal,u)}return n.maxFraction}var c=new P(e,i);r.RayCast(o,c)};at.prototype.RayCastOne=function(t,e){var i=this;var n;function r(t,e,i,r){if(r===undefined)r=0;n=t;return r}i.RayCast(r,t,e);return n};at.prototype.RayCastAll=function(t,e){var i=this;var n=new Vector;function r(t,e,i,r){if(r===undefined)r=0;n[n.length]=t;return 1}i.RayCast(r,t,e);return n};at.prototype.GetBodyList=function(){return this.m_bodyList};at.prototype.GetJointList=function(){return this.m_jointList};at.prototype.GetContactList=function(){return this.m_contactList};at.prototype.IsLocked=function(){return(this.m_flags&at.e_locked)>0};at.prototype.Solve=function(t){var e;for(var i=this.m_controllerList;i;i=i.m_next){i.Step(t)}var n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~j.e_islandFlag}for(var r=this.m_contactList;r;r=r.m_next){r.m_flags&=~ct.e_islandFlag}for(var s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}var a=parseInt(this.m_bodyCount);var o=this.s_stack;for(var c=this.m_bodyList;c;c=c.m_next){if(c.m_flags&j.e_islandFlag){continue}if(c.IsAwake()==false||c.IsActive()==false){continue}if(c.GetType()==j.b2_staticBody){continue}n.Clear();var l=0;o[l++]=c;c.m_flags|=j.e_islandFlag;while(l>0){e=o[--l];n.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()==j.b2_staticBody){continue}var h;for(var u=e.m_contactList;u;u=u.next){if(u.contact.m_flags&ct.e_islandFlag){continue}if(u.contact.IsSensor()==true||u.contact.IsEnabled()==false||u.contact.IsTouching()==false){continue}n.AddContact(u.contact);u.contact.m_flags|=ct.e_islandFlag;h=u.other;if(h.m_flags&j.e_islandFlag){continue}o[l++]=h;h.m_flags|=j.e_islandFlag}for(var d=e.m_jointList;d;d=d.next){if(d.joint.m_islandFlag==true){continue}h=d.other;if(h.IsActive()==false){continue}n.AddJoint(d.joint);d.joint.m_islandFlag=true;if(h.m_flags&j.e_islandFlag){continue}o[l++]=h;h.m_flags|=j.e_islandFlag}}n.Solve(t,this.m_gravity,this.m_allowSleep);for(var _=0;_<n.m_bodyCount;++_){e=n.m_bodies[_];if(e.GetType()==j.b2_staticBody){e.m_flags&=~j.e_islandFlag}}}for(_=0;_<o.length;++_){if(!o[_])break;o[_]=null}for(e=this.m_bodyList;e;e=e.m_next){if(e.IsAwake()==false||e.IsActive()==false){continue}if(e.GetType()==j.b2_staticBody){continue}e.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};at.prototype.SolveTOI=function(t){var e;var i;var n;var r;var s;var a;var o;var c=this.m_island;c.Initialize(this.m_bodyCount,h.b2_maxTOIContactsPerIsland,h.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var l=at.s_queue;for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~j.e_islandFlag;e.m_sweep.t0=0}var u;for(u=this.m_contactList;u;u=u.m_next){u.m_flags&=~(ct.e_toiFlag|ct.e_islandFlag)}for(o=this.m_jointList;o;o=o.m_next){o.m_islandFlag=false}for(;;){var d=null;var _=1;for(u=this.m_contactList;u;u=u.m_next){if(u.IsSensor()==true||u.IsEnabled()==false||u.IsContinuous()==false){continue}var f=1;if(u.m_flags&ct.e_toiFlag){f=u.m_toi}else{i=u.m_fixtureA;n=u.m_fixtureB;r=i.m_body;s=n.m_body;if((r.GetType()!=j.b2_dynamicBody||r.IsAwake()==false)&&(s.GetType()!=j.b2_dynamicBody||s.IsAwake()==false)){continue}var p=r.m_sweep.t0;if(r.m_sweep.t0<s.m_sweep.t0){p=s.m_sweep.t0;r.m_sweep.Advance(p)}else if(s.m_sweep.t0<r.m_sweep.t0){p=r.m_sweep.t0;s.m_sweep.Advance(p)}f=u.ComputeTOI(r.m_sweep,s.m_sweep);h.b2Assert(0<=f&&f<=1);if(f>0&&f<1){f=(1-f)*p+f;if(f>1)f=1}u.m_toi=f;u.m_flags|=ct.e_toiFlag}if(Number.MIN_VALUE<f&&f<_){d=u;_=f}}if(d==null||1-100*Number.MIN_VALUE<_){break}i=d.m_fixtureA;n=d.m_fixtureB;r=i.m_body;s=n.m_body;at.s_backupA.Set(r.m_sweep);at.s_backupB.Set(s.m_sweep);r.Advance(_);s.Advance(_);d.Update(this.m_contactManager.m_contactListener);d.m_flags&=~ct.e_toiFlag;if(d.IsSensor()==true||d.IsEnabled()==false){r.m_sweep.Set(at.s_backupA);s.m_sweep.Set(at.s_backupB);r.SynchronizeTransform();s.SynchronizeTransform();continue}if(d.IsTouching()==false){continue}var m=r;if(m.GetType()!=j.b2_dynamicBody){m=s}c.Clear();var g=0;var v=0;l[g+v++]=m;m.m_flags|=j.e_islandFlag;while(v>0){e=l[g++];--v;c.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()!=j.b2_dynamicBody){continue}for(a=e.m_contactList;a;a=a.next){if(c.m_contactCount==c.m_contactCapacity){break}if(a.contact.m_flags&ct.e_islandFlag){continue}if(a.contact.IsSensor()==true||a.contact.IsEnabled()==false||a.contact.IsTouching()==false){continue}c.AddContact(a.contact);a.contact.m_flags|=ct.e_islandFlag;var y=a.other;if(y.m_flags&j.e_islandFlag){continue}if(y.GetType()!=j.b2_staticBody){y.Advance(_);y.SetAwake(true)}l[g+v]=y;++v;y.m_flags|=j.e_islandFlag}for(var T=e.m_jointList;T;T=T.next){if(c.m_jointCount==c.m_jointCapacity)continue;if(T.joint.m_islandFlag==true)continue;y=T.other;if(y.IsActive()==false){continue}c.AddJoint(T.joint);T.joint.m_islandFlag=true;if(y.m_flags&j.e_islandFlag)continue;if(y.GetType()!=j.b2_staticBody){y.Advance(_);y.SetAwake(true)}l[g+v]=y;++v;y.m_flags|=j.e_islandFlag}}var C=at.s_timestep;C.warmStarting=false;C.dt=(1-_)*t.dt;C.inv_dt=1/C.dt;C.dtRatio=0;C.velocityIterations=t.velocityIterations;C.positionIterations=t.positionIterations;c.SolveTOI(C);var S=0;for(S=0;S<c.m_bodyCount;++S){e=c.m_bodies[S];e.m_flags&=~j.e_islandFlag;if(e.IsAwake()==false){continue}if(e.GetType()!=j.b2_dynamicBody){continue}e.SynchronizeFixtures();for(a=e.m_contactList;a;a=a.next){a.contact.m_flags&=~ct.e_toiFlag}}for(S=0;S<c.m_contactCount;++S){u=c.m_contacts[S];u.m_flags&=~(ct.e_toiFlag|ct.e_islandFlag)}for(S=0;S<c.m_jointCount;++S){o=c.m_joints[S];o.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};at.prototype.DrawJoint=function(t){var e=t.GetBodyA();var i=t.GetBodyB();var n=e.m_xf;var r=i.m_xf;var s=n.position;var a=r.position;var o=t.GetAnchorA();var c=t.GetAnchorB();var l=at.s_jointColor;switch(t.m_type){case It.e_distanceJoint:this.m_debugDraw.DrawSegment(o,c,l);break;case It.e_pulleyJoint:{var h=t instanceof kt?t:null;var u=h.GetGroundAnchorA();var d=h.GetGroundAnchorB();this.m_debugDraw.DrawSegment(u,o,l);this.m_debugDraw.DrawSegment(d,c,l);this.m_debugDraw.DrawSegment(u,d,l)}break;case It.e_mouseJoint:this.m_debugDraw.DrawSegment(o,c,l);break;default:if(e!=this.m_groundBody)this.m_debugDraw.DrawSegment(s,o,l);this.m_debugDraw.DrawSegment(o,c,l);if(i!=this.m_groundBody)this.m_debugDraw.DrawSegment(a,c,l)}};at.prototype.DrawShape=function(t,e,i){switch(t.m_type){case H.e_circleShape:{var r=t instanceof G?t:null;var s=n.MulX(e,r.m_p);var a=r.m_radius;var o=e.R.col1;this.m_debugDraw.DrawSolidCircle(s,a,o,i)}break;case H.e_polygonShape:{var c=0;var l=t instanceof X?t:null;var h=parseInt(l.GetVertexCount());var u=l.GetVertices();var d=new Vector(h);for(c=0;c<h;++c){d[c]=n.MulX(e,u[c])}this.m_debugDraw.DrawSolidPolygon(d,h,i)}break;case H.e_edgeShape:{var _=t instanceof U?t:null;this.m_debugDraw.DrawSegment(n.MulX(e,_.GetVertex1()),n.MulX(e,_.GetVertex2()),i)}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new st;Box2D.Dynamics.b2World.s_xf=new s;Box2D.Dynamics.b2World.s_backupA=new r;Box2D.Dynamics.b2World.s_backupB=new r;Box2D.Dynamics.b2World.s_timestep=new st;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new c(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,a=Box2D.Dynamics.Contacts.b2CircleContact,o=Box2D.Dynamics.Contacts.b2Contact,c=Box2D.Dynamics.Contacts.b2ContactConstraint,l=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,h=Box2D.Dynamics.Contacts.b2ContactEdge,u=Box2D.Dynamics.Contacts.b2ContactFactory,d=Box2D.Dynamics.Contacts.b2ContactRegister,_=Box2D.Dynamics.Contacts.b2ContactResult,f=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,m=Box2D.Dynamics.Contacts.b2NullContact,g=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,v=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,y=Box2D.Dynamics.Contacts.b2PolygonContact,T=Box2D.Dynamics.Contacts.b2PositionSolverManifold,C=Box2D.Dynamics.b2Body,S=Box2D.Dynamics.b2BodyDef,x=Box2D.Dynamics.b2ContactFilter,E=Box2D.Dynamics.b2ContactImpulse,b=Box2D.Dynamics.b2ContactListener,A=Box2D.Dynamics.b2ContactManager,R=Box2D.Dynamics.b2DebugDraw,P=Box2D.Dynamics.b2DestructionListener,w=Box2D.Dynamics.b2FilterData,I=Box2D.Dynamics.b2Fixture,D=Box2D.Dynamics.b2FixtureDef,L=Box2D.Dynamics.b2Island,O=Box2D.Dynamics.b2TimeStep,B=Box2D.Dynamics.b2World,F=Box2D.Common.b2Color,N=Box2D.Common.b2internal,M=Box2D.Common.b2Settings,V=Box2D.Common.Math.b2Mat22,k=Box2D.Common.Math.b2Mat33,W=Box2D.Common.Math.b2Math,G=Box2D.Common.Math.b2Sweep,z=Box2D.Common.Math.b2Transform,U=Box2D.Common.Math.b2Vec2,Y=Box2D.Common.Math.b2Vec3,X=Box2D.Collision.b2AABB,H=Box2D.Collision.b2Bound,j=Box2D.Collision.b2BoundValues,q=Box2D.Collision.b2Collision,J=Box2D.Collision.b2ContactID,Z=Box2D.Collision.b2ContactPoint,K=Box2D.Collision.b2Distance,Q=Box2D.Collision.b2DistanceInput,$=Box2D.Collision.b2DistanceOutput,tt=Box2D.Collision.b2DistanceProxy,et=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2DynamicTreeBroadPhase,nt=Box2D.Collision.b2DynamicTreeNode,rt=Box2D.Collision.b2DynamicTreePair,st=Box2D.Collision.b2Manifold,at=Box2D.Collision.b2ManifoldPoint,ot=Box2D.Collision.b2Point,ct=Box2D.Collision.b2RayCastInput,lt=Box2D.Collision.b2RayCastOutput,ht=Box2D.Collision.b2Segment,ut=Box2D.Collision.b2SeparationFunction,dt=Box2D.Collision.b2Simplex,_t=Box2D.Collision.b2SimplexCache,ft=Box2D.Collision.b2SimplexVertex,pt=Box2D.Collision.b2TimeOfImpact,mt=Box2D.Collision.b2TOIInput,gt=Box2D.Collision.b2WorldManifold,vt=Box2D.Collision.ClipVertex,yt=Box2D.Collision.Features,Tt=Box2D.Collision.IBroadPhase;Box2D.inherit(a,Box2D.Dynamics.Contacts.b2Contact);a.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;a.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};a.Create=function(t){return new a};a.Destroy=function(t,e){};a.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};a.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();q.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};o.b2Contact=function(){this.m_nodeA=new h;this.m_nodeB=new h;this.m_manifold=new st;this.m_oldManifold=new st};o.prototype.GetManifold=function(){return this.m_manifold};o.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var n=this.m_fixtureA.GetShape();var r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)};o.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag};o.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)==o.e_continuousFlag;
};o.prototype.SetSensor=function(t){if(t){this.m_flags|=o.e_sensorFlag}else{this.m_flags&=~o.e_sensorFlag}};o.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)==o.e_sensorFlag};o.prototype.SetEnabled=function(t){if(t){this.m_flags|=o.e_enabledFlag}else{this.m_flags&=~o.e_enabledFlag}};o.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)==o.e_enabledFlag};o.prototype.GetNext=function(){return this.m_next};o.prototype.GetFixtureA=function(){return this.m_fixtureA};o.prototype.GetFixtureB=function(){return this.m_fixtureB};o.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag};o.prototype.b2Contact=function(){};o.prototype.Reset=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;this.m_flags=o.e_enabledFlag;if(!t||!e){this.m_fixtureA=null;this.m_fixtureB=null;return}if(t.IsSensor()||e.IsSensor()){this.m_flags|=o.e_sensorFlag}var i=t.GetBody();var n=e.GetBody();if(i.GetType()!=C.b2_dynamicBody||i.IsBullet()||n.GetType()!=C.b2_dynamicBody||n.IsBullet()){this.m_flags|=o.e_continuousFlag}this.m_fixtureA=t;this.m_fixtureB=e;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};o.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=e;this.m_flags|=o.e_enabledFlag;var i=false;var n=(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag;var r=this.m_fixtureA.m_body;var a=this.m_fixtureB.m_body;var c=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(c){var l=this.m_fixtureA.GetShape();var h=this.m_fixtureB.GetShape();var u=r.GetTransform();var d=a.GetTransform();i=s.TestOverlap(l,u,h,d)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=C.b2_dynamicBody||r.IsBullet()||a.GetType()!=C.b2_dynamicBody||a.IsBullet()){this.m_flags|=o.e_continuousFlag}else{this.m_flags&=~o.e_continuousFlag}if(c){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(var _=0;_<this.m_manifold.m_pointCount;++_){var f=this.m_manifold.m_points[_];f.m_normalImpulse=0;f.m_tangentImpulse=0;var p=f.m_id;for(var m=0;m<this.m_oldManifold.m_pointCount;++m){var g=this.m_oldManifold.m_points[m];if(g.m_id.key==p.key){f.m_normalImpulse=g.m_normalImpulse;f.m_tangentImpulse=g.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(i!=n){r.SetAwake(true);a.SetAwake(true)}}if(i){this.m_flags|=o.e_touchingFlag}else{this.m_flags&=~o.e_touchingFlag}if(n==false&&i==true){t.BeginContact(this)}if(n==true&&i==false){t.EndContact(this)}if((this.m_flags&o.e_sensorFlag)==0){t.PreSolve(this,this.m_oldManifold)}};o.prototype.Evaluate=function(){};o.prototype.ComputeTOI=function(t,e){o.s_input.proxyA.Set(this.m_fixtureA.GetShape());o.s_input.proxyB.Set(this.m_fixtureB.GetShape());o.s_input.sweepA=t;o.s_input.sweepB=e;o.s_input.tolerance=M.b2_linearSlop;return pt.TimeOfImpact(o.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new mt});c.b2ContactConstraint=function(){this.localPlaneNormal=new U;this.localPoint=new U;this.normal=new U;this.normalMass=new V;this.K=new V};c.prototype.b2ContactConstraint=function(){this.points=new Vector(M.b2_maxManifoldPoints);for(var t=0;t<M.b2_maxManifoldPoints;t++){this.points[t]=new l}};l.b2ContactConstraintPoint=function(){this.localPoint=new U;this.rA=new U;this.rB=new U};h.b2ContactEdge=function(){};u.b2ContactFactory=function(){};u.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};u.prototype.AddType=function(t,e,i,n){if(i===undefined)i=0;if(n===undefined)n=0;this.m_registers[i][n].createFcn=t;this.m_registers[i][n].destroyFcn=e;this.m_registers[i][n].primary=true;if(i!=n){this.m_registers[n][i].createFcn=t;this.m_registers[n][i].destroyFcn=e;this.m_registers[n][i].primary=false}};u.prototype.InitializeRegisters=function(){this.m_registers=new Vector(s.e_shapeTypeCount);for(var t=0;t<s.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(s.e_shapeTypeCount);for(var e=0;e<s.e_shapeTypeCount;e++){this.m_registers[t][e]=new d}}this.AddType(a.Create,a.Destroy,s.e_circleShape,s.e_circleShape);this.AddType(g.Create,g.Destroy,s.e_polygonShape,s.e_circleShape);this.AddType(y.Create,y.Destroy,s.e_polygonShape,s.e_polygonShape);this.AddType(p.Create,p.Destroy,s.e_edgeShape,s.e_circleShape);this.AddType(v.Create,v.Destroy,s.e_polygonShape,s.e_edgeShape)};u.prototype.Create=function(t,e){var i=parseInt(t.GetType());var n=parseInt(e.GetType());var r=this.m_registers[i][n];var s;if(r.pool){s=r.pool;r.pool=s.m_next;r.poolCount--;s.Reset(t,e);return s}var a=r.createFcn;if(a!=null){if(r.primary){s=a(this.m_allocator);s.Reset(t,e);return s}else{s=a(this.m_allocator);s.Reset(e,t);return s}}else{return null}};u.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(true);t.m_fixtureB.m_body.SetAwake(true)}var e=parseInt(t.m_fixtureA.GetType());var i=parseInt(t.m_fixtureB.GetType());var n=this.m_registers[e][i];if(true){n.poolCount++;t.m_next=n.pool;n.pool=t}var r=n.destroyFcn;r(t,this.m_allocator)};d.b2ContactRegister=function(){};_.b2ContactResult=function(){this.position=new U;this.normal=new U;this.id=new J};f.b2ContactSolver=function(){this.m_step=new O;this.m_constraints=new Vector};f.prototype.b2ContactSolver=function(){};f.prototype.Initialize=function(t,e,i,n){if(i===undefined)i=0;var r;this.m_step.Set(t);this.m_allocator=n;var s=0;var a;var o;this.m_constraintCount=i;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new c}for(s=0;s<i;++s){r=e[s];var l=r.m_fixtureA;var h=r.m_fixtureB;var u=l.m_shape;var d=h.m_shape;var _=u.m_radius;var p=d.m_radius;var m=l.m_body;var g=h.m_body;var v=r.GetManifold();var y=M.b2MixFriction(l.GetFriction(),h.GetFriction());var T=M.b2MixRestitution(l.GetRestitution(),h.GetRestitution());var C=m.m_linearVelocity.x;var S=m.m_linearVelocity.y;var x=g.m_linearVelocity.x;var E=g.m_linearVelocity.y;var b=m.m_angularVelocity;var A=g.m_angularVelocity;M.b2Assert(v.m_pointCount>0);f.s_worldManifold.Initialize(v,m.m_xf,_,g.m_xf,p);var R=f.s_worldManifold.m_normal.x;var P=f.s_worldManifold.m_normal.y;var w=this.m_constraints[s];w.bodyA=m;w.bodyB=g;w.manifold=v;w.normal.x=R;w.normal.y=P;w.pointCount=v.m_pointCount;w.friction=y;w.restitution=T;w.localPlaneNormal.x=v.m_localPlaneNormal.x;w.localPlaneNormal.y=v.m_localPlaneNormal.y;w.localPoint.x=v.m_localPoint.x;w.localPoint.y=v.m_localPoint.y;w.radius=_+p;w.type=v.m_type;for(var I=0;I<w.pointCount;++I){var D=v.m_points[I];var L=w.points[I];L.normalImpulse=D.m_normalImpulse;L.tangentImpulse=D.m_tangentImpulse;L.localPoint.SetV(D.m_localPoint);var O=L.rA.x=f.s_worldManifold.m_points[I].x-m.m_sweep.c.x;var B=L.rA.y=f.s_worldManifold.m_points[I].y-m.m_sweep.c.y;var F=L.rB.x=f.s_worldManifold.m_points[I].x-g.m_sweep.c.x;var N=L.rB.y=f.s_worldManifold.m_points[I].y-g.m_sweep.c.y;var V=O*P-B*R;var k=F*P-N*R;V*=V;k*=k;var W=m.m_invMass+g.m_invMass+m.m_invI*V+g.m_invI*k;L.normalMass=1/W;var G=m.m_mass*m.m_invMass+g.m_mass*g.m_invMass;G+=m.m_mass*m.m_invI*V+g.m_mass*g.m_invI*k;L.equalizedMass=1/G;var z=P;var U=-R;var Y=O*U-B*z;var X=F*U-N*z;Y*=Y;X*=X;var H=m.m_invMass+g.m_invMass+m.m_invI*Y+g.m_invI*X;L.tangentMass=1/H;L.velocityBias=0;var j=x+-A*N-C- -b*B;var q=E+A*F-S-b*O;var J=w.normal.x*j+w.normal.y*q;if(J<-M.b2_velocityThreshold){L.velocityBias+=-w.restitution*J}}if(w.pointCount==2){var Z=w.points[0];var K=w.points[1];var Q=m.m_invMass;var $=m.m_invI;var tt=g.m_invMass;var et=g.m_invI;var it=Z.rA.x*P-Z.rA.y*R;var nt=Z.rB.x*P-Z.rB.y*R;var rt=K.rA.x*P-K.rA.y*R;var st=K.rB.x*P-K.rB.y*R;var at=Q+tt+$*it*it+et*nt*nt;var ot=Q+tt+$*rt*rt+et*st*st;var ct=Q+tt+$*it*rt+et*nt*st;var lt=100;if(at*at<lt*(at*ot-ct*ct)){w.K.col1.Set(at,ct);w.K.col2.Set(ct,ot);w.K.GetInverse(w.normalMass)}else{w.pointCount=1}}}};f.prototype.InitVelocityConstraints=function(t){var e;var i;var n;for(var r=0;r<this.m_constraintCount;++r){var s=this.m_constraints[r];var a=s.bodyA;var o=s.bodyB;var c=a.m_invMass;var l=a.m_invI;var h=o.m_invMass;var u=o.m_invI;var d=s.normal.x;var _=s.normal.y;var f=_;var p=-d;var m=0;var g=0;var v=0;if(t.warmStarting){v=s.pointCount;for(g=0;g<v;++g){var y=s.points[g];y.normalImpulse*=t.dtRatio;y.tangentImpulse*=t.dtRatio;var T=y.normalImpulse*d+y.tangentImpulse*f;var C=y.normalImpulse*_+y.tangentImpulse*p;a.m_angularVelocity-=l*(y.rA.x*C-y.rA.y*T);a.m_linearVelocity.x-=c*T;a.m_linearVelocity.y-=c*C;o.m_angularVelocity+=u*(y.rB.x*C-y.rB.y*T);o.m_linearVelocity.x+=h*T;o.m_linearVelocity.y+=h*C}}else{v=s.pointCount;for(g=0;g<v;++g){var S=s.points[g];S.normalImpulse=0;S.tangentImpulse=0}}}};f.prototype.SolveVelocityConstraints=function(){var t=0;var e;var i=0;var n=0;var r=0;var s=0;var a=0;var o=0;var c=0;var l=0;var h=0;var u=0;var d=0;var _=0;var f=0;var p=0;var m=0;var g=0;var v=0;var y=0;var T=0;var C;var S;for(var x=0;x<this.m_constraintCount;++x){var E=this.m_constraints[x];var b=E.bodyA;var A=E.bodyB;var R=b.m_angularVelocity;var P=A.m_angularVelocity;var w=b.m_linearVelocity;var I=A.m_linearVelocity;var D=b.m_invMass;var L=b.m_invI;var O=A.m_invMass;var B=A.m_invI;var F=E.normal.x;var N=E.normal.y;var M=N;var V=-F;var k=E.friction;var G=0;for(t=0;t<E.pointCount;t++){e=E.points[t];a=I.x-P*e.rB.y-w.x+R*e.rA.y;o=I.y+P*e.rB.x-w.y-R*e.rA.x;l=a*M+o*V;h=e.tangentMass*-l;u=k*e.normalImpulse;d=W.Clamp(e.tangentImpulse+h,-u,u);h=d-e.tangentImpulse;_=h*M;f=h*V;w.x-=D*_;w.y-=D*f;R-=L*(e.rA.x*f-e.rA.y*_);I.x+=O*_;I.y+=O*f;P+=B*(e.rB.x*f-e.rB.y*_);e.tangentImpulse=d}var z=parseInt(E.pointCount);if(E.pointCount==1){e=E.points[0];a=I.x+-P*e.rB.y-w.x- -R*e.rA.y;o=I.y+P*e.rB.x-w.y-R*e.rA.x;c=a*F+o*N;h=-e.normalMass*(c-e.velocityBias);d=e.normalImpulse+h;d=d>0?d:0;h=d-e.normalImpulse;_=h*F;f=h*N;w.x-=D*_;w.y-=D*f;R-=L*(e.rA.x*f-e.rA.y*_);I.x+=O*_;I.y+=O*f;P+=B*(e.rB.x*f-e.rB.y*_);e.normalImpulse=d}else{var U=E.points[0];var Y=E.points[1];var X=U.normalImpulse;var H=Y.normalImpulse;var j=I.x-P*U.rB.y-w.x+R*U.rA.y;var q=I.y+P*U.rB.x-w.y-R*U.rA.x;var J=I.x-P*Y.rB.y-w.x+R*Y.rA.y;var Z=I.y+P*Y.rB.x-w.y-R*Y.rA.x;var K=j*F+q*N;var Q=J*F+Z*N;var $=K-U.velocityBias;var tt=Q-Y.velocityBias;C=E.K;$-=C.col1.x*X+C.col2.x*H;tt-=C.col1.y*X+C.col2.y*H;var et=.001;for(;;){C=E.normalMass;var it=-(C.col1.x*$+C.col2.x*tt);var nt=-(C.col1.y*$+C.col2.y*tt);if(it>=0&&nt>=0){p=it-X;m=nt-H;g=p*F;v=p*N;y=m*F;T=m*N;w.x-=D*(g+y);w.y-=D*(v+T);R-=L*(U.rA.x*v-U.rA.y*g+Y.rA.x*T-Y.rA.y*y);I.x+=O*(g+y);I.y+=O*(v+T);P+=B*(U.rB.x*v-U.rB.y*g+Y.rB.x*T-Y.rB.y*y);U.normalImpulse=it;Y.normalImpulse=nt;break}it=-U.normalMass*$;nt=0;K=0;Q=E.K.col1.y*it+tt;if(it>=0&&Q>=0){p=it-X;m=nt-H;g=p*F;v=p*N;y=m*F;T=m*N;w.x-=D*(g+y);w.y-=D*(v+T);R-=L*(U.rA.x*v-U.rA.y*g+Y.rA.x*T-Y.rA.y*y);I.x+=O*(g+y);I.y+=O*(v+T);P+=B*(U.rB.x*v-U.rB.y*g+Y.rB.x*T-Y.rB.y*y);U.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=-Y.normalMass*tt;K=E.K.col2.x*nt+$;Q=0;if(nt>=0&&K>=0){p=it-X;m=nt-H;g=p*F;v=p*N;y=m*F;T=m*N;w.x-=D*(g+y);w.y-=D*(v+T);R-=L*(U.rA.x*v-U.rA.y*g+Y.rA.x*T-Y.rA.y*y);I.x+=O*(g+y);I.y+=O*(v+T);P+=B*(U.rB.x*v-U.rB.y*g+Y.rB.x*T-Y.rB.y*y);U.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=0;K=$;Q=tt;if(K>=0&&Q>=0){p=it-X;m=nt-H;g=p*F;v=p*N;y=m*F;T=m*N;w.x-=D*(g+y);w.y-=D*(v+T);R-=L*(U.rA.x*v-U.rA.y*g+Y.rA.x*T-Y.rA.y*y);I.x+=O*(g+y);I.y+=O*(v+T);P+=B*(U.rB.x*v-U.rB.y*g+Y.rB.x*T-Y.rB.y*y);U.normalImpulse=it;Y.normalImpulse=nt;break}break}}b.m_angularVelocity=R;A.m_angularVelocity=P}};f.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t];var i=e.manifold;for(var n=0;n<e.pointCount;++n){var r=i.m_points[n];var s=e.points[n];r.m_normalImpulse=s.normalImpulse;r.m_tangentImpulse=s.tangentImpulse}}};f.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;for(var i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i];var r=n.bodyA;var s=n.bodyB;var a=r.m_mass*r.m_invMass;var o=r.m_mass*r.m_invI;var c=s.m_mass*s.m_invMass;var l=s.m_mass*s.m_invI;f.s_psm.Initialize(n);var h=f.s_psm.m_normal;for(var u=0;u<n.pointCount;u++){var d=n.points[u];var _=f.s_psm.m_points[u];var p=f.s_psm.m_separations[u];var m=_.x-r.m_sweep.c.x;var g=_.y-r.m_sweep.c.y;var v=_.x-s.m_sweep.c.x;var y=_.y-s.m_sweep.c.y;e=e<p?e:p;var T=W.Clamp(t*(p+M.b2_linearSlop),-M.b2_maxLinearCorrection,0);var C=-d.equalizedMass*T;var S=C*h.x;var x=C*h.y;r.m_sweep.c.x-=a*S;r.m_sweep.c.y-=a*x;r.m_sweep.a-=o*(m*x-g*S);r.SynchronizeTransform();s.m_sweep.c.x+=c*S;s.m_sweep.c.y+=c*x;s.m_sweep.a+=l*(v*x-y*S);s.SynchronizeTransform()}}return e>-1.5*M.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new gt;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new T});Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact);p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};p.Create=function(t){return new p};p.Destroy=function(t,e){};p.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};p.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)};p.prototype.b2CollideEdgeAndCircle=function(t,e,i,n,r){};Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact);m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;m.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};m.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};m.prototype.Evaluate=function(){};Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact);g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;g.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.Create=function(t){return new g};g.Destroy=function(t,e){};g.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);M.b2Assert(t.GetType()==s.e_polygonShape);M.b2Assert(e.GetType()==s.e_circleShape)};g.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body;var i=this.m_fixtureB.m_body;q.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(t){return new v};v.Destroy=function(t,e){};v.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);M.b2Assert(t.GetType()==s.e_polygonShape);M.b2Assert(e.GetType()==s.e_edgeShape)};v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};v.prototype.b2CollidePolyAndEdge=function(t,e,i,n,r){};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.Create=function(t){return new y};y.Destroy=function(t,e){};y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};y.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();q.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,e.m_xf)};T.b2PositionSolverManifold=function(){};T.prototype.b2PositionSolverManifold=function(){this.m_normal=new U;this.m_separations=new Vector_a2j_Number(M.b2_maxManifoldPoints);this.m_points=new Vector(M.b2_maxManifoldPoints);for(var t=0;t<M.b2_maxManifoldPoints;t++){this.m_points[t]=new U}};T.prototype.Initialize=function(t){M.b2Assert(t.pointCount>0);var e=0;var i=0;var n=0;var r;var s;var a=0;var o=0;switch(t.type){case st.e_circles:{r=t.bodyA.m_xf.R;s=t.localPoint;var c=t.bodyA.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);var l=t.bodyA.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=t.bodyB.m_xf.R;s=t.points[0].localPoint;var h=t.bodyB.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);var u=t.bodyB.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);var d=h-c;var _=u-l;var f=d*d+_*_;if(f>Number.MIN_VALUE*Number.MIN_VALUE){var p=Math.sqrt(f);this.m_normal.x=d/p;this.m_normal.y=_/p}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(c+h);this.m_points[0].y=.5*(l+u);this.m_separations[0]=d*this.m_normal.x+_*this.m_normal.y-t.radius}break;case st.e_faceA:{r=t.bodyA.m_xf.R;s=t.localPlaneNormal;this.m_normal.x=r.col1.x*s.x+r.col2.x*s.y;this.m_normal.y=r.col1.y*s.x+r.col2.y*s.y;r=t.bodyA.m_xf.R;s=t.localPoint;a=t.bodyA.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);o=t.bodyA.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){s=t.points[e].localPoint;i=t.bodyB.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);n=t.bodyB.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);this.m_separations[e]=(i-a)*this.m_normal.x+(n-o)*this.m_normal.y-t.radius;this.m_points[e].x=i;this.m_points[e].y=n}}break;case st.e_faceB:{r=t.bodyB.m_xf.R;s=t.localPlaneNormal;this.m_normal.x=r.col1.x*s.x+r.col2.x*s.y;this.m_normal.y=r.col1.y*s.x+r.col2.y*s.y;r=t.bodyB.m_xf.R;s=t.localPoint;a=t.bodyB.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);o=t.bodyB.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);r=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){s=t.points[e].localPoint;i=t.bodyA.m_xf.position.x+(r.col1.x*s.x+r.col2.x*s.y);n=t.bodyA.m_xf.position.y+(r.col1.y*s.x+r.col2.y*s.y);this.m_separations[e]=(i-a)*this.m_normal.x+(n-o)*this.m_normal.y-t.radius;this.m_points[e].Set(i,n)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new U;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new U})})();(function(){var t=Box2D.Dynamics.b2Body,e=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2ContactFilter,n=Box2D.Dynamics.b2ContactImpulse,r=Box2D.Dynamics.b2ContactListener,s=Box2D.Dynamics.b2ContactManager,a=Box2D.Dynamics.b2DebugDraw,o=Box2D.Dynamics.b2DestructionListener,c=Box2D.Dynamics.b2FilterData,l=Box2D.Dynamics.b2Fixture,h=Box2D.Dynamics.b2FixtureDef,u=Box2D.Dynamics.b2Island,d=Box2D.Dynamics.b2TimeStep,_=Box2D.Dynamics.b2World,f=Box2D.Common.Math.b2Mat22,p=Box2D.Common.Math.b2Mat33,m=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,v=Box2D.Common.Math.b2Transform,y=Box2D.Common.Math.b2Vec2,T=Box2D.Common.Math.b2Vec3,C=Box2D.Common.b2Color,S=Box2D.Common.b2internal,x=Box2D.Common.b2Settings,E=Box2D.Collision.Shapes.b2CircleShape,b=Box2D.Collision.Shapes.b2EdgeChainDef,A=Box2D.Collision.Shapes.b2EdgeShape,R=Box2D.Collision.Shapes.b2MassData,P=Box2D.Collision.Shapes.b2PolygonShape,w=Box2D.Collision.Shapes.b2Shape,I=Box2D.Dynamics.Controllers.b2BuoyancyController,D=Box2D.Dynamics.Controllers.b2ConstantAccelController,L=Box2D.Dynamics.Controllers.b2ConstantForceController,O=Box2D.Dynamics.Controllers.b2Controller,B=Box2D.Dynamics.Controllers.b2ControllerEdge,F=Box2D.Dynamics.Controllers.b2GravityController,N=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(I,Box2D.Dynamics.Controllers.b2Controller);I.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;I.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new y(0,-1);this.offset=0;this.density=0;this.velocity=new y(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};I.prototype.Step=function(t){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()==false){continue}var n=new y;var r=new y;var s=0;var a=0;for(var o=i.GetFixtureList();o;o=o.GetNext()){var c=new y;var l=o.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),c);s+=l;n.x+=l*c.x;n.y+=l*c.y;var h=0;if(this.useDensity){h=1}else{h=1}a+=l*h;r.x+=l*c.x*h;r.y+=l*c.y*h}n.x/=s;n.y/=s;r.x/=a;r.y/=a;if(s<Number.MIN_VALUE)continue;var u=this.gravity.GetNegative();u.Multiply(this.density*s);i.ApplyForce(u,r);var d=i.GetLinearVelocityFromWorldPoint(n);d.Subtract(this.velocity);d.Multiply(-this.linearDrag*s);i.ApplyForce(d,n);i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}};I.prototype.Draw=function(t){var e=1e3;var i=new y;var n=new y;i.x=this.normal.x*this.offset+this.normal.y*e;i.y=this.normal.y*this.offset-this.normal.x*e;n.x=this.normal.x*this.offset-this.normal.y*e;n.y=this.normal.y*this.offset+this.normal.x*e;var r=new C(0,0,1);t.DrawSegment(i,n,r)};Box2D.inherit(D,Box2D.Dynamics.Controllers.b2Controller);D.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;D.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new y(0,0)};D.prototype.Step=function(t){var e=new y(this.A.x*t.dt,this.A.y*t.dt);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake())continue;n.SetLinearVelocity(new y(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}};Box2D.inherit(L,Box2D.Dynamics.Controllers.b2Controller);L.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;L.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new y(0,0)};L.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(!i.IsAwake())continue;i.ApplyForce(this.F,i.GetWorldCenter())}};O.b2Controller=function(){};O.prototype.Step=function(t){};O.prototype.Draw=function(t){};O.prototype.AddBody=function(t){var e=new B;e.controller=this;e.body=t;e.nextBody=this.m_bodyList;e.prevBody=null;this.m_bodyList=e;if(e.nextBody)e.nextBody.prevBody=e;this.m_bodyCount++;e.nextController=t.m_controllerList;e.prevController=null;t.m_controllerList=e;if(e.nextController)e.nextController.prevController=e;t.m_controllerCount++};O.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;if(e.prevBody)e.prevBody.nextBody=e.nextBody;if(e.nextBody)e.nextBody.prevBody=e.prevBody;if(e.nextController)e.nextController.prevController=e.prevController;if(e.prevController)e.prevController.nextController=e.nextController;if(this.m_bodyList==e)this.m_bodyList=e.nextBody;if(t.m_controllerList==e)t.m_controllerList=e.nextController;t.m_controllerCount--;this.m_bodyCount--};O.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};O.prototype.GetNext=function(){return this.m_next};O.prototype.GetWorld=function(){return this.m_world};O.prototype.GetBodyList=function(){return this.m_bodyList};B.b2ControllerEdge=function(){};Box2D.inherit(F,Box2D.Dynamics.Controllers.b2Controller);F.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;F.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};F.prototype.Step=function(t){var e=null;var i=null;var n=null;var r=0;var s=null;var a=null;var o=null;var c=0;var l=0;var h=0;var u=null;if(this.invSqr){for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody){a=s.body;o=a.GetWorldCenter();c=o.x-n.x;l=o.y-n.y;h=c*c+l*l;if(h<Number.MIN_VALUE)continue;u=new y(c,l);u.Multiply(this.G/h/Math.sqrt(h)*r*a.GetMass());if(i.IsAwake())i.ApplyForce(u,n);u.Multiply(-1);if(a.IsAwake())a.ApplyForce(u,o)}}}else{for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody){a=s.body;o=a.GetWorldCenter();c=o.x-n.x;l=o.y-n.y;h=c*c+l*l;if(h<Number.MIN_VALUE)continue;u=new y(c,l);u.Multiply(this.G/h*r*a.GetMass());if(i.IsAwake())i.ApplyForce(u,n);u.Multiply(-1);if(a.IsAwake())a.ApplyForce(u,o)}}}};Box2D.inherit(N,Box2D.Dynamics.Controllers.b2Controller);N.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;N.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new f;this.maxTimestep=0};N.prototype.SetAxisAligned=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;if(t>0||e>0){this.maxTimestep=1/Math.max(t,e)}else{this.maxTimestep=0}};N.prototype.Step=function(t){var e=t.dt;if(e<=Number.MIN_VALUE)return;if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake()){continue}var r=n.GetWorldVector(m.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new y(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3,h=Box2D.Dynamics.Joints.b2DistanceJoint,u=Box2D.Dynamics.Joints.b2DistanceJointDef,d=Box2D.Dynamics.Joints.b2FrictionJoint,_=Box2D.Dynamics.Joints.b2FrictionJointDef,f=Box2D.Dynamics.Joints.b2GearJoint,p=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,g=Box2D.Dynamics.Joints.b2Joint,v=Box2D.Dynamics.Joints.b2JointDef,y=Box2D.Dynamics.Joints.b2JointEdge,T=Box2D.Dynamics.Joints.b2LineJoint,C=Box2D.Dynamics.Joints.b2LineJointDef,S=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,E=Box2D.Dynamics.Joints.b2PrismaticJoint,b=Box2D.Dynamics.Joints.b2PrismaticJointDef,A=Box2D.Dynamics.Joints.b2PulleyJoint,R=Box2D.Dynamics.Joints.b2PulleyJointDef,P=Box2D.Dynamics.Joints.b2RevoluteJoint,w=Box2D.Dynamics.Joints.b2RevoluteJointDef,I=Box2D.Dynamics.Joints.b2WeldJoint,D=Box2D.Dynamics.Joints.b2WeldJointDef,L=Box2D.Dynamics.b2Body,O=Box2D.Dynamics.b2BodyDef,B=Box2D.Dynamics.b2ContactFilter,F=Box2D.Dynamics.b2ContactImpulse,N=Box2D.Dynamics.b2ContactListener,M=Box2D.Dynamics.b2ContactManager,V=Box2D.Dynamics.b2DebugDraw,k=Box2D.Dynamics.b2DestructionListener,W=Box2D.Dynamics.b2FilterData,G=Box2D.Dynamics.b2Fixture,z=Box2D.Dynamics.b2FixtureDef,U=Box2D.Dynamics.b2Island,Y=Box2D.Dynamics.b2TimeStep,X=Box2D.Dynamics.b2World;Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_u=new c};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};h.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};h.prototype.GetLength=function(){return this.m_length};h.prototype.SetLength=function(t){if(t===undefined)t=0;this.m_length=t};h.prototype.GetFrequency=function(){return this.m_frequencyHz};h.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};h.prototype.GetDampingRatio=function(){return this.m_dampingRatio};h.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};h.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};h.prototype.InitVelocityConstraints=function(t){var e;var n=0;var r=this.m_bodyA;var s=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=n;e=s.m_xf.R;var c=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-s.m_sweep.localCenter.y;n=e.col1.x*c+e.col2.x*l;l=e.col1.y*c+e.col2.y*l;c=n;this.m_u.x=s.m_sweep.c.x+c-r.m_sweep.c.x-a;this.m_u.y=s.m_sweep.c.y+l-r.m_sweep.c.y-o;var h=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(h>i.b2_linearSlop){this.m_u.Multiply(1/h)}else{this.m_u.SetZero()}var u=a*this.m_u.y-o*this.m_u.x;var d=c*this.m_u.y-l*this.m_u.x;var _=r.m_invMass+r.m_invI*u*u+s.m_invMass+s.m_invI*d*d;this.m_mass=_!=0?1/_:0;if(this.m_frequencyHz>0){var f=h-this.m_length;var p=2*Math.PI*this.m_frequencyHz;var m=2*this.m_mass*this.m_dampingRatio*p;var g=this.m_mass*p*p;this.m_gamma=t.dt*(m+t.dt*g);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=f*t.dt*g*this.m_gamma;this.m_mass=_+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var v=this.m_impulse*this.m_u.x;var y=this.m_impulse*this.m_u.y;r.m_linearVelocity.x-=r.m_invMass*v;r.m_linearVelocity.y-=r.m_invMass*y;r.m_angularVelocity-=r.m_invI*(a*y-o*v);s.m_linearVelocity.x+=s.m_invMass*v;s.m_linearVelocity.y+=s.m_invMass*y;s.m_angularVelocity+=s.m_invI*(c*y-l*v)}else{this.m_impulse=0}};h.prototype.SolveVelocityConstraints=function(t){var e;var i=this.m_bodyA;var n=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-i.m_sweep.localCenter.y;var a=e.col1.x*r+e.col2.x*s;s=e.col1.y*r+e.col2.y*s;r=a;e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=e.col1.x*o+e.col2.x*c;c=e.col1.y*o+e.col2.y*c;o=a;var l=i.m_linearVelocity.x+-i.m_angularVelocity*s;var h=i.m_linearVelocity.y+i.m_angularVelocity*r;var u=n.m_linearVelocity.x+-n.m_angularVelocity*c;var d=n.m_linearVelocity.y+n.m_angularVelocity*o;var _=this.m_u.x*(u-l)+this.m_u.y*(d-h);var f=-this.m_mass*(_+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;var p=f*this.m_u.x;var m=f*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*p;i.m_linearVelocity.y-=i.m_invMass*m;i.m_angularVelocity-=i.m_invI*(r*m-s*p);n.m_linearVelocity.x+=n.m_invMass*p;n.m_linearVelocity.y+=n.m_invMass*m;n.m_angularVelocity+=n.m_invI*(o*m-c*p)};h.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;if(this.m_frequencyHz>0){return true}var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-n.m_sweep.localCenter.y;var c=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=c;e=r.m_xf.R;var l=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-r.m_sweep.localCenter.y;c=e.col1.x*l+e.col2.x*h;h=e.col1.y*l+e.col2.y*h;l=c;var u=r.m_sweep.c.x+l-n.m_sweep.c.x-a;var d=r.m_sweep.c.y+h-n.m_sweep.c.y-o;var _=Math.sqrt(u*u+d*d);u/=_;d/=_;var f=_-this.m_length;f=s.Clamp(f,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var p=-this.m_mass*f;this.m_u.Set(u,d);var m=p*this.m_u.x;var g=p*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*m;n.m_sweep.c.y-=n.m_invMass*g;n.m_sweep.a-=n.m_invI*(a*g-o*m);r.m_sweep.c.x+=r.m_invMass*m;
r.m_sweep.c.y+=r.m_invMass*g;r.m_sweep.a+=r.m_invI*(l*g-h*m);n.SynchronizeTransform();r.SynchronizeTransform();return s.Abs(f)<i.b2_linearSlop};Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef);u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;u.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c};u.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};u.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));var r=n.x-i.x;var s=n.y-i.y;this.length=Math.sqrt(r*r+s*s);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new c;this.m_localAnchorB=new c;this.m_linearMass=new n;this.m_linearImpulse=new c};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};d.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};d.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_angularImpulse};d.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};d.prototype.GetMaxForce=function(){return this.m_maxForce};d.prototype.SetMaxTorque=function(t){if(t===undefined)t=0;this.m_maxTorque=t};d.prototype.GetMaxTorque=function(){return this.m_maxTorque};d.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};d.prototype.InitVelocityConstraints=function(t){var e;var i=0;var r=this.m_bodyA;var s=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=i;e=s.m_xf.R;var c=this.m_localAnchorB.x-s.m_sweep.localCenter.x;var l=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*c+e.col2.x*l;l=e.col1.y*c+e.col2.y*l;c=i;var h=r.m_invMass;var u=s.m_invMass;var d=r.m_invI;var _=s.m_invI;var f=new n;f.col1.x=h+u;f.col2.x=0;f.col1.y=0;f.col2.y=h+u;f.col1.x+=d*o*o;f.col2.x+=-d*a*o;f.col1.y+=-d*a*o;f.col2.y+=d*a*a;f.col1.x+=_*l*l;f.col2.x+=-_*c*l;f.col1.y+=-_*c*l;f.col2.y+=_*c*c;f.GetInverse(this.m_linearMass);this.m_angularMass=d+_;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var p=this.m_linearImpulse;r.m_linearVelocity.x-=h*p.x;r.m_linearVelocity.y-=h*p.y;r.m_angularVelocity-=d*(a*p.y-o*p.x+this.m_angularImpulse);s.m_linearVelocity.x+=u*p.x;s.m_linearVelocity.y+=u*p.y;s.m_angularVelocity+=_*(c*p.y-l*p.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};d.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=n.m_linearVelocity;var o=n.m_angularVelocity;var l=r.m_linearVelocity;var h=r.m_angularVelocity;var u=n.m_invMass;var d=r.m_invMass;var _=n.m_invI;var f=r.m_invI;e=n.m_xf.R;var p=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var m=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*p+e.col2.x*m;m=e.col1.y*p+e.col2.y*m;p=i;e=r.m_xf.R;var g=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*g+e.col2.x*v;v=e.col1.y*g+e.col2.y*v;g=i;var y=0;{var T=h-o;var C=-this.m_angularMass*T;var S=this.m_angularImpulse;y=t.dt*this.m_maxTorque;this.m_angularImpulse=s.Clamp(this.m_angularImpulse+C,-y,y);C=this.m_angularImpulse-S;o-=_*C;h+=f*C}{var x=l.x-h*v-a.x+o*m;var E=l.y+h*g-a.y-o*p;var b=s.MulMV(this.m_linearMass,new c(-x,-E));var A=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);y=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>y*y){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(y)}b=s.SubtractVV(this.m_linearImpulse,A);a.x-=u*b.x;a.y-=u*b.y;o-=_*(p*b.y-m*b.x);l.x+=d*b.x;l.y+=d*b.y;h+=f*(g*b.y-v*b.x)}n.m_angularVelocity=o;r.m_angularVelocity=h};d.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(_,Box2D.Dynamics.Joints.b2JointDef);_.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;_.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c};_.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_frictionJoint;this.maxForce=0;this.maxTorque=0};_.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(f,Box2D.Dynamics.Joints.b2Joint);f.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;f.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new c;this.m_groundAnchor2=new c;this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_J=new m};f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};f.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};f.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;var e=this.m_bodyB.m_xf.R;var i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var r=e.col1.x*i+e.col2.x*n;n=e.col1.y*i+e.col2.y*n;i=r;var s=this.m_impulse*this.m_J.linearB.x;var a=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*a+n*s)};f.prototype.GetRatio=function(){return this.m_ratio};f.prototype.SetRatio=function(t){if(t===undefined)t=0;this.m_ratio=t};f.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type);var i=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var n=0;var r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(e==g.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof P?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);n=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof E?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);n=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(i==g.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof P?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);r=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof E?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);r=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=n+this.m_ratio*r;this.m_impulse=0};f.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1;var i=this.m_ground2;var n=this.m_bodyA;var r=this.m_bodyB;var s=0;var a=0;var o=0;var c=0;var l;var h;var u=0;var d=0;var _=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;_+=n.m_invI}else{l=e.m_xf.R;h=this.m_prismatic1.m_localXAxis1;s=l.col1.x*h.x+l.col2.x*h.y;a=l.col1.y*h.x+l.col2.y*h.y;l=n.m_xf.R;o=this.m_localAnchor1.x-n.m_sweep.localCenter.x;c=this.m_localAnchor1.y-n.m_sweep.localCenter.y;d=l.col1.x*o+l.col2.x*c;c=l.col1.y*o+l.col2.y*c;o=d;u=o*a-c*s;this.m_J.linearA.Set(-s,-a);this.m_J.angularA=-u;_+=n.m_invMass+n.m_invI*u*u}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;_+=this.m_ratio*this.m_ratio*r.m_invI}else{l=i.m_xf.R;h=this.m_prismatic2.m_localXAxis1;s=l.col1.x*h.x+l.col2.x*h.y;a=l.col1.y*h.x+l.col2.y*h.y;l=r.m_xf.R;o=this.m_localAnchor2.x-r.m_sweep.localCenter.x;c=this.m_localAnchor2.y-r.m_sweep.localCenter.y;d=l.col1.x*o+l.col2.x*c;c=l.col1.y*o+l.col2.y*c;o=d;u=o*a-c*s;this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*a);this.m_J.angularB=-this.m_ratio*u;_+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*u*u)}this.m_mass=_>0?1/_:0;if(t.warmStarting){n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x;n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y;n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};f.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity);var r=-this.m_mass*n;this.m_impulse+=r;e.m_linearVelocity.x+=e.m_invMass*r*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*r*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*r*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*r*this.m_J.angularB};f.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=this.m_bodyA;var r=this.m_bodyB;var s=0;var a=0;if(this.m_revolute1){s=this.m_revolute1.GetJointAngle()}else{s=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){a=this.m_revolute2.GetJointAngle()}else{a=this.m_prismatic2.GetJointTranslation()}var o=this.m_constant-(s+this.m_ratio*a);var c=-this.m_mass*o;n.m_sweep.c.x+=n.m_invMass*c*this.m_J.linearA.x;n.m_sweep.c.y+=n.m_invMass*c*this.m_J.linearA.y;n.m_sweep.a+=n.m_invI*c*this.m_J.angularA;r.m_sweep.c.x+=r.m_invMass*c*this.m_J.linearB.x;r.m_sweep.c.y+=r.m_invMass*c*this.m_J.linearB.y;r.m_sweep.a+=r.m_invI*c*this.m_J.angularB;n.SynchronizeTransform();r.SynchronizeTransform();return e<i.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};p.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};m.b2Jacobian=function(){this.linearA=new c;this.linearB=new c};m.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};m.prototype.Set=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;this.linearA.SetV(t);this.angularA=e;this.linearB.SetV(i);this.angularB=n};m.prototype.Compute=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*n};g.b2Joint=function(){this.m_edgeA=new y;this.m_edgeB=new y;this.m_localCenterA=new c;this.m_localCenterB=new c};g.prototype.GetType=function(){return this.m_type};g.prototype.GetAnchorA=function(){return null};g.prototype.GetAnchorB=function(){return null};g.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return null};g.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};g.prototype.GetBodyA=function(){return this.m_bodyA};g.prototype.GetBodyB=function(){return this.m_bodyB};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetUserData=function(){return this.m_userData};g.prototype.SetUserData=function(t){this.m_userData=t};g.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};g.Create=function(t,e){var i=null;switch(t.type){case g.e_distanceJoint:{i=new h(t instanceof u?t:null)}break;case g.e_mouseJoint:{i=new S(t instanceof x?t:null)}break;case g.e_prismaticJoint:{i=new E(t instanceof b?t:null)}break;case g.e_revoluteJoint:{i=new P(t instanceof w?t:null)}break;case g.e_pulleyJoint:{i=new A(t instanceof R?t:null)}break;case g.e_gearJoint:{i=new f(t instanceof p?t:null)}break;case g.e_lineJoint:{i=new T(t instanceof C?t:null)}break;case g.e_weldJoint:{i=new I(t instanceof D?t:null)}break;case g.e_frictionJoint:{i=new d(t instanceof _?t:null)}break;default:break}return i};g.Destroy=function(t,e){};g.prototype.b2Joint=function(t){i.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_prev=null;this.m_next=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};g.prototype.InitVelocityConstraints=function(t){};g.prototype.SolveVelocityConstraints=function(t){};g.prototype.FinalizeVelocityConstraints=function(){};g.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});v.b2JointDef=function(){};v.prototype.b2JointDef=function(){this.type=g.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};y.b2JointEdge=function(){};Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint);T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;T.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_localXAxis1=new c;this.m_localYAxis1=new c;this.m_axis=new c;this.m_perp=new c;this.m_K=new n;this.m_impulse=new c};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};T.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};T.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};T.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var s=r.x-n.x;var a=r.y-n.y;var o=t.GetWorldVector(this.m_localXAxis1);var c=o.x*s+o.y*a;return c};T.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=s;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor2.y-e.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*o;o=i.col1.y*a+i.col2.y*o;a=s;var c=t.m_sweep.c.x+n;var l=t.m_sweep.c.y+r;var h=e.m_sweep.c.x+a;var u=e.m_sweep.c.y+o;var d=h-c;var _=u-l;var f=t.GetWorldVector(this.m_localXAxis1);var p=t.m_linearVelocity;var m=e.m_linearVelocity;var g=t.m_angularVelocity;var v=e.m_angularVelocity;var y=d*(-g*f.y)+_*(g*f.x)+(f.x*(m.x+-v*o-p.x- -g*r)+f.y*(m.y+v*a-p.y-g*n));return y};T.prototype.IsLimitEnabled=function(){return this.m_enableLimit};T.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};T.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};T.prototype.GetUpperLimit=function(){return this.m_upperTranslation};T.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};T.prototype.IsMotorEnabled=function(){return this.m_enableMotor};T.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};T.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};T.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};T.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};T.prototype.GetMotorForce=function(){return this.m_motorImpulse};T.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};T.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var o=e.GetTransform();var c=n.GetTransform();r=e.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x;var h=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*l+r.col2.x*h;h=r.col1.y*l+r.col2.y*h;l=a;r=n.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x;var d=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*u+r.col2.x*d;d=r.col1.y*u+r.col2.y*d;u=a;var _=n.m_sweep.c.x+u-e.m_sweep.c.x-l;var f=n.m_sweep.c.y+d-e.m_sweep.c.y-h;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(s.MulMV(o.R,this.m_localXAxis1));this.m_a1=(_+l)*this.m_axis.y-(f+h)*this.m_axis.x;this.m_a2=u*this.m_axis.y-d*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(s.MulMV(o.R,this.m_localYAxis1));this.m_s1=(_+l)*this.m_perp.y-(f+h)*this.m_perp.x;this.m_s2=u*this.m_perp.y-d*this.m_perp.x;var p=this.m_invMassA;var m=this.m_invMassB;var v=this.m_invIA;var y=this.m_invIB;this.m_K.col1.x=p+m+v*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=p+m+v*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2}if(this.m_enableLimit){var T=this.m_axis.x*_+this.m_axis.y*f;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(T<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.y=0}}else if(T>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var C=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var x=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var E=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*C;e.m_linearVelocity.y-=this.m_invMassA*S;e.m_angularVelocity-=this.m_invIA*x;n.m_linearVelocity.x+=this.m_invMassB*C;n.m_linearVelocity.y+=this.m_invMassB*S;n.m_angularVelocity+=this.m_invIB*E}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};T.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var o=i.m_angularVelocity;var l=0;var h=0;var u=0;var d=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var _=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*o-this.m_a1*r;var f=this.m_motorMass*(this.m_motorSpeed-_);var p=this.m_motorImpulse;var m=t.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+f,-m,m);f=this.m_motorImpulse-p;l=f*this.m_axis.x;h=f*this.m_axis.y;u=f*this.m_a1;d=f*this.m_a2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*h;r-=this.m_invIA*u;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*h;o+=this.m_invIB*d}var v=this.m_perp.x*(a.x-n.x)+this.m_perp.y*(a.y-n.y)+this.m_s2*o-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var y=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*o-this.m_a1*r;var T=this.m_impulse.Copy();var C=this.m_K.Solve(new c,-v,-y);this.m_impulse.Add(C);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.y=s.Max(this.m_impulse.y,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.y=s.Min(this.m_impulse.y,0)}var S=-v-(this.m_impulse.y-T.y)*this.m_K.col2.x;var x=0;if(this.m_K.col1.x!=0){x=S/this.m_K.col1.x+T.x}else{x=T.x}this.m_impulse.x=x;C.x=this.m_impulse.x-T.x;C.y=this.m_impulse.y-T.y;l=C.x*this.m_perp.x+C.y*this.m_axis.x;h=C.x*this.m_perp.y+C.y*this.m_axis.y;u=C.x*this.m_s1+C.y*this.m_a1;d=C.x*this.m_s2+C.y*this.m_a2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*h;r-=this.m_invIA*u;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*h;o+=this.m_invIB*d}else{var E=0;if(this.m_K.col1.x!=0){E=-v/this.m_K.col1.x}else{E=0}this.m_impulse.x+=E;l=E*this.m_perp.x;h=E*this.m_perp.y;u=E*this.m_s1;d=E*this.m_s2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*h;r-=this.m_invIA*u;a.x+=this.m_invMassB*l;a.y+=this.m_invMassB*h;o+=this.m_invIB*d}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=o};T.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var o=this.m_bodyB;var l=a.m_sweep.c;var h=a.m_sweep.a;var u=o.m_sweep.c;var d=o.m_sweep.a;var _;var f=0;var p=0;var m=0;var g=0;var v=0;var y=0;var T=0;var C=false;var S=0;var x=n.FromAngle(h);var E=n.FromAngle(d);_=x;var b=this.m_localAnchor1.x-this.m_localCenterA.x;var A=this.m_localAnchor1.y-this.m_localCenterA.y;f=_.col1.x*b+_.col2.x*A;A=_.col1.y*b+_.col2.y*A;b=f;_=E;var R=this.m_localAnchor2.x-this.m_localCenterB.x;var P=this.m_localAnchor2.y-this.m_localCenterB.y;f=_.col1.x*R+_.col2.x*P;P=_.col1.y*R+_.col2.y*P;R=f;var w=u.x+R-l.x-b;var I=u.y+P-l.y-A;if(this.m_enableLimit){this.m_axis=s.MulMV(x,this.m_localXAxis1);this.m_a1=(w+b)*this.m_axis.y-(I+A)*this.m_axis.x;this.m_a2=R*this.m_axis.y-P*this.m_axis.x;var D=this.m_axis.x*w+this.m_axis.y*I;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){S=s.Clamp(D,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);y=s.Abs(D);C=true}else if(D<=this.m_lowerTranslation){S=s.Clamp(D-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);y=this.m_lowerTranslation-D;C=true}else if(D>=this.m_upperTranslation){S=s.Clamp(D-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);y=D-this.m_upperTranslation;C=true}}this.m_perp=s.MulMV(x,this.m_localYAxis1);this.m_s1=(w+b)*this.m_perp.y-(I+A)*this.m_perp.x;this.m_s2=R*this.m_perp.y-P*this.m_perp.x;var L=new c;var O=this.m_perp.x*w+this.m_perp.y*I;y=s.Max(y,s.Abs(O));T=0;if(C){p=this.m_invMassA;m=this.m_invMassB;g=this.m_invIA;v=this.m_invIB;this.m_K.col1.x=p+m+g*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=p+m+g*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;this.m_K.Solve(L,-O,-S)}else{p=this.m_invMassA;m=this.m_invMassB;g=this.m_invIA;v=this.m_invIB;var B=p+m+g*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;var F=0;if(B!=0){F=-O/B}else{F=0}L.x=F;L.y=0}var N=L.x*this.m_perp.x+L.y*this.m_axis.x;var M=L.x*this.m_perp.y+L.y*this.m_axis.y;var V=L.x*this.m_s1+L.y*this.m_a1;var k=L.x*this.m_s2+L.y*this.m_a2;l.x-=this.m_invMassA*N;l.y-=this.m_invMassA*M;h-=this.m_invIA*V;u.x+=this.m_invMassB*N;u.y+=this.m_invMassB*M;d+=this.m_invIB*k;a.m_sweep.a=h;o.m_sweep.a=d;a.SynchronizeTransform();o.SynchronizeTransform();return y<=i.b2_linearSlop&&T<=i.b2_angularSlop};Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef);C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;C.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c;this.localAxisA=new c};C.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};C.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n)};Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint);S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;S.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.m_localAnchor=new c;this.m_target=new c;this.m_impulse=new c;this.m_mass=new n;this.m_C=new c};S.prototype.GetAnchorA=function(){return this.m_target};S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};S.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse.x,t*this.m_impulse.y)};S.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};S.prototype.GetTarget=function(){return this.m_target};S.prototype.SetTarget=function(t){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=t};S.prototype.GetMaxForce=function(){return this.m_maxForce};S.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};S.prototype.GetFrequency=function(){return this.m_frequencyHz};S.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};S.prototype.GetDampingRatio=function(){return this.m_dampingRatio};S.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};S.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x;var i=this.m_target.y-this.m_bodyB.m_xf.position.y;var n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*n.col1.x+i*n.col1.y;this.m_localAnchor.y=e*n.col2.x+i*n.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};S.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB;var i=e.GetMass();var n=2*Math.PI*this.m_frequencyHz;var r=2*i*this.m_dampingRatio*n;var s=i*n*n;this.m_gamma=t.dt*(r+t.dt*s);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=t.dt*s*this.m_gamma;var a;a=e.m_xf.R;var o=this.m_localAnchor.x-e.m_sweep.localCenter.x;var c=this.m_localAnchor.y-e.m_sweep.localCenter.y;var l=a.col1.x*o+a.col2.x*c;c=a.col1.y*o+a.col2.y*c;o=l;var h=e.m_invMass;var u=e.m_invI;this.K1.col1.x=h;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h;this.K2.col1.x=u*c*c;this.K2.col2.x=-u*o*c;this.K2.col1.y=-u*o*c;this.K2.col2.y=u*o*o;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=e.m_sweep.c.x+o-this.m_target.x;this.m_C.y=e.m_sweep.c.y+c-this.m_target.y;e.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;e.m_linearVelocity.x+=h*this.m_impulse.x;e.m_linearVelocity.y+=h*this.m_impulse.y;e.m_angularVelocity+=u*(o*this.m_impulse.y-c*this.m_impulse.x)};S.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyB;var i;var n=0;var r=0;i=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor.y-e.m_sweep.localCenter.y;n=i.col1.x*s+i.col2.x*a;a=i.col1.y*s+i.col2.y*a;s=n;var o=e.m_linearVelocity.x+-e.m_angularVelocity*a;var c=e.m_linearVelocity.y+e.m_angularVelocity*s;i=this.m_mass;n=o+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;r=c+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var l=-(i.col1.x*n+i.col2.x*r);var h=-(i.col1.y*n+i.col2.y*r);var u=this.m_impulse.x;var d=this.m_impulse.y;this.m_impulse.x+=l;this.m_impulse.y+=h;var _=t.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>_*_){this.m_impulse.Multiply(_/this.m_impulse.Length())}l=this.m_impulse.x-u;h=this.m_impulse.y-d;e.m_linearVelocity.x+=e.m_invMass*l;e.m_linearVelocity.y+=e.m_invMass*h;e.m_angularVelocity+=e.m_invI*(s*h-a*l)};S.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new c};x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;E.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_localXAxis1=new c;this.m_localYAxis1=new c;this.m_axis=new c;this.m_perp=new c;this.m_K=new r;this.m_impulse=new l};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};E.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};E.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var s=r.x-n.x;var a=r.y-n.y;var o=t.GetWorldVector(this.m_localXAxis1);var c=o.x*s+o.y*a;return c};E.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=s;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor2.y-e.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*o;o=i.col1.y*a+i.col2.y*o;a=s;var c=t.m_sweep.c.x+n;var l=t.m_sweep.c.y+r;var h=e.m_sweep.c.x+a;var u=e.m_sweep.c.y+o;var d=h-c;var _=u-l;var f=t.GetWorldVector(this.m_localXAxis1);
var p=t.m_linearVelocity;var m=e.m_linearVelocity;var g=t.m_angularVelocity;var v=e.m_angularVelocity;var y=d*(-g*f.y)+_*(g*f.x)+(f.x*(m.x+-v*o-p.x- -g*r)+f.y*(m.y+v*a-p.y-g*n));return y};E.prototype.IsLimitEnabled=function(){return this.m_enableLimit};E.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};E.prototype.GetUpperLimit=function(){return this.m_upperTranslation};E.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};E.prototype.IsMotorEnabled=function(){return this.m_enableMotor};E.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};E.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};E.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};E.prototype.GetMotorForce=function(){return this.m_motorImpulse};E.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};E.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var o=e.GetTransform();var c=n.GetTransform();r=e.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x;var h=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*l+r.col2.x*h;h=r.col1.y*l+r.col2.y*h;l=a;r=n.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x;var d=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*u+r.col2.x*d;d=r.col1.y*u+r.col2.y*d;u=a;var _=n.m_sweep.c.x+u-e.m_sweep.c.x-l;var f=n.m_sweep.c.y+d-e.m_sweep.c.y-h;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(s.MulMV(o.R,this.m_localXAxis1));this.m_a1=(_+l)*this.m_axis.y-(f+h)*this.m_axis.x;this.m_a2=u*this.m_axis.y-d*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(s.MulMV(o.R,this.m_localYAxis1));this.m_s1=(_+l)*this.m_perp.y-(f+h)*this.m_perp.x;this.m_s2=u*this.m_perp.y-d*this.m_perp.x;var p=this.m_invMassA;var m=this.m_invMassB;var v=this.m_invIA;var y=this.m_invIB;this.m_K.col1.x=p+m+v*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+y*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+y;this.m_K.col2.z=v*this.m_a1+y*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=p+m+v*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2}if(this.m_enableLimit){var T=this.m_axis.x*_+this.m_axis.y*f;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=g.e_equalLimits}else if(T<=this.m_lowerTranslation){if(this.m_limitState!=g.e_atLowerLimit){this.m_limitState=g.e_atLowerLimit;this.m_impulse.z=0}}else if(T>=this.m_upperTranslation){if(this.m_limitState!=g.e_atUpperLimit){this.m_limitState=g.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var C=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var x=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var E=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*C;e.m_linearVelocity.y-=this.m_invMassA*S;e.m_angularVelocity-=this.m_invIA*x;n.m_linearVelocity.x+=this.m_invMassB*C;n.m_linearVelocity.y+=this.m_invMassB*S;n.m_angularVelocity+=this.m_invIB*E}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};E.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var o=i.m_angularVelocity;var h=0;var u=0;var d=0;var _=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var f=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*o-this.m_a1*r;var p=this.m_motorMass*(this.m_motorSpeed-f);var m=this.m_motorImpulse;var v=t.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+p,-v,v);p=this.m_motorImpulse-m;h=p*this.m_axis.x;u=p*this.m_axis.y;d=p*this.m_a1;_=p*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*d;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;o+=this.m_invIB*_}var y=this.m_perp.x*(a.x-n.x)+this.m_perp.y*(a.y-n.y)+this.m_s2*o-this.m_s1*r;var T=o-r;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var C=this.m_axis.x*(a.x-n.x)+this.m_axis.y*(a.y-n.y)+this.m_a2*o-this.m_a1*r;var S=this.m_impulse.Copy();var x=this.m_K.Solve33(new l,-y,-T,-C);this.m_impulse.Add(x);if(this.m_limitState==g.e_atLowerLimit){this.m_impulse.z=s.Max(this.m_impulse.z,0)}else if(this.m_limitState==g.e_atUpperLimit){this.m_impulse.z=s.Min(this.m_impulse.z,0)}var E=-y-(this.m_impulse.z-S.z)*this.m_K.col3.x;var b=-T-(this.m_impulse.z-S.z)*this.m_K.col3.y;var A=this.m_K.Solve22(new c,E,b);A.x+=S.x;A.y+=S.y;this.m_impulse.x=A.x;this.m_impulse.y=A.y;x.x=this.m_impulse.x-S.x;x.y=this.m_impulse.y-S.y;x.z=this.m_impulse.z-S.z;h=x.x*this.m_perp.x+x.z*this.m_axis.x;u=x.x*this.m_perp.y+x.z*this.m_axis.y;d=x.x*this.m_s1+x.y+x.z*this.m_a1;_=x.x*this.m_s2+x.y+x.z*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*d;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;o+=this.m_invIB*_}else{var R=this.m_K.Solve22(new c,-y,-T);this.m_impulse.x+=R.x;this.m_impulse.y+=R.y;h=R.x*this.m_perp.x;u=R.x*this.m_perp.y;d=R.x*this.m_s1+R.y;_=R.x*this.m_s2+R.y;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*d;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*u;o+=this.m_invIB*_}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=o};E.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var o=this.m_bodyB;var h=a.m_sweep.c;var u=a.m_sweep.a;var d=o.m_sweep.c;var _=o.m_sweep.a;var f;var p=0;var m=0;var g=0;var v=0;var y=0;var T=0;var C=0;var S=false;var x=0;var E=n.FromAngle(u);var b=n.FromAngle(_);f=E;var A=this.m_localAnchor1.x-this.m_localCenterA.x;var R=this.m_localAnchor1.y-this.m_localCenterA.y;p=f.col1.x*A+f.col2.x*R;R=f.col1.y*A+f.col2.y*R;A=p;f=b;var P=this.m_localAnchor2.x-this.m_localCenterB.x;var w=this.m_localAnchor2.y-this.m_localCenterB.y;p=f.col1.x*P+f.col2.x*w;w=f.col1.y*P+f.col2.y*w;P=p;var I=d.x+P-h.x-A;var D=d.y+w-h.y-R;if(this.m_enableLimit){this.m_axis=s.MulMV(E,this.m_localXAxis1);this.m_a1=(I+A)*this.m_axis.y-(D+R)*this.m_axis.x;this.m_a2=P*this.m_axis.y-w*this.m_axis.x;var L=this.m_axis.x*I+this.m_axis.y*D;if(s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){x=s.Clamp(L,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);T=s.Abs(L);S=true}else if(L<=this.m_lowerTranslation){x=s.Clamp(L-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);T=this.m_lowerTranslation-L;S=true}else if(L>=this.m_upperTranslation){x=s.Clamp(L-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);T=L-this.m_upperTranslation;S=true}}this.m_perp=s.MulMV(E,this.m_localYAxis1);this.m_s1=(I+A)*this.m_perp.y-(D+R)*this.m_perp.x;this.m_s2=P*this.m_perp.y-w*this.m_perp.x;var O=new l;var B=this.m_perp.x*I+this.m_perp.y*D;var F=_-u-this.m_refAngle;T=s.Max(T,s.Abs(B));C=s.Abs(F);if(S){m=this.m_invMassA;g=this.m_invMassB;v=this.m_invIA;y=this.m_invIB;this.m_K.col1.x=m+g+v*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+y*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+y;this.m_K.col2.z=v*this.m_a1+y*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=m+g+v*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2;this.m_K.Solve33(O,-B,-F,-x)}else{m=this.m_invMassA;g=this.m_invMassB;v=this.m_invIA;y=this.m_invIB;var N=m+g+v*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;var M=v*this.m_s1+y*this.m_s2;var V=v+y;this.m_K.col1.Set(N,M,0);this.m_K.col2.Set(M,V,0);var k=this.m_K.Solve22(new c,-B,-F);O.x=k.x;O.y=k.y;O.z=0}var W=O.x*this.m_perp.x+O.z*this.m_axis.x;var G=O.x*this.m_perp.y+O.z*this.m_axis.y;var z=O.x*this.m_s1+O.y+O.z*this.m_a1;var U=O.x*this.m_s2+O.y+O.z*this.m_a2;h.x-=this.m_invMassA*W;h.y-=this.m_invMassA*G;u-=this.m_invIA*z;d.x+=this.m_invMassB*W;d.y+=this.m_invMassB*G;_+=this.m_invIB*U;a.m_sweep.a=u;o.m_sweep.a=_;a.SynchronizeTransform();o.SynchronizeTransform();return T<=i.b2_linearSlop&&C<=i.b2_angularSlop};Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c;this.localAxisA=new c};b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};b.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint);A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;A.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new c;this.m_groundAnchor2=new c;this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_u1=new c;this.m_u2=new c};A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};A.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};A.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};A.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};A.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};A.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};A.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};A.prototype.GetRatio=function(){return this.m_ratio};A.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=s.Min(t.maxLengthA,this.m_constant-this.m_ratio*A.b2_minPulleyLength);this.m_maxLength2=s.Min(t.maxLengthB,(this.m_constant-A.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};A.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;r=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var o=r.col1.x*s+r.col2.x*a;a=r.col1.y*s+r.col2.y*a;s=o;r=n.m_xf.R;var c=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=r.col1.x*c+r.col2.x*l;l=r.col1.y*c+r.col2.y*l;c=o;var h=e.m_sweep.c.x+s;var u=e.m_sweep.c.y+a;var d=n.m_sweep.c.x+c;var _=n.m_sweep.c.y+l;var f=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var p=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var v=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(h-f,u-p);this.m_u2.Set(d-m,_-v);var y=this.m_u1.Length();var T=this.m_u2.Length();if(y>i.b2_linearSlop){this.m_u1.Multiply(1/y)}else{this.m_u1.SetZero()}if(T>i.b2_linearSlop){this.m_u2.Multiply(1/T)}else{this.m_u2.SetZero()}var C=this.m_constant-y-this.m_ratio*T;if(C>0){this.m_state=g.e_inactiveLimit;this.m_impulse=0}else{this.m_state=g.e_atUpperLimit}if(y<this.m_maxLength1){this.m_limitState1=g.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=g.e_atUpperLimit}if(T<this.m_maxLength2){this.m_limitState2=g.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=g.e_atUpperLimit}var S=s*this.m_u1.y-a*this.m_u1.x;var x=c*this.m_u2.y-l*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*S*S;this.m_limitMass2=n.m_invMass+n.m_invI*x*x;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var E=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var R=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*E;e.m_linearVelocity.y+=e.m_invMass*b;e.m_angularVelocity+=e.m_invI*(s*b-a*E);n.m_linearVelocity.x+=n.m_invMass*A;n.m_linearVelocity.y+=n.m_invMass*R;n.m_angularVelocity+=n.m_invI*(c*R-l*A)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};A.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var o=n.col1.x*r+n.col2.x*a;a=n.col1.y*r+n.col2.y*a;r=o;n=i.m_xf.R;var c=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;o=n.col1.x*c+n.col2.x*l;l=n.col1.y*c+n.col2.y*l;c=o;var h=0;var u=0;var d=0;var _=0;var f=0;var p=0;var m=0;var v=0;var y=0;var T=0;var C=0;if(this.m_state==g.e_atUpperLimit){h=e.m_linearVelocity.x+-e.m_angularVelocity*a;u=e.m_linearVelocity.y+e.m_angularVelocity*r;d=i.m_linearVelocity.x+-i.m_angularVelocity*l;_=i.m_linearVelocity.y+i.m_angularVelocity*c;y=-(this.m_u1.x*h+this.m_u1.y*u)-this.m_ratio*(this.m_u2.x*d+this.m_u2.y*_);T=this.m_pulleyMass*-y;C=this.m_impulse;this.m_impulse=s.Max(0,this.m_impulse+T);T=this.m_impulse-C;f=-T*this.m_u1.x;p=-T*this.m_u1.y;m=-this.m_ratio*T*this.m_u2.x;v=-this.m_ratio*T*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*f;e.m_linearVelocity.y+=e.m_invMass*p;e.m_angularVelocity+=e.m_invI*(r*p-a*f);i.m_linearVelocity.x+=i.m_invMass*m;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(c*v-l*m)}if(this.m_limitState1==g.e_atUpperLimit){h=e.m_linearVelocity.x+-e.m_angularVelocity*a;u=e.m_linearVelocity.y+e.m_angularVelocity*r;y=-(this.m_u1.x*h+this.m_u1.y*u);T=-this.m_limitMass1*y;C=this.m_limitImpulse1;this.m_limitImpulse1=s.Max(0,this.m_limitImpulse1+T);T=this.m_limitImpulse1-C;f=-T*this.m_u1.x;p=-T*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*f;e.m_linearVelocity.y+=e.m_invMass*p;e.m_angularVelocity+=e.m_invI*(r*p-a*f)}if(this.m_limitState2==g.e_atUpperLimit){d=i.m_linearVelocity.x+-i.m_angularVelocity*l;_=i.m_linearVelocity.y+i.m_angularVelocity*c;y=-(this.m_u2.x*d+this.m_u2.y*_);T=-this.m_limitMass2*y;C=this.m_limitImpulse2;this.m_limitImpulse2=s.Max(0,this.m_limitImpulse2+T);T=this.m_limitImpulse2-C;m=-T*this.m_u2.x;v=-T*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*m;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(c*v-l*m)}};A.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var c=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var h=0;var u=0;var d=0;var _=0;var f=0;var p=0;var m=0;var v=0;var y=0;var T=0;var C=0;var S=0;var x=0;var E=0;var b=0;var A=0;if(this.m_state==g.e_atUpperLimit){r=e.m_xf.R;h=this.m_localAnchor1.x-e.m_sweep.localCenter.x;u=this.m_localAnchor1.y-e.m_sweep.localCenter.y;b=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=b;r=n.m_xf.R;d=this.m_localAnchor2.x-n.m_sweep.localCenter.x;_=this.m_localAnchor2.y-n.m_sweep.localCenter.y;b=r.col1.x*d+r.col2.x*_;_=r.col1.y*d+r.col2.y*_;d=b;f=e.m_sweep.c.x+h;p=e.m_sweep.c.y+u;m=n.m_sweep.c.x+d;v=n.m_sweep.c.y+_;this.m_u1.Set(f-a,p-o);this.m_u2.Set(m-c,v-l);y=this.m_u1.Length();T=this.m_u2.Length();if(y>i.b2_linearSlop){this.m_u1.Multiply(1/y)}else{this.m_u1.SetZero()}if(T>i.b2_linearSlop){this.m_u2.Multiply(1/T)}else{this.m_u2.SetZero()}C=this.m_constant-y-this.m_ratio*T;A=s.Max(A,-C);C=s.Clamp(C+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);S=-this.m_pulleyMass*C;f=-S*this.m_u1.x;p=-S*this.m_u1.y;m=-this.m_ratio*S*this.m_u2.x;v=-this.m_ratio*S*this.m_u2.y;e.m_sweep.c.x+=e.m_invMass*f;e.m_sweep.c.y+=e.m_invMass*p;e.m_sweep.a+=e.m_invI*(h*p-u*f);n.m_sweep.c.x+=n.m_invMass*m;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(d*v-_*m);e.SynchronizeTransform();n.SynchronizeTransform()}if(this.m_limitState1==g.e_atUpperLimit){r=e.m_xf.R;h=this.m_localAnchor1.x-e.m_sweep.localCenter.x;u=this.m_localAnchor1.y-e.m_sweep.localCenter.y;b=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=b;f=e.m_sweep.c.x+h;p=e.m_sweep.c.y+u;this.m_u1.Set(f-a,p-o);y=this.m_u1.Length();if(y>i.b2_linearSlop){this.m_u1.x*=1/y;this.m_u1.y*=1/y}else{this.m_u1.SetZero()}C=this.m_maxLength1-y;A=s.Max(A,-C);C=s.Clamp(C+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);S=-this.m_limitMass1*C;f=-S*this.m_u1.x;p=-S*this.m_u1.y;e.m_sweep.c.x+=e.m_invMass*f;e.m_sweep.c.y+=e.m_invMass*p;e.m_sweep.a+=e.m_invI*(h*p-u*f);e.SynchronizeTransform()}if(this.m_limitState2==g.e_atUpperLimit){r=n.m_xf.R;d=this.m_localAnchor2.x-n.m_sweep.localCenter.x;_=this.m_localAnchor2.y-n.m_sweep.localCenter.y;b=r.col1.x*d+r.col2.x*_;_=r.col1.y*d+r.col2.y*_;d=b;m=n.m_sweep.c.x+d;v=n.m_sweep.c.y+_;this.m_u2.Set(m-c,v-l);T=this.m_u2.Length();if(T>i.b2_linearSlop){this.m_u2.x*=1/T;this.m_u2.y*=1/T}else{this.m_u2.SetZero()}C=this.m_maxLength2-T;A=s.Max(A,-C);C=s.Clamp(C+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);S=-this.m_limitMass2*C;m=-S*this.m_u2.x;v=-S*this.m_u2.y;n.m_sweep.c.x+=n.m_invMass*m;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(d*v-_*m);n.SynchronizeTransform()}return A<i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(R,Box2D.Dynamics.Joints.b2JointDef);R.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;R.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new c;this.groundAnchorB=new c;this.localAnchorA=new c;this.localAnchorB=new c};R.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};R.prototype.Initialize=function(t,e,i,n,r,s,a){if(a===undefined)a=0;this.bodyA=t;this.bodyB=e;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(n);this.localAnchorA=this.bodyA.GetLocalPoint(r);this.localAnchorB=this.bodyB.GetLocalPoint(s);var o=r.x-i.x;var c=r.y-i.y;this.lengthA=Math.sqrt(o*o+c*c);var l=s.x-n.x;var h=s.y-n.y;this.lengthB=Math.sqrt(l*l+h*h);this.ratio=a;var u=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=u-this.ratio*A.b2_minPulleyLength;this.maxLengthB=(u-A.b2_minPulleyLength)/this.ratio};Box2D.inherit(P,Box2D.Dynamics.Joints.b2Joint);P.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;P.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new l;this.impulse2=new c;this.reduced=new c;this.m_localAnchor1=new c;this.m_localAnchor2=new c;this.m_impulse=new l;this.m_mass=new r};P.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};P.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};P.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse.x,t*this.m_impulse.y)};P.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};P.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};P.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};P.prototype.IsLimitEnabled=function(){return this.m_enableLimit};P.prototype.EnableLimit=function(t){this.m_enableLimit=t};P.prototype.GetLowerLimit=function(){return this.m_lowerAngle};P.prototype.GetUpperLimit=function(){return this.m_upperAngle};P.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_lowerAngle=t;this.m_upperAngle=e};P.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};P.prototype.EnableMotor=function(t){this.m_enableMotor=t};P.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};P.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};P.prototype.SetMaxMotorTorque=function(t){if(t===undefined)t=0;this.m_maxMotorTorque=t};P.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};P.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=g.e_inactiveLimit};P.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var a=0;if(this.m_enableMotor||this.m_enableLimit){}r=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;a=r.col1.x*o+r.col2.x*c;c=r.col1.y*o+r.col2.y*c;o=a;r=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=r.col1.x*l+r.col2.x*h;h=r.col1.y*l+r.col2.y*h;l=a;var u=e.m_invMass;var d=n.m_invMass;var _=e.m_invI;var f=n.m_invI;this.m_mass.col1.x=u+d+c*c*_+h*h*f;this.m_mass.col2.x=-c*o*_-h*l*f;this.m_mass.col3.x=-c*_-h*f;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=u+d+o*o*_+l*l*f;this.m_mass.col3.y=o*_+l*f;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=_+f;this.m_motorMass=1/(_+f);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var p=n.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;if(s.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop){this.m_limitState=g.e_equalLimits}else if(p<=this.m_lowerAngle){if(this.m_limitState!=g.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=g.e_atLowerLimit}else if(p>=this.m_upperAngle){if(this.m_limitState!=g.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=g.e_atUpperLimit}else{this.m_limitState=g.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=g.e_inactiveLimit}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var m=this.m_impulse.x;var v=this.m_impulse.y;e.m_linearVelocity.x-=u*m;e.m_linearVelocity.y-=u*v;e.m_angularVelocity-=_*(o*v-c*m+this.m_motorImpulse+this.m_impulse.z);n.m_linearVelocity.x+=d*m;n.m_linearVelocity.y+=d*v;n.m_angularVelocity+=f*(l*v-h*m+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};P.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;var r=0;var a=0;var o=0;var c=0;var l=0;var h=0;var u=e.m_linearVelocity;var d=e.m_angularVelocity;var _=i.m_linearVelocity;var f=i.m_angularVelocity;var p=e.m_invMass;var m=i.m_invMass;var v=e.m_invI;var y=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var T=f-d-this.m_motorSpeed;var C=this.m_motorMass*-T;var S=this.m_motorImpulse;var x=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+C,-x,x);C=this.m_motorImpulse-S;d-=v*C;f+=y*C}if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){n=e.m_xf.R;o=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*c;c=n.col1.y*o+n.col2.y*c;o=r;n=i.m_xf.R;l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*l+n.col2.x*h;h=n.col1.y*l+n.col2.y*h;l=r;var E=_.x+-f*h-u.x- -d*c;var b=_.y+f*l-u.y-d*o;var A=f-d;this.m_mass.Solve33(this.impulse3,-E,-b,-A);if(this.m_limitState==g.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==g.e_atLowerLimit){a=this.m_impulse.z+this.impulse3.z;if(a<0){this.m_mass.Solve22(this.reduced,-E,-b);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==g.e_atUpperLimit){a=this.m_impulse.z+this.impulse3.z;if(a>0){this.m_mass.Solve22(this.reduced,-E,-b);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}u.x-=p*this.impulse3.x;u.y-=p*this.impulse3.y;d-=v*(o*this.impulse3.y-c*this.impulse3.x+this.impulse3.z);_.x+=m*this.impulse3.x;_.y+=m*this.impulse3.y;f+=y*(l*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{n=e.m_xf.R;o=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*c;c=n.col1.y*o+n.col2.y*c;o=r;n=i.m_xf.R;l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*l+n.col2.x*h;h=n.col1.y*l+n.col2.y*h;l=r;var R=_.x+-f*h-u.x- -d*c;var P=_.y+f*l-u.y-d*o;this.m_mass.Solve22(this.impulse2,-R,-P);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;u.x-=p*this.impulse2.x;u.y-=p*this.impulse2.y;d-=v*(o*this.impulse2.y-c*this.impulse2.x);_.x+=m*this.impulse2.x;_.y+=m*this.impulse2.y;f+=y*(l*this.impulse2.y-h*this.impulse2.x)}e.m_linearVelocity.SetV(u);e.m_angularVelocity=d;i.m_linearVelocity.SetV(_);i.m_angularVelocity=f};P.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=0;var r;var a=this.m_bodyA;var o=this.m_bodyB;var c=0;var l=0;var h=0;var u=0;var d=0;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var _=o.m_sweep.a-a.m_sweep.a-this.m_referenceAngle;var f=0;if(this.m_limitState==g.e_equalLimits){n=s.Clamp(_-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection);f=-this.m_motorMass*n;c=s.Abs(n)}else if(this.m_limitState==g.e_atLowerLimit){n=_-this.m_lowerAngle;c=-n;n=s.Clamp(n+i.b2_angularSlop,-i.b2_maxAngularCorrection,0);f=-this.m_motorMass*n}else if(this.m_limitState==g.e_atUpperLimit){n=_-this.m_upperAngle;c=n;n=s.Clamp(n-i.b2_angularSlop,0,i.b2_maxAngularCorrection);f=-this.m_motorMass*n}a.m_sweep.a-=a.m_invI*f;o.m_sweep.a+=o.m_invI*f;a.SynchronizeTransform();o.SynchronizeTransform()}{r=a.m_xf.R;var p=this.m_localAnchor1.x-a.m_sweep.localCenter.x;var m=this.m_localAnchor1.y-a.m_sweep.localCenter.y;h=r.col1.x*p+r.col2.x*m;m=r.col1.y*p+r.col2.y*m;p=h;r=o.m_xf.R;var v=this.m_localAnchor2.x-o.m_sweep.localCenter.x;var y=this.m_localAnchor2.y-o.m_sweep.localCenter.y;h=r.col1.x*v+r.col2.x*y;y=r.col1.y*v+r.col2.y*y;v=h;var T=o.m_sweep.c.x+v-a.m_sweep.c.x-p;var C=o.m_sweep.c.y+y-a.m_sweep.c.y-m;var S=T*T+C*C;var x=Math.sqrt(S);l=x;var E=a.m_invMass;var b=o.m_invMass;var A=a.m_invI;var R=o.m_invI;var w=10*i.b2_linearSlop;if(S>w*w){var I=T/x;var D=C/x;var L=E+b;var O=1/L;u=O*-T;d=O*-C;var B=.5;a.m_sweep.c.x-=B*E*u;a.m_sweep.c.y-=B*E*d;o.m_sweep.c.x+=B*b*u;o.m_sweep.c.y+=B*b*d;T=o.m_sweep.c.x+v-a.m_sweep.c.x-p;C=o.m_sweep.c.y+y-a.m_sweep.c.y-m}this.K1.col1.x=E+b;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=E+b;this.K2.col1.x=A*m*m;this.K2.col2.x=-A*p*m;this.K2.col1.y=-A*p*m;this.K2.col2.y=A*p*p;this.K3.col1.x=R*y*y;this.K3.col2.x=-R*v*y;this.K3.col1.y=-R*v*y;this.K3.col2.y=R*v*v;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(P.tImpulse,-T,-C);u=P.tImpulse.x;d=P.tImpulse.y;a.m_sweep.c.x-=a.m_invMass*u;a.m_sweep.c.y-=a.m_invMass*d;a.m_sweep.a-=a.m_invI*(p*d-m*u);o.m_sweep.c.x+=o.m_invMass*u;o.m_sweep.c.y+=o.m_invMass*d;o.m_sweep.a+=o.m_invI*(v*d-y*u);a.SynchronizeTransform();o.SynchronizeTransform()}return l<=i.b2_linearSlop&&c<=i.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new c});Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;w.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c};w.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};w.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new c;
this.m_localAnchorB=new c;this.m_impulse=new l;this.m_mass=new r};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};I.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new c(t*this.m_impulse.x,t*this.m_impulse.y)};I.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};I.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new r};I.prototype.InitVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var s=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*a;a=e.col1.y*s+e.col2.y*a;s=i;e=r.m_xf.R;var o=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var c=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*o+e.col2.x*c;c=e.col1.y*o+e.col2.y*c;o=i;var l=n.m_invMass;var h=r.m_invMass;var u=n.m_invI;var d=r.m_invI;this.m_mass.col1.x=l+h+a*a*u+c*c*d;this.m_mass.col2.x=-a*s*u-c*o*d;this.m_mass.col3.x=-a*u-c*d;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=l+h+s*s*u+o*o*d;this.m_mass.col3.y=s*u+o*d;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=u+d;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;n.m_linearVelocity.x-=l*this.m_impulse.x;n.m_linearVelocity.y-=l*this.m_impulse.y;n.m_angularVelocity-=u*(s*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z);r.m_linearVelocity.x+=h*this.m_impulse.x;r.m_linearVelocity.y+=h*this.m_impulse.y;r.m_angularVelocity+=d*(o*this.m_impulse.y-c*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};I.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var s=n.m_linearVelocity;var a=n.m_angularVelocity;var o=r.m_linearVelocity;var c=r.m_angularVelocity;var h=n.m_invMass;var u=r.m_invMass;var d=n.m_invI;var _=r.m_invI;e=n.m_xf.R;var f=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var p=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*f+e.col2.x*p;p=e.col1.y*f+e.col2.y*p;f=i;e=r.m_xf.R;var m=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var g=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*m+e.col2.x*g;g=e.col1.y*m+e.col2.y*g;m=i;var v=o.x-c*g-s.x+a*p;var y=o.y+c*m-s.y-a*f;var T=c-a;var C=new l;this.m_mass.Solve33(C,-v,-y,-T);this.m_impulse.Add(C);s.x-=h*C.x;s.y-=h*C.y;a-=d*(f*C.y-p*C.x+C.z);o.x+=u*C.x;o.y+=u*C.y;c+=_*(m*C.y-g*C.x+C.z);n.m_angularVelocity=a;r.m_angularVelocity=c};I.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;var n=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var c=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*o+e.col2.x*c;c=e.col1.y*o+e.col2.y*c;o=n;e=a.m_xf.R;var h=this.m_localAnchorB.x-a.m_sweep.localCenter.x;var u=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=e.col1.x*h+e.col2.x*u;u=e.col1.y*h+e.col2.y*u;h=n;var d=r.m_invMass;var _=a.m_invMass;var f=r.m_invI;var p=a.m_invI;var m=a.m_sweep.c.x+h-r.m_sweep.c.x-o;var g=a.m_sweep.c.y+u-r.m_sweep.c.y-c;var v=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var y=10*i.b2_linearSlop;var T=Math.sqrt(m*m+g*g);var C=s.Abs(v);if(T>y){f*=1;p*=1}this.m_mass.col1.x=d+_+c*c*f+u*u*p;this.m_mass.col2.x=-c*o*f-u*h*p;this.m_mass.col3.x=-c*f-u*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=d+_+o*o*f+h*h*p;this.m_mass.col3.y=o*f+h*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=f+p;var S=new l;this.m_mass.Solve33(S,-m,-g,-v);r.m_sweep.c.x-=d*S.x;r.m_sweep.c.y-=d*S.y;r.m_sweep.a-=f*(o*S.y-c*S.x+S.z);a.m_sweep.c.x+=_*S.x;a.m_sweep.c.y+=_*S.y;a.m_sweep.a+=p*(h*S.y-u*S.x+S.z);r.SynchronizeTransform();a.SynchronizeTransform();return T<=i.b2_linearSlop&&C<=i.b2_angularSlop};Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new c;this.localAnchorB=new c};D.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=g.e_weldJoint;this.referenceAngle=0};D.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){if(t===undefined)t=0;this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){if(t===undefined)t=0;this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){if(t===undefined)t=0;this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){if(t===undefined)t=0;this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){if(t===undefined)t=0;this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){if(t===undefined)t=0;this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){if(t===undefined)t=0;this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){if(t===undefined)t=0;this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.moveTo(t[0].x*r,t[0].y*r);for(var s=1;s<e;s++){n.lineTo(t[s].x*r,t[s].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.stroke()};t.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.fillStyle=this._color(i.color,this.m_fillAlpha);n.moveTo(t[0].x*r,t[0].y*r);for(var s=1;s<e;s++){n.lineTo(t[s].x*r,t[s].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.fill();n.stroke()};t.prototype.DrawCircle=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.arc(t.x*r,t.y*r,e*r,0,Math.PI*2,true);n.closePath();n.stroke()};t.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;var r=this.m_ctx,s=this.m_drawScale,a=t.x*s,o=t.y*s;r.moveTo(0,0);r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.fillStyle=this._color(n.color,this.m_fillAlpha);r.arc(a,o,e*s,0,Math.PI*2,true);r.moveTo(a,o);r.lineTo((t.x+i.x*e)*s,(t.y+i.y*e)*s);r.closePath();r.fill();r.stroke()};t.prototype.DrawSegment=function(t,e,i){var n=this.m_ctx,r=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha);n.beginPath();n.moveTo(t.x*r,t.y*r);n.lineTo(e.x*r,e.y*r);n.closePath();n.stroke()};t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(16711680,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i);e.strokeStyle=this._color(65280,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i);e.closePath();e.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;if(typeof require!=="undefined"&&typeof module!=="undefined"){module.exports=Box2D}(function(){Object.create=Object.create||function(t){function e(){}e.prototype=t;return new e};var t;if(typeof exports==="undefined"){t={};if(typeof window==="object"){window["cp"]=t}}else{t=exports}var e=function(t,e){if(!t){throw new Error("Assertion failed: "+e)}};var i=function(t,e){if(!t&&console&&console.warn){console.warn("ASSERTION FAILED: "+e);if(console.trace){console.trace()}}};var n=function(t,e){return t<e?t:e};var r=function(t,e){return t>e?t:e};var s,a;if(typeof window==="object"&&window.navigator.userAgent.indexOf("Firefox")>-1){s=Math.min;a=Math.max}else{s=n;a=r}var o=function(t,e){return t<e?t+" "+e:e+" "+t};var c=function(t,e){for(var i=0;i<t.length;i++){if(t[i]===e){t[i]=t[t.length-1];t.length--;return}}};var l=function(t,e,i){var n=R(e,i);var r=m(C(n,R(t,i))/M(n));return A(i,w(n,r))};var h=function(t,e,i,n,r,s){var a=i-r;var o=n-s;var c=m(S(a,o,t-r,e-s)/V(a,o));return new y(r+a*c,s+o*c)};t.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+M(n))};t.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)};t.momentForSegment=function(t,e,i){var n=w(A(e,i),.5);return t*(X(i,e)/12+M(n))};t.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*Y(t,e))};t.momentForPoly=function(t,e,i){var n=0;var r=0;var s=e.length;for(var a=0;a<s;a+=2){var o=e[a]+i.x;var c=e[a+1]+i.y;var l=e[(a+2)%s]+i.x;var h=e[(a+3)%s]+i.y;var u=D(l,h,o,c);var d=S(o,c,o,c)+S(o,c,l,h)+S(l,h,l,h);n+=u*d;r+=u}return t*n/(6*r)};t.areaForPoly=function(t){var e=0;for(var i=0,n=t.length;i<n;i+=2){e+=I(new y(t[i],t[i+1]),new y(t[(i+2)%n],t[(i+3)%n]))}return-e/2};t.centroidForPoly=function(t){var e=0;var i=new y(0,0);for(var n=0,r=t.length;n<r;n+=2){var s=new y(t[n],t[n+1]);var a=new y(t[(n+2)%r],t[(n+3)%r]);var o=I(s,a);e+=o;i=A(i,w(A(s,a),o))}return w(i,1/(3*e))};t.recenterPoly=function(e){var i=t.centroidForPoly(e);for(var n=0;n<e.length;n+=2){e[n]-=i.x;e[n+1]-=i.y}};t.momentForBox=function(t,e,i){return t*(e*e+i*i)/12};t.momentForBox2=function(e,i){var n=i.r-i.l;var r=i.t-i.b;var s=w([i.l+i.r,i.b+i.t],.5);return t.momentForBox(e,n,r)+e*M(s)};var u=t.loopIndexes=function(t){var e=0,i=0;var n,r,s,a;n=s=t[0];r=a=t[1];var o=t.length>>1;for(var c=1;c<o;c++){var l=t[c*2];var h=t[c*2+1];if(l<n||l==n&&h<r){n=l;r=h;e=c}else if(l>s||l==s&&h>a){s=l;a=h;i=c}}return[e,i]};var d=function(t,e,i){var n=t[e*2];t[e*2]=t[i*2];t[i*2]=n;n=t[e*2+1];t[e*2+1]=t[i*2+1];t[i*2+1]=n};var _=function(t,e,i,n,r,s){if(i===0)return 0;var a=0;var o=e;var c=R(r,n);var l=s*x(c);var h=e;for(var u=e+i-1;h<=u;){var _=new y(t[h*2],t[h*2+1]);var f=I(c,R(_,n));if(f>l){if(f>a){a=f;o=h}h++}else{d(t,h,u);u--}}if(o!=e)d(t,e,o);return h-e};var f=function(t,e,i,n,r,s,a,o){if(n<0){return 0}else if(n==0){e[o*2]=s.x;e[o*2+1]=s.y;return 1}else{var c=_(e,i,n,r,s,t);var l=new y(e[i*2],e[i*2+1]);var h=f(t,e,i+1,c-1,r,l,s,o);var u=o+h++;e[u*2]=s.x;e[u*2+1]=s.y;var d=_(e,i+c,n-c,s,a,t);var p=new y(e[(i+c)*2],e[(i+c)*2+1]);return h+f(t,e,i+c+1,d-1,s,p,a,o+h)}};t.convexHull=function(t,e,n){if(e){for(var r=0;r<t.length;r++){e[r]=t[r]}}else{e=t}var s=u(t);var a=s[0],o=s[1];if(a==o){e.length=2;return e}d(e,0,a);d(e,1,o==0?a:o);var c=new y(e[0],e[1]);var l=new y(e[2],e[3]);var h=t.length>>1;var _=f(n,e,2,h-2,c,l,c,1)+1;e.length=_*2;i(Et(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree."+"Please report this error with as much info as you can.");return e};var p=function(t,e,i){return s(a(t,e),i)};var m=function(t){return a(0,s(t,1))};var g=function(t,e,i){return t*(1-i)+e*i};var v=function(t,e,i){return t+p(e-t,-i,i)};var y=t.Vect=function(t,e){this.x=t;this.y=e};t.v=function(t,e){return new y(t,e)};var T=t.vzero=new y(0,0);var C=t.v.dot=function(t,e){return t.x*e.x+t.y*e.y};var S=function(t,e,i,n){return t*i+e*n};var x=t.v.len=function(t){return Math.sqrt(C(t,t))};var E=t.v.len2=function(t,e){return Math.sqrt(t*t+e*e)};var b=t.v.eql=function(t,e){return t.x===e.x&&t.y===e.y};var A=t.v.add=function(t,e){return new y(t.x+e.x,t.y+e.y)};y.prototype.add=function(t){this.x+=t.x;this.y+=t.y;return this};var R=t.v.sub=function(t,e){return new y(t.x-e.x,t.y-e.y)};y.prototype.sub=function(t){this.x-=t.x;this.y-=t.y;return this};var P=t.v.neg=function(t){return new y(-t.x,-t.y)};y.prototype.neg=function(){this.x=-this.x;this.y=-this.y;return this};var w=t.v.mult=function(t,e){return new y(t.x*e,t.y*e)};y.prototype.mult=function(t){this.x*=t;this.y*=t;return this};var I=t.v.cross=function(t,e){return t.x*e.y-t.y*e.x};var D=function(t,e,i,n){return t*n-e*i};var L=t.v.perp=function(t){return new y(-t.y,t.x)};var O=t.v.pvrperp=function(t){return new y(t.y,-t.x)};var B=t.v.project=function(t,e){return w(e,C(t,e)/M(e))};y.prototype.project=function(t){this.mult(C(this,t)/M(t));return this};var F=t.v.rotate=function(t,e){return new y(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};y.prototype.rotate=function(t){this.x=this.x*t.x-this.y*t.y;this.y=this.x*t.y+this.y*t.x;return this};var N=t.v.unrotate=function(t,e){return new y(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)};var M=t.v.lengthsq=function(t){return C(t,t)};var V=t.v.lengthsq2=function(t,e){return t*t+e*e};var k=t.v.lerp=function(t,e,i){return A(w(t,1-i),w(e,i))};var W=t.v.normalize=function(t){return w(t,1/x(t))};var G=t.v.normalize_safe=function(t){return t.x===0&&t.y===0?T:W(t)};var z=t.v.clamp=function(t,e){return C(t,t)>e*e?w(W(t),e):t};var U=t.v.lerpconst=function(t,e,i){return A(t,z(R(e,t),i))};var Y=t.v.dist=function(t,e){return x(R(t,e))};var X=t.v.distsq=function(t,e){return M(R(t,e))};var H=t.v.near=function(t,e,i){return X(t,e)<i*i};var j=t.v.slerp=function(t,e,i){var n=Math.acos(C(t,e));if(n){var r=1/Math.sin(n);return A(w(t,Math.sin((1-i)*n)*r),w(e,Math.sin(i*n)*r))}else{return t}};var q=t.v.slerpconst=function(t,e,i){var n=Math.acos(C(t,e));return j(t,e,s(i,n)/n)};var J=t.v.forangle=function(t){return new y(Math.cos(t),Math.sin(t))};var Z=t.v.toangle=function(t){return Math.atan2(t.y,t.x)};var K=t.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"};var Q=0;var $=t.BB=function(t,e,i,n){this.l=t;this.b=e;this.r=i;this.t=n;Q++};t.bb=function(t,e,i,n){return new $(t,e,i,n)};var tt=function(t,e){return new $(t.x-e,t.y-e,t.x+e,t.y+e)};var et=function(t,e){return t.l<=e.r&&e.l<=t.r&&t.b<=e.t&&e.b<=t.t};var it=function(t,e,i,n,r){return t.l<=n&&e<=t.r&&t.b<=r&&i<=t.t};var nt=function(t,e){return t.l<=e.l&&t.r>=e.r&&t.b<=e.b&&t.t>=e.t};var rt=function(t,e){return t.l<=e.x&&t.r>=e.x&&t.b<=e.y&&t.t>=e.y};var st=function(t,e,i,n,r){return t<=r.x&&i>=r.x&&e<=r.y&&n>=r.y};var at=function(t,e){return new $(s(t.l,e.l),s(t.b,e.b),a(t.r,e.r),a(t.t,e.t))};var ot=function(t,e){return new $(s(t.l,e.x),s(t.b,e.y),a(t.r,e.x),a(t.t,e.y))};var ct=function(t){return(t.r-t.l)*(t.t-t.b)};var lt=function(t,e){return(a(t.r,e.r)-s(t.l,e.l))*(a(t.t,e.t)-s(t.b,e.b))};var ht=function(t,e,i,n,r){return(a(t.r,n)-s(t.l,e))*(a(t.t,r)-s(t.b,i))};var ut=function(t,e,i){return bbSegmentQuery(t,e,i)!=Infinity};var dt=function(t,e){var i=s(a(t.l,e.x),t.r);var n=s(a(t.b,e.y),t.t);return new y(i,n)};var _t=function(t,e){var i=Math.abs(t.r-t.l);var n=(e.x-t.l)%i;var r=n>0?n:n+i;var s=Math.abs(t.t-t.b);var a=(e.y-t.b)%s;var o=a>0?a:a+s;return new y(r+t.l,o+t.b)};var ft=0;var pt=t.NO_GROUP=0;var mt=t.ALL_LAYERS=~0;t.resetShapeIdCounter=function(){ft=0};var gt=t.Shape=function(t){this.body=t;this.bb_l=this.bb_b=this.bb_r=this.bb_t=0;this.hashid=ft++;this.sensor=false;this.e=0;this.u=0;this.surface_v=T;this.collision_type=0;this.group=0;this.layers=mt;this.space=null;this.collisionCode=this.collisionCode};gt.prototype.setElasticity=function(t){this.e=t};gt.prototype.setFriction=function(t){this.body.activate();this.u=t};gt.prototype.setLayers=function(t){this.body.activate();this.layers=t};gt.prototype.setSensor=function(t){this.body.activate();this.sensor=t};gt.prototype.setCollisionType=function(t){this.body.activate();this.collision_type=t};gt.prototype.getBody=function(){return this.body};gt.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1};gt.prototype.setBody=function(t){e(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body.");this.body=t};gt.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)};gt.prototype.update=function(t,i){e(!isNaN(i.x),"Rotation is NaN");e(!isNaN(t.x),"Position is NaN");this.cacheData(t,i)};gt.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e};gt.prototype.getBB=function(){return new $(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var vt=function(t){this.shape=t;this.d=Infinity;this.n=T};var yt=function(t,e,i){this.shape=t;this.p=e;this.d=i};var Tt=function(t,e,i){this.shape=t;this.t=e;this.n=i};Tt.prototype.hitPoint=function(t,e){return k(t,e,this.t)};Tt.prototype.hitDist=function(t,e){return Y(t,e)*this.t};var Ct=t.CircleShape=function(t,e,i){this.c=this.tc=i;this.r=e;this.type="circle";gt.call(this,t)};Ct.prototype=Object.create(gt.prototype);Ct.prototype.cacheData=function(t,e){var i=this.tc=F(this.c,e).add(t);var n=this.r;this.bb_l=i.x-n;this.bb_b=i.y-n;this.bb_r=i.x+n;this.bb_t=i.y+n};Ct.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x;var i=t.y-this.tc.y;var n=E(e,i);var r=this.r;var s=new y(this.tc.x+e*r/n,this.tc.y+i*r/n);return new yt(this,s,n-r)};var St=function(t,e,i,n,r,s){n=R(n,e);r=R(r,e);var a=C(n,n)-2*C(n,r)+C(r,r);var o=-2*C(n,n)+2*C(n,r);var c=C(n,n)-i*i;var l=o*o-4*a*c;if(l>=0){var h=(-o-Math.sqrt(l))/(2*a);if(0<=h&&h<=1){return new Tt(t,h,W(k(n,r,h)))}}};Ct.prototype.segmentQuery=function(t,e){return St(this,this.tc,this.r,t,e)};var xt=t.SegmentShape=function(t,e,i,n){this.a=e;this.b=i;this.n=L(W(R(i,e)));this.ta=this.tb=this.tn=null;this.r=n;this.a_tangent=T;this.b_tangent=T;this.type="segment";gt.call(this,t)};xt.prototype=Object.create(gt.prototype);xt.prototype.cacheData=function(t,e){this.ta=A(t,F(this.a,e));this.tb=A(t,F(this.b,e));this.tn=F(this.n,e);var i,n,r,s;if(this.ta.x<this.tb.x){i=this.ta.x;n=this.tb.x}else{i=this.tb.x;n=this.ta.x}if(this.ta.y<this.tb.y){r=this.ta.y;s=this.tb.y}else{r=this.tb.y;s=this.ta.y}var a=this.r;this.bb_l=i-a;this.bb_b=r-a;this.bb_r=n+a;this.bb_t=s+a};xt.prototype.nearestPointQuery=function(t){var e=l(t,this.ta,this.tb);var i=t.x-e.x;var n=t.y-e.y;var r=E(i,n);var s=this.r;var a=r?A(e,w(new y(i,n),s/r)):e;return new yt(this,a,r-s)};xt.prototype.segmentQuery=function(t,e){var i=this.tn;var n=C(R(this.ta,t),i);var r=this.r;var s=n>0?P(i):i;var a=R(w(s,r),t);var o=A(this.ta,a);var c=A(this.tb,a);var l=R(e,t);if(I(l,o)*I(l,c)<=0){var h=n+(n>0?-r:r);var u=-h;var d=C(l,i)-h;if(u*d<0){return new Tt(this,u/(u-d),s)}}else if(r!==0){var _=St(this,this.ta,this.r,t,e);var f=St(this,this.tb,this.r,t,e);if(_){return f&&f.t<_.t?f:_}else{return f}}};xt.prototype.setNeighbors=function(t,e){this.a_tangent=R(t,this.a);this.b_tangent=R(e,this.b)};xt.prototype.setEndpoints=function(t,e){this.a=t;this.b=e;this.n=L(W(R(e,t)))};var Et=function(t){var e=t.length;for(var i=0;i<e;i+=2){var n=t[i];var r=t[i+1];var s=t[(i+2)%e];var a=t[(i+3)%e];var o=t[(i+4)%e];var c=t[(i+5)%e];if(D(s-n,a-r,o-s,c-a)>0){return false}}return true};var bt=t.PolyShape=function(t,e,i){this.setVerts(e,i);this.type="poly";gt.call(this,t)};bt.prototype=Object.create(gt.prototype);var At=function(t,e){this.n=t;this.d=e};At.prototype.compare=function(t){return C(this.n,t)-this.d};bt.prototype.setVerts=function(t,i){e(t.length>=4,"Polygons require some verts");e(typeof t[0]==="number","Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])");e(Et(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var n=t.length;var r=n>>1;this.verts=new Array(n);this.tVerts=new Array(n);this.planes=new Array(r);this.tPlanes=new Array(r);for(var s=0;s<n;s+=2){var a=t[s]+i.x;var o=t[s+1]+i.y;var c=t[(s+2)%n]+i.x;var l=t[(s+3)%n]+i.y;var h=W(L(new y(c-a,l-o)));this.verts[s]=a;this.verts[s+1]=o;this.planes[s>>1]=new At(h,S(h.x,h.y,a,o));this.tPlanes[s>>1]=new At(new y(0,0),0)}};var Rt=t.BoxShape=function(t,e,i){var n=e/2;var r=i/2;return Pt(t,new $(-n,-r,n,r))};var Pt=t.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new bt(t,i,T)};bt.prototype.transformVerts=function(t,e){var i=this.verts;var n=this.tVerts;var r=Infinity,o=-Infinity;var c=Infinity,l=-Infinity;for(var h=0;h<i.length;h+=2){var u=i[h];var d=i[h+1];var _=t.x+u*e.x-d*e.y;var f=t.y+u*e.y+d*e.x;n[h]=_;n[h+1]=f;r=s(r,_);o=a(o,_);c=s(c,f);l=a(l,f)}this.bb_l=r;this.bb_b=c;this.bb_r=o;this.bb_t=l};bt.prototype.transformAxes=function(t,e){var i=this.planes;var n=this.tPlanes;for(var r=0;r<i.length;r++){var s=F(i[r].n,e);n[r].n=s;n[r].d=C(t,s)+i[r].d}};bt.prototype.cacheData=function(t,e){this.transformAxes(t,e);this.transformVerts(t,e)};bt.prototype.nearestPointQuery=function(t){var e=this.tPlanes;var i=this.tVerts;var n=i[i.length-2];var r=i[i.length-1];var s=Infinity;var a=T;var o=false;for(var c=0;c<e.length;c++){if(e[c].compare(t)>0)o=true;var l=i[c*2];var u=i[c*2+1];var d=h(t.x,t.y,n,r,l,u);var _=Y(t,d);if(_<s){s=_;a=d}n=l;r=u}return new yt(this,a,o?s:-s)};bt.prototype.segmentQuery=function(t,e){var i=this.tPlanes;var n=this.tVerts;var r=i.length;var s=r*2;for(var a=0;a<r;a++){var o=i[a].n;var c=C(t,o);if(i[a].d>c)continue;var l=C(e,o);var h=(i[a].d-c)/(l-c);if(h<0||1<h)continue;var u=k(t,e,h);var d=-I(o,u);var _=-D(o.x,o.y,n[a*2],n[a*2+1]);var f=-D(o.x,o.y,n[(a*2+2)%s],n[(a*2+3)%s]);if(_<=d&&d<=f){return new Tt(this,h,o)}}};bt.prototype.valueOnAxis=function(t,e){var i=this.tVerts;var n=S(t.x,t.y,i[0],i[1]);for(var r=2;r<i.length;r+=2){n=s(n,S(t.x,t.y,i[r],i[r+1]))}return n-e};bt.prototype.containsVert=function(t,e){var i=this.tPlanes;for(var n=0;n<i.length;n++){var r=i[n].n;var s=S(r.x,r.y,t,e)-i[n].d;if(s>0)return false}return true};bt.prototype.containsVertPartial=function(t,e,i){var n=this.tPlanes;for(var r=0;r<n.length;r++){var s=n[r].n;if(C(s,i)<0)continue;var a=S(s.x,s.y,t,e)-n[r].d;if(a>0)return false}return true};bt.prototype.getNumVerts=function(){return this.verts.length/2};bt.prototype.getVert=function(t){return new y(this.verts[t*2],this.verts[t*2+1])};var wt=t.Body=function(t,e){this.p=new y(0,0);this.vx=this.vy=0;this.f=new y(0,0);this.w=0;this.t=0;this.v_limit=Infinity;this.w_limit=Infinity;this.v_biasx=this.v_biasy=0;this.w_bias=0;this.space=null;this.shapeList=[];this.arbiterList=null;this.constraintList=null;this.nodeRoot=null;this.nodeNext=null;this.nodeIdleTime=0;this.setMass(t);this.setMoment(e);this.rot=new y(0,0);this.setAngle(0)};var It=function(){var t=new wt(Infinity,Infinity);t.nodeIdleTime=Infinity;return t};t.StaticBody=It;if(typeof DEBUG!=="undefined"&&DEBUG){var Dt=function(t,i){e(t.x==t.x&&t.y==t.y,i)};var Lt=function(t,i){e(Math.abs(t.x)!==Infinity&&Math.abs(t.y)!==Infinity,i)};var Ot=function(t,e){Dt(t,e);Lt(t,e)};wt.prototype.sanityCheck=function(){e(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid.");e(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid.");Ot(this.p,"Body's position is invalid.");Ot(this.f,"Body's force is invalid.");e(this.vx===this.vx&&Math.abs(this.vx)!==Infinity,"Body's velocity is invalid.");e(this.vy===this.vy&&Math.abs(this.vy)!==Infinity,"Body's velocity is invalid.");e(this.a===this.a&&Math.abs(this.a)!==Infinity,"Body's angle is invalid.");e(this.w===this.w&&Math.abs(this.w)!==Infinity,"Body's angular velocity is invalid.");e(this.t===this.t&&Math.abs(this.t)!==Infinity,"Body's torque is invalid.");Ot(this.rot,"Body's rotation vector is invalid.");e(this.v_limit===this.v_limit,"Body's velocity limit is invalid.");e(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else{wt.prototype.sanityCheck=function(){}}wt.prototype.getPos=function(){return this.p};wt.prototype.getVel=function(){return new y(this.vx,this.vy)};wt.prototype.getAngVel=function(){return this.w};wt.prototype.isSleeping=function(){return this.nodeRoot!==null};wt.prototype.isStatic=function(){return this.nodeIdleTime===Infinity};wt.prototype.isRogue=function(){return this.space===null};wt.prototype.setMass=function(t){e(t>0,"Mass must be positive and non-zero.");this.activate();this.m=t;this.m_inv=1/t};wt.prototype.setMoment=function(t){e(t>0,"Moment of Inertia must be positive and non-zero.");this.activate();this.i=t;this.i_inv=1/t};wt.prototype.addShape=function(t){this.shapeList.push(t)};wt.prototype.removeShape=function(t){c(this.shapeList,t)};var Bt=function(t,e,i){if(t===i){return t.next(e)}else if(t.a===e){t.next_a=Bt(t.next_a,e,i)}else{t.next_b=Bt(t.next_b,e,i)}return t};wt.prototype.removeConstraint=function(t){this.constraintList=Bt(this.constraintList,this,t)};wt.prototype.setPos=function(e){this.activate();this.sanityCheck();if(e===T){e=t.v(0,0)}this.p=e};wt.prototype.setVel=function(t){this.activate();this.vx=t.x;this.vy=t.y};wt.prototype.setAngVel=function(t){this.activate();this.w=t};wt.prototype.setAngleInternal=function(t){e(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN");this.a=t;this.rot.x=Math.cos(t);this.rot.y=Math.sin(t)};wt.prototype.setAngle=function(t){this.activate();this.sanityCheck();this.setAngleInternal(t)};wt.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i;var r=this.vy*e+(t.y+this.f.y*this.m_inv)*i;var s=this.v_limit;var a=n*n+r*r;var o=a>s*s?s/Math.sqrt(a):1;this.vx=n*o;this.vy=r*o;var c=this.w_limit;this.w=p(this.w*e+this.t*this.i_inv*i,-c,c);this.sanityCheck()};wt.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t;this.p.y+=(this.vy+this.v_biasy)*t;this.setAngleInternal(this.a+(this.w+this.w_bias)*t);this.v_biasx=this.v_biasy=0;this.w_bias=0;this.sanityCheck()};wt.prototype.resetForces=function(){this.activate();this.f=new y(0,0);this.t=0};wt.prototype.applyForce=function(t,e){this.activate();this.f=A(this.f,t);this.t+=I(e,t)};wt.prototype.applyImpulse=function(t,e){this.activate();Me(this,t.x,t.y,e)};wt.prototype.getVelAtPoint=function(t){return A(new y(this.vx,this.vy),w(L(t),this.w))};wt.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(R(t,this.p))};wt.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(F(t,this.rot))};wt.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++){t(this.shapeList[e])}};wt.prototype.eachConstraint=function(t){var e=this.constraintList;while(e){var i=e.next(this);t(e);e=i}};wt.prototype.eachArbiter=function(t){var e=this.arbiterList;while(e){var i=e.next(this);e.swappedColl=this===e.body_b;t(e);e=i}};wt.prototype.local2World=function(t){return A(this.p,F(t,this.rot))};wt.prototype.world2Local=function(t){return N(R(t,this.p),this.rot)};wt.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy;var e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var Ft=t.SpatialIndex=function(t){this.staticIndex=t;if(t){if(t.dynamicIndex){throw new Error("This static index is already associated with a dynamic index.")}t.dynamicIndex=this}};Ft.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new $(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var Nt=t.BBTree=function(t){Ft.call(this,t);this.velocityFunc=null;this.leaves={};this.count=0;this.root=null;this.pooledNodes=null;this.pooledPairs=null;this.stamp=0};Nt.prototype=Object.create(Ft.prototype);var Mt=0;var Vt=function(t,e,i){this.obj=null;this.bb_l=s(e.bb_l,i.bb_l);this.bb_b=s(e.bb_b,i.bb_b);this.bb_r=a(e.bb_r,i.bb_r);this.bb_t=a(e.bb_t,i.bb_t);this.parent=null;this.setA(e);this.setB(i)};Nt.prototype.makeNode=function(t,e){var i=this.pooledNodes;if(i){this.pooledNodes=i.parent;i.constructor(this,t,e);return i}else{Mt++;return new Vt(this,t,e)}};var kt=0;var Wt=function(t,e){this.obj=e;t.getBB(e,this);this.parent=null;this.stamp=1;this.pairs=null;kt++};Nt.prototype.getBB=function(t,e){var i=this.velocityFunc;if(i){var n=.1;var r=(t.bb_r-t.bb_l)*n;var o=(t.bb_t-t.bb_b)*n;var c=w(i(t),.1);e.bb_l=t.bb_l+s(-r,c.x);e.bb_b=t.bb_b+s(-o,c.y);e.bb_r=t.bb_r+a(r,c.x);e.bb_t=t.bb_t+a(o,c.y)}else{e.bb_l=t.bb_l;e.bb_b=t.bb_b;e.bb_r=t.bb_r;e.bb_t=t.bb_t}};Nt.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp};Nt.prototype.incrementStamp=function(){if(this.dynamicIndex&&this.dynamicIndex.stamp){this.dynamicIndex.stamp++}else{this.stamp++}};var Gt=0;var zt=function(t,e,i,n){this.prevA=null;this.leafA=t;this.nextA=e;this.prevB=null;this.leafB=i;this.nextB=n};Nt.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;if(r){this.pooledPairs=r.prevA;r.prevA=null;r.leafA=t;r.nextA=e;r.prevB=null;r.leafB=i;r.nextB=n;return r}else{Gt++;return new zt(t,e,i,n)}};zt.prototype.recycle=function(t){this.prevA=t.pooledPairs;t.pooledPairs=this};var Ut=function(t,e,i){if(i){if(i.leafA===e)i.prevA=t;else i.prevB=t}if(t){if(t.leafA===e)t.nextA=i;else t.nextB=i}else{e.pairs=i}};Wt.prototype.clearPairs=function(t){var e=this.pairs,i;this.pairs=null;while(e){if(e.leafA===this){i=e.nextA;Ut(e.prevB,e.leafB,e.nextB)}else{i=e.nextB;Ut(e.prevA,e.leafA,e.nextA)}e.recycle(t);e=i}};var Yt=function(t,e,i){var n=t.pairs,r=e.pairs;var s=i.makePair(t,n,e,r);t.pairs=e.pairs=s;if(n){if(n.leafA===t)n.prevA=s;else n.prevB=s}if(r){if(r.leafA===e)r.prevA=s;else r.prevB=s}};Vt.prototype.recycle=function(t){this.parent=t.pooledNodes;t.pooledNodes=this};Wt.prototype.recycle=function(t){};Vt.prototype.setA=function(t){this.A=t;t.parent=this};Vt.prototype.setB=function(t){this.B=t;t.parent=this};Wt.prototype.isLeaf=true;Vt.prototype.isLeaf=false;Vt.prototype.otherChild=function(t){return this.A==t?this.B:this.A};Vt.prototype.replaceChild=function(t,e,n){i(t==this.A||t==this.B,"Node is not a child of parent.");if(this.A==t){this.A.recycle(n);this.setA(e)}else{this.B.recycle(n);this.setB(e)}for(var r=this;r;r=r.parent){var o=r.A;var c=r.B;r.bb_l=s(o.bb_l,c.bb_l);r.bb_b=s(o.bb_b,c.bb_b);r.bb_r=a(o.bb_r,c.bb_r);r.bb_t=a(o.bb_t,c.bb_t)}};Vt.prototype.bbArea=Wt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var Xt=function(t,e){return(a(t.bb_r,e.bb_r)-s(t.bb_l,e.bb_l))*(a(t.bb_t,e.bb_t)-s(t.bb_b,e.bb_b))};var Ht=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)};var jt=function(t,e,i){if(t==null){return e}else if(t.isLeaf){return i.makeNode(e,t)}else{var n=t.B.bbArea()+Xt(t.A,e);var r=t.A.bbArea()+Xt(t.B,e);if(n===r){n=Ht(t.A,e);r=Ht(t.B,e)}if(r<n){t.setB(jt(t.B,e,i))}else{t.setA(jt(t.A,e,i))}t.bb_l=s(t.bb_l,e.bb_l);t.bb_b=s(t.bb_b,e.bb_b);t.bb_r=a(t.bb_r,e.bb_r);t.bb_t=a(t.bb_t,e.bb_t);return t}};Vt.prototype.intersectsBB=Wt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var qt=function(t,e,i){if(t.intersectsBB(e)){if(t.isLeaf){i(t.obj)}else{qt(t.A,e,i);qt(t.B,e,i)}}};var Jt=function(t,e,i){var n=1/(i.x-e.x);var r=t.bb_l==e.x?-Infinity:(t.bb_l-e.x)*n;var o=t.bb_r==e.x?Infinity:(t.bb_r-e.x)*n;var c=s(r,o);var l=a(r,o);var h=1/(i.y-e.y);var u=t.bb_b==e.y?-Infinity:(t.bb_b-e.y)*h;var d=t.bb_t==e.y?Infinity:(t.bb_t-e.y)*h;var _=s(u,d);var f=a(u,d);if(_<=l&&c<=f){var p=a(c,_);var m=s(l,f);if(0<=m&&p<=1)return a(p,0)}return Infinity};var Zt=function(t,e,i,n,r){if(t.isLeaf){return r(t.obj)}else{var a=Jt(t.A,e,i);var o=Jt(t.B,e,i);if(a<o){if(a<n)n=s(n,Zt(t.A,e,i,n,r));if(o<n)n=s(n,Zt(t.B,e,i,n,r))}else{if(o<n)n=s(n,Zt(t.B,e,i,n,r));if(a<n)n=s(n,Zt(t.A,e,i,n,r))}return n}};Nt.prototype.subtreeRecycle=function(t){if(t.isLeaf){this.subtreeRecycle(t.A);this.subtreeRecycle(t.B);t.recycle(this)}};var Kt=function(t,e,i){if(e==t){return null}else{var n=e.parent;if(n==t){var r=t.otherChild(e);r.parent=t.parent;t.recycle(i);return r}else{
n.parent.replaceChild(n,n.otherChild(e),i);return t}}};var Qt=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};Wt.prototype.markLeafQuery=function(t,e,i,n){if(Qt(t,this)){if(e){Yt(t,this,i)}else{if(this.stamp<t.stamp)Yt(this,t,i);if(n)n(t.obj,this.obj)}}};Vt.prototype.markLeafQuery=function(t,e,i,n){if(Qt(t,this)){this.A.markLeafQuery(t,e,i,n);this.B.markLeafQuery(t,e,i,n)}};Wt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){if(e)e.markLeafQuery(this,false,t,i);for(var n=this;n.parent;n=n.parent){if(n==n.parent.A){n.parent.B.markLeafQuery(this,true,t,i)}else{n.parent.A.markLeafQuery(this,false,t,i)}}}else{var r=this.pairs;while(r){if(this===r.leafB){if(i)i(r.leafA.obj,this.obj);r=r.nextB}else{r=r.nextA}}}};Vt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i);this.B.markSubtree(t,e,i)};Wt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t};Wt.prototype.update=function(t){var e=t.root;var i=this.obj;if(!this.containsObj(i)){t.getBB(this.obj,this);e=Kt(e,this,t);t.root=jt(e,this,t);this.clearPairs(t);this.stamp=t.getStamp();return true}return false};Wt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;if(i){i.markLeafQuery(this,true,e,null)}}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}};Nt.prototype.insert=function(t,e){var i=new Wt(this,t);this.leaves[e]=i;this.root=jt(this.root,i,this);this.count++;i.stamp=this.getStamp();i.addPairs(this);this.incrementStamp()};Nt.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e];this.root=Kt(this.root,i,this);this.count--;i.clearPairs(this);i.recycle(this)};Nt.prototype.contains=function(t,e){return this.leaves[e]!=null};var $t=function(t,e){};Nt.prototype.reindexQuery=function(t){if(!this.root)return;var e,i=this.leaves;for(e in i){i[e].update(this)}var n=this.staticIndex;var r=n&&n.root;this.root.markSubtree(this,r,t);if(n&&!r)this.collideStatic(this,n,t);this.incrementStamp()};Nt.prototype.reindex=function(){this.reindexQuery($t)};Nt.prototype.reindexObject=function(t,e){var i=this.leaves[e];if(i){if(i.update(this))i.addPairs(this);this.incrementStamp()}};Nt.prototype.pointQuery=function(t,e){this.query(new $(t.x,t.y,t.x,t.y),e)};Nt.prototype.segmentQuery=function(t,e,i,n){if(this.root)Zt(this.root,t,e,i,n)};Nt.prototype.query=function(t,e){if(this.root)qt(this.root,t,e)};Nt.prototype.count=function(){return this.count};Nt.prototype.each=function(t){var e;for(e in this.leaves){t(this.leaves[e].obj)}};var te=function(t,e,i,n,r){return(a(t.bb_r,n)-s(t.bb_l,e))*(a(t.bb_t,r)-s(t.bb_b,i))};var ee=function(t,e,i,n){if(n==1){return e[i]}else if(n==2){return t.makeNode(e[i],e[i+1])}var r=e[i];var o=r.bb_l,c=r.bb_b,l=r.bb_r,h=r.bb_t;var u=i+n;for(var d=i+1;d<u;d++){r=e[d];o=s(o,r.bb_l);c=s(c,r.bb_b);l=a(l,r.bb_r);h=a(h,r.bb_t)}var _=l-o>h-c;var f=new Array(n*2);if(_){for(var d=i;d<u;d++){f[2*d+0]=e[d].bb_l;f[2*d+1]=e[d].bb_r}}else{for(var d=i;d<u;d++){f[2*d+0]=e[d].bb_b;f[2*d+1]=e[d].bb_t}}f.sort(function(t,e){return t-e});var p=(f[n-1]+f[n])*.5;var m=o,g=c,v=l,y=h;var T=o,C=c,S=l,x=h;if(_)v=T=p;else y=C=p;var E=u;for(var b=i;b<E;){var r=e[b];if(te(r,T,C,S,x)<te(r,m,g,v,y)){E--;e[b]=e[E];e[E]=r}else{b++}}if(E==n){var r=null;for(var d=i;d<u;d++)r=jt(r,e[d],t);return r}return NodeNew(t,ee(t,e,i,E-i),ee(t,e,E,u-E))};Nt.prototype.optimize=function(){var t=new Array(this.count);var e=0;for(var i in this.leaves){t[e++]=this.nodes[i]}tree.subtreeRecycle(root);this.root=ee(tree,t,t.length)};var ie=function(t,e){if(!t.isLeaf&&e<=10){ie(t.A,e+1);ie(t.B,e+1)}var i="";for(var n=0;n<e;n++){i+=" "}console.log(i+t.bb_b+" "+t.bb_t)};Nt.prototype.log=function(){if(this.root)ie(this.root,0)};var ne=t.CollisionHandler=function(){this.a=this.b=0};ne.prototype.begin=function(t,e){return true};ne.prototype.preSolve=function(t,e){return true};ne.prototype.postSolve=function(t,e){};ne.prototype.separate=function(t,e){};var re=4;var se=function(t,e){this.e=0;this.u=0;this.surface_vr=T;this.a=t;this.body_a=t.body;this.b=e;this.body_b=e.body;this.thread_a_next=this.thread_a_prev=null;this.thread_b_next=this.thread_b_prev=null;this.contacts=null;this.stamp=0;this.handler=null;this.swappedColl=false;this.state="first coll"};se.prototype.getShapes=function(){if(this.swappedColl){return[this.b,this.a]}else{return[this.a,this.b]}};se.prototype.totalImpulse=function(){var t=this.contacts;var e=new y(0,0);for(var i=0,n=t.length;i<n;i++){var r=t[i];e.add(w(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()};se.prototype.totalImpulseWithFriction=function(){var t=this.contacts;var e=new y(0,0);for(var i=0,n=t.length;i<n;i++){var r=t[i];e.add(new y(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()};se.prototype.totalKE=function(){var t=(1-this.e)/(1+this.e);var e=0;var i=this.contacts;for(var n=0,r=i.length;n<r;n++){var s=i[n];var a=s.jnAcc;var o=s.jtAcc;e+=t*a*a/s.nMass+o*o/s.tMass}return e};se.prototype.ignore=function(){this.state="ignore"};se.prototype.getA=function(){return this.swappedColl?this.b:this.a};se.prototype.getB=function(){return this.swappedColl?this.a:this.b};se.prototype.isFirstContact=function(){return this.state==="first coll"};var ae=function(t,e,i){this.point=t;this.normal=e;this.dist=i};se.prototype.getContactPointSet=function(){var t=new Array(this.contacts.length);var e;for(e=0;e<t.length;e++){t[e]=new ae(this.contacts[e].p,this.contacts[e].n,this.contacts[e].dist)}return t};se.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?P(e):e};se.prototype.getPoint=function(t){return this.contacts[t].p};se.prototype.getDepth=function(t){return this.contacts[t].dist};var oe=function(t,e,i,n){if(i){if(i.body_a===e){i.thread_a_next=n}else{i.thread_b_next=n}}else{e.arbiterList=n}if(n){if(n.body_a===e){n.thread_a_prev=i}else{n.thread_b_prev=i}}};se.prototype.unthread=function(){oe(this,this.body_a,this.thread_a_prev,this.thread_a_next);oe(this,this.body_b,this.thread_b_prev,this.thread_b_next);this.thread_a_prev=this.thread_a_next=null;this.thread_b_prev=this.thread_b_next=null};se.prototype.update=function(t,e,i,n){if(this.contacts){for(var r=0;r<this.contacts.length;r++){var s=this.contacts[r];for(var a=0;a<t.length;a++){var o=t[a];if(o.hash===s.hash){o.jnAcc=s.jnAcc;o.jtAcc=s.jtAcc}}}}this.contacts=t;this.handler=e;this.swappedColl=i.collision_type!==e.a;this.e=i.e*n.e;this.u=i.u*n.u;this.surface_vr=R(i.surface_v,n.surface_v);this.a=i;this.body_a=i.body;this.b=n;this.body_b=n.body;if(this.state=="cached")this.state="first coll"};se.prototype.preStep=function(t,e,i){var n=this.body_a;var r=this.body_b;for(var a=0;a<this.contacts.length;a++){var o=this.contacts[a];o.r1=R(o.p,n.p);o.r2=R(o.p,r.p);o.nMass=1/Ge(n,r,o.r1,o.r2,o.n);o.tMass=1/Ge(n,r,o.r1,o.r2,L(o.n));o.bias=-i*s(0,o.dist+e)/t;o.jBias=0;o.bounce=Ne(n,r,o.r1,o.r2,o.n)*this.e}};se.prototype.applyCachedImpulse=function(t){if(this.isFirstContact())return;var e=this.body_a;var i=this.body_b;for(var n=0;n<this.contacts.length;n++){var r=this.contacts[n];var s=r.n.x;var a=r.n.y;var o=s*r.jnAcc-a*r.jtAcc;var c=s*r.jtAcc+a*r.jnAcc;Ve(e,i,r.r1,r.r2,o*t,c*t)}};var ce=0;var le=0;se.prototype.applyImpulse=function(){ce++;var t=this.body_a;var e=this.body_b;var i=this.surface_vr;var n=this.u;for(var r=0;r<this.contacts.length;r++){le++;var s=this.contacts[r];var o=s.nMass;var c=s.n;var l=s.r1;var h=s.r2;var u=e.vx-h.y*e.w-(t.vx-l.y*t.w);var d=e.vy+h.x*e.w-(t.vy+l.x*t.w);var _=c.x*(e.v_biasx-h.y*e.w_bias-t.v_biasx+l.y*t.w_bias)+c.y*(h.x*e.w_bias+e.v_biasy-l.x*t.w_bias-t.v_biasy);var f=S(u,d,c.x,c.y);var m=S(u+i.x,d+i.y,-c.y,c.x);var g=(s.bias-_)*o;var v=s.jBias;s.jBias=a(v+g,0);var y=-(s.bounce+f)*o;var T=s.jnAcc;s.jnAcc=a(T+y,0);var C=n*s.jnAcc;var x=-m*s.tMass;var E=s.jtAcc;s.jtAcc=p(E+x,-C,C);var b=c.x*(s.jBias-v);var A=c.y*(s.jBias-v);ke(t,-b,-A,l);ke(e,b,A,h);var R=s.jnAcc-T;var P=s.jtAcc-E;Ve(t,e,l,h,c.x*R-c.y*P,c.x*P+c.y*R)}};se.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)};se.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var he=0;var ue=function(t,e,i,n){this.p=t;this.n=e;this.dist=i;this.r1=this.r2=T;this.nMass=this.tMass=this.bounce=this.bias=0;this.jnAcc=this.jtAcc=this.jBias=0;this.hash=n;he++};var de=[];var _e=function(t,e,i,n){var r=i+n;var s=R(e,t);var a=M(s);if(a>=r*r)return;var o=Math.sqrt(a);return new ue(A(t,w(s,.5+(i-.5*r)/(o?o:Infinity))),o?w(s,1/o):new y(1,0),o-r,0)};var fe=function(t,e){var i=_e(t.tc,e.tc,t.r,e.r);return i?[i]:de};var pe=function(t,e){var i=e.ta;var n=e.tb;var r=t.tc;var s=R(n,i);var a=m(C(s,R(r,i))/M(s));var o=A(i,w(s,a));var c=_e(r,o,t.r,e.r);if(c){var l=c.n;return a===0&&C(l,e.a_tangent)<0||a===1&&C(l,e.b_tangent)<0?de:[c]}else{return de}};var me=0;var ge=function(t,e){var i=0;var n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var s=t.valueOnAxis(e[r].n,e[r].d);if(s>0){return-1}else if(s>n){n=s;i=r}}me=n;return i};var ve=function(t,e,i,n){var r=[];var s=t.tVerts;for(var a=0;a<s.length;a+=2){var c=s[a];var l=s[a+1];if(e.containsVertPartial(c,l,P(i))){r.push(new ue(new y(c,l),i,n,o(t.hashid,a)))}}var h=e.tVerts;for(var a=0;a<h.length;a+=2){var c=h[a];var l=h[a+1];if(t.containsVertPartial(c,l,i)){r.push(new ue(new y(c,l),i,n,o(e.hashid,a)))}}return r};var ye=function(t,e,i,n){var r=[];var s=t.tVerts;for(var a=0;a<s.length;a+=2){var c=s[a];var l=s[a+1];if(e.containsVert(c,l)){r.push(new ue(new y(c,l),i,n,o(t.hashid,a>>1)))}}var h=e.tVerts;for(var a=0;a<h.length;a+=2){var c=h[a];var l=h[a+1];if(t.containsVert(c,l)){r.push(new ue(new y(c,l),i,n,o(e.hashid,a>>1)))}}return r.length?r:ve(t,e,i,n)};var Te=function(t,e){var i=ge(e,t.tPlanes);if(i==-1)return de;var n=me;var r=ge(t,e.tPlanes);if(r==-1)return de;var s=me;if(n>s)return ye(t,e,t.tPlanes[i].n,n);else return ye(t,e,P(e.tPlanes[r].n),s)};var Ce=function(t,e,i){var n=C(e,t.ta)-t.r;var r=C(e,t.tb)-t.r;return s(n,r)-i};var Se=function(t,e,i,n,r){var s=I(e.tn,e.ta);var a=I(e.tn,e.tb);var c=w(e.tn,r);var l=i.tVerts;for(var h=0;h<l.length;h+=2){var u=l[h];var d=l[h+1];if(S(u,d,c.x,c.y)<C(e.tn,e.ta)*r+e.r){var _=D(e.tn.x,e.tn.y,u,d);if(s>=_&&_>=a){t.push(new ue(new y(u,d),c,n,o(i.hashid,h)))}}}};var xe=function(t,e){var i=[];var n=e.tPlanes;var r=n.length;var s=C(t.tn,t.ta);var a=e.valueOnAxis(t.tn,s)-t.r;var c=e.valueOnAxis(P(t.tn),-s)-t.r;if(c>0||a>0)return de;var l=0;var h=Ce(t,n[0].n,n[0].d);if(h>0)return de;for(var u=0;u<r;u++){var d=Ce(t,n[u].n,n[u].d);if(d>0){return de}else if(d>h){h=d;l=u}}var _=P(n[l].n);var f=A(t.ta,w(_,t.r));var p=A(t.tb,w(_,t.r));if(e.containsVert(f.x,f.y))i.push(new ue(f,_,h,o(t.hashid,0)));if(e.containsVert(p.x,p.y))i.push(new ue(p,_,h,o(t.hashid,1)));if(a>=h||c>=h){if(a>c)Se(i,t,e,a,1);else Se(i,t,e,c,-1)}if(i.length===0){var m=l*2;var g=e.tVerts;var v=new y(g[m],g[m+1]);var T;if(T=_e(t.ta,v,t.r,0,i))return[T];if(T=_e(t.tb,v,t.r,0,i))return[T];var S=r*2;var x=new y(g[(m+2)%S],g[(m+3)%S]);if(T=_e(t.ta,x,t.r,0,i))return[T];if(T=_e(t.tb,x,t.r,0,i))return[T]}return i};var Ee=function(t,e){var i=e.tPlanes;var n=0;var r=C(i[0].n,t.tc)-i[0].d-t.r;for(var s=0;s<i.length;s++){var a=C(i[s].n,t.tc)-i[s].d-t.r;if(a>0){return de}else if(a>r){r=a;n=s}}var o=i[n].n;var c=e.tVerts;var l=c.length;var h=n<<1;var u=c[h];var d=c[h+1];var _=c[(h+2)%l];var f=c[(h+3)%l];var p=D(o.x,o.y,u,d);var m=D(o.x,o.y,_,f);var g=I(o,t.tc);if(g<m){var v=_e(t.tc,new y(_,f),t.r,0,v);return v?[v]:de}else if(g<p){return[new ue(R(t.tc,w(o,t.r+r/2)),P(o),r,0)]}else{var v=_e(t.tc,new y(u,d),t.r,0,v);return v?[v]:de}};Ct.prototype.collisionCode=0;xt.prototype.collisionCode=1;bt.prototype.collisionCode=2;Ct.prototype.collisionTable=[fe,pe,Ee];xt.prototype.collisionTable=[null,function(t,e){return de},xe];bt.prototype.collisionTable=[null,null,Te];var be=t.collideShapes=function(t,i){e(t.collisionCode<=i.collisionCode,"Collided shapes must be sorted by type");return t.collisionTable[i.collisionCode](t,i)};var Ae=new ne;var Re=t.Space=function(){this.stamp=0;this.curr_dt=0;this.bodies=[];this.rousedBodies=[];this.sleepingComponents=[];this.staticShapes=new Nt(null);this.activeShapes=new Nt(this.staticShapes);this.arbiters=[];this.contactBuffersHead=null;this.cachedArbiters={};this.constraints=[];this.locked=0;this.collisionHandlers={};this.defaultHandler=Ae;this.postStepCallbacks=[];this.iterations=10;this.gravity=T;this.damping=1;this.idleSpeedThreshold=0;this.sleepTimeThreshold=Infinity;this.collisionSlop=.1;this.collisionBias=Math.pow(1-.1,60);this.collisionPersistence=3;this.enableContactGraph=false;this.staticBody=new wt(Infinity,Infinity);this.staticBody.nodeIdleTime=Infinity;this.collideShapes=this.makeCollideShapes()};Re.prototype.getCurrentTimeStep=function(){return this.curr_dt};Re.prototype.setIterations=function(t){this.iterations=t};Re.prototype.isLocked=function(){return this.locked};var Pe=function(t){e(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};Re.prototype.addCollisionHandler=function(t,e,i,n,r,s){Pe(this);this.removeCollisionHandler(t,e);var a=new ne;a.a=t;a.b=e;if(i)a.begin=i;if(n)a.preSolve=n;if(r)a.postSolve=r;if(s)a.separate=s;this.collisionHandlers[o(t,e)]=a};Re.prototype.removeCollisionHandler=function(t,e){Pe(this);delete this.collisionHandlers[o(t,e)]};Re.prototype.setDefaultCollisionHandler=function(t,e,i,n){Pe(this);var r=new ne;if(t)r.begin=t;if(e)r.preSolve=e;if(i)r.postSolve=i;if(n)r.separate=n;this.defaultHandler=r};Re.prototype.lookupHandler=function(t,e){return this.collisionHandlers[o(t,e)]||this.defaultHandler};Re.prototype.addShape=function(t){var i=t.body;if(i.isStatic())return this.addStaticShape(t);e(!t.space,"This shape is already added to a space and cannot be added to another.");Pe(this);i.activate();i.addShape(t);t.update(i.p,i.rot);this.activeShapes.insert(t,t.hashid);t.space=this;return t};Re.prototype.addStaticShape=function(t){e(!t.space,"This shape is already added to a space and cannot be added to another.");Pe(this);var i=t.body;i.addShape(t);t.update(i.p,i.rot);this.staticShapes.insert(t,t.hashid);t.space=this;return t};Re.prototype.addBody=function(t){e(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated.");e(!t.space,"This body is already added to a space and cannot be added to another.");Pe(this);this.bodies.push(t);t.space=this;return t};Re.prototype.addConstraint=function(t){e(!t.space,"This shape is already added to a space and cannot be added to another.");Pe(this);var i=t.a,n=t.b;i.activate();n.activate();this.constraints.push(t);t.next_a=i.constraintList;i.constraintList=t;t.next_b=n.constraintList;n.constraintList=t;t.space=this;return t};Re.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];if(t===n.body_a&&(e===n.a||e===null)||t===n.body_b&&(e===n.b||e===null)){if(e&&n.state!=="cached")n.callSeparate(this);n.unthread();c(this.arbiters,n);delete this.cachedArbiters[i]}}};Re.prototype.removeShape=function(t){var i=t.body;if(i.isStatic()){this.removeStaticShape(t)}else{e(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)");Pe(this);i.activate();i.removeShape(t);this.filterArbiters(i,t);this.activeShapes.remove(t,t.hashid);t.space=null}};Re.prototype.removeStaticShape=function(t){e(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)");Pe(this);var i=t.body;if(i.isStatic())i.activateStatic(t);i.removeShape(t);this.filterArbiters(i,t);this.staticShapes.remove(t,t.hashid);t.space=null};Re.prototype.removeBody=function(t){e(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)");Pe(this);t.activate();c(this.bodies,t);t.space=null};Re.prototype.removeConstraint=function(t){e(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)");Pe(this);t.a.activate();t.b.activate();c(this.constraints,t);t.a.removeConstraint(t);t.b.removeConstraint(t);t.space=null};Re.prototype.containsShape=function(t){return t.space===this};Re.prototype.containsBody=function(t){return t.space==this};Re.prototype.containsConstraint=function(t){return t.space==this};Re.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[o(t.a.hashid,t.b.hashid)];c(this.arbiters,t)};Re.prototype.eachBody=function(t){this.lock();{var e=this.bodies;for(var i=0;i<e.length;i++){t(e[i])}var n=this.sleepingComponents;for(var i=0;i<n.length;i++){var r=n[i];var s=r;while(s){var a=s.nodeNext;t(s);s=a}}}this.unlock(true)};Re.prototype.eachShape=function(t){this.lock();{this.activeShapes.each(t);this.staticShapes.each(t)}this.unlock(true)};Re.prototype.eachConstraint=function(t){this.lock();{var e=this.constraints;for(var i=0;i<e.length;i++){t(e[i])}}this.unlock(true)};Re.prototype.reindexStatic=function(){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)});this.staticShapes.reindex()};Re.prototype.reindexShape=function(t){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var i=t.body;t.update(i.p,i.rot);this.activeShapes.reindexObject(t,t.hashid);this.staticShapes.reindexObject(t,t.hashid)};Re.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next){this.reindexShape(e)}};Re.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.");var i=new SpaceHash(t,e,null);var n=new SpaceHash(t,e,i);this.staticShapes.each(function(t){i.insert(t,t.hashid)});this.activeShapes.each(function(t){n.insert(t,t.hashid)});this.staticShapes=i;this.activeShapes=n};Re.prototype.activateBody=function(t){e(!t.isRogue(),"Internal error: Attempting to activate a rogue body.");if(this.locked){if(this.rousedBodies.indexOf(t)===-1)this.rousedBodies.push(t)}else{this.bodies.push(t);for(var i=0;i<t.shapeList.length;i++){var n=t.shapeList[i];this.staticShapes.remove(n,n.hashid);this.activeShapes.insert(n,n.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;if(t===s||s.isStatic()){var a=r.a,c=r.b;this.cachedArbiters[o(a.hashid,c.hashid)]=r;r.stamp=this.stamp;r.handler=this.lookupHandler(a.collision_type,c.collision_type);this.arbiters.push(r)}}for(var l=t.constraintList;l;l=l.nodeNext){var s=l.a;if(t===s||s.isStatic())this.constraints.push(l)}}};Re.prototype.deactivateBody=function(t){e(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body.");c(this.bodies,t);for(var i=0;i<t.shapeList.length;i++){var n=t.shapeList[i];this.activeShapes.remove(n,n.hashid);this.staticShapes.insert(n,n.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;if(t===s||s.isStatic()){this.uncacheArbiter(r)}}for(var a=t.constraintList;a;a=a.nodeNext){var s=a.a;if(t===s||s.isStatic())c(this.constraints,a)}};var we=function(t){return t?t.nodeRoot:null};var Ie=function(t){if(!t||!t.isSleeping(t))return;e(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");var i=t.space;var n=t;while(n){var r=n.nodeNext;n.nodeIdleTime=0;n.nodeRoot=null;n.nodeNext=null;i.activateBody(n);n=r}c(i.sleepingComponents,t)};wt.prototype.activate=function(){if(!this.isRogue()){this.nodeIdleTime=0;Ie(we(this))}};wt.prototype.activateStatic=function(t){e(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var i=this.arbiterList;i;i=i.next(this)){if(!t||t==i.a||t==i.b){(i.body_a==this?i.body_b:i.body_a).activate()}}};wt.prototype.pushArbiter=function(t){i((t.body_a===this?t.thread_a_next:t.thread_b_next)===null,"Internal Error: Dangling contact graph pointers detected. (A)");i((t.body_a===this?t.thread_a_prev:t.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;i(e===null||(e.body_a===this?e.thread_a_prev:e.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (C)");if(t.body_a===this){t.thread_a_next=e}else{t.thread_b_next=e}if(e){if(e.body_a===this){e.thread_a_prev=t}else{e.thread_b_prev=t}}this.arbiterList=t};var De=function(t,e){e.nodeRoot=t;if(e!==t){e.nodeNext=t.nodeNext;t.nodeNext=e}};var Le=function(t,e){if(!e.isRogue()){var n=we(e);if(n==null){De(t,e);for(var r=e.arbiterList;r;r=r.next(e)){Le(t,e==r.body_a?r.body_b:r.body_a)}for(var s=e.constraintList;s;s=s.next(e)){Le(t,e==s.a?s.b:s.a)}}else{i(n===t,"Internal Error: Inconsistency detected in the contact graph.")}}};var Oe=function(t,e){for(var i=t;i;i=i.nodeNext){if(i.nodeIdleTime<e)return true}return false};Re.prototype.processComponents=function(t){var e=this.sleepTimeThreshold!==Infinity;var n=this.bodies;for(var r=0;r<n.length;r++){var s=n[r];i(s.nodeNext===null,"Internal Error: Dangling next pointer detected in contact graph.");i(s.nodeRoot===null,"Internal Error: Dangling root pointer detected in contact graph.")}if(e){var a=this.idleSpeedThreshold;var o=a?a*a:M(this.gravity)*t*t;for(var r=0;r<n.length;r++){var s=n[r];var c=o?s.m*o:0;s.nodeIdleTime=s.kineticEnergy()>c?0:s.nodeIdleTime+t}}var l=this.arbiters;for(var r=0,h=l.length;r<h;r++){var u=l[r];var d=u.body_a,_=u.body_b;if(e){if(_.isRogue()&&!_.isStatic()||d.isSleeping())d.activate();if(d.isRogue()&&!d.isStatic()||_.isSleeping())_.activate()}d.pushArbiter(u);_.pushArbiter(u)}if(e){var f=this.constraints;for(var r=0;r<f.length;r++){var p=f[r];var d=p.a,_=p.b;if(_.isRogue()&&!_.isStatic())d.activate();if(d.isRogue()&&!d.isStatic())_.activate()}for(var r=0;r<n.length;){var s=n[r];if(we(s)===null){Le(s,s);if(!Oe(s,this.sleepTimeThreshold)){this.sleepingComponents.push(s);for(var m=s;m;m=m.nodeNext){this.deactivateBody(m)}continue}}r++;s.nodeRoot=null;s.nodeNext=null}}};wt.prototype.sleep=function(){this.sleepWithGroup(null)};wt.prototype.sleepWithGroup=function(t){e(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var i=this.space;e(i,"Cannot put a rogue body to sleep.");e(!i.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback.");e(t===null||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier.");if(this.isSleeping()){e(we(this)===we(t),"The body is already sleeping and it's group cannot be reassigned.");return}for(var n=0;n<this.shapeList.length;n++){this.shapeList[n].update(this.p,this.rot)}i.deactivateBody(this);if(t){var r=we(t);this.nodeRoot=r;this.nodeNext=r.nodeNext;this.nodeIdleTime=0;r.nodeNext=this}else{this.nodeRoot=this;this.nodeNext=null;this.nodeIdleTime=0;i.sleepingComponents.push(this)}c(i.bodies,this)};Re.prototype.activateShapesTouchingShape=function(t){if(this.sleepTimeThreshold!==Infinity){this.shapeQuery(t,function(t,e){t.body.activate()})}};Re.prototype.pointQuery=function(t,e,i,n){var r=function(r){if(!(r.group&&i===r.group)&&e&r.layers&&r.pointQuery(t)){n(r)}};var s=new $(t.x,t.y,t.x,t.y);this.lock();{this.activeShapes.query(s,r);this.staticShapes.query(s,r)}this.unlock(true)};Re.prototype.pointQueryFirst=function(t,e,i){var n=null;this.pointQuery(t,e,i,function(t){if(!t.sensor)n=t});return n};Re.prototype.nearestPointQuery=function(t,e,i,n,r){var s=function(s){if(!(s.group&&n===s.group)&&i&s.layers){var a=s.nearestPointQuery(t);if(a.d<e)r(s,a.d,a.p)}};var a=tt(t,e);this.lock();{this.activeShapes.query(a,s);this.staticShapes.query(a,s)}this.unlock(true)};Re.prototype.nearestPointQueryNearest=function(t,e,i,n){var r;var s=function(s){if(!(s.group&&n===s.group)&&i&s.layers&&!s.sensor){var a=s.nearestPointQuery(t);if(a.d<e&&(!r||a.d<r.d))r=a}};var a=tt(t,e);this.activeShapes.query(a,s);this.staticShapes.query(a,s);return r};Re.prototype.segmentQuery=function(t,e,i,n,r){var s=function(s){var a;if(!(s.group&&n===s.group)&&i&s.layers&&(a=s.segmentQuery(t,e))){r(s,a.t,a.n)}return 1};this.lock();{this.staticShapes.segmentQuery(t,e,1,s);this.activeShapes.segmentQuery(t,e,1,s)}this.unlock(true)};Re.prototype.segmentQueryFirst=function(t,e,i,n){var r=null;var s=function(s){var a;if(!(s.group&&n===s.group)&&i&s.layers&&!s.sensor&&(a=s.segmentQuery(t,e))&&(r===null||a.t<r.t)){r=a}return r?r.t:1};this.staticShapes.segmentQuery(t,e,1,s);this.activeShapes.segmentQuery(t,e,r?r.t:1,s);return r};Re.prototype.bbQuery=function(t,e,i,n){var r=function(r){if(!(r.group&&i===r.group)&&e&r.layers&&it(t,r.bb_l,r.bb_b,r.bb_r,r.bb_t)){n(r)}};this.lock();{this.activeShapes.query(t,r);this.staticShapes.query(t,r)}this.unlock(true)};Re.prototype.shapeQuery=function(t,e){var i=t.body;if(i){t.update(i.p,i.rot)}var n=new $(t.bb_l,t.bb_b,t.bb_r,t.bb_t);var r=false;var s=function(i){var n=t;if(n.group&&n.group===i.group||!(n.layers&i.layers)||n===i)return;var s;if(n.collisionCode<=i.collisionCode){s=be(n,i)}else{s=be(i,n);for(var a=0;a<s.length;a++)s[a].n=P(s[a].n)}if(s.length){r=!(n.sensor||i.sensor);if(e){var o=new Array(s.length);for(var a=0;a<s.length;a++){o[a]=new ae(s[a].p,s[a].n,s[a].dist)}e(i,o)}}};this.lock();{this.activeShapes.query(n,s);this.staticShapes.query(n,s)}this.unlock(true);return r};Re.prototype.addPostStepCallback=function(t){i(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. "+"Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query.");this.postStepCallbacks.push(t)};Re.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++){this.postStepCallbacks[t]()}this.postStepCallbacks=[]};Re.prototype.lock=function(){this.locked++};Re.prototype.unlock=function(t){this.locked--;e(this.locked>=0,"Internal Error: Space lock underflow.");if(this.locked===0&&t){var i=this.rousedBodies;for(var n=0;n<i.length;n++){this.activateBody(i[n])}i.length=0;this.runPostStepCallbacks()}};Re.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(!(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t)||e.body===i.body||e.group&&e.group===i.group||!(e.layers&i.layers))return;var r=n.lookupHandler(e.collision_type,i.collision_type);var s=e.sensor||i.sensor;if(s&&r===Ae)return;if(e.collisionCode>i.collisionCode){var a=e;e=i;i=a}var c=be(e,i);if(c.length===0)return;var l=o(e.hashid,i.hashid);var h=n.cachedArbiters[l];if(!h){h=n.cachedArbiters[l]=new se(e,i)}h.update(c,r,e,i);if(h.state=="first coll"&&!r.begin(h,n)){h.ignore()}if(h.state!=="ignore"&&r.preSolve(h,n)&&!s){n.arbiters.push(h)}else{h.contacts=null;if(h.state!=="ignore")h.state="normal"}h.stamp=n.stamp}};Re.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp;var i=t.body_a,n=t.body_b;if((i.isStatic()||i.isSleeping())&&(n.isStatic()||n.isSleeping())){return true}if(e>=1&&t.state!="cached"){t.callSeparate(this);t.state="cached"}if(e>=this.collisionPersistence){t.contacts=null;return false}return true};var Be=function(t){var e=t.body;t.update(e.p,e.rot)};Re.prototype.step=function(t){if(t===0)return;e(T.x===0&&T.y===0,"vzero is invalid");this.stamp++;var i=this.curr_dt;this.curr_dt=t;var n;var r;var s;var a=this.bodies;var o=this.constraints;var c=this.arbiters;for(n=0;n<c.length;n++){var l=c[n];l.state="normal";if(!l.body_a.isSleeping()&&!l.body_b.isSleeping()){l.unthread()}}c.length=0;this.lock();{for(n=0;n<a.length;n++){a[n].position_func(t)}this.activeShapes.each(Be);this.activeShapes.reindexQuery(this.collideShapes)}this.unlock(false);this.processComponents(t);this.lock();{for(s in this.cachedArbiters){if(!this.arbiterSetFilter(this.cachedArbiters[s])){delete this.cachedArbiters[s]}}var h=this.collisionSlop;var u=1-Math.pow(this.collisionBias,t);for(n=0;n<c.length;n++){c[n].preStep(t,h,u)}for(n=0;n<o.length;n++){var d=o[n];d.preSolve(this);d.preStep(t)}var _=Math.pow(this.damping,t);var f=this.gravity;for(n=0;n<a.length;n++){a[n].velocity_func(f,_,t)}var p=i===0?0:t/i;for(n=0;n<c.length;n++){c[n].applyCachedImpulse(p)}for(n=0;n<o.length;n++){o[n].applyCachedImpulse(p)}for(n=0;n<this.iterations;n++){for(r=0;r<c.length;r++){c[r].applyImpulse()}for(r=0;r<o.length;r++){o[r].applyImpulse()}}for(n=0;n<o.length;n++){o[n].postSolve(this)}for(n=0;n<c.length;n++){c[n].handler.postSolve(c[n],this)}}this.unlock(true)};var Fe=function(t,e,i,n){var r=t.vx+-i.y*t.w;var s=t.vy+i.x*t.w;var a=e.vx+-n.y*e.w;var o=e.vy+n.x*e.w;return new y(a-r,o-s)};var Ne=function(t,e,i,n,r){var s=t.vx+-i.y*t.w;var a=t.vy+i.x*t.w;var o=e.vx+-n.y*e.w;var c=e.vy+n.x*e.w;return S(o-s,c-a,r.x,r.y)};var Me=function(t,e,i,n){t.vx+=e*t.m_inv;t.vy+=i*t.m_inv;t.w+=t.i_inv*(n.x*i-n.y*e)};var Ve=function(t,e,i,n,r,s){Me(t,-r,-s,i);Me(e,r,s,n)};var ke=function(t,e,i,n){t.v_biasx+=e*t.m_inv;t.v_biasy+=i*t.m_inv;t.w_bias+=t.i_inv*D(n.x,n.y,e,i)};var We=function(t,e,i){var n=I(e,i);return t.m_inv+t.i_inv*n*n};var Ge=function(t,e,n,r,s){var a=We(t,n,s)+We(e,r,s);i(a!==0,"Unsolvable collision or constraint.");return a};var ze=function(t,e,n,r,s,a){var o,c,l,h;var u=t.m_inv+e.m_inv;o=u;c=0;l=0;h=u;var d=t.i_inv;var _=n.x*n.x*d;var f=n.y*n.y*d;var p=-n.x*n.y*d;o+=f;c+=p;l+=p;h+=_;var m=e.i_inv;var g=r.x*r.x*m;var v=r.y*r.y*m;var y=-r.x*r.y*m;o+=v;c+=y;l+=y;h+=g;var T=o*h-c*l;i(T!==0,"Unsolvable constraint.");var C=1/T;s.x=h*C;s.y=-c*C;a.x=-l*C;a.y=o*C};var Ue=function(t,e,i){return new y(C(t,e),C(t,i))};var Ye=function(t,e){return 1-Math.pow(t,e)};var Xe=t.Constraint=function(t,e){this.a=t;this.b=e;this.space=null;this.next_a=null;this.next_b=null;this.maxForce=Infinity;this.errorBias=Math.pow(1-.1,60);this.maxBias=Infinity};Xe.prototype.activateBodies=function(){if(this.a)this.a.activate();if(this.b)this.b.activate()};Xe.prototype.preStep=function(t){};Xe.prototype.applyCachedImpulse=function(t){};Xe.prototype.applyImpulse=function(){};Xe.prototype.getImpulse=function(){return 0};Xe.prototype.preSolve=function(t){};Xe.prototype.postSolve=function(t){};Xe.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var He=t.PinJoint=function(t,e,n,r){Xe.call(this,t,e);this.anchr1=n;this.anchr2=r;var s=t?A(t.p,F(n,t.rot)):n;var a=e?A(e.p,F(r,e.rot)):r;this.dist=x(R(a,s));i(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable.");this.r1=this.r2=null;this.n=null;this.nMass=0;this.jnAcc=this.jnMax=0;this.bias=0};He.prototype=Object.create(Xe.prototype);He.prototype.preStep=function(t){var e=this.a;var i=this.b;this.r1=F(this.anchr1,e.rot);this.r2=F(this.anchr2,i.rot);var n=R(A(i.p,this.r2),A(e.p,this.r1));var r=x(n);this.n=w(n,1/(r?r:Infinity));this.nMass=1/Ge(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=p(-Ye(this.errorBias,t)*(r-this.dist)/t,-s,s);this.jnMax=this.maxForce*t};He.prototype.applyCachedImpulse=function(t){var e=w(this.n,this.jnAcc*t);Ve(this.a,this.b,this.r1,this.r2,e.x,e.y)};He.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=this.n;var n=Ne(t,e,this.r1,this.r2,i);var r=(this.bias-n)*this.nMass;var s=this.jnAcc;this.jnAcc=p(s+r,-this.jnMax,this.jnMax);r=this.jnAcc-s;Ve(t,e,this.r1,this.r2,i.x*r,i.y*r)};He.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var je=t.SlideJoint=function(t,e,i,n,r,s){Xe.call(this,t,e);this.anchr1=i;this.anchr2=n;this.min=r;this.max=s;this.r1=this.r2=this.n=null;this.nMass=0;this.jnAcc=this.jnMax=0;this.bias=0};je.prototype=Object.create(Xe.prototype);je.prototype.preStep=function(t){var e=this.a;var i=this.b;this.r1=F(this.anchr1,e.rot);this.r2=F(this.anchr2,i.rot);var n=R(A(i.p,this.r2),A(e.p,this.r1));var r=x(n);var s=0;if(r>this.max){s=r-this.max;this.n=G(n)}else if(r<this.min){s=this.min-r;this.n=P(G(n))}else{this.n=T;this.jnAcc=0}this.nMass=1/Ge(e,i,this.r1,this.r2,this.n);var a=this.maxBias;this.bias=p(-Ye(this.errorBias,t)*s/t,-a,a);this.jnMax=this.maxForce*t};je.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;Ve(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)};je.prototype.applyImpulse=function(){
if(this.n.x===0&&this.n.y===0)return;var t=this.a;var e=this.b;var i=this.n;var n=this.r1;var r=this.r2;var s=Fe(t,e,n,r);var a=C(s,i);var o=(this.bias-a)*this.nMass;var c=this.jnAcc;this.jnAcc=p(c+o,-this.jnMax,0);o=this.jnAcc-c;Ve(t,e,this.r1,this.r2,i.x*o,i.y*o)};je.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var qe=t.PivotJoint=function(t,e,i,n){Xe.call(this,t,e);if(typeof n==="undefined"){var r=i;i=t?t.world2Local(r):r;n=e?e.world2Local(r):r}this.anchr1=i;this.anchr2=n;this.r1=this.r2=T;this.k1=new y(0,0);this.k2=new y(0,0);this.jAcc=T;this.jMaxLen=0;this.bias=T};qe.prototype=Object.create(Xe.prototype);qe.prototype.preStep=function(t){var e=this.a;var i=this.b;this.r1=F(this.anchr1,e.rot);this.r2=F(this.anchr2,i.rot);ze(e,i,this.r1,this.r2,this.k1,this.k2);this.jMaxLen=this.maxForce*t;var n=R(A(i.p,this.r2),A(e.p,this.r1));this.bias=z(w(n,-Ye(this.errorBias,t)/t),this.maxBias)};qe.prototype.applyCachedImpulse=function(t){Ve(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)};qe.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=this.r1;var n=this.r2;var r=Fe(t,e,i,n);var s=Ue(R(this.bias,r),this.k1,this.k2);var a=this.jAcc;this.jAcc=z(A(this.jAcc,s),this.jMaxLen);Ve(t,e,this.r1,this.r2,this.jAcc.x-a.x,this.jAcc.y-a.y)};qe.prototype.getImpulse=function(){return x(this.jAcc)};var Je=t.GrooveJoint=function(t,e,i,n,r){Xe.call(this,t,e);this.grv_a=i;this.grv_b=n;this.grv_n=L(W(R(n,i)));this.anchr2=r;this.grv_tn=null;this.clamp=0;this.r1=this.r2=null;this.k1=new y(0,0);this.k2=new y(0,0);this.jAcc=T;this.jMaxLen=0;this.bias=null};Je.prototype=Object.create(Xe.prototype);Je.prototype.preStep=function(t){var e=this.a;var i=this.b;var n=e.local2World(this.grv_a);var r=e.local2World(this.grv_b);var s=F(this.grv_n,e.rot);var a=C(n,s);this.grv_tn=s;this.r2=F(this.anchr2,i.rot);var o=I(A(i.p,this.r2),s);if(o<=I(n,s)){this.clamp=1;this.r1=R(n,e.p)}else if(o>=I(r,s)){this.clamp=-1;this.r1=R(r,e.p)}else{this.clamp=0;this.r1=R(A(w(L(s),-o),w(s,a)),e.p)}ze(e,i,this.r1,this.r2,this.k1,this.k2);this.jMaxLen=this.maxForce*t;var c=R(A(i.p,this.r2),A(e.p,this.r1));this.bias=z(w(c,-Ye(this.errorBias,t)/t),this.maxBias)};Je.prototype.applyCachedImpulse=function(t){Ve(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)};Je.prototype.grooveConstrain=function(t){var e=this.grv_tn;var i=this.clamp*I(t,e)>0?t:B(t,e);return z(i,this.jMaxLen)};Je.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=this.r1;var n=this.r2;var r=Fe(t,e,i,n);var s=Ue(R(this.bias,r),this.k1,this.k2);var a=this.jAcc;this.jAcc=this.grooveConstrain(A(a,s));Ve(t,e,this.r1,this.r2,this.jAcc.x-a.x,this.jAcc.y-a.y)};Je.prototype.getImpulse=function(){return x(this.jAcc)};Je.prototype.setGrooveA=function(t){this.grv_a=t;this.grv_n=L(W(R(this.grv_b,t)));this.activateBodies()};Je.prototype.setGrooveB=function(t){this.grv_b=t;this.grv_n=L(W(R(t,this.grv_a)));this.activateBodies()};var Ze=function(t,e){return(t.restLength-e)*t.stiffness};var Ke=t.DampedSpring=function(t,e,i,n,r,s,a){Xe.call(this,t,e);this.anchr1=i;this.anchr2=n;this.restLength=r;this.stiffness=s;this.damping=a;this.springForceFunc=Ze;this.target_vrn=this.v_coef=0;this.r1=this.r2=null;this.nMass=0;this.n=null};Ke.prototype=Object.create(Xe.prototype);Ke.prototype.preStep=function(t){var e=this.a;var n=this.b;this.r1=F(this.anchr1,e.rot);this.r2=F(this.anchr2,n.rot);var r=R(A(n.p,this.r2),A(e.p,this.r1));var s=x(r);this.n=w(r,1/(s?s:Infinity));var a=Ge(e,n,this.r1,this.r2,this.n);i(a!==0,"Unsolvable this.");this.nMass=1/a;this.target_vrn=0;this.v_coef=1-Math.exp(-this.damping*t*a);var o=this.springForceFunc(this,s);Ve(e,n,this.r1,this.r2,this.n.x*o*t,this.n.y*o*t)};Ke.prototype.applyCachedImpulse=function(t){};Ke.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=this.n;var n=this.r1;var r=this.r2;var s=Ne(t,e,n,r,i);var a=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+a;a*=this.nMass;Ve(t,e,this.r1,this.r2,this.n.x*a,this.n.y*a)};Ke.prototype.getImpulse=function(){return 0};var Qe=function(t,e){return(e-t.restAngle)*t.stiffness};var $e=t.DampedRotarySpring=function(t,e,i,n,r){Xe.call(this,t,e);this.restAngle=i;this.stiffness=n;this.damping=r;this.springTorqueFunc=Qe;this.target_wrn=0;this.w_coef=0;this.iSum=0};$e.prototype=Object.create(Xe.prototype);$e.prototype.preStep=function(t){var e=this.a;var n=this.b;var r=e.i_inv+n.i_inv;i(r!==0,"Unsolvable spring.");this.iSum=1/r;this.w_coef=1-Math.exp(-this.damping*t*r);this.target_wrn=0;var s=this.springTorqueFunc(this,e.a-n.a)*t;e.w-=s*e.i_inv;n.w+=s*n.i_inv};$e.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=t.w-e.w;var n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var r=n*this.iSum;t.w+=r*t.i_inv;e.w-=r*e.i_inv};var ti=t.RotaryLimitJoint=function(t,e,i,n){Xe.call(this,t,e);this.min=i;this.max=n;this.jAcc=0;this.iSum=this.bias=this.jMax=0};ti.prototype=Object.create(Xe.prototype);ti.prototype.preStep=function(t){var e=this.a;var i=this.b;var n=i.a-e.a;var r=0;if(n>this.max){r=this.max-n}else if(n<this.min){r=this.min-n}this.iSum=1/(1/e.i+1/i.i);var s=this.maxBias;this.bias=p(-Ye(this.errorBias,t)*r/t,-s,s);this.jMax=this.maxForce*t;if(!this.bias)this.jAcc=0};ti.prototype.applyCachedImpulse=function(t){var e=this.a;var i=this.b;var n=this.jAcc*t;e.w-=n*e.i_inv;i.w+=n*i.i_inv};ti.prototype.applyImpulse=function(){if(!this.bias)return;var t=this.a;var e=this.b;var i=e.w-t.w;var n=-(this.bias+i)*this.iSum;var r=this.jAcc;if(this.bias<0){this.jAcc=p(r+n,0,this.jMax)}else{this.jAcc=p(r+n,-this.jMax,0)}n=this.jAcc-r;t.w-=n*t.i_inv;e.w+=n*e.i_inv};ti.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var ei=t.RatchetJoint=function(t,e,i,n){Xe.call(this,t,e);this.angle=0;this.phase=i;this.ratchet=n;this.angle=(e?e.a:0)-(t?t.a:0);this.iSum=this.bias=this.jAcc=this.jMax=0};ei.prototype=Object.create(Xe.prototype);ei.prototype.preStep=function(t){var e=this.a;var i=this.b;var n=this.angle;var r=this.phase;var s=this.ratchet;var a=i.a-e.a;var o=n-a;var c=0;if(o*s>0){c=o}else{this.angle=Math.floor((a-r)/s)*s+r}this.iSum=1/(e.i_inv+i.i_inv);var l=this.maxBias;this.bias=p(-Ye(this.errorBias,t)*c/t,-l,l);this.jMax=this.maxForce*t;if(!this.bias)this.jAcc=0};ei.prototype.applyCachedImpulse=function(t){var e=this.a;var i=this.b;var n=this.jAcc*t;e.w-=n*e.i_inv;i.w+=n*i.i_inv};ei.prototype.applyImpulse=function(){if(!this.bias)return;var t=this.a;var e=this.b;var i=e.w-t.w;var n=this.ratchet;var r=-(this.bias+i)*this.iSum;var s=this.jAcc;this.jAcc=p((s+r)*n,0,this.jMax*Math.abs(n))/n;r=this.jAcc-s;t.w-=r*t.i_inv;e.w+=r*e.i_inv};ei.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var ii=t.GearJoint=function(t,e,i,n){Xe.call(this,t,e);this.phase=i;this.ratio=n;this.ratio_inv=1/n;this.jAcc=0;this.iSum=this.bias=this.jMax=0};ii.prototype=Object.create(Xe.prototype);ii.prototype.preStep=function(t){var e=this.a;var i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=p(-Ye(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n);this.jMax=this.maxForce*t};ii.prototype.applyCachedImpulse=function(t){var e=this.a;var i=this.b;var n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv;i.w+=n*i.i_inv};ii.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=e.w*this.ratio-t.w;var n=(this.bias-i)*this.iSum;var r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax);n=this.jAcc-r;t.w-=n*t.i_inv*this.ratio_inv;e.w+=n*e.i_inv};ii.prototype.getImpulse=function(){return Math.abs(this.jAcc)};ii.prototype.setRatio=function(t){this.ratio=t;this.ratio_inv=1/t;this.activateBodies()};var ni=t.SimpleMotor=function(t,e,i){Xe.call(this,t,e);this.rate=i;this.jAcc=0;this.iSum=this.jMax=0};ni.prototype=Object.create(Xe.prototype);ni.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv);this.jMax=this.maxForce*t};ni.prototype.applyCachedImpulse=function(t){var e=this.a;var i=this.b;var n=this.jAcc*t;e.w-=n*e.i_inv;i.w+=n*i.i_inv};ni.prototype.applyImpulse=function(){var t=this.a;var e=this.b;var i=e.w-t.w+this.rate;var n=-i*this.iSum;var r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax);n=this.jAcc-r;t.w-=n*t.i_inv;e.w+=n*e.i_inv};ni.prototype.getImpulse=function(){return Math.abs(this.jAcc)}})();var sp=sp||{};sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7};sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3};sp.Skeleton=cc.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:false,_debugBones:false,_premultipliedAlpha:false,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,i){cc.Node.prototype.ctor.call(this);if(arguments.length===0)this.init();else this.initWithArgs(t,e,i)},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)return new sp.Skeleton.CanvasRenderCmd(this);else return new sp.Skeleton.WebGLRenderCmd(this)},init:function(){cc.Node.prototype.init.call(this);this._premultipliedAlpha=cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this.scheduleUpdate()},setDebugSolots:function(t){this._debugSlots=t},setDebugBones:function(t){this._debugBones=t},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){var n=t,r=e,s,a,o;if(cc.isString(n)){if(cc.isString(r)){var c=cc.loader.getRes(r);sp._atlasLoader.setAtlasFile(r);a=new spine.Atlas(c,sp._atlasLoader)}else{a=e}i=i||1/cc.director.getContentScaleFactor();var l=new spine.AtlasAttachmentLoader(a);var h=new spine.SkeletonJson(l);h.scale=i;var u=cc.loader.getRes(n);s=h.readSkeletonData(u);a.dispose(h);o=true}else{s=t;o=e}this.setSkeletonData(s,o);this.init()},getBoundingBox:function(){var t=cc.FLT_MAX,e=cc.FLT_MAX,i=cc.FLT_MIN,n=cc.FLT_MIN;var r=this.getScaleX(),s=this.getScaleY(),a=[],o=this._skeleton.slots,c=sp.VERTEX_INDEX;for(var l=0,h=o.length;l<h;++l){var u=o[l];if(!u.attachment||u.attachment.type!=sp.ATTACHMENT_TYPE.REGION)continue;var d=u.attachment;this._computeRegionAttachmentWorldVertices(d,u.bone.skeleton.x,u.bone.skeleton.y,u.bone,a);t=Math.min(t,a[c.X1]*r,a[c.X4]*r,a[c.X2]*r,a[c.X3]*r);e=Math.min(e,a[c.Y1]*s,a[c.Y4]*s,a[c.Y2]*s,a[c.Y3]*s);i=Math.max(i,a[c.X1]*r,a[c.X4]*r,a[c.X2]*r,a[c.X3]*r);n=Math.max(n,a[c.Y1]*s,a[c.Y4]*s,a[c.Y2]*s,a[c.Y3]*s)}var _=this.getPosition();return cc.rect(_.x+t,_.y+e,i-t,n-e)},_computeRegionAttachmentWorldVertices:function(t,e,i,n,r){var s=t.offset,a=sp.VERTEX_INDEX;e+=n.worldX;i+=n.worldY;r[a.X1]=s[a.X1]*n.m00+s[a.Y1]*n.m01+e;r[a.Y1]=s[a.X1]*n.m10+s[a.Y1]*n.m11+i;r[a.X2]=s[a.X2]*n.m00+s[a.Y2]*n.m01+e;r[a.Y2]=s[a.X2]*n.m10+s[a.Y2]*n.m11+i;r[a.X3]=s[a.X3]*n.m00+s[a.Y3]*n.m01+e;r[a.Y3]=s[a.X3]*n.m10+s[a.Y3]*n.m11+i;r[a.X4]=s[a.X4]*n.m00+s[a.Y4]*n.m01+e;r[a.Y4]=s[a.X4]*n.m10+s[a.Y4]*n.m11+i},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setPremultipliedAlpha:function(t){this._premultipliedAlpha=t},isPremultipliedAlpha:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){if(t.width!=null&&t.height!=null)this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor());this._skeleton=new spine.Skeleton(t);this._skeleton.updateWorldTransform();this._rootBone=this._skeleton.getRootBone();this._ownsSkeletonData=e;this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var i=this._blendFunc;if(e===undefined){i.src=t.src;i.dst=t.dst}else{i.src=t;i.dst=e}},update:function(t){this._skeleton.update(t)}});sp.Skeleton.create=function(t,e,i){return new sp.Skeleton(t,e,i)};var spine={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:typeof Float32Array==="undefined"?Array:Float32Array,Uint16Array:typeof Uint16Array==="undefined"?Array:Uint16Array};spine.BoneData=function(t,e){this.length=this.x=this.y=this.rotation=0;this.scaleX=this.scaleY=1;this.name=t;this.parent=e};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:true,inheritRotation:true,flipX:false,flipY:false};spine.BlendMode={normal:0,additive:1,multiply:2,screen:3};spine.SlotData=function(t,e){this.r=this.g=this.b=this.a=1;this.blendMode=spine.BlendMode.normal;this.name=t;this.boneData=e};spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:spine.BlendMode.normal};spine.IkConstraintData=function(t){this.bendDirection=this.mix=1;this.name=t;this.bones=[]};spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};spine.Bone=function(t,e,i){this.x=this.y=this.rotation=this.rotationIK=0;this.scaleX=this.scaleY=1;this.flipX=this.flipY=false;this.m00=this.m01=this.worldX=0;this.m10=this.m11=this.worldY=0;this.worldRotation=0;this.worldScaleX=this.worldScaleY=1;this.worldFlipX=this.worldFlipY=false;this.data=t;this.skeleton=e;this.parent=i;this.setToSetupPose()};spine.Bone.yDown=false;spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:false,flipY:false,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:false,worldFlipY:false,updateWorldTransform:function(){var t=this.parent;if(t){this.worldX=this.x*t.m00+this.y*t.m01+t.worldX;this.worldY=this.x*t.m10+this.y*t.m11+t.worldY;if(this.data.inheritScale){this.worldScaleX=t.worldScaleX*this.scaleX;this.worldScaleY=t.worldScaleY*this.scaleY}else{this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY}this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK;this.worldFlipX=t.worldFlipX!=this.flipX;this.worldFlipY=t.worldFlipY!=this.flipY}else{var e=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=e?-this.x:this.x;this.worldY=i!=spine.Bone.yDown?-this.y:this.y;this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY;this.worldRotation=this.rotationIK;this.worldFlipX=e!=this.flipX;this.worldFlipY=i!=this.flipY}var n=this.worldRotation*spine.degRad;var r=Math.cos(n);var s=Math.sin(n);if(this.worldFlipX){this.m00=-r*this.worldScaleX;this.m01=s*this.worldScaleY}else{this.m00=r*this.worldScaleX;this.m01=-s*this.worldScaleY}if(this.worldFlipY!=spine.Bone.yDown){this.m10=-s*this.worldScaleX;this.m11=-r*this.worldScaleY}else{this.m10=s*this.worldScaleX;this.m11=r*this.worldScaleY}},setToSetupPose:function(){var t=this.data;this.x=t.x;this.y=t.y;this.rotation=t.rotation;this.rotationIK=this.rotation;this.scaleX=t.scaleX;this.scaleY=t.scaleY;this.flipX=t.flipX;this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY;var n=this.m00,r=this.m10,s=this.m01,a=this.m11;if(this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)){n=-n;a=-a}var o=1/(n*a-s*r);t[0]=e*n*o-i*s*o;t[1]=i*a*o-e*r*o},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX;t[1]=e*this.m10+i*this.m11+this.worldY}};spine.Slot=function(t,e){this.r=this.g=this.b=this.a=1;this._attachmentTime=0;this.data=t;this.bone=e;this.setToSetupPose()};spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a;var e=this.bone.skeleton.data.slots;for(var i=0,n=e.length;i<n;i++){if(e[i]==t){this.setAttachment(!t.attachmentName?null:this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName));break}}}};spine.IkConstraint=function(t,e){this.data=t;this.mix=t.mix;this.bendDirection=t.bendDirection;this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)};spine.IkConstraint.prototype={apply:function(){var t=this.target;var e=this.bones;switch(e.length){case 1:spine.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix);break}}};spine.IkConstraint.apply1=function(t,e,i,n){var r=!t.data.inheritRotation||!t.parent?0:t.parent.worldRotation;var s=t.rotation;var a=Math.atan2(i-t.worldY,e-t.worldX)*spine.radDeg;if(t.worldFlipX!=(t.worldFlipY!=spine.Bone.yDown))a=-a;a-=r;t.rotationIK=s+(a-s)*n};spine.IkConstraint.apply2=function(t,e,i,n,r,s){var a=e.rotation,o=t.rotation;if(!s){e.rotationIK=a;t.rotationIK=o;return}var c,l,h=spine.temp;var u=t.parent;if(u){h[0]=i;h[1]=n;u.worldToLocal(h);i=(h[0]-t.x)*u.worldScaleX;n=(h[1]-t.y)*u.worldScaleY}else{i-=t.x;n-=t.y}if(e.parent==t){c=e.x;l=e.y}else{h[0]=e.x;h[1]=e.y;e.parent.localToWorld(h);t.worldToLocal(h);c=h[0];l=h[1]}var d=c*t.worldScaleX,_=l*t.worldScaleY;var f=Math.atan2(_,d);var p=Math.sqrt(d*d+_*_),m=e.data.length*e.worldScaleX;var g=2*p*m;if(g<1e-4){e.rotationIK=a+(Math.atan2(n,i)*spine.radDeg-o-a)*s;return}var v=(i*i+n*n-p*p-m*m)/g;if(v<-1)v=-1;else if(v>1)v=1;var y=Math.acos(v)*r;var T=p+m*v,C=m*Math.sin(y);var S=Math.atan2(n*T-i*C,i*T+n*C);var x=(S-f)*spine.radDeg-o;if(x>180)x-=360;else if(x<-180)x+=360;t.rotationIK=o+x*s;x=(y+f)*spine.radDeg-a;if(x>180)x-=360;else if(x<-180)x+=360;e.rotationIK=a+(x+t.worldRotation-e.parent.worldRotation)*s};spine.Skin=function(t){this.name=t;this.attachments={}};spine.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":");var r=parseInt(i.substring(0,n));var s=i.substring(n+1);var a=t.slots[r];if(a.attachment&&a.attachment.name==s){var o=this.getAttachment(r,s);if(o)a.setAttachment(o)}}}};spine.Animation=function(t,e,i){this.name=t;this.timelines=e;this.duration=i};spine.Animation.prototype={apply:function(t,e,i,n,r){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var s=this.timelines;for(var a=0,o=s.length;a<o;a++)s[a].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,s){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var a=this.timelines;for(var o=0,c=a.length;o<c;o++)a[o].apply(t,e,i,r,s)}};spine.Animation.binarySearch=function(t,e,i){var n=0;var r=Math.floor(t.length/i)-2;if(!r)return i;var s=r>>>1;while(true){if(t[(s+1)*i]<=e)n=s+1;else r=s;if(n==r)return(n+1)*i;s=n+r>>>1}};spine.Animation.binarySearch1=function(t,e){var i=0;var n=t.length-2;if(!n)return 1;var r=n>>>1;while(true){if(t[r+1]<=e)i=r+1;else n=r;if(i==n)return i+1;r=i+n>>>1}};spine.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1};spine.Curves=function(t){this.curves=[]};spine.Curves.prototype={setLinear:function(t){this.curves[t*19]=0},setStepped:function(t){this.curves[t*19]=1},setCurve:function(t,e,i,n,r){var s=1/10,a=s*s,o=a*s;var c=3*s,l=3*a,h=6*a,u=6*o;var d=-e*2+n,_=-i*2+r,f=(e-n)*3+1,p=(i-r)*3+1;var m=e*c+d*l+f*o,g=i*c+_*l+p*o;var v=d*h+f*u,y=_*h+p*u;var T=f*u,C=p*u;var S=t*19;var x=this.curves;x[S++]=2;var E=m,b=g;for(var A=S+19-1;S<A;S+=2){x[S]=E;x[S+1]=b;m+=v;g+=y;v+=T;y+=C;E+=m;b+=g}},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves;var n=t*19;var r=i[n];if(r===0)return e;if(r==1)return 0;n++;var s=0;for(var a=n,o=n+19-1;n<o;n+=2){s=i[n];if(s>=e){var c,l;if(n==a){c=0;l=0}else{c=i[n-2];l=i[n-1]}return l+(i[n+1]-l)*(e-c)/(s-c)}}var h=i[n-1];return h+(1-h)*(e-s)/(1-s)}};spine.RotateTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a=t.bones[this.boneIndex];if(i>=s[s.length-2]){var o=a.data.rotation+s[s.length-1]-a.rotation;while(o>180)o-=360;while(o<-180)o+=360;a.rotation+=o*r;return}var c=spine.Animation.binarySearch(s,i,2);var l=s[c-1];var h=s[c];var u=1-(i-h)/(s[c-2]-h);u=this.curves.getCurvePercent(c/2-1,u);var o=s[c+1]-l;while(o>180)o-=360;while(o<-180)o+=360;o=a.data.rotation+(l+o*u)-a.rotation;while(o>180)o-=360;while(o<-180)o+=360;a.rotation+=o*r}};spine.TranslateTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a=t.bones[this.boneIndex];if(i>=s[s.length-3]){a.x+=(a.data.x+s[s.length-2]-a.x)*r;a.y+=(a.data.y+s[s.length-1]-a.y)*r;return}var o=spine.Animation.binarySearch(s,i,3);var c=s[o-2];var l=s[o-1];var h=s[o];var u=1-(i-h)/(s[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u);a.x+=(a.data.x+c+(s[o+1]-c)*u-a.x)*r;a.y+=(a.data.y+l+(s[o+2]-l)*u-a.y)*r}};spine.ScaleTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a=t.bones[this.boneIndex];if(i>=s[s.length-3]){a.scaleX+=(a.data.scaleX*s[s.length-2]-a.scaleX)*r;a.scaleY+=(a.data.scaleY*s[s.length-1]-a.scaleY)*r;return}var o=spine.Animation.binarySearch(s,i,3);var c=s[o-2];var l=s[o-1];var h=s[o];var u=1-(i-h)/(s[o+-3]-h);u=this.curves.getCurvePercent(o/3-1,u);a.scaleX+=(a.data.scaleX*(c+(s[o+1]-c)*u)-a.scaleX)*r;a.scaleY+=(a.data.scaleY*(l+(s[o+2]-l)*u)-a.scaleY)*r}};spine.ColorTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*5};spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,s){t*=5;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n;this.frames[t+3]=r;this.frames[t+4]=s},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a,o,c,l;if(i>=s[s.length-5]){var h=s.length-1;a=s[h-3];o=s[h-2];c=s[h-1];l=s[h]}else{var u=spine.Animation.binarySearch(s,i,5);var d=s[u-4];var _=s[u-3];var f=s[u-2];var p=s[u-1];var m=s[u];var g=1-(i-m)/(s[u-5]-m);g=this.curves.getCurvePercent(u/5-1,g);a=d+(s[u+1]-d)*g;o=_+(s[u+2]-_)*g;c=f+(s[u+3]-f)*g;l=p+(s[u+4]-p)*g}var v=t.slots[this.slotIndex];if(r<1){v.r+=(a-v.r)*r;v.g+=(o-v.g)*r;v.b+=(c-v.b)*r;v.a+=(l-v.a)*r}else{v.r=a;v.g=o;v.b=c;v.a=l}}};spine.AttachmentTimeline=function(t){this.slotIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t;this.attachmentNames=[];this.attachmentNames.length=t};spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.attachmentNames[t]=i},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var a=i>=s[s.length-1]?s.length-1:spine.Animation.binarySearch1(s,i)-1;if(s[a]<e)return;var o=this.attachmentNames[a];t.slots[this.slotIndex].setAttachment(!o?null:t.getAttachmentBySlotIndex(this.slotIndex,o))}};spine.EventTimeline=function(t){this.frames=[];this.frames.length=t;this.events=[];this.events.length=t};spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.events[t]=i},apply:function(t,e,i,n,r){if(!n)return;var s=this.frames;var a=s.length;if(e>i){this.apply(t,e,Number.MAX_VALUE,n,r);e=-1}else if(e>=s[a-1])return;if(i<s[0])return;var o;if(e<s[0])o=0;else{o=spine.Animation.binarySearch1(s,e);var c=s[o];while(o>0){if(s[o-1]!=c)break;o--}}var l=this.events;for(;o<a&&i>=s[o];o++)n.push(l[o])}};spine.DrawOrderTimeline=function(t){this.frames=[];this.frames.length=t;this.drawOrders=[];this.drawOrders.length=t};spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.drawOrders[t]=i},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a;if(i>=s[s.length-1])a=s.length-1;else a=spine.Animation.binarySearch1(s,i)-1;var o=t.drawOrder;var c=t.slots;var l=this.drawOrders[a];if(!l){for(var h=0,u=c.length;h<u;h++)o[h]=c[h]}else{for(var h=0,u=l.length;h<u;h++)o[h]=t.slots[l[h]]}}};spine.FfdTimeline=function(t){this.slotIndex=this.attachment=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t;this.frameVertices=[];this.frameVertices.length=t};spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.frameVertices[t]=i},apply:function(t,e,i,n,r){var s=t.slots[this.slotIndex];if(s.attachment!=this.attachment)return;var a=this.frames;if(i<a[0])return;var o=this.frameVertices;var c=o[0].length;var l=s.attachmentVertices;if(l.length!=c)r=1;l.length=c;if(i>=a[a.length-1]){var h=o[a.length-1];if(r<1){for(var u=0;u<c;u++)l[u]+=(h[u]-l[u])*r}else{for(var u=0;u<c;u++)l[u]=h[u]}return}var d=spine.Animation.binarySearch1(a,i);var _=a[d];var f=1-(i-_)/(a[d-1]-_);f=this.curves.getCurvePercent(d-1,f<0?0:f>1?1:f);var p=o[d-1];var m=o[d];if(r<1){for(var u=0;u<c;u++){var g=p[u];l[u]+=(g+(m[u]-g)*f-l[u])*r}}else{for(var u=0;u<c;u++){var g=p[u];l[u]=g+(m[u]-g)*f}}}};spine.IkConstraintTimeline=function(t){this.ikConstraintIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return;var a=t.ikConstraints[this.ikConstraintIndex];if(i>=s[s.length-3]){a.mix+=(s[s.length-2]-a.mix)*r;a.bendDirection=s[s.length-1];return}var o=spine.Animation.binarySearch(s,i,3);var c=s[o+-2];var l=s[o];var h=1-(i-l)/(s[o+-3]-l);h=this.curves.getCurvePercent(o/3-1,h);var u=c+(s[o+1]-c)*h;a.mix+=(u-a.mix)*r;a.bendDirection=s[o+-1]}};spine.FlipXTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var a=(i>=s[s.length-2]?s.length:spine.Animation.binarySearch(s,i,2))-2;if(s[a]<e)return;t.bones[this.boneIndex].flipX=s[a+1]!=0}};spine.FlipYTimeline=function(t){this.boneIndex=0;this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var a=(i>=s[s.length-2]?s.length:spine.Animation.binarySearch(s,i,2))-2;if(s[a]<e)return;t.bones[this.boneIndex].flipY=s[a+1]!=0}};spine.SkeletonData=function(){this.width=this.height=0;this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[]};spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++){if(e[i].name==t)return slot[i]}return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){var e=this.skins;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){var e=this.events;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){var e=this.animations;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}};spine.Skeleton=function(t){this.x=this.y=0;this.r=this.g=this.b=this.a=1;this.time=0;this.flipX=this.flipY=false;this.data=t;this.bones=[];for(var e=0,i=t.bones.length;e<i;e++){var n=t.bones[e];var r=!n.parent?null:this.bones[t.bones.indexOf(n.parent)];this.bones.push(new spine.Bone(n,this,r))}this.slots=[];this.drawOrder=[];for(var e=0,i=t.slots.length;e<i;e++){var s=t.slots[e];var a=this.bones[t.bones.indexOf(s.boneData)];var o=new spine.Slot(s,a);this.slots.push(o);this.drawOrder.push(o)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;e<i;e++)this.ikConstraints.push(new spine.IkConstraint(t.ikConstraints[e],this));this.boneCache=[];this.updateCache()};spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:false,flipY:false,updateCache:function(){var t=this.ikConstraints;var e=t.length;var i=e+1;var n=this.boneCache;if(n.length>i)n.length=i;for(var r=0,s=n.length;r<s;r++)n[r].length=0;while(n.length<i)n[n.length]=[];var a=n[0];var o=this.bones;t:for(var r=0,s=o.length;r<s;r++){var c=o[r];var l=c;do{for(var h=0;h<e;h++){var u=t[h];var d=u.bones[0];var _=u.bones[u.bones.length-1];while(true){if(l==_){n[h].push(c);n[h+1].push(c);continue t}if(_==d)break;_=_.parent}}l=l.parent}while(l);a[a.length]=c}},updateWorldTransform:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}var e=0,r=this.boneCache.length-1;while(true){var s=this.boneCache[e];for(var a=0,o=s.length;a<o;a++)s[a].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply();e++}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(var e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection;r.mix=r.data.mix}},setSlotsToSetupPose:function(){var t=this.slots;var e=this.drawOrder;for(var i=0,n=t.length;i<n;i++){e[i]=t[i];t[i].setToSetupPose(i)}},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)},setSkin:function(t){if(t){if(this.skin)t._attachAll(this,this.skin);else{var e=this.slots;for(var i=0,n=e.length;i<n;i++){var r=e[i];var s=r.data.attachmentName;if(s){var a=t.getAttachment(i,s);if(a)r.setAttachment(a);
}}}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(t,e);return null},setAttachment:function(t,e){var i=this.slots;for(var n=0,r=i.length;n<r;n++){var s=i[n];if(s.data.name==t){var a=null;if(e){a=this.getAttachmentBySlotIndex(n,e);if(!a)throw new Error("Attachment not found: "+e+", for slot: "+t)}s.setAttachment(a);return}}throw new Error("Slot not found: "+t)},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}};spine.EventData=function(t){this.intValue=this.floatValue=0;this.name=t};spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null};spine.Event=function(t){this.intValue=this.floatValue=0;this.data=t};spine.Event.prototype={intValue:0,floatValue:0,stringValue:null};spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};spine.RegionAttachment=function(t){this.type=spine.AttachmentType.region;this.x=this.y=this.rotation=0;this.scaleX=this.scaleY=1;this.width=this.height=0;this.r=this.g=this.b=this.a=1;this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0;this.name=t;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};spine.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var s=this.uvs;if(r){s[2]=t;s[3]=n;s[4]=t;s[5]=e;s[6]=i;s[7]=e;s[0]=i;s[1]=n}else{s[0]=t;s[1]=n;s[2]=t;s[3]=e;s[4]=i;s[5]=e;s[6]=i;s[7]=n}},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX;var e=this.height/this.regionOriginalHeight*this.scaleY;var i=-this.width/2*this.scaleX+this.regionOffsetX*t;var n=-this.height/2*this.scaleY+this.regionOffsetY*e;var r=i+this.regionWidth*t;var s=n+this.regionHeight*e;var a=this.rotation*spine.degRad;var o=Math.cos(a);var c=Math.sin(a);var l=i*o+this.x;var h=i*c;var u=n*o+this.y;var d=n*c;var _=r*o+this.x;var f=r*c;var p=s*o+this.y;var m=s*c;var g=this.offset;g[0]=l-d;g[1]=u+h;g[2]=l-m;g[3]=p+h;g[4]=_-m;g[5]=p+f;g[6]=_-d;g[7]=u+f},computeVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.m00,s=i.m01,a=i.m10,o=i.m11;var c=this.offset;n[0]=c[0]*r+c[1]*s+t;n[1]=c[0]*a+c[1]*o+e;n[2]=c[2]*r+c[3]*s+t;n[3]=c[2]*a+c[3]*o+e;n[4]=c[4]*r+c[5]*s+t;n[5]=c[4]*a+c[5]*o+e;n[6]=c[6]*r+c[7]*s+t;n[7]=c[6]*a+c[7]*o+e}};spine.MeshAttachment=function(t){this.type=spine.AttachmentType.mesh;this.hullLength=0;this.r=this.g=this.b=this.a=1;this.regionU=this.regionV=this.regionV2=0;this.regionRotate=false;this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0;this.width=this.height=0;this.name=t};spine.MeshAttachment.prototype={vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV;var i=this.regionUVs.length;if(!this.uvs||this.uvs.length!=i){this.uvs=new spine.Float32Array(i)}if(this.regionRotate){for(var n=0;n<i;n+=2){this.uvs[n]=this.regionU+this.regionUVs[n+1]*t;this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e}}else{for(var n=0;n<i;n+=2){this.uvs[n]=this.regionU+this.regionUVs[n]*t;this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e}}},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX;e+=r.worldY;var s=r.m00,a=r.m01,o=r.m10,c=r.m11;var l=this.vertices;var h=l.length;if(i.attachmentVertices.length==h)l=i.attachmentVertices;for(var u=0;u<h;u+=2){var d=l[u];var _=l[u+1];n[u]=d*s+_*a+t;n[u+1]=d*o+_*c+e}}};spine.SkinnedMeshAttachment=function(t){this.type=spine.AttachmentType.skinnedmesh;this.hullLength=0;this.r=this.g=this.b=this.a=1;this.regionU=this.regionV=this.regionU2=this.regionV2=0;this.regionRotate=false;this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0;this.width=this.height=0;this.name=t};spine.SkinnedMeshAttachment.prototype={bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,n,r){var s=this.regionU2-this.regionU,a=this.regionV2-this.regionV;var o=this.regionUVs.length;if(!this.uvs||this.uvs.length!=o){this.uvs=new spine.Float32Array(o)}if(this.regionRotate){for(var c=0;c<o;c+=2){this.uvs[c]=this.regionU+this.regionUVs[c+1]*s;this.uvs[c+1]=this.regionV+a-this.regionUVs[c]*a}}else{for(var c=0;c<o;c+=2){this.uvs[c]=this.regionU+this.regionUVs[c]*s;this.uvs[c+1]=this.regionV+this.regionUVs[c+1]*a}}},computeWorldVertices:function(t,e,i,n){var r=i.bone.skeleton.bones;var s=this.weights;var a=this.bones;var o=0,c=0,l=0,h=0,u=a.length,d;var _,f,p,m,g,v;if(!i.attachmentVertices.length){for(;c<u;o+=2){_=0;f=0;d=a[c++]+c;for(;c<d;c++,l+=3){p=r[a[c]];m=s[l];g=s[l+1];v=s[l+2];_+=(m*p.m00+g*p.m01+p.worldX)*v;f+=(m*p.m10+g*p.m11+p.worldY)*v}n[o]=_+t;n[o+1]=f+e}}else{var y=i.attachmentVertices;for(;c<u;o+=2){_=0;f=0;d=a[c++]+c;for(;c<d;c++,l+=3,h+=2){p=r[a[c]];m=s[l]+y[h];g=s[l+1]+y[h+1];v=s[l+2];_+=(m*p.m00+g*p.m01+p.worldX)*v;f+=(m*p.m10+g*p.m11+p.worldY)*v}n[o]=_+t;n[o+1]=f+e}}}};spine.BoundingBoxAttachment=function(t){this.type=spine.AttachmentType.boundingbox;this.name=t;this.vertices=[]};spine.BoundingBoxAttachment.prototype={computeWorldVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.m00,s=i.m01,a=i.m10,o=i.m11;var c=this.vertices;for(var l=0,h=c.length;l<h;l+=2){var u=c[l];var d=c[l+1];n[l]=u*r+d*s+t;n[l+1]=u*a+d*o+e}}};spine.AnimationStateData=function(t){this.skeletonData=t;this.animationToMixTime={};this.defaultMix=0};spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}};spine.TrackEntry=function(){this.delay=this.time=this.endTime=0;this.lastTime=-1;this.timeScale=1;this.mixTime=this.mixDuration=1;this.mix=1};spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:false,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};spine.AnimationState=function(t){this.timeScale=1;this.data=t;this.tracks=[];this.events=[]};spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;i.time+=t*i.timeScale;if(i.previous){var n=t*i.previous.timeScale;i.previous.time+=n;i.mixTime+=n}var r=i.next;if(r){r.time=i.lastTime-r.delay;if(r.time>=0)this.setCurrent(e,r)}else{if(!i.loop&&i.lastTime>=i.endTime)this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;this.events.length=0;var n=i.time;var r=i.lastTime;var s=i.endTime;var a=i.loop;if(!a&&n>s)n=s;var o=i.previous;if(!o){if(i.mix==1)i.animation.apply(t,i.lastTime,n,a,this.events);else i.animation.mix(t,i.lastTime,n,a,this.events,i.mix)}else{var c=o.time;if(!o.loop&&c>o.endTime)c=o.endTime;o.animation.apply(t,c,c,o.loop,null);var l=i.mixTime/i.mixDuration*i.mix;if(l>=1){l=1;i.previous=null}i.animation.mix(t,i.lastTime,n,a,this.events,l)}for(var h=0,u=this.events.length;h<u;h++){var d=this.events[h];if(i.onEvent)i.onEvent(e,d);if(this.onEvent)this.onEvent(e,d)}if(a?r%s>n%s:r<s&&n>=s){var _=Math.floor(n/s);if(i.onComplete)i.onComplete(e,_);if(this.onComplete)this.onComplete(e,_)}i.lastTime=i.time}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(t>=this.tracks.length)return;var e=this.tracks[t];if(!e)return;if(e.onEnd)e.onEnd(t);if(this.onEnd)this.onEnd(t);this.tracks[t]=null},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];while(t>=this.tracks.length)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null;if(i.onEnd)i.onEnd(t);if(this.onEnd)this.onEnd(t);e.mixDuration=this.data.getMix(i.animation,e.animation);if(e.mixDuration>0){e.mixTime=0;if(n&&i.mixTime/i.mixDuration<.5)e.previous=n;else e.previous=i}}this.tracks[t]=e;if(e.onStart)e.onStart(t);if(this.onStart)this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var n=new spine.TrackEntry;n.animation=e;n.loop=i;n.endTime=e.duration;this.setCurrent(t,n);return n},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,n){var r=new spine.TrackEntry;r.animation=e;r.loop=i;r.endTime=e.duration;var s=this._expandToIndex(t);if(s){while(s.next)s=s.next;s.next=r}else this.tracks[t]=r;if(n<=0){if(s)n+=s.endTime-this.data.getMix(s.animation,e);else n=0}r.delay=n;return r},getCurrent:function(t){if(t>=this.tracks.length)return null;return this.tracks[t]}};spine.SkeletonJson=function(t){this.scale=1;this.attachmentLoader=t};spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new spine.SkeletonData;i.name=e;var n=t["skeleton"];if(n){i.hash=n["hash"];i.version=n["spine"];i.width=n["width"]||0;i.height=n["height"]||0}var r=t["bones"];for(var s=0,a=r.length;s<a;s++){var o=r[s];var c=null;if(o["parent"]){c=i.findBone(o["parent"]);if(!c)throw new Error("Parent bone not found: "+o["parent"])}var l=new spine.BoneData(o["name"],c);l.length=(o["length"]||0)*this.scale;l.x=(o["x"]||0)*this.scale;l.y=(o["y"]||0)*this.scale;l.rotation=o["rotation"]||0;l.scaleX=o.hasOwnProperty("scaleX")?o["scaleX"]:1;l.scaleY=o.hasOwnProperty("scaleY")?o["scaleY"]:1;l.inheritScale=o.hasOwnProperty("inheritScale")?o["inheritScale"]:true;l.inheritRotation=o.hasOwnProperty("inheritRotation")?o["inheritRotation"]:true;i.bones.push(l)}var h=t["ik"];if(h){for(var s=0,a=h.length;s<a;s++){var u=h[s];var d=new spine.IkConstraintData(u["name"]);var r=u["bones"];for(var _=0,f=r.length;_<f;_++){var p=i.findBone(r[_]);if(!p)throw new Error("IK bone not found: "+r[_]);d.bones.push(p)}d.target=i.findBone(u["target"]);if(!d.target)throw new Error("Target bone not found: "+u["target"]);d.bendDirection=!u.hasOwnProperty("bendPositive")||u["bendPositive"]?1:-1;d.mix=u.hasOwnProperty("mix")?u["mix"]:1;i.ikConstraints.push(d)}}var m=t["slots"];for(var s=0,a=m.length;s<a;s++){var g=m[s];var l=i.findBone(g["bone"]);if(!l)throw new Error("Slot bone not found: "+g["bone"]);var v=new spine.SlotData(g["name"],l);var y=g["color"];if(y){v.r=this.toColor(y,0);v.g=this.toColor(y,1);v.b=this.toColor(y,2);v.a=this.toColor(y,3)}v.attachmentName=g["attachment"];v.blendMode=spine.AttachmentType[g["blend"]||"normal"];i.slots.push(v)}var T=t["skins"];for(var C in T){if(!T.hasOwnProperty(C))continue;var S=T[C];var x=new spine.Skin(C);for(var E in S){if(!S.hasOwnProperty(E))continue;var b=i.findSlotIndex(E);var A=S[E];for(var R in A){if(!A.hasOwnProperty(R))continue;var P=this.readAttachment(x,R,A[R]);if(P)x.addAttachment(b,R,P)}}i.skins.push(x);if(x.name=="default")i.defaultSkin=x}var w=t["events"];for(var I in w){if(!w.hasOwnProperty(I))continue;var D=w[I];var L=new spine.EventData(I);L.intValue=D["int"]||0;L.floatValue=D["float"]||0;L.stringValue=D["string"]||null;i.events.push(L)}var O=t["animations"];for(var B in O){if(!O.hasOwnProperty(B))continue;this.readAnimation(B,O[B],i)}return i},readAttachment:function(t,e,i){e=i["name"]||e;var n=spine.AttachmentType[i["type"]||"region"];var r=i["path"]||e;var s=this.scale;if(n==spine.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,r);if(!a)return null;a.path=r;a.x=(i["x"]||0)*s;a.y=(i["y"]||0)*s;a.scaleX=i.hasOwnProperty("scaleX")?i["scaleX"]:1;a.scaleY=i.hasOwnProperty("scaleY")?i["scaleY"]:1;a.rotation=i["rotation"]||0;a.width=(i["width"]||0)*s;a.height=(i["height"]||0)*s;var o=i["color"];if(o){a.r=this.toColor(o,0);a.g=this.toColor(o,1);a.b=this.toColor(o,2);a.a=this.toColor(o,3)}a.updateOffset();return a}else if(n==spine.AttachmentType.mesh){var c=this.attachmentLoader.newMeshAttachment(t,e,r);if(!c)return null;c.path=r;c.vertices=this.getFloatArray(i,"vertices",s);c.triangles=this.getIntArray(i,"triangles");c.regionUVs=this.getFloatArray(i,"uvs",1);c.updateUVs();o=i["color"];if(o){c.r=this.toColor(o,0);c.g=this.toColor(o,1);c.b=this.toColor(o,2);c.a=this.toColor(o,3)}c.hullLength=(i["hull"]||0)*2;if(i["edges"])c.edges=this.getIntArray(i,"edges");c.width=(i["width"]||0)*s;c.height=(i["height"]||0)*s;return c}else if(n==spine.AttachmentType.skinnedmesh){var c=this.attachmentLoader.newSkinnedMeshAttachment(t,e,r);if(!c)return null;c.path=r;var l=this.getFloatArray(i,"uvs",1);var h=this.getFloatArray(i,"vertices",1);var u=[];var d=[];for(var _=0,f=h.length;_<f;){var p=h[_++]|0;d[d.length]=p;for(var m=_+p*4;_<m;){d[d.length]=h[_];u[u.length]=h[_+1]*s;u[u.length]=h[_+2]*s;u[u.length]=h[_+3];_+=4}}c.bones=d;c.weights=u;c.triangles=this.getIntArray(i,"triangles");c.regionUVs=l;c.updateUVs();o=i["color"];if(o){c.r=this.toColor(o,0);c.g=this.toColor(o,1);c.b=this.toColor(o,2);c.a=this.toColor(o,3)}c.hullLength=(i["hull"]||0)*2;if(i["edges"])c.edges=this.getIntArray(i,"edges");c.width=(i["width"]||0)*s;c.height=(i["height"]||0)*s;return c}else if(n==spine.AttachmentType.boundingbox){var g=this.attachmentLoader.newBoundingBoxAttachment(t,e);var h=i["vertices"];for(var _=0,f=h.length;_<f;_++)g.vertices.push(h[_]*s);return g}throw new Error("Unknown attachment type: "+n)},readAnimation:function(t,e,i){var n=[];var r=0;var s=e["slots"];for(var a in s){if(!s.hasOwnProperty(a))continue;var o=s[a];var c=i.findSlotIndex(a);for(var l in o){if(!o.hasOwnProperty(l))continue;var h=o[l];if(l=="color"){var u=new spine.ColorTimeline(h.length);u.slotIndex=c;var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];var m=p["color"];var g=this.toColor(m,0);var v=this.toColor(m,1);var y=this.toColor(m,2);var T=this.toColor(m,3);u.setFrame(d,p["time"],g,v,y,T);this.readCurve(u,d,p);d++}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()*5-5])}else if(l=="attachment"){var u=new spine.AttachmentTimeline(h.length);u.slotIndex=c;var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];u.setFrame(d++,p["time"],p["name"])}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()-1])}else throw new Error("Invalid timeline type for a slot: "+l+" ("+a+")")}}var C=e["bones"];for(var S in C){if(!C.hasOwnProperty(S))continue;var x=i.findBoneIndex(S);if(x==-1)throw new Error("Bone not found: "+S);var E=C[S];for(var l in E){if(!E.hasOwnProperty(l))continue;var h=E[l];if(l=="rotate"){var u=new spine.RotateTimeline(h.length);u.boneIndex=x;var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];u.setFrame(d,p["time"],p["angle"]);this.readCurve(u,d,p);d++}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()*2-2])}else if(l=="translate"||l=="scale"){var u;var b=1;if(l=="scale")u=new spine.ScaleTimeline(h.length);else{u=new spine.TranslateTimeline(h.length);b=this.scale}u.boneIndex=x;var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];var A=(p["x"]||0)*b;var R=(p["y"]||0)*b;u.setFrame(d,p["time"],A,R);this.readCurve(u,d,p);d++}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()*3-3])}else if(l=="flipX"||l=="flipY"){var A=l=="flipX";var u=A?new spine.FlipXTimeline(h.length):new spine.FlipYTimeline(h.length);u.boneIndex=x;var P=A?"x":"y";var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];u.setFrame(d,p["time"],p[P]||false);d++}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()*2-2])}else throw new Error("Invalid timeline type for a bone: "+l+" ("+S+")")}}var w=e["ik"];for(var I in w){if(!w.hasOwnProperty(I))continue;var D=i.findIkConstraint(I);var h=w[I];var u=new spine.IkConstraintTimeline(h.length);u.ikConstraintIndex=i.ikConstraints.indexOf(D);var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];var L=p.hasOwnProperty("mix")?p["mix"]:1;var O=!p.hasOwnProperty("bendPositive")||p["bendPositive"]?1:-1;u.setFrame(d,p["time"],L,O);this.readCurve(u,d,p);d++}n.push(u);r=Math.max(r,u.frames[u.frameCount*3-3])}var B=e["ffd"];for(var F in B){var N=i.findSkin(F);var o=B[F];for(a in o){var c=i.findSlotIndex(a);var M=o[a];for(var V in M){var h=M[V];var u=new spine.FfdTimeline(h.length);var k=N.getAttachment(c,V);if(!k)throw new Error("FFD attachment not found: "+V);u.slotIndex=c;u.attachment=k;var W=k.type==spine.AttachmentType.mesh;var G;if(W)G=k.vertices.length;else G=k.weights.length/3*2;var d=0;for(var _=0,f=h.length;_<f;_++){var p=h[_];var z;if(!p["vertices"]){if(W)z=k.vertices;else{z=[];z.length=G}}else{var U=p["vertices"];var z=[];z.length=G;var Y=p["offset"]||0;var X=U.length;if(this.scale==1){for(var H=0;H<X;H++)z[H+Y]=U[H]}else{for(var H=0;H<X;H++)z[H+Y]=U[H]*this.scale}if(W){var j=k.vertices;for(var H=0,X=z.length;H<X;H++)z[H]+=j[H]}}u.setFrame(d,p["time"],z);this.readCurve(u,d,p);d++}n[n.length]=u;r=Math.max(r,u.frames[u.frameCount-1])}}}var q=e["drawOrder"];if(!q)q=e["draworder"];if(q){var u=new spine.DrawOrderTimeline(q.length);var J=i.slots.length;var d=0;for(var _=0,f=q.length;_<f;_++){var Z=q[_];var K=null;if(Z["offsets"]){K=[];K.length=J;for(var H=J-1;H>=0;H--)K[H]=-1;var Q=Z["offsets"];var $=[];$.length=J-Q.length;var tt=0,et=0;for(var H=0,X=Q.length;H<X;H++){var it=Q[H];var c=i.findSlotIndex(it["slot"]);if(c==-1)throw new Error("Slot not found: "+it["slot"]);while(tt!=c)$[et++]=tt++;K[tt+it["offset"]]=tt++}while(tt<J)$[et++]=tt++;for(var H=J-1;H>=0;H--)if(K[H]==-1)K[H]=$[--et]}u.setFrame(d++,Z["time"],K)}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()-1])}var nt=e["events"];if(nt){var u=new spine.EventTimeline(nt.length);var d=0;for(var _=0,f=nt.length;_<f;_++){var rt=nt[_];var st=i.findEvent(rt["name"]);if(!st)throw new Error("Event not found: "+rt["name"]);var at=new spine.Event(st);at.intValue=rt.hasOwnProperty("int")?rt["int"]:st.intValue;at.floatValue=rt.hasOwnProperty("float")?rt["float"]:st.floatValue;at.stringValue=rt.hasOwnProperty("string")?rt["string"]:st.stringValue;u.setFrame(d++,rt["time"],at)}n.push(u);r=Math.max(r,u.frames[u.getFrameCount()-1])}i.animations.push(new spine.Animation(t,n,r))},readCurve:function(t,e,i){var n=i["curve"];if(!n)t.curves.setLinear(e);else if(n=="stepped")t.curves.setStepped(e);else if(n instanceof Array)t.curves.setCurve(e,n[0],n[1],n[2],n[3])},toColor:function(t,e){if(t.length!=8)throw new Error("Color hexidecimal length must be 8, recieved: "+t);return parseInt(t.substring(e*2,e*2+2),16)/255},getFloatArray:function(t,e,i){var n=t[e];var r=new spine.Float32Array(n.length);var s=0,a=n.length;if(i==1){for(;s<a;s++)r[s]=n[s]}else{for(;s<a;s++)r[s]=n[s]*i}return r},getIntArray:function(t,e){var i=t[e];var n=new spine.Uint16Array(i.length);for(var r=0,s=i.length;r<s;r++)n[r]=i[r]|0;return n}};spine.Atlas=function(t,e){this.textureLoader=e;this.pages=[];this.regions=[];var i=new spine.AtlasReader(t);var n=[];n.length=4;var r=null;while(true){var s=i.readLine();if(s===null)break;s=i.trim(s);if(!s.length)r=null;else if(!r){r=new spine.AtlasPage;r.name=s;if(i.readTuple(n)==2){r.width=parseInt(n[0]);r.height=parseInt(n[1]);i.readTuple(n)}r.format=spine.Atlas.Format[n[0]];i.readTuple(n);r.minFilter=spine.Atlas.TextureFilter[n[0]];r.magFilter=spine.Atlas.TextureFilter[n[1]];var a=i.readValue();r.uWrap=spine.Atlas.TextureWrap.clampToEdge;r.vWrap=spine.Atlas.TextureWrap.clampToEdge;if(a=="x")r.uWrap=spine.Atlas.TextureWrap.repeat;else if(a=="y")r.vWrap=spine.Atlas.TextureWrap.repeat;else if(a=="xy")r.uWrap=r.vWrap=spine.Atlas.TextureWrap.repeat;e.load(r,s,this);this.pages.push(r)}else{var o=new spine.AtlasRegion;o.name=s;o.page=r;o.rotate=i.readValue()=="true";i.readTuple(n);var c=parseInt(n[0]);var l=parseInt(n[1]);i.readTuple(n);var h=parseInt(n[0]);var u=parseInt(n[1]);o.u=c/r.width;o.v=l/r.height;if(o.rotate){o.u2=(c+u)/r.width;o.v2=(l+h)/r.height}else{o.u2=(c+h)/r.width;o.v2=(l+u)/r.height}o.x=c;o.y=l;o.width=Math.abs(h);o.height=Math.abs(u);if(i.readTuple(n)==4){o.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];if(i.readTuple(n)==4){o.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];i.readTuple(n)}}o.originalWidth=parseInt(n[0]);o.originalHeight=parseInt(n[1]);i.readTuple(n);o.offsetX=parseInt(n[0]);o.offsetY=parseInt(n[1]);o.index=parseInt(i.readValue());this.regions.push(o)}}};spine.Atlas.prototype={findRegion:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){var t=this.pages;for(var e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.page!=t)continue;r.u=r.x/t.width;r.v=r.y/t.height;if(r.rotate){r.u2=(r.x+r.height)/t.width;r.v2=(r.y+r.width)/t.height}else{r.u2=(r.x+r.width)/t.width;r.v2=(r.y+r.height)/t.height}}}};spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};spine.AtlasPage=function(){this.width=this.height=0};spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};spine.AtlasRegion=function(){this.x=this.y=this.width=this.height=this.u=this.v=this.u2=this.v2=this.offsetX=this.offsetY=this.originalWidth=this.originalHeight=0;this.index=0};spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:false,splits:null,pads:null};spine.AtlasReader=function(t){this.index=0;this.lines=t.split(/\r\n|\r|\n/)};spine.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]},readValue:function(){var t=this.readLine();var e=t.indexOf(":");if(e==-1)throw new Error("Invalid line: "+t);return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine();var i=e.indexOf(":");if(i==-1)throw new Error("Invalid line: "+e);var n=0,r=i+1;for(;n<3;n++){var s=e.indexOf(",",r);if(s==-1)break;t[n]=this.trim(e.substr(r,s-r));r=s+1}t[n]=this.trim(e.substring(r));return n+1}};spine.AtlasAttachmentLoader=function(t){this.atlas=t};spine.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (region attachment: "+e+")");var r=new spine.RegionAttachment(e);r.rendererObject=n;r.setUVs(n.u,n.v,n.u2,n.v2,n.rotate);r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (mesh attachment: "+e+")");var r=new spine.MeshAttachment(e);r.rendererObject=n;r.regionU=n.u;r.regionV=n.v;r.regionU2=n.u2;r.regionV2=n.v2;r.regionRotate=n.rotate;r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newSkinnedMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")");var r=new spine.SkinnedMeshAttachment(e);r.rendererObject=n;r.regionU=n.u;r.regionV=n.v;r.regionU2=n.u2;r.regionV2=n.v2;r.regionRotate=n.rotate;r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newBoundingBoxAttachment:function(t,e){return new spine.BoundingBoxAttachment(e)}};spine.SkeletonBounds=function(){this.minX=this.minY=this.maxX=this.maxY=0;this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots;var n=i.length;var r=t.x,s=t.y;var a=this.boundingBoxes;var o=this.polygonPool;var c=this.polygons;a.length=0;for(var l=0,h=c.length;l<h;l++)o.push(c[l]);c.length=0;for(var l=0;l<n;l++){var u=i[l];var d=u.attachment;if(d.type!=spine.AttachmentType.boundingbox)continue;a.push(d);var _=o.length,f;if(_>0){f=o[_-1];o.splice(_-1,1)}else f=[];c.push(f);f.length=d.vertices.length;d.computeWorldVertices(r,s,u.bone,f)}if(e)this.aabbCompute()},aabbCompute:function(){var t=this.polygons;var e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE;for(var s=0,a=t.length;s<a;s++){var o=t[s];for(var c=0,l=o.length;c<l;c+=2){var h=o[c];var u=o[c+1];e=Math.min(e,h);i=Math.min(i,u);n=Math.max(n,h);r=Math.max(r,u)}}this.minX=e;this.minY=i;this.maxX=n;this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=r&&i<=r||e<=s&&n<=s||t>=a&&i>=a||e>=o&&n>=o)return false;var c=(n-e)/(i-t);var l=c*(r-t)+e;if(l>s&&l<o)return true;l=c*(a-t)+e;if(l>s&&l<o)return true;var h=(s-e)/c+t;if(h>r&&h<a)return true;h=(o-e)/c+t;if(h>r&&h<a)return true;return false},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){var i=this.polygons;for(var n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){var r=this.polygons;for(var s=0,a=r.length;s<a;s++)if(r[s].intersectsSegment(t,e,i,n))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,i){var n=t.length;var r=n-2;var s=false;for(var a=0;a<n;a+=2){var o=t[a+1];var c=t[r+1];if(o<i&&c>=i||c<i&&o>=i){var l=t[a];if(l+(i-o)/(c-o)*(t[r]-l)<e)s=!s}r=a}return s},polygonIntersectsSegment:function(t,e,i,n,r){var s=t.length;var a=e-n,o=i-r;var c=e*r-i*n;var l=t[s-2],h=t[s-1];for(var u=0;u<s;u+=2){var d=t[u],_=t[u+1];var f=l*_-h*d;var p=l-d,m=h-_;var g=a*m-o*p;var v=(c*p-a*f)/g;if((v>=l&&v<=d||v>=d&&v<=l)&&(v>=e&&v<=n||v>=n&&v<=e)){var y=(c*m-o*f)/g;if((y>=h&&y<=_||y>=_&&y<=h)&&(y>=i&&y<=r||y>=r&&y<=i))return true}l=d;h=_}return false},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return e==-1?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};sp._atlasPage_createTexture_webGL=function(t,e){var i=cc.textureCache.addImage(e);t.rendererObject=new cc.TextureAtlas(i,128);t.width=i.getPixelsWide();t.height=i.getPixelsHigh()};sp._atlasPage_createTexture_canvas=function(t,e){t._texture=cc.textureCache.addImage(e)};sp._atlasPage_disposeTexture=function(t){t.rendererObject.release()};sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e,i){var n=cc.path.join(cc.path.dirname(this.spAtlasFile),e);if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)sp._atlasPage_createTexture_webGL(t,n);else sp._atlasPage_createTexture_canvas(t,n)},unload:function(t){}};sp.ANIMATION_EVENT_TYPE={START:0,END:1,COMPLETE:2,EVENT:3};sp.TrackEntryListeners=function(t,e,i,n){this.startListener=t||null;this.endListener=e||null;this.completeListener=i||null;this.eventListener=n||null};sp.TrackEntryListeners.getListeners=function(t){if(!t.rendererObject){t.rendererObject=new sp.TrackEntryListeners;t.listener=sp.trackEntryCallback}return t.rendererObject};sp.trackEntryCallback=function(t,e,i,n,r){t.rendererObject.onTrackEntryEvent(e,i,n,r)};sp.SkeletonAnimation=sp.Skeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:false,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){sp.Skeleton.prototype.init.call(this);this._ownsAnimationStateData=true;this.setAnimationStateData(new spine.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var e=new spine.AnimationState(t);e.rendererObject=this;e.onStart=this._onAnimationStateStart.bind(this);e.onComplete=this._onAnimationStateComplete.bind(this);e.onEnd=this._onAnimationStateEnd.bind(this);e.onEvent=this._onAnimationStateEvent.bind(this);this._state=e},setMix:function(t,e,i){this._state.data.setMixByName(t,e,i)},setAnimationListener:function(t,e){this._target=t;this._callback=e},setAnimation:function(t,e,i){var n=this._skeleton.data.findAnimation(e);if(!n){cc.log("Spine: Animation not found: "+e);return null}return this._state.setAnimation(t,n,i)},addAnimation:function(t,e,i,n){n=n==null?0:n;var r=this._skeleton.data.findAnimation(e);if(!r){cc.log("Spine: Animation not found:"+e);return null}return this._state.addAnimation(t,r,i,n)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t);t*=this._timeScale;this._state.update(t);this._state.apply(this._skeleton);this._skeleton.updateWorldTransform();this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,i,n){var r=this._state.getCurrent(t);if(!r.rendererObject)return;var s=r.rendererObject;switch(e){case sp.ANIMATION_EVENT_TYPE.START:if(s.startListener)s.startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:if(s.endListener)s.endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:if(s.completeListener)s.completeListener(t,n);break;case sp.ANIMATION_EVENT_TYPE.EVENT:if(s.eventListener)s.eventListener(t,i);break}},onAnimationStateEvent:function(t,e,i,n){switch(e){case sp.ANIMATION_EVENT_TYPE.START:if(this._startListener)this._startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:if(this._endListener)this._endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:if(this._completeListener)this._completeListener(t,n);break;case sp.ANIMATION_EVENT_TYPE.EVENT:if(this._eventListener)this._eventListener(t,i);break}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.END,null,0);
},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.EVENT,e,0)},_animationStateCallback:function(t,e,i,n){this.onAnimationStateEvent(t,e,i,n);if(this._target&&this._callback){this._callback.call(this._target,this,t,e,i,n)}}});sp.SkeletonAnimation.create=function(t,e,i){return new sp.SkeletonAnimation(t,e,i)};(function(){sp.Skeleton.CanvasRenderCmd=function(t){cc.Node.CanvasRenderCmd.call(this,t);this._needDraw=true};var t=sp.Skeleton.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);t.constructor=sp.Skeleton.CanvasRenderCmd;t.rendering=function(t,e,i){var n=this._node,r,s,a,o;t=t||cc._renderContext;var c=n._skeleton,l=c.drawOrder;for(r=0,s=l.length;r<s;r++){a=l[r];o=a._slotNode;if(o._visible&&o._renderCmd&&a.currentSprite){o._renderCmd.transform(this,true);a.currentSprite._renderCmd.rendering(t,e,i);o._renderCmd._dirtyFlag=a.currentSprite._renderCmd._dirtyFlag=0}}if(!n._debugSlots&&!n._debugBones)return;t.setTransform(this._worldTransform,e,i);t.setGlobalAlpha(1);var h,u=cc._drawingUtil;if(n._debugSlots){u.setDrawColor(0,0,255,255);u.setLineWidth(1);var d=[];for(r=0,s=c.slots.length;r<s;r++){a=c.drawOrder[r];if(!a.attachment||a.attachment.type!=sp.ATTACHMENT_TYPE.REGION)continue;h=a.attachment;this._updateRegionAttachmentSlot(h,a,d);u.drawPoly(d,4,true)}}if(n._debugBones){var _;u.setLineWidth(2);u.setDrawColor(255,0,0,255);for(r=0,s=c.bones.length;r<s;r++){_=c.bones[r];var f=_.data.length*_.m00+_.worldX;var p=_.data.length*_.m10+_.worldY;u.drawLine({x:_.worldX,y:_.worldY},{x:f,y:p})}u.setPointSize(4);u.setDrawColor(0,0,255,255);for(r=0,s=c.bones.length;r<s;r++){_=c.bones[r];u.drawPoint({x:_.worldX,y:_.worldY});if(r===0)u.setDrawColor(0,255,0,255)}}};t._updateRegionAttachmentSlot=function(t,e,i){if(!i)return;var n={},r=sp.VERTEX_INDEX,s=e.bone;t.computeVertices(s.skeleton.x,s.skeleton.y,s,n);i.length=0;i.push(cc.p(n[r.X1],n[r.Y1]));i.push(cc.p(n[r.X4],n[r.Y4]));i.push(cc.p(n[r.X3],n[r.Y3]));i.push(cc.p(n[r.X2],n[r.Y2]))};t._createChildFormSkeletonData=function(){var t=this._node;var e=t._skeleton,i,n;for(var r=0,s=e.slots.length;r<s;r++){var a=e.slots[r],o=a.attachment;var c=new cc.Node;a._slotNode=c;if(o instanceof spine.RegionAttachment){i=o.rendererObject.name;n=this._createSprite(a,o);a.currentSprite=n;a.currentSpriteName=i;c.addChild(n)}else if(o instanceof spine.MeshAttachment){}}};t._createSprite=function(t,e){var i=e.rendererObject;var n=i.page._texture;var r=new cc.Rect(i.x,i.y,i.width,i.height);var s=new cc.Sprite;s.initWithTexture(i.page._texture,r,i.rotate,false);s._rect.width=e.width;s._rect.height=e.height;s.setContentSize(e.width,e.height);s.setRotation(-e.rotation);s.setScale(i.width/i.originalWidth*e.scaleX,i.height/i.originalHeight*e.scaleY);t.sprites=t.sprites||{};t.sprites[i.name]=s;return s};t._updateChild=function(){var t=this._node._skeleton,e=t.slots;var i,n,r;var s,a,o;for(i=0,n=e.length;i<n;i++){s=e[i];a=s.attachment;o=s._slotNode;if(!a){o.setVisible(false);continue}var c=a.type;if(c===spine.AttachmentType.region){if(a.rendererObject){if(!s.currentSpriteName||s.currentSpriteName!==a.name){var l=a.rendererObject.name;if(s.currentSprite!==undefined)s.currentSprite.setVisible(false);s.sprites=s.sprites||{};if(s.sprites[l]!==undefined)s.sprites[l].setVisible(true);else{var h=this._createSprite(s,a);o.addChild(h)}s.currentSprite=s.sprites[l];s.currentSpriteName=l}}var u=s.bone;o.setPosition(u.worldX+a.x*u.m00+a.y*u.m01,u.worldY+a.x*u.m10+a.y*u.m11);o.setScale(u.worldScaleX,u.worldScaleY);r=s.currentSprite;r._flippedX=u.worldFlipX;r._flippedY=u.worldFlipY;if(r._flippedY||r._flippedX){o.setRotation(u.worldRotation);r.setRotation(a.rotation)}else{o.setRotation(-u.worldRotation);r.setRotation(-a.rotation)}r._renderCmd._displayedOpacity=0|t.a*s.a*255;var d=0|t.r*s.r*255,_=0|t.g*s.g*255,f=0|t.b*s.b*255;r.setColor(cc.color(d,_,f));r._renderCmd._updateColor()}else if(c===spine.AttachmentType.skinnedmesh){}else{o.setVisible(false);continue}o.setVisible(true)}}})();(function(){sp.Skeleton.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t);this._needDraw=true;this.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR));this._tmpQuad=new cc.V3F_C4B_T2F_Quad};var t=sp.Skeleton.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=sp.Skeleton.WebGLRenderCmd;t.rendering=function(t){var e=this._node,i=this._tmpQuad;var n=e.getColor(),r=e._skeleton;var s,a,o,c,l,h;var u=e._blendFunc;var d=e._premultipliedAlpha;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);r.r=n.r/255;r.g=n.g/255;r.b=n.b/255;r.a=e.getOpacity()/255;if(d){r.r*=r.a;r.g*=r.a;r.b*=r.a}for(l=0,h=r.drawOrder.length;l<h;l++){c=r.drawOrder[l];if(!c.attachment)continue;o=c.attachment;switch(c.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(o,c,i,d);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(o,c,i,d);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var _=e.getTextureAtlas(o);if(c.data.blendMode!=s){if(a){a.drawQuads();a.removeAllQuads()}s=c.data.blendMode;switch(s){case spine.BlendMode.additive:cc.glBlendFunc(d?cc.ONE:cc.SRC_ALPHA,cc.ONE);break;case spine.BlendMode.multiply:cc.glBlendFunc(cc.DST_COLOR,cc.ONE_MINUS_SRC_ALPHA);break;case spine.BlendMode.screen:cc.glBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_COLOR);break;default:cc.glBlendFunc(u.src,u.dst)}}else if(_!=a&&a){a.drawQuads();a.removeAllQuads()}a=_;var f=a.getTotalQuads();if(a.getCapacity()==f){a.drawQuads();a.removeAllQuads();if(!a.resizeCapacity(a.getCapacity()*2))return}a.updateQuad(i,f)}if(a){a.drawQuads();a.removeAllQuads()}if(e._debugBones||e._debugSlots){cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.current_stack.stack.push(cc.current_stack.top);cc.current_stack.top=this._stackMatrix;var p=cc._drawingUtil;if(e._debugSlots){p.setDrawColor(0,0,255,255);p.setLineWidth(1);for(l=0,h=r.slots.length;l<h;l++){c=r.drawOrder[l];if(!c.attachment||c.attachment.type!=sp.ATTACHMENT_TYPE.REGION)continue;o=c.attachment;this._updateRegionAttachmentQuad(o,c,i);var m=[];m.push(cc.p(i.bl.vertices.x,i.bl.vertices.y));m.push(cc.p(i.br.vertices.x,i.br.vertices.y));m.push(cc.p(i.tr.vertices.x,i.tr.vertices.y));m.push(cc.p(i.tl.vertices.x,i.tl.vertices.y));p.drawPoly(m,4,true)}}if(e._debugBones){var g;p.setLineWidth(2);p.setDrawColor(255,0,0,255);for(l=0,h=r.bones.length;l<h;l++){g=r.bones[l];var v=g.data.length*g.m00+g.worldX;var y=g.data.length*g.m10+g.worldY;p.drawLine(cc.p(g.worldX,g.worldY),cc.p(v,y))}p.setPointSize(4);p.setDrawColor(0,0,255,255);for(l=0,h=r.bones.length;l<h;l++){g=r.bones[l];p.drawPoint(cc.p(g.worldX,g.worldY));if(l==0){p.setDrawColor(0,255,0,255)}}}cc.kmGLPopMatrix()}};t._createChildFormSkeletonData=function(){};t._updateChild=function(){};t._updateRegionAttachmentQuad=function(t,e,i,n){var r={};t.computeVertices(e.bone.skeleton.x,e.bone.skeleton.y,e.bone,r);var s=e.bone.skeleton.r*e.r*255;var a=e.bone.skeleton.g*e.g*255;var o=e.bone.skeleton.b*e.b*255;var c=e.bone.skeleton.a*e.a;if(n){s*=c;a*=c;o*=c}var l=c*255;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s;i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=a;i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=o;i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var h=sp.VERTEX_INDEX;i.bl.vertices.x=r[h.X1];i.bl.vertices.y=r[h.Y1];i.tl.vertices.x=r[h.X2];i.tl.vertices.y=r[h.Y2];i.tr.vertices.x=r[h.X3];i.tr.vertices.y=r[h.Y3];i.br.vertices.x=r[h.X4];i.br.vertices.y=r[h.Y4];i.bl.texCoords.u=t.uvs[h.X1];i.bl.texCoords.v=t.uvs[h.Y1];i.tl.texCoords.u=t.uvs[h.X2];i.tl.texCoords.v=t.uvs[h.Y2];i.tr.texCoords.u=t.uvs[h.X3];i.tr.texCoords.v=t.uvs[h.Y3];i.br.texCoords.u=t.uvs[h.X4];i.br.texCoords.v=t.uvs[h.Y4]};t._updateMeshAttachmentQuad=function(t,e,i,n){var r={};t.computeWorldVertices(e.bone.x,e.bone.y,e,r);var s=e.bone.skeleton.r*e.r*255;var a=e.bone.skeleton.g*e.g*255;var o=e.bone.skeleton.b*e.b*255;var c=e.bone.skeleton.a*e.a;if(n){s*=c;a*=c;o*=c}var l=c*255;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s;i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=a;i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=o;i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var h=sp.VERTEX_INDEX;i.bl.vertices.x=r[h.X1];i.bl.vertices.y=r[h.Y1];i.tl.vertices.x=r[h.X2];i.tl.vertices.y=r[h.Y2];i.tr.vertices.x=r[h.X3];i.tr.vertices.y=r[h.Y3];i.br.vertices.x=r[h.X4];i.br.vertices.y=r[h.Y4];i.bl.texCoords.u=t.uvs[h.X1];i.bl.texCoords.v=t.uvs[h.Y1];i.tl.texCoords.u=t.uvs[h.X2];i.tl.texCoords.v=t.uvs[h.Y2];i.tr.texCoords.u=t.uvs[h.X3];i.tr.texCoords.v=t.uvs[h.Y3];i.br.texCoords.u=t.uvs[h.X4];i.br.texCoords.v=t.uvs[h.Y4]}})();(function(){gaf.Sprite.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t);this._defualtShader=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);this._customShader=gaf._Shaders.Alpha;this._tintMult=null;this._tintOffset=null;this._ctxMatrixBody=null;this._ctxMatrixAppendix=null};var t=gaf.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);t.constructor=gaf.Sprite.WebGLRenderCmd;t._identityVec=[1,1,1,1];t._zeroVec=[0,0,0,0];t._identityMat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t._disableCtx=function(){this.setShaderProgram(this._defualtShader)};t._enableCtx=function(){this.setShaderProgram(this._customShader)};t._applyCtxState=function(t){var e=t._cascadeColorMult;this._tintMult=[e.r/255,e.g/255,e.b/255,e.a/255];var i=t._cascadeColorOffset;this._tintOffset=[i.r/255,i.g/255,i.b/255,i.a/255];var n=t._filterStack;if(n&&n.length>0&&n[0].type===gaf.EFFECT_COLOR_MATRIX){var r=n[0].colorMatrix;this._ctxMatrixBody=[r.rr,r.rg,r.rb,r.ra,r.gr,r.gg,r.gb,r.ga,r.br,r.bg,r.bb,r.ba,r.ar,r.ag,r.ab,r.aa];this._ctxMatrixAppendix=[r.r/255,r.g/255,r.b/255,r.a/255]}else{this._ctxMatrixBody=null;this._ctxMatrixAppendix=null}};t._setUniforms=function(){if(this._shaderProgram===this._customShader){this._shaderProgram.use();{this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorTransformMult,this._tintMult,1);this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorTransformOffset,this._tintOffset,1)}if(this._ctxMatrixBody&&this._ctxMatrixAppendix){this._shaderProgram.setUniformLocationWithMatrix4fv(gaf._Uniforms.ColorMatrixBody,this._ctxMatrixBody,1);this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorMatrixAppendix,this._ctxMatrixAppendix,1)}else{this._shaderProgram.setUniformLocationWithMatrix4fv(gaf._Uniforms.ColorMatrixBody,this._identityMat,1);this._shaderProgram.setUniformLocationWith4fv(gaf._Uniforms.ColorMatrixAppendix,this._zeroVec,1)}}};t.rendering=function(t){this._setUniforms();cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this,t)}})();